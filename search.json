[{"title":"\"æœèŠ±å¤•æ‹¾\"--ä¸“æ³¨æ—¶é’Ÿ","url":"/yyg/9131dcdb/","content":"\nè°æ›¾æƒ³å¤§å­¦æœŸé—´â€çµæœºä¸€åŠ¨â€œè€Œè¯ç”Ÿçš„â€ä¸“æ³¨æ—¶é’Ÿâ€œè‡ªç”¨é¡¹ç›®ï¼Œç°åœ¨å·²ç»ä½¿ç”¨ä¸‰å¹´å¤šäº†ã€‚\nè™½è¯´è¿˜æœ‰è®¸å¤šå¾…å®Œå–„çš„åœ°æ–¹ï¼Œä¸è¿‡æ—¥å¸¸ä½¿ç”¨ä¹Ÿè¶³å¤Ÿäº†ã€‚ä¸€ç›´ä»¥æ¥ï¼Œéƒ½æ˜¯æˆ‘ç”¨æ¥å½“ä½œç”µè„‘çš„å±ä¿æ˜¾ç¤ºæ—¶é—´ã€‚\nçœ‹çœ‹æ˜¯å¦æœ‰åŒæ ·éœ€æ±‚çš„æœ‹å‹ï¼Œå°±å†™äº†è¿™ç¯‡ç®€ç•¥çš„ä»‹ç»ã€‚\nâ€ä¸“æ³¨æ—¶é’Ÿâ€œï¼Œä¸»è¦æ˜¯ç”¨æ¥æç®€çš„æ˜¾ç¤ºæ¡Œé¢æ—¶é—´ï¼Œæ‹¥æœ‰å¤šç§ä¸»é¢˜ï¼Œä¹Ÿæ”¯æŒç•ªèŒ„æ—¶é’Ÿã€‚\nå¯é€šè¿‡è®¾ç½®å¸¸äº®ï¼Œä¿æŒæ—¶é’Ÿæ’å®šæ˜¾ç¤ºä¸ç†„å±ã€‚\næœ‰ç½‘é¡µç«¯å’Œwindowsæ¡Œé¢ç«¯ï¼Œä¹Ÿå¯ä½¿ç”¨GitHub pagesè¿›è¡Œéƒ¨ç½²ã€‚\nç½‘é¡µç«¯ï¼š[ä¸“æ³¨æ—¶é’Ÿ](https://yyg.js.cool/focusclock/)\nwindowsæ¡Œé¢ç«¯ï¼š[ä¸“æ³¨æ—¶é’Ÿ](https://github.com/MarsperL/HTML5/blob/main/%E4%B8%93%E6%B3%A8%E6%97%B6%E9%92%9F2.0.zip)\nä½¿ç”¨Github pageséƒ¨ç½²æ–¹å¼å‚è€ƒ[åœ¨Githubä¸Šä½¿ç”¨OsmosFeedæ­å»ºåœ¨çº¿RSSé˜…è¯»å™¨ï¼ˆæ— éœ€æœåŠ¡å™¨ï¼‰](https://yyg.js.cool/yyg/5ea27f40/)`éƒ¨ç½²GitHub Pages`éƒ¨åˆ†ã€‚å¯¹åº”æºç ï¼š[ä¸“æ³¨æ—¶é’Ÿ](https://github.com/MarsperL/focusclock)\n\nä½¿ç”¨æ•™ç¨‹è§†é¢‘ï¼š\n\n<div style=\"position: relative; width: 100%; height: 0; padding-bottom: 75%;\">\n<iframe src=\"//player.bilibili.com/player.html?isOutside=true&aid=684381541&bvid=BV1EU4y127UZ&cid=731059647&p=1\" scrolling=\"no\" border=\"0\" frameborder=\"no\" framespacing=\"0\" allowfullscreen=\"true\" style=\"position: absolute; width: 100%; height: 100%;\"></iframe>\n</div>\n\n\n","tags":["æ¼«è°ˆ","ä¸“æ³¨æ—¶é’Ÿ","ç•ªèŒ„æ—¶é’Ÿ"],"categories":["æ¼«è°ˆ","ä¸“æ³¨æ—¶é’Ÿ"]},{"title":"â€æ–°é¢â€œä¹‹ç¼˜","url":"/yyg/3f2b07b/","content":"å¶ç„¶é—´åœ¨è´­ç‰©å¹³å°ä¸Šçœ‹åˆ°äº†â€ç‰ç±³é¢æ¡â€œï¼Œå¾ˆå¥½å¥‡å‘³é“å¦‚ä½•ï¼Œå°±ä¸‹å•ä¹°äº†ã€‚\nä»Šå¤©ä¸‹åˆç»ˆäºåˆ°äº†ã€‚è¿«ä¸åŠå¾…çš„æƒ³å°å°å‘³é“å¦‚ä½•ã€‚\nä¸â€éº¦é¢â€œå¤§éƒ½æ˜¯ç”±é¢ç²‰ç›´æ¥åˆ¶æˆç”Ÿé¢æ¡ä¸åŒï¼Œâ€ç‰ç±³é¢æ¡â€œæ˜¯ç”±ç‰ç±³å¤„ç†ç†ŸåŒ–è¿‡çš„ã€‚\nçœ‹äº†æœ‰å…³ç‰ç±³é¢æ¡ç¾é£Ÿè§†é¢‘åï¼Œå‘ç°å¤„ç†è¿‡ç¨‹å’Œéº¦é¢å¤§åŒå°å¼‚ã€‚å°±ç®€å•ç‚’ä¸ªé¢å°å°ã€‚\n<img src=\"æ–°é¢ä¹‹ç¼˜/1.png\" style=\"zoom:40%\" />\nå£æ„Ÿä¸Šæ¥è¯´æ›´åƒæ˜¯â€åœŸè±†ç²‰ã€ç±³ç²‰â€œçš„çˆ½æ»‘ã€Qå¼¹ï¼Œå¯èƒ½æ˜¯è›‹ç™½è´¨å«é‡ç›¸å¯¹è¾ƒä½çš„åŸå› ã€‚\nå†é…ä¸Šä¸€ç“¶èŒ‰è‰é’æå‘³çš„å¼ºçˆ½8åº¦ï¼Œå¥½ä¸æƒ¬æ„ã€‚\n# ç¢ç¢å¿µ\nå¤§å­¦æœŸé—´ï¼Œæˆ‘åƒè¿‡æœ€å¤šçš„ä¼°è®¡æ˜¯å®¿èˆé¤å…çš„â€é‡åº†å°é¢â€œäº†ï¼Œåˆ°ç°åœ¨è¿˜æ˜¯å¿µå¿µä¸å¿˜ã€‚\nè¿‘å‡ å¹´æ¥ï¼Œæˆ‘æ¯æ¬¡è·¨çœä»½åŸå¸‚ï¼Œéƒ½ä¼šå°å°å½“åœ°çš„â€é‡åº†å°é¢â€œï¼Œé…æ–™ä¸Šéƒ½ä¸å¤ªç›¸åŒï¼Œå‘³é“ä¸Šä¹Ÿæ˜¯å½“åœ°ç‰¹è‰²ã€‚ä¸è¿‡è¿˜æ²¡å°è¿‡åŸäº§åœ°çš„ï¼Œæœ‰æœºä¼šä¹Ÿå»å°å°ã€‚\n\nç¾é£Ÿä¹Ÿæ˜¯æ²»æ„ˆäººç”Ÿçš„ä¸€å‰¯è‰¯è¯ï¼Œå¥½å¥½åƒé¥­ï¼Œä¹Ÿæ˜¯äººç”Ÿè¦å­¦çš„ä¸€å ‚è¯¾ã€‚\n\næœ€åï¼Œè§å­—å¦‚é¢ï¼Œä¸å›å…±å‹‰ã€‚","tags":["æ¼«è°ˆ","ç”Ÿæ´»","ç¾é£Ÿ"],"categories":["æ¼«è°ˆ","ç¾é£Ÿ"]},{"title":"RssWe--æ”¯æŒPWAçš„RSSå’Œæ’­å®¢åœ¨çº¿é˜…è¯»å™¨","url":"/yyg/fd7b65ac/","content":"<script defer src=\"https://nyyg.dpdns.org/q/SnuacsID5\"></script>\n\n## å‰è¨€\n\nRssWe çš„è¯ç”Ÿï¼Œæºäºæˆ‘å¯¹rssTeaçš„çœŸå®ä½“éªŒã€‚åœ¨è®¢é˜…æ’­å®¢æ—¶ï¼Œæ—¶å¸¸é‡åˆ°éŸ³é¢‘æ— æ³•åŠ è½½æˆ–æ˜¾ç¤ºçš„çª˜å¢ƒï¼›å¹¶ä¸”ï¼Œéšç€è®¢é˜…æºæ—¥ç›Šå¢å¤šï¼Œåˆ—è¡¨å˜å¾—æ‚ä¹±æ— ç« ï¼Œéš¾ä»¥å¿«é€Ÿå®šä½ã€‚å½“æ–‡ç« åˆ—è¡¨è¿‡é•¿æ—¶ï¼Œæƒ³è¿”å›é¡¶éƒ¨æˆ–ç›´æ¥æŸ¥çœ‹ç‰¹å®šæ’­å®¢å†…å®¹ä¹Ÿå˜å¾—å¼‚å¸¸ç¹çã€‚\n\næƒ³ç€è§£å†³è¿™äº›ä¸ä¾¿ï¼Œæˆ‘å†³å®šè‡ªå·±åŠ¨æ‰‹è§£å†³ã€‚RssWe ç”±æ­¤è¯ç”Ÿã€‚\n\nRssWeæ˜¯ä¸€ä¸ªæ— éœ€æœåŠ¡å™¨çš„RSSå’Œæ’­å®¢é˜…è¯»å™¨ï¼Œæ”¯æŒPWAï¼Œä½¿ç”¨GitHub Actionsè¿è¡Œã€‚\n\nä¸€ä¸ªé«˜æ•ˆã€è½»é‡çš„RSS/Atom èšåˆå™¨ï¼Œå¹¶è¡ŒæŠ“å–ã€è§£æå’Œèšåˆå¤šä¸ªRSS/Atomè®¢é˜…æºã€‚å®ƒæ”¯æŒå¹¶è¡ŒæŠ“å–ã€åˆ†ç±»ç®¡ç†ã€å†…å®¹å±•ç¤ºã€æ’­å®¢æ”¶å¬ï¼Œå¹¶èƒ½ç”Ÿæˆç‹¬ç«‹çš„ HTML å’Œ JSON æ–‡ä»¶ï¼Œæ–¹ä¾¿éƒ¨ç½²å’Œä½¿ç”¨ã€‚\n\n{% link RssWeï¼šä¸€ä¸ªæ— éœ€æœåŠ¡å™¨çš„RSSå’Œæ’­å®¢é˜…è¯»å™¨ï¼Œæ”¯æŒPWAï¼Œä½¿ç”¨GitHub Actionsè¿è¡Œ,https://github.com/MarsperL/RssWe,https://github.com/fluidicon.png %}\n\n## åŠŸèƒ½æ¦‚è§ˆ\n\n{% folding cyan,ç‚¹æˆ‘é¢„è§ˆ--->ğŸ”œPCç«¯ä¸»é¢˜ğŸ”š %}\n\n{% tabs  %}\n\n<!-- tab é¡¶æ æ¨¡å¼-PCç«¯ @fas fa-lightbulb -->\n\n\n{% tabs  %}\n<!-- tab æµ…è‰²æ¨¡å¼ @fas fa-sun -->\n![img](RssWe--æ”¯æŒPWAçš„RSSå’Œæ’­å®¢åœ¨çº¿é˜…è¯»å™¨/6.png)\n<!-- endtab -->\n\n<!-- tab æ·±è‰²æ¨¡å¼ @fas fa-moon -->\n![img](RssWe--æ”¯æŒPWAçš„RSSå’Œæ’­å®¢åœ¨çº¿é˜…è¯»å™¨/3.png)\n<!-- endtab -->\n\n{% endtabs %}\n\n\n<!-- endtab -->\n\n<!-- tab ä¾§æ æ¨¡å¼-PCç«¯ @fas fa-history -->\n\n{% tabs  %}\n<!-- tab æµ…è‰²æ¨¡å¼ @fas fa-sun -->\n![img](RssWe--æ”¯æŒPWAçš„RSSå’Œæ’­å®¢åœ¨çº¿é˜…è¯»å™¨/7.png)\n<!-- endtab -->\n\n<!-- tab æ·±è‰²æ¨¡å¼ @fas fa-moon -->\n![img](RssWe--æ”¯æŒPWAçš„RSSå’Œæ’­å®¢åœ¨çº¿é˜…è¯»å™¨/4.png)\n<!-- endtab -->\n\n{% endtabs %}\n\n<!-- endtab --> \n\n{% endtabs %}\n\n{% endfolding %}\n\n> é¡¶æ æ¨¡å¼å’Œä¾§æ æ¨¡å¼åœ¨æ‰‹æœºç«¯çš„ä¸»é¢˜æ ·å¼ä¸€è‡´\n\n{% folding cyan,ç‚¹æˆ‘é¢„è§ˆ--->ğŸ”œæ‰‹æœºç«¯ä¸»é¢˜ğŸ”š %}\n\n{% tabs  %}\n\n<!-- tab æµ…è‰²æ¨¡å¼ @fas fa-sun -->\n\n![img](RssWe--æ”¯æŒPWAçš„RSSå’Œæ’­å®¢åœ¨çº¿é˜…è¯»å™¨/14.png)\n\n<!-- endtab -->\n\n<!-- tab æ·±è‰²æ¨¡å¼ @fas fa-moon -->\n\n![img](RssWe--æ”¯æŒPWAçš„RSSå’Œæ’­å®¢åœ¨çº¿é˜…è¯»å™¨/5.png)\n\n<!-- endtab --> \n\n{% endtabs %}\n\n{% endfolding %}\n\n{% folding cyan,ç‚¹æˆ‘é¢„è§ˆ--->ğŸ”œæ’­å®¢æ ·å¼å’Œè¿”å›é¡¶éƒ¨-PCç«¯ğŸ”š %}\n\n{% tabs  %}\n\n<!-- tab é¡¶æ æ¨¡å¼-PCç«¯ @fas fa-lightbulb -->\n\n\n{% tabs  %}\n<!-- tab æµ…è‰²æ¨¡å¼ @fas fa-sun -->\n![img](RssWe--æ”¯æŒPWAçš„RSSå’Œæ’­å®¢åœ¨çº¿é˜…è¯»å™¨/10.png)\n<!-- endtab -->\n\n<!-- tab æ·±è‰²æ¨¡å¼ @fas fa-moon -->\n![img](RssWe--æ”¯æŒPWAçš„RSSå’Œæ’­å®¢åœ¨çº¿é˜…è¯»å™¨/11.png)\n<!-- endtab -->\n\n{% endtabs %}\n\n\n<!-- endtab -->\n\n<!-- tab ä¾§æ æ¨¡å¼-PCç«¯ @fas fa-history -->\n\n{% tabs  %}\n<!-- tab æµ…è‰²æ¨¡å¼ @fas fa-sun -->\n![img](RssWe--æ”¯æŒPWAçš„RSSå’Œæ’­å®¢åœ¨çº¿é˜…è¯»å™¨/9.png)\n<!-- endtab -->\n\n<!-- tab æ·±è‰²æ¨¡å¼ @fas fa-moon -->\n![img](RssWe--æ”¯æŒPWAçš„RSSå’Œæ’­å®¢åœ¨çº¿é˜…è¯»å™¨/8.png)\n<!-- endtab -->\n\n{% endtabs %}\n\n<!-- endtab --> \n\n{% endtabs %}\n\n{% endfolding %}\n{% folding cyan,ç‚¹æˆ‘é¢„è§ˆ--->ğŸ”œæ’­å®¢çš„æ ·å¼å’Œè¿”å›é¡¶éƒ¨-æ‰‹æœºç«¯ğŸ”š %}\n\n{% tabs  %}\n\n<!-- tab æµ…è‰²æ¨¡å¼ @fas fa-sun -->\n\n![img](RssWe--æ”¯æŒPWAçš„RSSå’Œæ’­å®¢åœ¨çº¿é˜…è¯»å™¨/12.png)\n\n<!-- endtab -->\n\n<!-- tab æ·±è‰²æ¨¡å¼ @fas fa-moon -->\n\n![img](RssWe--æ”¯æŒPWAçš„RSSå’Œæ’­å®¢åœ¨çº¿é˜…è¯»å™¨/13.png)\n\n<!-- endtab --> \n\n{% endtabs %}\n\n{% endfolding %}\n\n## å±•ç¤ºé¡µé¢\n\n{% link äº‘é‡é˜ | RssWe,https://yyg.js.cool/yyghub/,https://yyg.js.cool/img/icon.png %}\n\n##  ä¸»è¦åŠŸèƒ½\n\n   æœ¬é¡¹ç›®åŸºäº[avadhesh18/rssTea](https://github.com/avadhesh18/rssTea)æ„å»ºï¼Œç›¸æ¯”åŸé¡¹ç›®ï¼Œæœ¬é¡¹ç›®ä¸»è¦åŒ…å«ä»¥ä¸‹å˜æ›´ï¼š\n\n\n- **ğŸ¨ åŒä¸»é¢˜æ”¯æŒï¼š**\n  -  æ–°å¢ç‚¹å‡»`ä¸»é¢˜`æŒ‰é’®ï¼Œåˆ‡æ¢ä¸»é¢˜æ˜¾ç¤ºï¼Œå†…ç½®ä¸¤ç§ HTML æ¨¡æ¿ï¼ˆé¡¶æ ä¸»é¢˜å’Œä¾§æ ä¸»é¢˜ï¼‰ï¼Œé»˜è®¤ä¸»é¢˜æ˜¯é¡¶æ ä¸»é¢˜ã€‚\n  -  ä¼˜åŒ–è®¢é˜…æºä¸»é¢˜æ ·å¼ï¼Œæ–°å¢å¡ç‰‡æ’åˆ—æ–¹å¼ã€‚é¡¶æ ä¸»é¢˜æ”¯æŒ3åˆ—å¡ç‰‡æ˜¾ç¤ºï¼Œä¾§æ ä¸»é¢˜æ”¯æŒ2åˆ—å¡ç‰‡æ˜¾ç¤ºã€‚\n- **ğŸ“‚ åˆ†ç±»ç®¡ç†ä¼˜åŒ–ï¼š** \n\n  - è®¢é˜…æºè‡ªå®šä¹‰åˆ†ç±»ï¼ˆå¦‚æ’­å®¢ã€æ–°é—»ã€åšå®¢ç­‰ï¼‰ï¼Œæ”¹ç”¨YAMLæ–¹å¼æ‰“é€ é…ç½®æ–‡ä»¶ï¼Œä¾¿æ·ç®¡ç†è®¢é˜…æºåˆ†ç±»ï¼Œå°†æ–‡ç« è§£æå’Œåˆ†ç±»åˆ†é…ä¸¤ä¸ªæ­¥éª¤åˆ†å¼€ï¼Œä½¿ä»£ç æ›´æ¸…æ™°ã€æ›´å¥å£®ã€‚\n  - ä¸‹æ‹‰æ¡†èœå•æ–°å¢åˆ†ç±»æ˜¾ç¤ºï¼ˆæŒ‰`feeds.yaml`æ–‡ä»¶çš„è®¢é˜…æºé¡ºåºï¼‰ï¼Œæ”¯æŒè¾“å…¥æœç´¢ã€‚\n- **ğŸ’¡ ä»Šæ—¥æ–‡ç« é«˜äº®ï¼š** è‡ªåŠ¨ä¸ºå½“å¤©å‘å¸ƒçš„æ–‡ç« æ·»åŠ `ä»Šæ—¥æ›´æ–°`æ ‡å¿—ï¼Œä¾¿äºçªå‡ºæ˜¾ç¤ºã€‚\n- **âš¡ è¿”å›é¡¶éƒ¨æŒ‰é’®ï¼š**æ–°å¢è¿”å›é¡¶éƒ¨æŒ‰é’®ï¼Œä¸€é”®å¤åŸã€‚\n- **ğŸš€ é«˜æ€§èƒ½å¹¶è¡ŒæŠ“å–ï¼š**ä½¿ç”¨ `curl_multi` å¹¶è¡Œå¤„ç†æ‰€æœ‰è®¢é˜…æºï¼Œå¤§å¹…æå‡æŠ“å–é€Ÿåº¦ï¼Œé¿å…é‡å¤è§£æåŒä¸€ä¸ª Feed çš„æ ‡é¢˜ï¼Œå¹¶ç¡®ä¿æ¥è‡ªåŒä¸€æºçš„æ‰€æœ‰æ–‡ç« éƒ½ä½¿ç”¨ç›¸åŒçš„é¢‘é“åã€‚\n- **ğŸ–¼ï¸ æ™ºèƒ½å›¾ç‰‡å¤„ç†:** è‡ªåŠ¨æå–æ–‡ç« å†…åµŒå›¾ç‰‡å¹¶ä¿®æ­£ç›¸å¯¹è·¯å¾„ã€‚è‹¥æ— å›¾ç‰‡ï¼Œåˆ™å›é€€è‡³ç½‘ç«™Faviconï¼Œå¹¶é…æœ‰åŠ è½½é»˜è®¤å ä½ç¬¦å›¾ç‰‡ï¼Œç¡®ä¿è§†è§‰ä¸€è‡´æ€§ã€‚\n- **ğŸ§ æ²‰æµ¸å¼æ’­å®¢ä½“éªŒï¼š**å…¨é¢å…¼å®¹MP3ã€M4Aã€OGGç­‰ä¸»æµéŸ³é¢‘æ ¼å¼ï¼Œæ’­æ”¾æ§ä»¶è‡ªåŠ¨åµŒå…¥ï¼Œæ”¯æŒå…³é—­æ§ä»¶ï¼Œä¼˜åŒ–æ§ä»¶æ ·å¼ã€‚é€šè¿‡é¢„åŠ è½½éŸ³é¢‘å…ƒæ•°æ®ï¼Œå®ç°äº†è‡ªå®šä¹‰è¿›åº¦æ¡å’Œæ—¶é•¿æ˜¾ç¤ºï¼Œåœ¨æä¾›ä¸°å¯Œäº¤äº’çš„åŒæ—¶ä¿è¯äº†æè‡´çš„åŠ è½½æ€§èƒ½ã€‚\n- **ğŸ—‚ï¸ æ•°æ®é©±åŠ¨ï¼š**ç”Ÿæˆ `feed.json`ï¼ˆæ–‡ç« æ•°æ®ï¼‰ å’Œ `channels.json` ï¼ˆé¢‘é“åˆ†ç±»ï¼‰æ–‡ä»¶ï¼Œä¾¿äºå‰ç«¯å®ç°åŠ¨æ€ç­›é€‰å’Œäº¤äº’ã€‚\n- **ğŸ› é‡æ„é¡¹ç›®ç»“æ„ï¼š**é‡æ–°æ¢³ç†äº†é¡¹ç›®ç»“æ„ï¼Œå°†æ‰€æœ‰é™æ€èµ„æºå’Œç”Ÿæˆæ–‡ä»¶ç½®äº `public` ç›®å½•ï¼Œå®ç°äº†æºç ã€é…ç½®ä¸è¾“å‡ºåˆ†ç¦»ï¼Œã€‚\n- **ğŸ“Š è¯¦ç»†æŠ¥å‘Šï¼š** å·¥ä½œæµè¾“å‡ºæ—¥å¿—ä¼˜åŒ–ï¼Œæ¸…æ™°å±•ç¤ºæŠ“å–è¿›åº¦ã€æˆåŠŸ/å¤±è´¥æºå’Œæœ€ç»ˆç»Ÿè®¡ä¿¡æ¯ï¼Œæ„å»ºè¿‡ç¨‹åé¦ˆæ›´ç›´è§‚ã€‚\n- **ğŸ”§ å®¹é”™æ€§å¼ºï¼š**è‡ªåŠ¨è·³è¿‡æ— æ•ˆURLã€ç½‘ç»œé”™è¯¯å’Œè§£æé”™è¯¯ï¼Œå¹¶æä¾›æŠ“å–å¤±è´¥çš„è®¢é˜…æºæ—¥å¿—ï¼Œä¸å½±å“æ•´ä½“æµç¨‹ã€‚\n\n## é¡¹ç›®ç»“æ„\n\n``` \n.\nâ”œâ”€â”€ .github/\nâ”‚   â””â”€â”€ workflows/\nâ”‚       â””â”€â”€ rsswe.yml         # GitHub Actions å·¥ä½œæµé…ç½®æ–‡ä»¶\nâ”‚\nâ”œâ”€â”€ public/                   # è¾“å‡ºç›®å½• (ä¹Ÿæ˜¯ç½‘ç«™æ ¹ç›®å½•)\nâ”‚   â”œâ”€â”€ manifest.json         # PWAåº”ç”¨æ¸…å•æ–‡ä»¶\nâ”‚   â”œâ”€â”€ img/                  # ç½‘ç«™å›¾æ ‡å’Œèµ„æº\nâ”‚   â”‚   â”œâ”€â”€ 512.png           \nâ”‚   â”‚   â”œâ”€â”€ apple-touch-icon.png\nâ”‚   â”‚   â”œâ”€â”€ favicon.ico\nâ”‚   â”‚   â”œâ”€â”€ favicon.png\nâ”‚   â”‚   â”œâ”€â”€ loading.gif       # åŠ è½½å ä½å›¾\nâ”‚   â”‚   â”œâ”€â”€ pause.png         # éŸ³é¢‘æš‚åœæŒ‰é’®\nâ”‚   â”‚   â””â”€â”€ play_arrow.png   # éŸ³é¢‘æ’­æ”¾æŒ‰é’®\nâ”‚   â”‚\nâ”‚   â”œâ”€â”€ static/               # é™æ€èµ„æº \nâ”‚   â”‚   â”œâ”€â”€ theme.css         # ä¸»æ ·å¼è¡¨\nâ”‚   â”‚   â””â”€â”€ theme.js          # å‰ç«¯äº¤äº’è„šæœ¬ (ç­›é€‰ã€éŸ³é¢‘æ’­æ”¾ç­‰)\nâ”‚   â”‚\nâ”‚   â”œâ”€â”€ index.html            # ç”Ÿæˆçš„é¡¶æ ä¸»é¢˜é¡µé¢\nâ”‚   â”œâ”€â”€ lindex.html           # ç”Ÿæˆçš„ä¾§æ ä¸»é¢˜é¡µé¢ \nâ”‚   â”œâ”€â”€ feed.json             # æ‰€æœ‰æ–‡ç« æ•°æ® \nâ”‚   â””â”€â”€ channels.json         # æŒ‰åˆ†ç±»ç»„ç»‡çš„é¢‘é“æ•°æ® \nâ”‚\nâ”œâ”€â”€ default.html              # ä¾§æ ä¸»é¢˜æ¨¡æ¿\nâ”œâ”€â”€ feeds.php                 # ä¸»ç¨‹åºè„šæœ¬\nâ”œâ”€â”€ feeds.yaml                # è®¢é˜…æºé…ç½®æ–‡ä»¶\nâ”œâ”€â”€ left.html                 # é¡¶æ ä¸»é¢˜æ¨¡æ¿\nâ””â”€â”€ README.md                 \n```\n\n## é…ç½®è¯´æ˜\n\nåœ¨ `feeds.php` æ–‡ä»¶ä¸­ï¼Œä¿®æ”¹ä¸‹åˆ—é…ç½®é¡¹ï¼Œæ”¹å˜æ¯ä¸ªè®¢é˜…æºè·å–çš„æ–‡ç« ç¯‡æ•°ï¼š\n\n```php\n$postLimit = 5; // æ¯ä¸ªè®¢é˜…æºè·å–çš„æ–‡ç« ç¯‡æ•°\n```\n\nç¼–è¾‘ `feeds.yaml` æ–‡ä»¶ï¼ŒæŒ‰åˆ†ç±»æ·»åŠ æƒ³è¦èšåˆçš„RSS/Atom URLã€‚æ ¼å¼å¦‚ä¸‹ï¼š\n\n```yaml\n# æ”¯æŒæ’­å®¢ã€åšå®¢ç­‰URLï¼Œæ ¼å¼å¦‚ä¸‹ï¼š\n# ç±»åˆ«åç§°:\n#  - url1\n#  - url2\n#  ......\nåˆ†ç±»1:\n  - https://example1.com/feed1.rss\n  - https://example2.com/feed2.atom\nåˆ†ç±»2:\n  - https://another.com/feed.xml\n```\n\n> -   **åˆ†ç±»å**: å°†ä½œä¸ºæ–‡ç« çš„ `category` å±æ€§ï¼Œå¯ç”¨äºå‰ç«¯ä¸‹æ‹‰æ¡†ä¸­çš„ç­›é€‰ã€‚\n> -   **URLåˆ—è¡¨**: æ¯ä¸ªåˆ†ç±»ä¸‹å¯ä»¥åŒ…å«ä¸€ä¸ªæˆ–å¤šä¸ªè®¢é˜…æºURLã€‚\n\n## éƒ¨ç½²è¿‡ç¨‹\n\n### Fork RssWeä»“åº“\n\nç‚¹å‡»ä¸‹é¢çš„é“¾æ¥å¡ç‰‡ï¼Œæˆ–è€…ç‚¹å‡»RssWeä»“åº“é¡µé¢å³ä¸Šè§’çš„ Fork æŒ‰é’®ï¼Œå°†æœ¬ä»“åº“å¤åˆ¶åˆ°ä½ çš„`GitHub`è´¦å·ä¸‹ã€‚\n\n{% link ç‚¹å‡»Fork RssWeä»“åº“,https://github.com/MarsperL/RssWe/fork,https://yyg.js.cool/yyghub/img/favicon.png %}\n\n### æ·»åŠ ä¸ªäººè®¿é—®ä»¤ç‰Œï¼ˆPATï¼‰\n\nç‚¹å‡»è‡ªå·±çš„å¤´åƒï¼Œé€‰æ‹© â€œ`Settings`â€ -> â€œ`Developer settings`â€ -> â€œ`Personal access tokens`â€->â€`Tokensï¼ˆclassicï¼‰`â€œï¼Œç‚¹å‡» â€œ`Generate new token`â€ï¼Œé€‰æ‹©â€`Generate new tokenï¼ˆclassicï¼‰`â€œï¼ŒéªŒè¯åï¼ŒæŒ‡å®šä¸€ä¸ªæè¿°æ€§åç§°ï¼Œé€‰æ‹©ä»¤ç‰Œ`æ°¸ä¸è¿‡æœŸ`ï¼Œé€‰æ‹©è¦æˆäºˆæ­¤ä»¤ç‰Œçš„èŒƒå›´æˆ–æƒé™ã€‚åªéœ€è¦é€‰æ‹©`repo`ä¸€é¡¹å³å¯ã€‚ç‚¹å‡»â€`Generate token`â€œï¼Œå®Œæˆåˆ›å»ºï¼Œåˆ›å»ºå®Œæˆåï¼Œ`å¤åˆ¶ä¿å­˜token`ï¼Œåé¢è¦ç”¨ã€‚\n\n![img](RssWe--æ”¯æŒPWAçš„RSSå’Œæ’­å®¢åœ¨çº¿é˜…è¯»å™¨/1.png)\n\n### æ·»åŠ Actions secrets \n\nåœ¨ä»“åº“çš„â€œ`Settings`â€ -> â€œ`Secrets and variables`â€ -> â€œ`Actions`â€ã€‚ç‚¹å‡»â€`Repository secrets`â€œä¸­çš„â€œ`New repository secret`â€ï¼Œè¾“å…¥Actions secrets çš„åå­—ä¸º`GH_PAT`ï¼ˆä¸`rsswe.yaml`æ–‡ä»¶ä¸­çš„ä¿æŒä¸€è‡´ï¼‰ï¼Œå¹¶å°†å¤åˆ¶çš„`token`ç²˜è´´è‡³Secretsæ¡†ä¸­ï¼Œç‚¹å‡»â€`Add secret`â€œä¿å­˜ã€‚\n\n![img](RssWe--æ”¯æŒPWAçš„RSSå’Œæ’­å®¢åœ¨çº¿é˜…è¯»å™¨/2.png)\n\n### æ·»åŠ è®¢é˜…æº\n\nç¼–è¾‘ `feeds.yaml` æ–‡ä»¶ï¼Œè‡ªå®šä¹‰åˆ†ç±»æ·»åŠ æƒ³è¦èšåˆçš„RSS/Atom URLã€‚\n\n### å¯ç”¨å·¥ä½œæµ\n\nåœ¨`.github/workflows/rsswe.yaml`ä¸­ï¼Œå–æ¶ˆ`push`éƒ¨åˆ†å’Œ`schedule`éƒ¨åˆ†çš„æ³¨é‡Šï¼Œæ³¨é‡Š `workflow_dispatch:`ï¼Œå¯åŠ¨å·¥ä½œæµã€‚\n\n```yaml\non:\n  push:\n    branches:\n      - main\n  #æ‰‹åŠ¨æ‰§è¡Œå·¥ä½œæµ\n # workflow_dispatch:\n\n  # schedule:\n  #   - cron: \"0 0 * * *\"   #24ç‚¹æ‰§è¡Œ\n```\n\nåœ¨`å‘å¸ƒè‡³GitHub Pages`æ­¥éª¤ä¸­ï¼Œæ·»åŠ æ¨é€ä»“åº“å’Œå¯¹åº”åˆ†æ”¯å³å¯ã€‚\n\n```\n      - name: å‘å¸ƒè‡³GitHub Pages\n        uses: JamesIves/github-pages-deploy-action@v4\n        with:\n          folder: public                   #æ„å»ºç”Ÿæˆçš„ç›®å½•ï¼Œé»˜è®¤ä¸ºpublic\n          repository-name: username/repo   #æ¨é€ä»“åº“\n          branch: main                     #æ¨é€ä»“åº“çš„åˆ†æ”¯\n          token: ${{ secrets.GH_PAT }} \n```\n\nå…³äº`JamesIves/github-pages-deploy-action@v4`æ›´å¤šé…ç½®å‚æ•°ï¼Œå‚è€ƒ[JamesIves/github-pages-deploy-action#configuration-](https://github.com/JamesIves/github-pages-deploy-action#configuration-)ã€‚\n\n## å‚è€ƒæ¥æº\n\n{% link avadhesh18 | rssTea: A lightweight RSS reader and podcast player PWA utilising GitHub Actions,https://github.com/avadhesh18/rssTea,https://github.com/fluidicon.png %}\n","tags":["æ’­å®¢","RSSWe","rssé˜…è¯»å™¨","RSSå’Œæ’­å®¢è®¢é˜…","GitHub Pages","GitHub Actions"],"categories":["æ¼«è°ˆ","RssWe"]},{"title":"Gitalkè‡ªåŠ¨åˆ›å»ºè¯„è®ºIssues","url":"/yyg/2eca17c7/","content":"\nåšå®¢åŠ å…¥Gitalkè¯„è®ºåï¼Œéœ€è¦è®¿é—®ç›¸åº”é¡µé¢ï¼Œæ‰åœ¨å­˜æ”¾è¯„è®ºçš„ä»“åº“åˆ›å»ºIssuesã€‚æœ¬æ–‡é€šè¿‡è„šæœ¬è‡ªåŠ¨è®¿é—®æ–‡ç« é¡µé¢å®ŒæˆGitalkè‡ªåŠ¨åˆ›å»ºè¯„è®ºIssuesã€‚è„šæœ¬è‡ª[attson/hexo-gitalk-init: Hexo gitalk æç®€åˆå§‹åŒ–è„šæœ¬](https://github.com/attson/hexo-gitalk-init)åŸºç¡€ä¸Šä¿®æ”¹è€Œæ¥ï¼ˆæ˜¯åœ¨windowsæœ¬åœ°è¿è¡Œï¼‰ã€‚\n\n{% tip info %}\n\nè¿™æ˜¯ä¸€ä¸ªç”¨äº Hexo åšå®¢çš„ Gitalk è¯„è®ºç³»ç»Ÿè‡ªåŠ¨åˆå§‹åŒ–è„šæœ¬ã€‚å®ƒèƒ½è‡ªåŠ¨æ‰«ææ‰€æœ‰æ–‡ç« ï¼Œè¯†åˆ«å‡ºå°šæœªåˆ›å»ºè¯„è®º Issue çš„é¡µé¢ï¼Œå¹¶é€šè¿‡æ¨¡æ‹Ÿæµè§ˆå™¨è®¿é—®æ¥è§¦å‘ Gitalk è‡ªåŠ¨å®Œæˆ Issue çš„åˆ›å»ºã€‚æ•´ä¸ªè¿‡ç¨‹ç»“åˆäº†ç¼“å­˜æœºåˆ¶ä¸ GitHub API æ£€æŸ¥ï¼Œç¡®ä¿é«˜æ•ˆä¸”å‡†ç¡®åœ°å®Œæˆæ‰¹é‡åˆå§‹åŒ–ã€‚\n\n{% endtip %}\n\n## åŠŸèƒ½æµç¨‹\n\n**åˆå§‹åŒ–é…ç½®**ï¼šè¯»å–é…ç½®æ–‡ä»¶æˆ–ç¯å¢ƒå˜é‡\n\n**æ£€æŸ¥ä¸»é¢˜é…ç½®**ï¼šç¡®ä¿ Gitalk æ˜¯ç¬¬ä¸€ä¸ªè¯„è®ºç³»ç»Ÿ\n\n**è¯»å–æ–‡ç« **ï¼šæ‰«ææŒ‡å®šç›®å½•ä¸‹çš„æ‰€æœ‰ Markdown æ–‡ä»¶\n\n**æ£€æŸ¥åˆå§‹åŒ–çŠ¶æ€**ï¼šé€šè¿‡æœ¬åœ°ç¼“å­˜æˆ– GitHub API æ£€æŸ¥æ–‡ç« æ˜¯å¦å·²åˆå§‹åŒ–ï¼ˆéœ€è¦ GitHub Personal Access Tokenï¼‰\n\n**æµè§ˆå™¨è®¿é—®**ï¼šè‡ªåŠ¨æ‰“å¼€æµè§ˆå™¨è®¿é—®æœªåˆå§‹åŒ–çš„æ–‡ç« é¡µé¢ï¼Œå®ŒæˆIssueåˆ›å»ºã€‚\n\n**æ›´æ–°ç¼“å­˜**ï¼šè®°å½•å·²å¤„ç†çš„æ–‡ç« \n\n## è‡ªå®šä¹‰é…ç½®é¡¹\n\n### é…ç½®é¡¹è¯´æ˜\n\nè¯¥è„šæœ¬çš„é…ç½®é¡¹å¯ä»¥é€šè¿‡ **é…ç½®æ–‡ä»¶** æˆ– **ç¯å¢ƒå˜é‡** ä¸¤ç§æ–¹å¼è®¾ç½®ã€‚é…ç½®æ–‡ä»¶`gitalk_init.conf`çš„è·¯å¾„æœ¬èº«ä¹Ÿå¯ä»¥é€šè¿‡ç¯å¢ƒå˜é‡ `GITALK_CONFIG_FILE` æŒ‡å®šã€‚\n\n**ä¼˜å…ˆçº§**ï¼šé…ç½®æ–‡ä»¶ä¸­çš„è®¾ç½®ä¼šè¦†ç›–åŒåçš„ç¯å¢ƒå˜é‡ã€‚å¦‚æœé…ç½®æ–‡ä»¶ä¸­æŸé¡¹æœªè®¾ç½®ï¼Œåˆ™ä½¿ç”¨ç¯å¢ƒå˜é‡æˆ–ä»£ç ä¸­å®šä¹‰çš„é»˜è®¤å€¼ã€‚\n\n### GitHub ç›¸å…³é…ç½®\n\nè¿™äº›é…ç½®é¡¹ç”¨äºè¿æ¥åˆ° GitHub ä»“åº“ï¼Œæ˜¯è„šæœ¬è¿è¡Œçš„æ ¸å¿ƒã€‚\n\n| é…ç½®é¡¹        | ç±»å‹  | æè¿°                                                   | é»˜è®¤å€¼                                   | ç¯å¢ƒå˜é‡                      | ç¤ºä¾‹                         |\n| ---------- | --- | ---------------------------------------------------- | ------------------------------------- | ------------------------- | -------------------------- |\n| `username` | å­—ç¬¦ä¸² | GitHub ç”¨æˆ·åæˆ–ç»„ç»‡åï¼Œå¯¹åº” Gitalk é…ç½®ä¸­çš„ `owner`ã€‚**(å¿…é€‰é¡¹)**      | `process.env.GITHUB_REPOSITORY_OWNER` | `GITHUB_REPOSITORY_OWNER` | `my-github-username`       |\n| `repo`     | å­—ç¬¦ä¸² | å­˜å‚¨è¯„è®ºçš„ GitHub ä»“åº“åï¼Œå¯¹åº” Gitalk é…ç½®ä¸­çš„ `repo`ã€‚**(å¿…é€‰é¡¹)**     | `${config.username}.github.io`        | `GITALK_INIT_REPO`        | `my-blog-repo`             |\n| `token`    | å­—ç¬¦ä¸² | GitHub Personal Access Tokenï¼Œéœ€è¦æœ‰ `repo` æƒé™ã€‚**(å¿…é€‰é¡¹)** | `process.env.GITALK_TOKEN`            | `GITALK_TOKEN`            | `ghp_xxxxxxxxxxxxxxxxxxxx` |\n\n> tokençš„è·å–å‚è€ƒæ–‡ç« [åœ¨Githubä¸Šä½¿ç”¨OsmosFeedæ­å»ºåœ¨çº¿RSSé˜…è¯»å™¨ï¼ˆæ— éœ€æœåŠ¡å™¨ï¼‰ | äº‘é‡é˜](https://yyg.js.cool/yyg/5ea27f40/)ä¸­çš„`è®¾ç½®èº«ä»½éªŒè¯ä»¤ç‰Œ`éƒ¨åˆ†ã€‚\n\n### ç¼“å­˜ç›¸å…³é…ç½®\n\nç¼“å­˜æœºåˆ¶å¯ä»¥é¿å…é‡å¤å¤„ç†å·²ç»åˆå§‹åŒ–è¿‡çš„æ–‡ç« ï¼Œæé«˜è„šæœ¬è¿è¡Œæ•ˆç‡ã€‚\n\n| é…ç½®é¡¹           | ç±»å‹  | æè¿°                                             | é»˜è®¤å€¼                                     | ç¯å¢ƒå˜é‡                       | ç¤ºä¾‹                                                 |\n| ------------- | --- | ---------------------------------------------- | --------------------------------------- | -------------------------- | -------------------------------------------------- |\n| `enableCache` | å¸ƒå°”å€¼ | æ˜¯å¦å¯ç”¨ç¼“å­˜åŠŸèƒ½ã€‚**(å¿…é€‰é¡¹)**                             | `true`                                  | `GITALK_INIT_CACHE`        | `true`                                             |\n| `cacheFile`   | å­—ç¬¦ä¸² | æœ¬åœ°ç¼“å­˜æ–‡ä»¶çš„å­˜å‚¨è·¯å¾„ã€‚                                   | `./public/gitalk-init-cache.json`       | `GITALK_INIT_CACHE_FILE`   | `gitalk-init-cache.json`                           |\n| `cacheRemote` | å­—ç¬¦ä¸² | è¿œç¨‹ç¼“å­˜æ–‡ä»¶çš„ URLã€‚è¯»å–ä¼˜å…ˆçº§ï¼š`cacheFile` > `cacheRemote`ã€‚ | `https://{repo}/gitalk-init-cache.json` | `GITALK_INIT_CACHE_REMOTE` | `https://my-repo.github.io/gitalk-init-cache.json` |\n\n### GitHub API ç›¸å…³é…ç½®\n\nå½“ç¼“å­˜æœªå‘½ä¸­æ—¶ï¼Œè„šæœ¬å¯ä»¥é€šè¿‡ GitHub API ç›´æ¥æ£€æŸ¥ Issue æ˜¯å¦å­˜åœ¨ï¼Œæä¾›æ›´ç²¾ç¡®çš„åˆ¤æ–­ã€‚\n\n| é…ç½®é¡¹                    | ç±»å‹  | æè¿°                                     | é»˜è®¤å€¼    | ç¯å¢ƒå˜é‡                             | ç¤ºä¾‹      |\n| ---------------------- | --- | -------------------------------------- | ------ | -------------------------------- | ------- |\n| `enableGithubApiCheck` | å¸ƒå°”å€¼ | æ˜¯å¦åœ¨ç¼“å­˜æœªå‘½ä¸­æ—¶ï¼Œé€šè¿‡ GitHub API æ£€æŸ¥ issue æ˜¯å¦å­˜åœ¨ã€‚ | `true` | `GITALK_ENABLE_GITHUB_API_CHECK` | `true`  |\n| `githubApiTimeout`     | æ•°å­—  | GitHub API è¯·æ±‚çš„è¶…æ—¶æ—¶é—´ï¼ˆæ¯«ç§’ï¼‰ã€‚                | `5000` | `GITALK_GITHUB_API_TIMEOUT`      | `10000` |\n\n### æ–‡ç« ä¸åšå®¢é…ç½®\n\nè¿™äº›é…ç½®é¡¹ç”¨äºå®šä½æ‚¨çš„æ–‡ç« æºæ–‡ä»¶ï¼Œå¹¶æ­£ç¡®ç”Ÿæˆæ–‡ç« çš„è®¿é—®é“¾æ¥ã€‚\n\n| é…ç½®é¡¹             | ç±»å‹  | æè¿°                                              | é»˜è®¤å€¼              | ç¯å¢ƒå˜é‡                    | ç¤ºä¾‹                      |\n| --------------- | --- | ----------------------------------------------- | ---------------- | ----------------------- | ----------------------- |\n| `postsDir`      | å­—ç¬¦ä¸² | Hexo åšå®¢æ–‡ç« æºæ–‡ä»¶çš„ç›®å½•è·¯å¾„ã€‚**(å¿…é€‰é¡¹)**                     | `source/_posts`  | `GITALK_INIT_POSTS_DIR` | `source/_posts`         |\n| `hexoUrl`       | å­—ç¬¦ä¸² | Hexo åšå®¢çš„å®Œæ•´ URLï¼Œç”¨äºç”Ÿæˆæ–‡ç« çš„è®¿é—®é“¾æ¥ã€‚**(å¿…é€‰é¡¹)**            | `https://{repo}` | `HEXO_URL`              | `https://my-blog.com`   |\n| `hexoPermalink` | å­—ç¬¦ä¸² | Hexo çš„æ°¸ä¹…é“¾æ¥æ ¼å¼ï¼Œç”¨äºæ ¹æ®æ–‡ç« å…ƒæ•°æ®ç”Ÿæˆå”¯ä¸€çš„è®¿é—®è·¯å¾„ï¼Œæµè§ˆå™¨è®¿é—®ã€‚**(å¿…é€‰é¡¹)** | `:abbrlink.html` | `HEXO_PERMALINK`        | `:category/:title.html` |\n\n### æµè§ˆå™¨è‡ªåŠ¨åŒ–é…ç½®\n\n> **æ³¨æ„**ï¼šæ­¤éƒ¨åˆ†åŠŸèƒ½ä»…åœ¨ **Windows å¹³å°** ä¸Šæœ‰æ•ˆã€‚\n\nè¿™äº›é…ç½®é¡¹æ§åˆ¶è„šæœ¬æ˜¯å¦è‡ªåŠ¨æ‰“å¼€æµè§ˆå™¨è®¿é—®æ–°æ–‡ç« é¡µé¢ï¼Œä»¥è§¦å‘ Gitalk çš„åˆå§‹åŒ–ã€‚\n\n| é…ç½®é¡¹                   | ç±»å‹  | æè¿°                                 | é»˜è®¤å€¼     | ç¯å¢ƒå˜é‡                           | ç¤ºä¾‹     |\n| --------------------- | --- | ---------------------------------- | ------- | ------------------------------ | ------ |\n| `openInBrowser`       | å¸ƒå°”å€¼ | æ˜¯å¦åœ¨å‘ç°æ–°æ–‡ç« åï¼Œè‡ªåŠ¨æ‰“å¼€æµè§ˆå™¨è®¿é—®æ–‡ç« é¡µé¢ã€‚**(å¿…é€‰é¡¹)**  | `false` | `GITALK_OPEN_IN_BROWSER`       | `true` |\n| `maxPagesToOpen`      | æ•°å­—  | æ¯æ¬¡è¿è¡Œè„šæœ¬æ—¶ï¼Œæœ€å¤šæ‰“å¼€çš„æ–‡ç« é¡µé¢æ•°é‡ã€‚`0` è¡¨ç¤ºå¤„ç†æ‰€æœ‰æ–°æ–‡ç« ã€‚ | `0`     | `GITALK_MAX_PAGES_TO_OPEN`     | `20`   |\n| `browserWaitTime`     | æ•°å­—  | åœ¨æµè§ˆå™¨ä¸­æ‰“å¼€æ¯ä¸ªé¡µé¢åï¼Œç­‰å¾…çš„æ—¶é•¿ï¼ˆæ¯«ç§’ï¼‰ã€‚            | `3000`  | `GITALK_BROWSER_WAIT_TIME`     | `5000` |\n| `mouseActiveTime`     | æ•°å­—  | åœ¨é¡µé¢ä¸Šæ¨¡æ‹Ÿé¼ æ ‡æ´»åŠ¨çš„æ—¶é•¿ï¼ˆæ¯«ç§’ï¼‰ã€‚                 | `2000`  | `GITALK_MOUSE_ACTIVE_TIME`     | `3000` |\n| `enableMouseMovement` | å¸ƒå°”å€¼ | æ˜¯å¦åœ¨é¡µé¢ä¸Šæ¨¡æ‹Ÿé¼ æ ‡ç§»åŠ¨ï¼Œä»¥ç¡®ä¿é¡µé¢è¢«å……åˆ†æ¿€æ´»ã€‚           | `true`  | `GITALK_ENABLE_MOUSE_MOVEMENT` | `true` |\n\n### ä¸»é¢˜é…ç½®\n\næ­¤é…ç½®é¡¹ç”¨äºæŒ‡å®š Butterfly ä¸»é¢˜çš„é…ç½®æ–‡ä»¶è·¯å¾„ï¼Œä»¥ä¾¿è„šæœ¬æ£€æŸ¥è¯„è®ºç³»ç»Ÿè®¾ç½®ã€‚\n\n| é…ç½®é¡¹                   | ç±»å‹  | æè¿°                                                  | é»˜è®¤å€¼                     | ç¯å¢ƒå˜é‡                    | ç¤ºä¾‹                           |\n| --------------------- | --- | --------------------------------------------------- | ----------------------- | ----------------------- | ---------------------------- |\n| `butterflyConfigPath` | å­—ç¬¦ä¸² | Butterfly ä¸»é¢˜é…ç½®æ–‡ä»¶è·¯å¾„ï¼Œç”¨äºæ£€æŸ¥ `comments.use` è®¾ç½®ã€‚**(å¿…é€‰é¡¹)** | `_config.butterfly.yml` | `BUTTERFLY_CONFIG_PATH` | `source/_data/butterfly.yml` |\n\n## å®ç°æ–¹å¼\n\nåœ¨ç›®å½•ä¸­åˆ›å»º`gitalk_init.conf`ï¼ŒåŠ å…¥é…ç½®é¡¹ï¼ˆå¯åŠ è‡ªé€‰ï¼‰ã€‚\n\n```conf\nusername=xxx\nrepo=xxx\ntoken=xxxxxxxxxxxxxxx\nenableCache=true\nopenInBrowser=true\ncacheFile=gitalk-init-cache.jsonè·¯å¾„\nhexoUrl=\nhexoPermalink=\npostsDir=\nconfigFile=gitalk_init.confè·¯å¾„\nbutterflyConfigPath=_config.butterfly.ymlè·¯å¾„\n```\n\nåœ¨ç›®å½•ä¸­åˆ›å»º`gitalk_init.js`ï¼ŒåŠ å…¥ä»¥ä¸‹å†…å®¹ã€‚\n\n```js\nconst fs = require('fs');\nconst path = require('path');\nconst readline = require('readline');\nconst https = require('https'); // ç”¨äº GitHub API è¯·æ±‚\nconst { exec } = require('child_process'); // ç”¨äºæ‰§è¡Œç³»ç»Ÿå‘½ä»¤\nconst { promisify } = require('util');\nconst execPromise = promisify(exec);\n\nlet config = {}\n\n// æ–°å¢ï¼šä»ç¯å¢ƒå˜é‡è·å–é…ç½®æ–‡ä»¶è·¯å¾„ï¼Œé»˜è®¤ä¸ºè„šæœ¬åŒç›®å½•ä¸‹çš„ gitalk_init.conf\nconst configFilePath = process.env.GITALK_CONFIG_FILE || path.join(__dirname, 'gitalk_init.conf');\n\n// ä¿®æ”¹ï¼šä½¿ç”¨å¯é…ç½®çš„è·¯å¾„è€Œä¸æ˜¯å›ºå®šçš„è·¯å¾„\nif (fs.existsSync(configFilePath)) {\n    // è¯»å– .conf æ–‡ä»¶å†…å®¹\n    const configContent = fs.readFileSync(configFilePath).toString('utf-8');\n\n    // è§£æé…ç½®æ–‡ä»¶å†…å®¹ï¼ˆå‡è®¾æ˜¯é”®å€¼å¯¹æ ¼å¼ï¼Œæ¯è¡Œä¸€ä¸ªé…ç½®ï¼Œæ ¼å¼ä¸º key=valueï¼‰\n    const configLines = configContent.split('\\n');\n    for (const line of configLines) {\n        // è·³è¿‡ç©ºè¡Œå’Œæ³¨é‡Šè¡Œï¼ˆä»¥ # å¼€å¤´ï¼‰\n        if (line.trim() === '' || line.trim().startsWith('#')) {\n            continue;\n        }\n\n        // åˆ†å‰²é”®å€¼å¯¹\n        const [key, ...valueParts] = line.split('=');\n        if (key && valueParts.length > 0) {\n            const value = valueParts.join('=').trim();\n\n            // å¤„ç†ç¯å¢ƒå˜é‡å¼•ç”¨\n            const reg = /{process\\.env\\.[a-zA-Z_\\-]}*/gm;\n            const match = value.match(reg);\n\n            if (match) {\n                match.forEach(matchItem => {\n                    const envKey = matchItem.substring(13, matchItem.length - 1);\n                    if (process.env[envKey]) {\n                        config[key.trim()] = value.replace(matchItem, process.env[envKey]);\n                    } else {\n                        config[key.trim()] = value;\n                    }\n                });\n            } else {\n                config[key.trim()] = value;\n            }\n\n            // å°†å­—ç¬¦ä¸²å€¼è½¬æ¢ä¸ºé€‚å½“çš„ç±»å‹\n            if (config[key.trim()] === 'true') {\n                config[key.trim()] = true;\n            } else if (config[key.trim()] === 'false') {\n                config[key.trim()] = false;\n            } else if (!isNaN(config[key.trim()]) && config[key.trim()].trim() !== '') {\n                config[key.trim()] = Number(config[key.trim()]);\n            }\n        }\n    }\n\n    // è¾“å‡ºä½¿ç”¨çš„é…ç½®æ–‡ä»¶è·¯å¾„\n    console.log('');\n    console.log(`\\x1b[32m%s\\x1b[0m`, `ä½¿ç”¨é…ç½®æ–‡ä»¶: ${configFilePath}`);\n} else {\n    // é…ç½®æ–‡ä»¶ä¸å­˜åœ¨æ—¶çš„æç¤º\n    console.log(`\\x1b[33m%s\\x1b[0m`, `é…ç½®æ–‡ä»¶ä¸å­˜åœ¨: ${configFilePath}ï¼Œå°†ä½¿ç”¨é»˜è®¤é…ç½®æˆ–ç¯å¢ƒå˜é‡`);\n\n    // é…ç½®ä¿¡æ¯\n    config = {\n        // GitHub repository æ‰€æœ‰è€…ï¼Œå¯ä»¥æ˜¯ä¸ªäººæˆ–è€…ç»„ç»‡ã€‚å¯¹åº”Gitalké…ç½®ä¸­çš„owner\n        username: process.env.GITHUB_REPOSITORY_OWNER,\n\n        // å‚¨å­˜è¯„è®ºissueçš„githubä»“åº“åï¼Œä»…éœ€è¦ä»“åº“åå­—å³å¯ã€‚å¯¹åº” Gitalké…ç½®ä¸­çš„repo\n        repo: process.env.GITALK_INIT_REPO,\n\n        // ä» GitHub çš„ Personal access tokens é¡µé¢ï¼Œç‚¹å‡» Generate new token\n        token: process.env.GITALK_TOKEN,\n\n        // æ˜¯å¦å¯ç”¨ç¼“å­˜ï¼Œå¯ç”¨ç¼“å­˜ä¼šå°†å·²ç»åˆå§‹åŒ–çš„æ•°æ®å†™å…¥é…ç½®çš„ outputCacheFile æ–‡ä»¶ï¼Œä¸‹ä¸€æ¬¡ç›´æ¥é€šè¿‡ç¼“å­˜æ–‡ä»¶ outputCacheFile åˆ¤æ–­\n        enableCache: process.env.GITALK_INIT_CACHE !== undefined ? process.env.GITALK_INIT_CACHE === 'true' : true,\n        // ç¼“å­˜æ–‡ä»¶è¾“å‡ºçš„ä½ç½®\n        cacheFile: process.env.GITALK_INIT_CACHE_FILE || path.join(__dirname, './public/gitalk-init-cache.json'),\n\n        // åªç”¨äºè·å–ç¼“å­˜çš„æ¥æºï¼Œç¼“å­˜ä»ç„¶ä¼šå†™åˆ° cacheFile. è¯»å–ä¼˜å…ˆçº§ cacheFile > cacheRemote. æ•…cacheFileæ–‡ä»¶å­˜åœ¨æ—¶ï¼Œå¿½ç•¥ cacheRemote\n        cacheRemote: process.env.GITALK_INIT_CACHE_REMOTE,\n\n        // æ˜¯å¦ä½¿ç”¨ GitHub API æ£€æŸ¥ issue æ˜¯å¦å­˜åœ¨ï¼Œå¦‚æœå¯ç”¨ï¼Œåˆ™ä¼šåœ¨ç¼“å­˜æœªå‘½ä¸­æ—¶é€šè¿‡ API æ£€æŸ¥\n        enableGithubApiCheck: process.env.GITALK_ENABLE_GITHUB_API_CHECK !== undefined ? \n                              process.env.GITALK_ENABLE_GITHUB_API_CHECK === 'true' : true,\n\n        // GitHub API è¯·æ±‚è¶…æ—¶æ—¶é—´ï¼ˆæ¯«ç§’ï¼‰\n        githubApiTimeout: process.env.GITALK_GITHUB_API_TIMEOUT || 5000,\n\n        postsDir: process.env.GITALK_INIT_POSTS_DIR || 'source/_posts',\n\n        // Hexoåšå®¢URLï¼Œå¯é€šè¿‡ç¯å¢ƒå˜é‡æˆ–é…ç½®æ–‡ä»¶è®¾ç½®\n        hexoUrl: process.env.HEXO_URL,\n\n        // Hexo permalinkæ ¼å¼ï¼Œå¯é€šè¿‡ç¯å¢ƒå˜é‡æˆ–é…ç½®æ–‡ä»¶è®¾ç½®\n        hexoPermalink: process.env.HEXO_PERMALINK || ':abbrlink.html',\n\n        // æ˜¯å¦åœ¨æµè§ˆå™¨ä¸­æ‰“å¼€æ–‡ç« é¡µé¢\n        openInBrowser: process.env.GITALK_OPEN_IN_BROWSER !== undefined ? \n                       process.env.GITALK_OPEN_IN_BROWSER === 'true' : false,\n\n        // æµè§ˆå™¨ä¸­æ‰“å¼€é¡µé¢åç­‰å¾…çš„æ—¶é—´ï¼ˆæ¯«ç§’ï¼‰\n        browserWaitTime: process.env.GITALK_BROWSER_WAIT_TIME || 3000,\n\n        // æ¯ä¸ªé¡µé¢æ‰“å¼€åé¼ æ ‡æ´»åŠ¨çš„æ—¶é—´ï¼ˆæ¯«ç§’ï¼‰\n        mouseActiveTime: process.env.GITALK_MOUSE_ACTIVE_TIME || 2000,\n\n        // æ˜¯å¦åœ¨æ¯ä¸ªé¡µé¢ä¸Šæ¨¡æ‹Ÿé¼ æ ‡ç§»åŠ¨\n        enableMouseMovement: process.env.GITALK_ENABLE_MOUSE_MOVEMENT !== undefined ? \n                            process.env.GITALK_ENABLE_MOUSE_MOVEMENT === 'true' : true,\n\n        // æ–°å¢ï¼šæ¯æ¬¡æ‰“å¼€çš„æ–‡ç« é¡µé¢ä¸ªæ•°ï¼Œé»˜è®¤ä¸ºæ‰€æœ‰é¡µé¢\n        maxPagesToOpen: process.env.GITALK_MAX_PAGES_TO_OPEN || 0,\n\n        // æ–°å¢ï¼šButterfly ä¸»é¢˜é…ç½®æ–‡ä»¶è·¯å¾„\n        butterflyConfigPath: process.env.BUTTERFLY_CONFIG_PATH || '_config.butterfly.yml'\n    };\n}\n\nfunction configInit(config) {\n    if (config.repo === undefined) {\n        config.repo = `${config.username}.github.io`\n    }\n\n    if (config.cacheRemote === undefined) {\n        config.cacheRemote = `https://${config.repo}/gitalk-init-cache.json`\n    }\n\n    if (config.postsDir === undefined) {\n        config.postsDir = 'source/_posts'\n    }\n\n    if (config.cacheFile === undefined) {\n        config.cacheFile = path.join(__dirname, './public/gitalk-init-cache.json')\n    }\n\n    if (config.enableCache === undefined) {\n        config.enableCache = true\n    }\n\n    if (config.enableGithubApiCheck === undefined) {\n        config.enableGithubApiCheck = true\n    }\n\n    if (config.githubApiTimeout === undefined) {\n        config.githubApiTimeout = 5000\n    }\n\n    // ç¡®ä¿æœ‰å¿…è¦çš„Hexoé…ç½®\n    if (!config.hexoUrl) {\n        console.warn('æœªè®¾ç½®Hexo URLï¼Œå°†ä½¿ç”¨é»˜è®¤å€¼');\n        config.hexoUrl = `https://${config.repo}`;\n    }\n\n    if (!config.hexoPermalink) {\n        console.warn('æœªè®¾ç½®Hexo Permalinkï¼Œå°†ä½¿ç”¨é»˜è®¤å€¼');\n        config.hexoPermalink = ':abbrlink.html';\n    }\n\n    if (config.openInBrowser === undefined) {\n        config.openInBrowser = false;\n    }\n\n    if (config.browserWaitTime === undefined) {\n        config.browserWaitTime = 3000;\n    }\n\n    if (config.mouseActiveTime === undefined) {\n        config.mouseActiveTime = 2000;\n    }\n\n    if (config.enableMouseMovement === undefined) {\n        config.enableMouseMovement = true;\n    }\n\n    // æ–°å¢ï¼šç¡®ä¿maxPagesToOpenæœ‰å€¼\n    if (config.maxPagesToOpen === undefined || config.maxPagesToOpen < 0) {\n        config.maxPagesToOpen = 0; // 0 è¡¨ç¤ºæ‰“å¼€æ‰€æœ‰é¡µé¢\n    }\n\n    // æ–°å¢ï¼šç¡®ä¿butterflyConfigPathæœ‰å€¼\n    if (config.butterflyConfigPath === undefined) {\n        config.butterflyConfigPath = '_config.butterfly.yml';\n    }\n}\n\nconfigInit(config)\n\n// æ–°å¢ï¼šç®€å•è§£æ Butterfly ä¸»é¢˜é…ç½®æ–‡ä»¶ï¼Œè·å– comments.use é…ç½®\nfunction getButterflyCommentsConfig() {\n    try {\n        // æ£€æŸ¥æ–‡ä»¶æ˜¯å¦å­˜åœ¨\n        if (!fs.existsSync(config.butterflyConfigPath)) {\n            console.log('')\n            console.log(`\\x1b[31m%s\\x1b[0m`, `Butterfly ä¸»é¢˜é…ç½®æ–‡ä»¶ä¸å­˜åœ¨ï¼Œè¯·æ£€æŸ¥${config.butterflyConfigPath}æ–‡ä»¶è·¯å¾„`);\n            return null;\n        }\n\n        // è¯»å–æ–‡ä»¶å†…å®¹\n        const content = fs.readFileSync(config.butterflyConfigPath, 'utf8');\n        const lines = content.split('\\n');\n\n        let inCommentsSection = false;\n        let foundUse = false;\n        let useValue = '';\n\n        // éå†æ¯ä¸€è¡Œ\n        for (const line of lines) {\n            const trimmedLine = line.trim();\n\n            // æ£€æŸ¥æ˜¯å¦è¿›å…¥ comments éƒ¨åˆ†\n            if (trimmedLine === 'comments:') {\n                inCommentsSection = true;\n                continue;\n            }\n\n            // å¦‚æœå·²ç»æ‰¾åˆ° use é…ç½®ï¼Œåˆ™é€€å‡ºå¾ªç¯\n            if (foundUse) {\n                break;\n            }\n\n            // å¦‚æœåœ¨ comments éƒ¨åˆ†ï¼Œå¹¶ä¸”å½“å‰è¡Œæ˜¯ use é…ç½®\n            if (inCommentsSection && trimmedLine.startsWith('use:')) {\n                foundUse = true;\n\n                // æå– use çš„å€¼\n                const match = trimmedLine.match(/^use:\\s*(.+)$/);\n                if (match && match[1]) {\n                    useValue = match[1].trim();\n\n                    // å¦‚æœå€¼ä»¥å¼•å·å¼€å¤´å’Œç»“å°¾ï¼Œåˆ™å»é™¤å¼•å·\n                    if ((useValue.startsWith(\"'\") && useValue.endsWith(\"'\")) || \n                        (useValue.startsWith('\"') && useValue.endsWith('\"'))) {\n                        useValue = useValue.substring(1, useValue.length - 1);\n                    }\n                }\n            }\n\n            // å¦‚æœé‡åˆ°ä¸ comments åŒçº§çš„å…¶ä»–é…ç½®ï¼Œåˆ™é€€å‡º comments éƒ¨åˆ†\n            if (inCommentsSection && trimmedLine && !trimmedLine.startsWith(' ') && !trimmedLine.startsWith('\\t') && !trimmedLine.startsWith('#')) {\n                if (trimmedLine !== 'comments:') {\n                    inCommentsSection = false;\n                }\n            }\n        }\n\n        if (!foundUse) {\n            console.log(`\\x1b[31m%s\\x1b[0m`, `åœ¨ ${config.butterflyConfigPath} ä¸­æœªæ‰¾åˆ° comments.use é…ç½®`);\n            return null;\n        }\n\n        return useValue;\n\n    } catch (error) {\n        console.log(`\\x1b[31m%s\\x1b[0m`, `è§£æ Butterfly ä¸»é¢˜é…ç½®æ–‡ä»¶æ—¶å‡ºé”™: ${error.message}`);\n        return null;\n    }\n}\n\n// æ–°å¢ï¼šæ£€æŸ¥ Butterfly ä¸»é¢˜é…ç½®æ–‡ä»¶ä¸­çš„è¯„è®ºç³»ç»Ÿè®¾ç½®\nfunction checkButterflyCommentsConfig() {\n    // è·å– comments.use é…ç½®å€¼\n    const commentsUse = getButterflyCommentsConfig();\n\n    if (!commentsUse) {\n        return false;\n    }\n\n    // åˆ†å‰²è¯„è®ºç³»ç»Ÿåˆ—è¡¨\n    const commentSystems = commentsUse.split(',').map(s => s.trim());\n\n    // æ£€æŸ¥ Gitalk æ˜¯å¦åœ¨è¯„è®ºç³»ç»Ÿä¸­\n    const gitalkIndex = commentSystems.indexOf('Gitalk');\n\n    if (gitalkIndex === -1) {\n        console.log(`\\x1b[31m%s\\x1b[0m`, `Gitalk ä¸åœ¨å½“å‰å¯ç”¨çš„è¯„è®ºç³»ç»Ÿä¸­ã€‚å½“å‰å¯ç”¨çš„è¯„è®ºç³»ç»Ÿ: ${commentSystems.join(', ')}`);\n        console.log(`\\x1b[33m%s\\x1b[0m`, `è¯·ä¿®æ”¹ ${config.butterflyConfigPath} æ–‡ä»¶ä¸­çš„ comments.use é…ç½®ï¼Œå°† Gitalk è®¾ä¸ºç¬¬ä¸€ä¸ªè¯„è®ºç³»ç»Ÿ`);\n        return false;\n    }\n\n    if (gitalkIndex !== 0) {\n        console.log(`\\x1b[33m%s\\x1b[0m`, `Gitalk ä¸æ˜¯ç¬¬ä¸€ä¸ªè¯„è®ºç³»ç»Ÿï¼ˆå½“å‰æ˜¯ç¬¬ ${gitalkIndex + 1} ä¸ªï¼‰ã€‚å½“å‰å¯ç”¨çš„è¯„è®ºç³»ç»Ÿ: ${commentSystems.join(', ')}`);\n        console.log(`\\x1b[33m%s\\x1b[0m`, `è¯·ä¿®æ”¹ ${config.butterflyConfigPath} æ–‡ä»¶ä¸­çš„ comments.use é…ç½®ï¼Œå°† Gitalk è®¾ä¸ºç¬¬ä¸€ä¸ªè¯„è®ºç³»ç»Ÿ`);\n        return false;\n    }\n    console.log('')\n    console.log(`\\x1b[32m%s\\x1b[0m`, `Gitalkæ˜¯æ‰€é€‰è¯„è®ºç³»ç»Ÿï¼Œè„šæœ¬å°†ç»§ç»­æ‰§è¡Œ`);\n    return true;\n}\n\nconst autoGitalkInit = {\n    gitalkCache: null,\n    getFiles (dir, files_) {\n        files_ = files_ || [];\n        const files = fs.readdirSync(dir);\n        for (let i in files) {\n            let name = dir + '/' + files[i];\n            if (fs.statSync(name).isDirectory()) {\n                this.getFiles(name, files_);\n            } else {\n                if (name.endsWith('.md')) {\n                    files_.push(name);\n                }\n            }\n        }\n        return files_;\n    },\n    async readItem(file) {\n        const fileStream = fs.createReadStream(file);\n\n        const rl = readline.createInterface({\n            input: fileStream,\n            crlfDelay: Infinity,\n        });\n        // Note: we use the crlfDelay option to recognize all instances of CR LF\n        // ('\\r\\n') in input.txt as a single line break.\n\n        let start = false;\n        let frontMatterEnded = false;\n        let post = {};\n\n        for await (const line of rl) {\n            if (!frontMatterEnded) {\n                if (start === true) {\n                    if (line.trim() === '---') {\n                        frontMatterEnded = true;\n                        continue;\n                    }\n                    const items = line.split(':')\n                    // è§£ææ‰€æœ‰å¯èƒ½ç”¨åˆ°çš„å­—æ®µ\n                    const key = items[0].trim();\n                    if (key && items.length > 1) {\n                        // å»é™¤å€¼ä¸¤ç«¯çš„å¼•å·å’Œç©ºæ ¼\n                        let value = items.slice(1).join(':').trim();\n                        if ((value.startsWith(\"'\") && value.endsWith(\"'\")) || \n                            (value.startsWith('\"') && value.endsWith('\"'))) {\n                            value = value.substring(1, value.length - 1);\n                        }\n                        post[key] = value;\n                    }\n                } else {\n                    if (line.trim() === '---') {\n                        start = true\n                    }\n                }\n            }\n        }\n\n        fileStream.close()\n\n        if (Object.keys(post).length === 0) {\n            console.log(`\\x1b[33m%s\\x1b[0m`, `gitalk: warn read empty from: ${file}`);\n            return null\n        }\n        if (post['comment'] === false || post['comment'] === 'false') {\n            console.log(`\\x1b[36m%s\\x1b[0m`, `gitalk: ignore by comment = ${post['comment']} : ${file}`);\n            return null\n        }\n\n        if (!('title' in post)) {\n            console.log(`\\x1b[31m%s\\x1b[0m`, `gitalk: ignore because the title miss: ${file}`);\n            return null\n        }\n\n        // å¦‚æœpermalinkæ ¼å¼åŒ…å«:abbrlinkä½†æ²¡æœ‰abbrlinkå­—æ®µï¼Œåˆ™å¿½ç•¥\n        if (config.hexoPermalink.includes(':abbrlink') && !('abbrlink' in post)) {\n            console.log('')\n            console.log(`\\x1b[31m%s\\x1b[0m`, `gitalkå¿½ç•¥${file},å› ä¸ºç¼ºå°‘abbrlinkï¼Œå®ƒéœ€è¦æ°¸ä¹…é“¾æ¥`);\n            return null\n        }\n\n        // è®¾ç½®é»˜è®¤å€¼\n        if (!('date' in post)) {\n            post['date'] = new Date().toISOString();\n        }\n        if (!('categories' in post)) {\n            post['categories'] = [];\n        }\n        if (!('tags' in post)) {\n            post['tags'] = [];\n        }\n\n        return post\n    },\n\n    async readPosts(dir) {\n        const posts = [];\n        for (let file of this.getFiles(dir)) {\n            const post = await this.readItem(file);\n            if (post != null) {\n                posts.push(post)\n            }\n        }\n\n        return posts\n    },\n\n    /**\n     * é€šè¿‡è¿œç¨‹åœ°å€è·å–ç¼“å­˜å†…å®¹\n     * @returns {Promise<Object>}\n     */\n    getRemoteCache() {\n        return new Promise((resolve, reject) => {\n            const req = https.get(config.cacheRemote, function (res) {\n                const chunks = [];\n\n                res.on('data', function (chunk) {\n                    chunks.push(chunk);\n                });\n\n                res.on('end', function () {\n                    try {\n                        return resolve(JSON.parse(Buffer.concat(chunks).toString()));\n                    } catch (e) {\n                        return reject(e);\n                    }\n                });\n\n                res.on('error', function (error) {\n                    return reject(error);\n                });\n            });\n\n            req.end();\n        })\n    },\n\n    /**\n     * é€šè¿‡ GitHub API æ£€æŸ¥ issue æ˜¯å¦å­˜åœ¨\n     * @param {string} title issue æ ‡é¢˜ï¼ˆæ–‡ç« æ ‡é¢˜ï¼‰\n     * @returns {Promise<boolean>} true è¡¨ç¤º issue å·²å­˜åœ¨ï¼Œfalse è¡¨ç¤ºä¸å­˜åœ¨\n     */\n    async checkIssueByGithubAPI(title) {\n        if (!config.enableGithubApiCheck || !config.token || !config.username || !config.repo) {\n            return false;\n        }\n\n        return new Promise((resolve) => {\n            // æ„é€  API è¯·æ±‚ URL\n            const apiUrl = `https://api.github.com/repos/${config.username}/${config.repo}/issues?state=all`;\n\n            const options = {\n                headers: {\n                    'User-Agent': 'gitalk-init',\n                    'Authorization': `token ${config.token}`,\n                    'Accept': 'application/vnd.github.v3+json'\n                },\n                timeout: config.githubApiTimeout\n            };\n\n            const req = https.get(apiUrl, options, (res) => {\n                let data = '';\n\n                res.on('data', (chunk) => {\n                    data += chunk;\n                });\n\n                res.on('end', () => {\n                    try {\n                        if (res.statusCode === 200) {\n                            const issues = JSON.parse(data);\n                            // æ£€æŸ¥æ˜¯å¦æœ‰åŒ¹é…æ ‡é¢˜çš„ issue\n                            const exists = issues.some(issue => issue.title === title);\n                            resolve(exists);\n                        } else {\n                            console.log(`\\x1b[33m%s\\x1b[0m`, `GitHub API è¯·æ±‚å¤±è´¥ï¼ŒçŠ¶æ€ç : ${res.statusCode}`);\n                            resolve(false);\n                        }\n                    } catch (error) {\n                        console.log(`\\x1b[31m%s\\x1b[0m`, `è§£æ GitHub API å“åº”å¤±è´¥: ${error.message}`);\n                        resolve(false);\n                    }\n                });\n            });\n\n            req.on('error', (error) => {\n                console.log(`\\x1b[31m%s\\x1b[0m`, `GitHub API è¯·æ±‚é”™è¯¯: ${error.message}`);\n                resolve(false);\n            });\n\n            req.on('timeout', () => {\n                console.log(`\\x1b[33m%s\\x1b[0m`, `GitHub API è¯·æ±‚è¶…æ—¶`);\n                req.destroy();\n                resolve(false);\n            });\n\n            req.end();\n        });\n    },\n\n    /**\n     * é€šè¿‡ç¼“å­˜åˆ¤æ–­æ˜¯å¦å·²ç»åˆå§‹åŒ–, ä¼˜å…ˆåŠ è½½ç¼“å­˜æ–‡ä»¶ï¼Œæ–‡ä»¶ä¸å­˜åœ¨åˆ™å°è¯•ä» cacheRemote è·å–\n     * å¦‚æœç¼“å­˜ä¸­ä¸å­˜åœ¨ä¸”å¯ç”¨äº† GitHub API æ£€æŸ¥ï¼Œåˆ™é€šè¿‡ API æ£€æŸ¥ issue æ˜¯å¦å­˜åœ¨\n     * @param {string} pathname æ–‡ç« è·¯å¾„\n     * @param {string} title æ–‡ç« æ ‡é¢˜ï¼ˆç”¨äº GitHub API æ£€æŸ¥ï¼‰\n     * @return {Promise<boolean>} false è¡¨ç¤ºæ²¡åˆå§‹åŒ–ï¼Œ true è¡¨ç¤ºå·²ç»åˆå§‹åŒ–\n     */\n    async getIsInitByCache(pathname, title){\n        let isInitialized = false;\n\n        // é¦–å…ˆæ£€æŸ¥æœ¬åœ°ç¼“å­˜\n        if (this.gitalkCache === null) {\n            // åˆ¤æ–­ç¼“å­˜æ–‡ä»¶æ˜¯å¦å­˜åœ¨\n            this.gitalkCache = false;\n            try {\n                this.gitalkCache = JSON.parse(fs.readFileSync(config.cacheFile).toString('utf-8'));\n                console.log('')\n                console.log(`\\x1b[32m%s\\x1b[0m`, 'è¯»å–ç¼“å­˜æ–‡ä»¶æˆåŠŸ ' + config.cacheFile)\n                console.log('')\n            } catch (e) {\n                console.log('')\n                // æ£€æŸ¥é”™è¯¯ç±»å‹ï¼Œå¦‚æœæ˜¯æ–‡ä»¶ä¸å­˜åœ¨ï¼Œåˆ™åˆ›å»ºç©ºç¼“å­˜æ–‡ä»¶\n                if (e.code === 'ENOENT') {\n                    console.log(`\\x1b[33m%s\\x1b[0m`, 'ç¼“å­˜æ–‡ä»¶ä¸å­˜åœ¨ï¼Œæ­£åœ¨åˆ›å»ºç©ºç¼“å­˜æ–‡ä»¶: ' + config.cacheFile);\n                    try {\n                        // ç¡®ä¿ç›®å½•å­˜åœ¨\n                        const dir = path.dirname(config.cacheFile);\n                        if (!fs.existsSync(dir)) {\n                            fs.mkdirSync(dir, { recursive: true });\n                        }\n                        // åˆ›å»ºç©ºç¼“å­˜æ–‡ä»¶\n                        fs.writeFileSync(config.cacheFile, '[]', 'utf8');\n                        this.gitalkCache = [];\n                        console.log(`\\x1b[32m%s\\x1b[0m`, 'æˆåŠŸåˆ›å»ºç©ºç¼“å­˜æ–‡ä»¶: ' + config.cacheFile);\n                        console.log('');\n                    } catch (createError) {\n                        console.log(`\\x1b[31m%s\\x1b[0m`, 'åˆ›å»ºç¼“å­˜æ–‡ä»¶å¤±è´¥: ' + createError.message);\n                        console.log(`\\x1b[31m%s\\x1b[0m`, 'ç¼“å­˜æ–‡ä»¶è·¯å¾„: ' + config.cacheFile);\n                        console.log('');\n                    }\n                } else {\n                    // å¦‚æœæ˜¯å…¶ä»–é”™è¯¯ï¼Œè¾“å‡ºé”™è¯¯ä¿¡æ¯å’Œè·¯å¾„\n                    console.log(`\\x1b[31m%s\\x1b[0m`, 'è¯»å–ç¼“å­˜æ–‡ä»¶å¤±è´¥: ' + e.message);\n                    console.log(`\\x1b[31m%s\\x1b[0m`, 'ç¼“å­˜æ–‡ä»¶è·¯å¾„: ' + config.cacheFile);\n                    console.log('');\n\n                    if (config.cacheRemote) {\n                        console.log('')\n                        console.log(`\\x1b[90m%s\\x1b[0m`, 'æ­£åœ¨ä» ' + config.cacheRemote + ' è¯»å–æ–‡ä»¶')\n                        console.log('')\n                        try {\n                            this.gitalkCache = await this.getRemoteCache()\n                            console.log('')\n                            console.log(`\\x1b[32m%s\\x1b[0m`, 'è¯»å–ç¼“å­˜æ–‡ä»¶æˆåŠŸ ' + config.cacheRemote)\n                            console.log('')\n                        } catch (remoteError) {\n                            console.log('')\n                            console.log(`\\x1b[31m%s\\x1b[0m`, 'è¯»å–è¿œç¨‹ç¼“å­˜æ–‡ä»¶å¤±è´¥: ' + remoteError.message);\n                            console.log(`\\x1b[31m%s\\x1b[0m`, 'è¿œç¨‹ç¼“å­˜æ–‡ä»¶è·¯å¾„: ' + config.cacheRemote);\n                            console.log('')\n                        }\n                    }\n                }\n            }\n        }\n\n        // æ£€æŸ¥ç¼“å­˜ä¸­æ˜¯å¦å­˜åœ¨\n        if (this.gitalkCache && Array.isArray(this.gitalkCache)) {\n            isInitialized = this.gitalkCache.some(({pathname: itemPath}) => itemPath === pathname);\n        }\n\n        // å¦‚æœç¼“å­˜ä¸­ä¸å­˜åœ¨ä¸”å¯ç”¨äº† GitHub API æ£€æŸ¥ï¼Œåˆ™é€šè¿‡ API æ£€æŸ¥\n        if (!isInitialized && config.enableGithubApiCheck && title) {\n            console.log(`\\x1b[90m%s\\x1b[0m`, `æœ¬åœ°ç¼“å­˜ä¸­æœªæ‰¾åˆ°ï¼Œæ­£åœ¨é€šè¿‡ GitHub API æ£€æŸ¥æ–‡ç«  \"${title}\" çš„ issue...`);\n            isInitialized = await this.checkIssueByGithubAPI(title);\n\n            // å¦‚æœé€šè¿‡ API å‘ç° issue å·²å­˜åœ¨ï¼Œåˆ™æ›´æ–°ç¼“å­˜\n            if (isInitialized && config.enableCache) {\n                this.gitalkCache = this.gitalkCache || [];\n                this.gitalkCache.push({ pathname });\n                await this.write(config.cacheFile, JSON.stringify(this.gitalkCache, null, 2));\n                console.log(`\\x1b[32m%s\\x1b[0m`, `é€šè¿‡ GitHub API å‘ç° issue å·²å­˜åœ¨ï¼Œå·²æ›´æ–°ç¼“å­˜`);\n            }\n        }\n\n        return isInitialized;\n    },\n\n    /**\n     * å†™å…¥å†…å®¹\n     * @param {string} fileName æ–‡ä»¶å\n     * @param {string} content å†…å®¹\n     * @param flag\n     */\n    async write(fileName, content, flag = 'w+') {\n        // ç¡®ä¿ç›®å½•å­˜åœ¨\n        const dir = path.dirname(fileName);\n        if (!fs.existsSync(dir)) {\n            fs.mkdirSync(dir, { recursive: true });\n        }\n\n        return new Promise((resolve) => {\n            fs.open(fileName, flag, function (err, fd) {\n                if (err) {\n                    resolve([err, false]);\n                    return;\n                }\n                fs.writeFile(fd, content, function (err) {\n                    if (err) {\n                        resolve([err, false]);\n                        return;\n                    }\n                    fs.close(fd, (err) => {\n                        if (err) {\n                            resolve([err, false]);\n                        }\n                    });\n                    resolve([false, true]);\n                });\n            });\n        });\n    },\n\n    /**\n     * åœ¨Windowså¹³å°æ¨¡æ‹Ÿé¼ æ ‡ç§»åŠ¨\n     */\n    async simulateMouseMovement() {\n        try {\n            // Windowsç³»ç»Ÿä¸‹ä½¿ç”¨PowerShellæ¨¡æ‹Ÿé¼ æ ‡ç§»åŠ¨\n            const moveScript = `\n                Add-Type -AssemblyName System.Windows.Forms\n                $screen = [System.Windows.Forms.Screen]::PrimaryScreen.Bounds\n                for ($i = 0; $i -lt 5; $i++) {\n                    $x = Get-Random -Minimum 100 -Maximum ($screen.Width - 100)\n                    $y = Get-Random -Minimum 100 -Maximum ($screen.Height - 100)\n                    [System.Windows.Forms.Cursor]::Position = New-Object System.Drawing.Point($x, $y)\n                    Start-Sleep -Milliseconds 300\n                }\n            `;\n            await execPromise(`powershell -Command \"${moveScript}\"`);\n        } catch (e) {\n            console.log(`\\x1b[33m%s\\x1b[0m`, `æ¨¡æ‹Ÿé¼ æ ‡ç§»åŠ¨å¤±è´¥: ${e.message}`);\n        }\n    },\n\n    /**\n     * åœ¨Windowså¹³å°æ‰“å¼€æµè§ˆå™¨\n     * @param {string} url è¦æ‰“å¼€çš„URL\n     */\n    async openBrowser(url) {\n        try {\n            await execPromise(`start \"\" \"${url}\"`);\n            console.log(`\\x1b[33m%s\\x1b[0m`, `å·²æ‰“å¼€æµè§ˆå™¨è®¿é—®`);\n        } catch (error) {\n            console.error(`æ‰“å¼€æµè§ˆå™¨æ—¶å‡ºé”™: ${error.message}`);\n        }\n    },\n\n    /**\n     * åœ¨Windowså¹³å°å…³é—­æµè§ˆå™¨\n     */\n    async closeBrowser() {\n        try {\n            await execPromise(`taskkill /F /IM chrome.exe 2>nul || taskkill /F /IM msedge.exe 2>nul || taskkill /F /IM firefox.exe 2>nul`);\n            console.log(`\\x1b[32m%s\\x1b[0m`, `å·²å…³é—­æµè§ˆå™¨`);\n        } catch (error) {\n            console.log(`\\x1b[33m%s\\x1b[0m`, `å…³é—­æµè§ˆå™¨æ—¶å‡ºç°éè‡´å‘½é”™è¯¯: ${error.message}`);\n        }\n    },\n\n    /**\n     * é€ä¸ªæ‰“å¼€URLï¼ŒåŒæ—¶æ¨¡æ‹Ÿé¼ æ ‡æ´»åŠ¨ï¼Œæœ€åç»Ÿä¸€å…³é—­æµè§ˆå™¨\n     * @param {Array<Object>} urls è¦æ‰“å¼€çš„URLæ•°ç»„ï¼Œæ¯ä¸ªå…ƒç´ åŒ…å«urlå’Œtitleå±æ€§\n     * @param {number} waitTime æ¯ä¸ªé¡µé¢ç­‰å¾…çš„æ—¶é—´ï¼ˆæ¯«ç§’ï¼‰\n     * @param {number} maxPages è¦æ‰“å¼€çš„æœ€å¤§é¡µé¢æ•°ï¼Œ0è¡¨ç¤ºæ‰“å¼€æ‰€æœ‰é¡µé¢\n     */\n    async openUrlsSequentially(urls, waitTime, maxPages = 0) {\n        if (!urls || urls.length === 0) {\n            console.log(`\\x1b[33m%s\\x1b[0m`, `æ²¡æœ‰éœ€è¦æ‰“å¼€çš„é¡µé¢`);                                                                            \n            return;\n        }\n\n        // æ ¹æ®maxPagesé™åˆ¶è¦æ‰“å¼€çš„é¡µé¢æ•°é‡\n        const urlsToOpen = maxPages > 0 ? urls.slice(0, maxPages) : urls;\n\n        try {\n            console.log(`\\x1b[32m%s\\x1b[0m`, `å‡†å¤‡é€ä¸ªæ‰“å¼€ ${urlsToOpen.length} ä¸ªé¡µé¢...`);\n            console.log('');\n            // é€ä¸ªæ‰“å¼€URL\n            for (let i = 0; i < urlsToOpen.length; i++) {\n                const urlObj = urlsToOpen[i];\n                const url = urlObj.url;\n                const title = urlObj.title;\n\n                // æ˜¾ç¤ºæ ‡é¢˜ä¿¡æ¯\n                if (title) {\n                    console.log(`\\x1b[32m%s\\x1b[0m`, `[${title}]----å‡†å¤‡æ‰“å¼€æ–‡ç« å†…å®¹`);\n                }\n                console.log(`\\x1b[33m%s\\x1b[0m`, `æ­£åœ¨æ‰“å¼€é¡µé¢ ${i + 1}/${urlsToOpen.length}: ${url}`);\n\n                // æ‰“å¼€æµè§ˆå™¨\n                await this.openBrowser(url);\n\n                // ç­‰å¾…é¡µé¢åŠ è½½\n                await new Promise(resolve => setTimeout(resolve, 1000));\n\n                // å¦‚æœå¯ç”¨äº†é¼ æ ‡ç§»åŠ¨ï¼Œåˆ™æ¨¡æ‹Ÿé¼ æ ‡ç§»åŠ¨\n                if (config.enableMouseMovement) {\n                    console.log(`\\x1b[33m%s\\x1b[0m`, `æ­£åœ¨æ¨¡æ‹Ÿé¼ æ ‡æ´»åŠ¨...`);\n                    await this.simulateMouseMovement();\n\n                    // ç­‰å¾…é¼ æ ‡æ´»åŠ¨æ—¶é—´\n                    await new Promise(resolve => setTimeout(resolve, config.mouseActiveTime));\n                }\n\n                // ç­‰å¾…å‰©ä½™æ—¶é—´\n                const remainingTime = waitTime - 1000 - (config.enableMouseMovement ? config.mouseActiveTime : 0);\n                if (remainingTime > 0) {\n                    await new Promise(resolve => setTimeout(resolve, remainingTime));\n                }\n\n                console.log(`\\x1b[33m%s\\x1b[0m`, `é¡µé¢å¤„ç†å®Œæˆ`);\n            }\n\n            console.log('')\n            // ç»Ÿä¸€å…³é—­æµè§ˆå™¨\n            console.log(`\\x1b[32m%s\\x1b[0m`, `æ‰€æœ‰é¡µé¢å¤„ç†å®Œæˆï¼Œæ­£åœ¨å…³é—­æµè§ˆå™¨...`);\n            await this.closeBrowser();\n\n        } catch (error) {\n            console.error(`å¤„ç†URLæ—¶å‡ºé”™: ${error.message}`);\n        }\n    },\n\n    /**\n     * åˆ†æ‰¹æ‰“å¼€URLï¼Œæ¯æ‰¹å¤„ç†æŒ‡å®šæ•°é‡çš„é¡µé¢\n     * @param {Array<Object>} urls è¦æ‰“å¼€çš„URLæ•°ç»„ï¼Œæ¯ä¸ªå…ƒç´ åŒ…å«urlå’Œtitleå±æ€§\n     * @param {number} waitTime æ¯ä¸ªé¡µé¢ç­‰å¾…çš„æ—¶é—´ï¼ˆæ¯«ç§’ï¼‰\n     * @param {number} batchSize æ¯æ‰¹å¤„ç†çš„é¡µé¢æ•°é‡\n     */\n    async openUrlsInBatches(urls, waitTime, batchSize) {\n        if (!urls || urls.length === 0) {\n            console.log(`\\x1b[33m%s\\x1b[0m`, `æ²¡æœ‰éœ€è¦æ‰“å¼€çš„é¡µé¢`);\n            return;\n        }\n\n        const totalUrls = urls.length;\n        let processedCount = 0;\n        let batchCount = 1;\n\n        while (processedCount < totalUrls) {\n            const remainingUrls = totalUrls - processedCount;\n            const currentBatchSize = Math.min(batchSize, remainingUrls);\n            const currentBatch = urls.slice(processedCount, processedCount + currentBatchSize);\n\n            console.log('');\n            console.log(`\\x1b[32m%s\\x1b[0m`, `##########################################ç¬¬ ${batchCount} æ‰¹##########################################`);\n            console.log(`\\x1b[33m%s\\x1b[0m`, `æ­£åœ¨å¤„ç†ç¬¬ ${batchCount} æ‰¹ï¼Œå…± ${currentBatchSize} ä¸ªé¡µé¢ï¼ˆå‰©ä½™ ${remainingUrls - currentBatchSize} ä¸ªï¼‰`);\n\n            // å¤„ç†å½“å‰æ‰¹æ¬¡\n            await this.openUrlsSequentially(currentBatch, waitTime, currentBatchSize);\n\n            processedCount += currentBatchSize;\n            batchCount++;\n\n            // å¦‚æœè¿˜æœ‰æœªå¤„ç†çš„é¡µé¢ï¼Œç­‰å¾…ä¸€æ®µæ—¶é—´å†å¤„ç†ä¸‹ä¸€æ‰¹\n            if (processedCount < totalUrls) {\n                console.log('');\n                console.log(`\\x1b[36m%s\\x1b[0m`, `ç¬¬ ${batchCount - 1} æ‰¹å¤„ç†å®Œæˆï¼Œç­‰å¾… 5 ç§’åå¤„ç†ä¸‹ä¸€æ‰¹...`);\n                await new Promise(resolve => setTimeout(resolve, 5000));\n            }\n        }\n\n        console.log('');\n        console.log(`\\x1b[32m%s\\x1b[0m`, `########################################æ‰€æœ‰æ‰¹æ¬¡å¤„ç†å®Œæˆ########################################`);\n        console.log('');\n    },\n\n    // æ ¹æ®Hexo permalinkæ ¼å¼ç”Ÿæˆæ–‡ç« è·¯å¾„\n    generatePermalink(post) {\n        const { hexoPermalink } = config;\n        const { abbrlink, title, date, categories, year, month, day, hour, minute, second } = post;\n\n        let permalinkStr = hexoPermalink;\n\n        // å¤„ç†æ—¥æœŸ\n        const dateObj = date ? new Date(date) : new Date();\n        const dateObjYear = dateObj.getFullYear();\n        const dateObjMonth = String(dateObj.getMonth() + 1).padStart(2, '0');\n        const dateObjDay = String(dateObj.getDate()).padStart(2, '0');\n        const dateObjHour = String(dateObj.getHours()).padStart(2, '0');\n        const dateObjMinute = String(dateObj.getMinutes()).padStart(2, '0');\n        const dateObjSecond = String(dateObj.getSeconds()).padStart(2, '0');\n\n        // å¤„ç†æ ‡é¢˜\n        const processedTitle = title.toLowerCase().replace(/\\s+/g, '-').replace(/[^\\w\\-]+/g, '').replace(/\\-\\-+/g, '-');\n\n        // å¤„ç†åˆ†ç±»\n        let processedCategories = '';\n        if (categories && Array.isArray(categories)) {\n            processedCategories = categories.join('/');\n        } else if (categories && typeof categories === 'string') {\n            processedCategories = categories;\n        }\n\n        // æ›¿æ¢permalinkå˜é‡\n        permalinkStr = permalinkStr\n            .replace(':year', year || dateObjYear)\n            .replace(':month', month || dateObjMonth)\n            .replace(':day', day || dateObjDay)\n            .replace(':hour', hour || dateObjHour)\n            .replace(':minute', minute || dateObjMinute)\n            .replace(':second', second || dateObjSecond)\n            .replace(':title', processedTitle)\n            .replace(':abbrlink', abbrlink || '')\n            .replace(':category', processedCategories);\n\n        // ç¡®ä¿ä»¥/å¼€å¤´\n        if (!permalinkStr.startsWith('/')) {\n            permalinkStr = '/' + permalinkStr;\n        }\n\n        return permalinkStr;\n    },\n\n    async start(postDir) {\n        const posts = await this.readPosts(postDir);\n        // æŠ¥é”™çš„æ•°æ®\n        const errorData = [];\n        // å·²ç»åˆå§‹åŒ–çš„æ•°æ®\n        const initializedData = [];\n        // æˆåŠŸåˆå§‹åŒ–æ•°æ®\n        const successData = [];\n        // éœ€è¦åœ¨æµè§ˆå™¨ä¸­æ‰“å¼€çš„URLåˆ—è¡¨\n        const urlsToOpen = [];\n\n        for (const item of posts) {\n            // ä½¿ç”¨Hexo permalinkæ ¼å¼ç”Ÿæˆpathname\n            const pathname = this.generatePermalink(item);\n            const { title } = item;\n\n            // æ£€æŸ¥æ˜¯å¦å·²ç»åˆå§‹åŒ–ï¼ˆé€šè¿‡ç¼“å­˜æˆ– GitHub APIï¼‰\n            const isInitialized = await this.getIsInitByCache(pathname, title);\n\n            if (isInitialized) {\n                console.log(`\\x1b[36m%s\\x1b[0m`, `æ–‡ç« å·²å¤„ç†----[${title}]`);\n                initializedData.push({pathname});  // åªä¿å­˜pathname\n                continue;\n            }\n\n            console.log(`\\x1b[32m%s\\x1b[0m`, `[${title}]----å‘ç°æ–°æ–‡ç«  `);\n\n            // å¦‚æœé…ç½®äº†åœ¨æµè§ˆå™¨ä¸­æ‰“å¼€ï¼Œåˆ™æ·»åŠ åˆ°URLåˆ—è¡¨ï¼ˆä¿®æ”¹ä¸ºåŒ…å«URLå’Œæ ‡é¢˜çš„å¯¹è±¡ï¼‰\n            if (config.openInBrowser) {\n                const fullUrl = `${config.hexoUrl}${pathname}`;\n                // ä¿®æ”¹ï¼šå°†URLå’Œæ ‡é¢˜ä¸€èµ·å­˜å‚¨\n                urlsToOpen.push({\n                    url: fullUrl,\n                    title: title\n                });\n            }\n\n            successData.push({\n                pathname  // åªä¿å­˜pathname\n            });\n            console.log(`\\x1b[32m%s\\x1b[0m`, `[${title}]----æ–‡ç« å·²è®°å½•!`);\n            console.log(`\\x1b[32m%s\\x1b[0m`, `æ–‡ç« é“¾æ¥: ${config.hexoUrl}${pathname}`);\n            console.log('');\n        }\n\n        // åœ¨æ‰€æœ‰æ–‡ç« å¤„ç†å®Œæˆåï¼Œåˆ†æ‰¹æ‰“å¼€URLï¼ŒåŒæ—¶æ¨¡æ‹Ÿé¼ æ ‡æ´»åŠ¨ï¼Œæœ€åç»Ÿä¸€å…³é—­æµè§ˆå™¨\n        if (config.openInBrowser && urlsToOpen.length > 0) {\n            console.log('');\n            console.log(`\\x1b[33m%s\\x1b[0m`,'##########################################è®¿é—®ç½‘é¡µ##########################################')\n\n            // æ ¹æ®maxPagesToOpençš„å€¼å†³å®šå¤„ç†æ–¹å¼\n            if (config.maxPagesToOpen === 0) {\n                // å¦‚æœmaxPagesToOpenä¸º0ï¼Œä¸€æ¬¡æ€§æ‰“å¼€æ‰€æœ‰é¡µé¢\n                console.log(`\\x1b[33m%s\\x1b[0m`, `å‡†å¤‡ä¸€æ¬¡æ€§æ‰“å¼€æ‰€æœ‰ ${urlsToOpen.length} ä¸ªé¡µé¢`);\n                console.log('');\n                await this.openUrlsSequentially(urlsToOpen, config.browserWaitTime, 0);\n            } else {\n                console.log('');\n                // å¦‚æœmaxPagesToOpenå¤§äº0ï¼Œåˆ†æ‰¹å¤„ç†é¡µé¢\n                console.log(`\\x1b[33m%s\\x1b[0m`, `å‡†å¤‡åˆ†æ‰¹æ‰“å¼€é¡µé¢ï¼Œæ¯æ‰¹ ${config.maxPagesToOpen} ä¸ªï¼Œå…± ${urlsToOpen.length} ä¸ª`);\n                await this.openUrlsInBatches(urlsToOpen, config.browserWaitTime, config.maxPagesToOpen);\n            }\n\n            console.log(`\\x1b[33m%s\\x1b[0m`,'##########################################è®¿é—®ç½‘é¡µ##########################################')\n            console.log('');\n        }\n\n        console.log(''); // ç©ºè¾“å‡ºï¼Œç”¨äºæ¢è¡Œ\n        console.log(`\\x1b[35m%s\\x1b[0m`, '##########################################è¿è¡Œç»“æœ##########################################');\n\n        if (errorData.length !== 0) {\n            console.log(`\\x1b[31m%s\\x1b[0m`, `æŠ¥é”™æ•°æ®ï¼š ${errorData.length} æ¡ã€‚`);\n            console.log(JSON.stringify(errorData, null, 2))\n        }\n\n        console.log(`\\x1b[35m%s\\x1b[0m`, `æœ¬æ¬¡æˆåŠŸï¼š ${successData.length} æ¡ã€‚`);\n\n        // å†™å…¥ç¼“å­˜\n        if (config.enableCache) {\n            console.log(`\\x1b[35m%s\\x1b[0m`, `å†™å…¥ç¼“å­˜ï¼š ${(initializedData.length + successData.length)} æ¡ï¼Œå·²å¤„ç† ${initializedData.length} æ¡ï¼Œæœ¬æ¬¡æˆåŠŸï¼š ${successData.length} æ¡ã€‚å‚è€ƒæ–‡ä»¶ ${config.cacheFile}ã€‚`);\n            await this.write(config.cacheFile, JSON.stringify(initializedData.concat(successData), null, 2));\n        } else {\n            console.log(`\\x1b[35m%s\\x1b[0m`, `å·²å¤„ç†ï¼š ${initializedData.length} æ¡ã€‚`);\n        }\n\n    },\n}\n\n// æ–°å¢ï¼šåœ¨æ‰§è¡Œè„šæœ¬å‰æ£€æŸ¥ Butterfly ä¸»é¢˜é…ç½®\nif (checkButterflyCommentsConfig()) {\n    // åªæœ‰å½“ Gitalk æ˜¯ç¬¬ä¸€ä¸ªè¯„è®ºç³»ç»Ÿæ—¶æ‰æ‰§è¡Œè„šæœ¬\n    autoGitalkInit.start(config.postsDir).then(() => {\n        console.log('\\x1b[35m%s\\x1b[0m','æ–‡ç« å¤„ç†å®Œæˆ')\n        console.log('\\x1b[35m%s\\x1b[0m','##########################################è¿è¡Œç»“æœ##########################################');\n    });\n} else {\n    // å¦‚æœ Gitalk ä¸æ˜¯ç¬¬ä¸€ä¸ªè¯„è®ºç³»ç»Ÿæˆ–ä¸åŒ…å«åœ¨è¯„è®ºç³»ç»Ÿä¸­ï¼Œåˆ™ä¸æ‰§è¡Œè„šæœ¬\n    console.log('\\x1b[31m%s\\x1b[0m', 'è„šæœ¬æ‰§è¡Œå·²åœæ­¢ï¼Œè¯·å…ˆä¿®æ”¹é…ç½®é¡¹ä¸­çš„ Butterfly ä¸»é¢˜é…ç½®æ–‡ä»¶è·¯å¾„');\n    console.log('');\n    console.log('\\x1b[31m%s\\x1b[0m', '##########################################è„šæœ¬å·²åœæ­¢##########################################');\n}\n```\n\nåœ¨è¯¥ç›®å½•ä¸‹æ‰“å¼€`cmd`ï¼Œè¾“å…¥ä»¥ä¸‹å‘½ä»¤è¿è¡Œè„šæœ¬ã€‚\n\n```cmd\nnode gitalk_init.js\n```\n\nç­‰å¾…è„šæœ¬è¿è¡Œå®Œæˆï¼ŒæŸ¥çœ‹ä»“åº“ç”Ÿæˆçš„Issueå³å¯ã€‚\n\n{% note warning flat %}\næ³¨æ„ï¼šè„šæœ¬è¿è¡Œè¿‡ç¨‹ä¸­ä¼šè°ƒç”¨é»˜è®¤æµè§ˆå™¨æ¨¡æ‹Ÿè®¿é—®å’Œå…³é—­ç½‘é¡µã€‚\n{% endnote %}\n\n{% folding green open,åšå®¢æ­å»ºç³»åˆ—æ–‡ç«  %}\n\n{% series åšå®¢æ­å»ºæ•™ç¨‹ %}\n\n{% endfolding %}\n","tags":["åšå®¢","é­”æ”¹","Gitalk","Issues"],"categories":["åšå®¢æ•™ç¨‹","Gitalkè¯„è®º"]},{"title":"k8sçŸ¥è¯†æ¢³ç†--è¿›é˜¶","url":"/yyg/986299a9/","content":"\n##  ç½‘ç»œ\n\nKubernetes-ç½‘ç»œæ¨¡å‹åŸåˆ™\n\nåœ¨ä¸ä½¿ç”¨ç½‘ç»œåœ°å€è½¬æ¢(NAT)çš„æƒ…å†µä¸‹ï¼Œé›†ç¾¤ä¸­çš„Podèƒ½å¤Ÿä¸ä»»æ„å…¶ä»–Podè¿›è¡Œé€šä¿¡\n\nåœ¨ä¸ä½¿ç”¨ç½‘ç»œåœ°å€è½¬æ¢(NAT)çš„æƒ…å†µä¸‹ï¼Œåœ¨é›†ç¾¤èŠ‚ç‚¹ä¸Šè¿è¡Œçš„ç¨‹åºèƒ½ä¸åŒä¸€èŠ‚ç‚¹ä¸Šçš„ä»»ä½•Podè¿›è¡Œé€šä¿¡\n\næ¯ä¸ªPodéƒ½æœ‰è‡ªå·±çš„IPåœ°å€(IP-per-Pod)ï¼Œå¹¶ä¸”ä»»æ„å…¶ä»–Podéƒ½å¯ä»¥é€šè¿‡ç›¸åŒçš„è¿™ä¸ªåœ°å€è®¿é—®å®ƒ\n\nå€ŸåŠ©CNIæ ‡å‡†ï¼ŒKuberneteså¯ä»¥å®ç°å®¹å™¨ç½‘ç»œé—®é¢˜çš„è§£å†³ã€‚é€šè¿‡æ’ä»¶åŒ–çš„æ–¹å¼æ¥é›†æˆå„ç§ç½‘ç»œæ’ä»¶ï¼Œå®ç°é›†ç¾¤å†…éƒ¨ç½‘ç»ˆç›¸äº’é€šä¿¡ï¼Œåªè¦å®ç°CNIæ ‡å‡†ä¸­å®šä¹‰çš„æ ¸å¿ƒæ¥å£æ“ä½œ(ADD,å°†å®¹å™¨æ·»åŠ åˆ°ç½‘ç»œï¼›DELï¼Œä»ç½‘ç»œä¸­åˆ é™¤ä¸€ä¸ªå®¹å™¨ï¼›CHECK,æ£€æŸ¥å®¹å™¨çš„ç½‘ç»œæ˜¯å¦ç¬¦åˆé¢„æœŸç­‰)ã€‚CNIæ’ä»¶é€šå¸¸èšç„¦åœ¨å®¹å™¨åˆ°å®¹å™¨çš„ç½‘ç»œé€šä¿¡ã€‚\n\nCNlçš„æ¥å£å¹¶ä¸æ˜¯æŒ‡HTTP,gRPCè¿™ç§æ¥å£ï¼ŒCNlæ¥å£æ˜¯æŒ‡å¯¹å¯æ‰§è¡Œç¨‹åºçš„è°ƒç”¨(exec)å¯æ‰§è¡Œç¨‹åºï¼ŒKubernetesèŠ‚ç‚¹é»˜è®¤çš„CNæ’ä»¶è·¯å¾„ä¸º/opt/cni/bin\n\nCNIé€šè¿‡JSONæ ¼å¼çš„é…ç½®æ–‡ä»¶æ¥æè¿°ç½‘ç»œé…ç½®ï¼Œå½“éœ€è¦è®¾ç½®å®¹å™¨ç½‘ç»œæ—¶ï¼Œç”±å®¹å™¨è¿è¡Œæ—¶è´Ÿè´£æ‰§è¡ŒCN!æ’ä»¶ï¼Œå¹¶é€šè¿‡CNlæ’ä»¶çš„æ ‡å‡†è¾“å…¥(stdi)æ¥ä¼ é€’é…ç½®æ–‡ä»¶ä¿¡æ¯ï¼Œé€šè¿‡æ ‡å‡†è¾“å‡º(stdout)æ¥æ”¶æ’ä»¶çš„æ‰§è¡Œç»“æœã€‚ä»ç½‘ç»œæ’ä»¶åŠŸèƒ½å¯ä»¥åˆ†ä¸ºäº”ç±»ï¼š\n\n- Mainæ’ä»¶ï¼Œåˆ›å»ºå…·ä½“ç½‘ç»œè®¾å¤‡(bridge:ç½‘æ¡¥è®¾å¤‡ï¼Œè¿æ¥containerå’Œhostï¼›ipvlan:ä¸ºå®¹å™¨å¢åŠ ipvlanç½‘å¡ï¼›loopback:IOè®¾å¤‡ï¼›macvlan:ä¸ºå®¹å™¨åˆ›å»ºä¸€ä¸ªMACåœ°å€ï¼›ptp:åˆ›å»ºä¸€å¯¹VethPairï¼›vlan:åˆ†é…ä¸€ä¸ªvlanè®¾å¤‡ï¼›host-device:å°†å·²å­˜åœ¨çš„è®¾å¤‡ç§»å…¥å®¹å™¨å†…)\n- IPAMæ’ä»¶ï¼šè´Ÿè´£åˆ†é…IPåœ°å€(dhcp:å®¹å™¨å‘DHCPæœåŠ¡å™¨å‘èµ·è¯·æ±‚ï¼Œç»™Podå‘æ”¾æˆ–å›æ”¶Påœ°å€ï¼›host-local:ä½¿ç”¨é¢„å…ˆé…ç½®çš„IPåœ°å€æ®µæ¥è¿›è¡Œåˆ†é…ï¼›static:ä¸ºå®¹å™¨åˆ†é…ä¸€ä¸ªé™æ€IPv4/IPv6åœ°å€ä¸»è¦ç”¨äºdebug)\n- METAæ’ä»¶ï¼šå…¶ä»–åŠŸèƒ½çš„æ’ä»¶(tuning:é€šè¿‡sysctlè°ƒæ•´ç½‘ç»œè®¾å¤‡å‚æ•°ï¼›portmap:é€šè¿‡iptablesé…ç½®ç«¯å£æ˜ å°„ï¼›bandwidth:ä½¿ç”¨Token Bucket Filteræ¥é™æµï¼›sbr:ä¸ºç½‘å¡è®¾ç½®source based routingï¼›firewallï¼šé€šè¿‡iptablesç»™å®¹å™¨ç½‘ç»œçš„è¿›å‡ºæµé‡è¿›è¡Œé™åˆ¶)\n- Windowsæ’ä»¶ï¼šä¸“é—¨ç”¨äºWindowså¹³å°çš„CNlæ’ä»¶(win-bridgeä¸win-overlayç½‘ç»œæ’ä»¶)\n- ç¬¬ä¸‰æ–¹ç½‘ç»œæ’ä»¶ï¼šç¬¬ä¸‰æ–¹å¼€æºçš„ç½‘ç»œæ’ä»¶ä¼—å¤šï¼Œæ¯ä¸ªç»„ä»¶éƒ½æœ‰å„è‡ªçš„ä¼˜ç‚¹åŠé€‚åº”çš„åœºæ™¯ï¼Œéš¾ä»¥å½¢æˆç»Ÿä¸€çš„æ ‡å‡†ç»„ä»¶ï¼Œå¸¸ç”¨æœ‰Flannelã€Calicoã€Ciliumã€OVNç½‘ç»œæ’ä»¶\n\n| æä¾›å•†  | ç½‘ç»œæ¨¡å‹                    | è·¯ç”±åˆ†å‘ | ç½‘ç»œç­–ç•¥ | ç½‘æ ¼ | å¤–éƒ¨æ•°æ®å­˜å‚¨  | åŠ å¯† | Ingress/Egressç­–ç•¥ |\n| ------- | --------------------------- | -------- | -------- | ---- | ------------- | ---- | ------------------ |\n| Canal   | å°è£…ï¼ˆVXLANï¼‰               | å¦       | æ˜¯       | å¦   | k8s API       | æ˜¯   | æ˜¯                 |\n| Flannel | å°è£…ï¼ˆVXLANï¼‰               | å¦       | å¦       | å¦   | k8s API       | æ˜¯   | å¦                 |\n| Calico  | å°è£…ï¼ˆVXLAN, IPIPï¼‰æˆ–æœªå°è£… | æ˜¯       | æ˜¯       | æ˜¯   | Etcdå’Œk8s API | æ˜¯   | æ˜¯                 |\n| Weave   | å°è£…                        | æ˜¯       | æ˜¯       | æ˜¯   | å¦            | æ˜¯   | æ˜¯                 |\n| Cilium  | å°è£…ï¼ˆVXLANï¼‰               | æ˜¯       | æ˜¯       | æ˜¯   | Etcdå’Œk8s API | æ˜¯   | æ˜¯                 |\n\n> - ç½‘ç»œæ¨¡å‹ï¼šå°è£…æˆ–æœªå°è£…ã€‚\n> - è·¯ç”±åˆ†å‘ï¼šä¸€ç§å¤–éƒ¨ç½‘å…³åè®®ï¼Œç”¨äºåœ¨äº’è”ç½‘ä¸Šäº¤æ¢è·¯ç”±å’Œå¯è¾¾æ€§ä¿¡æ¯ã€‚BGPå¯ä»¥å¸®åŠ©è¿›è¡Œè·¨é›†ç¾¤Ïodä¹‹é—´çš„ç½‘ç»œã€‚æ­¤åŠŸèƒ½å¯¹äºæœªå°è£…çš„CNIç½‘ç»œæ’ä»¶æ˜¯å¿…é¡»çš„ï¼Œå¹¶ä¸”é€šå¸¸ç”±BGPå®Œæˆã€‚å¦‚æœä½ æƒ³æ„å»ºè·¨ç½‘æ®µæ‹†åˆ†çš„é›†ç¾¤ï¼Œè·¯ç”±åˆ†å‘æ˜¯ä¸€ä¸ªå¾ˆå¥½çš„åŠŸèƒ½ã€‚\n> - ç½‘ç»œç­–ç•¥ï¼šKubernetesæä¾›äº†å¼ºåˆ¶æ‰§è¡Œè§„åˆ™çš„åŠŸèƒ½ï¼Œè¿™äº›è§„åˆ™å†³å®šäº†å“ªäº›serviceå¯ä»¥ä½¿ç”¨ç½‘ç»œç­–ç•¥è¿›è¡Œç›¸äº’é€šä¿¡ã€‚è¿™æ˜¯ä»Kubernetes1.7èµ·ç¨³å®šçš„åŠŸèƒ½ï¼Œå¯ä»¥ä¸æŸäº›ç½‘ç»œæ’ä»¶ä¸€èµ·ä½¿ç”¨ã€‚\n> - ç½‘æ ¼ï¼šå…è®¸åœ¨ä¸åŒçš„Kubernetesé›†ç¾¤é—´è¿›è¡Œserviceä¹‹é—´çš„ç½‘ç»œé€šä¿¡ã€‚\n> - å¤–éƒ¨æ•°æ®å­˜å‚¨ï¼šå…·æœ‰æ­¤åŠŸèƒ½çš„C!ç½‘ç»œæ’ä»¶éœ€è¦ä¸€ä¸ªå¤–éƒ¨æ•°æ®å­˜å‚¨æ¥å­˜å‚¨æ•°æ®ã€‚\n> - åŠ å¯†ï¼šå…è®¸åŠ å¯†å’Œå®‰å…¨çš„ç½‘ç»œæ§åˆ¶å’Œæ•°æ®å¹³é¢ã€‚\n> - Ingress/Egressç­–ç•¥ï¼šå…è®¸ä½ ç®¡ç†Kuberneteså’ŒéKubernetesé€šä¿¡çš„è·¯ç”±æ§åˆ¶ã€‚\n\nCalicoæ˜¯ä¸€ä¸ªçº¯ä¸‰å±‚çš„è™šæ‹Ÿç½‘ç»œï¼Œå®ƒæ²¡æœ‰å¤ç”¨dockerçš„docker0ç½‘æ¡¥ï¼Œè€Œæ˜¯è‡ªå·±å®ç°çš„ï¼Œcalicoç½‘ç»œä¸å¯¹æ•°æ®åŒ…è¿›è¡Œé¢å¤–å°è£…ï¼Œä¸éœ€è¦NATå’Œç«¯å£æ˜ å°„\n\n**Calicoæ¶æ„**ï¼š\n\n**Felix**\n\n- ç®¡ç†ç½‘ç»œæ¥å£ç¼–å†™è·¯ç”±\n- ç¼–å†™ACL\n- æŠ¥å‘ŠçŠ¶æ€\n\n**bird (BGP Client)**\n\nBGP Clientå°†é€šè¿‡BGPåè®®å¹¿æ’­å‘Šè¯‰å‰©ä½™calicoèŠ‚ç‚¹ï¼Œä»è€Œå®ç°ç½‘ç»œäº’é€š\n\n**confd**\n\né€šè¿‡ç›‘å¬etcdä»¥äº†è§£BGPé…ç½®å’Œå…¨å±€é»˜è®¤å€¼çš„æ›´æ”¹ã€‚Confdæ ¹æ®ETCDè™«æ•°æ®çš„æ›´æ–°ï¼ŒåŠ¨æ€ç”ŸæˆBRDé…ç½®æ–‡ä»¶æ–‡ä»¶æ›´æ”¹æ—¶confdè§¦å‘BlRDé‡æ–°åŠ è½½\n\n![img](k8sçŸ¥è¯†æ¢³ç†--è¿›é˜¶/1.png)\n\n**Calicoç½‘ç»œæ¨¡å¼--VXLAN**ï¼š\n\n> ä»€ä¹ˆæ˜¯VXLAN?\n>\n> - VXLAN,å³Virtual Extensible LAN(è™šæ‹Ÿå¯æ‰©å±•å±€åŸŸç½‘)ï¼Œæ˜¯Linuxæœ¬èº«æ”¯æŒçš„ä¸€ç½‘ç§ç½‘ç»œè™šæ‹ŸåŒ–æŠ€æœ¯ã€‚VXLANå¯ä»¥å®Œå…¨åœ¨å†…æ ¸æ€å®ç°å°è£…å’Œè§£å°è£…å·¥ä½œï¼Œä»è€Œé€šè¿‡â€œéš§é“â€æœºåˆ¶ï¼Œæ„å»ºå‡ºè¦†ç›–ç½‘ç»œ(Overlay Network)\n>\n> - åŸºäºä¸‰å±‚çš„â€äºŒå±‚â€œé€šä¿¡ï¼Œå±‚å³vxlanåŒ…å°è£…åœ¨udpæ•°æ®åŒ…ä¸­ï¼Œè¦æ±‚udpåœ¨k8sèŠ‚ç‚¹é—´ä¸‰å±‚å¯è¾¾ï¼›äºŒå±‚å³vxlanå°åŒ…çš„æºmacåœ°å€å’Œç›®çš„macåœ°å€æ˜¯è‡ªå·±çš„vxlanè®¾å¤‡macå’Œå¯¹ç«¯vxlanè®¾å¤‡macå®ç°é€šè®¯ã€‚\n\n![img](k8sçŸ¥è¯†æ¢³ç†--è¿›é˜¶/2.png)\n\n> æ•°æ®åŒ…å°åŒ…ï¼šå°åŒ…ï¼Œåœ¨vxlanè®¾å¤‡ä¸Šå°†podå‘æ¥çš„æ•°æ®åŒ…æºã€ç›®çš„macæ›¿æ¢ä¸ºæœ¬æœºvxlanç½‘å¡å’Œå¯¹ç«¯èŠ‚ç‚¹vxlanç½‘å¡çš„macã€‚å¤–å±‚udpç›®çš„ipåœ°å€æ ¹æ®è·¯ç”±å’Œå¯¹ç«¯vxlançš„mac fdbè¡¨è·å–\n>\n> ä¼˜åŠ¿ï¼šåªè¦k8sèŠ‚ç‚¹é—´ä¸‰å±‚äº’é€šï¼Œå¯ä»¥è·¨ç½‘æ®µï¼Œå¯¹ä¸»æœºç½‘å…³è·¯ç”±æ²¡æœ‰ç‰¹æ®Šè¦æ±‚ã€‚å„ä¸ªnodeèŠ‚ç‚¹é€šè¿‡vxlanè®¾å¤‡å®ç°åŸºäºä¸‰å±‚çš„â€äºŒå±‚â€äº’é€šï¼Œä¸‰å±‚å³vxlanåŒ…å°è£…åœ¨udpæ•°æ®åŒ…ä¸­ï¼Œè¦æ±‚udpåœ¨k8sèŠ‚ç‚¹é—´ä¸‰å±‚å¯è¾¾ï¼›äºŒå±‚å³vxlanå°åŒ…çš„æºmacåœ°å€å’Œç›®çš„macåœ°å€æ˜¯è‡ªå·±çš„vxlanè®¾å¤‡macå’Œå¯¹ç«¯vxlanè®¾å¤‡mac\n>\n> ç¼ºç‚¹ï¼šéœ€è¦è¿›è¡Œvxançš„æ•°æ®åŒ…å°åŒ…å’Œè§£åŒ…ä¼šå­˜åœ¨ä¸€å®šçš„æ€§èƒ½æŸè€—\n\nCalicoé…ç½®å¼€å¯VXLAN\n\n```yaml\n#Enable IPIP\n-name:CALICO IPV4POOL IPIP\n-value:\"Never\"\n#Enable or Disable VXLAN on the default IP pool.\n-name:CALICO IPV4POOL VXLAN\n-value:\"Always\"\n#Enable or Disable VXLAN on the default IPv6 IP pool.\n-name:CALICO IPV6POOL VXLAN\n-value:\"Always\"\n\n\n#calico_backend:\"bird\"\ncalico_backend:\"vxlan\"\n\n#æ³¨é‡Šå­˜æ´»æ¢æµ‹å’Œå°±ç»ªæ¢æµ‹\n#--bird-live\n#--bird-ready\n```\n\n**Calicoç½‘ç»œæ¨¡å¼--IPIP**ï¼š\n\n> LinuxåŸç”Ÿå†…æ ¸æ”¯æŒ\n>\n> IPIPéš§é“çš„å·¥ä½œåŸç†æ˜¯å°†æºä¸»æœºçš„IPæ•°æ®åŒ…å°è£…åœ¨ä¸€ä¸ªæ–°çš„Pæ•°æ®åŒ…ä¸­ï¼Œæ–°çš„IPæ•°æ®åŒ…çš„ç›®çš„åœ°å€æ˜¯éš§é“çš„å¦ä¸€ç«¯ã€‚åœ¨éš§é“çš„å¦ä¸€ç«¯ï¼Œæ¥æ”¶æ–¹å°†è§£å°è£…åŸå§‹IPæ•°æ®åŒ…ï¼Œå¹¶å°†å…¶ä¼ é€’åˆ°ç›®æ ‡ä¸»æœºã€‚IPIPéš§é“å¯ä»¥åœ¨ä¸åŒçš„ç½‘ç»œä¹‹é—´å»ºç«‹è¿æ¥ï¼Œä¾‹å¦‚åœ¨IPV4ç½‘ç»œå’ŒIPV6ç½‘ç»œä¹‹é—´å»ºç«‹è¿æ¥ã€‚\n\n> æ•°æ®åŒ…å°åŒ…ï¼šå°åŒ…ï¼Œåœ¨tunl0è®¾å¤‡ä¸Šå°†podå‘æ¥çš„æ•°æ®åŒ…çš„macå±‚å»æ‰ï¼Œç•™ä¸‹ipå±‚å°åŒ…ã€‚\n> å¤–å±‚æ•°æ®åŒ…ç›®çš„ipåœ°å€æ ¹æ®è·¯ç”±å¾—åˆ°ã€‚\n> ä¼˜ç‚¹ï¼šåªè¦k8sèŠ‚ç‚¹é—´ä¸‰å±‚äº’é€šï¼Œå¯ä»¥è·¨ç½‘æ®µï¼Œå¯¹ä¸»æœºç½‘å…³è·¯ç”±æ²¡æœ‰ç‰¹æ®Šè¦æ±‚ã€‚\n> ç¼ºç‚¹ï¼šéœ€è¦è¿›è¡ŒIPIPçš„æ•°æ®åŒ…å°åŒ…å’Œè§£åŒ…ä¼šå­˜åœ¨ä¸€å®šçš„æ€§èƒ½æŸè€—\n\nCalicoé…ç½®å¼€å¯IPIP\n\n```yaml\n#Enable IPIP\n-name:CALICO IPV4POOL IPIP\n-value:\"Always\"\n#Enable or Disable VXLAN on the default IP pool.\n-name:CALICO IPV4POOL VXLAN\n-value:\"Never\"\n#Enable or Disable VXLAN on the default IPv6 IP pool.\n-name:CALICO IPV6POOL VXLAN\n-value:\"Never\"\n```\n\n**Calicoç½‘ç»œæ¨¡å¼--BGP**ï¼š\n\n> è¾¹ç•Œç½‘å…³åè®®(Border Gateway Protocol,.BGP)æ˜¯äº’è”ç½‘ä¸Šä¸€ä¸ªæ ¸å¿ƒçš„å»ä¸­å¿ƒåŒ–è‡ªæ²»è·¯ç”±åè®®ã€‚å®ƒé€šè¿‡ç»´æŠ¤IPè·¯ç”±è¡¨æˆ–â€˜å‰ç¼€'è¡¨æ¥å®ç°è‡ªæ²»ç³»ç»Ÿ(AS)ä¹‹é—´çš„å¯è¾¾æ€§ï¼Œå±äºé‡è·¯ç”±åè®®ã€‚BGPä¸ä½¿ç”¨ä¼ ç»Ÿçš„å†…éƒ¨ç½‘å…³åè®®(IGP)çš„æŒ‡æ ‡ï¼Œè€Œä½¿ç”¨åŸºäºè·¯å¾„ã€ç½‘ç»œç­–ç•¥æˆ–è§„åˆ™é›†æ¥å†³å®šè·¯ç”±ã€‚å› æ­¤ï¼Œå®ƒæ›´é€‚åˆè¢«ç§°ä¸ºçŸ¢é‡æ€§åè®®ï¼Œè€Œä¸æ˜¯è·¯ç”±åè®®ã€‚BGPï¼Œé€šä¿—çš„è®²å°±æ˜¯è®²æ¥å…¥åˆ°æœºæˆ¿çš„å¤šæ¡çº¿è·¯ï¼ˆå¦‚ç”µä¿¡ã€è”é€šï¼Œç§»åŠ¨ç­‰ï¼‰èåˆä¸ºä¸€ä½“ï¼Œå®ç°å¤šçº¿å•IP,BGPæœºæˆ¿çš„ä¼˜ç‚¹ï¼šæœåŠ¡å™¨åªéœ€è¦è®¾ç½®ä¸€ä¸ªIPåœ°å€ï¼Œæœ€ä½³è®¿é—®è·¯ç”±æ˜¯ç”±ç½‘ç»œä¸Šçš„éª¨å¹²è·¯ç”±å™¨æ ¹æ®è·¯ç”±è·³æ•°ä¸å…¶å®ƒæŠ€æœ¯æŒ‡æ ‡æ¥ç¡®å®šçš„ï¼Œä¸ä¼šå ç”¨æœåŠ¡å™¨çš„ä»»ä½•ç³»ç»Ÿã€‚\n\n> æ•°æ®åŒ…å°åŒ…ï¼šä¸éœ€è¦è¿›è¡Œæ•°æ®åŒ…å°åŒ…\n>\n> ä¼˜ç‚¹ï¼šä¸ç”¨å°åŒ…è§£åŒ…ï¼Œé€šè¿‡BGPåè®®å¯å®ç°podç½‘ç»œåœ¨ä¸»æœºé—´çš„ä¸‰å±‚å¯è¾¾\n>\n> ç¼ºç‚¹ï¼šè·¨ç½‘æ®µæ—¶ï¼Œé…ç½®è¾ƒä¸ºå¤æ‚ç½‘ç»œè¦æ±‚è¾ƒé«˜ï¼Œä¸»æœºç½‘å…³è·¯ç”±ä¹Ÿéœ€è¦å……å½“BGP Speakerã€‚.\n\nCalicoé…ç½®å¼€å¯BGP\n\n```yaml\n#Enable IPIP\n-name:CALICO IPV4POOL IPIP\n-value:\"Off\"\n#Enable or Disable VXLAN on the default IP pool.\n-name:CALICO IPV4POOL VXLAN\n-value:\"Never\"\n#Enable or Disable VXLAN on the default IPv6 IP pool.\n-name:CALICO IPV6POOL VXLAN\n-value:\"Never\"\n```\n\n## Service\n\nåœ¨Kubernetesé›†ç¾¤ä¸­ï¼Œæ¯ä¸ªNodeè¿è¡Œä¸€ä¸ª`kube-proy`è¿›ç¨‹ã€‚`kube-proxy`è´Ÿè´£ä¸ºServiceå®ç°äº†ä¸€ç§VIP(è™šæ‹ŸIP)çš„å½¢å¼ã€‚\n\nåœ¨Kubernetes v1.0ç‰ˆæœ¬ï¼Œä»£ç†å®Œå…¨åœ¨userspaceã€‚åœ¨Kubernetes v1.1ç‰ˆæœ¬ï¼Œæ–°å¢äº†iptablesä»£ç†ï¼Œä½†å¹¶ä¸æ˜¯é»˜è®¤çš„è¿è¡Œæ¨¡å¼ã€‚ä»Kubernetes v1.2èµ·ï¼Œé»˜è®¤å°±æ˜¯iptablesä»£ç†ã€‚åœ¨Kubernetes v1.8.0-beta.0ä¸­ï¼Œæ·»åŠ äº†ipvsä»£ç†ã€‚\n\n**userspace**\n\nkube-proxyï¼š\n\n- ç›‘å¬APISERVERå°†Serviceçš„å˜åŒ–ä¿®æ”¹æœ¬åœ°çš„iptablesè§„åˆ™\n- ä»£ç†å½“å‰èŠ‚ç‚¹çš„podç”¨æˆ·è¯·æ±‚\n\n![img](k8sçŸ¥è¯†æ¢³ç†--è¿›é˜¶/3.png)\n\n**Iptables**\n\nkube-proxyï¼š\n\n- ç›‘å¬APISERVERå°†Serviceçš„å˜åŒ–ä¿®æ”¹æœ¬åœ°çš„iptablesè§„åˆ™\n\nç›¸å¯¹äºuserspaceæ–¹å¼ï¼Œkube-proxyåŠŸèƒ½è§£è€¦å‹åŠ›æ›´å°\n\n![img](k8sçŸ¥è¯†æ¢³ç†--è¿›é˜¶/4.png)\n\n**ipvs**\n\nkube-proxyï¼š\n\n- ç›‘å¬APISERVERå°†Serviceçš„å˜åŒ–ä¿®æ”¹æœ¬åœ°çš„ipvsè§„åˆ™\n\n![img](k8sçŸ¥è¯†æ¢³ç†--è¿›é˜¶/5.png)\n\n## Secret\n\nKubernetesé€šè¿‡ä»…ä»…å°†Secretåˆ†å‘åˆ°éœ€è¦è®¿é—®Secretçš„Podæ‰€åœ¨çš„æœºå™¨èŠ‚ç‚¹æ¥ä¿éšœå…¶å®‰å…¨æ€§ã€‚Secretåªä¼šå­˜å‚¨åœ¨èŠ‚ç‚¹çš„å†…å­˜ä¸­ï¼Œæ°¸ä¸å†™å…¥ç‰©ç†å­˜å‚¨ï¼Œè¿™æ ·ä»èŠ‚ç‚¹åˆ é™¤secretæ—¶å°±ä¸éœ€è¦æ“¦é™¤ç£ç›˜æ•°æ®ã€‚\n\nä»Kubernetes1.7ç‰ˆæœ¬å¼€å§‹ï¼Œetcdä¼šä»¥åŠ å¯†å½¢å¼å­˜å‚¨Secret,.ä¸€å®šç¨‹åº¦çš„ä¿è¯äº†Secretå®‰å…¨æ€§ã€‚\n\n**Secretç±»å‹**ï¼š\n\n![image-20250710174515895](k8sçŸ¥è¯†æ¢³ç†--è¿›é˜¶/6.png)\n\n## Downward API\n\nDownward APIæ˜¯Kubernetesä¸­çš„ä¸€ä¸ªåŠŸèƒ½ï¼Œå®ƒå…è®¸å®¹å™¨åœ¨è¿è¡Œæ—¶ä»Kubernetes APIæœåŠ¡å™¨è·å–æœ‰å…³å®ƒä»¬è‡ªèº«çš„ä¿¡æ¯ã€‚è¿™äº›ä¿¡æ¯å¯ä»¥ä½œä¸ºå®¹å™¨å†…éƒ¨çš„ç¯å¢ƒå˜é‡æˆ–æ–‡ä»¶æ³¨å…¥åˆ°å®¹å™¨ä¸­ï¼Œä»¥ä¾¿å®¹å™¨å¯ä»¥è·å–æœ‰å…³å…¶è¿è¡Œç¯å¢ƒçš„å„ç§ä¿¡æ¯ï¼Œå¦‚Podåç§°ã€å‘½åç©ºé—´ã€æ ‡ç­¾ç­‰\n\n- æä¾›å®¹å™¨å…ƒæ•°æ®\n- åŠ¨æ€é…ç½®\n- ä¸Kubernetesç¯å¢ƒé›†æˆ\n\n## HELM\n\nHelmæ˜¯å®˜æ–¹æä¾›çš„ç±»ä¼¼äºYUMçš„åŒ…ç®¡ç†å™¨ï¼Œæ˜¯éƒ¨ç½²ç¯å¢ƒçš„æµç¨‹å°è£…ã€‚Helmæœ‰ä¸¤ä¸ªé‡è¦çš„æ…¨å¿µï¼šchartå’Œrelease\n\n- Chartï¼šæ˜¯åˆ›å»ºä¸€ä¸ªåº”ç”¨çš„ä¿¡æ¯é›†åˆï¼ŒåŒ…æ‹¬å„ç§Kuberneteså¯¹è±¡çš„é…ç½®æ¨¡æ¿ã€å‚æ•°å®šä¹‰ã€ä¾èµ–å…³ç³»ã€æ–‡æ¡£è¯´æ˜ç­‰ã€‚chartæ˜¯åº”ç”¨éƒ¨ç½²çš„è‡ªåŒ…å«é€»è¾‘å•å…ƒã€‚å¯ä»¥å°†chartæƒ³è±¡æˆaptã€yumä¸­çš„è½¯ä»¶å®‰è£…åŒ…\n- Releaseï¼šæ˜¯chartçš„è¿è¡Œå®ä¾‹ï¼Œä»£è¡¨äº†ä¸€ä¸ªæ­£åœ¨è¿è¡Œçš„åº”ç”¨ã€‚å½“chartè¢«å®‰è£…åˆ°Kubernetesé›†ç¾¤ï¼Œå°±ç”Ÿæˆä¸€ä¸ªreleaseã€‚chartèƒ½å¤Ÿå¤šæ¬¡å®‰è£…åˆ°åŒä¸€ä¸ªé›†ç¾¤ï¼Œæ¯æ¬¡å®‰è£…éƒ½æ˜¯ä¸€ä¸ªreleaseã€‚\n- Hlelm cliï¼šhelmå®¢æˆ·ç«¯ç»„ä»¶ï¼Œè´Ÿè´£å’Œkubernetes apiserveré€šä¿¡\n- Repositoryï¼šç”¨äºå‘å¸ƒå’Œå­˜å‚¨Chartçš„ä»“åº“\n\n### ä¸‹è½½å®‰è£…\n\nä¸‹è½½Helm\n\n```shell\nwget https://get.helm.sh/helm-v3.18.4-linux-amd64.tar.gz\ntar -zxvf helm-v3.18.4-linux-amd64.tar.gz\ncp -a linux-amd64/helm /usr/local/bin/\nchmod a+x /usr/local/bin/helm\nhelm version\n```\n\næ·»åŠ chartä»“åº“å›½å†…æº\n\n```shell\nhelm repo add bitnami https://helm-charts.itboon.top/bitnami --force-update\nhelm repo update\n#æœç´¢ä»“åº“å†…å®¹\nhelm search repo bitnami\n```\n\n### å®‰è£…chartç¤ºä¾‹\n\n```shell\n#æŸ¥çœ‹apacheåŒ…é…ç½®\nhelm show values bitnami/apache\n#å®‰è£…apache\nhelm install bitnami/apache --generate-name\n#æŸ¥çœ‹\nhelm list -n default\nkubectl get svc\nkubectl get pod\n\n#æŸ¥çœ‹chartåŸºæœ¬ä¿¡æ¯\nhelm show chart bitnami/apache\n#æŸ¥çœ‹chartæ‰€æœ‰ä¿¡æ¯\nhelm show all bitnami/apache\n\n#åˆ é™¤ç‰ˆæœ¬\nhelm uninstall apache-1753181984\n#ä¿ç•™å†å²ç‰ˆæœ¬\nhelm uninstall apache-1753181984 --keep-history\n\n#æŸ¥çœ‹è¯¥ç‰ˆæœ¬çš„ä¿¡æ¯\nhelm status apache-1753182488\n```\n\næ‹“å±•\n\n```shell\n#åœ¨å½“å‰ä»“åº“ä¸­æœç´¢wordpressçš„cahrtåŒ…\nhelm search repo wordpress\n#åœ¨å®˜æ–¹ä»“åº“ä¸­æœç´¢wordpressçš„cahrtåŒ…\nhelm search hub wordpress\n\n#å®‰è£…apacheå¹¶æŒ‡å®šåç§°ä¸ºapache-1753234488\nhelm install apache-1753234488 bitnami/apache \n```\n\nå®‰è£…è‡ªå®šä¹‰chart\n\n```shell\n#æŸ¥çœ‹apacheåŒ…é…ç½®\nhelm show values bitnami/apache\n\n#åˆ›å»ºyamlæ–‡ä»¶ï¼Œæ·»åŠ è¦ä¿®æ”¹çš„å‚æ•°\nvi apache.yml\nservice:\n  type: NodePort\n\n#è¦†ç›–é…ç½®å‚æ•°ï¼Œå¹¶å®‰è£…apache\nhelm install -f apache.yml bitnami/apache --generate-name\n```\n\né™¤äº†ä½¿ç”¨yamlæ–‡ä»¶è¦†ç›–å¤–ï¼Œè¿˜å¯ä»¥ä½¿ç”¨`--setï¼š`é€šè¿‡å‘½ä»¤è¡Œçš„æ–¹å¼å¯¹æŒ‡å®šé¡¹è¿›è¡Œè¦†ç›–ã€‚å¦‚æœåŒæ—¶ä½¿ç”¨ä¸¤ç§æ–¹å¼ï¼Œåˆ™`--set`ä¸­çš„å€¼ä¼šè¢«åˆå¹¶åˆ°`--values`ä¸­ï¼Œä½†æ˜¯`--set`ä¸­çš„å€¼ä¼˜å…ˆçº§æ›´é«˜ï¼Œåœ¨`--set`ä¸­è¦†ç›–çš„å†…å®¹ä¼šè¢«è¢«ä¿å­˜åœ¨ConfigMapä¸­ã€‚å¯ä»¥é€šè¿‡`helm get values <release-name>`æ¥æŸ¥çœ‹æŒ‡å®šreleaseä¸­`--set`è®¾ç½®çš„å€¼ã€‚ä¹Ÿå¯ä»¥é€šè¿‡è¿è¡Œ`helm upgrade`å¹¶æŒ‡å®š`--reset-values`å­—æ®µæ¥æ¸…é™¤`--set`ä¸­è®¾ç½®çš„å€¼ã€‚\n\n`--set`çš„æ ¼å¼å’Œé™åˆ¶\n\n`--set`é€‰é¡¹ä½¿ç”¨0æˆ–å¤šä¸ªname/valueå¯¹ã€‚æœ€ç®€å•çš„ç”¨æ³•ç±»ä¼¼äºï¼š`--set name=value`,ç­‰ä»·äºå¦‚ä¸‹YAMLæ ¼å¼ï¼š\n\n```yaml\nname:value\n```\n\nå¤šä¸ªå€¼ä½¿ç”¨é€—å·åˆ†å‰²ï¼Œå› æ­¤`--set a=b,c=d`çš„YAMLè¡¨ç¤ºæ˜¯ï¼š\n\n```yaml\na: b\nc: d\n```\n\næ”¯æŒæ›´å¤æ‚çš„è¡¨è¾¾å¼ã€‚ä¾‹å¦‚ï¼Œ`--set outer.inner=value`è¢«è½¬æ¢æˆäº†ï¼š\n\n```\nouter:\n  inner: value\n```\n\nåˆ—è¡¨ä½¿ç”¨èŠ±æ‹¬å·(`{}`)æ¥è¡¨ç¤ºï¼Œä¾‹å¦‚ï¼Œ`--set name={a,b,c}`è¢«è½¬æ¢æˆäº†ï¼š\n\n```yaml\nname:\n  -a\n  -b\n  -c\n```\n\næŸäº›name/keyå¯ä»¥è®¾ç½®ä¸ºnullæˆ–è€…ç©ºæ•°ç»„ï¼Œä¾‹å¦‚`--set name=[],a=null`\n\n```yaml\nname: []\na: null\n```\n\n### å‡çº§å’Œå›æ»š\n\n`helm upgrade`æ‰§è¡Œæœ€å°ä¾µå…¥å¼å‡çº§ï¼Œåªæ›´æ–°ä¸Šæ¬¡å‘å¸ƒä»¥æ¥å‘ç”Ÿæ›´æ”¹çš„å†…å®¹ã€‚\n\n```shell\n#helm upgrade -f yamlæ–‡ä»¶ ç‰ˆæœ¬å chartåŒ…\nhelm upgrade -f apache.yml apache-1753183272 bitnami/apache\n```\n\nç‰ˆæœ¬å›æ»š\n\n```shell\n#æŸ¥çœ‹å­˜åœ¨çš„ç‰ˆæœ¬\n#helm history ç‰ˆæœ¬å\nhelm history apache-1753183272\n#æ‰§è¡Œå›æ»š\n#helm rollback ç‰ˆæœ¬å ç‰ˆæœ¬å·\nhelm rollback apache-1753183272 1\n```\n\n### åˆ›å»ºè‡ªå®šä¹‰chartåŒ…\n\n```shell\n#åˆ›å»ºchartåŒ…\nhelm create test\n#åˆ é™¤ä¸éœ€è¦çš„æ–‡ä»¶\n#åœ¨templatesä¸­åˆ›å»ºyamlèµ„æºæ¸…å•\nvi nodePort.yaml\n############################\napiVersion: v1\nkind: Service\nmetadata:\n  name: myapp-test-202401110926-svc\n  labels:\n    app: myapp-test\nspec:\n  type: NodePort\n  selector:\n    app: myapp-test\n  ports:\n    - name: \"80-80\"\n      protocol: TCP\n      port: 80\n      targetPort: 80\n      nodePort: 31111\n############################\nvi deplyment.yaml\n############################\napiVersion: apps/v1\nkind: Deployment\nmetadata:\n  name: myapp-test-202401110926-deploy\n  labels:\n    app: myapp-test\nspec:\n  replicas: 5\n  selector:\n    matchLabels:\n      app: myapp-test\n  template:\n    metadata:\n      labels:\n        app: myapp-test\n    spec:\n      containers:\n        - name: myapp\n          image: wangyanglinux/myapp:v1.0\n############################\n#å‘å¸ƒéƒ¨ç½²\nhelm install test test/\n```\n\nå®Œæ•´ç¤ºä¾‹\n\n```shell\nvi templates/NOTES.txt\n############################\n1. è¿™æ˜¯ä¸€ä¸ªæµ‹è¯•çš„ myapp chart\n2. myapp release åå­—ï¼šmyapp-test-{{ now | date \"20060102030405\" }}-deploy\n3. service åå­—ï¼šmyapp-test-{{ now | date \"20060102030405\" }}-svc\n############################\nvi templates/deplyment.yaml\n############################\napiVersion: apps/v1\nkind: Deployment\nmetadata:\n  name: myapp-test-{{ now | date \"20060102030405\" }}-deploy\n  labels:\n    app: myapp-test\nspec:\n  replicas: {{ .Values.replicaCount }}\n  selector:\n    matchLabels:\n      app: myapp-test\n  template:\n    metadata:\n      labels:\n        app: myapp-test\n    spec:\n      containers:\n        - name: myapp\n          image: \"{{ .Values.image.repository }}:{{ .Values.image.tag }}\"\n\n############################\nvi templates/service.yaml\n############################\napiVersion: v1\nkind: Service\nmetadata:\n  name: myapp-test-{{ now | date \"20060102030405\" }}-svc\n  labels:\n    app: myapp-test\nspec:\n  type: {{ .Values.service.type | quote }}\n  selector:\n    app: myapp-test\n  ports:\n    - name: \"80-80\"\n      protocol: TCP\n      port: 80\n      targetPort: 80\n      {{- if eq .Values.service.type \"NodePort\" }}\n      nodePort: {{ .Values.service.nodePort }}\n      {{- end }}\n############################\n#ä¸templatesç›®å½•åŒä¸€çº§\nvi values.yaml\n############################\nreplicaCount: 5\nimage:\n  repository: wangyanglinux/myapp\n  tag: \"v1.0\"  \n\n\nservice:\n  type: NodePort\n  nodePort: 32321  \n############################\n```\n\n## äºŒè¿›åˆ¶é«˜å¯ç”¨Kubernetesé›†ç¾¤éƒ¨ç½²\n\n### å‰è¨€\n\né€šè¿‡5å°æœåŠ¡å™¨ä½¿ç”¨äºŒè¿›åˆ¶æ–¹å¼éƒ¨ç½²é‡‡ç”¨ä¸‰ä¸»ä¸¤ä»çš„é«˜å¯ç”¨Kubernetesé›†ç¾¤ã€‚\n\n### é›†ç¾¤æ¶æ„\n\nï¼ˆ1ï¼‰åŸºç¡€ç¯å¢ƒ\n\næ“ä½œç³»ç»Ÿï¼šRocky Linux release 10.0\n\nè½¯ä»¶ï¼šKubernetes-1.33.4ã€docker-28.3.3\n\nï¼ˆ2ï¼‰ç¯å¢ƒå‡†å¤‡\n\n| ä¸»æœºå       | IP            | é›†ç¾¤åŠç»„ä»¶è§’è‰²                                               |\n| ------------ | ------------- | ------------------------------------------------------------ |\n| k8s-master01 | 192.168.0.111 | masterï¼Œapi-serverï¼Œcontrol managerï¼Œschedulerï¼Œetcdï¼Œ<br />kubeletï¼Œkube-proxyï¼Œnginx |\n| k8s-master02 | 192.168.0.112 | masterï¼Œapi-serverï¼Œcontrol managerï¼Œschedulerï¼Œetcdï¼Œ<br />kubeletï¼Œkube-proxyï¼Œnginx |\n| k8s-master03 | 192.168.0.113 | masterï¼Œapi-serverï¼Œcontrol managerï¼Œschedulerï¼Œetcdï¼Œ<br />kubeletï¼Œkube-proxyï¼Œnginx |\n| k8s-node01   | 192.168.0.114 | workerï¼Œkubeletï¼Œkube-proxyï¼Œnginx                           |\n| k8s-node02   | 192.168.0.115 | workerï¼Œkubeletï¼Œkube-proxyï¼Œnginx                           |\n\n### ç¯å¢ƒåˆå§‹åŒ–\n\nï¼ˆ1ï¼‰æ›´æ¢ç³»ç»Ÿè½¯ä»¶æºï¼Œä¸‹è½½ä¾èµ–è½¯ä»¶\n\n```shell\nsed -e 's|^mirrorlist=|#mirrorlist=|g' \\\n    -e 's|^#baseurl=http://dl.rockylinux.org/$contentdir|baseurl=https://mirrors.aliyun.com/rockylinux|g' \\\n    -i.bak \\\n    /etc/yum.repos.d/[Rr]ocky*.repo\n\ndnf makecache\n#ä¸‹è½½ä¾èµ–è½¯ä»¶\nyum install -y wget openssl gcc gcc-c++ zlib-devel openssl-devel make redhat-rpm-config\n```\n\nï¼ˆ2ï¼‰é‡å‘½åhostname\n\n```shell\nhostnamectl set-hostname k8s-master01 && bash\nhostnamectl set-hostname k8s-master02 && bash\nhostnamectl set-hostname k8s-node01 && bash\nhostnamectl set-hostname k8s-node02 && bash\nhostnamectl set-hostname k8s-node03 && bash\n```\n\nï¼ˆ3ï¼‰ç³»ç»Ÿç¯å¢ƒä¿®æ”¹\n\n```shell\n#å…³é—­firewalldé˜²ç«å¢™\nsystemctl stop firewalld\nsystemctl disable firewalld\nfirewall-cmd --state\n\n#å®‰è£…iptables\nyum install -y iptables-services\nsystemctl start iptables\niptables -F\nsystemctl enable iptables\n\n# selinuxæ°¸ä¹…å…³é—­\nsetenforce 0\n sed -i 's/^SELINUX=enforcing$/SELINUX=disabled/' /etc/selinux/config\ncat /etc/selinux/config\n\n# swapæ°¸ä¹…å…³é—­\nswapoff -a\nsed -ri 's/.*swap.*/#&/' /etc/fstab\ncat /etc/fstab\n\n# è®¾ç½®æ—¶åŒº\ntimedatectl set-timezone Asia/Shanghai\ndate\n\n# æ·»åŠ hosts\ncat >> /etc/hosts << EOF\n192.168.0.111 k8s-master01\n192.168.0.112 k8s-master02\n192.168.0.113 k8s-master03\n192.168.0.114 k8s-node01\n192.168.0.115 k8s-node02\nEOF\n#æŸ¥çœ‹\ncat /etc/hosts\n```\n\nï¼ˆ4ï¼‰å®‰è£…ipvs\n\n```shell\n# å®‰è£…ipvs\nyum -y install ipvsadm sysstat conntrack libseccomp\n\n# å¼€å¯è·¯ç”±è½¬å‘\necho 'net.ipv4.ip_forward=1' >> /etc/sysctl.conf\nsysctl -p\n\n#ipvsåŠ è½½æ¨¡å—\ncat >> /etc/modules-load.d/ipvs.conf <<EOF\nip_vs\nip_vs_rr\nip_vs_wrr\nip_vs_sh\nnf_conntrack\nip_tables\nip_set\nxt_set\nipt_set\nipt_rpfilter\nipt_REJECT\nipip\nEOF\n\nsystemctl restart systemd-modules-load.service\n\nlsmod | grep -e ip_vs -e nf_conntrack\n```\n\nï¼ˆ5ï¼‰æ’é™¤ calico ç½‘å¡è¢« NetworkManager æ‰€ç®¡ç†\n\n```shell\n# æ’é™¤ calico ç½‘å¡è¢« NetworkManager æ‰€ç®¡ç†\ncat > /etc/NetworkManager/conf.d/calico.conf << EOF \n[keyfile]\nunmanaged-devices=interface-name:cali*;interface-name:tunl*\nEOF\n\nsystemctl restart NetworkManager\n```\n\nï¼ˆ6ï¼‰é…ç½®æ—¶é—´åŒæ­¥æœåŠ¡å™¨\n\n```shell\n#ä¿®æ”¹k8s-master01ä¸Šçš„chronyé…ç½®æ–‡ä»¶\nsed -i -e 's/2\\.rocky\\.pool\\.ntp\\.org/ntp.aliyun.com/g' -e 's/#allow 192\\.168\\.0\\.0\\/16/allow 192.168.0.0\\/24/g' -e 's/#local stratum 10/local stratum 10/g' /etc/chrony.conf\n\n#ä¿®æ”¹k8s-master02ä¸Šçš„chronyé…ç½®æ–‡ä»¶\nsed -i -e 's/2\\.rocky\\.pool\\.ntp\\.org/ntp.aliyun.com/g' -e 's/#allow 192\\.168\\.0\\.0\\/16/allow 192.168.0.0\\/24/g' -e 's/#local stratum 10/local stratum 11/g' /etc/chrony.conf\n\n#ä¿®æ”¹k8s-master03ä¸Šçš„chronyé…ç½®æ–‡ä»¶\nsed -i -e 's/2\\.rocky\\.pool\\.ntp\\.org/ntp.aliyun.com/g' -e 's/#allow 192\\.168\\.0\\.0\\/16/allow 192.168.0.0\\/24/g' -e 's/#local stratum 10/local stratum 12/g' /etc/chrony.conf\n\n#ä¿®æ”¹k8s-node01ã€k8s-node02ã€k8s-node03ä¸Šçš„chronyé…ç½®æ–‡ä»¶\nsed -i 's/^pool 2\\.rocky\\.pool\\.ntp\\.org iburst$/pool 192.168.0.111 iburst\\\npool 192.168.0.112 iburst\\\npool 192.168.0.113 iburst/g' /etc/chrony.conf\n\n#é‡å¯chronyd\nsystemctl restart chronyd\n\n#éªŒè¯\nchronyc sources -v\n```\n\nï¼ˆ7ï¼‰è®¾ç½®è¿›ç¨‹å¯æ‰“å¼€çš„æœ€å¤§æ–‡ä»¶æ•°\n\n```shell\n# é…ç½® ulimit\nulimit -SHn 65535\n\ncat >> /etc/security/limits.conf << EOF\n* soft nofile 655360\n* hard nofile 131072\n* soft nproc 655350\n* hard nproc 655350\n* soft memlock unlimited\n* hard memlock unlimitedd\nEOF\n```\n\nï¼ˆ8ï¼‰ä¿®æ”¹å†…æ ¸å‚æ•°\n\n```shell\ncat <<EOF > /etc/sysctl.d/k8s.conf\nnet.ipv4.ip_forward = 1\nnet.bridge.bridge-nf-call-iptables = 1\nfs.may_detach_mounts = 1\nvm.overcommit_memory=1\nvm.panic_on_oom=0\nfs.inotify.max_user_watches=89100\nfs.file-max=52706963\nfs.nr_open=52706963\nnet.netfilter.nf_conntrack_max=2310720\nnet.ipv4.tcp_keepalive_time = 600\nnet.ipv4.tcp_keepalive_probes = 3\nnet.ipv4.tcp_keepalive_intvl =15\nnet.ipv4.tcp_max_tw_buckets = 36000\nnet.ipv4.tcp_tw_reuse = 1\nnet.ipv4.tcp_max_orphans = 327680\nnet.ipv4.tcp_orphan_retries = 3\nnet.ipv4.tcp_syncookies = 1\nnet.ipv4.tcp_max_syn_backlog = 16384\nnet.ipv4.ip_conntrack_max = 65536\nnet.ipv4.tcp_max_syn_backlog = 16384\nnet.ipv4.tcp_timestamps = 0\nnet.core.somaxconn = 16384\nnet.ipv6.conf.all.disable_ipv6 = 0\nnet.ipv6.conf.default.disable_ipv6 = 0\nnet.ipv6.conf.lo.disable_ipv6 = 0\nnet.ipv6.conf.all.forwarding = 1\nEOF\n\nsysctl --system\n```\n\n### å®‰è£…docker\n\nï¼ˆ1ï¼‰ä½¿ç”¨è„šæœ¬å®‰è£…docker\n\n```shell\nbash <(curl -sSL https://linuxmirrors.cn/docker.sh)\n```\n\nï¼ˆ2ï¼‰Dockeré…ç½®ä¿®æ”¹\n\n```shell\ncat >/etc/docker/daemon.json <<EOF\n{\n  \"exec-opts\": [\"native.cgroupdriver=systemd\"],\n  \"registry-mirrors\": [\n   \"http://hub-mirror.c.163.com\",\n   \"https://hub.rat.dev\",\n   \"https://docker.mirrors.ustc.edu.cn\",\n   \"https://docker.1panel.live\",\n   \"https://docker.m.daocloud.io\",\n   \"https://docker.1ms.run\"\n  ],\n  \"max-concurrent-downloads\": 10,\n  \"log-driver\": \"json-file\",\n  \"log-level\": \"warn\",\n  \"log-opts\": {\n    \"max-size\": \"10m\",\n    \"max-file\": \"3\"\n    },\n  \"data-root\": \"/data/dockerData\"\n}\nEOF\n\nsystemctl daemon-reload\nsystemctl restart docker\n```\n\n### å®‰è£…cri-dockerd\n\nï¼ˆ1ï¼‰ä¸‹è½½å®‰è£…cri-dockerd\n\n```shell\nwget https://github.com/Mirantis/cri-dockerd/releases/download/v0.3.18/cri-dockerd-0.3.18.amd64.tgz\n\ntar xvf cri-dockerd-*.amd64.tgz \ncp -r cri-dockerd/*  /usr/bin/\nchmod +x /usr/bin/cri-dockerd\n```\n\nï¼ˆ2ï¼‰æ·»åŠ cri-dockeræœåŠ¡é…ç½®æ–‡ä»¶\n\n```\ncat >  /usr/lib/systemd/system/cri-docker.service <<EOF\n[Unit]\nDescription=CRI Interface for Docker Application Container Engine\nDocumentation=https://docs.mirantis.com\nAfter=network-online.target firewalld.service docker.service\nWants=network-online.target\nRequires=cri-docker.socket\n\n[Service]\nType=notify\nExecStart=/usr/bin/cri-dockerd --network-plugin=cni --pod-infra-container-image=registry.aliyuncs.com/google_containers/pause:3.10\nExecReload=/bin/kill -s HUP $MAINPID\nTimeoutSec=0\nRestartSec=2\nRestart=always\nStartLimitBurst=3\nStartLimitInterval=60s\nLimitNOFILE=infinity\nLimitNPROC=infinity\nLimitCORE=infinity\nTasksMax=infinity\nDelegate=yes\nKillMode=process\n\n[Install]\nWantedBy=multi-user.target\nEOF\n```\n\nï¼ˆ3ï¼‰æ·»åŠ cri-dockerçš„socketé…ç½®æ–‡ä»¶\n\n```shell\ncat > /usr/lib/systemd/system/cri-docker.socket <<EOF\n[Unit]\nDescription=CRI Docker Socket for the API\nPartOf=cri-docker.service\n\n[Socket]\nListenStream=%t/cri-dockerd.sock\nSocketMode=0660\nSocketUser=root\nSocketGroup=docker\n\n[Install]\nWantedBy=sockets.target\nEOF\n```\n\nï¼ˆ4ï¼‰å¯åŠ¨cri-dockerdï¼Œä½¿å¾—é…ç½®ç”Ÿæ•ˆ\n\n```shell\nsystemctl daemon-reload\nsystemctl enable --now cri-docker.service\nsystemctl status cri-docker.service\n```\n\n### å®‰è£…etcdé›†ç¾¤ï¼ˆmasterèŠ‚ç‚¹ï¼‰\n\nï¼ˆ1ï¼‰ä¸‹è½½etcdåŒ…å¹¶å®‰è£…\n\n```shell\nwget https://github.com/etcd-io/etcd/releases/download/v3.6.4/etcd-v3.6.4-linux-amd64.tar.gz\n\ntar -xf etcd-*.tar.gz\nmv etcd-*/etcd /usr/local/bin/ && mv etcd-*/etcdctl /usr/local/bin/\nls /usr/local/bin/\netcdctl version\n```\n\n### å®‰è£…Kubernetesé›†ç¾¤\n\nï¼ˆ1ï¼‰ä¸‹è½½KubernetesäºŒè¿›åˆ¶åŒ…å¹¶å®‰è£…\n\n```shell\nwget https://dl.k8s.io/v1.33.2/kubernetes-server-linux-amd64.tar.gz\n\n#åœ¨masterèŠ‚ç‚¹æ‰§è¡Œ\ntar -xf kubernetes-server-linux-amd64.tar.gz  --strip-components=3 -C /usr/local/bin kubernetes/server/bin/kube{let,ctl,-apiserver,-controller-manager,-scheduler,-proxy}\n#åœ¨nodeèŠ‚ç‚¹æ‰§è¡Œ\ntar -xf kubernetes-server-linux-amd64.tar.gz  --strip-components=3 -C /usr/local/bin kubernetes/server/bin/kube{let,-proxy}\n\nls /usr/local/bin/\nkubelet --version\n# æ‰€æœ‰èŠ‚ç‚¹æ‰§è¡Œï¼Œå­˜æ”¾cniæ’ä»¶\nmkdir -p /opt/cni/bin\n```\n\n### ç”Ÿæˆç›¸å…³è¯ä¹¦ï¼ˆmasterèŠ‚ç‚¹ï¼‰\n\n#### å®‰è£…cfsslè¯ä¹¦ç®¡ç†å·¥å…·\n\n```shell\nwget https://hub.gitmirror.com/https://github.com/cloudflare/cfssl/releases/download/v1.6.5/cfssl-certinfo_1.6.5_linux_amd64 -O /usr/local/bin/cfssl-certinfo\nwget https://hub.gitmirror.com/https://github.com/cloudflare/cfssl/releases/download/v1.6.5/cfssljson_1.6.5_linux_amd64 -O /usr/local/bin/cfssljson\nwget https://hub.gitmirror.com/https://github.com/cloudflare/cfssl/releases/download/v1.6.5/cfssl_1.6.5_linux_amd64 -O /usr/local/bin/cfssl -O /usr/local/bin/cfssl\n\n#æ·»åŠ å¯æ‰§è¡Œæƒé™ï¼ŒæŸ¥çœ‹ç‰ˆæœ¬\nchmod +x /usr/local/bin/cfssl*\ncfssl version\n```\n\n#### ç”ŸæˆETCDè¯ä¹¦\n\n```shell\nmkdir -p /etc/etcd/ssl && cd /etc/etcd/ssl\n\n#åˆ›å»ºç”Ÿæˆè¯ä¹¦çš„é…ç½®æ–‡ä»¶\ncat > ca-config.json << EOF \n{\n  \"signing\": {\n    \"default\": {\n      \"expiry\": \"876000h\"\n    },\n    \"profiles\": {\n      \"kubernetes\": {\n        \"usages\": [\n            \"signing\",\n            \"key encipherment\",\n            \"server auth\",\n            \"client auth\"\n        ],\n        \"expiry\": \"876000h\"\n      }\n    }\n  }\n}\nEOF\n\n#åˆ›å»ºè¯ä¹¦ç­¾å‘è¯·æ±‚æ–‡ä»¶\ncat > etcd-ca-csr.json  << EOF \n{\n  \"CN\": \"etcd\",\n  \"key\": {\n    \"algo\": \"rsa\",\n    \"size\": 2048\n  },\n  \"names\": [\n    {\n      \"C\": \"CN\",\n      \"ST\": \"Beijing\",\n      \"L\": \"Beijing\",\n      \"O\": \"etcd\",\n      \"OU\": \"Etcd Security\"\n    }\n  ],\n  \"ca\": {\n    \"expiry\": \"876000h\"\n  }\n}\nEOF\n```\n\nç­¾å‘ETCDçš„CAè¯ä¹¦å’Œå¯†é’¥\n\n```shell\ncfssl gencert -initca etcd-ca-csr.json | cfssljson -bare /etc/etcd/ssl/etcd-ca\n```\n\nåˆ›å»ºç”¨äºç”ŸæˆETCDçš„æœåŠ¡ç«¯è¯ä¹¦çš„é…ç½®æ–‡ä»¶\n\n```shell\ncat > etcd-csr.json << EOF \n{\n  \"CN\": \"etcd\",\n  \"key\": {\n    \"algo\": \"rsa\",\n    \"size\": 2048\n  },\n  \"names\": [\n    {\n      \"C\": \"CN\",\n      \"ST\": \"Beijing\",\n      \"L\": \"Beijing\",\n      \"O\": \"etcd\",\n      \"OU\": \"Etcd Security\"\n    }\n  ]\n}\nEOF\n```\n\nç­¾å‘ETCDçš„æœåŠ¡ç«¯è¯ä¹¦\n\n```\ncfssl gencert    -ca=/etc/etcd/ssl/etcd-ca.pem    -ca-key=/etc/etcd/ssl/etcd-ca-key.pem    -config=ca-config.json -hostname=127.0.0.1,k8s-master01,k8s-master02,k8s-master03,192.168.0.111,192.168.0.112,192.168.0.113  -profile=kubernetes    etcd-csr.json | cfssljson -bare /etc/etcd/ssl/etcd\n```\n\n#### ç”ŸæˆKubernetesè¯ä¹¦\n\n```shell\nmkdir -p /etc/kubernetes/pki && cd /etc/kubernetes/pki\n#åˆ›å»ºè¯ä¹¦ç­¾å‘è¯·æ±‚æ–‡ä»¶\ncat > ca-csr.json   << EOF \n{\n  \"CN\": \"kubernetes\",\n  \"key\": {\n    \"algo\": \"rsa\",\n    \"size\": 2048\n  },\n  \"names\": [\n    {\n      \"C\": \"CN\",\n      \"ST\": \"Beijing\",\n      \"L\": \"Beijing\",\n      \"O\": \"Kubernetes\",\n      \"OU\": \"Kubernetes-manual\"\n    }\n  ],\n  \"ca\": {\n    \"expiry\": \"876000h\"\n  }\n}\nEOF\n```\n\nç­¾å‘Kubernetesçš„CAè¯ä¹¦å’Œå¯†é’¥\n\n```shell\ncfssl gencert -initca ca-csr.json | cfssljson -bare /etc/kubernetes/pki/ca\n```\n\n#### ç”ŸæˆApiServerè¯ä¹¦\n\n```shell\n#åˆ›å»ºè¯ä¹¦ç­¾å‘è¯·æ±‚æ–‡ä»¶\ncat > apiserver-csr.json << EOF \n{\n  \"CN\": \"kube-apiserver\",\n  \"key\": {\n    \"algo\": \"rsa\",\n    \"size\": 2048\n  },\n  \"names\": [\n    {\n      \"C\": \"CN\",\n      \"ST\": \"Beijing\",\n      \"L\": \"Beijing\",\n      \"O\": \"Kubernetes\",\n      \"OU\": \"Kubernetes-manual\"\n    }\n  ]\n}\nEOF\n\n#åˆ›å»ºç”Ÿæˆè¯ä¹¦çš„é…ç½®æ–‡ä»¶\ncat > ca-config.json << EOF \n{\n  \"signing\": {\n    \"default\": {\n      \"expiry\": \"876000h\"\n    },\n    \"profiles\": {\n      \"kubernetes\": {\n        \"usages\": [\n            \"signing\",\n            \"key encipherment\",\n            \"server auth\",\n            \"client auth\"\n        ],\n        \"expiry\": \"876000h\"\n      }\n    }\n  }\n}\nEOF\n```\n\nç­¾å‘ApiServerçš„CAè¯ä¹¦å’Œå¯†é’¥\n\n```shell\ncfssl gencert   -ca=/etc/kubernetes/pki/ca.pem -ca-key=/etc/kubernetes/pki/ca-key.pem  -config=ca-config.json -hostname=10.96.0.1,127.0.0.1,kubernetes,kubernetes.default,kubernetes.default.svc,kubernetes.default.svc.cluster,kubernetes.default.svc.cluster.local,192.168.0.111,192.168.0.112,192.168.0.113,192.168.0.114,192.168.0.115,192.168.0.116,192.168.0.117,192.168.0.118,192.168.0.119,192.168.0.120  -profile=kubernetes   apiserver-csr.json | cfssljson -bare /etc/kubernetes/pki/apiserver\n```\n\n> 10.96.0.1æ˜¯Kubernetesçš„serviceçš„é»˜è®¤åœ°å€\n>\n> kubernetes,kubernetes.default,kubernetes.default.svc,kubernetes.default.svc.cluster,kubernetes.default.svc.cluster.localæ˜¯Kubernetesçš„é»˜è®¤è§£æåŸŸå\n\n#### ç”ŸæˆApiServerèšåˆè¯ä¹¦\n\n```shell\n#åˆ›å»ºè¯ä¹¦ç­¾å‘è¯·æ±‚æ–‡ä»¶\ncat > front-proxy-ca-csr.json  << EOF \n{\n  \"CN\": \"kubernetes\",\n  \"key\": {\n     \"algo\": \"rsa\",\n     \"size\": 2048\n  },\n  \"ca\": {\n    \"expiry\": \"876000h\"\n  }\n}\nEOF\n```\n\nç­¾å‘ApiServerèšåˆè¯ä¹¦å’Œå¯†é’¥\n\n```shell\ncfssl gencert   -initca front-proxy-ca-csr.json | cfssljson -bare /etc/kubernetes/pki/front-proxy-ca \n```\n\n#### ç”ŸæˆApiServerèšåˆè¯ä¹¦çš„å®¢æˆ·ç«¯è¯ä¹¦\n\n```shell\n#åˆ›å»ºè¯ä¹¦ç­¾å‘è¯·æ±‚æ–‡ä»¶\ncat > front-proxy-client-csr.json  << EOF \n{\n  \"CN\": \"front-proxy-client\",\n  \"key\": {\n     \"algo\": \"rsa\",\n     \"size\": 2048\n  }\n}\nEOF\n```\n\nç­¾å‘ApiServerèšåˆè¯ä¹¦çš„å®¢æˆ·ç«¯è¯ä¹¦å’Œå¯†é’¥\n\n```shell\ncfssl gencert  \\\n-ca=/etc/kubernetes/pki/front-proxy-ca.pem   \\\n-ca-key=/etc/kubernetes/pki/front-proxy-ca-key.pem   \\\n-config=ca-config.json   \\\n-profile=kubernetes   front-proxy-client-csr.json | cfssljson -bare /etc/kubernetes/pki/front-proxy-client\n```\n\n#### ç”Ÿæˆcontroller-managerè¯ä¹¦\n\n```shell\n#åˆ›å»ºè¯ä¹¦ç­¾å‘è¯·æ±‚æ–‡ä»¶\ncat > manager-csr.json << EOF \n{\n  \"CN\": \"system:kube-controller-manager\",\n  \"key\": {\n    \"algo\": \"rsa\",\n    \"size\": 2048\n  },\n  \"names\": [\n    {\n      \"C\": \"CN\",\n      \"ST\": \"Beijing\",\n      \"L\": \"Beijing\",\n      \"O\": \"system:kube-controller-manager\",\n      \"OU\": \"Kubernetes-manual\"\n    }\n  ]\n}\nEOF\n```\n\nç­¾å‘controller-managerè¯ä¹¦å’Œå¯†é’¥\n\n```shell\ncfssl gencert \\\n   -ca=/etc/kubernetes/pki/ca.pem \\\n   -ca-key=/etc/kubernetes/pki/ca-key.pem \\\n   -config=ca-config.json \\\n   -profile=kubernetes \\\n   manager-csr.json | cfssljson -bare /etc/kubernetes/pki/controller-manager\n```\n\nç”Ÿæˆcontroller-managerä¸“ç”¨çš„ kubeconfig é…ç½®æ–‡ä»¶\n\n```\nkubectl config set-cluster kubernetes \\\n     --certificate-authority=/etc/kubernetes/pki/ca.pem \\\n     --embed-certs=true \\\n     --server=https://127.0.0.1:8443 \\\n     --kubeconfig=/etc/kubernetes/controller-manager.kubeconfig\n\nkubectl config set-context system:kube-controller-manager@kubernetes \\\n    --cluster=kubernetes \\\n    --user=system:kube-controller-manager \\\n    --kubeconfig=/etc/kubernetes/controller-manager.kubeconfig\n\nkubectl config set-credentials system:kube-controller-manager \\\n    --client-certificate=/etc/kubernetes/pki/controller-manager.pem \\\n    --client-key=/etc/kubernetes/pki/controller-manager-key.pem \\\n    --embed-certs=true \\\n    --kubeconfig=/etc/kubernetes/controller-manager.kubeconfig\n\nkubectl config use-context system:kube-controller-manager@kubernetes \\\n     --kubeconfig=/etc/kubernetes/controller-manager.kubeconfig\n```\n\n#### ç”Ÿæˆkube-schedulerè¯ä¹¦\n\n```shell\n#åˆ›å»ºè¯ä¹¦ç­¾å‘è¯·æ±‚æ–‡ä»¶\ncat > scheduler-csr.json << EOF \n{\n  \"CN\": \"system:kube-scheduler\",\n  \"key\": {\n    \"algo\": \"rsa\",\n    \"size\": 2048\n  },\n  \"names\": [\n    {\n      \"C\": \"CN\",\n      \"ST\": \"Beijing\",\n      \"L\": \"Beijing\",\n      \"O\": \"system:kube-scheduler\",\n      \"OU\": \"Kubernetes-manual\"\n    }\n  ]\n}\nEOF\n```\n\nç­¾å‘kube-schedulerè¯ä¹¦å’Œå¯†é’¥\n\n```shell\ncfssl gencert \\\n   -ca=/etc/kubernetes/pki/ca.pem \\\n   -ca-key=/etc/kubernetes/pki/ca-key.pem \\\n   -config=ca-config.json \\\n   -profile=kubernetes \\\n   scheduler-csr.json | cfssljson -bare /etc/kubernetes/pki/scheduler\n```\n\nç”Ÿæˆkube-schedulerä¸“ç”¨çš„ kubeconfig é…ç½®æ–‡ä»¶\n\n```shell\nkubectl config set-cluster kubernetes \\\n     --certificate-authority=/etc/kubernetes/pki/ca.pem \\\n     --embed-certs=true \\\n     --server=https://127.0.0.1:8443 \\\n     --kubeconfig=/etc/kubernetes/scheduler.kubeconfig\n\nkubectl config set-credentials system:kube-scheduler \\\n     --client-certificate=/etc/kubernetes/pki/scheduler.pem \\\n     --client-key=/etc/kubernetes/pki/scheduler-key.pem \\\n     --embed-certs=true \\\n     --kubeconfig=/etc/kubernetes/scheduler.kubeconfig\n\nkubectl config set-context system:kube-scheduler@kubernetes \\\n     --cluster=kubernetes \\\n     --user=system:kube-scheduler \\\n     --kubeconfig=/etc/kubernetes/scheduler.kubeconfig\n\nkubectl config use-context system:kube-scheduler@kubernetes \\\n     --kubeconfig=/etc/kubernetes/scheduler.kubeconfig\n```\n\n#### ç”Ÿæˆadminè¯ä¹¦\n\n```shell\n#åˆ›å»ºè¯ä¹¦ç­¾å‘è¯·æ±‚æ–‡ä»¶\ncat > admin-csr.json << EOF \n{\n  \"CN\": \"admin\",\n  \"key\": {\n    \"algo\": \"rsa\",\n    \"size\": 2048\n  },\n  \"names\": [\n    {\n      \"C\": \"CN\",\n      \"ST\": \"Beijing\",\n      \"L\": \"Beijing\",\n      \"O\": \"system:masters\",\n      \"OU\": \"Kubernetes-manual\"\n    }\n  ]\n}\nEOF\n```\n\nç­¾å‘adminè¯ä¹¦å’Œå¯†é’¥\n\n```shell\ncfssl gencert \\\n   -ca=/etc/kubernetes/pki/ca.pem \\\n   -ca-key=/etc/kubernetes/pki/ca-key.pem \\\n   -config=ca-config.json \\\n   -profile=kubernetes \\\n   admin-csr.json | cfssljson -bare /etc/kubernetes/pki/admin\n```\n\nç”Ÿæˆadminä¸“ç”¨çš„ kubeconfig é…ç½®æ–‡ä»¶\n\n```shell\nkubectl config set-cluster kubernetes     \\\n  --certificate-authority=/etc/kubernetes/pki/ca.pem     \\\n  --embed-certs=true     \\\n  --server=https://127.0.0.1:8443     \\\n  --kubeconfig=/etc/kubernetes/admin.kubeconfig\n\nkubectl config set-credentials kubernetes-admin  \\\n  --client-certificate=/etc/kubernetes/pki/admin.pem     \\\n  --client-key=/etc/kubernetes/pki/admin-key.pem     \\\n  --embed-certs=true     \\\n  --kubeconfig=/etc/kubernetes/admin.kubeconfig\n\nkubectl config set-context kubernetes-admin@kubernetes    \\\n  --cluster=kubernetes     \\\n  --user=kubernetes-admin     \\\n  --kubeconfig=/etc/kubernetes/admin.kubeconfig\n\nkubectl config use-context kubernetes-admin@kubernetes  --kubeconfig=/etc/kubernetes/admin.kubeconfig\n```\n\n#### ç”Ÿæˆkube-proxyè¯ä¹¦\n\n```shell\n#åˆ›å»ºè¯ä¹¦ç­¾å‘è¯·æ±‚æ–‡ä»¶\ncat > kube-proxy-csr.json  << EOF \n{\n  \"CN\": \"system:kube-proxy\",\n  \"key\": {\n    \"algo\": \"rsa\",\n    \"size\": 2048\n  },\n  \"names\": [\n    {\n      \"C\": \"CN\",\n      \"ST\": \"Beijing\",\n      \"L\": \"Beijing\",\n      \"O\": \"system:kube-proxy\",\n      \"OU\": \"Kubernetes-manual\"\n    }\n  ]\n}\nEOF\n```\n\nç­¾å‘ kube-proxyè¯ä¹¦å’Œå¯†é’¥\n\n```shell\ncfssl gencert \\\n   -ca=/etc/kubernetes/pki/ca.pem \\\n   -ca-key=/etc/kubernetes/pki/ca-key.pem \\\n   -config=ca-config.json \\\n   -profile=kubernetes \\\n   kube-proxy-csr.json | cfssljson -bare /etc/kubernetes/pki/kube-proxy\n```\n\nç”Ÿæˆ kube-proxyä¸“ç”¨çš„ kubeconfig é…ç½®æ–‡ä»¶\n\n```shell\nkubectl config set-cluster kubernetes     \\\n  --certificate-authority=/etc/kubernetes/pki/ca.pem     \\\n  --embed-certs=true     \\\n  --server=https://127.0.0.1:8443     \\\n  --kubeconfig=/etc/kubernetes/kube-proxy.kubeconfig\n\nkubectl config set-credentials kube-proxy  \\\n  --client-certificate=/etc/kubernetes/pki/kube-proxy.pem     \\\n  --client-key=/etc/kubernetes/pki/kube-proxy-key.pem     \\\n  --embed-certs=true     \\\n  --kubeconfig=/etc/kubernetes/kube-proxy.kubeconfig\n\nkubectl config set-context kube-proxy@kubernetes    \\\n  --cluster=kubernetes     \\\n  --user=kube-proxy     \\\n  --kubeconfig=/etc/kubernetes/kube-proxy.kubeconfig\n\nkubectl config use-context kube-proxy@kubernetes  --kubeconfig=/etc/kubernetes/kube-proxy.kubeconfig\n```\n\n#### åˆ›å»ºServiceAccountåŠ å¯†å¯†é’¥\n\n```shell\nopenssl genrsa -out /etc/kubernetes/pki/sa.key 2048\nopenssl rsa -in /etc/kubernetes/pki/sa.key -pubout -out /etc/kubernetes/pki/sa.pub\n```\n\n### æ·»åŠ ç»„ä»¶é…ç½®ï¼Œå¯åŠ¨æœåŠ¡\n\n#### ETCDç»„ä»¶ï¼ˆmasterèŠ‚ç‚¹ï¼‰\n\nï¼ˆ1ï¼‰k8s-master01é…ç½®æ–‡ä»¶\n\n```shell\ncat > /etc/etcd/etcd.config.yml << EOF \nname: 'k8s-master01'\ndata-dir: /var/lib/etcd\nwal-dir: /var/lib/etcd/wal\nsnapshot-count: 5000\nheartbeat-interval: 100\nelection-timeout: 1000\nquota-backend-bytes: 0\nlisten-peer-urls: 'https://192.168.0.111:2380'\nlisten-client-urls: 'https://192.168.0.111:2379,http://127.0.0.1:2379'\nmax-snapshots: 3\nmax-wals: 5\ncors:\ninitial-advertise-peer-urls: 'https://192.168.0.111:2380'\nadvertise-client-urls: 'https://192.168.0.111:2379'\ndiscovery:\ndiscovery-fallback: 'proxy'\ndiscovery-proxy:\ndiscovery-srv:\ninitial-cluster: 'k8s-master01=https://192.168.0.111:2380,k8s-master02=https://192.168.0.112:2380,k8s-master03=https://192.168.0.113:2380'\ninitial-cluster-token: 'etcd-k8s-cluster'\ninitial-cluster-state: 'new'\nstrict-reconfig-check: false\nenable-v2: true\nenable-pprof: true\nproxy: 'off'\nproxy-failure-wait: 5000\nproxy-refresh-interval: 30000\nproxy-dial-timeout: 1000\nproxy-write-timeout: 5000\nproxy-read-timeout: 0\nclient-transport-security:\n  cert-file: '/etc/kubernetes/pki/etcd/etcd.pem'\n  key-file: '/etc/kubernetes/pki/etcd/etcd-key.pem'\n  client-cert-auth: true\n  trusted-ca-file: '/etc/kubernetes/pki/etcd/etcd-ca.pem'\n  auto-tls: true\npeer-transport-security:\n  cert-file: '/etc/kubernetes/pki/etcd/etcd.pem'\n  key-file: '/etc/kubernetes/pki/etcd/etcd-key.pem'\n  peer-client-cert-auth: true\n  trusted-ca-file: '/etc/kubernetes/pki/etcd/etcd-ca.pem'\n  auto-tls: true\ndebug: false\nlog-package-levels:\nlog-outputs: [default]\nforce-new-cluster: false\nEOF\n```\n\nï¼ˆ2ï¼‰k8s-master02é…ç½®æ–‡ä»¶\n\n```shell\ncat > /etc/etcd/etcd.config.yml << EOF \nname: 'k8s-master02'\ndata-dir: /var/lib/etcd\nwal-dir: /var/lib/etcd/wal\nsnapshot-count: 5000\nheartbeat-interval: 100\nelection-timeout: 1000\nquota-backend-bytes: 0\nlisten-peer-urls: 'https://192.168.0.112:2380'\nlisten-client-urls: 'https://192.168.0.112:2379,http://127.0.0.1:2379'\nmax-snapshots: 3\nmax-wals: 5\ncors:\ninitial-advertise-peer-urls: 'https://192.168.0.112:2380'\nadvertise-client-urls: 'https://192.168.0.112:2379'\ndiscovery:\ndiscovery-fallback: 'proxy'\ndiscovery-proxy:\ndiscovery-srv:\ninitial-cluster: 'k8s-master01=https://192.168.0.111:2380,k8s-master02=https://192.168.0.112:2380,k8s-master03=https://192.168.0.113:2380'\ninitial-cluster-token: 'etcd-k8s-cluster'\ninitial-cluster-state: 'new'\nstrict-reconfig-check: false\nenable-v2: true\nenable-pprof: true\nproxy: 'off'\nproxy-failure-wait: 5000\nproxy-refresh-interval: 30000\nproxy-dial-timeout: 1000\nproxy-write-timeout: 5000\nproxy-read-timeout: 0\nclient-transport-security:\n  cert-file: '/etc/kubernetes/pki/etcd/etcd.pem'\n  key-file: '/etc/kubernetes/pki/etcd/etcd-key.pem'\n  client-cert-auth: true\n  trusted-ca-file: '/etc/kubernetes/pki/etcd/etcd-ca.pem'\n  auto-tls: true\npeer-transport-security:\n  cert-file: '/etc/kubernetes/pki/etcd/etcd.pem'\n  key-file: '/etc/kubernetes/pki/etcd/etcd-key.pem'\n  peer-client-cert-auth: true\n  trusted-ca-file: '/etc/kubernetes/pki/etcd/etcd-ca.pem'\n  auto-tls: true\ndebug: false\nlog-package-levels:\nlog-outputs: [default]\nforce-new-cluster: false\nEOF\n```\n\nï¼ˆ3ï¼‰k8s-master03é…ç½®æ–‡ä»¶\n\n```shell\ncat > /etc/etcd/etcd.config.yml << EOF \nname: 'k8s-master03'\ndata-dir: /var/lib/etcd\nwal-dir: /var/lib/etcd/wal\nsnapshot-count: 5000\nheartbeat-interval: 100\nelection-timeout: 1000\nquota-backend-bytes: 0\nlisten-peer-urls: 'https://192.168.0.113:2380'\nlisten-client-urls: 'https://192.168.0.113:2379,http://127.0.0.1:2379'\nmax-snapshots: 3\nmax-wals: 5\ncors:\ninitial-advertise-peer-urls: 'https://192.168.0.113:2380'\nadvertise-client-urls: 'https://192.168.0.113:2379'\ndiscovery:\ndiscovery-fallback: 'proxy'\ndiscovery-proxy:\ndiscovery-srv:\ninitial-cluster: 'k8s-master01=https://192.168.0.111:2380,k8s-master02=https://192.168.0.112:2380,k8s-master03=https://192.168.0.113:2380'\ninitial-cluster-token: 'etcd-k8s-cluster'\ninitial-cluster-state: 'new'\nstrict-reconfig-check: false\nenable-v2: true\nenable-pprof: true\nproxy: 'off'\nproxy-failure-wait: 5000\nproxy-refresh-interval: 30000\nproxy-dial-timeout: 1000\nproxy-write-timeout: 5000\nproxy-read-timeout: 0\nclient-transport-security:\n  cert-file: '/etc/kubernetes/pki/etcd/etcd.pem'\n  key-file: '/etc/kubernetes/pki/etcd/etcd-key.pem'\n  client-cert-auth: true\n  trusted-ca-file: '/etc/kubernetes/pki/etcd/etcd-ca.pem'\n  auto-tls: true\npeer-transport-security:\n  cert-file: '/etc/kubernetes/pki/etcd/etcd.pem'\n  key-file: '/etc/kubernetes/pki/etcd/etcd-key.pem'\n  peer-client-cert-auth: true\n  trusted-ca-file: '/etc/kubernetes/pki/etcd/etcd-ca.pem'\n  auto-tls: true\ndebug: false\nlog-package-levels:\nlog-outputs: [default]\nforce-new-cluster: false\nEOF\n```\n\nï¼ˆ4ï¼‰åˆ›å»ºetcdæœåŠ¡å¯åŠ¨é…ç½®æ–‡ä»¶\n\n```shell\ncat > /usr/lib/systemd/system/etcd.service << EOF\n\n[Unit]\nDescription=Etcd Service\nDocumentation=https://coreos.com/etcd/docs/latest/\nAfter=network.target\n\n[Service]\nType=notify\nExecStart=/usr/local/bin/etcd --config-file=/etc/etcd/etcd.config.yml\nRestart=on-failure\nRestartSec=10\nLimitNOFILE=65536\n\n[Install]\nWantedBy=multi-user.target\nAlias=etcd3.service\n\nEOF\n```\n\nï¼ˆ5ï¼‰å¯åŠ¨etcdæœåŠ¡\n\n```shell\nmkdir -p /etc/kubernetes/pki/etcd\nln -s /etc/etcd/ssl/* /etc/kubernetes/pki/etcd/\n\nsystemctl daemon-reload\nsystemctl enable --now etcd.service\nsystemctl status etcd.service\n```\n\nï¼ˆ6ï¼‰etcd é›†ç¾¤çš„å¥åº·çŠ¶æ€\n\n```\nexport ETCDCTL_API=3\netcdctl --endpoints=\"192.168.0.111:2379,192.168.0.112:2379,192.168.0.113:2379\" --cacert=/etc/kubernetes/pki/etcd/etcd-ca.pem --cert=/etc/kubernetes/pki/etcd/etcd.pem --key=/etc/kubernetes/pki/etcd/etcd-key.pem  endpoint status --write-out=table\n```\n\n> +--------------------+------------------+---------+-----------------+---------+--------+-----------------------+-------+-----------+------------+-----------+------------+--------------------+--------+--------------------------+-------------------+\n> |      ENDPOINT      |        ID        | VERSION | STORAGE VERSION | DB SIZE | IN USE | PERCENTAGE NOT IN USE | QUOTA | IS LEADER | IS LEARNER | RAFT TERM | RAFT INDEX | RAFT APPLIED INDEX | ERRORS | DOWNGRADE TARGET VERSION | DOWNGRADE ENABLED |\n> +--------------------+------------------+---------+-----------------+---------+--------+-----------------------+-------+-----------+------------+-----------+------------+--------------------+--------+--------------------------+-------------------+\n> | 192.168.0.111:2379 | 9c35553b47538310 |   3.6.4 |           3.6.0 |   20 kB |  16 kB |                   20% |   0 B |      <mark>true</mark> |      false |         3 |          6 |                  6 |        |                          |             false |\n> | 192.168.0.112:2379 | 545bae002651f913 |   3.6.4 |           3.6.0 |   20 kB |  16 kB |                   20% |   0 B |      false |      false |         2 |          7 |                  7 |        |                          |             false |\n> | 192.168.0.113:2379 | d7497b3a31d15f9e |   3.6.4 |           3.6.0 |   20 kB |  16 kB |                   20% |   0 B |     false |      false |         2 |          7 |                  7 |        |                          |             false |\n> +--------------------+------------------+---------+-----------------+---------+--------+-----------------------+-------+-----------+------------+-----------+------------+--------------------+--------+--------------------------+-------------------+\n\n> ```shell\n> #å°†etcdç›¸å…³é˜²ç«å¢™ç­–ç•¥ä¿å­˜ï¼Œé˜²æ­¢é‡å¯åetcdæœåŠ¡æ— æ³•å¯åŠ¨\n> service iptables save\n> ```\n>\n> å¦‚æœå‡ºç°é‡å¯æœåŠ¡å™¨åï¼Œetcdé›†ç¾¤æœåŠ¡æ— æ³•å¯åŠ¨çš„æƒ…å†µã€‚æ¸…ç©ºé˜²ç«å¢™è§„åˆ™ï¼Œå¯åŠ¨etcdæœåŠ¡å¹¶ä¿å­˜ç­–ç•¥å³å¯ã€‚\n\n#### å®‰è£…Nginxé…ç½®é«˜å¯ç”¨\n\nï¼ˆ1ï¼‰ä¸‹è½½å®‰è£…Nginx\n\n```shell\nwget https://nginx.org/download/nginx-1.28.0.tar.gz\ntar xvf nginx-1.28.0.tar.gz\ncd nginx-1.28.0\n#ç¼–è¯‘å®‰è£…ï¼Œå…¶ä¸­--with-streamä¸ºå¯ç”¨å››å±‚ä»£ç†\n./configure --with-stream --without-http --without-http_uwsgi_module --without-http_scgi_module --without-http_fastcgi_module\nmake && make install \n```\n\nï¼ˆ2ï¼‰åˆ›å»ºé…ç½®æ–‡ä»¶\n\n```shell\ncat > /usr/local/nginx/conf/kube-nginx.conf <<EOF\nworker_processes 1;\nevents {\n    worker_connections  1024;\n}\nstream {\n    upstream backend {\n    \tleast_conn;\n        hash $remote_addr consistent;\n        server 192.168.0.111:6443        max_fails=3 fail_timeout=30s;\n        server 192.168.0.112:6443        max_fails=3 fail_timeout=30s;\n        server 192.168.0.113:6443        max_fails=3 fail_timeout=30s;\n    }\n    server {\n        listen 127.0.0.1:8443;\n        proxy_connect_timeout 1s;\n        proxy_pass backend;\n    }\n}\nEOF\n```\n\nï¼ˆ6ï¼‰æ·»åŠ nignxæœåŠ¡\n\n```shell\ncat > /etc/systemd/system/kube-nginx.service <<EOF\n[Unit]\nDescription=kube-apiserver nginx proxy\nAfter=network.target\nAfter=network-online.target\nWants=network-online.target\n\n[Service]\nType=forking\nExecStartPre=/usr/local/nginx/sbin/nginx -c /usr/local/nginx/conf/kube-nginx.conf -p /usr/local/nginx -t\nExecStart=/usr/local/nginx/sbin/nginx -c /usr/local/nginx/conf/kube-nginx.conf -p /usr/local/nginx\nExecReload=/usr/local/nginx/sbin/nginx -c /usr/local/nginx/conf/kube-nginx.conf -p /usr/local/nginx -s reload\nPrivateTmp=true\nRestart=always\nRestartSec=5\nStartLimitInterval=0\nLimitNOFILE=65536\n \n[Install]\nWantedBy=multi-user.target\nEOF\n\n```\n\nï¼ˆ7ï¼‰å¯åŠ¨æœåŠ¡\n\n```shell\nsystemctl daemon-reload\nsystemctl enable --now kube-nginx.service\nsystemctl status kube-nginx.service\n```\n\n#### ApiServerç»„ä»¶\n\n```shell\n#æ‰€æœ‰èŠ‚ç‚¹åˆ›å»ºæ‰€éœ€ç›®å½•\nmkdir -p /etc/kubernetes/manifests/ /etc/systemd/system/kubelet.service.d /var/lib/kubelet /var/log/kubernetes\n```\n\nï¼ˆ1ï¼‰k8s-master01èŠ‚ç‚¹æ·»åŠ apiserveræœåŠ¡\n\n```shell\ncat > /usr/lib/systemd/system/kube-apiserver.service << EOF\n\n[Unit]\nDescription=Kubernetes API Server\nDocumentation=https://github.com/kubernetes/kubernetes\nAfter=network.target\n\n[Service]\nExecStart=/usr/local/bin/kube-apiserver \\\\\n      --v=2  \\\\\n      --allow-privileged=true  \\\\\n      --bind-address=0.0.0.0  \\\\\n      --secure-port=6443  \\\\\n      --advertise-address=192.168.0.111 \\\\\n      --service-cluster-ip-range=10.96.0.0/12,fd00:1111::/112  \\\\\n      --service-node-port-range=30000-32767  \\\\\n      --etcd-servers=https://192.168.0.111:2379,https://192.168.0.112:2379,https://192.168.0.113:2379 \\\\\n      --etcd-cafile=/etc/etcd/ssl/etcd-ca.pem  \\\\\n      --etcd-certfile=/etc/etcd/ssl/etcd.pem  \\\\\n      --etcd-keyfile=/etc/etcd/ssl/etcd-key.pem  \\\\\n      --client-ca-file=/etc/kubernetes/pki/ca.pem  \\\\\n      --tls-cert-file=/etc/kubernetes/pki/apiserver.pem  \\\\\n      --tls-private-key-file=/etc/kubernetes/pki/apiserver-key.pem  \\\\\n      --kubelet-client-certificate=/etc/kubernetes/pki/apiserver.pem  \\\\\n      --kubelet-client-key=/etc/kubernetes/pki/apiserver-key.pem  \\\\\n      --service-account-key-file=/etc/kubernetes/pki/sa.pub  \\\\\n      --service-account-signing-key-file=/etc/kubernetes/pki/sa.key  \\\\\n      --service-account-issuer=https://kubernetes.default.svc.cluster.local \\\\\n      --kubelet-preferred-address-types=InternalIP,ExternalIP,Hostname  \\\\\n      --enable-admission-plugins=NamespaceLifecycle,LimitRanger,ServiceAccount,DefaultStorageClass,DefaultTolerationSeconds,NodeRestriction,ResourceQuota  \\\\\n      --authorization-mode=Node,RBAC  \\\\\n      --enable-bootstrap-token-auth=true  \\\\\n      --requestheader-client-ca-file=/etc/kubernetes/pki/front-proxy-ca.pem  \\\\\n      --proxy-client-cert-file=/etc/kubernetes/pki/front-proxy-client.pem  \\\\\n      --proxy-client-key-file=/etc/kubernetes/pki/front-proxy-client-key.pem  \\\\\n      --requestheader-allowed-names=aggregator  \\\\\n      --requestheader-group-headers=X-Remote-Group  \\\\\n      --requestheader-extra-headers-prefix=X-Remote-Extra-  \\\\\n      --requestheader-username-headers=X-Remote-User \\\\\n      --enable-aggregator-routing=true\n\nRestart=on-failure\nRestartSec=10s\nLimitNOFILE=65535\n\n[Install]\nWantedBy=multi-user.target\n\nEOF\n```\n\nï¼ˆ2ï¼‰k8s-master02èŠ‚ç‚¹æ·»åŠ apiserveræœåŠ¡\n\n```shell\ncat > /usr/lib/systemd/system/kube-apiserver.service << EOF\n\n[Unit]\nDescription=Kubernetes API Server\nDocumentation=https://github.com/kubernetes/kubernetes\nAfter=network.target\n\n[Service]\nExecStart=/usr/local/bin/kube-apiserver \\\\\n      --v=2  \\\\\n      --allow-privileged=true  \\\\\n      --bind-address=0.0.0.0  \\\\\n      --secure-port=6443  \\\\\n      --advertise-address=192.168.0.112 \\\\\n      --service-cluster-ip-range=10.96.0.0/12,fd00:1111::/112  \\\\\n      --service-node-port-range=30000-32767  \\\\\n      --etcd-servers=https://192.168.0.111:2379,https://192.168.0.112:2379,https://192.168.0.113:2379 \\\\\n      --etcd-cafile=/etc/etcd/ssl/etcd-ca.pem  \\\\\n      --etcd-certfile=/etc/etcd/ssl/etcd.pem  \\\\\n      --etcd-keyfile=/etc/etcd/ssl/etcd-key.pem  \\\\\n      --client-ca-file=/etc/kubernetes/pki/ca.pem  \\\\\n      --tls-cert-file=/etc/kubernetes/pki/apiserver.pem  \\\\\n      --tls-private-key-file=/etc/kubernetes/pki/apiserver-key.pem  \\\\\n      --kubelet-client-certificate=/etc/kubernetes/pki/apiserver.pem  \\\\\n      --kubelet-client-key=/etc/kuberntes/pki/apiserver-key.pem  \\\\\n      --service-account-key-file=/etc/kubernetes/pki/sa.pub  \\\\\n      --service-account-signing-key-file=/etc/kubernetes/pki/sa.key  \\\\\n      --service-account-issuer=https://kubernetes.default.svc.cluster.local \\\\\n      --kubelet-preferred-address-types=InternalIP,ExternalIP,Hostname  \\\\\n      --enable-admission-plugins=NamespaceLifecycle,LimitRanger,ServiceAccount,DefaultStorageClass,DefaultTolerationSeconds,NodeRestriction,ResourceQuota  \\\\\n      --authorization-mode=Node,RBAC  \\\\\n      --enable-bootstrap-token-auth=true  \\\\\n      --requestheader-client-ca-file=/etc/kubernetes/pki/front-proxy-ca.pem  \\\\\n      --proxy-client-cert-file=/etc/kubernetes/pki/front-proxy-client.pem  \\\\\n      --proxy-client-key-file=/etc/kubernetes/pki/front-proxy-client-key.pem  \\\\\n      --requestheader-allowed-names=aggregator  \\\\\n      --requestheader-group-headers=X-Remote-Group  \\\\\n      --requestheader-extra-headers-prefix=X-Remote-Extra-  \\\\\n      --requestheader-username-headers=X-Remote-User \\\\\n      --enable-aggregator-routing=true\n\n\nRestart=on-failure\nRestartSec=10s\nLimitNOFILE=65535\n\n[Install]\nWantedBy=multi-user.target\n\nEOF\n```\n\nï¼ˆ3ï¼‰k8s-master03èŠ‚ç‚¹æ·»åŠ apiserveræœåŠ¡\n\n```shell\ncat > /usr/lib/systemd/system/kube-apiserver.service << EOF\n\n[Unit]\nDescription=Kubernetes API Server\nDocumentation=https://github.com/kubernetes/kubernetes\nAfter=network.target\n\n[Service]\nExecStart=/usr/local/bin/kube-apiserver \\\\\n      --v=2  \\\\\n      --allow-privileged=true  \\\\\n      --bind-address=0.0.0.0  \\\\\n      --secure-port=6443  \\\\\n      --advertise-address=192.168.0.113 \\\\\n      --service-cluster-ip-range=10.96.0.0/12,fd00:1111::/112  \\\\\n      --service-node-port-range=30000-32767  \\\\\n      --etcd-servers=https://192.168.0.111:2379,https://192.168.0.112:2379,https://192.168.0.113:2379 \\\\\n      --etcd-cafile=/etc/etcd/ssl/etcd-ca.pem  \\\\\n      --etcd-certfile=/etc/etcd/ssl/etcd.pem  \\\\\n      --etcd-keyfile=/etc/etcd/ssl/etcd-key.pem  \\\\\n      --client-ca-file=/etc/kubernetes/pki/ca.pem  \\\\\n      --tls-cert-file=/etc/kubernetes/pki/apiserver.pem  \\\\\n      --tls-private-key-file=/etc/kubernetes/pki/apiserver-key.pem  \\\\\n      --kubelet-client-certificate=/etc/kubernetes/pki/apiserver.pem  \\\\\n      --kubelet-client-key=/etc/kubernetes/pki/apiserver-key.pem  \\\\\n      --service-account-key-file=/etc/kubernetes/pki/sa.pub  \\\\\n      --service-account-signing-key-file=/etc/kubernetes/pki/sa.key  \\\\\n      --service-account-issuer=https://kubernetes.default.svc.cluster.local \\\\\n      --kubelet-preferred-address-types=InternalIP,ExternalIP,Hostname  \\\\\n      --enable-admission-plugins=NamespaceLifecycle,LimitRanger,ServiceAccount,DefaultStorageClass,DefaultTolerationSeconds,NodeRestriction,ResourceQuota  \\\\\n      --authorization-mode=Node,RBAC  \\\\\n      --enable-bootstrap-token-auth=true  \\\\\n      --requestheader-client-ca-file=/etc/kubernetes/pki/front-proxy-ca.pem  \\\\\n      --proxy-client-cert-file=/etc/kubernetes/pki/front-proxy-client.pem  \\\\\n      --proxy-client-key-file=/etc/kubernetes/pki/front-proxy-client-key.pem  \\\\\n      --requestheader-allowed-names=aggregator  \\\\\n      --requestheader-group-headers=X-Remote-Group  \\\\\n      --requestheader-extra-headers-prefix=X-Remote-Extra-  \\\\\n      --requestheader-username-headers=X-Remote-User \\\\\n      --enable-aggregator-routing=true\n\n\nRestart=on-failure\nRestartSec=10s\nLimitNOFILE=65535\n\n[Install]\nWantedBy=multi-user.target\n\nEOF\n```\n\nï¼ˆ4ï¼‰å¯åŠ¨kube-apiserveræœåŠ¡\n\n```shell\nsystemctl daemon-reload \nsystemctl enable --now kube-apiserver\nsystemctl status kube-apiserver\n```\n\n#### controller-managerç»„ä»¶\n\næ‰€æœ‰masterèŠ‚ç‚¹æ·»åŠ controller-manageræœåŠ¡\n\n```\ncat > /usr/lib/systemd/system/kube-controller-manager.service << EOF\n\n[Unit]\nDescription=Kubernetes Controller Manager\nDocumentation=https://github.com/kubernetes/kubernetes\nAfter=network.target\n\n[Service]\nExecStart=/usr/local/bin/kube-controller-manager \\\\\n      --v=2 \\\\\n      --bind-address=0.0.0.0 \\\\\n      --root-ca-file=/etc/kubernetes/pki/ca.pem \\\\\n      --cluster-signing-cert-file=/etc/kubernetes/pki/ca.pem \\\\\n      --cluster-signing-key-file=/etc/kubernetes/pki/ca-key.pem \\\\\n      --service-account-private-key-file=/etc/kubernetes/pki/sa.key \\\\\n      --kubeconfig=/etc/kubernetes/controller-manager.kubeconfig \\\\\n      --leader-elect=true \\\\\n      --use-service-account-credentials=true \\\\\n      --node-monitor-grace-period=40s \\\\\n      --node-monitor-period=5s \\\\\n      --controllers=*,bootstrapsigner,tokencleaner \\\\\n      --allocate-node-cidrs=true \\\\\n      --service-cluster-ip-range=10.96.0.0/12,fd00:1111::/112 \\\\\n      --cluster-cidr=172.16.0.0/12,fc00:2222::/112 \\\\\n      --node-cidr-mask-size-ipv4=24 \\\\\n      --node-cidr-mask-size-ipv6=120 \\\\\n      --requestheader-client-ca-file=/etc/kubernetes/pki/front-proxy-ca.pem \n\nRestart=always\nRestartSec=10s\n\n[Install]\nWantedBy=multi-user.target\n\nEOF\n```\n\nå¯åŠ¨controller-manageræœåŠ¡\n\n```shell\nsystemctl daemon-reload\nsystemctl enable --now kube-controller-manager\nsystemctl  status kube-controller-manager\n```\n\n#### kube-schedulerç»„ä»¶ï¼ˆmasterèŠ‚ç‚¹ï¼‰\n\næ‰€æœ‰masterèŠ‚ç‚¹æ·»åŠ kube-scheduleræœåŠ¡\n\n```shell\ncat > /usr/lib/systemd/system/kube-scheduler.service << EOF\n\n[Unit]\nDescription=Kubernetes Scheduler\nDocumentation=https://github.com/kubernetes/kubernetes\nAfter=network.target\n\n[Service]\nExecStart=/usr/local/bin/kube-scheduler \\\\\n      --v=2 \\\\\n      --bind-address=0.0.0.0 \\\\\n      --leader-elect=true \\\\\n      --kubeconfig=/etc/kubernetes/scheduler.kubeconfig\n\nRestart=always\nRestartSec=10s\n\n[Install]\nWantedBy=multi-user.target\n\nEOF\n```\n\nå¯åŠ¨kube-scheduleræœåŠ¡\n\n```shell\nsystemctl daemon-reload\nsystemctl enable --now kube-scheduler\nsystemctl status kube-scheduler\n```\n\n#### TLS Bootstrapping é…ç½®ï¼ˆmaster01èŠ‚ç‚¹ï¼Œç”¨äºè‡ªåŠ¨ç­¾å‘è¯ä¹¦ï¼‰\n\n```shell\nkubectl config set-cluster kubernetes     \\\n--certificate-authority=/etc/kubernetes/pki/ca.pem     \\\n--embed-certs=true     --server=https://127.0.0.1:8443     \\\n--kubeconfig=/etc/kubernetes/bootstrap-kubelet.kubeconfig\n\nkubectl config set-credentials tls-bootstrap-token-user     \\\n--token=c8ad9c.2e4d610cf3e7426e \\\n--kubeconfig=/etc/kubernetes/bootstrap-kubelet.kubeconfig\n\nkubectl config set-context tls-bootstrap-token-user@kubernetes     \\\n--cluster=kubernetes     \\\n--user=tls-bootstrap-token-user     \\\n--kubeconfig=/etc/kubernetes/bootstrap-kubelet.kubeconfig\n\nkubectl config use-context tls-bootstrap-token-user@kubernetes     \\\n--kubeconfig=/etc/kubernetes/bootstrap-kubelet.kubeconfig\n\n# tokençš„ä½ç½®åœ¨bootstrap.secret.yamlï¼Œå¦‚æœä¿®æ”¹çš„è¯åˆ°è¿™ä¸ªæ–‡ä»¶ä¿®æ”¹\nmkdir -p /root/.kube && cp /etc/kubernetes/admin.kubeconfig /root/.kube/config\n```\n\næŸ¥çœ‹é›†ç¾¤çŠ¶æ€\n\n```shell\nkubectl get cs\n```\n\nåˆ›å»ºbootstrap-secretæˆæƒæ–‡ä»¶\n\n```shell\ncat > bootstrap-secret.yaml << EOF\napiVersion: v1\nkind: Secret\nmetadata:\n  name: bootstrap-token-c8ad9c\n  namespace: kube-system\ntype: bootstrap.kubernetes.io/token\nstringData:\n  description: \"The default bootstrap token generated by 'kubelet '.\"\n  token-id: \"c8ad9c\"\n  token-secret: \"2e4d610cf3e7426e\"\n  usage-bootstrap-authentication: \"true\"\n  usage-bootstrap-signing: \"true\"\n  auth-extra-groups:  system:bootstrappers:default-node-token,system:bootstrappers:worker,system:bootstrappers:ingress\n \n---\napiVersion: rbac.authorization.k8s.io/v1\nkind: ClusterRoleBinding\nmetadata:\n  name: kubelet-bootstrap\nroleRef:\n  apiGroup: rbac.authorization.k8s.io\n  kind: ClusterRole\n  name: system:node-bootstrapper\nsubjects:\n- apiGroup: rbac.authorization.k8s.io\n  kind: Group\n  name: system:bootstrappers:default-node-token\n---\napiVersion: rbac.authorization.k8s.io/v1\nkind: ClusterRoleBinding\nmetadata:\n  name: node-autoapprove-bootstrap\nroleRef:\n  apiGroup: rbac.authorization.k8s.io\n  kind: ClusterRole\n  name: system:certificates.k8s.io:certificatesigningrequests:nodeclient\nsubjects:\n- apiGroup: rbac.authorization.k8s.io\n  kind: Group\n  name: system:bootstrappers:default-node-token\n---\napiVersion: rbac.authorization.k8s.io/v1\nkind: ClusterRoleBinding\nmetadata:\n  name: node-autoapprove-certificate-rotation\nroleRef:\n  apiGroup: rbac.authorization.k8s.io\n  kind: ClusterRole\n  name: system:certificates.k8s.io:certificatesigningrequests:selfnodeclient\nsubjects:\n- apiGroup: rbac.authorization.k8s.io\n  kind: Group\n  name: system:nodes\n---\napiVersion: rbac.authorization.k8s.io/v1\nkind: ClusterRole\nmetadata:\n  annotations:\n    rbac.authorization.kubernetes.io/autoupdate: \"true\"\n  labels:\n    kubernetes.io/bootstrapping: rbac-defaults\n  name: system:kube-apiserver-to-kubelet\nrules:\n  - apiGroups:\n      - \"\"\n    resources:\n      - nodes/proxy\n      - nodes/stats\n      - nodes/log\n      - nodes/spec\n      - nodes/metrics\n    verbs:\n      - \"*\"\n---\napiVersion: rbac.authorization.k8s.io/v1\nkind: ClusterRoleBinding\nmetadata:\n  name: system:kube-apiserver\n  namespace: \"\"\nroleRef:\n  apiGroup: rbac.authorization.k8s.io\n  kind: ClusterRole\n  name: system:kube-apiserver-to-kubelet\nsubjects:\n  - apiGroup: rbac.authorization.k8s.io\n    kind: User\n    name: kube-apiserver\nEOF\n```\n\næ‰§è¡Œbootstrap-secretæˆæƒæ–‡ä»¶\n\n```shell\nkubectl apply -f bootstrap-secret.yaml\n```\n\nå°†è¯ä¹¦æ–‡ä»¶å¤åˆ¶åˆ°å…¶ä»–èŠ‚ç‚¹\n\n```shell\ncd /etc/kubernetes/\nfor NODE in k8s-master02 k8s-master03 k8s-node01 k8s-node02; do ssh $NODE mkdir -p /etc/kubernetes/pki; for FILE in pki/ca.pem pki/ca-key.pem pki/front-proxy-ca.pem bootstrap-kubelet.kubeconfig kube-proxy.kubeconfig; do scp /etc/kubernetes/$FILE $NODE:/etc/kubernetes/${FILE}; done; done\n```\n\n#### Kubeletç»„ä»¶ï¼ˆæ‰€æœ‰èŠ‚ç‚¹ï¼‰\n\nï¼ˆ1ï¼‰æ·»åŠ kubeletæœåŠ¡\n\n```shell\ncat > /usr/lib/systemd/system/kubelet.service << EOF\n\n[Unit]\nDescription=Kubernetes Kubelet\nDocumentation=https://github.com/kubernetes/kubernetes\nAfter=network-online.target firewalld.service cri-docker.service docker.socket containerd.service\nWants=network-online.target\nRequires=docker.socket containerd.service\n\n[Service]\nExecStart=/usr/local/bin/kubelet \\\\\n    --bootstrap-kubeconfig=/etc/kubernetes/bootstrap-kubelet.kubeconfig  \\\\\n    --kubeconfig=/etc/kubernetes/kubelet.kubeconfig \\\\\n    --config=/etc/kubernetes/kubelet-conf.yml \\\\\n    --container-runtime-endpoint=unix:///run/cri-dockerd.sock  \\\\\n    --node-labels=node.kubernetes.io/node= \n\n\n[Install]\nWantedBy=multi-user.target\nEOF\n```\n\nï¼ˆ2ï¼‰åˆ›å»ºkubeleté…ç½®æ–‡ä»¶\n\n```shell\ncat > /etc/kubernetes/kubelet-conf.yml <<EOF\napiVersion: kubelet.config.k8s.io/v1beta1\nkind: KubeletConfiguration\naddress: 0.0.0.0\nport: 10250\nreadOnlyPort: 10255\nauthentication:\n  anonymous:\n    enabled: false\n  webhook:\n    cacheTTL: 2m0s\n    enabled: true\n  x509:\n    clientCAFile: /etc/kubernetes/pki/ca.pem\nauthorization:\n  mode: Webhook\n  webhook:\n    cacheAuthorizedTTL: 5m0s\n    cacheUnauthorizedTTL: 30s\ncgroupDriver: systemd\ncgroupsPerQOS: true\nclusterDNS:\n- 10.96.0.10\nclusterDomain: cluster.local\ncontainerLogMaxFiles: 5\ncontainerLogMaxSize: 10Mi\ncontentType: application/vnd.kubernetes.protobuf\ncpuCFSQuota: true\ncpuManagerPolicy: none\ncpuManagerReconcilePeriod: 10s\nenableControllerAttachDetach: true\nenableDebuggingHandlers: true\nenforceNodeAllocatable:\n- pods\neventBurst: 10\neventRecordQPS: 5\nevictionHard:\n  imagefs.available: 15%\n  memory.available: 100Mi\n  nodefs.available: 10%\n  nodefs.inodesFree: 5%\nevictionPressureTransitionPeriod: 5m0s\nfailSwapOn: true\nfileCheckFrequency: 20s\nhairpinMode: promiscuous-bridge\nhealthzBindAddress: 127.0.0.1\nhealthzPort: 10248\nhttpCheckFrequency: 20s\nimageGCHighThresholdPercent: 85\nimageGCLowThresholdPercent: 80\nimageMinimumGCAge: 2m0s\niptablesDropBit: 15\niptablesMasqueradeBit: 14\nkubeAPIBurst: 10\nkubeAPIQPS: 5\nmakeIPTablesUtilChains: true\nmaxOpenFiles: 1000000\nmaxPods: 110\nnodeStatusUpdateFrequency: 10s\noomScoreAdj: -999\npodPidsLimit: -1\nregistryBurst: 10\nregistryPullQPS: 5\nresolvConf: /etc/resolv.conf\nrotateCertificates: true\nruntimeRequestTimeout: 2m0s\nserializeImagePulls: true\nstaticPodPath: /etc/kubernetes/manifests\nstreamingConnectionIdleTimeout: 4h0m0s\nsyncFrequency: 1m0s\nvolumeStatsAggPeriod: 1m0s\nEOF\n```\n\nï¼ˆ3ï¼‰å¯åŠ¨kubeletæœåŠ¡\n\n```shell\nsystemctl daemon-reload\nsystemctl enable --now kubelet\nsystemctl status kubelet\n```\n\n#### kube-proxyç»„ä»¶ï¼ˆæ‰€æœ‰èŠ‚ç‚¹ï¼‰\n\nï¼ˆ1ï¼‰å°†è¯ä¹¦å‘é€è‡³å…¶ä»–èŠ‚ç‚¹\n\n```shell\nfor NODE in k8s-master02 k8s-master03 k8s-node01 k8s-node02; do scp /etc/kubernetes/kube-proxy.kubeconfig $NODE:/etc/kubernetes/kube-proxy.kubeconfig; done\n```\n\nï¼ˆ2ï¼‰æ·»åŠ kube-proxyæœåŠ¡\n\n```shell\ncat >  /usr/lib/systemd/system/kube-proxy.service << EOF\n[Unit]\nDescription=Kubernetes Kube Proxy\nDocumentation=https://github.com/kubernetes/kubernetes\nAfter=network.target\n\n[Service]\nExecStart=/usr/local/bin/kube-proxy \\\\\n  --config=/etc/kubernetes/kube-proxy.yaml \\\\\n  --cluster-cidr=172.16.0.0/12,fc00:2222::/112 \\\\\n  --v=2\nRestart=always\nRestartSec=10s\n\n[Install]\nWantedBy=multi-user.target\n\nEOF\n```\n\nï¼ˆ3ï¼‰åˆ›å»ºkube-proxyé…ç½®æ–‡ä»¶\n\n```shell\ncat > /etc/kubernetes/kube-proxy.yaml << EOF\napiVersion: kubeproxy.config.k8s.io/v1alpha1\nbindAddress: 0.0.0.0\nclientConnection:\n  acceptContentTypes: \"\"\n  burst: 10\n  contentType: application/vnd.kubernetes.protobuf\n  kubeconfig: /etc/kubernetes/kube-proxy.kubeconfig\n  qps: 5\nclusterCIDR: 172.16.0.0/12,fc00:2222::/112\nconfigSyncPeriod: 15m0s\nconntrack:\n  max: null\n  maxPerCore: 32768\n  min: 131072\n  tcpCloseWaitTimeout: 1h0m0s\n  tcpEstablishedTimeout: 24h0m0s\nenableProfiling: false\nhealthzBindAddress: 0.0.0.0:10256\nhostnameOverride: \"\"\niptables:\n  masqueradeAll: false\n  masqueradeBit: 14\n  minSyncPeriod: 0s\n  syncPeriod: 30s\nipvs:\n  masqueradeAll: true\n  minSyncPeriod: 5s\n  scheduler: \"rr\"\n  syncPeriod: 30s\nkind: KubeProxyConfiguration\nmetricsBindAddress: 127.0.0.1:10249\nmode: \"ipvs\"\nnodePortAddresses: null\noomScoreAdj: -999\nportRange: \"\"\nudpIdleTimeout: 250ms\nEOF\n```\n\nï¼ˆ4ï¼‰å¯åŠ¨kube-proxyæœåŠ¡\n\n```shell\nsystemctl daemon-reload\nsystemctl enable --now kube-proxy.service\nsystemctl status kube-proxy.service\n```\n\n### å®‰è£…Calicoç½‘ç»œæ’ä»¶\n\nï¼ˆ1ï¼‰ä¸‹è½½å®‰è£…Calicoæ’ä»¶\n\n```shell\nwget https://hub.gitmirror.com/https://raw.githubusercontent.com/projectcalico/calico/v3.30.2/manifests/calico.yaml \n\n\n#å–æ¶ˆæ³¨é‡Šå¹¶ä¿®æ”¹podç½‘ç«¯\n- name: CALICO_IPV4POOL_CIDR\n   value: \"172.16.0.0/12\"\n\n#æ›´æ”¹å®¹å™¨é•œåƒæº\nsed -i \"s#docker.io/calico/#m.daocloud.io/docker.io/calico/#g\" calico.yaml\n#æ‰§è¡Œå®‰è£…\nkubectl apply -f calico.yaml\n```\n\n### å®‰è£…CoreDNS\n\nï¼ˆ1ï¼‰ä¸‹è½½å®‰è£…Helm\n\n```shell\nwget https://get.helm.sh/helm-v3.18.4-linux-amd64.tar.gz\ntar -zxvf helm-v3.18.4-linux-amd64.tar.gz\ncp -a linux-amd64/helm /usr/local/bin/\nchmod a+x /usr/local/bin/helm\nhelm version\n```\n\nï¼ˆ2ï¼‰ä½¿ç”¨Helmå®‰è£…CoreDNS\n\n```shell\nhelm repo add coredns https://coredns.github.io/helm\nhelm pull coredns/coredns\ntar xvf coredns-*.tgz\ncd coredns/\n```\n\nï¼ˆ3ï¼‰ä¿®æ”¹values.ymlæ–‡ä»¶\n\n```shell\nclusterIP: \"10.96.0.10\"\n\n#æ›´æ¢é•œåƒæº\nsed -i  's|coredns/coredns|m.daocloud.io/docker.io/coredns/coredns|g' values.yaml\n sed -i \"s|registry.k8s.io/cpa/cluster-proportional-autoscaler|m.daocloud.io/registry.k8s.io/cpa/cluster-proportional-autoscaler|g\" values.yaml\n```\n\nï¼ˆ4ï¼‰å®‰è£…\n\n```shell\nhelm install  coredns ./ -n kube-system\n#æŸ¥çœ‹å®‰è£…æƒ…å†µ\nkubectl get pod -n kube-system\n```\n\n### å®‰è£…Metrics Server\n\n```shell\nwget https://hub.gitmirror.com/https://github.com/kubernetes-sigs/metrics-server/releases/download/v0.8.0/components.yaml\n\n#ä¿®æ”¹é…ç½®\n      - args:\n        - --cert-dir=/tmp\n        - --secure-port=10250\n        - --kubelet-preferred-address-types=InternalIP,ExternalIP,Hostname\n        - --kubelet-use-node-status-port\n        - --metric-resolution=15s\n        - --kubelet-insecure-tls\n        - --requestheader-client-ca-file=/etc/kubernetes/pki/front-proxy-ca.pem\n        - --requestheader-username-headers=X-Remote-User\n        - --requestheader-group-headers=X-Remote-Group\n        - --requestheader-extra-headers-prefix=X-Remote-Extra-\n\n\n\n        volumeMounts:\n        - mountPath: /tmp\n          name: tmp-dir\n        - name: ca-ssl\n          mountPath: /etc/kubernetes/pki\n\n          \n\n      volumes:\n      - emptyDir: {}\n        name: tmp-dir\n      - name: ca-ssl\n        hostPath:\n          path: /etc/kubernetes/pki\n          \n          \n#ä¿®æ”¹é•œåƒæº\nsed -i \"s#registry.k8s.io/#m.daocloud.io/registry.k8s.io/#g\" components.yaml\n\n#æ‰§è¡Œéƒ¨ç½²\nkubectl apply -f components.yaml\n\n#éªŒè¯\n kubectl top pod -A\n```\n\n### è®¾ç½®å„èŠ‚ç‚¹è§’è‰²æ ‡ç­¾å’Œæ±¡ç‚¹\n\nï¼ˆ1ï¼‰è®¾ç½®masterèŠ‚ç‚¹æ±¡ç‚¹\n\n```\nkubectl taint node k8s-master01 node-role.kubernetes.io/master:NoSchedule\nkubectl taint node k8s-master02 node-role.kubernetes.io/master:NoSchedule\nkubectl taint node k8s-master03 node-role.kubernetes.io/master:NoSchedule\n```\n\nï¼ˆ2ï¼‰è®¾ç½®å„èŠ‚ç‚¹è§’è‰²æ ‡ç­¾\n\n```shell\n#k8s-master01\nkubectl label nodes k8s-master01 node-role.kubernetes.io/master=\nkubectl label nodes k8s-master01 node-role.kubernetes.io/control-plane=\n#k8s-master02\nkubectl label nodes k8s-master02 node-role.kubernetes.io/master=\nkubectl label nodes k8s-master02 node-role.kubernetes.io/control-plane=\n#k8s-master03\nkubectl label nodes k8s-master03 node-role.kubernetes.io/master=\nkubectl label nodes k8s-master03 node-role.kubernetes.io/control-plane=\n#k8s-node01\nkubectl label nodes k8s-node01 node-role.kubernetes.io/worker=\n#k8s-node02\nkubectl label nodes k8s-node02 node-role.kubernetes.io/worker=\n```\n\n### è®¾ç½®å‘½ä»¤è¡¥å…¨\n\n```shell\nyum install bash-completion -y\nsource /usr/share/bash-completion/bash_completion\nsource <(kubectl completion bash)\necho \"source <(kubectl completion bash)\" >> ~/.bashrc\n```\n\n### éªŒè¯é«˜å¯ç”¨\n\nï¼ˆ1ï¼‰éªŒè¯etcdé›†ç¾¤é«˜å¯ç”¨\n\n```shell\n#éªŒè¯etcdé›†ç¾¤é«˜å¯ç”¨\nexport ETCDCTL_API=3\netcdctl --endpoints=\"192.168.0.113:2379,192.168.0.112:2379,192.168.0.111:2379\" --cacert=/etc/kubernetes/pki/etcd/etcd-ca.pem --cert=/etc/kubernetes/pki/etcd/etcd.pem --key=/etc/kubernetes/pki/etcd/etcd-key.pem  endpoint status --write-out=table\n```\n\nï¼ˆ2ï¼‰ä½¿ç”¨ etcdhelper æŸ¥è¯¢ etcd ä¸­ k8s çš„èµ„æºæ•°æ®\n\n```shell\n#æ‹‰å–etcdhelperæºç æ–‡ä»¶\ngit clone --depth 1 https://hub.gitmirror.com/https://github.com/openshift/origin.git\n\n#ä¸‹è½½ä¾èµ–è½¯ä»¶\nyum install -y go\n#æ„å»ºetcdhelperæ‰§è¡Œç¨‹åº\ncd origin/tools/etcdhelper\ngo build etcdhelper.go\nmv etcdhelper /usr/local/bin/\n\n#è®¾å®šå‚æ•°åˆ«å\necho 'alias ectl=\"etcdhelper -endpoint https://192.168.0.111:2379 -cacert /etc/etcd/ssl/etcd-ca.pem -key /etc/etcd/ssl/etcd-key.pem -cert /etc/etcd/ssl/etcd.pem\"' >> ~/.bashrc\n\n#æ‰§è¡Œé…ç½®ç”Ÿæ•ˆ\nsource ~/.bashrc\n\n#æŸ¥çœ‹etcdæ•°æ®\nectl ls\n# æŸ¥çœ‹å½“å‰çš„ schedule ä¸»èŠ‚ç‚¹\nectl get /registry/leases/kube-system/kube-scheduler\n# æŸ¥çœ‹å½“å‰çš„ controllermanager ä¸»èŠ‚ç‚¹\nectl get /registry/leases/kube-system/kube-controller-manager\n```\n\n### éƒ¨ç½²deploymentéªŒè¯\n\n```yaml\nvi test.yml\n\napiVersion: apps/v1\nkind: Deployment\nmetadata:\n  name: test01\nspec:\n  replicas: 6\n  selector:\n    matchLabels:\n      app: test01  \n  template:\n    metadata:\n      labels:\n        app: test01 \n    spec:\n      containers:\n      - name: test01\n        image: nginx\n        ports:\n        - containerPort: 80  \n\n---\n\napiVersion: apps/v1\nkind: Deployment\nmetadata:\n  name: test02\nspec:\n  replicas: 5\n  selector:\n    matchLabels:\n      app: test02\n  template:\n    metadata:\n      labels:\n        app: test02\n    spec:\n      nodeName: k8s-node02\n      containers:\n      - name: test02\n        image: nginx\n        ports:\n        - containerPort: 80  \n\n---\n\napiVersion: v1\nkind: Service\nmetadata:\n  name: test01\nspec:\n  type: NodePort  \n  selector:\n    app: test01\n  ports:\n  - name: http\n    port: 80       \n    targetPort: 80  \n\n---\n\napiVersion: v1\nkind: Service\nmetadata:\n  name: test02\nspec:\n  type: NodePort  \n  selector:\n    app: test02\n  ports:\n  - name: http\n    port: 80       \n    targetPort: 80 \n    \n    \n#éƒ¨ç½²\nkubectl apply -f test.yml\n#æŸ¥çœ‹\nkubectl  get pod,svc,deployments -o wide\n#åœ¨æµè§ˆå™¨è®¿é—®æŸ¥çœ‹nginxè®¿é—®æƒ…å†µ\n```\n\n\n\n> æœ¬ç¯‡çŸ¥è¯†æ¥æºäºBç«™è§†é¢‘BV1PbeueyE8V\n","tags":["è¿ç»´","k8s","HELM","çŸ¥è¯†æ¢³ç†","Linux","äºŒè¿›åˆ¶é«˜å¯ç”¨k8sé›†ç¾¤"],"categories":["å®¹å™¨åŒ–","k8s","æ¢³ç†æ€»ç»“","HELM","çŸ¥è¯†æ¢³ç†"]},{"title":"ç§æœ‰åŒ–éƒ¨ç½²DeepSeek","url":"/yyg/4789a872/","content":"## å‰è¨€\n\nåœ¨linuxç¯å¢ƒä¸‹ï¼Œä½¿ç”¨dockeréƒ¨ç½²`ollama`+`deepseek-r1:1.5b`+`open-webui`ï¼Œå®ç°ç§æœ‰åŒ–éƒ¨ç½²DeepSeekã€‚\n\n## éƒ¨ç½²è¿‡ç¨‹\n\n### å®‰è£…docker\n\nä½¿ç”¨è„šæœ¬å®‰è£…dockerã€docker-compose\n\n```shell\n bash <(curl -sSL https://linuxmirrors.cn/docker.sh)\n```\n\n### æ–¹å¼ä¸€ï¼šdockerå‘½ä»¤å®‰è£…\n\n```shell\n#å®‰è£…å®‰è£…ollama\ndocker run -d -v /data/ollama:/root/.ollama -p 11434:11434 --name ollama ollama/ollama\n#å®‰è£…deepseek-r1:1.5b\ndocker exec -it ollama ollama run deepseek-r1:1.5b\n#å®‰è£…open-webui\ndocker run -d -p 3000:8080 --add-host=host.docker.internal:host-gateway -v /data/openwebui:/app/backend/data --name open-webui --restart always ghcr.io/open-webui/open-webui:v0.6.22\n\n export HF_ENDPOINT=https://hf-mirror.com\n```\n\n> open-webuié•œåƒæ‹‰å–è¾ƒæ…¢çš„æƒ…å†µå¯æ¢æºæ‹‰å–å¹¶ä¿®æ”¹é•œåƒæ ‡ç­¾ï¼Œå…·ä½“å‘½ä»¤å¦‚ä¸‹\n>\n> ```shell\n> docker pull swr.cn-north-4.myhuaweicloud.com/ddn-k8s/ghcr.io/open-webui/open-webui:v0.6.22\n> docker tag  swr.cn-north-4.myhuaweicloud.com/ddn-k8s/ghcr.io/open-webui/open-webui:v0.6.22  ghcr.io/open-webui/open-webui:v0.6.22\n> ```\n\n### æ–¹å¼äºŒï¼šcomposeæ–‡ä»¶æ–¹å¼å®‰è£…\n\n```yaml\nvi ai.yml\n#################################################\nservices:\n  ollama:\n    image: ollama/ollama\n    container_name: ollama\n    ports:\n      - \"11434:11434\"\n    volumes:\n      - \"/data/ollama:/root/.ollama\"\n    restart: always\n    entrypoint: [\"sh\", \"-c\", \"ollama run deepseek-r1:1.5b & /bin/ollama serve\"]\n    networks:\n      ai:\n        ipv4_address: 172.20.110.11\n  open-webui:\n    image: ghcr.io/open-webui/open-webui:v0.6.22\n    container_name: open-webui\n    ports:\n      - \"3000:8080\"\n    volumes:\n      - \"/data/openwebui:/app/backend/data\"\n    extra_hosts:\n      - \"host.docker.internal:host-gateway\"\n    restart: always\n    networks:\n      ai:\n        ipv4_address: 172.20.110.12\n\nnetworks:\n ai:\n  driver: bridge\n  ipam:\n   config:\n    - subnet: 172.20.110.0/24\n      \n########################################################\n\n#æ‰§è¡Œéƒ¨ç½²\ndocker compose -f ai.yml up -d\n```\n\n> æ‰§è¡Œå®Œæˆåï¼Œå¦‚æœåœ¨open webuiä¸­æ²¡æœ‰æœ¬åœ°æ¨¡å‹deepseek-r1:1.5bï¼Œè¾“å…¥docker logs -f ollamaå‘½ä»¤æŸ¥çœ‹ï¼Œollamaä¸‹è½½deepseek-r1:1.5bæ¨¡å‹çš„è¿›åº¦ï¼Œç­‰å¾…è¿›åº¦å®Œæˆå³å¯ã€‚\n\n## æ·»åŠ çŸ¥è¯†åº“\n\nï¼ˆ1ï¼‰åœ¨Open WebUIä¸­ï¼Œé€‰æ‹©`ç®¡ç†å‘˜é¢æ¿`-`è®¾ç½®`-`æ–‡æ¡£`ï¼Œæ‰“å¼€`ç»•è¿‡åµŒå…¥å’Œæ£€ç´¢`é€‰é¡¹å¹¶ä¿å­˜ã€‚\n\nï¼ˆ2ï¼‰åœ¨`å·¥ä½œç©ºé—´`-`çŸ¥è¯†åº“`ä¸­åˆ›å»ºçŸ¥è¯†åº“ï¼Œå¹¶å°†æ–‡ä»¶ä¸Šä¼ åˆ°çŸ¥è¯†åº“å³å¯ã€‚\n\n![img](ç§æœ‰åŒ–éƒ¨ç½²DeepSeek/1.png)\n\n## è°ƒç”¨æœ¬åœ°çŸ¥è¯†åº“\n\nåœ¨å¯¹è¯æ¡†å†…è¾“å…¥`#`ï¼Œè°ƒç”¨å¯¹åº”çŸ¥è¯†åº“ï¼Œå¤§æ¨¡å‹ä¼šå¼•ç”¨å¹¶å›ç­”ç›¸å…³å†…å®¹ã€‚\n\n![img](ç§æœ‰åŒ–éƒ¨ç½²DeepSeek/2.png)\n","tags":["AI","AIçŸ¥è¯†åº“","ollama","DeepSeek","open-webui"],"categories":["æ¼«è°ˆ","AI"]},{"title":"ä½¿ç”¨GitHub Actionså®ç°Hexoåšå®¢çš„è‡ªåŠ¨åŒ–å‘å¸ƒ","url":"/yyg/37098f8c/","content":"## åŸºç¡€ç¯å¢ƒ\n\n### åŸç¯å¢ƒ\n\nä»“åº“ï¼šå­˜æ”¾é™æ€ç½‘é¡µçš„ä»“åº“ï¼ˆå…¬å¼€ï¼‰\n\nå·¥ä½œæµï¼šæœ¬åœ°æ’°å†™åšå®¢-->æ‰§è¡Œç¼–è¯‘ï¼Œç”Ÿæˆé™æ€ç½‘é¡µ-->æ¨é€é™æ€ç½‘é¡µåˆ°ä»“åº“-->è®¿é—®å‘å¸ƒçš„ç½‘é¡µ\n\n### æ–°ç¯å¢ƒ\n\nä»“åº“1ï¼šå­˜æ”¾åšå®¢æºç çš„ä»“åº“ï¼ˆç§æœ‰ï¼‰\n\nä»“åº“2ï¼šå­˜æ”¾é™æ€ç½‘é¡µçš„ä»“åº“ï¼ˆå…¬å¼€ï¼‰\n\nå·¥ä½œæµï¼šæœ¬åœ°æ’°å†™åšå®¢-->æºç æ¨é€è‡³ä»“åº“1-->ä½¿ç”¨GitHub Actionsè‡ªåŠ¨ç¼–è¯‘å’Œæ¨é€é™æ€ç½‘é¡µåˆ°ä»“åº“2-->è®¿é—®å‘å¸ƒçš„ç½‘é¡µ\n\n{% tip info %}ä¸åŸç¯å¢ƒç›¸æ¯”ï¼Œåœ¨æ–°ç¯å¢ƒä¸‹çš„å·¥ä½œæµï¼Œå°†æ‰‹åŠ¨æ‰§è¡Œç”±ä¸¤æ­¥ç¼©å‡è‡³ä¸€æ­¥ï¼ŒåŒæ—¶äº†ä¿è¯æºç å­˜æœ‰å¤‡ä»½ï¼Œä¹Ÿå¯ç›´æ¥åœ¨GitHubä»“åº“ä¸­åœ¨çº¿ç¼–è¾‘ï¼Œé™ä½å¯¹è®¾å¤‡çš„ä¾èµ–æ€§ã€‚\n\næœ¬æ–‡æ˜¯åœ¨æœ‰åŸç¯å¢ƒçš„åŸºç¡€ä¸Šè¿›è¡Œ\n\n{% endtip %}\n\n## æ–°å»ºä»“åº“å­˜æ”¾æºç \n\nåœ¨githubä¸­åˆ›å»ºä¸€ä¸ªæ–°ä»“åº“ç”¨æ¥å­˜æ”¾åšå®¢æºç ï¼Œå¹¶è®¾ç½®å¯è§æ€§è®¾ä¸º`Private`ã€‚\n\n## è®¾ç½®èº«ä»½éªŒè¯ä»¤ç‰Œ\n\n1.ç‚¹å‡»å¤´åƒï¼Œé€‰æ‹© â€œSettingsâ€ -> â€œDeveloper settingsâ€ -> â€œPersonal access tokensâ€->â€Tokensï¼ˆclassicï¼‰â€œï¼Œç‚¹å‡» â€œGenerate new tokenâ€ï¼Œé€‰æ‹©â€Generate new tokenï¼ˆclassicï¼‰â€œï¼ŒéªŒè¯åï¼ŒæŒ‡å®šä¸€ä¸ªæè¿°æ€§åç§°ï¼Œé€‰æ‹©ä»¤ç‰Œçš„æœ‰æ•ˆæ—¶é—´ä¸º\"No expiration\"ï¼ˆæ°¸ä¸è¿‡æœŸï¼‰ï¼Œé€‰æ‹©è¦æˆäºˆæ­¤ä»¤ç‰Œçš„èŒƒå›´æˆ–æƒé™ï¼Œå‹¾é€‰repoå’Œworkflows é¡¹å³å¯ã€‚ç‚¹å‡»â€Generate tokenâ€œï¼Œå®Œæˆåˆ›å»ºã€‚\n\n![img](ä½¿ç”¨GitHub Actionså®ç°Hexoåšå®¢çš„è‡ªåŠ¨åŒ–å‘å¸ƒ/1.png)\n\n2.åˆ›å»ºå®Œæˆåï¼Œå¤åˆ¶ä¿å­˜tokenï¼Œåé¢è¦ç”¨ã€‚\n\n3.è¿›å…¥åˆšåˆ›å»ºå¥½çš„ç§æœ‰ä»“åº“ï¼Œè¿›å…¥ä»“åº“çš„â€œSettingsâ€ -> â€œSecrets and variablesâ€ -> â€œActionsâ€ã€‚ç‚¹å‡»â€Repository secretsâ€œä¸­çš„â€œNew repository secretâ€ï¼Œè‡ªå®šä¹‰è¾“å…¥Actions secrets çš„åå­—ï¼Œå¹¶å°†ç¬¬2æ­¥å¤åˆ¶çš„tokenç²˜è´´è‡³Secretsæ¡†ä¸­ï¼Œç‚¹å‡»â€Add secretâ€œä¿å­˜ã€‚\n\n![img](ä½¿ç”¨GitHub Actionså®ç°Hexoåšå®¢çš„è‡ªåŠ¨åŒ–å‘å¸ƒ/2.png)\n\n## åˆ›å»º Github Actions è„šæœ¬\n\n1.åœ¨æœ¬åœ°åšå®¢çš„æ ¹ç›®å½•çš„`.github`ç›®å½•ä¸‹æ–°å»º`workflows`ç›®å½•ï¼Œå¹¶åœ¨`workflows`ç›®å½•ä¸­åˆ›å»ºGithub Actions è„šæœ¬æ–‡ä»¶`autodeploy.yml`ã€‚\n\n```yaml\nname: Hexoç¼–è¯‘å‘å¸ƒé™æ€ç½‘é¡µè‡³Github Page\n\non:\n  push:\n    branches:\n      - main  #é»˜è®¤åˆ†æ”¯\n\njobs:\n  deploy:\n    runs-on: ubuntu-latest\n\n    steps:\n      - name: æ£€æŸ¥æºç \n        uses: actions/checkout@v4\n        with:\n          ref: main #é»˜è®¤åˆ†æ”¯\n          path: blog  #æºç åœ¨ubuntuæœåŠ¡å™¨ä¸­çš„å­˜æ”¾ç›®å½•\n          fetch-depth: 0 #è·å–æ‰€æœ‰åˆ†æ”¯å’Œæ ‡ç­¾çš„æ‰€æœ‰å†å²è®°å½•\n      \n      - name: è·å–æ–‡ç« æ›´æ–°çš„æœ€æ–°æ—¶é—´\n        run: |\n          git ls-files -z '*.md' | while read -d '' path; do\n            touch -d \"$(git log -1 --format=\"@%ct\" \"$path\")\" \"$path\"\n          done\n        working-directory: ./blog/source/_posts\n          \n      - name: å®‰è£…Node.js\n        uses: actions/setup-node@v4\n        with:\n          node-version: \"24\" #å¯¹åº”æœ¬åœ°ä½¿ç”¨ç‰ˆæœ¬\n          cache: 'npm' #å¯ç”¨npmä¾èµ–ç¼“å­˜\n          cache-dependency-path: '**/package-lock.json' #æŒ‡å®šç¼“å­˜ä¾èµ–çš„ lock æ–‡ä»¶è·¯å¾„\n\n      - name: ä¸‹è½½ä¾èµ–\n        run: npm install\n        working-directory: ./blog\n\n      - name: å®‰è£…Hexo\n        run: |\n          export TZ='Asia/Shanghai'\n          npm install -g hexo-cli\n        working-directory: ./blog\n\n      - name: ç¼“å­˜Hexo\n        id: cache-npm\n        uses: actions/cache@v4\n        env:\n          cache-name: cache-node-modules\n        with:\n          path: node_modules\n          key: ${{ runner.os }}-build-${{ env.cache-name }}-${{ hashFiles('**/package-lock.json') }}\n          restore-keys: |\n            ${{ runner.os }}-build-${{ env.cache-name }}-\n            ${{ runner.os }}-build-\n            ${{ runner.os }}-\n\n      - name: ç¼–è¯‘ç”Ÿæˆé™æ€ç½‘é¡µ\n        run: |\n          hexo clean        \n          hexo generate \n        working-directory: ./blog          \n\n      - name: å‘å¸ƒè‡³GitHub Pages\n        uses: peaceiris/actions-gh-pages@v4\n        with:\n          personal_token: ${{ secrets.PERSONAL_TOKEN }} #æ­¤å¤„çš„PERSONAL_TOKENæ”¹ä¸ºä¹‹å‰è®¾ç½®çš„è®¾ç½®èº«ä»½éªŒè¯ä»¤ç‰Œçš„åç§°\n          publish_dir: ./blog/public\n          external_repository: username/username.github.io  #æ›´æ”¹ä¸ºä»“åº“2çš„åå­—, usernameæ˜¯ä½ çš„ç”¨æˆ·å\n          publish_branch: main  #ä»“åº“2å‘å¸ƒé™æ€é¡µé¢çš„å¯¹åº”åˆ†æ”¯\n```\n\n{% note green 'fas fa-bullhorn' modern %}\nä¿®å¤äº†ä½¿ç”¨github actionsé€ æˆåšå®¢çš„æ›´æ–°æ—¶é—´é”™è¯¯çš„é—®é¢˜\n{% endnote %}\n\n2.åœ¨æœ¬åœ°åšå®¢çš„æ ¹ç›®å½•è¿›è¡Œä»“åº“çš„gitåˆå§‹åŒ–ã€‚\n\n```bash\ngit init\ngit branch -M main\ngit remote add origin \ngit@github.com:ç”¨æˆ·å/ä»“åº“1åç§°.git\n```\n\n3.åœ¨æœ¬åœ°åšå®¢çš„æ ¹ç›®å½•ä¸‹ï¼Œè®¾ç½®æäº¤gitçš„ç”¨æˆ·å’Œé‚®ç®±ï¼Œä»…åœ¨å½“å‰ç›®å½•ä¸‹ç”Ÿæ•ˆã€‚ï¼ˆä¹Ÿå¯è®¾ç½®å…¨å±€ç”Ÿæ•ˆï¼‰\n\n```bash\ngit config  user.name 'ç”¨æˆ·å'\ngit config  user.email 'é‚®ç®±åœ°å€'\n```\n\n4.å°†`themes\\butterfly`ç›®å½•ä¸‹çš„`.git`ç›®å½•ç§»é™¤ï¼Œæ‰§è¡Œä»¥ä¸‹å‘½ä»¤æäº¤æºç åˆ°ä»“åº“1ä¸­ã€‚\n\n```bash\ngit add .\ngit commit -m \"github actions\"\ngit push -u origin main\n```\n\n5.æäº¤å®Œæˆåï¼Œåœ¨ä»“åº“1ä¸­çš„â€Actionsâ€œä¸­æŸ¥çœ‹å·¥ä½œæµçš„æ‰§è¡ŒçŠ¶æ€ã€‚æ‰§è¡ŒæˆåŠŸåï¼Œä»“åº“2çš„é™æ€é¡µé¢ä¼šåŒæ­¥æ›´æ–°ã€‚\n\n![img](ä½¿ç”¨GitHub Actionså®ç°Hexoåšå®¢çš„è‡ªåŠ¨åŒ–å‘å¸ƒ/3.png)\n\n**å‚è€ƒé“¾æ¥**\n\n{% link å®‰çŸ¥é±¼ | ä½¿ç”¨ Github Action è‡ªåŠ¨éƒ¨ç½²,https://blog.anheyu.com/posts/asdx.html,https://npm.elemecdn.com/anzhiyu-blog-static@1.0.4/img/avatar.jpg %}\n\n{% link Gavin Zhou's Blog | åˆ©ç”¨ GitHub Actions å®ç°è‡ªåŠ¨åŒ–éƒ¨ç½² Hexo åˆ° Github Pages,https://blog.leonus.cn/2022/footer.html,https://hackergavin.com/logo.png %}\n\n{% link peaceiris | githubä»“åº“actions-gh-pages,https://github.com/peaceiris/actions-gh-pages,https://avatars.githubusercontent.com/u/30958501?v=4 %}\n\n{% folding green open,åšå®¢æ­å»ºç³»åˆ—æ–‡ç«  %}\n\n{% series åšå®¢æ­å»ºæ•™ç¨‹ %}\n\n{% endfolding %}\n","tags":["åšå®¢","é­”æ”¹","GitHub Pages","GitHub Actions"],"categories":["åšå®¢æ•™ç¨‹","åšå®¢è‡ªåŠ¨åŒ–å‘å¸ƒ"]},{"title":"è§‚å½±æ„Ÿå—--é›„ç‹®å°‘å¹´2","url":"/yyg/9e02bef8/","content":"{% note green 'fas fa-bullhorn' modern %}\nä¸€åƒä¸ªè¯»è€…çœ¼ä¸­æœ‰ä¸€åƒä¸ªå“ˆå§†é›·ç‰¹\n\nè¯¥ç¯‡ä¸ºä¸»è§‚è§‚å½±æ„Ÿå—ï¼Œéä¸“ä¸šåˆ†æï¼Œè¯·å‹¿è¿‡åº¦è§£è¯»ï¼\n{% endnote %}\n\n## å¤§è‡´å‰§æƒ…\n\nã€Šé›„ç‹®å°‘å¹´2ã€‹æ˜¯åœ¨æˆ‘ç”Ÿæ´»çš„æ–°ç¯‡ç« ä¸­çš„ç¬¬ä¸€éƒ¨ç”µå½±ï¼Œä¸¤ä¸ªå¤šå°æ—¶ï¼Œçœ‹èµ·æ¥æ°åˆ°å¥½å¤„ã€‚\n\nå½±ç‰‡ä¸­é˜¿å¨Ÿé˜¿çŒ«é˜¿ç‹—ä¸‰å…„å¼Ÿé€šè¿‡èˆç‹®åœ¨å•†ä¸šæ´»åŠ¨ä¸Šè®¤è¯†äº†æ±‚çœŸæ­¦é¦†çš„å¼ ç“¦ç‰¹å’Œç‹æœé›¨ã€‚å·¥ä½œçš„ä¸¢å¤±è®©æˆ¿ä¸œçš„å¼ºè¡Œæ¢æˆ¿å˜æˆäº†ä¸‰å…„å¼Ÿçš„æ— å¤„ä¼‘æ†©ï¼Œä¿ƒä½¿é˜¿å¨Ÿâ€œä¸Šé—¨è®¨è–ªâ€ã€‚\n\nä¼ ç»Ÿæ­¦é¦†çš„æ²¡è½ï¼Œæ±‚çœŸæ­¦é¦†æ¿’ä¸´å€’é—­ã€‚ä¸ºæ¢å¤æ­¦é¦†çš„â€œç”Ÿæœºâ€ï¼Œç‹æœé›¨å¸¦ç€éœ€è¦ç»™çˆ¶äº²æ²»ç–—ç–¾ç—…çš„é˜¿å¨Ÿï¼Œå‚åŠ äº†â€œä¸Šæµ·æ ¼æ–—ä¹‹å¤œâ€æ¯”èµ›ã€‚\n\né˜¿å¨Ÿå‡­æ®ç€èˆç‹®çš„æ­¦æœ¯åŸºç¡€å’Œå¼ ç“¦ç‰¹çš„æŒ‡å¯¼ä¸‹ï¼Œç»è¿‡ä¸‰ä¸ªæœˆçš„â€œé­”é¬¼è®­ç»ƒâ€ï¼Œåœ¨æ¯”èµ›ä¸­ä»¥é»‘é©¬ä¹‹åŠ¿ï¼Œåå£°å¤§å™ªã€‚åå› é‡‘é‘«æ ¼æ–—ä¿±ä¹éƒ¨é€ è°£æ±¡è”‘ï¼Œè€Œè¢«å–æ¶ˆèµ„æ ¼ã€‚\n\nå¾è®°è€…æ•é”å‘ç°ç½‘ç»œæ°´å†›æ“çºµèˆ†è®ºï¼Œä»¥åŠé‡‘é‘«æ ¼æ–—ä¿±ä¹éƒ¨æ‹³æ‰‹çš„ä½œå¼ŠçŒ«è…»ã€‚ä¸é˜¿å¨Ÿç­‰äººä¸€èµ·æˆåŠŸæ­éœ²çœŸç›¸ï¼Œæå«å°Šä¸¥ã€‚\n\n## äººç‰©åˆ†æ\n\nå½±ç‰‡ä¸­ä¸‰äººçš„èˆç‹®æ˜¯å—ç‹®ï¼Œè€Œå—ç‹®åˆç§°â€œé†’ç‹®â€ï¼Œå—ç‹®ç‹®å¤´æœ‰â€œåˆ˜å¤‡â€ã€â€œå…³ç¾½â€ã€â€œå¼ é£â€ä¹‹åˆ†ã€‚é˜¿å¨Ÿä¸‰äººè§’è‰²ä¼¼æœ‰å¯¹åº”ä¹‹æ„ã€‚\n\nå½±ç‰‡é«˜æ½®éƒ¨åˆ†é˜¿å¨ŸæŒ‘æˆ˜è‚–å¼ æ‰¬ï¼Œé˜¿å¨Ÿä¸‰äººä»¥â€œé†’ç‹®â€å…¥åœºï¼Œä¼¼æœ‰å”¤é†’åŒèƒä¹‹æ„ã€‚\n\nå¯¹äººç‰©çš„åˆ†æä¸»è¦æ˜¯èˆç‹®çš„é˜¿å¨Ÿã€é˜¿çŒ«ã€é˜¿ç‹—ä¸‰äººã€‚\n\n### é˜¿å¨Ÿï¼š\n\nåœ¨ç”Ÿå­˜å‹åŠ›ä¸‹ï¼Œå‹‡äºæ”¹å˜ï¼Œæ•¢æ‹¼ä¸”åŠªåŠ›ï¼Œæœ‰è¡€æœ‰è‚‰ï¼Œå½±ç‰‡ä¸­æœ‰ä¸€æ®µåŸå¸‚å„å¤„çš„é‡è‰é•œå¤´ï¼Œè€Œé˜¿å¨Ÿä¹Ÿæ˜¯å¦‚é‡è‰èˆ¬ï¼Œæ— è®ºç¯å¢ƒå¦‚ä½•è‰°éš¾ï¼Œä»æ—§å¯ä»¥é¡½å¼ºç”Ÿé•¿ã€‚\n\n### é˜¿çŒ«ï¼š\n\né˜¿çŒ«æ˜¯å½±ç‰‡ä¹‹ä¸­è®©æˆ‘è§‰å¾—æƒŠè‰³çš„è§’è‰²ä¹‹ä¸€ï¼Œæ‡‚å¾—æŠŠæ¡æ—¶æœºï¼Œä¸”æ°åˆ°å¥½å¤„ã€‚å½±ç‰‡ä¸­æœ‰3å¤„æ˜¯é˜¿çŒ«çœ‹å‡†æœºä¼šçš„åœºæ™¯ï¼Œåˆ†åˆ«æ˜¯ï¼š\n\n- å¼€å¤´ä»¥é˜¿çŒ«çš„è¯å¼•å‡ºèˆç‹®çš„æ–‡åŒ–çŸ¥è¯†ä¸æœ‰æ­¦é¦†é‚€è¯·èˆç‹®å•†æ¼”\n- å¼ ç“¦ç‰¹ç¦»å¼€é—´éš™ï¼Œå°å­©è·Ÿå¦ˆå¦ˆåµç€è¦åƒç‚’é¢ï¼Œæµç•…çš„æ“ä½œå’Œå¯å£çš„å‘³é“ç›˜æ´»â€œå¤§æ’æ¡£â€\n- è‚–å¼ æ‰¬æ‹³å¥—ç ´è£‚ï¼Œä¸Šå°è®©ä¼—äººæ˜ç™½æ‹³å¥—ä¹‹ä¸­è—æœ‰çŸ³è†\n\n### é˜¿ç‹—ï¼š\n\né˜¿ç‹—æ˜¯æ‰¿åŒ…å½±ç‰‡ä¸­ç¬‘ç‚¹çš„â€œç¬‘ç‚¹ä¹‹ç‹â€ã€‚è™½ç„¶è¯ä¸å¤šï¼Œä½†æ¯æ¬¡éƒ½ä¸€è¯­ä¸­çš„ï¼Œäº†è§£å…¶ä»–ä¸¤äººï¼Œä¸”å’Œé¼“ä¹å¼•å¯¼èˆç‹®èŠ‚å¥ç›¸ä¼¼ï¼Œå¼•å¯¼é…åˆç€å…¶ä»–ä¸¤äººçš„å‰§æƒ…å‘å±•ã€‚\n\n## è§‚å½±æœ‰æ„Ÿ\n\nå½±ç‰‡ä¹‹ä¸­çš„äººç‰©å¡‘é€ å¾ˆæœ‰ç”Ÿå‘½åŠ›ï¼Œæ¯ä¸€ä¸ªæ™®é€šäººéƒ½åœ¨ä»¥è‡ªå·±çš„æ–¹å¼é¢å¯¹ç”Ÿæ´»ã€åŠªåŠ›ç”Ÿæ´»ã€åˆ›é€ ç”Ÿæ´»ã€‚\n\nä¸´è¿‘ç‰‡å°¾å¤„ï¼Œé˜¿å¨Ÿæå‡ºè´Ÿé¢æ–°é—»çš„ç–‘è™‘æ—¶ï¼Œç™½å‘è€äººå›ç­”ï¼šäº¤ç»™æ—¶é—´å§ï¼Œæˆ‘ç›¸ä¿¡æ¸…è€…è‡ªæ¸…ã€‚\n\näººç”Ÿå¹¶éå•ä¸€çš„çº¿æ€§ï¼Œæ¯ä¸€ä¸ªç‚¹éƒ½ä¼šæ³›èµ·è´è¶æ•ˆåº”ï¼Œæ—¶é—´è®©å‡ç›¸æš´éœ²æ— é—ï¼Œè®©çœŸç›¸å¤§ç™½å¤©ä¸‹ã€‚æ¸…è€…è‡ªæ¸…ï¼Œæ— æ„§äºå¿ƒè€…äº¦æ— æ‰€æƒ§ã€‚\n\n## å½±è¯\n\n> ç»ƒæ­¦ åšäºº éƒ½è¦å‡­ä¸€å£æ°”\n>\n> ä»–ä»¬æœ‰ä»–ä»¬çš„è§„åˆ™ æˆ‘ä»¬æœ‰æˆ‘ä»¬çš„æ‰“æ³•\n>\n> æˆ‘ä»¬ä¼ ç»Ÿæ­¦è€… æ—¢è¦å®ˆä½ä¼ ç»Ÿ ä¹Ÿè¦æœ‰æ”¹å˜çš„å‹‡æ°” åªæœ‰æ±‚æ–°æ±‚å˜ æœ€ç»ˆæ‰èƒ½æ±‚çœŸ\n>\n> æ“‚å°ä¸Šæ–—æ™ºæ–—å‹‡ æˆ˜æœ¯ç”¨å¾—å¥½å°±èƒ½ä»¥å¼±èƒœå¼º\n>\n> åƒé‡è‰ä¸€æ · æŠŠæ ¹æ­»æ­»åœ°æ‰åœ¨æ“‚å°ä¸Š\n>\n> å¦‚æœä½ èƒ½åƒè¿™é‡è‰ä¸€æ ·è®©ä»–çœ‹ä¸é€æ‰“ä¸å€’ è—åœ¨èƒŒåçš„ä¸€æ‹› å°±æœ‰å¯èƒ½æ”¾å€’ä»–\n>\n> è¿™ç‰‡é‡è‰èƒŒåæœ‰ä»€ä¹ˆ æˆ‘çœ‹åˆ°äº†ä¸€å¤´é›„ç‹®\n>\n> ä¸åˆ°æœ€åä¸€ç§’ æ°¸è¿œåˆ«è¯´æ”¾å¼ƒ\n>\n> æœªæ¥æ— è®ºåœ¨å“ªé‡Œ è¯·ä½ éƒ½ä¸è¦å¿˜è®° é‚£ä½åœ¨ä¹¦é‡Œå†™å†™ç”»ç”»çš„å°‘å¹´\n>\n> ä»°å¤©å¤§ç¬‘å‡ºé—¨å» æˆ‘è¾ˆå²‚æ˜¯è“¬è’¿äºº\n>\n> äº¤ç»™æ—¶é—´å§ æˆ‘ç›¸ä¿¡æ¸…è€…è‡ªæ¸…\n>\n\n\n\n","tags":["ç”µå½±","ä¼‘é—²å¨±ä¹","è§‚å½±æ„Ÿå—"],"categories":["æ¼«è°ˆ","ä¼‘é—²å¨±ä¹"]},{"title":"Hexo-Butterflyç¾åŒ–æ•™ç¨‹-[8]éšé¼ æ ‡å˜å¹»çš„åŠ¨æ€ç²’å­çº¿æ¡èƒŒæ™¯","url":"/yyg/5f747cff/","content":"\n{% note pink 'fas fa-bullhorn' flat %}\n\nåšå®¢ç°æœ‰èƒŒæ™¯å³ä¸ºæ–°ç‰ˆåŠ¨æ€ç²’å­çº¿æ¡èƒŒæ™¯\n\n{% endnote %}\n\n# æ–°ç‰ˆ\n\n## æ·»åŠ jsæ–‡ä»¶\n\nåœ¨`blog\\source\\js`ç›®å½•ä¸‹ï¼Œåˆ›å»º`background.js`æ–‡ä»¶ï¼ŒåŠ å…¥ä»¥ä¸‹å†…å®¹ã€‚\n\n```js\n(function () {\n    const config = {\n        particleCount: window.innerWidth < 768 ? 40 : 80,\n        connectionDistance: 140,\n        mouseDistance: 200,\n        zIndex: -1\n    };\n\n    const style = document.createElement('style');\n    style.textContent = `\n        #particle-bg-canvas {\n            position: fixed;\n            top: 0;\n            left: 0;\n            width: 100%;\n            height: 100%;\n            display: block;\n            pointer-events: none; \n            z-index: ${config.zIndex};\n        }\n    `;\n    document.head.appendChild(style);\n\n    const canvas = document.createElement('canvas');\n    canvas.id = 'particle-bg-canvas';\n    document.body.appendChild(canvas);\n\n    const ctx = canvas.getContext('2d');\n    let width, height;\n    let particles = [];\n    let mouse = { x: null, y: null };\n\n    function getTheme() {\n        // æ£€æŸ¥ window.matchMedia æ˜¯å¦æ”¯æŒæ·±è‰²æ¨¡å¼\n        if (window.matchMedia && window.matchMedia('(prefers-color-scheme: dark)').matches) {\n            return 'dark';\n        }\n        return 'light';\n    }\n\n    window.addEventListener('resize', resize);\n    window.addEventListener('mousemove', (e) => {\n        mouse.x = e.x;\n        mouse.y = e.y;\n    });\n    window.addEventListener('mouseout', () => {\n        mouse.x = null;\n        mouse.y = null;\n    });\n\n    function resize() {\n        width = canvas.width = window.innerWidth;\n        height = canvas.height = window.innerHeight;\n    }\n\n    class Particle {\n        constructor() {\n            this.x = Math.random() * width;\n            this.y = Math.random() * height;\n            this.vx = (Math.random() - 0.5) * 1;\n            this.vy = (Math.random() - 0.5) * 1;\n            this.size = Math.random() * 2 + 1;\n\n            // ä¿å­˜åŸºç¡€è‰²ç›¸ï¼Œé¥±å’Œåº¦ï¼Œç”¨äºåç»­åŠ¨æ€è®¡ç®—\n            this.hue = Math.random() * 360;\n            this.saturation = 80;\n        }\n\n        update() {\n            this.x += this.vx;\n            this.y += this.vy;\n\n            if (this.x < 0 || this.x > width) this.vx *= -1;\n            if (this.y < 0 || this.y > height) this.vy *= -1;\n\n            if (mouse.x != null) {\n                let dx = mouse.x - this.x;\n                let dy = mouse.y - this.y;\n                let distance = Math.sqrt(dx * dx + dy * dy);\n\n                if (distance < config.mouseDistance) {\n                    const forceDirectionX = dx / distance;\n                    const forceDirectionY = dy / distance;\n                    const force = (config.mouseDistance - distance) / config.mouseDistance;\n                    const directionX = forceDirectionX * force * 3;\n                    const directionY = forceDirectionY * force * 3;\n\n                    this.x -= directionX;\n                    this.y -= directionY;\n                }\n            }\n        }\n\n        draw() {\n            const theme = getTheme();\n            // æµ…è‰²æ¨¡å¼ï¼šé¢œè‰²æ·±åº¦ä¸º50%\n            // æ·±è‰²æ¨¡å¼ï¼šé¢œè‰²æ·±åº¦ä¸º60%\n            const lightness = theme === 'light' ? '50%' : '60%';\n\n            this.color = `hsl(${this.hue}, ${this.saturation}%, ${lightness})`;\n\n            ctx.beginPath();\n            ctx.arc(this.x, this.y, this.size, 0, Math.PI * 2);\n            ctx.fillStyle = this.color;\n            ctx.globalAlpha = 0.8;\n            ctx.fill();\n        }\n    }\n\n    function initParticles() {\n        particles = [];\n        const currentCount = window.innerWidth < 768 ? 40 : 80;\n        for (let i = 0; i < currentCount; i++) {\n            particles.push(new Particle());\n        }\n    }\n\n    function animateParticles() {\n        ctx.clearRect(0, 0, width, height);\n\n        for (let i = 0; i < particles.length; i++) {\n            particles[i].update();\n            particles[i].draw();\n\n            for (let j = i; j < particles.length; j++) {\n                let dx = particles[i].x - particles[j].x;\n                let dy = particles[i].y - particles[j].y;\n                let distance = Math.sqrt(dx * dx + dy * dy);\n\n                if (distance < config.connectionDistance) {\n                    ctx.beginPath();\n                    let opacity = 1 - (distance / config.connectionDistance);\n\n                    // è¿çº¿é¢œè‰²è·Ÿéšç²’å­é¢œè‰²\n                    ctx.strokeStyle = particles[i].color;\n                    ctx.globalAlpha = opacity * 0.6;\n                    ctx.lineWidth = 1;\n                    ctx.moveTo(particles[i].x, particles[i].y);\n                    ctx.lineTo(particles[j].x, particles[j].y);\n                    ctx.stroke();\n\n                    ctx.globalAlpha = 1.0;\n                }\n            }\n        }\n        requestAnimationFrame(animateParticles);\n    }\n\n    resize();\n    initParticles();\n    animateParticles();\n\n})();\n```\n\n## é…ç½®ç”Ÿæ•ˆ\n\nåœ¨`_config.butterfly.yml`é‡Œé¢çš„`inject`çš„bottomä¸­å¼•å…¥jsæ–‡ä»¶çš„è·¯å¾„ã€‚\n\n```yaml\ninject:\n .........\n  bottom:\n     - <script defer src=\"/js/background.js?1\"></script> # åŠ¨æ€ç²’å­çº¿æ¡èƒŒæ™¯\n```\n\n# æ—§ç‰ˆ\n\n{% tip info %}æœ¬ç«™ä¸­ä½¿ç”¨çš„åŠ¨æ€ç²’å­çº¿æ¡èƒŒæ™¯åŸºäº[canvas-nest.js](https://git.hust.cc/canvas-nest.js/)ä¿®æ”¹å®ç°ï¼Œå¯è¿›è¡Œè‡ªå®šä¹‰è®¾ç½®ï¼Œè‡ªå®šä¹‰é…ç½®é¡¹ä½äº`background.js`çš„æœ€å`/* è‡ªå®šä¹‰ä¿®æ”¹é…ç½®é¡¹ */`éƒ¨åˆ†ã€‚\n\n- é¢œè‰²æ¨¡å¼åˆ†ä¸º`è‡ªå®šä¹‰ï¼ˆcustomï¼‰`å’Œ`å½©è™¹è‰²ï¼ˆrainbowï¼‰`\n- è¿çº¿ç±»å‹æ”¯æŒ`æ¸å˜è‰²ï¼ˆgradientï¼‰`å’Œ`å•ä¸€è‰²ï¼ˆsolidï¼‰`\n- è¿çº¿å®½åº¦å¯è‡ªå®šä¹‰\n- ç²’å­å°ºå¯¸å¯è‡ªå®šä¹‰\n- ç²’å­è¿åŠ¨é€Ÿåº¦å¯è‡ªå®šä¹‰\n\n{% endtip %}\n\n## è‡ªå®šä¹‰é…ç½®é¡¹\n\n`background.js`çš„æœ€å`/* è‡ªå®šä¹‰ä¿®æ”¹é…ç½®é¡¹ */`éƒ¨åˆ†çš„ç›¸å…³é…ç½®é¡¹å¦‚ä¸‹ï¼š\n\n| é…ç½®é¡¹        | ç±»å‹/å¯é€‰å€¼              | xÂ comments:  use: Gitalk Â â€‹# Gitalk# https://github.com/gitalk/gitalkgitalk:  client_id: #Client ID  client_secret: #Client secrets  repo: #ä»“åº“å  owner: #GitHubç”¨æˆ·å  admin: #GitHubç”¨æˆ·å  option: Â  Â   language: zh-CN Â  Â  Â #æ¯é¡µå±•ç¤ºæ•°é‡ï¼Œæœ€å¤š100 Â  Â   perPage: 10 Â  Â  Â #è¯„è®ºæ¡†çš„å…¨å±é®ç½©æ•ˆæœ Â  Â   distractionFreeMode: false Â  Â  Â #è¯„è®ºæ’åºæ–¹å¼lastã€first Â  Â   pagerDirection: last Â  Â  Â #GitHub issueçš„æ ‡ç­¾ Â  Â   labels: ['Gitalk'] Â  Â  Â #æ˜¯å¦å¯ç”¨å¿«æ·é”®(cmd\\|ctrl + enter) æäº¤è¯„è®º Â  Â   enableHotKey: true Â  Â  Â #è¯„è®ºåˆ—è¡¨çš„åŠ¨ç”»  Â  Â   flipMoveOptions: Fade Â  Â  Â #GitHub oauth è¯·æ±‚åˆ°åå‘ä»£ç† Â  Â   proxy: https://cors-anywhere.azm.workers.dev/https://github.com/login/oauth/access_tokenâ€‹yaml | è¯´æ˜                                                         | æ³¨æ„äº‹é¡¹                               |\n| ------------- | ------------------------ | --------------------------------- | ------------------------------------------------------------ | -------------------------------------- |\n| colorType     | `\"rainbow\"` | `\"custom\"` | `\"rainbow\"`                       | ç²’å­é¢œè‰²æ¨¡å¼ï¼š <br />â€¢ rainbowï¼šåŠ¨æ€HSLå½©è™¹è‰² <br />â€¢ customï¼šéœ€é…åˆ`colors`å‚æ•°ä½¿ç”¨ |\n| colors        | HEXæ ¼å¼æ•°ç»„              | `[\"#FF6B6B\",\"#4ECDC4\",\"#45B7D1\"]` | è‡ªå®šä¹‰é¢œè‰²æ± ï¼ˆä»…`colorType=custom`æ—¶ç”Ÿæ•ˆï¼‰                   | æœ€å°‘æä¾›2ä¸ªé¢œè‰²ï¼Œå»ºè®®3-5ä¸ªæ¸å˜è‰²       |\n| lineType      | `\"gradient\"` | `\"solid\"` | `\"gradient\"`                      | è¿çº¿æ¸²æŸ“æ¨¡å¼ï¼š <br />â€¢ gradientï¼šç²’å­é—´é¢œè‰²æ¸å˜ <br />â€¢ solidï¼šä½¿ç”¨èµ·ç‚¹ç²’å­é¢œè‰² |\n| particleCount | æ•´æ•°ï¼ˆå»ºè®®50-200ï¼‰         | 80                                | ç²’å­æ€»æ•°                                                     | æ•°å€¼è¶Šå¤§æ€§èƒ½æ¶ˆè€—è¶Šå¤§ï¼ˆnÂ²å¤æ‚åº¦ï¼‰       |\n| maxDistance   | æ•´æ•°ï¼ˆåƒç´ å¹³æ–¹ï¼‰         | 6000                              | è¿çº¿æœ€å¤§è·ç¦»ï¼ˆå®é™…è·ç¦»=âˆšå€¼ï¼Œé»˜è®¤â‰ˆ77pxï¼‰                      | å€¼è¶Šå¤§è¿æ¥è¶Šå¤šï¼Œå»ºè®®ç§»åŠ¨ç«¯å‡å°‘è¯¥å€¼     |\n| particleSize  | æ•°å€¼ï¼ˆ1-5ï¼‰              | 2                                 | ç²’å­æ˜¾ç¤ºå°ºå¯¸ï¼ˆå•ä½ï¼šåƒç´ ï¼‰                                   | å¤§äº3pxä¼šå‘ˆç°æ˜æ˜¾æ–¹å—æ•ˆæœ              |\n| lineWidth     | æ•°å€¼ï¼ˆ0.5-2ï¼‰            | 1                                 | åŸºç¡€è¿çº¿å®½åº¦ï¼ˆå®é™…å®½åº¦=å€¼Ã—(1-è·ç¦»/maxDistance)ï¼‰             | å»ºè®®ä¿æŒâ‰¤1.5ä»¥é¿å…çº¿æ¡è¿‡ç²—             |\n| opacity       | 0-1                      | 0.6                               | ç”»å¸ƒæ•´ä½“é€æ˜åº¦                                               | 0.3-0.7æ•ˆæœæœ€ä½³ï¼Œè¿‡é«˜ä¼šé®æŒ¡å†…å®¹        |\n| zIndex        | æ•´æ•°                     | -1                                | ç”»å¸ƒCSSå±‚çº§                                                  | å»ºè®®ä½œä¸ºèƒŒæ™¯æ—¶è®¾ä¸º-1ï¼Œæ‚¬æµ®æ•ˆæœæ—¶å¯è®¾>0 |\n| velocity\t| number\t| 0.8\t| åŸºç¡€ç§»åŠ¨é€Ÿåº¦ç³»æ•°ï¼Œå€¼è¶Šå¤§ç²’å­è¿åŠ¨è¶Šå¿«||\n| speedVariation\t| number\t| 0.3\t| é€Ÿåº¦éšæœºå˜åŒ–èŒƒå›´ï¼ˆ0-1ï¼‰ï¼Œå€¼è¶Šå¤§ä¸åŒç²’å­é€Ÿåº¦å·®å¼‚è¶Šæ˜æ˜¾||\n\n\n**ç‰¹æ®Šå‚æ•°è¯´æ˜**\n\n1. **é¢œè‰²ç³»ç»Ÿ**\n\n   - `colorType=rainbow`æ—¶ï¼šç²’å­ç”ŸæˆHSLè‰²ç›¸ï¼ˆ`hsl(éšæœº0-360Â°,70%,60%)`ï¼‰\n   - `colorType=custom`æ—¶ï¼šå¿…é¡»é…ç½®`colors`å‚æ•°ï¼ˆä¾‹ï¼š`[\"#2B6CB0\",\"#4299E1\"]`ï¼‰\n   - `velocity`ï¼šå…¨å±€é€Ÿåº¦ç³»æ•°ï¼Œç­‰æ¯”ä¾‹å½±å“æ‰€æœ‰ç²’å­ï¼Œè®¾ç½®`velocity=0`å¯å†»ç»“ç²’å­\n   - `speedVariation`ï¼šä¸ªä½“é€Ÿåº¦å·®å¼‚ç³»æ•°ï¼ˆ0=æ‰€æœ‰ç²’å­åŒé€Ÿï¼Œ1=æœ€å¤§å·®å¼‚Â±50%ï¼‰\n\n2. **æ€§èƒ½ä¼˜åŒ–å»ºè®®**\n\n   javascriptå¤åˆ¶ä»£ç \n\n   ```js\n   // ç§»åŠ¨ç«¯æ¨èé…ç½®\n   new ParticleBackground(container, {\n       particleCount: 60,\n       maxDistance: 4000,\n       lineWidth: 0.8\n   })\n   ```\n\n## æ•ˆæœé¢„è§ˆ\n\n{% tabs å¤œé—´æ¨¡å¼ %}\n<!-- tab æ—¥é—´æ¨¡å¼ -->\n\n![img](Hexo-Butterflyç¾åŒ–æ•™ç¨‹[8]-éšé¼ æ ‡å˜å¹»çš„åŠ¨æ€ç²’å­çº¿æ¡èƒŒæ™¯/1.png)\n\n<!-- endtab -->\n\n<!-- tab å¤œé—´æ¨¡å¼ -->\n\n![img](Hexo-Butterflyç¾åŒ–æ•™ç¨‹[8]-éšé¼ æ ‡å˜å¹»çš„åŠ¨æ€ç²’å­çº¿æ¡èƒŒæ™¯/2.png)\n\n<!-- endtab -->\n{% endtabs %}\n\n## æ·»åŠ jsæ–‡ä»¶\n\nåœ¨`blog\\source\\js`ç›®å½•ä¸‹ï¼Œåˆ›å»º`background.js`æ–‡ä»¶ï¼ŒåŠ å…¥ä»¥ä¸‹å†…å®¹ã€‚\n\n```js\n!function(){'use strict';\n\n/* å·¥å…·æ¨¡å— */\nconst Utils = {\n    debounce: (func, wait = 30) => {\n        let timeout;\n        return (...args) => {\n            clearTimeout(timeout);\n            timeout = setTimeout(() => func.apply(this, args), wait);\n        }\n    },\n    uuid: () => {\n        let d = Date.now();\n        return 'xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx'.replace(/[xy]/g, c => {\n            const r = (d + Math.random() * 16) % 16 | 0;\n            d = Math.floor(d / 16);\n            return (c === 'x' ? r : (r & 0x3 | 0x8)).toString(16);\n        });\n    }\n};\n\n/* å°ºå¯¸ä¼ æ„Ÿå™¨ */\nclass SizeSensor {\n    static sensors = new Map();\n    \n    static observe(element, callback) {\n        const sensor = new ResizeObserver(Utils.debounce(() => {\n            callback(element);\n        }));\n        sensor.observe(element);\n        this.sensors.set(element, sensor);\n    }\n\n    static unobserve(element) {\n        const sensor = this.sensors.get(element);\n        if(sensor) {\n            sensor.disconnect();\n            this.sensors.delete(element);\n        }\n    }\n}\n\n/* ç²’å­ç³»ç»Ÿæ ¸å¿ƒ */\nclass ParticleBackground {\n    constructor(container, options = {}) {\n        this.container = container;\n        this.options = {\n            colorType: 'rainbow',\n            colors: ['#FF6B6B', '#4ECDC4', '#45B7D1'],\n            lineType: 'gradient',\n            particleCount: 80,\n            maxDistance: 6000,\n            particleSize: 2,\n            lineWidth: 1,\n            opacity: 0.6,\n            zIndex: -1,\n            velocity: 0.8,          // æ–°å¢ï¼šåŸºç¡€é€Ÿåº¦ç³»æ•°\n            speedVariation: 0.3,    // æ–°å¢ï¼šé€Ÿåº¦éšæœºå˜åŒ–èŒƒå›´\n            ...options\n        };\n        \n        this.initCanvas();\n        this.initParticles();\n        this.bindEvents();\n        this.startAnimation();\n    }\n\n    initCanvas() {\n        this.canvas = document.createElement('canvas');\n        this.ctx = this.canvas.getContext('2d');\n        \n        Object.assign(this.canvas.style, {\n            position: 'absolute',\n            top: '0',\n            left: '0',\n            zIndex: this.options.zIndex,\n            opacity: this.options.opacity\n        });\n        \n        this.container.appendChild(this.canvas);\n        this.resizeCanvas();\n    }\n\n    resizeCanvas() {\n        this.canvas.width = this.container.clientWidth;\n        this.canvas.height = this.container.clientHeight;\n    }\n\n    initParticles() {\n        this.particles = Array.from({length: this.options.particleCount}, (_, i) => {\n            // é€Ÿåº¦è®¡ç®—é€»è¾‘ä¼˜åŒ–\n            const baseSpeed = this.options.velocity * \n                (1 + this.options.speedVariation * (Math.random() - 0.5));\n            \n            return {\n                id: i,\n                x: Math.random() * this.canvas.width,\n                y: Math.random() * this.canvas.height,\n                vx: (Math.random() - 0.5) * baseSpeed,\n                vy: (Math.random() - 0.5) * baseSpeed,\n                color: this.generateColor(),\n                connections: new Set()\n            };\n        });\n        \n        this.mouse = { x: null, y: null };\n    }\n\n    generateColor() {\n        if(this.options.colorType === 'custom') {\n            return this.options.colors[\n                Math.floor(Math.random() * this.options.colors.length)\n            ];\n        }\n        return `hsl(${Math.random()*360}, 70%, 60%)`;\n    }\n\n    bindEvents() {\n        SizeSensor.observe(this.container, () => this.resizeCanvas());\n        \n        this.mouseHandler = e => {\n            const rect = this.container.getBoundingClientRect();\n            this.mouse.x = e.clientX - rect.left;\n            this.mouse.y = e.clientY - rect.top;\n        };\n        \n        this.container.addEventListener('mousemove', this.mouseHandler);\n        this.container.addEventListener('mouseleave', () => {\n            this.mouse.x = null;\n            this.mouse.y = null;\n        });\n    }\n\n    updateParticles() {\n        this.particles.forEach(p => {\n            // åº”ç”¨é€Ÿåº¦ç³»æ•°\n            p.x += p.vx * this.options.velocity;\n            p.y += p.vy * this.options.velocity;\n            \n            // è¾¹ç•Œåå¼¹\n            if(p.x < 0 || p.x > this.canvas.width) p.vx *= -1;\n            if(p.y < 0 || p.y > this.canvas.height) p.vy *= -1;\n            \n            p.x = Math.max(0, Math.min(p.x, this.canvas.width));\n            p.y = Math.max(0, Math.min(p.y, this.canvas.height));\n        });\n    }\n\n    drawConnections() {\n        const allPoints = [...this.particles];\n        if(this.mouse.x !== null) allPoints.push(this.mouse);\n\n        for(let i = 0; i < allPoints.length; i++) {\n            const p1 = allPoints[i];\n            \n            for(let j = i+1; j < allPoints.length; j++) {\n                const p2 = allPoints[j];\n                const dx = p1.x - p2.x;\n                const dy = p1.y - p2.y;\n                const distSq = dx*dx + dy*dy;\n                \n                if(distSq < this.options.maxDistance) {\n                    const gradient = this.ctx.createLinearGradient(\n                        p1.x, p1.y, p2.x, p2.y\n                    );\n                    gradient.addColorStop(0, p1.color);\n                    gradient.addColorStop(1, p2.color || p1.color);\n                    \n                    this.ctx.strokeStyle = this.options.lineType === 'gradient' \n                        ? gradient \n                        : p1.color;\n                    \n                    this.ctx.lineWidth = this.options.lineWidth * \n                        (1 - distSq/this.options.maxDistance);\n                    \n                    this.ctx.beginPath();\n                    this.ctx.moveTo(p1.x, p1.y);\n                    this.ctx.lineTo(p2.x, p2.y);\n                    this.ctx.stroke();\n                }\n            }\n        }\n    }\n\n    drawParticles() {\n        this.particles.forEach(p => {\n            this.ctx.fillStyle = p.color;\n            this.ctx.fillRect(\n                p.x - this.options.particleSize/2,\n                p.y - this.options.particleSize/2,\n                this.options.particleSize,\n                this.options.particleSize\n            );\n        });\n    }\n\n    animate() {\n        this.ctx.clearRect(0, 0, this.canvas.width, this.canvas.height);\n        this.updateParticles();\n        this.drawConnections();\n        this.drawParticles();\n        requestAnimationFrame(() => this.animate());\n    }\n\n    startAnimation() {\n        this.animationFrame = requestAnimationFrame(() => this.animate());\n    }\n\n    destroy() {\n        cancelAnimationFrame(this.animationFrame);\n        SizeSensor.unobserve(this.container);\n        this.container.removeEventListener('mousemove', this.mouseHandler);\n        this.canvas.remove();\n    }\n}\n\n/* è‡ªå®šä¹‰ä¿®æ”¹é…ç½®é¡¹ */\nnew ParticleBackground(document.body, {\n    colorType: 'rainbow',\n    //colors: [],       //colorTypeä¸ºcustomæ—¶å¼€å¯\n    lineType: 'gradient',\n    particleCount: 80,\n\tlineWidth: 2, \n\tparticleSize: 3,\n    maxDistance: 8000,\n    velocity: 1.2,       \n    speedVariation: 0.3, \n    zIndex: -1,   \n    opacity: 0.7\n});\n\n}();\n```\n\n## é…ç½®ç”Ÿæ•ˆ\n\nåœ¨`_config.butterfly.yml`é‡Œé¢çš„`inject`çš„bottomä¸­å¼•å…¥jsæ–‡ä»¶çš„è·¯å¾„ã€‚\n\n```yaml\ninject:\n .........\n  bottom:\n     - <script defer src=\"/js/background.js?1\"></script> # åŠ¨æ€ç²’å­çº¿æ¡èƒŒæ™¯\n```\n\n{% folding green open,åšå®¢æ­å»ºç³»åˆ—æ–‡ç«  %}\n\n{% series åšå®¢æ­å»ºæ•™ç¨‹ %}\n\n{% endfolding %}\n","tags":["Hexo","åšå®¢æ•™ç¨‹","Butterfly"],"categories":["åšå®¢æ•™ç¨‹","åšå®¢æ­å»º"]},{"title":"Hexo-Butterflyç¾åŒ–æ•™ç¨‹-[6]å¼€å¯åšå®¢è¯„è®º","url":"/yyg/5986cad/","content":"\n## Giscus \n\n### åˆ›å»ºæ–°ä»“åº“\n\nåœ¨githubä¸Šåˆ›å»ºä¸€ä¸ªæ–°ä»“åº“ï¼Œåç§°ä»»æ„ï¼Œè®¾ç½®ä¸ºä»“åº“å…¬å¼€ï¼Œåœ¨Featuresä¸­å‹¾é€‰Discussionsã€‚\n\n### å®‰è£…é…ç½®Giscus\n\nï¼ˆ1ï¼‰ç‚¹å‡»é“¾æ¥å®‰è£…é…ç½®Giscusï¼š[Github Apps - giscus](https://github.com/apps/giscus)ã€‚\n\nï¼ˆ2ï¼‰é…ç½®å®Œæˆåç‚¹å‡»Giscusç½‘å€è¿›è¡Œé…ç½®ï¼Œè·³è½¬[giscus](https://giscus.app/zh-CN)ã€‚\n\nï¼ˆ3ï¼‰åœ¨ä»“åº“æ¡†ä¸­è¾“å…¥`ç”¨æˆ·å/åˆ›å»ºçš„ä»“åº“å`ã€‚\n\nï¼ˆ4ï¼‰åœ¨`é¡µé¢ â†”ï¸ discussion æ˜ å°„å…³ç³»`ä¸­é€‰æ‹©`Discussion çš„æ ‡é¢˜åŒ…å«é¡µé¢çš„ URL`ã€‚\n\nï¼ˆ5ï¼‰`Discussion åˆ†ç±»`é€‰æ‹© `Announcements`ã€‚\n\nï¼ˆ6ï¼‰`ç‰¹æ€§`å’Œ`ä¸»é¢˜`éƒ¨åˆ†è‡ªè¡Œé€‰æ‹©ã€‚å®Œæˆåï¼Œå°†`å¯ç”¨ giscus`ä¸­çš„scriptå†…å®¹å¡«å…¥`blog\\_config.butterfly.yml`æ–‡ä»¶ä¸­è¯„è®ºé…ç½®éƒ¨åˆ†ã€‚\n\n```yaml\ncomments:\n  use: Giscus  \n\n# Giscus\n# https://giscus.app/\ngiscus:\n  repo: #ç”¨æˆ·å/åˆ›å»ºçš„ä»“åº“å\n  repo_id: \n  category_id: \n  light_theme: light\n  dark_theme: dark\n  js: #å¯ä¸å¡«\n  option:\n```\n\n## Utterances\n\n### åˆ›å»ºæ–°ä»“åº“\n\nåœ¨githubä¸Šåˆ›å»ºä¸€ä¸ªæ–°ä»“åº“ï¼Œåç§°ä»»æ„ï¼Œè®¾ç½®ä¸ºä»“åº“å…¬å¼€ã€‚\n\n### å®‰è£…é…ç½®Utterances\n\nï¼ˆ1ï¼‰ç‚¹å‡»é“¾æ¥å®‰è£…é…ç½®Utterancesï¼š[GitHub Apps - utterances](https://github.com/apps/utterances)ã€‚\n\nï¼ˆ2ï¼‰é…ç½®å®Œæˆåç‚¹å‡»Utterancesç½‘å€è¿›è¡Œé…ç½®ï¼Œè·³è½¬[utterances](https://utteranc.es/)ã€‚\n\nï¼ˆ3ï¼‰åœ¨`repo:`æ¡†ä¸­è¾“å…¥`ç”¨æˆ·å/åˆ›å»ºçš„ä»“åº“å`ã€‚\n\nï¼ˆ4ï¼‰åœ¨`Blog Post â†”ï¸ Issue Mapping`ä¸­é€‰æ‹©`Issue title contains page title`ã€‚\n\nï¼ˆ5ï¼‰`label (optional):`æ¡†ä¸­å¯ä»»æ„å¡«å†™ï¼Œå»ºè®®å¡«å†™ `Utterances`ã€‚\n\nï¼ˆ6ï¼‰`Theme`éƒ¨åˆ†è‡ªè¡Œé€‰æ‹©ã€‚å®Œæˆåï¼Œå°†`Enable Utterances`ä¸­çš„scriptå†…å®¹å¡«å…¥`blog\\_config.butterfly.yml`æ–‡ä»¶ä¸­è¯„è®ºé…ç½®éƒ¨åˆ†ã€‚\n\n```yaml\ncomments:\n  use: Utterances  \n\n# Utterances\n# https://utteranc.es/\nutterances:\n  repo: #ç”¨æˆ·å/åˆ›å»ºçš„ä»“åº“å\n  # Issue Mapping: pathname/url/title/og:title\n  issue_term: title\n  # Theme: github-light/github-dark/github-dark-orange/icy-dark/dark-blue/photon-dark\n  light_theme: github-light\n  dark_theme: github-dark\n  js: #å¯ä¸å¡«\n  option:\n    label: \"Utterances\"\n```\n\n## Gitalk\n\n### åˆ›å»ºæ–°ä»“åº“\n\nåœ¨githubä¸Šåˆ›å»ºä¸€ä¸ªæ–°ä»“åº“ï¼Œåç§°ä»»æ„ï¼Œè®¾ç½®ä¸ºä»“åº“å…¬å¼€ã€‚\n\n### å®‰è£…é…ç½®Gitalk\n\nï¼ˆ1ï¼‰ç‚¹å‡»[New OAuth Application](https://github.com/settings/applications/new)ï¼Œæ³¨å†ŒGitHub OAuth appã€‚\n\n![img](Hexo-Butterflyç¾åŒ–æ•™ç¨‹[6]-å¼€å¯åšå®¢è¯„è®º/1.png)\n\nï¼ˆ2ï¼‰ç‚¹å‡»`Register application`ï¼Œè·³è½¬è‡³æ–°é¡µé¢åï¼Œç‚¹å‡»`Generate a new client secret`ï¼Œå¹¶å¤åˆ¶åˆ›å»ºå¥½çš„Client secretsã€‚\n\nï¼ˆ3ï¼‰åœ¨`blog\\_config.butterfly.yml`æ–‡ä»¶ä¸­è¯„è®ºé…ç½®éƒ¨åˆ†ã€‚\n\n```yaml\ncomments:\n  use: Gitalk  \n\n# Gitalk\n# https://github.com/gitalk/gitalk\ngitalk:\n  client_id: #Client ID\n  client_secret: #Client secrets\n  repo: #ä»“åº“å\n  owner: #GitHubç”¨æˆ·å\n  admin: #GitHubç”¨æˆ·å\n  option:\n      language: zh-CN\n      #æ¯é¡µå±•ç¤ºæ•°é‡ï¼Œæœ€å¤š100\n      perPage: 10\n      #è¯„è®ºæ¡†çš„å…¨å±é®ç½©æ•ˆæœ\n      distractionFreeMode: false\n      #è¯„è®ºæ’åºæ–¹å¼lastã€first\n      pagerDirection: last\n      #GitHub issueçš„æ ‡ç­¾\n      labels: ['Gitalk']\n      #æ˜¯å¦å¯ç”¨å¿«æ·é”®(cmd|ctrl + enter) æäº¤è¯„è®º\n      enableHotKey: true\n      #è¯„è®ºåˆ—è¡¨çš„åŠ¨ç”» \n      flipMoveOptions: Fade\n      #GitHub oauth è¯·æ±‚åˆ°åå‘ä»£ç†\n      proxy: https://cors-anywhere.azm.workers.dev/https://github.com/login/oauth/access_token\n\n```\n\n{% folding green open,åšå®¢æ­å»ºç³»åˆ—æ–‡ç«  %}\n\n{% series åšå®¢æ­å»ºæ•™ç¨‹ %}\n\n{% endfolding %}\n","tags":["Hexo","åšå®¢æ•™ç¨‹","Butterfly"],"categories":["åšå®¢æ•™ç¨‹","åšå®¢æ­å»º"]},{"title":"Hexo-Butterflyç¾åŒ–æ•™ç¨‹-[7]åŠŸèƒ½é­”æ”¹(æºç æ–¹å¼)","url":"/yyg/5baeb6c6/","content":"\n## æœ€æ–°æ–‡ç« æ ‡å¿—\n\n{% tip info %}æœ¬ç«™é‡‡ç”¨çš„æœ€æ–°æ–‡ç« æ ‡å¿—ï¼Œåœ¨å‚è€ƒäº†åšå®¢æ–‡ç« [è½»ç¬‘Chuckle | Butterflyæ–‡ç« å¡ç‰‡åŠ ä¸Šæœ€æ–°æ–‡ç« æ ‡å¿—](https://www.qcqx.cn/article/2ed7d622.html)å’Œ[Leonus | å‡ è¡Œä»£ç å®ç°æœ€æ–°æ–‡ç« æ ‡å¿—](https://blog.leonus.cn/2022/newpost.html)ã€‚å®ç°æ–¹å¼æ˜¯<mark>é€šè¿‡è·å–mdæ–‡ç« çš„å‘å¸ƒæ—¥æœŸï¼ŒåŠ¨æ€æ¯”å¯¹æ–‡ç« çš„å‘å¸ƒæ—¥æœŸï¼Œå®ç°ç²¾ç¡®æ ‡è®°æœ€æ–°æ–‡ç« </mark>ã€‚\n\n{% endtip %}\n\nåœ¨`blog\\themes\\butterfly\\scripts\\helpers\\page.js`æ–‡ä»¶æœ€ååŠ å…¥ä»¥ä¸‹å†…å®¹ã€‚\n\n```js\n// æœ€æ–°æ–‡ç« \nhexo.extend.helper.register('isNewPost', function(post) {\n  const latest = hexo.locals.get('posts').sort('-date').first();\n  return latest && latest.date === post.date;\n});\n```\n\nåœ¨`blog\\themes\\butterfly\\layout\\includes\\mixins\\indexPostUI.pug`æ–‡ä»¶ä¸­çš„`.recent-post-info(class=no_cover)`ä¸‹é¢åŠ å…¥ä»¥ä¸‹ä¸¤è¡Œå†…å®¹ã€‚\n\n```pug\n          .recent-post-info(class=no_cover)\n            if isNewPost(article)\n              span.newPost æœ€æ–°\n```\n\nåœ¨`blog\\source`ç›®å½•ä¸‹åˆ›å»º`css`æ–‡ä»¶å¤¹ï¼Œå¹¶åœ¨cssæ–‡ä»¶å¤¹ä¸‹åˆ›å»º`css`æ–‡ä»¶ï¼ŒåŠ å…¥ä»¥ä¸‹å†…å®¹ã€‚ï¼ˆæ ‡ç­¾æ ·å¼è¿›è¡Œäº†å¾®è°ƒï¼‰\n\n```css\n/* æœ€æ–°æ–‡ç« å›¾æ ‡ */\n.newPost {\n  position: absolute;\n  top: 10px;\n  right: 12px;\n  color: white;\n  padding: 0 12px;\n  background-color: #49b1f5;\n  box-shadow: 0 8px 12px -3px rgba(73,177,245, .20);\n  border-radius: 6px;\n  border: var(--style-border);\n  letter-spacing: 1px;\n}\n@media screen and (max-width:768px){\n  .newPost {\n        top: -20px;\n        right: 12px;\n        color: white;\n        padding: 0 12px;\n        border-radius: 6px;\n  }\n}\n```\n\nåœ¨`_config.butterfly.yml`é‡Œé¢çš„`inject`çš„headä¸­å¼•å…¥cssæ–‡ä»¶çš„è·¯å¾„ã€‚\n\n```yaml\ninject:\n  head:\n     - <link rel=\"stylesheet\" href=\"/css/xxx.css?1\">\n```\n\n## éšæœºä¸€ç¯‡\n\n{% note pink 'fas fa-bullhorn' flat %}\n\n2025-10-05 æ›´æ–°è®°å½•ï¼šå–æ¶ˆç¡¬ç¼–ç ç‰¹å®šçš„åŸŸåï¼Œè‡ªé€‚åº”å½“å‰çš„åŸŸåç¯å¢ƒã€‚\n\n{% endnote %}\n\nåœ¨blogç›®å½•ä¸‹çš„å‘½ä»¤æŒ‡ç¤ºç¬¦ä¸­æ‰§è¡Œå®‰è£…`baidusitemap`æ’ä»¶ï¼š\n\n```shell\nnpm install hexo-generator-baidu-sitemap --save\n```\n\nåœ¨`blog\\source`ç›®å½•ä¸‹åˆ›å»º`js`æ–‡ä»¶å¤¹ï¼Œå¹¶åœ¨jsæ–‡ä»¶å¤¹ä¸‹åˆ›å»º`js`æ–‡ä»¶ï¼ŒåŠ å…¥ä»¥ä¸‹å†…å®¹ã€‚\n\n{% tabs  %}\n\n<!-- tab ï¼ˆæ–°ï¼‰æ ¹æ®å½“å‰åŸŸåè·³è½¬ @fas fa-lightbulb -->\n\n```js\nfunction randomPost() {\n    // ä½¿ç”¨ç›¸å¯¹è·¯å¾„è·å–sitemapï¼Œä¸ä¾èµ–åŸŸå\n    fetch('/baidusitemap.xml')\n        .then(res => res.text())\n        .then(str => (new window.DOMParser()).parseFromString(str, \"text/xml\"))\n        .then(data => {\n            let ls = data.querySelectorAll('url loc');\n            let currentUrl = window.location.pathname; // åªä½¿ç”¨è·¯å¾„éƒ¨åˆ†ï¼Œä¸åŒ…å«åŸŸå\n            \n            // è¿‡æ»¤æ‰å½“å‰é¡µé¢çš„URL\n            let availableUrls = Array.from(ls)\n                .map(loc => {\n                    // ä»å®Œæ•´URLä¸­æå–è·¯å¾„éƒ¨åˆ†\n                    let url = new URL(loc.innerHTML);\n                    return url.pathname;\n                })\n                .filter(url => url !== currentUrl);\n            \n            if (availableUrls.length === 0) {\n                console.warn('No different URLs found in sitemap');\n                return;\n            }\n            \n            // éšæœºé€‰æ‹©ä¸€ä¸ªURLå¹¶è·³è½¬\n            let randomIndex = Math.floor(Math.random() * availableUrls.length);\n            window.location.href = availableUrls[randomIndex];\n        })\n        .catch(error => {\n            console.error('Failed to fetch or parse sitemap:', error);\n        });\n}\n```\n<!-- endtab -->\n\n<!-- tab ï¼ˆæ—§ï¼‰æ ¹æ®ä¸»é¢˜æ–‡ä»¶ä¸­é…ç½®çš„åŸŸåè·³è½¬ @fas fa-history -->\n\n```js\n// å‘ç°æœ‰æ—¶ä¼šå’Œå½“å‰é¡µé¢é‡å¤ï¼ŒåŠ ä¸€ä¸ªåˆ¤æ–­\nfunction randomPost() {\n    fetch('/baidusitemap.xml').then(res => res.text()).then(str => (new window.DOMParser()).parseFromString(str, \"text/xml\")).then(data => {\n        let ls = data.querySelectorAll('url loc');\n        while (true) {\n            let url = ls[Math.floor(Math.random() * ls.length)].innerHTML;\n            if (location.href == url) continue;\n            location.href = url;\n            return;\n        }\n    })\n}\n```\n\n<!-- endtab -->\n{% endtabs %}\n\n\nåœ¨`_config.butterfly.yml`é‡Œé¢çš„`inject`çš„bottomä¸­å¼•å…¥jsæ–‡ä»¶çš„è·¯å¾„ã€‚\n\n```yaml\ninject:\n .........\n  bottom:\n     - <script src=\"/js/xxx.js?1\"></script>\n```\n\n## æ–‡ç« åŒæ å¡ç‰‡\n\n{% note pink 'fas fa-bullhorn' flat %}\n\n2025-11-08 æ›´æ–°è®°å½•ï¼šæ›´æ¢é¦–é¡µå¡ç‰‡åŒæ å¸ƒå±€ï¼ˆå‡ä¸ºè°ƒæ•´å®ŒPageå’ŒPosté¡µé¢å®½åº¦åçš„å¸ƒå±€ï¼‰ã€‚\n\n{% endnote %}\n\næ‰“å¼€blogç›®å½•ä¸‹çš„Butterflyé…ç½®æ–‡ä»¶`_config.butterfly.yml`ï¼Œä¿®æ”¹å¡ç‰‡åŒæ å¸ƒå±€ã€‚\n\n{% tabs  %}\n\n<!-- tab é¦–é¡µå¡ç‰‡å¸ƒå±€6 @fas fa-check-square -->\n\n\n```\n#é¦–é¡µå¡ç‰‡åŒæ å¸ƒå±€\nindex_layout: 6\n#é€‰æ‹©é¦–é¡µå¡ç‰‡åŒæ å¸ƒå±€æ—¶ï¼Œå…³é—­ä¸»é¡µæ–‡ç« èŠ‚é€‰ï¼Œä¸ä¼šå‡ºç°å¡ç‰‡æ··ä¹±çš„æƒ…å†µ\nindex_post_content:\n  method: false\n```\n\nåœ¨`blog\\source\\css`çš„cssæ–‡ä»¶ä¸­åŠ å…¥ä»¥ä¸‹å†…å®¹ã€‚\n\n```css\n#recent-posts .recent-post-item >.recent-post-info > .article-title {\n    color: var(--text-highlight-color);\n    font-size: 1.55em;\n    line-height: 1.4;\n    transition: all 0.2s ease-in-out;\n    -webkit-line-clamp: 1;\n    min-height: calc(1.4em * 1);\n}\n\n#recent-posts .recent-post-item >.recent-post-info > .article-meta-wrap {\n    margin: 6px 0;\n    color: var(--card-meta);\n    font-size: 0.9em;\n    overflow: hidden;\n    text-overflow: ellipsis;\n    white-space: nowrap;\n    line-height: 1.5;\n    min-height: calc(1.5em * 1);\n}\n#recent-posts .recent-post-item > .recent-post-info > .content {\n    display: none;\n}\n```\næ•ˆæœå›¾ï¼š\n\n![img](Hexo-Butterflyç¾åŒ–æ•™ç¨‹[7]-åŠŸèƒ½é­”æ”¹(æºç æ–¹å¼)/2.png)\n<!-- endtab -->\n\n<!-- tab é¦–é¡µå¡ç‰‡å¸ƒå±€7 @far fa-square -->\n\n```\n#é¦–é¡µå¡ç‰‡åŒæ å¸ƒå±€\nindex_layout: 7\n#é€‰æ‹©é¦–é¡µå¡ç‰‡åŒæ å¸ƒå±€æ—¶ï¼Œå…³é—­ä¸»é¡µæ–‡ç« èŠ‚é€‰ï¼Œä¸ä¼šå‡ºç°å¡ç‰‡æ··ä¹±çš„æƒ…å†µ\nindex_post_content:\n  method: false\n```\n\nåœ¨`blog\\source\\css`çš„cssæ–‡ä»¶ä¸­åŠ å…¥ä»¥ä¸‹å†…å®¹ã€‚\n\n```css\n/* æ–‡ç« åŒæ æ ·å¼å¾®è°ƒ */\n#recent-posts .recent-post-item .post_cover:before {\n  position: absolute;\n  z-index: 1;\n  width: 100%;\n  height: 100%;\n  background-color: rgba(0,0,0,0.2);\n  backdrop-filter: blur(0px);\n}\n#recent-posts .recent-post-item >.recent-post-info {\n  padding: 30px 30px 25px;\n  height: 100%;\n\n}\n#recent-posts .recent-post-item > .recent-post-info > .content {\n    display: none;\n}\n#recent-posts .recent-post-item >.recent-post-info > .article-title {\n  color: var(--text-highlight-color);\n  font-size: 1.5em;\n  line-height: 5;\n  -webkit-transition: all 0.2s ease-in-out;\n  -moz-transition: all 0.2s ease-in-out;\n  -o-transition: all 0.2s ease-in-out;\n  -ms-transition: all 0.2s ease-in-out;\n  transition: all 0.2s ease-in-out;\n  white-space: nowrap; \n  overflow: hidden; \n  text-overflow: ellipsis; \n  display: block; \n}\n```\n\næ•ˆæœå›¾ï¼š\n\n{% tabs  %}\n\n<!-- tab ï¼ˆæ–°ï¼‰é¡µé¢è°ƒæ•´å @fas fa-lightbulb -->\n\n![img](Hexo-Butterflyç¾åŒ–æ•™ç¨‹[7]-åŠŸèƒ½é­”æ”¹(æºç æ–¹å¼)/3.png)\n\n<!-- endtab -->\n\n<!-- tab ï¼ˆæ—§ï¼‰é¡µé¢è°ƒæ•´å‰ @fas fa-history -->\n\n![img](Hexo-Butterflyç¾åŒ–æ•™ç¨‹[7]-åŠŸèƒ½é­”æ”¹(æºç æ–¹å¼)/4.png)\n\n<!-- endtab --> \n\n{% endtabs %}\n\n<!-- endtab --> \n\n{% endtabs %}\n\n## æ–‡ç« é¡¶éƒ¨æ·»åŠ æ³¢æµªæ•ˆæœ\n\nåœ¨`blog\\themes\\butterfly\\layout\\includes\\header\\index.pug`æ–‡ä»¶çš„ç¬¬33è¡Œ`include ./post-info.pug`ä¸‹é¢åŠ å…¥å†…å®¹ã€‚\n\n```pug\n      section.main-hero-waves-area.waves-area\n        svg.waves-svg(xmlns='http://www.w3.org/2000/svg', xlink='http://www.w3.org/1999/xlink', viewBox='0 24 150 28', preserveAspectRatio='none', shape-rendering='auto')\n          defs\n            path#gentle-wave(d='M -160 44 c 30 0 58 -18 88 -18 s 58 18 88 18 s 58 -18 88 -18 s 58 18 88 18 v 44 h -352 Z')\n          g.parallax\n            use(href='#gentle-wave', x='48', y='0')\n            use(href='#gentle-wave', x='48', y='3')\n            use(href='#gentle-wave', x='48', y='5')\n            use(href='#gentle-wave', x='48', y='7')\n```\n\nåœ¨`blog\\source\\css`çš„cssæ–‡ä»¶ä¸­åŠ å…¥ä»¥ä¸‹å†…å®¹ã€‚\n\n```css\n/* æ³¢æµªcss */\n.main-hero-waves-area {\n  width: 100%;\n  position: absolute;\n  left: 0;\n  bottom: -11px;\n  z-index: 5;\n}\n.waves-area .waves-svg {\n  width: 100%;\n  height: 5rem;\n}\n/* Animation */\n\n.parallax > use {\n  animation: move-forever 25s cubic-bezier(0.55, 0.5, 0.45, 0.5) infinite;\n}\n.parallax > use:nth-child(1) {\n  animation-delay: -2s;\n  animation-duration: 7s;\n  fill: #f7f9febd;\n}\n.parallax > use:nth-child(2) {\n  animation-delay: -3s;\n  animation-duration: 10s;\n  fill: #f7f9fe82;\n}\n.parallax > use:nth-child(3) {\n  animation-delay: -4s;\n  animation-duration: 13s;\n  fill: #f7f9fe36;\n}\n.parallax > use:nth-child(4) {\n  animation-delay: -5s;\n  animation-duration: 20s;\n  fill: #f7f9fe;\n}\n/* é»‘è‰²æ¨¡å¼èƒŒæ™¯ */\n[data-theme=\"dark\"] .parallax > use:nth-child(1) {\n  animation-delay: -2s;\n  animation-duration: 7s;\n  fill: #706d813e;\n}\n[data-theme=\"dark\"] .parallax > use:nth-child(2) {\n  animation-delay: -3s;\n  animation-duration: 10s;\n  fill: #706d813e;\n}\n[data-theme=\"dark\"] .parallax > use:nth-child(3) {\n  animation-delay: -4s;\n  animation-duration: 13s;\n  fill: #706d813e;\n}\n[data-theme=\"dark\"] .parallax > use:nth-child(4) {\n  animation-delay: -5s;\n  animation-duration: 20s;\n  fill: #706d813e;\n}\n\n@keyframes move-forever {\n  0% {\n    transform: translate3d(-90px, 0, 0);\n  }\n  100% {\n    transform: translate3d(85px, 0, 0);\n  }\n}\n/*Shrinking for mobile*/\n@media (max-width: 768px) {\n  .waves-area .waves-svg {\n    height: 40px;\n    min-height: 40px;\n  }\n}\n```\n\nå®ç°å‚è€ƒåŸé“¾æ¥å¦‚ä¸‹ï¼š\n\n{% link å®‰çŸ¥é±¼ | butterflyæ–‡ç« é¡¶éƒ¨æ·»åŠ æ³¢æµªæ•ˆæœ,https://blog.anheyu.com/posts/98c4.html,https://npm.elemecdn.com/anzhiyu-blog-static@1.0.4/img/avatar.jpg %}\n\n## é¦–é¡µè‡ªå®šä¹‰é¡µæ•°è·³è½¬\n\nåœ¨`blog\\themes\\butterfly\\layout\\includes\\pagination.pug`æ–‡ä»¶ä¸­ï¼Œæ‰¾åˆ°elseæ¡ä»¶çš„æœ€åä¸€è¡Œ`!=paginator(options)`ä¸‹é¢ï¼ŒåŠ å…¥ä»¥ä¸‹å†…å®¹ã€‚\n\n```pug\n      if is_home()\n        .toPageGroup\n          input#toPageText(maxlength=\"3\" oninput=\"value=value.replace(/[^0-9]/g,'')\" onkeyup=\"if (this.value === '0') this.value = ''\" title=\"è·³è½¬åˆ°æŒ‡å®šé¡µé¢\")\n          a#toPageButton(data-pjax-state=\"\" onclick=\"icattoPage.toPage()\")\n            i.fa-solid.fa-angles-right\n```\n\nåœ¨`blog\\source\\css`çš„cssæ–‡ä»¶ä¸­åŠ å…¥ä»¥ä¸‹å†…å®¹ã€‚\n\n```css\n/***************************** é¡µæ•°è·³è½¬æŒ‰é’® *****************************/\n.page .layout > .recent-posts .pagination > a:hover {\n    background: #00c4b6;\n}\n/* ç¿»é¡µæŒ‰é’®æ‚¬åœé¢œè‰² */\n.layout > .recent-posts .pagination > a {\n  border: var(--style-border);\n}\n/* è°ƒæ•´æ·»åŠ åŸç”Ÿè¾¹æ¡† */\n#pagination .pagination {\n  position: relative;\n  display: flex;\n  justify-content: center;\n  align-items: center;\n}\n.page .layout .recent-posts #pagination .pagination .prev {\n  left: 0;\n}\n.page .layout .recent-posts #pagination .pagination .next {\n  right: 0;\n}\n.page .layout .recent-posts #pagination .pagination .prev,\n.page .layout .recent-posts #pagination .pagination .next {\n  position: absolute;\n  margin: 0 0;\n  display: inline-flex;\n  flex-wrap: wrap;\n  justify-content: center;\n  align-items: center;\n  width: 5.25em;\n  overflow: hidden;\n}\n.page .layout .recent-posts #pagination .pagination .prev:hover .pagination_tips_prev {\n  margin-right: 2.5px;\n  opacity: 1;\n}\n.page .layout .recent-posts #pagination .pagination .prev .pagination_tips_prev {\n  margin-right: -28px;\n  transition: margin-right .3s;\n  opacity: 0;\n}\n.page .layout .recent-posts #pagination .pagination .next:hover .pagination_tips_next {\n  margin-left: 2.5px;\n  opacity: 1;\n}\n.page .layout .recent-posts #pagination .pagination .next .pagination_tips_next {\n  margin-left: -28px;\n  transition: margin-left .3s;\n  opacity: 0;\n}\n@media screen and (max-width: 768px) {\n  .page .layout .recent-posts #pagination .pagination .prev,\n  .page .layout .recent-posts #pagination .pagination .next {\n    position: sticky;\n    margin: 0 6px;\n    display: inline-block;\n    width: 2.5em;\n  }\n  .page .layout .recent-posts #pagination .pagination .prev .pagination_tips_prev,\n  .page .layout .recent-posts #pagination .pagination .next .pagination_tips_next {\n    display: none;\n  }\n}\n/* ä¸Šä¸‹é¡µæŒ‰é’®é­”æ”¹ */\n.pagination input {\n  width: 2.5em;\n  height: 2.5em;\n  border-radius: 8px;\n  border: var(--style-border-always);\n  transition: all 0.3s;\n  outline-style: none;\n  padding-left: 12px;\n  background: #00c4b6;\n  color: var(--icat-fontcolor);\n}\n\n.pagination .toPageGroup:hover input,.pagination .toPageGroup input:focus {\n  border: 1px solid #00c4b6;\n  outline-style: none;\n  width: 100px;\n}\n\n.toPageGroup {\n  display: inline-flex !important;\n  position: relative;\n  margin: 0 6px !important;\n}\n\na#toPageButton {\n  display: flex;\n  position: absolute;\n  width: 2.5em;\n  height: 2.5em;\n  border-radius: 8px;\n  justify-content: center;\n  align-items: center;\n  transition: all 0.3s;\n  background: var(--card-bg);\n  border: var(--style-border-always);\n  cursor: text !important;\n  pointer-events: none;\n}\n\n.toPageGroup:hover a#toPageButton, .toPageGroup:focus-within a#toPageButton {\n  margin-top: 4px;\n  width: 27px;\n  height: 27px;\n  margin-left: 70px;\n  background: var(--icat-card-bg);\n  border: 1px solid var(--icat-none);\n  border-radius: 4px;\n  opacity: 0.2;\n  transition: all 0.3s !important;\n}\n\n.toPageGroup:focus-within a#toPageButton.haveValue {\n  opacity: 1;\n  cursor: pointer;\n}\n\na#toPageButton.haveValue {\n  opacity: 1!important;\n  cursor: pointer!important;\n  pointer-events: all;\n}\n\na#toPageButton.haveValue:hover {\n  background: var(--icat-theme);\n  color: var(--icat-white);\n}\n\n@media screen and (max-width: 768px) {\n  .toPageGroup {\n    display:  !important;\n  }\n}\ni.fa-solid.fa-angles-right::before {\n    color: #5d6c80;\n}\n/* é¡µæ•°è·³è½¬æŒ‰é’® */\n\n/***************************** é¡µæ•°è·³è½¬æŒ‰é’® *****************************/\n```\n\nåœ¨`blog\\source\\js`çš„jsæ–‡ä»¶ä¸­åŠ å…¥ä»¥ä¸‹å†…å®¹ã€‚\n\n> ä¼˜åŒ–äº†ç‚¹å‡»å›è½¦è·³è½¬å¤±æ•ˆçš„é—®é¢˜\n\n```js\n// è‡ªå®šé¡µæ•°è·³è½¬\nvar icattoPage = {\n  toPage: function() {\n      console.log(\"æ‰§è¡Œè·³è½¬\");\n      var pageElements = document.querySelectorAll(\".page-number\");\n      var totalPages = parseInt(pageElements[pageElements.length - 1].innerHTML);\n      var inputElement = document.getElementById(\"toPageText\");\n      var targetPage = parseInt(inputElement.value);\n      \n      // éªŒè¯è¾“å…¥æœ‰æ•ˆæ€§\n      if (!isNaN(targetPage) && targetPage > 0 && targetPage <= totalPages) {\n          var urlPath = targetPage === 1 ? \"/\" : \"/page/\" + targetPage + \"/#content-inner\";\n          window.location.href = urlPath; // ç›´æ¥ä¿®æ”¹locationå®ç°è·³è½¬\n          return true; // è¿”å›trueå…è®¸è¡¨å•æäº¤ï¼ˆå¦‚æœæœ‰formåŒ…è£¹ï¼‰\n      } else {\n          alert(\"è¯·è¾“å…¥æœ‰æ•ˆçš„é¡µç ï¼ˆ1-\" + totalPages + \"ï¼‰\");\n          inputElement.focus();\n          return false; // é˜»æ­¢é»˜è®¤è¡Œä¸º\n      }\n  },\n  \n  listenToPageInputPress: function() {\n      var inputElement = document.getElementById(\"toPageText\");\n      var buttonElement = document.getElementById(\"toPageButton\");\n      \n      if (inputElement) {\n          // å›è½¦é”®ç›‘å¬\n          inputElement.addEventListener(\"keydown\", (e) => {\n              if (e.keyCode === 13) { // å›è½¦é”®\n                  e.preventDefault(); // é˜»æ­¢formçš„é»˜è®¤æäº¤è¡Œä¸º[3]\n                  icattoPage.toPage();\n              }\n          });\n          \n          // è¾“å…¥éªŒè¯\n          inputElement.addEventListener(\"input\", function() {\n              var pageElements = document.querySelectorAll(\".page-number\");\n              var maxPage = parseInt(pageElements[pageElements.length - 1].innerHTML);\n              var currentValue = parseInt(this.value) || 0;\n              \n              // æŒ‰é’®çŠ¶æ€æ§åˆ¶\n              buttonElement.classList.toggle(\"haveValue\", this.value.length > 0 && this.value !== \"0\");\n              \n              // è‡ªåŠ¨ä¿®æ­£è¶…å‡ºèŒƒå›´çš„é¡µç \n              if (currentValue > maxPage) {\n                  this.value = maxPage;\n              }\n          });\n      }\n  }\n};\n\n// åˆå§‹åŒ–ç›‘å¬\ndocument.addEventListener(\"DOMContentLoaded\", function() {\n    icattoPage.listenToPageInputPress();\n});\n```\n\nå®ç°å‚è€ƒåŸé“¾æ¥å¦‚ä¸‹ï¼š\n\n{% link çˆ±åƒè‚‰çš„çŒ« | Butterflyçš„é­”æ”¹æ•™ç¨‹ï¼šè‡ªå®šé¡µæ•°è·³è½¬,https://meuicat.com/posts/a3f4aab4.html,https://img.meuicat.com/blog/pwa/apple-icon-180.png %}\n\n## å…¨å±€åŠé€æ˜\n\nåœ¨`blog\\source\\css`çš„cssæ–‡ä»¶ä¸­åŠ å…¥ä»¥ä¸‹å†…å®¹ã€‚\n\n```css\n/*å…¨å±€åŠé€æ˜èƒŒæ™¯*/\n#recent-posts>.recent-post-item,.layout_page>div:first-child:not(.recent-posts),.layout_post>#page,.layout_post>#post,.read-mode .layout_post>#post {\n    background: rgba(255, 255, 255, 0.8);\n}\n[data-theme=\"dark\"] #recent-posts>.recent-post-item,.layout_page>div:first-child:not(.recent-posts),.layout_post>#page,.layout_post>#post,.read-mode .layout_post>#post {\n    background: #282c34c4;\n}\n\n#aside-content .card-widget {\n    background: rgba(255, 255, 255, 0.8);\n}\n[data-theme=\"dark\"] #aside-content .card-widget {\n    background: #282c34c4;\n}\ndiv#archive {\n    background: rgba(255, 255, 255, 0.8);\n}\n[data-theme=\"dark\"] div#archive {\n    background: #282c34c4;\n}\ndiv#page {\n    background: rgba(255, 255, 255, 0.8);\n}\n[data-theme=\"dark\"] div#page {\n    background: #282c34c4;\n}\n\ndiv#post {\n    background: rgba(255, 255, 255, 0.8);\n}\n[data-theme=\"dark\"] div#post {\n    background: #282c34c4;\n}\n\ndiv#tag {\n    background: rgba(255, 255, 255, 0.8);\n}\n[data-theme=\"dark\"] div#tag {\n    background: #282c34c4;\n}\n\ndiv#category {\n    background: rgba(255, 255, 255, 0.8);\n}\n[data-theme=\"dark\"] div#category {\n    background: #282c34c4;\n}\n[data-theme=\"dark\"] #recent-posts .recent-post-item {\n    background: #282c34c4;\n}\n[data-theme=\"dark\"] #article-container .shuoshuo-item {\n    background: #282c34c4;\n}\n[data-theme=\"dark\"] .layout .pagination > *:not(.space)  {\n    background: #282c34c4;\n}\n[data-theme=\"dark\"] #nav .menus_items .menus_item:hover .menus_item_child {\n    background: #282c34c4;\n}\n[data-theme=\"dark\"] .search-dialog {\n    background: #282c34c4;\n}\n```\n\n## æ˜¾ç¤ºæ–‡ç« æè¿°(ç›¸å…³æ¨èã€ä¸Šä¸‹ç¯‡)\n\n{% note warning flat %}\né€‚ç”¨äºButterfly-5.3.5ç‰ˆæœ¬ï¼Œåœ¨Butterfly-5.5.1ç‰ˆæœ¬å¼ƒç”¨\n{% endnote %}\n\næ‰“å¼€blogç›®å½•ä¸‹çš„Butterflyé…ç½®æ–‡ä»¶`_config.butterfly.yml`ï¼Œä¿®æ”¹ä»¥ä¸‹é…ç½®ã€‚\n\n```yaml\n#å¯ç”¨ç›¸å…³æ–‡ç« æ¨è\nrelated_post:\n  enable: true\n  limit: 6 # æ˜¾ç¤ºæ¨èæ–‡ç« æ•°ç›®\n  date_type: created # or created or updated æ–‡ç« æ—¥æœŸæ˜¾ç¤ºåˆ›å»ºæ—¥æˆ–è€…æ›´æ–°æ—¥\n\n#æ˜¾ç¤ºæ–‡ç« ç®€ä»‹ï¼Œè®¾ç½®æ˜¾ç¤ºé•¿åº¦\nindex_post_content:\n  method: 2\n  length: 120\n```\n\nåœ¨`blog\\themes\\butterfly\\scripts\\helpers\\related_post.js`æ–‡ä»¶ä¸­æ·»åŠ ä»¥ä¸‹å†…å®¹(å‰é¢æœ‰åŠ å·çš„)ï¼Œæ˜¾ç¤ºæ¨èæ–‡ç« æè¿°ã€‚\n\n```diff\n          weight: 1,\n+          description: post.description,\n+          content: post.content,\n..........\n      const { escape_html, url_for, date } = this\n+      const description = this.strip_html(relatedPosts[i].description)\n+      const content = this.strip_html(relatedPosts[i].content)\n\n      result += `<div class=\"info-item-2\">${title}</div></div>`\n+      switch (config.index_post_content.method) {\n+        case false:\n+          break\n+        case 1:\n+          result += `<div class=\"info\">${description}</div>`\n+          break\n+        case 2:\n+          if (description) {\n+            result += `<div class=\"info\">${description}</div>`\n+          }\n+          else {\n+            let expert = content.substring(0, config.index_post_content.length)\n+            content.length > config.index_post_content.length ? expert += ' ...' : ''\n+            result += `<div class=\"info\">${expert}</div>`\n+          }\n+          break\n+        default:\n+          let expert = content.substring(0, config.index_post_content.length)\n+          content.length > config.index_post_content.length ? expert += ' ...' : ''\n+          result += `<div class=\"info\">${expert}</div>`\n+          break\n+      }\n              \n```\n\nåœ¨`blog\\themes\\butterfly\\layout\\includes\\pagination.pug`æ–‡ä»¶ä¸­æ·»åŠ ä»¥ä¸‹å†…å®¹(å‰é¢æœ‰åŠ å·çš„)ï¼Œæ˜¾ç¤ºä¸Šä¸‹ç¯‡æ–‡ç« æè¿°ã€‚\n\n```diff\n            if getPostDesc\n              .info-2\n                .info-item-1!=getPostDesc\n+                case theme.index_post_content.method\n+                  when false\n+                    - break\n+                  when 1\n+                    .content!= direction.description  \n+                  when 2\n+                    if direction.description  \n+                      .content!= direction.description\n+                    else\n+                      - const content = strip_html(direction.content)\n+                      - let expert = content.substring(0, theme.index_post_content.length) \n+                      - content.length > theme.index_post_content.length ? expert += ' ...' : ''\n+                      .content!= expert\n+                  default\n+                    - const content = strip_html(direction.content)\n+                    - let expert = content.substring(0, theme.index_post_content.length) \n+                    - content.length > theme.index_post_content.length ? expert += ' ...' : ''\n+                    .content!= expert\n```\n\nåœ¨`blog\\source\\css`çš„cssæ–‡ä»¶ä¸­åŠ å…¥ä»¥ä¸‹å†…å®¹ã€‚\n\n```css\n/*ä¸Šä¸‹ç¯‡æ–‡ç« æè¿°æ˜¾ç¤º*/\n#pagination .pagination-related .info-2 .info-item-1 {\n  display: none;\n\n}\n#pagination .content {\n display: -webkit-box;          \n  -webkit-line-clamp: 4;         \n  -webkit-box-orient: vertical;  \n  overflow: hidden;              \n  text-align: left;              \n\n}\n@media (max-width: 768px) {\n  #pagination .content {\n    -webkit-line-clamp: 3;\n  }\n}\n```\n\nå®ç°å‚è€ƒåŸé“¾æ¥å¦‚ä¸‹ï¼š\n\n{% link Eurkon | Butterfly æ¨èæ–‡ç« å¢åŠ æ–‡ç« æè¿°,https://blog.eurkon.com/post/3d2664bb.html,https://npm.elemecdn.com/eurkon-cdn/hexo/images/user/avatar.jpg %}\n\n##  åšå®¢æ–‡ç« ç»Ÿè®¡å›¾\n\nåœ¨`_config.butterfly.yml`é‡Œé¢çš„`inject`çš„headä¸­å¼•å…¥ `ECharts.js`æ–‡ä»¶çš„è·¯å¾„ã€‚\n\n```yaml\ninject:\n  head:\n  ........\n     - <script src=\"https://npm.elemecdn.com/echarts@4.9.0/dist/echarts.min.js\"></script>\n```\n\nåœ¨`blog\\themes\\butterfly\\scripts\\helpers\\`ç›®å½•ä¸‹åˆ›å»º`charts.js`ï¼ŒåŠ å…¥ä»¥ä¸‹å†…å®¹ã€‚\n\n```js\nconst cheerio = require('cheerio')\nconst moment = require('moment')\n\nhexo.extend.filter.register('after_render:html', function (locals) {\n  const $ = cheerio.load(locals)\n  const post = $('#posts-chart')\n  const tag = $('#tags-chart')\n  const category = $('#categories-chart')\n  const htmlEncode = false\n\n  if (post.length > 0 || tag.length > 0 || category.length > 0) {\n    if (post.length > 0 && $('#postsChart').length === 0) {\n      if (post.attr('data-encode') === 'true') htmlEncode = true\n      post.after(postsChart(post.attr('data-start')))\n    }\n    if (tag.length > 0 && $('#tagsChart').length === 0) {\n      if (tag.attr('data-encode') === 'true') htmlEncode = true\n      tag.after(tagsChart(tag.attr('data-length')))\n    }\n    if (category.length > 0 && $('#categoriesChart').length === 0) {\n      if (category.attr('data-encode') === 'true') htmlEncode = true\n      category.after(categoriesChart(category.attr('data-parent')))\n    }\n\n    if (htmlEncode) {\n      return $.root().html().replace(/&amp;#/g, '&#')\n    } else {\n      return $.root().html()\n    }\n  } else {\n    return locals\n  }\n}, 15)\n\nfunction postsChart (startMonth) {\n  const startDate = moment(startMonth || '2020-01')\n  const endDate = moment()\n\n  const monthMap = new Map()\n  const dayTime = 3600 * 24 * 1000\n  for (let time = startDate; time <= endDate; time += dayTime) {\n    const month = moment(time).format('YYYY-MM')\n    if (!monthMap.has(month)) {\n      monthMap.set(month, 0)\n    }\n  }\n  hexo.locals.get('posts').forEach(function (post) {\n    const month = post.date.format('YYYY-MM')\n    if (monthMap.has(month)) {\n      monthMap.set(month, monthMap.get(month) + 1)\n    }\n  })\n  const monthArr = JSON.stringify([...monthMap.keys()])\n  const monthValueArr = JSON.stringify([...monthMap.values()])\n\n  return `\n  <script id=\"postsChart\">\n    var color = document.documentElement.getAttribute('data-theme') === 'light' ? '#4c4948' : 'rgba(255,255,255,0.7)'\n    var postsChart = echarts.init(document.getElementById('posts-chart'), 'light');\n    var postsOption = {\n      title: {\n        text: 'æ–‡ç« å‘å¸ƒç»Ÿè®¡å›¾',\n        x: 'center',\n        textStyle: {\n          color: color\n        }\n      },\n      tooltip: {\n        trigger: 'axis'\n      },\n      xAxis: {\n        name: 'æ—¥æœŸ',\n        type: 'category',\n        boundaryGap: false,\n        nameTextStyle: {\n          color: color\n        },\n        axisTick: {\n          show: false\n        },\n        axisLabel: {\n          show: true,\n          color: color\n        },\n        axisLine: {\n          show: true,\n          lineStyle: {\n            color: color\n          }\n        },\n        data: ${monthArr}\n      },\n      yAxis: {\n        name: 'æ–‡ç« ç¯‡æ•°',\n        type: 'value',\n        nameTextStyle: {\n          color: color\n        },\n        splitLine: {\n          show: false\n        },\n        axisTick: {\n          show: false\n        },\n        axisLabel: {\n          show: true,\n          color: color\n        },\n        axisLine: {\n          show: true,\n          lineStyle: {\n            color: color\n          }\n        }\n      },\n      series: [{\n        name: 'æ–‡ç« ç¯‡æ•°',\n        type: 'line',\n        smooth: true,\n        lineStyle: {\n            width: 0\n        },\n        showSymbol: false,\n        itemStyle: {\n          opacity: 1,\n          color: new echarts.graphic.LinearGradient(0, 0, 0, 1, [{\n            offset: 0,\n            color: 'rgba(128, 255, 165)'\n          },\n          {\n            offset: 1,\n            color: 'rgba(1, 191, 236)'\n          }])\n        },\n        areaStyle: {\n          opacity: 1,\n          color: new echarts.graphic.LinearGradient(0, 0, 0, 1, [{\n            offset: 0,\n            color: 'rgba(128, 255, 165)'\n          }, {\n            offset: 1,\n            color: 'rgba(1, 191, 236)'\n          }])\n        },\n        data: ${monthValueArr},\n        markLine: {\n          data: [{\n            name: 'å¹³å‡å€¼',\n            type: 'average',\n            label: {\n              color: color\n            }\n          }]\n        }\n      }]\n    };\n    postsChart.setOption(postsOption);\n    window.addEventListener('resize', () => { \n      postsChart.resize();\n    });\n    postsChart.on('click', 'series', (event) => {\n      if (event.componentType === 'series') window.location.href = '/archives/' + event.name.replace('-', '/');\n    });\n  </script>`\n}\n\nfunction tagsChart (len) {\n  const tagArr = []\n  hexo.locals.get('tags').map(function (tag) {\n    tagArr.push({ name: tag.name, value: tag.length, path: tag.path })\n  })\n  tagArr.sort((a, b) => { return b.value - a.value })\n\n  const dataLength = Math.min(tagArr.length, len) || tagArr.length\n  const tagNameArr = []\n  for (let i = 0; i < dataLength; i++) {\n    tagNameArr.push(tagArr[i].name)\n  }\n  const tagNameArrJson = JSON.stringify(tagNameArr)\n  const tagArrJson = JSON.stringify(tagArr)\n\n  return `\n  <script id=\"tagsChart\">\n    var color = document.documentElement.getAttribute('data-theme') === 'light' ? '#4c4948' : 'rgba(255,255,255,0.7)'\n    var tagsChart = echarts.init(document.getElementById('tags-chart'), 'light');\n    var tagsOption = {\n      title: {\n        text: 'Top ${dataLength} æ ‡ç­¾ç»Ÿè®¡å›¾',\n        x: 'center',\n        textStyle: {\n          color: color\n        }\n      },\n      tooltip: {},\n      xAxis: {\n        name: 'æ ‡ç­¾',\n        type: 'category',\n        nameTextStyle: {\n          color: color\n        },\n        axisTick: {\n          show: false\n        },\n        axisLabel: {\n          show: true,\n          color: color,\n          interval: 0,\n\t\t  formatter: function(value){\n            var res = \"\";\n            var max_strlen = 5;\n            var strlen = 0;\n            for (var i = 0; i < value.length; i++) {\n                if (value.charCodeAt(i) > 255)\n                    strlen++;\n                else\n                    strlen+=0.8;\n                if (strlen>max_strlen){\n                  res+=\"\\\\n\"\n                  strlen=0;\n                }\n                res+=value.charAt(i);\n            }\n            return res;\n          },\n        },\n        axisLine: {\n          show: true,\n          lineStyle: {\n            color: color\n          }\n        },\n        data: ${tagNameArrJson}\n      },\n      yAxis: {\n        name: 'æ–‡ç« ç¯‡æ•°',\n        type: 'value',\n        splitLine: {\n          show: false\n        },\n        nameTextStyle: {\n          color: color\n        },\n        axisTick: {\n          show: false\n        },\n        axisLabel: {\n          show: true,\n          color: color\n        },\n        axisLine: {\n          show: true,\n          lineStyle: {\n            color: color\n          }\n        }\n      },\n      series: [{\n        name: 'æ–‡ç« ç¯‡æ•°',\n        type: 'bar',\n        data: ${tagArrJson},\n        itemStyle: {\n          borderRadius: [5, 5, 0, 0],\n          color: new echarts.graphic.LinearGradient(0, 0, 0, 1, [{\n            offset: 0,\n            color: 'rgba(128, 255, 165)'\n          },\n          {\n            offset: 1,\n            color: 'rgba(1, 191, 236)'\n          }])\n        },\n        emphasis: {\n          itemStyle: {\n            color: new echarts.graphic.LinearGradient(0, 0, 0, 1, [{\n              offset: 0,\n              color: 'rgba(128, 255, 195)'\n            },\n            {\n              offset: 1,\n              color: 'rgba(1, 211, 255)'\n            }])\n          }\n        },\n        markLine: {\n          data: [{\n            name: 'å¹³å‡å€¼',\n            type: 'average',\n            label: {\n              color: color\n            }\n          }]\n        }\n      }]\n    };\n    tagsChart.setOption(tagsOption);\n    window.addEventListener('resize', () => { \n      tagsChart.resize();\n    });\n    tagsChart.on('click', 'series', (event) => {\n      if(event.data.path) window.location.href = '/' + event.data.path;\n    });\n  </script>`\n}\n\nfunction categoriesChart (dataParent) {\n  const categoryArr = []\n  let categoryParentFlag = false\n  hexo.locals.get('categories').map(function (category) {\n    if (category.parent) categoryParentFlag = true\n    categoryArr.push({\n      name: category.name,\n      value: category.length,\n      path: category.path,\n      id: category._id,\n      parentId: category.parent || '0'\n    })\n  })\n  categoryParentFlag = categoryParentFlag && dataParent === 'true'\n  categoryArr.sort((a, b) => { return b.value - a.value })\n  function translateListToTree (data, parent) {\n    let tree = []\n    let temp\n    data.forEach((item, index) => {\n      if (data[index].parentId == parent) {\n        let obj = data[index];\n        temp = translateListToTree(data, data[index].id);\n        if (temp.length > 0) {\n          obj.children = temp\n        }\n        if (tree.indexOf())\n          tree.push(obj)\n      }\n    })\n    return tree\n  }\n  const categoryNameJson = JSON.stringify(categoryArr.map(function (category) { return category.name }))\n  const categoryArrJson = JSON.stringify(categoryArr)\n  const categoryArrParentJson = JSON.stringify(translateListToTree(categoryArr, '0'))\n\n  return `\n  <script id=\"categoriesChart\">\n    var color = document.documentElement.getAttribute('data-theme') === 'light' ? '#4c4948' : 'rgba(255,255,255,0.7)'\n    var categoriesChart = echarts.init(document.getElementById('categories-chart'), 'light');\n    var categoryParentFlag = ${categoryParentFlag}\n    var categoriesOption = {\n      title: {\n        text: 'æ–‡ç« åˆ†ç±»ç»Ÿè®¡å›¾',\n        x: 'center',\n        textStyle: {\n          color: color\n        }\n      },\n      legend: {\n        top: 'bottom',\n        data: ${categoryNameJson},\n        textStyle: {\n          color: color\n        }\n      },\n      tooltip: {\n        trigger: 'item'\n      },\n      series: []\n    };\n    categoriesOption.series.push(\n      categoryParentFlag ? \n      {\n        nodeClick :false,\n        name: 'æ–‡ç« ç¯‡æ•°',\n        type: 'sunburst',\n        radius: ['15%', '90%'],\n        center: ['50%', '55%'],\n        sort: 'desc',\n        data: ${categoryArrParentJson},\n        itemStyle: {\n          borderColor: '#fff',\n          borderWidth: 2,\n          emphasis: {\n            focus: 'ancestor',\n            shadowBlur: 10,\n            shadowOffsetX: 0,\n            shadowColor: 'rgba(255, 255, 255, 0.5)'\n          }\n        }\n      }\n      :\n      {\n        name: 'æ–‡ç« ç¯‡æ•°',\n        type: 'pie',\n        radius: ['15%', '70%'],\n\t\tavoidLabelOverlap: true,\n\t\tlabelLayout: { \n        hideOverlap: true,\n        moveOverlap: 'shiftY'\n        },\n        roseType: 'area',\n        label: {\n          color: color,\n          formatter: '{b} : {c} ({d}%)'\n        },\n        data: ${categoryArrJson},\n        itemStyle: {\n          emphasis: {\n            shadowBlur: 10,\n            shadowOffsetX: 0,\n            shadowColor: 'rgba(255, 255, 255, 0.5)'\n          }\n        }\n      }\n    )\n    categoriesChart.setOption(categoriesOption);\n\tcategoriesChart.setOption({responsive: true});\n    window.addEventListener('resize', () => { \n\t  const width = categoriesChart.getWidth();\n      categoriesChart.setOption({\n      series: [{\n        radius: width < 500 ? ['25%', '65%'] : ['15%', '70%']\n        }]\n    });\n      categoriesChart.resize();\n    });\n    categoriesChart.on('click', 'series', (event) => {\n      if(event.data.path) window.location.href = '/' + event.data.path;\n    });\n  </script>`\n}\n```\n\n### å½’æ¡£é¡µ-æ–‡ç« å‘å¸ƒç»Ÿè®¡å›¾\n\nåœ¨`blog\\themes\\butterfly\\layout\\archive.pug`æ–‡ä»¶ä¸­ï¼ŒåŠ å…¥ä»¥ä¸‹å†…å®¹ã€‚\n\n```diff\n  #archive\n+    #posts-chart(data-start=\"2024-01\" style=\"height: 300px; padding: 10px;\")\n    .article-sort-title= `${_p('page.articles')} - ${getArchiveLength()}`\n```\n\n### åˆ†ç±»é¡µ-æ–‡ç« åˆ†ç±»ç»Ÿè®¡å›¾\n\n{% tip info %}ä¼˜åŒ–é¥¼å›¾æ˜¾ç¤ºåŠå¾„çš„è‡ªåŠ¨è°ƒèŠ‚\n\n{% endtip %}\n\nåœ¨`blog\\themes\\butterfly\\layout\\includes\\page\\categories.pug`æ–‡ä»¶ä¸­ï¼ŒåŠ å…¥ä»¥ä¸‹å†…å®¹ã€‚\n\n```diff\n+#categories-chart(data-parent=\"true\" style=\" width: 100%; min-height: 300px; aspect-ratio: 16/9; padding: 10px; box-sizing: border-box;\")\n.category-lists!= list_categories()\n```\n\nåœ¨`blog\\source\\css`çš„cssæ–‡ä»¶ä¸­åŠ å…¥ä»¥ä¸‹å†…å®¹ã€‚\n\n```css\n/**************************åˆ†ç±»é¡µ-æ–‡ç« åˆ†ç±»ç»Ÿè®¡å›¾**************************/\n  #categories-chart {\n    aspect-ratio: 16/9;\n    transition: height 0.3s;\n  }\n  @media (max-width: 768px) {\n    #categories-chart {\n      aspect-ratio: unset;\n      height: 60vh !important;\n    }\n  }\n  .echarts-label rich {\n    white-space: pre-wrap !important;\n    word-break: break-word !important;\n    overflow-wrap: anywhere !important;\n    line-height: 1.2 !important;\n  }\n /**************************åˆ†ç±»é¡µ-æ–‡ç« åˆ†ç±»ç»Ÿè®¡å›¾**************************/\n```\n\n### æ ‡ç­¾é¡µ-æ ‡ç­¾ç»Ÿè®¡å›¾\n\nåœ¨`blog\\themes\\butterfly\\layout\\includes\\page\\tags.pug`æ–‡ä»¶ä¸­ï¼ŒåŠ å…¥ä»¥ä¸‹å†…å®¹ã€‚\n\n```diff\n+#tags-chart(data-length=\"10\" style=\"height: 300px; padding: 10px;\")\n.tag-cloud-list.text-center\n```\n\nå®ç°å‚è€ƒåŸé“¾æ¥å¦‚ä¸‹ï¼š\n\n{% link Eurkon | Hexo åšå®¢æ–‡ç« ç»Ÿè®¡å›¾,https://blog.eurkon.com/post/1213ef82.html,https://npm.elemecdn.com/eurkon-cdn/hexo/images/user/avatar.jpg %}\n\n## æ ·å¼ç¾åŒ–\n\n### åˆ†ç±»é­”æ”¹\n\n{% tip info %}å¤§åˆ†ç±»ï¼šæ¯è¡Œæœ€å¤šå¯ä»¥å¹¶æ’æ”¾ç½®5ä¸ªï¼Œå­åˆ†ç±»å åŠ åœ¨å¯¹åº”çš„å¤§åˆ†ç±»ä¸Šï¼Œä¸”æ¯è¡Œå¤§åˆ†ç±»çš„å®½é«˜ä¸€è‡´ï¼Œè¯¥åˆ†ç±»æ–‡ç« æ€»æ•°é‡ä½äºå³ä¾§ã€‚\n\nå­åˆ†ç±»ï¼šå¯¹åº”å­åˆ†ç±»æ–‡ç« æ•°é‡ç»Ÿä¸€ä¸ºå³å¯¹é½ã€‚\n\nåˆ†ç±»èƒŒæ™¯è‰²ï¼šéšæœºæ¸å˜èƒŒæ™¯è‰²ï¼Œæ¯æ¬¡åˆ·æ–°ä¼šè‡ªåŠ¨æ›´æ¢ã€‚\n\néšæœºå›¾æ ‡ï¼šä½äºå¤§åˆ†ç±»å·¦ä¸‹è§’ï¼Œéšæœºåˆ†é…ï¼Œæ¯æ¬¡åˆ·æ–°ä¼šè‡ªåŠ¨æ›´æ¢ã€‚\n\n{% endtip %}\n\n![img](Hexo-Butterflyç¾åŒ–æ•™ç¨‹[7]-åŠŸèƒ½é­”æ”¹(æºç æ–¹å¼)/1.png)\n\nåœ¨`blog\\source\\css`çš„cssæ–‡ä»¶ä¸­åŠ å…¥ä»¥ä¸‹å†…å®¹ã€‚\n\n```css\n/***************************** åˆ†ç±»é¡µé¢æ ·å¼ *****************************/\n#page .category-lists .category-list {\n    display: flex;\n    flex-wrap: wrap;\n    gap: 1%; /* è®¾ç½®åˆ†ç±»é¡¹ä¹‹é—´çš„é—´è· */\n}\n\n#page .category-lists .category-list .category-list-item {\n    flex: 1 0 calc(20% - 1%); /* åˆå§‹å®½åº¦ä¸ºæ¯è¡Œäº”ä¸ªï¼Œå‡å»é—´è· */\n    margin-bottom: 1%; /* åº•éƒ¨é—´è· */\n    font-weight: 600;\n    border-radius: 8px;\n    box-shadow: 0 0 10px rgba(0, 0, 0, 0.1); /* æ·»åŠ é˜´å½±æ•ˆæœ */\n    padding: 10px; /* å†…è¾¹è· */\n}\n\n@media (max-width: 1024px) {\n    #page .category-lists .category-list .category-list-item {\n        flex-basis: calc(33.33% - 1%); /* åœ¨è¾ƒå°å±å¹•ä¸‹ï¼Œæ¯è¡Œä¸‰ä¸ª */\n    }\n}\n\n@media (max-width: 768px) {\n    #page .category-lists .category-list .category-list-item {\n        flex-basis: calc(50% - 1%); /* åœ¨æ›´å°å±å¹•ä¸‹ï¼Œæ¯è¡Œä¸¤ä¸ª */\n    }\n}\n\n@media (max-width: 480px) {\n    #page .category-lists .category-list .category-list-item {\n        flex-basis: 100%; /* åœ¨æœ€å°å±å¹•ä¸‹ï¼Œæ¯è¡Œä¸€ä¸ª */\n    }\n}\n#page .category-lists .category-list .category-list-item .category-list-link::after {\n    content: \"\";\n    position: relative;\n    width: 0;\n    bottom: 0;\n    display: block;\n    height: 3px;\n    border-radius: 3px;\n    background: #fff; /* ä¸ºcategory-list-linkæ·»åŠ hoveræ•ˆæœçš„ä¸‹åˆ’çº¿ */\n}\n\n#page .category-lists .category-list .category-list-item .category-list-link:hover::after {\n    width: 60%;\n    left: 1%;\n    transition: all 0.6s; /* æ·»åŠ ä¸‹åˆ’çº¿å±•å¼€çš„è¿‡æ¸¡æ•ˆæœ */\n}\n\n#page .list-beauty li:before, .category-lists ul li:before {\n    border: #49b6f500;\n}\n#page .category-lists .category-list .category-list-item {\n    position: relative; /* ç›¸å¯¹å®šä½ï¼Œä»¥ä¾¿å­å…ƒç´ å¯ä»¥ä½¿ç”¨ç»å¯¹å®šä½ */\n    padding-top: 5px; /* è°ƒæ•´åˆ†ç±»é¡¹é¡¶éƒ¨å†…è¾¹è·ï¼Œä»¥å®¹çº³å›¾æ ‡å’Œæ•°é‡ */\n}\n\n#page .category-lists .category-list .category-list-item .category-list-count {\n    position: absolute; /* ç»å¯¹å®šä½ */\n    top: 0;\n    right: 0; /* æ”¾ç½®åœ¨å³ä¸Šè§’ */\n    color: #fff;\n    font-size: 1rem;\n    padding: 5px 10px; /* è°ƒæ•´å†…è¾¹è· */\n    display: flex; /* ä½¿ç”¨ Flexbox å¸ƒå±€ */\n    align-items: center; /* å‚ç›´å±…ä¸­å¯¹é½ */\n}\n\n#page .category-lists .category-list .category-list-item .category-list-count::before {\n    content: \"\\f02d\"; /* Font Awesome 6 Free çš„å›¾æ ‡ */\n    padding-right: 10px; /* è°ƒæ•´å›¾æ ‡ä¸æ–‡ç« æ•°é‡ä¹‹é—´çš„è·ç¦» */\n    font-family: \"Font Awesome 6 Free\"; /* ä½¿ç”¨ Font Awesome 6 Free çš„å­—ä½“ */\n}\n#page .category-lists .category-list .category-list-count:after {\n  content: '';\n}\n\n/* æ–°å¢æ ·å¼ç”¨äºå›¾æ ‡æ˜¾ç¤º */\n#page .category-lists .category-list .category-list-item .category-list-icon {\n    position: absolute;\n    bottom: 0;\n    left: 0;\n    padding: 5px; /* è°ƒæ•´å›¾æ ‡ä¸å†…å®¹ä¹‹é—´çš„æ°´å¹³è·ç¦» */\n}\n\n#post #article-container.post-content h1,\n#post #article-container.post-content h2,\n#post #article-container.post-content h3,\n#post #article-container.post-content h4,\n#post #article-container.post-content h5,\n#post #article-container.post-content h6 {\n  padding-left: 0 !important; \n}\n\n#post #article-container.post-content h1::before,\n#post #article-container.post-content h2::before,\n#post #article-container.post-content h3::before,\n#post #article-container.post-content h4::before,\n#post #article-container.post-content h5::before,\n#post #article-container.post-content h6::before {\n  position: relative;\n  content: attr(data-toc) ' ';\n  display: inline;\n  font-family: inherit;\n  font-size: inherit;\n  line-height: inherit;\n  margin-left: 0;\n}\n/***************************** åˆ†ç±»é¡µé¢æ ·å¼ *****************************/\n```\n\nåœ¨`blog\\source\\js`çš„jsæ–‡ä»¶ä¸­åŠ å…¥ä»¥ä¸‹å†…å®¹ã€‚\n\n```js\n/*************************åˆ†ç±»é¡µé¢ç¾åŒ–*************************/\n// è·å–æ‰€æœ‰ç±»åˆ«åˆ—è¡¨é¡¹\nconst categoryItems = document.querySelectorAll('.category-list-item');\n\n// ä¸ºæ¯ä¸ªç±»åˆ«åˆ—è¡¨é¡¹ç”Ÿæˆéšæœºé¢œè‰²æ¸å˜èƒŒæ™¯å’Œå›¾æ ‡\ncategoryItems.forEach((item, index) => {\n    // ä¸ºæ¯ä¸ªç±»åˆ«åˆ—è¡¨é¡¹åˆ›å»ºéšæœºé¢œè‰²æ¸å˜èƒŒæ™¯\n    function randomBgImg() {\n        const deg = Math.floor(Math.random() * 360);\n        const randomBg = `linear-gradient(${deg}deg, #${Math.floor(Math.random()*16777215).toString(16)} 0%, #${Math.floor(Math.random()*16777215).toString(16)} 100%)`;\n        item.style.backgroundImage = randomBg;\n    }\n\n    // ç”Ÿæˆéšæœºå›¾æ ‡ï¼ˆè¿™é‡Œä½¿ç”¨äº† Font Awesome å›¾æ ‡åº“ï¼‰\n    const icons = ['ğŸ“‘', 'ğŸ“š', 'ğŸ¦‹', 'ğŸ’»', 'ğŸ’¬', 'âœ¨']; // å¯ä»¥æ ¹æ®éœ€è¦æ·»åŠ æ›´å¤šå›¾æ ‡\n    const randomIcon = icons[Math.floor(Math.random() * icons.length)];\n\n    // æ›´æ–°ç±»åˆ«åˆ—è¡¨é¡¹çš„ HTML å†…å®¹ï¼Œè®¾ç½®èƒŒæ™¯å’Œå›¾æ ‡\n    item.innerHTML = `\n    <div>${item.innerHTML}</div>\n    <div class=\"category-list-icon\">${randomIcon}</div>`;\n\n    // è°ƒç”¨éšæœºé¢œè‰²æ¸å˜èƒŒæ™¯å‡½æ•°\n    randomBgImg();\n});\n\nfunction postAddToc() {\n  const postContent = document.querySelector('#post > #article-container.post-content');\n  const cardToc = document.getElementById('card-toc');\n\n  if (postContent && cardToc) {\n    const tocItems = cardToc.querySelectorAll('.toc-link');\n    const targetElements = {};\n\n    tocItems.forEach(tocLink => {\n      const href = decodeURIComponent(tocLink.getAttribute('href').slice(1));\n      const targetElement = document.getElementById(href);\n      const tocNumber = tocLink.querySelector('.toc-number').textContent;\n\n      if (targetElement) {\n        targetElements[href] = { element: targetElement, tocNumber };\n      }\n    });\n\n    // è®¾ç½® dataset.toc å±æ€§\n    Object.entries(targetElements).forEach(([href, { element, tocNumber }]) => {\n      element.dataset.toc = tocNumber;\n    });\n  }\n}\n\npostAddToc();\n```\n\nåˆ†ç±»ç¾åŒ–å‚è€ƒåŸé“¾æ¥å¦‚ä¸‹ï¼š\n\n{% link Eurkon | åˆ†ç±»ç•Œé¢,https://blog.eurkon.com/categories/,https://npm.elemecdn.com/eurkon-cdn/hexo/images/user/avatar.jpg %}\n\n### å‹é“¾é­”æ”¹\n\nåœ¨`blog\\source\\css`çš„cssæ–‡ä»¶ä¸­åŠ å…¥ä»¥ä¸‹å†…å®¹ã€‚\n\n```css\n.flink-item-icon {\n  margin-right: 0 !important;\n  transition: .5s !important;\n}\n/* å¤´åƒå¾®è°ƒ */\n\n#article-container .flink .flink-list>.flink-list-item::before {\n  content: none;\n  text-align: center; /* æ–‡æœ¬å±…ä¸­ */ \n}\n/* å»æ‰åŸæ¥è‡ªå¸¦çš„before */\n\n#article-container .flink .flink-list>.flink-list-item:hover {\n  background-color: #49B1F5;\n  box-shadow: 0 0 10px rgba(0, 0, 0, .3);\n  transition: 0.5s;\n}\n/* é¼ æ ‡ç»è¿‡æ”¹å˜èƒŒæ™¯ */\n\n#article-container .flink .flink-list>.flink-list-item:hover a {\n  color: white !important;\n}\n/* é¼ æ ‡ç»è¿‡æ”¹å˜æ–‡å­—é¢œè‰² */\n\n#article-container .flink .flink-list>.flink-list-item:hover .flink-item-icon {\n  width: 30px;\n  margin-left: -50px;\n  -webkit-transform: rotate(-180deg);\n  -moz-transform: rotate(-180deg);\n  -o-transform: rotate(-180deg);\n  -ms-transform: rotate(-180deg);\n  transform: rotate(-180deg);\n}\n@media screen and (max-width: 900px){\n  #article-container .flink .flink-list>.flink-list-item:hover .flink-item-icon {\n    width: 90px;\n    height: 90px;\n    border-radius: 20px;\n    -webkit-transform: rotate(0deg);\n    -moz-transform: rotate(0deg);\n    -o-transform: rotate(0deg);\n    -ms-transform: rotate(0deg);\n    transform: rotate(0deg);\n  }\n  #article-container .flink .flink-list>.flink-list-item:hover .flink-item-tag {\n    display: none;\n  }\n}\n/* é¼ æ ‡ç»è¿‡å¤´åƒæ»šåŠ¨ */\n\n#article-container .flink .flink-list > .flink-list-item a .flink-item-icon {\n    width: 40px;\n    height: 40px;\n    border-radius: 20px;\n    margin: 15px 0px 10px 6px;\n}\n#article-container .flink .flink-list > .flink-list-item a {\n  display: block;\n  height: 100%;\n}\n#article-container .flink .flink-item-name {\n  text-align: start;\n  padding: 11px 2px 8px 12px;\n  height: auto;\n  font-size: 17px;\n}\n#article-container .flink .flink-item-desc {\n  text-align: start;\n  padding: 8px 2px 4px 12px;\n  height: auto;\n  font-size: 12px;\n}\n.flink-item-tag {\n  position: absolute;\n  top: 12px;\n  right: 12px;\n  padding: 2px 6px;\n  color: var(--icat-white);\n  z-index: 1;\n  border-radius: 6px;\n  -webkit-transition: .3s;\n  -moz-transition: .3s;\n  -o-transition: .3s;\n  -ms-transition: .3s;\n  transition: 0.3s;\n  font-size: 0.6rem;\n  opacity: .8;\n}\n\n\n#article-container .flink > h2 {\n  margin: 20px 7px 0;\n}\n#article-container .flink .flink-desc {\n  margin: 0 7px;\n  color: var(--icat-secondtext);\n}\n#article-container .flink .flink-list {\n  padding: 10px 0 0;\n}\n#article-container .flink .flink-list > .flink-list-item {\n  border: 1px solid #63a8de;\n  background: var(--icat-card-bg);\n  height: 75px;\n  margin: 4px 4px 4px 4px;\n  width: calc(100% / 6 - 8px);\n}\n@media screen and (max-width: 900px){\n  #article-container .flink .flink-list > .flink-list-item {\n    height: 110px;\n  }\n  #article-container .flink .flink-list > .flink-list-item {\n    border: 1px solid #63a8de;\n  }\n  #article-container .flink .flink-list {\n    padding: 10px 0 0;\n  }\n  #article-container .flink .flink-list > .flink-list-item {\n    margin: 6px 6px;\n    width: calc(50% - 12px) !important;\n  }\n  #article-container .flink > h2 {\n    margin: 20px 12px 0;\n  }\n  #article-container .flink .flink-desc {\n    margin: 0 12px;\n  }\n  #article-container .flink .flink-item-name {\n    font-size: 1.1rem;\n    padding: 30px 12px 0;\n  }\n  #article-container .flink .flink-list > .flink-list-item a .flink-item-icon {\n    position: absolute;\n    bottom: 8%;\n    right: 8%;\n    float: right;\n    width: 40px;\n    height: 40px;\n    -webkit-transform: translate(35%,30%); \n    -moz-transform: translate(35%,30%);\n    -o-transform: translate(35%,30%);\n    -ms-transform: translate(35%,30%);\n    transform: translate(35%,30%);\n    margin-top: -12px;\n    margin-left: -12px;\n    border-radius: 26px;\n    opacity: .2;\n  }\n  .flink-item-tag {\n    top: 8px;\n    right: 8px;\n  }\n}\n\n\n```\n\nå‹é“¾ç¾åŒ–å‚è€ƒåŸé“¾æ¥å¦‚ä¸‹ï¼š\n\n{% link çˆ±åƒè‚‰çš„çŒ« | å‹é“¾ç•Œé¢,https://meuicat.com/link/,https://bu.dusays.com/2023/08/25/64e8ca25e89c5.jpg %}\n\n### ä¾§è¾¹æ æ ‡ç­¾\n\nåœ¨`blog\\source\\css`çš„cssæ–‡ä»¶ä¸­åŠ å…¥ä»¥ä¸‹å†…å®¹ã€‚\n\n```css\n/*ä¾§è¾¹æ æ ‡ç­¾ç¾åŒ–*/\n#aside-content .card-tag-cloud a {\n  font-size: 0.3rem;\n  border-radius: 6px;\n  border-style: dashed;\n  border-width: 1px; \n  margin: 3px; \n}\n```\n\n### æ ‡ç­¾é¡µæ ‡ç­¾\n\n```css\n/* æ ‡ç­¾é¡µåŠ æ–°æ ·å¼ */\n#aside-content .card-tag-cloud a {\n    border: 1px solid;\n    line-height: 1.5;\n    border-radius: 6px;\n    margin: 3px;\n    padding: 0 5px;\n}\n\n.tag-cloud-list a {\n    border: 1px solid;\n    line-height: 1.5;\n    border-radius: 6px;\n    padding: 5px 15px;\n    font-size: 1.2rem;\n    margin: 5px;\n}\n```\n\n### æ–‡ç« åˆ†é¡µå¡ç‰‡\n\nåœ¨`blog\\source\\css`çš„cssæ–‡ä»¶ä¸­åŠ å…¥ä»¥ä¸‹å†…å®¹ã€‚\n\n```css\n/*æ–‡ç« åˆ†é¡µå¡ç‰‡ç¾åŒ–*/\n.relatedPosts > .relatedPosts-list > div {\n  border-radius: 20px;\n  border-style: dashed;\n  border-width: 1px;\n  margin: 1px;\n}\n.relatedPosts > .relatedPosts-list > a {\n    margin: 3px;\n    height: 200px;\n    border-radius: 20px;\n}\n```\n\n### æ–‡ç« ç›¸å…³æ¨èå¡ç‰‡\n\nåœ¨`blog\\source\\css`çš„cssæ–‡ä»¶ä¸­åŠ å…¥ä»¥ä¸‹å†…å®¹ã€‚\n\n```css\n/*æ–‡ç« ç›¸å…³æ¨èå¡ç‰‡ç¾åŒ–*/\n.relatedPosts > .relatedPosts-list > div {\n  border-radius: 20px;\n  border-style: dashed;\n  border-width: 1px;\n  margin: 1px;\n}\n```\n\n### æ–‡ç« ç›®å½•\n\nåœ¨`blog\\source\\css`çš„cssæ–‡ä»¶ä¸­åŠ å…¥ä»¥ä¸‹å†…å®¹ã€‚\n\n```css\n/* æ–‡ç« ç›®å½• */\n #aside-content #card-toc .toc-content {\n  margin: 10px -18px;\n}\n #aside-content #card-toc .toc-content .toc-link.active {\n  line-height: 1.2;\n  border-radius: 12px;\n  border-left-color: var(--heo-hovertext);\n  background-color: var(--heo-card-bg);\n  color: var(--heo-lighttext);\n  font-weight: bold;\n  font-size: 20px;\n}\n[data-theme=dark].toc .toc-item.active .toc-link .toc-text {\n  color: var(--heo-white);\n}\n#aside-content #card-toc .toc-content .toc-item.active .toc-link {\n  opacity: 1;\n  border-radius: 8px;\n}\n#aside-content #card-toc .toc-content .toc-link {\n  line-height: 1.2;\n  padding: 8px;\n  border-left: 0px solid transparent;\n  border-radius: 12px;\n  color: var(--heo-secondtext);\n  cursor: default;\n}\n#aside-content #card-toc .toc-content .toc-link:not(.active) span {\n  opacity: 0.6;\n  cursor: pointer;\n  filter: blur(1px);\n  transition: 0.3s;\n}\n#aside-content #card-toc:hover .toc-content .toc-link:not(.active) span {\n  filter: blur(0px);\n  opacity: 1;\n}\n#aside-content #card-toc .toc-content .toc-link:not(.active) span:hover {\n  color: var(--heo-lighttext);\n}\n```\n\n### ç‰ˆæƒä¿¡æ¯\n\nåœ¨`blog\\source\\css`çš„cssæ–‡ä»¶ä¸­åŠ å…¥ä»¥ä¸‹å†…å®¹ã€‚\n\n```css\n/* **********************ç‰ˆæƒä¿¡æ¯ ********************** */\n/* èƒŒæ™¯ */\n#post .post-copyright {\n  background: var(--heo-card-bg);\n  padding: 2rem 1.3rem;\n  overflow: hidden;\n  border: var(--style-border);\n  border-width: 1px;\n  transition: 0.3s;\n  border-radius: 11px;\n}\n\n\n@media screen and (max-width: 768px) {\n  #post .post-copyright {\n    padding: 1rem 1.3rem;\n  }\n}\n\n.post-copyright__author {\n  display: flex;\n  align-items: center;\n}\n\n.post-copyright__original {\n  background: var(--heo-fontcolor);\n  color: var(--heo-card-bg);\n  padding: 0.2rem 0.5rem;\n  font-size: 0.7rem;\n  border-radius: 8px;\n  margin-right: 0.5rem;\n  font-weight: bold;\n  line-height: 1.5;\n  white-space: nowrap;\n}\n\n.post-copyright__original:hover {\n  background: var(--heo-main);\n  color: var(--heo-white);\n}\n\n@media screen and (max-width: 768px) {\n  #post .post-copyright {\n    box-shadow: var(--heo-shadow-border);\n  }\n\n  .post-copyright .post-meta-original {\n    display: none;\n  }\n\n  .post-copyright__original {\n    display: none;\n  }\n\n  #post .post-copyright:after {\n    display: none;\n  }\n}\n\n\n/* é“¾æ¥ */\n#post>div.post-copyright>div.post-copyright__type {\n  line-height: 16px;\n  display: flex;\n  margin-top: 8px;\n}\n\n#post>div.post-copyright>div.post-copyright__type>span>a {\n  font-size: 14px;\n  opacity: 0.6;\n  line-height: 16px;\n}\n\n#post>div.post-copyright>div.post-copyright__type>span>a:hover {\n  opacity: 1;\n  background: none;\n}\n\n#post-copyright-url a {\n  overflow: hidden;\n  display: -webkit-box;\n  -webkit-line-clamp: 1;\n  -webkit-box-orient: vertical;\n}\n\n/*è£…é¥°åœˆ*/\n#post .post-copyright:before {\n  display: none;\n}\n\n#post .post-copyright .post-copyright-meta {\n    color: #5a7ed7;\n    font-weight: bold;\n}\n#post .post-copyright {\n    padding: 2rem 1.3rem;\n    border-radius: 11px;\n    border-style: dashed;\n}\n/* **********************ç‰ˆæƒä¿¡æ¯ ********************** */\n```\n\n### å¤–æŒ‚æ ‡ç­¾Tabç»„ä»¶\n\nåœ¨`blog\\source\\css`çš„cssæ–‡ä»¶ä¸­åŠ å…¥ä»¥ä¸‹å†…å®¹ã€‚\n\n```css\n/*å¤–æŒ‚æ ‡ç­¾tab*/\n#article-container .tabs {\n    position: relative;\n    margin: 0 0 20px;\n    border-radius: 5px;\n    border-right: 1px solid var(--tab-border-color);\n    border-bottom: 1px solid var(--tab-border-color);\n    border-left: 1px solid var(--tab-border-color);\n}\n\n#article-container .tabs > .nav-tabs > .tab {\n  -webkit-box-flex: 1;\n  -moz-box-flex: 1;\n  -o-box-flex: 1;\n  -ms-box-flex: 1;\n  box-flex: 1;\n  -webkit-flex-grow: 1;\n  flex-grow: 1;\n  border-radius: 5px;\n  padding: 8px 18px;\n  border-top: 2px solid rgba(0,0,0,0);\n  background: #fff;\n  color: var(--tab-botton-color);\n  line-height: 2;\n  -webkit-transition: all 0.4s;\n  -moz-transition: all 0.4s;\n  -o-transition: all 0.4s;\n  -ms-transition: all 0.4s;\n  transition: all 0.4s;\n}\n[data-theme=\"dark\"] #article-container .tabs > .nav-tabs > .tab {\n  -webkit-box-flex: 1;\n  -moz-box-flex: 1;\n  -o-box-flex: 1;\n  -ms-box-flex: 1;\n  box-flex: 1;\n  -webkit-flex-grow: 1;\n  flex-grow: 1;\n  border-radius: 5px;\n  padding: 8px 18px;\n  border-top: 2px solid rgba(0,0,0,0);\n  background: rgba(0,0,0,0);\n  color: var(--tab-botton-color);\n  line-height: 2;\n  -webkit-transition: all 0.4s;\n  -moz-transition: all 0.4s;\n  -o-transition: all 0.4s;\n  -ms-transition: all 0.4s;\n  transition: all 0.4s;\n}\n#article-container .tabs > .nav-tabs > .tab.active {\n    border-top: 2px solid #49b1f5;\n    background: var(--tab-button-active-bg);\n    cursor: default;\n}\n[data-theme=\"dark\"] #article-container .tabs > .nav-tabs > .tab.active {\n    border-top: 2px solid #49b1f5;\n    background: var(--tab-button-active-bg);\n    cursor: default;\n}\n```\n\n### é¡µè„šé€æ˜\n\n{% note pink 'fas fa-bullhorn' flat %}\n\n2025-10-13 æ›´æ–°è®°å½•ï¼šä¿®å¤é¡µè„šæ–‡å­—æ˜æš—æ¨¡å¼ä¸‹æ˜¾ç¤ºé—®é¢˜ã€‚\n\n{% endnote %}\n\nåœ¨`blog\\source\\css`çš„cssæ–‡ä»¶ä¸­åŠ å…¥ä»¥ä¸‹å†…å®¹ã€‚\n\n```css\n/*é¡µè„šé€æ˜åŒ–*/\n#footer, #footer:before {\n    background: transparent!important;\n}\n#footer-wrap,\n#footer-wrap a {\n  color: #111;\n  -webkit-transition: unset;\n  -moz-transition: unset;\n  -o-transition: unset;\n  -ms-transition: unset;\n  transition: unset;\n}\n#footer .footer-other {\n    color: #655f5f;\n}\n[data-theme='dark'] #footer .footer-other {\n    color: #BDBEC0;\n}\n[data-theme='dark'] #footer-wrap,\n[data-theme='dark'] #footer-wrap a {\n  color: var(--light-grey);\n}\n```\n\n### æ–‡ç« é¡¶å›¾é€æ˜åŒ–\n\nåœ¨`blog\\source\\css`çš„cssæ–‡ä»¶ä¸­åŠ å…¥ä»¥ä¸‹å†…å®¹ã€‚\n\n```css\n/* æ–‡ç« é¡¶å›¾é€æ˜åŒ– */\n#page-header {\n    background: rgba(0,0,0,.5) !important;\n}\n#page-header::before {\n  background: transparent !important;\n}\n[data-theme=\"dark\"] #page-header::before {\n  background: transparent !important;\n}\n```\n\n## æ ‡ç­¾äº‘æ–‡ç« è®¡æ•°\n\nåœ¨`blog\\themes\\butterfly\\scripts\\helpers\\page.js`æ–‡ä»¶ä¸­ï¼Œä¿®æ”¹å†…å®¹ã€‚\n\n```diff\n-    return `<a href=\"${env.url_for(tag.path)}\" style=\"${style}\">${tag.name}</a>`\n+\t return  `<a href=\"${env.url_for(tag.path)}\" style=\"${style}\">${tag.name}<sup>${tag.length}</sup></a>`   \n```\n\nå®ç°å‚è€ƒåŸé“¾æ¥å¦‚ä¸‹ï¼š\n\n{% link Eurkon | Butterfly æ ‡ç­¾äº‘å¢åŠ æ–‡ç« æ•°ä¸Šä¸‹æ ‡,https://blog.eurkon.com/post/6687849c.html,https://npm.elemecdn.com/eurkon-cdn/hexo/images/user/avatar.jpg %}\n\n## ç›´è¾¾åº•éƒ¨æŒ‰é’®\n\nåœ¨`blog\\themes\\butterfly\\layout\\includes\\rightside.pug`æ–‡ä»¶ä¸­ï¼Œ`i.fas.fa-arrow-up`ä¸‹é¢æ·»åŠ ä»¥ä¸‹ä¸¤è¡Œå†…å®¹ã€‚\n\n```diff\n    button#go-up(type=\"button\" title=_p(\"rightside.back_to_top\"))\n      span.scroll-percent\n      i.fas.fa-arrow-up\n+    button#go-down(type=\"button\" title=\"ç›´è¾¾åº•éƒ¨\" onclick=\"btf.scrollToDest(document.body.scrollHeight, 500)\")\n+      i.fas.fa-arrow-down\n```\n\n## èŠ‚æ—¥å¼¹çª—ä¸å…¬ç¥­æ—¥å˜ç°\n\nåœ¨`blog\\source\\js`ç›®å½•ä¸‹ï¼Œåˆ›å»º`day.js`æ–‡ä»¶ï¼ŒåŠ å…¥ä»¥ä¸‹å†…å®¹ã€‚\n\n```js\nvar d = new Date();\nm = d.getMonth() + 1;\ndd = d.getDate();\ny = d.getFullYear();\n\n// å…¬ç¥­æ—¥\nif (m == 9 && dd == 18) {\n    document.getElementsByTagName(\"html\")[0].setAttribute(\"style\", \"filter: grayscale(60%);\");\n    if (sessionStorage.getItem(\"isPopupWindow\") != \"1\") {\n        Swal.fire(\"ä»Šå¤©æ˜¯ä¹ä¸€å…«äº‹å˜\" + (y - 1931).toString() + \"å‘¨å¹´çºªå¿µæ—¥\\nğŸª”å‹¿å¿˜å›½è€»ï¼ŒæŒ¯å…´ä¸­åğŸª”\");\n        sessionStorage.setItem(\"isPopupWindow\", \"1\");\n    }\n}\nif (m == 7 && dd == 7) {\n    document.getElementsByTagName(\"html\")[0].setAttribute(\"style\", \"filter: grayscale(60%);\");\n    if (sessionStorage.getItem(\"isPopupWindow\") != \"1\") {\n        Swal.fire(\"ä»Šå¤©æ˜¯å¢æ²Ÿæ¡¥äº‹å˜\" + (y - 1937).toString() + \"å‘¨å¹´çºªå¿µæ—¥\\nğŸª”å‹¿å¿˜å›½è€»ï¼ŒæŒ¯å…´ä¸­åğŸª”\");\n        sessionStorage.setItem(\"isPopupWindow\", \"1\");\n    }\n}\nif (m == 12 && dd == 13) {\n    document.getElementsByTagName(\"html\")[0].setAttribute(\"style\", \"filter: grayscale(60%);\");\n    if (sessionStorage.getItem(\"isPopupWindow\") != \"1\") {\n        Swal.fire(\"ä»Šå¤©æ˜¯å—äº¬å¤§å± æ€\" + (y - 1937).toString() + \"å‘¨å¹´çºªå¿µæ—¥\\nğŸª”å‹¿å¿˜å›½è€»ï¼ŒæŒ¯å…´ä¸­åğŸª”\");\n        sessionStorage.setItem(\"isPopupWindow\", \"1\");\n    }\n}\nif (m == 8 && dd == 14) {\n    document.getElementsByTagName(\"html\")[0].setAttribute(\"style\", \"filter: grayscale(60%);\");\n    if (sessionStorage.getItem(\"isPopupWindow\") != \"1\") {\n        Swal.fire(\"ä»Šå¤©æ˜¯ä¸–ç•Œæ…°å®‰å¦‡çºªå¿µæ—¥\\nğŸª”å‹¿å¿˜å›½è€»ï¼ŒæŒ¯å…´ä¸­åğŸª”\");\n        sessionStorage.setItem(\"isPopupWindow\", \"1\");\n    }\n}\n\n\n// èŠ‚å‡æ—¥\nif (m == 10 && dd <= 3) {//å›½åº†èŠ‚\n    if (sessionStorage.getItem(\"isPopupWindow\") != \"1\") {\n        Swal.fire(\"å›½åº†èŠ‚ï¼Œç¥ä¼Ÿå¤§ç¥–å›½\" + (y - 1949).toString() + \"å²ç”Ÿæ—¥å¿«ä¹ï¼\");\n        sessionStorage.setItem(\"isPopupWindow\", \"1\");\n    }\n}\nif (m == 8 && dd == 15) {//ææ¥ç©çš„ï¼Œå°æ—¥å­æŠ•é™\n    if (sessionStorage.getItem(\"isPopupWindow\") != \"1\") {\n        Swal.fire(\"å°æ—¥å­å·²ç»æŠ•é™\" + (y - 1945).toString() + \"å¹´äº†ğŸ˜ƒ\");\n        sessionStorage.setItem(\"isPopupWindow\", \"1\");\n    }\n}\nif (m == 1 && dd == 1) {//å…ƒæ—¦èŠ‚\n    if (sessionStorage.getItem(\"isPopupWindow\") != \"1\") {\n        Swal.fire(y.toString() + \"å¹´å…ƒæ—¦å¿«ä¹ï¼ğŸ‰\");\n        sessionStorage.setItem(\"isPopupWindow\", \"1\");\n    }\n}\nif (m == 3 && dd == 8) {//å¦‡å¥³èŠ‚\n    if (sessionStorage.getItem(\"isPopupWindow\") != \"1\") {\n        Swal.fire(\"å„ä½å¥³ç¥ä»¬ï¼Œå¦‡å¥³èŠ‚å¿«ä¹ï¼ğŸ‘©\");\n        sessionStorage.setItem(\"isPopupWindow\", \"1\");\n    }\n}\nl = [\"éå¸¸æŠ±æ­‰ï¼Œå› ä¸ºä¸å¯æ§åŸå› ï¼Œåšå®¢å°†äºæ˜å¤©åœæ­¢è¿è¥ï¼\", \"å¥½æ¶ˆæ¯ï¼Œæ—¥æœ¬æ²¡äº†ï¼\", \"ç¾å›½å®äº†ï¼ŒåŸå› ç«Ÿç„¶æ˜¯å·æ™®ï¼\", \"å¾®è½¯å®äº†ï¼\", \"ä½ çš„ç”µè„‘å·²ç»è¿‡è½½ï¼Œå»ºè®®ç«‹å³å…³æœºï¼\", \"ä½ çŸ¥é“å—ï¼Ÿç«™é•¿å¾ˆå–œæ¬¢ä½ å“¦ï¼\", \"ä¸€åˆ†é’Ÿæœ‰61ç§’å“¦\", \"ä½ å–œæ¬¢çš„äººè·Ÿåˆ«äººè·‘äº†ï¼\"]\nif (m == 4 && dd == 1) {//æ„šäººèŠ‚ï¼Œéšæœºè°è¯\n    if (sessionStorage.getItem(\"isPopupWindow\") != \"1\") {\n\t\t // æ˜¾ç¤ºç¬¬ä¸€ä¸ªå¼¹çª—\n        Swal.fire(l[Math.floor(Math.random() * l.length)]).then(() => {\n            // ç¬¬ä¸€ä¸ªå¼¹çª—å…³é—­åï¼Œæ˜¾ç¤ºç¬¬äºŒä¸ªå¼¹çª—\n            Swal.fire(\"åˆ«å½“çœŸå•¦ï¼Œä»Šå¤©æ˜¯æ„šäººèŠ‚ğŸ˜ï¼\");\n            // è®¾ç½®ç¬¬äºŒä¸ªå¼¹çª—çš„æ˜¾ç¤ºæ ‡å¿—\n            sessionStorage.setItem(\"isPopupWindow\", \"1\");\n        });\n\n        // è®¾ç½®ç¬¬ä¸€ä¸ªå¼¹çª—çš„æ˜¾ç¤ºæ ‡å¿—\n        sessionStorage.setItem(\"isPopupWindow\", \"1\");\n    }\n}\nif (m == 5 && dd == 1) {//åŠ³åŠ¨èŠ‚\n    if (sessionStorage.getItem(\"isPopupWindow\") != \"1\") {\n        Swal.fire(\"åŠ³åŠ¨èŠ‚å¿«ä¹\\nä¸ºå„è¡Œå„ä¸šè¾›å‹¤å·¥ä½œçš„äººä»¬è‡´æ•¬ï¼\");\n        sessionStorage.setItem(\"isPopupWindow\", \"1\");\n    }\n}\nif (m == 5 && dd == 4) {//é’å¹´èŠ‚\n    if (sessionStorage.getItem(\"isPopupWindow\") != \"1\") {\n        Swal.fire(\"é’å¹´èŠ‚å¿«ä¹\\né’æ˜¥ä¸æ˜¯å›å¿†é€å»,è€Œæ˜¯æŠŠæ¡ç°åœ¨ï¼\");\n        sessionStorage.setItem(\"isPopupWindow\", \"1\");\n    }\n}\nif (m == 5 && dd == 20) {//520\n    if (sessionStorage.getItem(\"isPopupWindow\") != \"1\") {\n        Swal.fire(\"ä»Šå¹´æ˜¯520æƒ…äººèŠ‚\\nå¿«å’Œä½ å–œæ¬¢çš„äººä¸€èµ·è¿‡å§ï¼ğŸ’‘\");\n        sessionStorage.setItem(\"isPopupWindow\", \"1\");\n    }\n}\nif (m == 7 && dd == 1) {//å»ºå…šèŠ‚\n    if (sessionStorage.getItem(\"isPopupWindow\") != \"1\") {\n        Swal.fire(\"å»ºå…šèŠ‚ï¼Œç¥ä¸­å›½å…±äº§å…š\" + (y - 1921).toString() + \"å²ç”Ÿæ—¥å¿«ä¹ï¼\");\n        sessionStorage.setItem(\"isPopupWindow\", \"1\");\n    }\n}\nif (m == 9 && dd == 10) {//æ•™å¸ˆèŠ‚\n    if (sessionStorage.getItem(\"isPopupWindow\") != \"1\") {\n        Swal.fire(\"å„ä½è€å¸ˆä»¬æ•™å¸ˆèŠ‚å¿«ä¹ï¼ğŸ‘©â€ğŸ«\");\n        sessionStorage.setItem(\"isPopupWindow\", \"1\");\n    }\n}\n\n\n//ä¼ ç»ŸèŠ‚æ—¥éƒ¨åˆ†\n\nif  ( m == 4 && dd == 4)) {//æ¸…æ˜èŠ‚\n    if (sessionStorage.getItem(\"isPopupWindow\") != \"1\") {\n        Swal.fire(\"æ¸…æ˜æ—¶èŠ‚é›¨çº·çº·,ä¸€æŸé²œèŠ±ç¥­æ•…äººğŸ’\");\n        sessionStorage.setItem(\"isPopupWindow\", \"1\");\n    }\n}\nif  ( m == 12 && dd == 21)) {//å†¬è‡³\n    if (sessionStorage.getItem(\"isPopupWindow\") != \"1\") {\n        Swal.fire(\"å†¬è‡³å¿«ä¹\\nå¿«åƒä¸Šä¸€ç¢—çƒ­çƒ­çš„æ±¤åœ†å’Œé¥ºå­å§ğŸ§†\");\n        sessionStorage.setItem(\"isPopupWindow\", \"1\");\n    }\n}\n\nvar lunar = calendarFormatter.solar2lunar();\n\n//å†œå†é‡‡ç”¨æ±‰å­—è®¡ç®—ï¼Œé˜²æ­¢å‡ºç°é—°æœˆå¯¼è‡´é—®é¢˜\n\nif ((lunar[\"IMonthCn\"] == \"æ­£æœˆ\" && lunar[\"IDayCn\"] == \"åˆå…­\") || (lunar[\"IMonthCn\"] == \"æ­£æœˆ\" && lunar[\"IDayCn\"] == \"åˆäº”\") || (lunar[\"IMonthCn\"] == \"æ­£æœˆ\" && lunar[\"IDayCn\"] == \"åˆå››\") || (lunar[\"IMonthCn\"] == \"æ­£æœˆ\" && lunar[\"IDayCn\"] == \"åˆä¸‰\") || (lunar[\"IMonthCn\"] == \"æ­£æœˆ\" && lunar[\"IDayCn\"] == \"åˆäºŒ\") || (lunar[\"IMonthCn\"] == \"æ­£æœˆ\" && lunar[\"IDayCn\"] == \"åˆä¸€\") || (lunar[\"IMonthCn\"] == \"è…Šæœˆ\" && lunar[\"IDayCn\"] == \"ä¸‰å\") || (lunar[\"IMonthCn\"] == \"è…Šæœˆ\" && lunar[\"IDayCn\"] == \"å»¿ä¹\")) {\n    //æ˜¥èŠ‚ï¼Œæœ¬æ¥åªæœ‰å¤§å¹´ä¸‰ååˆ°åˆå…­ï¼Œä½†æ˜¯æœ‰æ—¶å€™é™¤å¤•æ˜¯å¤§å¹´äºŒåä¹ï¼Œæ‰€ä»¥ä¹ŸåŠ ä¸Šäº†\n    if (sessionStorage.getItem(\"isPopupWindow\") != \"1\") {\n        Swal.fire(y.toString() + \"å¹´æ–°å¹´å¿«ä¹\\nğŸŠç¥ä½ å¿ƒæƒ³äº‹æˆï¼Œè¯¸äº‹é¡ºåˆ©ğŸŠ\");\n        sessionStorage.setItem(\"isPopupWindow\", \"1\");\n    }\n}\nif ((lunar[\"IMonthCn\"] == \"æ­£æœˆ\" && lunar[\"IDayCn\"] == \"åäº”\")) {\n    //å…ƒå®µèŠ‚\n    if (sessionStorage.getItem(\"isPopupWindow\") != \"1\") {\n        Swal.fire(\"å…ƒå®µèŠ‚å¿«ä¹\\né€ä½ ä¸€ä¸ªå¤§å¤§çš„ç¯ç¬¼ğŸ§…\");\n        sessionStorage.setItem(\"isPopupWindow\", \"1\");\n    }\n}\nif ((lunar[\"IMonthCn\"] == \"äº”æœˆ\" && lunar[\"IDayCn\"] == \"åˆäº”\")) {\n    //ç«¯åˆèŠ‚\n    if (sessionStorage.getItem(\"isPopupWindow\") != \"1\") {\n        Swal.fire(\"ç«¯åˆèŠ‚å¿«ä¹\\nè¯·ä½ åƒä¸€æ¡ç²½å­ğŸ™\");\n        sessionStorage.setItem(\"isPopupWindow\", \"1\");\n    }\n}\nif ((lunar[\"IMonthCn\"] == \"ä¸ƒæœˆ\" && lunar[\"IDayCn\"] == \"åˆä¸ƒ\")) {\n    //ä¸ƒå¤•èŠ‚\n    if (sessionStorage.getItem(\"isPopupWindow\") != \"1\") {\n        Swal.fire(\"ä¸ƒå¤•èŠ‚å¿«ä¹\\né»„æ˜å,æŸ³æ¢¢å¤´,ç‰›éƒç»‡å¥³æ¥ç¢°å¤´\");\n        sessionStorage.setItem(\"isPopupWindow\", \"1\");\n    }\n}\nif ((lunar[\"IMonthCn\"] == \"å…«æœˆ\" && lunar[\"IDayCn\"] == \"åäº”\")) {\n    //ä¸­ç§‹èŠ‚\n    if (sessionStorage.getItem(\"isPopupWindow\") != \"1\") {\n        Swal.fire(\"ä¸­ç§‹èŠ‚å¿«ä¹\\nè¯·ä½ åƒä¸€å—æœˆé¥¼ğŸª\");\n        sessionStorage.setItem(\"isPopupWindow\", \"1\");\n    }\n}\nif ((lunar[\"IMonthCn\"] == \"ä¹æœˆ\" && lunar[\"IDayCn\"] == \"åˆä¹\")) {\n    //é‡é˜³èŠ‚\n    if (sessionStorage.getItem(\"isPopupWindow\") != \"1\") {\n        Swal.fire(\"é‡é˜³èŠ‚å¿«ä¹\\nç‹¬åœ¨å¼‚ä¹¡ä¸ºå¼‚å®¢ï¼Œæ¯é€¢ä½³èŠ‚å€æ€äº²\");\n        sessionStorage.setItem(\"isPopupWindow\", \"1\");\n    }\n}\n\n// åˆ‡æ¢ä¸»é¢˜æé†’\n// if (y == 2022 && m == 12 && (dd >= 18 && dd <= 20)) {\n//     if (sessionStorage.getItem(\"isPopupWindow\") != \"1\") {\n//         Swal.fire(\"ç½‘ç«™æ¢æˆå†¬æ—¥é™å®šä¸»é¢˜å•¦â›„\");\n//         sessionStorage.setItem(\"isPopupWindow\", \"1\");\n//     }\n// }\n\n```\n\nåœ¨`blog\\source\\js`ç›®å½•ä¸‹ï¼Œåˆ›å»º`lunar.js`æ–‡ä»¶ï¼ŒåŠ å…¥ä»¥ä¸‹å†…å®¹ã€‚\n\n```js\nvar lunarInfo = [19416, 19168, 42352, 21717, 53856, 55632, 91476, 22176, 39632, 21970, 19168, 42422, 42192, 53840, 119381, 46400, 54944, 44450, 38320, 84343, 18800, 42160, 46261, 27216, 27968, 109396, 11104, 38256, 21234, 18800, 25958, 54432, 59984, 28309, 23248, 11104, 100067, 37600, 116951, 51536, 54432, 120998, 46416, 22176, 107956, 9680, 37584, 53938, 43344, 46423, 27808, 46416, 86869, 19872, 42416, 83315, 21168, 43432, 59728, 27296, 44710, 43856, 19296, 43748, 42352, 21088, 62051, 55632, 23383, 22176, 38608, 19925, 19152, 42192, 54484, 53840, 54616, 46400, 46752, 103846, 38320, 18864, 43380, 42160, 45690, 27216, 27968, 44870, 43872, 38256, 19189, 18800, 25776, 29859, 59984, 27480, 23232, 43872, 38613, 37600, 51552, 55636, 54432, 55888, 30034, 22176, 43959, 9680, 37584, 51893, 43344, 46240, 47780, 44368, 21977, 19360, 42416, 86390, 21168, 43312, 31060, 27296, 44368, 23378, 19296, 42726, 42208, 53856, 60005, 54576, 23200, 30371, 38608, 19195, 19152, 42192, 118966, 53840, 54560, 56645, 46496, 22224, 21938, 18864, 42359, 42160, 43600, 111189, 27936, 44448, 84835, 37744, 18936, 18800, 25776, 92326, 59984, 27424, 108228, 43744, 41696, 53987, 51552, 54615, 54432, 55888, 23893, 22176, 42704, 21972, 21200, 43448, 43344, 46240, 46758, 44368, 21920, 43940, 42416, 21168, 45683, 26928, 29495, 27296, 44368, 84821, 19296, 42352, 21732, 53600, 59752, 54560, 55968, 92838, 22224, 19168, 43476, 41680, 53584, 62034, 54560], solarMonth = [31, 28, 31, 30, 31, 30, 31, 31, 30, 31, 30, 31], Gan = [\"ç”²\", \"ä¹™\", \"ä¸™\", \"ä¸\", \"æˆŠ\", \"å·±\", \"åºš\", \"è¾›\", \"å£¬\", \"ç™¸\"], Zhi = [\"å­\", \"ä¸‘\", \"å¯…\", \"å¯\", \"è¾°\", \"å·³\", \"åˆ\", \"æœª\", \"ç”³\", \"é…‰\", \"æˆŒ\", \"äº¥\"], Animals = [\"é¼ \", \"ç‰›\", \"è™\", \"å…”\", \"é¾™\", \"è›‡\", \"é©¬\", \"ç¾Š\", \"çŒ´\", \"é¸¡\", \"ç‹—\", \"çŒª\"], solarTerm = [\"å°å¯’\", \"å¤§å¯’\", \"ç«‹æ˜¥\", \"é›¨æ°´\", \"æƒŠè›°\", \"æ˜¥åˆ†\", \"æ¸…æ˜\", \"è°·é›¨\", \"ç«‹å¤\", \"å°æ»¡\", \"èŠ’ç§\", \"å¤è‡³\", \"å°æš‘\", \"å¤§æš‘\", \"ç«‹ç§‹\", \"å¤„æš‘\", \"ç™½éœ²\", \"ç§‹åˆ†\", \"å¯’éœ²\", \"éœœé™\", \"ç«‹å†¬\", \"å°é›ª\", \"å¤§é›ª\", \"å†¬è‡³\"], sTermInfo = [\"9778397bd097c36b0b6fc9274c91aa\", \"97b6b97bd19801ec9210c965cc920e\", \"97bcf97c3598082c95f8c965cc920f\", \"97bd0b06bdb0722c965ce1cfcc920f\", \"b027097bd097c36b0b6fc9274c91aa\", \"97b6b97bd19801ec9210c965cc920e\", \"97bcf97c359801ec95f8c965cc920f\", \"97bd0b06bdb0722c965ce1cfcc920f\", \"b027097bd097c36b0b6fc9274c91aa\", \"97b6b97bd19801ec9210c965cc920e\", \"97bcf97c359801ec95f8c965cc920f\", \"97bd0b06bdb0722c965ce1cfcc920f\", \"b027097bd097c36b0b6fc9274c91aa\", \"9778397bd19801ec9210c965cc920e\", \"97b6b97bd19801ec95f8c965cc920f\", \"97bd09801d98082c95f8e1cfcc920f\", \"97bd097bd097c36b0b6fc9210c8dc2\", \"9778397bd197c36c9210c9274c91aa\", \"97b6b97bd19801ec95f8c965cc920e\", \"97bd09801d98082c95f8e1cfcc920f\", \"97bd097bd097c36b0b6fc9210c8dc2\", \"9778397bd097c36c9210c9274c91aa\", \"97b6b97bd19801ec95f8c965cc920e\", \"97bcf97c3598082c95f8e1cfcc920f\", \"97bd097bd097c36b0b6fc9210c8dc2\", \"9778397bd097c36c9210c9274c91aa\", \"97b6b97bd19801ec9210c965cc920e\", \"97bcf97c3598082c95f8c965cc920f\", \"97bd097bd097c35b0b6fc920fb0722\", \"9778397bd097c36b0b6fc9274c91aa\", \"97b6b97bd19801ec9210c965cc920e\", \"97bcf97c3598082c95f8c965cc920f\", \"97bd097bd097c35b0b6fc920fb0722\", \"9778397bd097c36b0b6fc9274c91aa\", \"97b6b97bd19801ec9210c965cc920e\", \"97bcf97c359801ec95f8c965cc920f\", \"97bd097bd097c35b0b6fc920fb0722\", \"9778397bd097c36b0b6fc9274c91aa\", \"97b6b97bd19801ec9210c965cc920e\", \"97bcf97c359801ec95f8c965cc920f\", \"97bd097bd097c35b0b6fc920fb0722\", \"9778397bd097c36b0b6fc9274c91aa\", \"97b6b97bd19801ec9210c965cc920e\", \"97bcf97c359801ec95f8c965cc920f\", \"97bd097bd07f595b0b6fc920fb0722\", \"9778397bd097c36b0b6fc9210c8dc2\", \"9778397bd19801ec9210c9274c920e\", \"97b6b97bd19801ec95f8c965cc920f\", \"97bd07f5307f595b0b0bc920fb0722\", \"7f0e397bd097c36b0b6fc9210c8dc2\", \"9778397bd097c36c9210c9274c920e\", \"97b6b97bd19801ec95f8c965cc920f\", \"97bd07f5307f595b0b0bc920fb0722\", \"7f0e397bd097c36b0b6fc9210c8dc2\", \"9778397bd097c36c9210c9274c91aa\", \"97b6b97bd19801ec9210c965cc920e\", \"97bd07f1487f595b0b0bc920fb0722\", \"7f0e397bd097c36b0b6fc9210c8dc2\", \"9778397bd097c36b0b6fc9274c91aa\", \"97b6b97bd19801ec9210c965cc920e\", \"97bcf7f1487f595b0b0bb0b6fb0722\", \"7f0e397bd097c35b0b6fc920fb0722\", \"9778397bd097c36b0b6fc9274c91aa\", \"97b6b97bd19801ec9210c965cc920e\", \"97bcf7f1487f595b0b0bb0b6fb0722\", \"7f0e397bd097c35b0b6fc920fb0722\", \"9778397bd097c36b0b6fc9274c91aa\", \"97b6b97bd19801ec9210c965cc920e\", \"97bcf7f1487f531b0b0bb0b6fb0722\", \"7f0e397bd097c35b0b6fc920fb0722\", \"9778397bd097c36b0b6fc9274c91aa\", \"97b6b97bd19801ec9210c965cc920e\", \"97bcf7f1487f531b0b0bb0b6fb0722\", \"7f0e397bd07f595b0b6fc920fb0722\", \"9778397bd097c36b0b6fc9274c91aa\", \"97b6b97bd19801ec9210c9274c920e\", \"97bcf7f0e47f531b0b0bb0b6fb0722\", \"7f0e397bd07f595b0b0bc920fb0722\", \"9778397bd097c36b0b6fc9210c91aa\", \"97b6b97bd197c36c9210c9274c920e\", \"97bcf7f0e47f531b0b0bb0b6fb0722\", \"7f0e397bd07f595b0b0bc920fb0722\", \"9778397bd097c36b0b6fc9210c8dc2\", \"9778397bd097c36c9210c9274c920e\", \"97b6b7f0e47f531b0723b0b6fb0722\", \"7f0e37f5307f595b0b0bc920fb0722\", \"7f0e397bd097c36b0b6fc9210c8dc2\", \"9778397bd097c36b0b70c9274c91aa\", \"97b6b7f0e47f531b0723b0b6fb0721\", \"7f0e37f1487f595b0b0bb0b6fb0722\", \"7f0e397bd097c35b0b6fc9210c8dc2\", \"9778397bd097c36b0b6fc9274c91aa\", \"97b6b7f0e47f531b0723b0b6fb0721\", \"7f0e27f1487f595b0b0bb0b6fb0722\", \"7f0e397bd097c35b0b6fc920fb0722\", \"9778397bd097c36b0b6fc9274c91aa\", \"97b6b7f0e47f531b0723b0b6fb0721\", \"7f0e27f1487f531b0b0bb0b6fb0722\", \"7f0e397bd097c35b0b6fc920fb0722\", \"9778397bd097c36b0b6fc9274c91aa\", \"97b6b7f0e47f531b0723b0b6fb0721\", \"7f0e27f1487f531b0b0bb0b6fb0722\", \"7f0e397bd097c35b0b6fc920fb0722\", \"9778397bd097c36b0b6fc9274c91aa\", \"97b6b7f0e47f531b0723b0b6fb0721\", \"7f0e27f1487f531b0b0bb0b6fb0722\", \"7f0e397bd07f595b0b0bc920fb0722\", \"9778397bd097c36b0b6fc9274c91aa\", \"97b6b7f0e47f531b0723b0787b0721\", \"7f0e27f0e47f531b0b0bb0b6fb0722\", \"7f0e397bd07f595b0b0bc920fb0722\", \"9778397bd097c36b0b6fc9210c91aa\", \"97b6b7f0e47f149b0723b0787b0721\", \"7f0e27f0e47f531b0723b0b6fb0722\", \"7f0e397bd07f595b0b0bc920fb0722\", \"9778397bd097c36b0b6fc9210c8dc2\", \"977837f0e37f149b0723b0787b0721\", \"7f07e7f0e47f531b0723b0b6fb0722\", \"7f0e37f5307f595b0b0bc920fb0722\", \"7f0e397bd097c35b0b6fc9210c8dc2\", \"977837f0e37f14998082b0787b0721\", \"7f07e7f0e47f531b0723b0b6fb0721\", \"7f0e37f1487f595b0b0bb0b6fb0722\", \"7f0e397bd097c35b0b6fc9210c8dc2\", \"977837f0e37f14998082b0787b06bd\", \"7f07e7f0e47f531b0723b0b6fb0721\", \"7f0e27f1487f531b0b0bb0b6fb0722\", \"7f0e397bd097c35b0b6fc920fb0722\", \"977837f0e37f14998082b0787b06bd\", \"7f07e7f0e47f531b0723b0b6fb0721\", \"7f0e27f1487f531b0b0bb0b6fb0722\", \"7f0e397bd097c35b0b6fc920fb0722\", \"977837f0e37f14998082b0787b06bd\", \"7f07e7f0e47f531b0723b0b6fb0721\", \"7f0e27f1487f531b0b0bb0b6fb0722\", \"7f0e397bd07f595b0b0bc920fb0722\", \"977837f0e37f14998082b0787b06bd\", \"7f07e7f0e47f531b0723b0b6fb0721\", \"7f0e27f1487f531b0b0bb0b6fb0722\", \"7f0e397bd07f595b0b0bc920fb0722\", \"977837f0e37f14998082b0787b06bd\", \"7f07e7f0e47f149b0723b0787b0721\", \"7f0e27f0e47f531b0b0bb0b6fb0722\", \"7f0e397bd07f595b0b0bc920fb0722\", \"977837f0e37f14998082b0723b06bd\", \"7f07e7f0e37f149b0723b0787b0721\", \"7f0e27f0e47f531b0723b0b6fb0722\", \"7f0e397bd07f595b0b0bc920fb0722\", \"977837f0e37f14898082b0723b02d5\", \"7ec967f0e37f14998082b0787b0721\", \"7f07e7f0e47f531b0723b0b6fb0722\", \"7f0e37f1487f595b0b0bb0b6fb0722\", \"7f0e37f0e37f14898082b0723b02d5\", \"7ec967f0e37f14998082b0787b0721\", \"7f07e7f0e47f531b0723b0b6fb0722\", \"7f0e37f1487f531b0b0bb0b6fb0722\", \"7f0e37f0e37f14898082b0723b02d5\", \"7ec967f0e37f14998082b0787b06bd\", \"7f07e7f0e47f531b0723b0b6fb0721\", \"7f0e37f1487f531b0b0bb0b6fb0722\", \"7f0e37f0e37f14898082b072297c35\", \"7ec967f0e37f14998082b0787b06bd\", \"7f07e7f0e47f531b0723b0b6fb0721\", \"7f0e27f1487f531b0b0bb0b6fb0722\", \"7f0e37f0e37f14898082b072297c35\", \"7ec967f0e37f14998082b0787b06bd\", \"7f07e7f0e47f531b0723b0b6fb0721\", \"7f0e27f1487f531b0b0bb0b6fb0722\", \"7f0e37f0e366aa89801eb072297c35\", \"7ec967f0e37f14998082b0787b06bd\", \"7f07e7f0e47f149b0723b0787b0721\", \"7f0e27f1487f531b0b0bb0b6fb0722\", \"7f0e37f0e366aa89801eb072297c35\", \"7ec967f0e37f14998082b0723b06bd\", \"7f07e7f0e47f149b0723b0787b0721\", \"7f0e27f0e47f531b0723b0b6fb0722\", \"7f0e37f0e366aa89801eb072297c35\", \"7ec967f0e37f14998082b0723b06bd\", \"7f07e7f0e37f14998083b0787b0721\", \"7f0e27f0e47f531b0723b0b6fb0722\", \"7f0e37f0e366aa89801eb072297c35\", \"7ec967f0e37f14898082b0723b02d5\", \"7f07e7f0e37f14998082b0787b0721\", \"7f07e7f0e47f531b0723b0b6fb0722\", \"7f0e36665b66aa89801e9808297c35\", \"665f67f0e37f14898082b0723b02d5\", \"7ec967f0e37f14998082b0787b0721\", \"7f07e7f0e47f531b0723b0b6fb0722\", \"7f0e36665b66a449801e9808297c35\", \"665f67f0e37f14898082b0723b02d5\", \"7ec967f0e37f14998082b0787b06bd\", \"7f07e7f0e47f531b0723b0b6fb0721\", \"7f0e36665b66a449801e9808297c35\", \"665f67f0e37f14898082b072297c35\", \"7ec967f0e37f14998082b0787b06bd\", \"7f07e7f0e47f531b0723b0b6fb0721\", \"7f0e26665b66a449801e9808297c35\", \"665f67f0e37f1489801eb072297c35\", \"7ec967f0e37f14998082b0787b06bd\", \"7f07e7f0e47f531b0723b0b6fb0721\", \"7f0e27f1487f531b0b0bb0b6fb0722\"], nStr1 = [\"æ—¥\", \"ä¸€\", \"äºŒ\", \"ä¸‰\", \"å››\", \"äº”\", \"å…­\", \"ä¸ƒ\", \"å…«\", \"ä¹\", \"å\"], nStr2 = [\"åˆ\", \"å\", \"å»¿\", \"å…\"], nStr3 = [\"æ­£\", \"äºŒ\", \"ä¸‰\", \"å››\", \"äº”\", \"å…­\", \"ä¸ƒ\", \"å…«\", \"ä¹\", \"å\", \"å†¬\", \"è…Š\"];\nfunction lYearDays(b) {\n    var f,\n    c = 348;\n    for (f = 32768; f > 8; f >>= 1)\n        c += lunarInfo[b - 1900] & f ? 1 : 0;\n    return c + leapDays(b)\n}\nfunction leapMonth(b) {\n    return 15 & lunarInfo[b - 1900]\n}\nfunction leapDays(b) {\n    return leapMonth(b) ? 65536 & lunarInfo[b - 1900] ? 30 : 29 : 0\n}\nfunction monthDays(b, f) {\n    return f > 12 || f < 1 ? -1 : lunarInfo[b - 1900] & 65536 >> f ? 30 : 29\n}\nfunction solarDays(b, f) {\n    if (f > 12 || f < 1)\n        return -1;\n    var c = f - 1;\n    return 1 === c ? b % 4 == 0 && b % 100 != 0 || b % 400 == 0 ? 29 : 28 : solarMonth[c]\n}\nfunction toGanZhiYear(b) {\n    var f = (b - 3) % 10,\n    c = (b - 3) % 12;\n    return 0 === f && (f = 10),\n    0 === c && (c = 12),\n    Gan[f - 1] + Zhi[c - 1]\n}\nfunction toAstro(b, f) {\n    return \"é­”ç¾¯æ°´ç“¶åŒé±¼ç™½ç¾Šé‡‘ç‰›åŒå­å·¨èŸ¹ç‹®å­å¤„å¥³å¤©ç§¤å¤©èå°„æ‰‹é­”ç¾¯\".substr(2 * b - (f < [20, 19, 21, 21, 21, 22, 23, 23, 23, 23, 22, 22][b - 1] ? 2 : 0), 2) + \"åº§\"\n}\nfunction toGanZhi(b) {\n    return Gan[b % 10] + Zhi[b % 12]\n}\nfunction getTerm(b, f) {\n    if (b < 1900 || b > 2100)\n        return -1;\n    if (f < 1 || f > 24)\n        return -1;\n    var c = sTermInfo[b - 1900],\n    e = [parseInt(\"0x\" + c.substr(0, 5)).toString(), parseInt(\"0x\" + c.substr(5, 5)).toString(), parseInt(\"0x\" + c.substr(10, 5)).toString(), parseInt(\"0x\" + c.substr(15, 5)).toString(), parseInt(\"0x\" + c.substr(20, 5)).toString(), parseInt(\"0x\" + c.substr(25, 5)).toString()],\n    a = [e[0].substr(0, 1), e[0].substr(1, 2), e[0].substr(3, 1), e[0].substr(4, 2), e[1].substr(0, 1), e[1].substr(1, 2), e[1].substr(3, 1), e[1].substr(4, 2), e[2].substr(0, 1), e[2].substr(1, 2), e[2].substr(3, 1), e[2].substr(4, 2), e[3].substr(0, 1), e[3].substr(1, 2), e[3].substr(3, 1), e[3].substr(4, 2), e[4].substr(0, 1), e[4].substr(1, 2), e[4].substr(3, 1), e[4].substr(4, 2), e[5].substr(0, 1), e[5].substr(1, 2), e[5].substr(3, 1), e[5].substr(4, 2)];\n    return parseInt(a[f - 1])\n}\nfunction toChinaMonth(b) {\n    if (b > 12 || b < 1)\n        return -1;\n    var f = nStr3[b - 1];\n    return f += \"æœˆ\"\n}\nfunction toChinaDay(b) {\n    var f;\n    switch (b) {\n    case 10:\n        f = \"åˆå\";\n        break;\n    case 20:\n        f = \"äºŒå\";\n        break;\n    case 30:\n        f = \"ä¸‰å\";\n        break;\n    default:\n        f = nStr2[Math.floor(b / 10)],\n        f += nStr1[b % 10]\n    }\n    return f\n}\nfunction getAnimal(b) {\n    return Animals[(b - 4) % 12]\n}\nfunction solar2lunar(b, f, c) {\n    if (b < 1900 || b > 2100)\n        return -1;\n    if (1900 === b && 1 === f && c < 31)\n        return -1;\n    var e,\n    a,\n    r = null,\n    t = 0;\n    b = (r = b ? new Date(b, parseInt(f) - 1, c) : new Date).getFullYear(),\n    f = r.getMonth() + 1,\n    c = r.getDate();\n    var d = (Date.UTC(r.getFullYear(), r.getMonth(), r.getDate()) - Date.UTC(1900, 0, 31)) / 864e5;\n    for (e = 1900; e < 2101 && d > 0; e++)\n        d -= t = lYearDays(e);\n    d < 0 && (d += t, e--);\n    var n = new Date,\n    s = !1;\n    n.getFullYear() === b && n.getMonth() + 1 === f && n.getDate() === c && (s = !0);\n    var u = r.getDay(),\n    o = nStr1[u];\n    0 === u && (u = 7);\n    var l = e;\n    a = leapMonth(e);\n    var i = !1;\n    for (e = 1; e < 13 && d > 0; e++)\n        a > 0 && e === a + 1 && !1 === i ? (--e, i = !0, t = leapDays(l)) : t = monthDays(l, e), !0 === i && e === a + 1 && (i = !1), d -= t;\n    0 === d && a > 0 && e === a + 1 && (i ? i = !1 : (i = !0, --e)),\n    d < 0 && (d += t, --e);\n    var h = e,\n    D = d + 1,\n    g = f - 1,\n    v = toGanZhiYear(l),\n    y = getTerm(b, 2 * f - 1),\n    m = getTerm(b, 2 * f),\n    p = toGanZhi(12 * (b - 1900) + f + 11);\n    c >= y && (p = toGanZhi(12 * (b - 1900) + f + 12));\n    var M = !1,\n    T = null;\n    y === c && (M = !0, T = solarTerm[2 * f - 2]),\n    m === c && (M = !0, T = solarTerm[2 * f - 1]);\n    var I = toGanZhi(Date.UTC(b, g, 1, 0, 0, 0, 0) / 864e5 + 25567 + 10 + c - 1),\n    C = toAstro(f, c);\n    return {\n        lYear: l,\n        lMonth: h,\n        lDay: D,\n        Animal: getAnimal(l),\n        IMonthCn: (i ? \"é—°\" : \"\") + toChinaMonth(h),\n        IDayCn: toChinaDay(D),\n        cYear: b,\n        cMonth: f,\n        cDay: c,\n        gzYear: v,\n        gzMonth: p,\n        gzDay: I,\n        isToday: s,\n        isLeap: i,\n        nWeek: u,\n        ncWeek: \"æ˜ŸæœŸ\" + o,\n        isTerm: M,\n        Term: T,\n        astro: C\n    }\n}\nvar calendarFormatter = {\n    solar2lunar: function (b, f, c) {\n        return solar2lunar(b, f, c)\n    },\n    lunar2solar: function (b, f, c, e) {\n        if ((e = !!e) && leapMonth !== f)\n            return -1;\n        if (2100 === b && 12 === f && c > 1 || 1900 === b && 1 === f && c < 31)\n            return -1;\n        var a = monthDays(b, f),\n        r = a;\n        if (e && (r = leapDays(b, f)), b < 1900 || b > 2100 || c > r)\n            return -1;\n        for (var t = 0, d = 1900; d < b; d++)\n            t += lYearDays(d);\n        var n = 0,\n        s = !1;\n        for (d = 1; d < f; d++)\n            n = leapMonth(b), s || n <= d && n > 0 && (t += leapDays(b), s = !0), t += monthDays(b, d);\n        e && (t += a);\n        var u = Date.UTC(1900, 1, 30, 0, 0, 0),\n        o = new Date(864e5 * (t + c - 31) + u);\n        return solar2lunar(o.getUTCFullYear(), o.getUTCMonth() + 1, o.getUTCDate())\n    }\n};\n```\n\nåœ¨`_config.butterfly.yml`é‡Œé¢çš„`inject`çš„bottomä¸­å¼•å…¥jsæ–‡ä»¶çš„è·¯å¾„ã€‚\n\n```yaml\ninject:\n .........\n  bottom:\n     - <script defer type=\"text/javascript\" src=\"https://s4.zstatic.net/ajax/libs/sweetalert2/11.16.1/sweetalert2.all.js\"></script>  # èŠ‚æ—¥å¼¹çª—ä¾èµ–\n     - <script defer src=\"/js/lunar.js?1\"></script> # å†œå†è®¡ç®—\n     - <script defer src=\"/js/day.js?1\"></script> # èŠ‚æ—¥å¼¹çª—\n```\n\nå®ç°å‚è€ƒåŸé“¾æ¥å¦‚ä¸‹ï¼š\n\n{% link FomalhautğŸ¥ | åšå®¢é­”æ”¹æ•™ç¨‹æ€»ç»“(ä¸‰),https://www.fomal.cc/posts/2d7ac914.html#%E8%8A%82%E6%97%A5%E5%BC%B9%E7%AA%97%E4%B8%8E%E5%85%AC%E7%A5%AD%E6%97%A5%E5%8F%98%E7%81%B0,https://www.fomal.cc/assets/avatar.webp %}\n\n## åšå®¢åº•éƒ¨è¿è¡Œæ—¶é—´\n\n{% tip info %}ç‚¹å‡»åˆ‡æ¢æ˜¾ç¤ºæ¨¡å¼ï¼Œæ”¯æŒå››ç§æ˜¾ç¤ºæ¨¡å¼å¾ªç¯åˆ‡æ¢ï¼š\n\næ¨¡å¼0 â†’ x å¹´ x å¤© x æ—¶ x åˆ† x ç§’\næ¨¡å¼1 â†’x å¤© x æ—¶ x åˆ† x ç§’\næ¨¡å¼2 â†’  x æ—¶ x åˆ† x ç§’\næ¨¡å¼3 â†’  x åˆ† x ç§’\n\n{% endtip %}\n\nåœ¨`_config.butterfly.yml`ä¿®æ”¹`footer`çš„custom_textã€‚\n\n```yaml\nfooter:\n  owner:\n    enable: true\n    since: 2024\n  custom_text: <div id=\"runtime\"></div>\n```\n\nåœ¨`blog\\source\\css`çš„cssæ–‡ä»¶ä¸­åŠ å…¥ä»¥ä¸‹å†…å®¹ã€‚\n\n```css\n/*é¡µè„šæ˜¾ç¤ºç½‘ç«™è¿è¡Œæ—¶é—´*/\ndiv#runtime {\n    width: fit-content;\n    color: #fff;\n    display: flex;\n    margin: auto;\n    padding: 0 10px;\n    border-radius: 10px;\n    background-color: rgba(0,0,0,.5);\n}\n\n[data-theme=\"dark\"] div#runtime {\n    color: #28b4c8;\n    box-shadow: 0 0 5px rgba(28, 69, 218, 0.71);\n}\n#runtime:hover {\n    background: #f0f0f0;\n    color: #000;\n}\n```\n\nåœ¨`blog\\source\\js`çš„jsæ–‡ä»¶ä¸­åŠ å…¥ä»¥ä¸‹å†…å®¹ã€‚\n\n```js\n/*é¡µè„šæ˜¾ç¤ºç½‘ç«™è¿è¡Œæ—¶é—´*/\n//æ­¤å¤„çš„æ—¶é—´æ”¹ä¸ºè‡ªå·±çš„åšå®¢è¿è¡Œæ—¶é—´\nconst CREATE_TIME = new Date('2020-01-01T00:00:00').getTime();  //ä½¿ç”¨ISO 8601æ—¥æœŸæ ¼å¼ï¼Œå…¼å®¹æ‰€æœ‰æµè§ˆå™¨\nconst TIME_UNITS = [\n    { value: 31536000000, label: ' å¹´' },  // å¹´ï¼ˆæ¯«ç§’ï¼‰\n    { value: 86400000, label: ' å¤©' },    // å¤©\n    { value: 3600000, label: ' æ—¶' },     // å°æ—¶\n    { value: 60000, label: ' åˆ†' },       // åˆ†é’Ÿ\n    { value: 1000, label: ' ç§’' }         // ç§’\n];\n//ä¿®æ”¹æ­¤å¤„çš„æ•°å­—ï¼Œé€‰æ‹©é»˜è®¤æ˜¾ç¤ºæ—¶é—´çš„æ ¼å¼\nlet currentFormat = 0; // 0:å¹´å¤©æ—¶åˆ†ç§’ 1:å¤©æ—¶åˆ†ç§’ 2:æ—¶åˆ†ç§’ 3:åˆ†ç§’\n\nfunction formatDuration(ms) {\n    let remaining = ms;\n    return TIME_UNITS.map((unit, index) => {\n        if (index < currentFormat) return null;\n        const value = Math.floor(remaining / unit.value);\n        remaining %= unit.value;\n        return value > 0 ? `${value}${unit.label}` : '';\n    }).filter(Boolean).join(' ');\n}\n\nfunction updateRuntime() {\n    const now = Date.now();\n    const runtimeText = formatDuration(now - CREATE_TIME);\n    document.getElementById('runtime').textContent = `æœ¬ç«™å·²è¿è¡Œï¼š${runtimeText}`;\n}\n\n// ç‚¹å‡»äº‹ä»¶ç›‘å¬\ndocument.getElementById('runtime').addEventListener('click', () => {\n    currentFormat = (currentFormat + 1) % 4;\n    updateRuntime();\n});\n\n// åˆå§‹åŒ–\nupdateRuntime();\nsetInterval(updateRuntime, 1000);\n```\n\nå®ç°å‚è€ƒåŸé“¾æ¥å¦‚ä¸‹ï¼š\n\n{% link Leonus | åšå®¢åº•éƒ¨è¿è¡Œæ—¶é—´,https://blog.leonus.cn/2022/footer.html,https://q1.qlogo.cn/g?b=qq&nk=990320751&s=5 %}\n\n## å®ç°SWPPå’ŒPWA\n\nè¯¦ç»†æ•™ç¨‹å‚è€ƒé“¾æ¥å¦‚ä¸‹ï¼š\n\n{% link LiuShen | Hexoé…ç½®SWPPå®ç°PWA,https://blog.liushen.fun/posts/4355f2b3/,https://www.liushen.fun/assets/images/favicon.png %}\n\nåœ¨å®ç°PWAæ—¶éœ€è¦å¤„ç†ä¸åŒå°ºå¯¸çš„åšå®¢logoå›¾ç‰‡ï¼Œå¯ä»¥é€šè¿‡ä»¥ä¸‹çš„pythonè„šæœ¬è¿›è¡Œæ“ä½œï¼Œæ–¹ä¾¿å¿«æ·ã€‚\n\nåœ¨CMDä¸­å®‰è£…Pillowåº“ï¼Œå‰æç³»ç»Ÿä¸­å·²å®‰è£…pythonç¯å¢ƒã€‚\n\n```cmd\npip install Pillow\n```\n\nåˆ›å»º`img.py`æ–‡ä»¶ï¼Œå¼•å…¥ä»¥ä¸‹å†…å®¹ã€‚\n\n```python\n#!/usr/bin/env python3\nimport argparse\nimport os\nimport sys\nfrom PIL import Image\n\ndef main():\n    # åˆ›å»ºå‘½ä»¤è¡Œå‚æ•°è§£æå™¨\n    parser = argparse.ArgumentParser(description=\"å›¾ç‰‡å°ºå¯¸è°ƒæ•´å·¥å…·\")\n    \n    # æ·»åŠ å‚æ•°\n    parser.add_argument(\"input\", help=\"è¾“å…¥å›¾ç‰‡è·¯å¾„\")\n    parser.add_argument(\"-W\", \"--width\", type=int, help=\"ç›®æ ‡å®½åº¦\")\n    parser.add_argument(\"-H\", \"--height\", type=int, help=\"ç›®æ ‡é«˜åº¦\")\n    parser.add_argument(\"-p\", \"--percentage\", type=float, help=\"ç¼©æ”¾ç™¾åˆ†æ¯”\")\n    parser.add_argument(\"--no-maintain-aspect\", action=\"store_true\", help=\"ä¸ä¿æŒå®½é«˜æ¯”\")\n    parser.add_argument(\"-m\", \"--method\", default=\"LANCZOS\", \n                       choices=[\"NEAREST\", \"LANCZOS\", \"BILINEAR\", \"BICUBIC\", \"HAMMING\"],\n                       help=\"é‡é‡‡æ ·æ–¹æ³•\")\n    parser.add_argument(\"-q\", \"--quality\", type=int, default=85, help=\"è¾“å‡ºè´¨é‡ (1-100)\")\n    \n    # è§£æå‚æ•°\n    args = parser.parse_args()\n    \n    # éªŒè¯å‚æ•°\n    if not os.path.exists(args.input):\n        print(f\"é”™è¯¯: è¾“å…¥æ–‡ä»¶ä¸å­˜åœ¨: {args.input}\")\n        return 1\n    \n    if args.percentage is not None and (args.width is not None or args.height is not None):\n        print(\"é”™è¯¯: ä¸èƒ½åŒæ—¶æŒ‡å®šç™¾åˆ†æ¯”å’Œå…·ä½“å°ºå¯¸\")\n        return 1\n    \n    if args.percentage is None and args.width is None and args.height is None:\n        print(\"é”™è¯¯: å¿…é¡»æŒ‡å®šç¼©æ”¾ç™¾åˆ†æ¯”æˆ–ç›®æ ‡å°ºå¯¸\")\n        return 1\n    \n    # è¾“å‡ºæ–‡ä»¶ä¸è¾“å…¥æ–‡ä»¶ç›¸åŒ\n    output_path = args.input\n    \n    # å¤„ç†æ–‡ä»¶\n    try:\n        with Image.open(args.input) as img:\n            original_width, original_height = img.size\n            print(f\"åŸå§‹å›¾ç‰‡å°ºå¯¸: {original_width} x {original_height}\")\n            \n            if args.percentage is not None:\n                # æŒ‰ç™¾åˆ†æ¯”ç¼©æ”¾\n                new_width = int(original_width * args.percentage / 100)\n                new_height = int(original_height * args.percentage / 100)\n            else:\n                # æŒ‰æŒ‡å®šå°ºå¯¸ç¼©æ”¾\n                width = args.width or original_width\n                height = args.height or original_height\n                \n                if not args.no_maintain_aspect:\n                    # ä¿æŒå®½é«˜æ¯”\n                    ratio = min(width / original_width, height / original_height)\n                    new_width = int(original_width * ratio)\n                    new_height = int(original_height * ratio)\n                else:\n                    # ä¸ä¿æŒå®½é«˜æ¯”\n                    new_width, new_height = width, height\n            \n            # è·å–é‡é‡‡æ ·æ–¹æ³•\n            resample_method = getattr(Image, args.method, Image.LANCZOS)\n            \n            # è°ƒæ•´å°ºå¯¸\n            resized_img = img.resize((new_width, new_height), resample_method)\n            \n            # ä¿å­˜å›¾ç‰‡\n            if img.format == \"JPEG\":\n                resized_img.save(output_path, format=img.format, quality=args.quality)\n            else:\n                resized_img.save(output_path, format=img.format)\n            \n            print(f\"å·²å¤„ç†: {args.input} ({original_width}x{original_height} -> {new_width}x{new_height})\")\n            print(f\"å·²ä¿å­˜åˆ°: {output_path}\")\n            return 0\n    except Exception as e:\n        print(f\"å¤„ç†å›¾ç‰‡æ—¶å‡ºé”™: {e}\")\n        return 1\n\nif __name__ == \"__main__\":\n    sys.exit(main())\n```\n\nå…¶ä¸­æ¶‰åŠçš„é…ç½®é¡¹å‚æ•°å¦‚ä¸‹è¡¨ï¼š\n\n| å‚æ•°       | çŸ­å‚æ•° | é•¿å‚æ•°               | ç±»å‹   | é»˜è®¤å€¼  | å¯é€‰å€¼                                       | æè¿°                                  |\n| ---------- | ------ | -------------------- | ------ | ------- | -------------------------------------------- | ------------------------------------- |\n| è¾“å…¥å›¾æ ‡   | æ—      | input                | å­—ç¬¦ä¸² | å¿…éœ€    | æœ‰æ•ˆçš„æ–‡ä»¶è·¯å¾„                               | è¦å¤„ç†çš„å›¾ç‰‡æ–‡ä»¶è·¯å¾„                  |\n| ç›®æ ‡å®½åº¦   | -W     | --width              | æ•´æ•°   | æ—       | ä»»æ„æ­£æ•´æ•°                                   | è°ƒæ•´åçš„å›¾ç‰‡å®½åº¦ï¼ˆåƒç´ ï¼‰              |\n| ç›®æ ‡é«˜åº¦   | -H     | --height             | æ•´æ•°   | æ—       | ä»»æ„æ­£æ•´æ•°                                   | è°ƒæ•´åçš„å›¾ç‰‡é«˜åº¦ï¼ˆåƒç´ ï¼‰              |\n| ç¼©æ”¾ç™¾åˆ†æ¯” | -p     | --percentage         | æµ®ç‚¹æ•° | æ—       | ä»»æ„æ­£æ•°                                     | æŒ‰ç™¾åˆ†æ¯”ç¼©æ”¾å›¾ç‰‡ï¼ˆå¦‚50è¡¨ç¤ºç¼©å°åˆ°50%ï¼‰ |\n| å®½é«˜æ¯”é€‰é¡¹ | æ—      | --no-maintain-aspect | å¸ƒå°”   | False   | True/False                                   | æ˜¯å¦ä¿æŒåŸå§‹å®½é«˜æ¯”ï¼ˆé»˜è®¤ä¿æŒï¼‰        |\n| é‡é‡‡æ ·æ–¹æ³• | -m     | --method             | å­—ç¬¦ä¸² | LANCZOS | NEAREST, LANCZOS, BILINEAR, BICUBIC, HAMMING | å›¾ç‰‡ç¼©æ”¾æ—¶ä½¿ç”¨çš„é‡é‡‡æ ·ç®—æ³•            |\n| è¾“å‡ºè´¨é‡   | -q     | --quality            | æ•´æ•°   | 85      | 1-100                                        | è¾“å‡ºå›¾ç‰‡çš„è´¨é‡ï¼ˆä»…å¯¹JPEGæ ¼å¼æœ‰æ•ˆï¼‰    |\n\nä½¿ç”¨ç¤ºä¾‹å¦‚ä¸‹ï¼š\n\n```cmd\n# æŒ‰æŒ‡å®šå°ºå¯¸è°ƒæ•´ï¼ˆä¿æŒå®½é«˜æ¯”ï¼‰\npython img.py input.jpg -W 800 -H 600\n\n# æŒ‰æŒ‡å®šå°ºå¯¸è°ƒæ•´ï¼ˆä¸ä¿æŒå®½é«˜æ¯”ï¼‰\npython img.py input.jpg -W 800 -H 600 --no-maintain-aspect\n\n# æŒ‰ç™¾åˆ†æ¯”ç¼©æ”¾\npython img.py input.jpg -p 50\n\n# æŒ‡å®šé‡é‡‡æ ·æ–¹æ³•å’Œè´¨é‡\npython img.py input.jpg -W 800 -H 600 -m BICUBIC -q 95\n```\n\n## gulpå‹ç¼©åšå®¢é™æ€èµ„æº\n\nè¯¦ç»†æ•™ç¨‹å‚è€ƒé“¾æ¥å¦‚ä¸‹ï¼š\n\n{% link Akilarã®ç³–æœå±‹ | ä½¿ç”¨gulpå‹ç¼©åšå®¢é™æ€èµ„æº,https://akilar.top/posts/49b73b87/,https://npm.elemecdn.com/akiblog@1.0.2/img/siteicon/favicon.png %}\n\n## Pageå’ŒPosté¡µé¢å®½åº¦\n\nåœ¨`blog\\source\\css`çš„cssæ–‡ä»¶ä¸­åŠ å…¥ä»¥ä¸‹å†…å®¹ã€‚\n\n```css\n/* é’ˆå¯¹æ‰€æœ‰ Page ç±»å‹çš„é¡µé¢ï¼Œå°†å¸ƒå±€å®¹å™¨çš„æœ€å¤§å®½åº¦è®¾ä¸º 100% */\n.page .layout {\n  max-width: 100% !important;\n  padding: 40px 5% !important; \n}\n\n/* é’ˆå¯¹æ‰€æœ‰ Post ç±»å‹çš„é¡µé¢ï¼Œå°†å¸ƒå±€å®¹å™¨çš„æœ€å¤§å®½åº¦è®¾ä¸º 100% */\n.post .layout {\n  max-width: 100% !important;\n  padding: 40px 5% !important; \n}\n\n/* åœ¨å°å±å¹•ä¸‹ï¼Œæ¢å¤åŸå§‹çš„è¾ƒå°è¾¹è· */\n@media (max-width: 768px) {\n  .page .layout {\n    padding: 20px 5px !important;\n  }\n  .post .layout {\n  padding: 20px 5% !important; \n  }\n}\n```\n\n{% folding green open,åšå®¢æ­å»ºç³»åˆ—æ–‡ç«  %}\n\n{% series åšå®¢æ­å»ºæ•™ç¨‹ %}\n\n{% endfolding %}\n","tags":["Hexo","åšå®¢æ•™ç¨‹","Butterfly"],"categories":["åšå®¢æ•™ç¨‹","åšå®¢æ­å»º"]},{"title":"Hexo-Butterflyç¾åŒ–æ•™ç¨‹-[5]å®‰è£…å¸¸ç”¨æ’ä»¶","url":"/yyg/23010111/","content":"\n## å‰è¨€\n\nä»¥ä¸‹æ˜¯å°ç«™å»ºè®¾è¿‡ç¨‹ä¸­ç”¨åˆ°çš„ä¸€äº›å¸¸ç”¨æ’ä»¶\n\n## å›¾ç‰‡è·¯å¾„è½¬asset_img\n\nå°† markdown å›¾åƒè·¯å¾„è½¬æ¢ä¸º asset_img è¯­æ³•ï¼Œä½¿å›¾åƒåœ¨ typora å’Œ hexo ä¸­éƒ½æ˜¾ç¤ºã€‚\n\nåœ¨blogç›®å½•ä¸‹çš„å‘½ä»¤æŒ‡ç¤ºç¬¦ä¸­æ‰§è¡Œï¼š\n\n```shell\nnpm install hexo-image-link --save\n```\n\nåœ¨blogç›®å½•ä¸‹çš„`_config.yml`æ–‡ä»¶ä¸­ä¿®æ”¹ä»¥ä¸‹å†…å®¹ï¼š\n\n```yaml\npost_asset_folder: true\n```\n\n## Hexoçš„Gitæ¨é€æ’ä»¶\n\n```shell\nnpm install hexo-deployer-git --save\n```\n\nåœ¨blogç›®å½•ä¸‹çš„`_config.yml`æ–‡ä»¶ä¸­ä¿®æ”¹å¹¶åŠ å…¥å†…å®¹ï¼š\n\n```yaml\ndeploy:\n  type: 'git'\n  repository: #ä»“åº“åœ°å€\n  branch: main #ä¸€èˆ¬ä¸ºmainã€master\n```\n\n## æ°¸ä¹…é“¾æ¥\n\nåœ¨blogç›®å½•ä¸‹çš„å‘½ä»¤æŒ‡ç¤ºç¬¦ä¸­æ‰§è¡Œï¼š\n\n```shell\nnpm install hexo-abbrlink --save\n```\n\nåœ¨blogç›®å½•ä¸‹çš„`_config.yml`æ–‡ä»¶ä¸­ä¿®æ”¹å¹¶åŠ å…¥å†…å®¹ï¼š\n\n```yaml\n#ä¿®æ”¹å†…å®¹\npermalink: posts/:abbrlink/\npermalink_defaults:\n#åŠ å…¥å†…å®¹\nabbrlink:\n  alg: crc32      # ä½¿ç”¨ CRC32 ç®—æ³•ï¼ˆç”Ÿæˆ 8 å­—ç¬¦é•¿é“¾ï¼‰\n  rep: hex        # é“¾æ¥æ ¼å¼ä¸ºåå…­è¿›åˆ¶ï¼ˆå¦‚ \"abc123\"ï¼‰\n  drafts: false   # ä¸ä¸ºè‰ç¨¿ç”ŸæˆçŸ­é“¾\n  force: false    # ä¸å¼ºåˆ¶é‡æ–°ç”Ÿæˆå·²æœ‰çŸ­é“¾çš„æ–‡ç« \n  writeback: true # å°†çŸ­é“¾å†™å…¥æ–‡ç« çš„ Front Matter\n```\n\n> å…¶ä¸­å¾—åˆ°postså¯è‡ªå®šä¹‰æ›¿æ¢\n\n## æ–‡ç« åŠ å¯†\n\nåœ¨blogç›®å½•ä¸‹çš„å‘½ä»¤æŒ‡ç¤ºç¬¦ä¸­æ‰§è¡Œï¼š\n\n```shell\nnpm install --save hexo-blog-encrypt\n```\n\nåœ¨è¦åŠ å¯†çš„æ–‡ç« é¡µé¢çš„Front-matteréƒ¨åˆ†åŠ å…¥ä»¥ä¸‹å†…å®¹ï¼š\n\n```markdown\npassword: xxxxxx\nabstract: æœ‰ä¸œè¥¿è¢«åŠ å¯†äº†, è¯·è¾“å…¥å¯†ç æŸ¥çœ‹.\nmessage: æ‚¨å¥½, è¿™é‡Œéœ€è¦å¯†ç .\ntheme: Shrink\nwrong_pass_message: æŠ±æ­‰, è¿™ä¸ªå¯†ç çœ‹ç€ä¸å¤ªå¯¹, è¯·å†è¯•è¯•.\nwrong_hash_message: æŠ±æ­‰, è¿™ä¸ªæ–‡ç« ä¸èƒ½è¢«æ ¡éªŒ, ä¸è¿‡æ‚¨è¿˜æ˜¯èƒ½çœ‹çœ‹è§£å¯†åçš„å†…å®¹.\n```\n\nåœ¨blogç›®å½•ä¸‹çš„`_config.yml`æ–‡ä»¶ä¸­æ·»åŠ ä»¥ä¸‹å†…å®¹ï¼š\n\n```yaml\n#æ–‡ç« åŠ å¯†\nencrypt: # hexo-blog-encrypt\n  abstract: æœ‰ä¸œè¥¿è¢«åŠ å¯†äº†, è¯·è¾“å…¥å¯†ç æŸ¥çœ‹.\n  message: æ‚¨å¥½, è¿™é‡Œéœ€è¦å¯†ç .\n  tags:\n  - {name: æ€»ç»“, password: xxxxxx}\n  wrong_pass_message: æŠ±æ­‰, è¿™ä¸ªå¯†ç çœ‹ç€ä¸å¤ªå¯¹, è¯·å†è¯•è¯•.\n  wrong_hash_message: æŠ±æ­‰, è¿™ä¸ªæ–‡ç« ä¸èƒ½è¢«æ ¡éªŒ, ä¸è¿‡æ‚¨è¿˜æ˜¯èƒ½çœ‹çœ‹è§£å¯†åçš„å†…å®¹.\n```\n\n> password: è‡ªå®šä¹‰è®¾ç½®çš„å¯†ç å€¼\n>\n> theme: Shrink åŠ å¯†æ–‡ä»¶æ˜¾ç¤ºçš„ä¸»é¢˜\n>\n> abstract: ç”¨äºè®¾ç½®åŠ å¯†æ–‡ç« æ˜¾ç¤ºçš„æ‘˜è¦ã€‚\n>\n> message: è¾“å…¥å¯†ç æç¤ºã€‚\n>\n> wrong_pass_message: è¾“å…¥é”™è¯¯æç¤ºã€‚\n>\n> wrong_hash_message: æ ¡éªŒé”™è¯¯æç¤ºã€‚\n\n## è½®æ’­å›¾ç½®é¡¶æ–‡ç« \n\nåœ¨blogç›®å½•ä¸‹çš„å‘½ä»¤æŒ‡ç¤ºç¬¦ä¸­æ‰§è¡Œï¼š\n\n```shell\nnpm install hexo-butterfly-swiper --save\n```\n\nåœ¨blogç›®å½•ä¸‹çš„`_config.yml`æ–‡ä»¶ä¸­ä¿®æ”¹å¹¶åŠ å…¥å†…å®¹ï¼š\n\n```yaml\n# è½®æ’­æ–‡ç« ç½®é¡¶\n# see https://akilar.top/posts/8e1264d1/\nswiper:\n  enable: true # å¼€å…³\n  priority: 5 #è¿‡æ»¤å™¨ä¼˜å…ˆæƒ\n  enable_page: all # åº”ç”¨é¡µé¢\n  timemode: date #date/updated\n  layout: # æŒ‚è½½å®¹å™¨ç±»å‹\n    type: id\n    name: recent-posts\n    index: 0\n  default_descr: ç‚¹å‡»æŸ¥çœ‹ç½®é¡¶æ–‡ç« å•¦~~~\n  swiper_css: https://npm.elemecdn.com/hexo-butterfly-swiper/lib/swiper.min.css #swiper cssä¾èµ–\n  swiper_js: https://npm.elemecdn.com/hexo-butterfly-swiper/lib/swiper.min.js #swiper jsä¾èµ–\n  custom_css: https://npm.elemecdn.com/hexo-butterfly-swiper/lib/swiperstyle.css # é€‚é…ä¸»é¢˜æ ·å¼è¡¥ä¸\n  custom_js: https://npm.elemecdn.com/hexo-butterfly-swiper/lib/swiper_init.js # swiperåˆå§‹åŒ–æ–¹æ³•\n```\n\nåœ¨è¦è½®æ’­çš„æ–‡ç« é¡µé¢çš„Front-matteréƒ¨åˆ†åŠ å…¥ä»¥ä¸‹å†…å®¹ï¼š\n\n```markdown\nswiper_index: 1 #ç½®é¡¶è½®æ’­å›¾é¡ºåºï¼Œéè´Ÿæ•´æ•°ï¼Œæ•°å­—è¶Šå¤§è¶Šé å‰\n```\n\n## æ–‡ç« ç½®é¡¶å’Œéšè—\n\nåœ¨blogç›®å½•ä¸‹çš„å‘½ä»¤æŒ‡ç¤ºç¬¦ä¸­æ‰§è¡Œï¼š\n\n```shell\nnpm install hexo-generator-index --save\n```\n\nåœ¨æ–‡ç« é¡µé¢çš„Front-matteréƒ¨åˆ†æ·»åŠ  sticky æˆ– top å‚æ•°ï¼ˆsticky çš„ä¼˜å…ˆçº§æ¯” top é«˜ï¼‰ï¼Œå¯ä»¥ç½®é¡¶æ–‡ç« ï¼Œæ·»åŠ hideå‚æ•°éšè—æ–‡ç« ã€‚\n\n```markdown\n#ç½®é¡¶æ–¹å¼æœ‰ä¸¤ç§stickyæˆ–topï¼Œæ•°å­—è¶Šå¤§ä¼˜å…ˆçº§è¶Šè€ƒå‰\nsticky: æ•°å­—\ntop: æ•°å­—\n#éšè—\nhide: true\n```\n\n## å­—æ•°ç»Ÿè®¡\n\nåœ¨blogç›®å½•ä¸‹çš„å‘½ä»¤æŒ‡ç¤ºç¬¦ä¸­æ‰§è¡Œï¼š\n\n```shell\nnpm install hexo-wordcount --save\n```\n\nåœ¨blogç›®å½•ä¸‹çš„`_config.butterfly.yml`æ–‡ä»¶ä¸­å¼€å¯å­—æ•°ç»Ÿè®¡ã€‚\n\n```yaml\nwordcount:\n  enable: true\n```\n\n## æœ¬åœ°æœç´¢\n\nåœ¨blogç›®å½•ä¸‹çš„å‘½ä»¤æŒ‡ç¤ºç¬¦ä¸­æ‰§è¡Œï¼š\n\n```shell\nnpm install hexo-generator-search --save\n```\n\nåœ¨blogç›®å½•ä¸‹çš„`_config.yml`æ–‡ä»¶ä¸­ä¿®æ”¹å¹¶åŠ å…¥å†…å®¹ï¼š\n\n```yaml\n#æœ¬åœ°æœç´¢\nsearch:\n  path: search.json\n  field: post\n  content: true\n  format: striptags\n```\n\n> - **path** - ç”Ÿæˆçš„æ•°æ®åº“æ–‡ä»¶çš„è·¯å¾„ã€‚æ”¯æŒå’Œæ ¼å¼ã€‚å¦‚æœæœªæä¾›æ–‡ä»¶æ‰©å±•åï¼Œåˆ™é»˜è®¤ä½¿ç”¨ JSON æ ¼å¼\n> - **field** - è¦æœç´¢çš„æœç´¢èŒƒå›´ï¼Œæ‚¨å¯ä»¥é€‰æ‹©ï¼š\n>   - **post** ï¼ˆé»˜è®¤ï¼‰ - å°†ä»…æ¶µç›–æ‚¨åšå®¢çš„æ‰€æœ‰æ–‡ç« ã€‚\n>   - **page** - å°†ä»…è¦†ç›–æ‚¨åšå®¢çš„æ‰€æœ‰é¡µé¢ã€‚\n>   - **all** - å°†è¦†ç›–æ‚¨åšå®¢çš„æ‰€æœ‰å¸–å­å’Œé¡µé¢ã€‚\n> - content - æ˜¯å¦åŒ…å«æ¯ç¯‡æ–‡ç« çš„å…¨éƒ¨å†…å®¹ã€‚å¦‚æœ ï¼Œç”Ÿæˆçš„ç»“æœä»…æ¶µç›–æ ‡é¢˜å’Œå…¶ä»–å…ƒä¿¡æ¯ï¼Œè€Œä¸æ¶µç›–ä¸»ä½“\n> -  format - é¡µé¢å†…å®¹çš„å½¢å¼ï¼Œé€‰é¡¹æœ‰ï¼š\n>   - **striptags** ï¼ˆé»˜è®¤ï¼‰ç¼©å°åŸå§‹ html å­—ç¬¦ä¸²ï¼Œå¹¶åˆ é™¤æ‰€æœ‰æ ‡ç­¾ã€‚\n>   - **html** - æ­£åœ¨ç¼©å°çš„åŸå§‹ html å­—ç¬¦ä¸²ã€‚\n>   - **raw** - æ¯ä¸ªå¸–å­æˆ–é¡µé¢çš„ Markdown æ–‡æœ¬ã€‚\n\nåœ¨blogç›®å½•ä¸‹çš„`_config.butterfly.yml`æ–‡ä»¶ä¸­å¼€å¯æœ¬åœ°æœç´¢ã€‚\n\n```yaml\n#æœç´¢\nsearch:\n  use: local_search\n  placeholder: æœç´¢æ–‡ç« \n\n  local_search:\n    preload: false\n    top_n_per_article: -1\n    unescape: false\n    CDN:\n```\n\n## æ·»åŠ RSS\n\n{% note pink 'fas fa-bullhorn' flat %}\n\n2025-10-10 æ›´æ–°è®°å½•ï¼šæ›´æ¢RSSæ’ä»¶`hexo-pretty-feed` ï¼Œç¾åŒ–RSSè®¢é˜…åœ°å€ã€‚\n\n{% endnote %}\n\nåœ¨blogç›®å½•ä¸‹çš„å‘½ä»¤æŒ‡ç¤ºç¬¦ä¸­æ‰§è¡Œï¼š\n\n{% tabs  %}\n\n<!-- tab ï¼ˆæ–°ï¼‰hexo-pretty-feed @fas fa-lightbulb -->\n\n```cmd\nnpm install hexo-pretty-feed --save\n```\n\nRSSç¾åŒ–è¯¦ç»†æ•™ç¨‹å‚è€ƒé“¾æ¥å¦‚ä¸‹ï¼š\n\n{% link LiuShen | ç¾åŒ–ä½ çš„RSSè®¢é˜…åœ°å€,https://blog.liushen.fun/posts/caee2d9f/,https://www.liushen.fun/assets/images/favicon.png %}\n\nç¾åŒ–æ•ˆæœå›¾å¦‚ä¸‹ï¼š\n{% tabs  %}\n<!-- tab æµ…è‰²æ¨¡å¼ @fas fa-sun -->\n![img](Hexo-Butterflyç¾åŒ–æ•™ç¨‹[5]-å®‰è£…å¸¸ç”¨æ’ä»¶/2.png)\n<!-- endtab -->\n\n<!-- tab æ·±è‰²æ¨¡å¼ @fas fa-moon -->\n![img](Hexo-Butterflyç¾åŒ–æ•™ç¨‹[5]-å®‰è£…å¸¸ç”¨æ’ä»¶/1.png)\n<!-- endtab -->\n\n{% endtabs %}\n\n\n<!-- endtab -->\n\n<!-- tab ï¼ˆæ—§ï¼‰hexo-generator-feed @fas fa-history -->\n\n```cmd\nnpm install hexo-generator-feed --save\n```\n\n<!-- endtab --> \n\n{% endtabs %}\n\nåœ¨blogç›®å½•ä¸‹çš„`_config.yml`æ–‡ä»¶ä¸­ä¿®æ”¹å¹¶åŠ å…¥å†…å®¹ï¼š\n\n```yaml\n# RSS\nfeed:\n    enable: true\n    type: rss2\n    path: rss2.xml\n    limit: 20\n    hub:\n    content: \n    content_limit: 300\n    content_limit_delim: ' '\n    order_by: -date \n    icon: icon.png\n    autodiscovery: true \n    pretty_rss2_file: rss2.xsl  #æ–°å¢ç¾åŒ–æ–‡ä»¶\n    template: \n```\n\n> - **type** - atomå’Œrss2ä¸¤ç§ç±»å‹\n>\n> - **path** - æºè·¯å¾„ã€‚å½“åŒæ—¶æŒ‡å®šäº†è¿™ä¸¤ç§ç±»å‹æ—¶ã€‚ï¼ˆé»˜è®¤å€¼ï¼šatom.xml/rss2.xmlï¼‰\n>\n> - **limit** - æºä¸­çš„æœ€å¤§å¸–å­æ•°ï¼ˆä½¿ç”¨ or æ˜¾ç¤ºæ‰€æœ‰å¸–å­ï¼‰`0 false`\n>\n> - **hub** - PubSubHubbub ä¸­å¿ƒçš„ URLï¼ˆå¦‚æœä¸ä½¿ç”¨å®ƒï¼Œè¯·å°†å…¶ç•™ç©ºï¼‰\n>\n> - **content** -ï¼ˆå¯é€‰ï¼‰è®¾ç½®ä¸º 'true' ä»¥åœ¨æºä¸­åŒ…å«æ•´ä¸ªæ–‡ç« çš„å†…å®¹ã€‚\n>\n> - **content_limit** -ï¼ˆå¯é€‰ï¼‰æ‘˜è¦ä¸­ä½¿ç”¨çš„æ–‡ç« å†…å®¹çš„é»˜è®¤é•¿åº¦ã€‚ä»…å½“**å†…å®¹**è®¾ç½®ä¸º false ä¸”ä¸å­˜åœ¨è‡ªå®šä¹‰æ–‡ç« æè¿°æ—¶æ‰ä½¿ç”¨ã€‚\n>\n> - **content_limit_delim** -ï¼ˆå¯é€‰ï¼‰å¦‚æœä½¿ç”¨ **content_limit** æ¥ç¼©çŸ­å¸–å­å†…å®¹ï¼Œåˆ™ä»…åœ¨è¾¾åˆ°å­—ç¬¦é™åˆ¶ä¹‹å‰æœ€åä¸€æ¬¡å‡ºç°æ­¤åˆ†éš”ç¬¦æ—¶è¿›è¡Œå‰ªåˆ‡ã€‚é»˜è®¤æƒ…å†µä¸‹ä¸ä½¿ç”¨ã€‚\n>\n> - **order_by** - Feed æ’åºä¾æ®ã€‚ï¼ˆé»˜è®¤å€¼ï¼š-dateï¼‰\n>\n> - **å›¾æ ‡** -ï¼ˆå¯é€‰ï¼‰è‡ªå®šä¹‰æºå›¾æ ‡ã€‚é»˜è®¤ä¸ºä¸»é…ç½®ä¸­æŒ‡å®šçš„ email çš„ gravatarã€‚\n>\n> - **autodiscovery** - è‡ªåŠ¨å‘ç°æ·»åŠ æºã€‚é»˜è®¤ä¸ºtrue\n>\n> - template - è‡ªå®šä¹‰æ¨¡æ¿è·¯å¾„ã€‚æ­¤æ–‡ä»¶å°†ç”¨äºç”Ÿæˆæº xml æ–‡ä»¶ï¼Œå¯ä»¥åªæŒ‡å®šä¸€ä¸ªè‡ªå®šä¹‰æ¨¡æ¿ï¼Œå³ä½¿æ­¤æ’ä»¶é…ç½®ä¸ºè¾“å‡ºä¸¤ç§ Feed ç±»å‹ã€‚\n>\n> - **`pretty_atom_file`** - æ’å…¥ Atom Feed é¡¶éƒ¨çš„æ ·å¼æ–‡ä»¶è·¯å¾„ï¼ˆå¦‚ï¼šXSL æ–‡ä»¶ï¼‰ï¼Œå»ºè®®ä½¿ç”¨ç›¸å¯¹è·¯å¾„ã€‚ç•™ç©ºåˆ™ä¸æ’å…¥ã€‚ `#æ–°å¢`\n>\n> - **`pretty_rss2_file`** - æ’å…¥ RSS2 Feed é¡¶éƒ¨çš„æ ·å¼æ–‡ä»¶è·¯å¾„ã€‚ç•™ç©ºåˆ™ä¸æ’å…¥ã€‚ `#æ–°å¢`\n\nåœ¨blogç›®å½•ä¸‹çš„`_config.butterfly.yml`æ–‡ä»¶ä¸­æ·»åŠ rssè·¯å¾„ã€‚\n\n```yaml\nrss: /rss2.xml\n```\n\n{% folding green open,åšå®¢æ­å»ºç³»åˆ—æ–‡ç«  %}\n\n{% series åšå®¢æ­å»ºæ•™ç¨‹ %}\n\n{% endfolding %}\n","tags":["Hexo","åšå®¢æ•™ç¨‹","Butterfly"],"categories":["åšå®¢æ•™ç¨‹","åšå®¢æ­å»º"]},{"title":"Hexo-Butterflyç¾åŒ–æ•™ç¨‹-[4]ä¿®æ”¹é…ç½®æ–‡ä»¶","url":"/yyg/8a5ee3aa/","content":"\n## Hexoé…ç½®æ–‡ä»¶(_config.yml)\n\næ‰“å¼€blogç›®å½•ä¸‹çš„Hexoçš„é…ç½®æ–‡ä»¶ `_config.yml`ï¼Œè¿›è¡Œè‡ªå®šä¹‰é…ç½®ã€‚ï¼ˆä»¥ä¸‹æ˜¾ç¤ºæ˜¯é€šç”¨é…ç½®ï¼‰\n\n```yaml\nlanguage: zh-CN\ntimezone: 'Asia/Shanghai'\n\ndeploy:\n  type: 'git'\n  repository: #ä»“åº“åœ°å€\n  branch: main #åˆ†æ”¯ä¸€èˆ¬æ˜¯masterã€main\n\n```\n\n## Butterflyé…ç½®æ–‡ä»¶(_config.butterfly.yml)\n\næ‰“å¼€blogç›®å½•ä¸‹çš„Butterflyé…ç½®æ–‡ä»¶`_config.butterfly.yml`ï¼Œè¿›è¡Œè‡ªå®šä¹‰ä¿®æ”¹é…ç½®ã€‚ï¼ˆä»¥ä¸‹æ˜¾ç¤ºæ˜¯é€šç”¨é…ç½®ï¼‰\n\n```yaml\nnav:\n  logo: #å·¦ä¸Šè§’å¤´åƒåœ°å€\n#é¡µé¢icon  \nfavicon: #å¤´åƒåœ°å€\n#ä¾§è¾¹æ å¤„å¤´åƒ\navatar:\n  img: #å¤´åƒåœ°å€\n  effect: false\n#é¦–é¡µèƒŒæ™¯å›¾\nindex_img:\n#æ–‡ç« å¡ç‰‡é»˜è®¤æ˜¾ç¤ºå›¾ï¼Œå¯å¤šä¸ª\n  default_cover:\n  \npost_meta:\n  # Home Page\n  page:\n    # Choose: created / updated / both\n    date_type: both #æ˜¾ç¤ºæ–‡ç« çš„åˆ›å»ºå’Œæ›´æ–°æ—¶é—´\n    # Choose: date / relative\n    date_format: date\n    updated: 2025-07-05 19:19:52\rcategories: true\n    tags: false\n    label: true\n  post:\n    # Choose: left / center\n    position: center #æ–‡ç« é¡µmetaä¿¡æ¯å±…ä¸­æ˜¾ç¤º\n    # Choose: created / updated / both\n    date_type: both\n    # Choose: date / relative\n    date_format: date\n    updated: 2025-07-05 19:19:52\rcategories: true\n    tags: true\n    label: true\n    \n#é¦–é¡µå¡ç‰‡åŒæ å¸ƒå±€\nindex_layout: 7\n#é€‰æ‹©é¦–é¡µå¡ç‰‡åŒæ å¸ƒå±€æ—¶ï¼Œå…³é—­ä¸»é¡µæ–‡ç« èŠ‚é€‰ï¼Œä¸ä¼šå‡ºç°å¡ç‰‡æ··ä¹±çš„æƒ…å†µ\nindex_post_content:\n  method: false\n  \n#å±•ç¤ºæ–‡ç« ç‰ˆæƒå’Œè®¸å¯åè®®\npost_copyright:\n  enable: true\n  decode: false\n  author_href: #ç½‘ç«™åœ°å€\n  license: CC BY-NC-SA 4.0\n  license_url: https://creativecommons.org/licenses/by-nc-sa/4.0/\n  \n#æ–‡ç« åˆ†é¡µï¼Œä¸‹ä¸€ç¯‡ä¸ºæ–°æ–‡ç« \npost_pagination: 2\n\n#é¡µè„šä¿¡æ¯\nfooter:\n  owner:\n    enable: true\n    since: #å¹´ä»½\n  custom_text: #è‡ªå®šä¹‰\n  # Copyright of theme and framework\n  copyright: false\n  \n#ä¾§è¾¹æ \naside:\n  enable: true\n  hide: false\n  button: true\n  mobile: true\n  #ä¾§è¾¹æ ä½ç½®\n  position: right\n  display:\n    archive: false\n    tag: true\n    category: true\n  card_author:\n    enable: true\n    description:\n    #å…³é—­å¤´åƒä¸‹çš„githubæŒ‰é’®\n    button:\n      enable: false\n      icon: fab fa-github\n      text: Follow Me\n      link: https://xxxxxxx\n   #å…³é—­é€šå‘Š\n  card_announcement:\n    enable: false\n    content: This is my Blog\n  card_recent_post:\n    enable: true\n    limit: 5\n    sort: date\n    sort_order:\n  card_newest_comments:\n    enable: false\n    sort_order:\n    limit: 6\n    storage: 10\n    avatar: true\n  card_updated: 2025-07-05 19:19:52\rcategories:\n    enable: true\n    limit: 8\n    expand: none\n    sort_order:\n  card_tags:\n    enable: true\n    limit: 10\n    #æ ‡ç­¾æ˜¾ç¤ºé¢œè‰²\n    color: true\n    orderby: random\n   #å‡åºæ’åº\n    order: 1\n    sort_order:\n  card_archives:\n    enable: true\n    type: monthly\n    #YYYYå¹´MMæœˆ\n    format: YYYY MMMM\n    order: -1\n    limit: 8\n    sort_order:\n  #ç³»åˆ—æ–‡ç« å¡ç‰‡\n  card_post_series:\n    enable: true\n    series_title: true\n   #æŒ‰æ ‡é¢˜æ’åº\n    orderBy: 'title'\n    #å‡åº\n    order: 1\n  card_webinfo:\n    enable: true\n    post_count: true\n    last_push_date: true\n    sort_order:\n    #ç½‘ç«™å¼€å§‹è¿è¡Œæ—¶é—´\n    runtime_date:\n \n #ç³»åˆ—æ–‡ç« \n series:\n  enable: true\n  orderBy: 'title'\n  order: 1\n  number: true   \n  \n #æ»šåŠ¨ç™¾åˆ†æ¯”æ˜¾ç¤º\n rightside_scroll_percent: true\n #å­—æ•°ç»Ÿè®¡\n wordcount:\n   enable: true\n   \n#æœç´¢\nsearch:\n  use: local_search\n  placeholder: æœç´¢æ–‡ç« \n\n\n  local_search:\n    preload: false\n    top_n_per_article: -1\n    unescape: false\n    CDN:\n#è¯„è®ºé…ç½®é€‰æ‹©Giscus\ncomments:\n  use: Giscus\n  text: true\n  lazyload: false\n  count: true\n  card_post_count: true\n  \n  \ngiscus:\n  repo: #ä»“åº“åœ°å€\n  repo_id: #giscusä»“åº“id\n  category_id: ##giscus categoryçš„id\n  theme:\n    light: light\n    dark: dark\n  option:\n     data-lang: zh-CN #è®¾ç½®ä¸­æ–‡æ˜¾ç¤º\n     data-input-position: bottom \n     \n#é¡µé¢ç¾åŒ–\nbeautify:\n  enable: true\n  field: post\n  title_prefix_icon: '\\f0c1'\n  title_prefix_icon_color: '#F47466'\n  \n#ä¸»é¡µsubtitle\nsubtitle:\n  enable: true\n  effect: true\n  typed_option:\n  source: 1 #ä¸€è¨€\n  sub: #è‡ªå®šä¹‰\n#å›¾ç‰‡å¤§å›¾æŸ¥çœ‹æ¨¡å¼\nlightbox: fancybox\n\n#Mermaid\nmermaid:\n  enable: true\n  code_write: true\n  theme:\n    light: default\n    dark: dark\n   \n# å›¾ç‰‡æ‡’åŠ è½½\nlazyload:\n  enable: true\n  field: site # site/post\n  placeholder:\n  blur: false\n\n```\n\nButterflyé…ç½®æ–‡ä»¶è¯¦ç»†é…ç½®è§å®˜æ–¹æ–‡ç« ï¼ŒåŸé“¾æ¥å¦‚ä¸‹ï¼š\n\n{% link Jerry | Butterfly æ–‡æ¡£(ä¸‰) ä¸»é¢˜é…ç½®,https://butterfly.js.org/posts/4aa8abbe,https://butterfly.js.org/img/butterfly-icon.png %}\n\n{% folding green open,åšå®¢æ­å»ºç³»åˆ—æ–‡ç«  %}\n\n{% series åšå®¢æ­å»ºæ•™ç¨‹ %}\n\n{% endfolding %}","tags":["Hexo","åšå®¢æ•™ç¨‹","Butterfly"],"categories":["åšå®¢æ•™ç¨‹","åšå®¢æ­å»º"]},{"title":"Hexo-Butterflyç¾åŒ–æ•™ç¨‹-[3]å»ºä¸»è¦é¡µé¢","url":"/yyg/b2261cee/","content":"\n## å®‰è£…Tag Plugins Plus æ ‡ç­¾å¤–æŒ‚æ’ä»¶\n\n> å®‰è£…æ ‡ç­¾å¤–æŒ‚æ’ä»¶ï¼Œæ–¹ä¾¿ä¹‹åå„ä¸»è¦é¡µé¢é…ç½®ä½¿ç”¨\n\n```shell\nnpm install hexo-butterfly-tag-plugins-plus --save\n```\n\nmarkdown æ¸²æŸ“æ’ä»¶ hexo-renderer-marked ä¸å¤–æŒ‚æ ‡ç­¾è¯­æ³•çš„å…¼å®¹æ€§è¾ƒå·®ï¼Œå°†å…¶æ›¿æ¢æˆ hexo-renderer-kramed\n\n```shell\nnpm uninstall hexo-renderer-marked --save\nnpm install hexo-renderer-kramed --save\n```\n\nåœ¨hexoçš„é…ç½®æ–‡ä»¶ `_config.yml` ä¸­ï¼Œæ·»åŠ tag_pluginsé…ç½®ä¿¡æ¯\n\n```yaml\n# tag-plugins-plus\n# see https://akilar.top/posts/615e2dec/\ntag_plugins:\n  enable: true # å¼€å…³\n  priority: 5 #è¿‡æ»¤å™¨ä¼˜å…ˆæƒ\n  issues: false #issuesæ ‡ç­¾ä¾èµ–æ³¨å…¥å¼€å…³\n  link:\n    placeholder: https://cdn.pixabay.com/photo/2022/07/08/10/37/books-7309019_960_720.png #link_cardæ ‡ç­¾é»˜è®¤çš„å›¾æ ‡å›¾ç‰‡\n  CDN:\n    anima: https://npm.elemecdn.com/hexo-butterfly-tag-plugins-plus@latest/lib/assets/font-awesome-animation.min.css #åŠ¨ç”»æ ‡ç­¾animaçš„ä¾èµ–\n    jquery: https://npm.elemecdn.com/jquery@latest/dist/jquery.min.js #issuesæ ‡ç­¾ä¾èµ–\n    issues: https://npm.elemecdn.com/hexo-butterfly-tag-plugins-plus@latest/lib/assets/issues.js #issuesæ ‡ç­¾ä¾èµ–\n    iconfont: //at.alicdn.com/t/font_2032782_8d5kxvn09md.js #å‚çœ‹https://akilar.top/posts/d2ebecef/\n    carousel: https://npm.elemecdn.com/hexo-butterfly-tag-plugins-plus@latest/lib/assets/carousel-touch.js\n    tag_plugins_css: https://npm.elemecdn.com/hexo-butterfly-tag-plugins-plus@latest/lib/tag_plugins.css\n```\n\n## æ ‡ç­¾é¡µ\n\nåœ¨`blog`æ ¹ç›®å½•ä¸‹æ‰“å¼€å‘½åæŒ‡ç¤ºç¬¦ï¼Œè¾“å…¥å¦‚ä¸‹å‘½ä»¤åˆ›å»ºæ ‡ç­¾é¡µã€‚\n\n```shell\nhexo new page tags\n```\n\næ‰“å¼€`blog\\source\\tags`ç›®å½•ä¸‹çš„index.mdæ–‡ä»¶ï¼Œåœ¨Front-matteréƒ¨åˆ†åŠ å…¥ä»¥ä¸‹å†…å®¹ã€‚\n\n```markdown\ntype: \"tags\"\norderby: random\ntop_img: false\norder: 1\ncomments: false\naside: false\n```\n\n> orderby: random #æ ‡ç­¾æ’åºæ–¹å¼æ˜¯éšæœº\n> top_img: false  #ä¸æ˜¾ç¤ºé¡¶éƒ¨å›¾ç‰‡\n> order: 1 #æ’åºä¼˜å…ˆçº§ä¸º1\n> comments: false #ä¸æ˜¾ç¤ºè¯„è®ºåŠŸèƒ½\n> aside: false #ä¸æ˜¾ç¤ºä¾§è¾¹æ \n\n## åˆ†ç±»é¡µ\n\nåœ¨`blog`æ ¹ç›®å½•ä¸‹æ‰“å¼€å‘½åæŒ‡ç¤ºç¬¦ï¼Œè¾“å…¥å¦‚ä¸‹å‘½ä»¤åˆ›å»ºåˆ†ç±»é¡µã€‚\n\n```shell\nhexo new page categories\n```\n\næ‰“å¼€`blog\\source\\categories`ç›®å½•ä¸‹çš„index.mdæ–‡ä»¶ï¼Œåœ¨Front-matteréƒ¨åˆ†åŠ å…¥ä»¥ä¸‹å†…å®¹ã€‚\n\n```markdown\ntype: \"categories\"\ncomments: false\ntop_img: false\naside: false\n```\n\n## å‹æƒ…é“¾æ¥\n\nåœ¨`blog`æ ¹ç›®å½•ä¸‹æ‰“å¼€å‘½åæŒ‡ç¤ºç¬¦ï¼Œè¾“å…¥å¦‚ä¸‹å‘½ä»¤åˆ›å»ºå‹æƒ…é“¾æ¥é¡µã€‚\n\n```shel\nhexo new page link\n```\n\næ‰“å¼€`blog\\source\\link`ç›®å½•ä¸‹çš„index.mdæ–‡ä»¶ï¼Œåœ¨Front-matteréƒ¨åˆ†åŠ å…¥ä»¥ä¸‹å†…å®¹ã€‚\n\n```markdown\ntype: \"link\"\ntop_img: false\naside: false\ncomments: true\n```\n\nå°ç¼–åšå®¢ä¸­åˆ›å»ºçš„å‹é“¾ä½¿ç”¨çš„æ˜¯`Tag Plugins Plusæ’ä»¶`ä¸­çš„`flinkå‹é“¾ç»„ä»¶`ã€‚é¦–å…ˆè¦å®‰è£…å¥½`Tag Plugins Plus`æ’ä»¶ï¼Œå…·ä½“å®‰è£…è¿‡ç¨‹è§æ–‡ç« å¼€å¤´ã€Šå®‰è£…Tag Plugins Plus æ ‡ç­¾å¤–æŒ‚æ’ä»¶ã€‹éƒ¨åˆ†ã€‚\n\nåœ¨`blog\\source\\link\\index.md`æ–‡ä»¶ä¸­ï¼ŒåŠ å…¥flinkå‹é“¾ç»„ä»¶å†…å®¹ã€‚\n\n```markdown\n{% flink %}\n\n- class_name: å‹æƒ…é“¾æ¥\n  class_desc: é‚£äº›äººï¼Œé‚£äº›äº‹\n  link_list:\n    - name: catsky\n      link: https://catsky.org/\n      avatar: https://cdn.catsky.org/catskyCDN/img/blog/catsky/blog_samll-toy-windmill.webp\n      descr: Cat's Blog\n\n{% endflink %}\n```\n\n> ç‚¹å‡»æŸ¥çœ‹Butterflyå®˜æ–¹ä½¿ç”¨çš„å‹é“¾é¡µé¢[æ•°æ®æ¥æº](https://butterfly.js.org/posts/dc584b87/#%E6%95%B8%E6%93%9A%E4%BE%86%E6%BA%90)æ•™ç¨‹\n\n## è¯´è¯´é¡µ\n\nåœ¨`blog`æ ¹ç›®å½•ä¸‹æ‰“å¼€å‘½åæŒ‡ç¤ºç¬¦ï¼Œè¾“å…¥å¦‚ä¸‹å‘½ä»¤åˆ›å»ºè¯´è¯´é¡µã€‚\n\n```shell\nhexo new page shuoshuo\n```\n\næ‰“å¼€`blog\\source\\shuoshuo`ç›®å½•ä¸‹çš„index.mdæ–‡ä»¶ï¼Œåœ¨Front-matteréƒ¨åˆ†åŠ å…¥ä»¥ä¸‹å†…å®¹ã€‚\n\n```markdown\ntype: \"shuoshuo\"\naside: false\ntop_img: false\ncomments: false\n```\n\nåœ¨`blog\\source`ç›®å½•ä¸‹åˆ›å»º`_data`æ–‡ä»¶å¤¹ï¼Œå¹¶åœ¨`_data`æ–‡ä»¶å¤¹ä¸‹åˆ›å»º`shuoshuo.yml`ï¼ŒåŠ å…¥ä»¥ä¸‹å†…å®¹è¿›è¡Œæµ‹è¯•ã€‚\n\n```yaml\n- author: Butterfly\n  avatar: https://butterfly.js.org/img/avatar.png\n  date: 2024-06-21 23:33:26\n  key: key-1\n  content: |\n    This is a sample content for **Author 1**.\n    ![Sample Image](https://via.placeholder.com/150)\n  tags:\n    - tags1\n    - tags2\n- author: Butterfly\n  avatar: https://butterfly.js.org/img/avatar.png\n  date: 2024-06-20 23:33:26\n  key: key-2\n  content: |\n    This is a sample content for **Author 2**.\n    ![Sample Image](https://via.placeholder.com/150)\n  tags:\n    - tag2\n    - tag3\n\n- author: Butterfly\n  avatar: https://butterfly.js.org/img/avatar.png\n  date: 2024-06-19 23:33:26\n  key: key-3\n  content: |\n    This is a sample content for **Author 3**.\n```\n\n> å…¶ä¸­çš„authorå’Œavatarå¯ä¸å¡«ï¼Œä¼šè‡ªåŠ¨è¯»å–_config.butterfly.ymlä¸_config.ymlé…ç½®æ–‡ä»¶ä¸­çš„ author å’Œ avatarï¼Œç›¸å…³åº”ç”¨å¯æŸ¥çœ‹Jerryçš„Butterfly æ–‡æ¡£çš„[è¯´è¯´é¡µé¢](https://butterfly.js.org/posts/dc584b87/#%E5%89%B5%E5%BB%BA%E8%AA%AC%E8%AA%AC%E9%A0%81%E9%9D%A2)\n\n## å…³äºé¡µ\n\nåœ¨`blog`æ ¹ç›®å½•ä¸‹æ‰“å¼€å‘½åæŒ‡ç¤ºç¬¦ï¼Œè¾“å…¥å¦‚ä¸‹å‘½ä»¤åˆ›å»ºå…³äºé¡µã€‚\n\n```shell\nhexo new page about\n```\n\næ‰“å¼€`blog\\source\\about`ç›®å½•ä¸‹çš„index.mdæ–‡ä»¶ï¼Œåœ¨Front-matteréƒ¨åˆ†åŠ å…¥ä»¥ä¸‹å†…å®¹ã€‚\n\n```markdown\ntype: \"about\"\naside: false\ntop_img: false\ncomments: false\n```\n\n## é…ç½®åˆ›å»ºçš„é¡µé¢\n\næ‰“å¼€`blog\\_config.butterfly.yml`ï¼Œä¿®æ”¹menuéƒ¨åˆ†å¦‚ä¸‹ã€‚\n\n```yaml\nmenu:\n  é¦–é¡µ: / || fas fa-home\n  å½’æ¡£: /archives/ || fas fa-archive\n  æ ‡ç­¾: /tags/ || fas fa-tags\n  åˆ†ç±»: /categories/ || fas fa-folder-open\n  è¯´è¯´: /shuoshuo/ || fas fa-comment-dots\n  å‹é“¾: /link/ || fas fa-link\n  å…³äº: /about/ || fas fa-heart\n```\n\né…ç½®å®Œæˆåè¿›è¡Œæœ¬åœ°æµ‹è¯•ï¼Œåœ¨æµè§ˆå™¨ä¸­è®¿é—® `http://localhost:4000/` ï¼ŒæŸ¥çœ‹åšå®¢ç•Œé¢ã€‚\n\n```\n#æœ¬åœ°æµ‹è¯•\nhexo cl && hexo g && hexo s\n```\n\n{% folding green open,åšå®¢æ­å»ºç³»åˆ—æ–‡ç«  %}\n\n{% series åšå®¢æ­å»ºæ•™ç¨‹ %}\n\n{% endfolding %}\n","tags":["Hexo","åšå®¢æ•™ç¨‹","Butterfly"],"categories":["åšå®¢æ•™ç¨‹","åšå®¢æ­å»º"]},{"title":"Androidæ‰‹æœºå®‰è£…docker","url":"/yyg/46758d12/","content":"## Androidæ‰‹æœºä½¿ç”¨ALPINE-TERM å®‰è£…docker\n\nAlpine Term æ˜¯ä¸€æ¬¾åŸºäº **Termux** çš„å®‰å“åº”ç”¨ï¼Œé›†æˆäº† **QEMU è™šæ‹Ÿæœº** å’Œ **Alpine Linux**ï¼Œæ”¯æŒåœ¨å®‰å“æ‰‹æœºä¸Šå… Root è¿è¡Œå®Œæ•´çš„ Linux ç¯å¢ƒï¼Œå¹¶å¯ç›´æ¥ä½¿ç”¨ Docker ç­‰å®¹å™¨æŠ€æœ¯ã€‚\n\n## ç¯å¢ƒè¦æ±‚\n\næ‰‹æœºç³»ç»Ÿç¯å¢ƒå¿…é¡»æ»¡è¶³ï¼š\n\n- AArch64æ¶æ„ï¼ˆä¸€èˆ¬éƒ½æ˜¯ï¼‰ \n- å®‰å“ 7.0+ \n- å†…éƒ¨å­˜å‚¨ä¸Šè‡³å°‘æœ‰ 500 MB çš„ç©ºé—´ã€‚\n- è¿æ¥ç½‘ç»œ\n\n## å®‰è£…Alpine Term \n\nï¼ˆ1ï¼‰ä» GitHub ä¸‹è½½ALPINE-TERM APKï¼ˆ606MBï¼‰ã€‚\n\nä¸‹è½½é“¾æ¥ï¼šhttps://github.com/FakeRajbhx/alpine-term/releases/download/New/alpine-term-v16.0-release.apk\n\nï¼ˆ2ï¼‰åœ¨æ‰‹æœºä¸Šå®‰è£…å®Œæˆåï¼Œè¿›å…¥appï¼Œç­‰å¾…ç³»ç»ŸåŠ è½½å®Œæˆã€‚\n\nï¼ˆ3ï¼‰è¾“å…¥é»˜è®¤ç”¨æˆ·alpineå’Œå¯†ç alpineï¼Œç™»å½•ç³»ç»Ÿã€‚\n\nï¼ˆ4ï¼‰åˆ‡æ¢è‡³rootè´¦å·ï¼Œrootç”¨æˆ·é»˜è®¤å¯†ç ä¸ºalpineã€‚å¯è¾“å…¥`passwd`è¿›è¡Œä¿®æ”¹ã€‚\n\n```shell\n#åˆ‡æ¢è‡³rootå‘½ä»¤è¡Œ\nsudo -s\n```\n\nï¼ˆ4ï¼‰ä¿®æ”¹sshdæœåŠ¡çš„é…ç½®æ–‡ä»¶ï¼Œå¼€å¯SSHè¿œç¨‹è¿æ¥\n\n```shell\nvi /etc/ssh/sshd_config\n#å…è®¸rootç”¨æˆ·è¿æ¥ç™»å½•\nPermitRootLogin yes\n#å¼€å¯å¯†ç ç™»å½•\nPasswordAuthentication yes\n\n#é‡å¯sshdæœåŠ¡\nservice sshd restart\n```\n\nï¼ˆ5ï¼‰åœ¨ALPINE-TERMç»ˆç«¯ç•Œé¢çš„ä¸Šæ–¹ä¸­ï¼Œå³åˆ’ï¼Œè°ƒå‡ºç»ˆç«¯èœå•ï¼Œé€‰æ‹©`[1] QEMU`,è¾“å…¥ä»¥ä¸‹å‘½ä»¤ï¼Œç‚¹å‡»å›è½¦ï¼Œå¼€å¯sshè¿œç¨‹è¿æ¥ç«¯å£ã€‚\n\n```shell\n#æ˜ å°„22ç«¯å£åˆ°æ‰‹æœºçš„8034ç«¯å£\nhostfwd_add tcp::8034-:22\n```\n\n![img](Androidæ‰‹æœºå®‰è£…docker/1.png)\n\n> æ¯æ¬¡å¯åŠ¨ALPINE-TERMæ—¶éƒ½éœ€è¦è¾“å…¥è¯¥å‘½ä»¤æ‰å¯è¿›è¡Œè¿œç¨‹è¿æ¥\n\nï¼ˆ6ï¼‰ä¿®æ”¹è½¯ä»¶ä»“åº“æº\n\n```shell\n#æ³¨é”€åŸæœ‰è½¯ä»¶ä»“åº“æº\nmv /etc/apk/repositories /etc/apk/repositories.bak\n#ä½¿ç”¨æ¸…åæº\necho \"\nhttps://mirrors.tuna.tsinghua.edu.cn/alpine/v3.13/main\nhttps://mirrors.tuna.tsinghua.edu.cn/alpine/v3.13/community\n\" > /etc/apk/repositories \n\n```\n\nï¼ˆ7ï¼‰ä¿®æ”¹DNS\n\n```shell\nsed -i 's/nameserver 94.16.114.254/nameserver 114.114.114.114/g' /etc/resolv.conf \nsed -i 's/nameserver 185.120.22.15/nameserver 223.5.5.5/g' /etc/resolv.conf\n```\n\n## å®‰è£…docker\n\nï¼ˆ1ï¼‰æ›´æ–°è½¯ä»¶åŒ…\n\n```shell\napk update  && apk upgrade --force-broken-world\n```\n\nï¼ˆ2ï¼‰ç³»ç»Ÿè‡ªå¸¦æœ‰dockerï¼Œä½†æ²¡æœ‰docker compose\n\n```\n#è®¾ç½®å¼€æœºè‡ªå¯\nrc-update add docker boot\n#å¯åŠ¨docker\nservice docker start\n#æŸ¥çœ‹ç‰ˆæœ¬\ndocker version\n```\n\n[å¯é€‰] æ›´æ¢è½¯ä»¶ä»“åº“æºï¼Œå¸è½½ç³»ç»Ÿè‡ªå¸¦dockerï¼Œå®‰è£…æ–°ç‰ˆdockerå’Œdocker composeã€‚\n\n```shell\necho \"\nhttps://mirrors.tuna.tsinghua.edu.cn/alpine/latest-stable/main\nhttps://mirrors.tuna.tsinghua.edu.cn/alpine/latest-stable/community\n\" > /etc/apk/repositories \n#æ›´æ–°\napk update \n\n#å¸è½½docker\napk del docker --force-broken-world\n#å®‰è£…æ–°ç‰ˆdockerã€docker compose\napk add docker docker-compose  docker-cli-compose --force-broken-world\n```\n\nï¼ˆ3ï¼‰é…ç½®å›½å†…é•œåƒæºï¼Œä¿®æ”¹dockeré»˜è®¤å­˜å‚¨ç›®å½•\n\n\n```shell\necho '{\n  \"data-root\": \"/data/dockerData\",\n  \"registry-mirrors\": [\"https://docker.1ms.run\"]\n}' > /etc/docker/daemon.json\n```\n\nï¼ˆ4ï¼‰å¯åŠ¨dockerï¼Œå¹¶è®¾ç½®å¼€æœºè‡ªå¯\n\n```shell\n#é‡å¯docker\nservice docker restart\n#è®¾ç½®å¼€æœºè‡ªå¯\nrc-update add docker boot\n#æŸ¥çœ‹ç‰ˆæœ¬\ndocker version\ndocker compose version\n```\n\n## æµ‹è¯•è®¿é—®\n\nï¼ˆ1ï¼‰åˆ›å»ºnginxå®¹å™¨\n\n```shell\n#æ‹‰å–nginxé•œåƒå¹¶åˆ›å»ºå®¹å™¨ï¼Œæ˜ å°„ä¸»æœºçš„8080ç«¯å£\ndocker run -itd --name=nginx -p 8080:80 nginx\n#æŸ¥çœ‹å®¹å™¨è¿è¡Œ\ndocker ps\n```\n\nå¦‚æœå®¹å™¨å¯åŠ¨æ—¶å‡ºç°ç±»ä¼¼æŠ¥é”™ï¼Œé‡å¯alpineä¸»æœºå³å¯\n\n> docker: Error response from daemon: failed to create endpoint nginx on network bridge: failed to add the host (veth3f2f206) <=> sandbox (veth9a8264a) pair interfaces: operation not supported.\n\nï¼ˆ2ï¼‰åœ¨QEMU ä¸­è‡³é…ç½®ç›¸åº”ç«¯å£\n\n```shell\n#å°†ä¸»æœºçš„8080ç«¯å£æ˜ å°„åˆ°æ‰‹æœºçš„8081ç«¯å£\nhostfwd_add tcp::8081-:8080\n```\n\n> ç±»ä¼¼ SSH æ˜ å°„ï¼Œéœ€è¦æ˜ å°„å®¹å™¨ç«¯å£æ—¶ï¼Œä¹Ÿè¦åœ¨QEMU ä¸­æ‰§è¡Œï¼š\n>\n> hostfwd_add tcp::æ‰‹æœºç«¯å£-:ä¸»æœºç«¯å£ \n\nï¼ˆ3ï¼‰åœ¨æµè§ˆå™¨ä¸­è¾“å…¥ip+ç«¯å£è®¿é—®\n\n![img](Androidæ‰‹æœºå®‰è£…docker/2.png)\n\n","tags":["ç©æœº","Android","ALPINE-TERM","Androidæ‰‹æœºå®‰è£…docker"],"categories":["æ¼«è°ˆ","ç©æœº"]},{"title":"Androidæ‰‹æœºå®‰è£…ubuntu","url":"/yyg/c86be486/","content":"## å‰è¨€\n\nåœ¨é—²ç½®çš„Androidæ—§æ‰‹æœºï¼ˆæ— éœ€rootï¼‰å®‰è£…ubuntu\n\n## å‡†å¤‡\n\nä¸‹è½½termux appï¼Œå¯¹åº”é“¾æ¥https://github.com/termux/termux-app/releases\n\næ¢æˆå›½å†…é•œåƒæº\n\n```\ntermux-change-repo\n```\n\nä¸‹è½½è½¯ä»¶\n\n```\npkg install vim\n```\n\nåˆ›å»ºç›®å½•ï¼Œè®¾ç½®å­˜å‚¨æƒé™\n\nåœ¨æ‰‹æœºçš„æ ¹ç›®å½•åˆ›å»ºç›®å½•aï¼Œå†è¿›å…¥aç›®å½•åˆ›å»ºfileç›®å½•\n\n```shell\ntermux-setup-storage\n#è®¾ç½®è½¯é“¾æ¥\nln -s storage/shared/a/file file\n```\n\n## å®‰è£…ubuntu\n\n### ä¸‹è½½ proot-distro\n\n```shell\npkg install proot-distro\n```\n\n### ä¸‹è½½ubuntu\n\næœ‰ä¸¤ç§æ–¹å¼å¯ä¸‹è½½ubuntu\n\næ–¹å¼ä¸€ï¼šç›´æ¥ä¸‹è½½\n\n```\n#æŸ¥çœ‹è¦å®‰è£…çš„ç³»ç»Ÿ\nproot-distro list\n#ä¸‹è½½å®‰è£…ubuntu\nproot-distro install ubuntu\n```\n\næ–¹å¼äºŒï¼šå‹ç¼©åŒ…å®‰è£…\n\nç›´æ¥ä¸‹è½½å¤ªæ…¢çš„è¯ï¼Œå¯ä»¥åœ¨githubä¸Šå…ˆæŠŠé•œåƒå‹ç¼©åŒ…ä¸‹è½½ä¸‹æ¥ï¼Œå…·ä½“é“¾æ¥ï¼šhttps://github.com/termux/proot-distro/releases/download/v4.18.0/ubuntu-noble-aarch64-pd-v4.18.0.tar.xz\n\nå°†ä¸‹è½½çš„å‹ç¼©åŒ…æ–‡ä»¶æ”¾åˆ°æ‰‹æœºçš„`a/file`ç›®å½•ï¼Œå†ç§»åŠ¨åˆ°`$PREFIX/var/lib/proot-distro/dlcache`ç›®å½•ä¸‹ï¼Œå†æ‰§è¡Œ`proot-distro install ubuntu`ã€‚å…·ä½“å‘½ä»¤ï¼š\n\n```shell\n#ç§»åŠ¨å‹ç¼©åŒ…\nmv ~/file/ubuntu-noble-aarch64-pd-v4.18.0.tar.xz $PREFIX/var/lib/proot-distro/dlcache\n#æ‰§è¡Œä¸‹è½½å‘½ä»¤\nproot-distro install ubuntu\n```\n\nå®‰è£…å®Œæˆåï¼Œç™»å½•ubuntu\n\n```shell\nproot-distro login ubuntu\n```\n\n### æ¢å›½å†…é•œåƒæº\n\næ›´æ–°ç°æœ‰æº\n\n```\napt update -y\n```\n\nä¸‹è½½ca-certificates\n\n```\napt install ca-certificates -y\n```\n\nä» Ubuntu 24.04 å¼€å§‹ï¼ŒUbuntu çš„è½¯ä»¶æºé…ç½®æ–‡ä»¶å˜æ›´ä¸º DEB822 æ ¼å¼\n\n```shell\n#å°†One-Line-Styleé…ç½®æ–‡ä»¶æ³¨é‡Š\nmv /etc/apt/sources.list /etc/apt/sources.list.bak\n#åˆ›å»ºé…ç½®æ–‡ä»¶ï¼Œä½¿ç”¨DEB822æ ¼å¼\nvim /etc/apt/sources.list.d/ubuntu.sources\n\nTypes: deb\nURIs: https://mirrors.tuna.tsinghua.edu.cn/ubuntu-ports\nSuites: noble noble-updates noble-backports\nComponents: main restricted universe multiverse\nSigned-By: /usr/share/keyrings/ubuntu-archive-keyring.gpg\n\n# é»˜è®¤æ³¨é‡Šäº†æºç é•œåƒä»¥æé«˜ apt update é€Ÿåº¦ï¼Œå¦‚æœ‰éœ€è¦å¯è‡ªè¡Œå–æ¶ˆæ³¨é‡Š\n# Types: deb-src\n# URIs: https://mirrors.tuna.tsinghua.edu.cn/ubuntu-ports\n# Suites: noble noble-updates noble-backports\n# Components: main restricted universe multiverse\n# Signed-By: /usr/share/keyrings/ubuntu-archive-keyring.gpg\n\n# ä»¥ä¸‹å®‰å…¨æ›´æ–°è½¯ä»¶æºåŒ…å«äº†å®˜æ–¹æºä¸é•œåƒç«™é…ç½®ï¼Œå¦‚æœ‰éœ€è¦å¯è‡ªè¡Œä¿®æ”¹æ³¨é‡Šåˆ‡æ¢\nTypes: deb\nURIs: http://ports.ubuntu.com/ubuntu-ports/\nSuites: noble-security\nComponents: main restricted universe multiverse\nSigned-By: /usr/share/keyrings/ubuntu-archive-keyring.gpg\n\n# Types: deb-src\n# URIs: http://ports.ubuntu.com/ubuntu-ports/\n# Suites: noble-security\n# Components: main restricted universe multiverse\n# Signed-By: /usr/share/keyrings/ubuntu-archive-keyring.gpg\n\n# é¢„å‘å¸ƒè½¯ä»¶æºï¼Œä¸å»ºè®®å¯ç”¨\n\n# Types: deb\n# URIs: https://mirrors.tuna.tsinghua.edu.cn/ubuntu-ports\n# Suites: noble-proposed\n# Components: main restricted universe multiverse\n# Signed-By: /usr/share/keyrings/ubuntu-archive-keyring.gpg\n\n# # Types: deb-src\n# # URIs: https://mirrors.tuna.tsinghua.edu.cn/ubuntu-ports\n# # Suites: noble-proposed\n# # Components: main restricted universe multiverse\n# # Signed-By: /usr/share/keyrings/ubuntu-archive-keyring.gpg\n\n# æ›´æ–°\napt update -y && apt upgrade -y\n```\n\n### è¿œç¨‹è¿æ¥\n\n```shell\napt install openssh-server -y\n#ä¿®æ”¹/etc/ssh/sshd_configï¼Œå–æ¶ˆä»¥ä¸‹å†…å®¹çš„æ³¨é‡Šå¹¶ä¿®æ”¹\nPort 8253 #ä½¿ç”¨æ•°å­—è¾ƒå°çš„ç«¯å£ä¸ä¼šç”Ÿæ•ˆ\nPermitRootLogin yes\nPasswordAuthentication yes\n\nservice ssh start \nservice ssh status \n#è®¾ç½®å¼€æœºè‡ªå¯\nupdate-rc.d ssh enable\n```\n\nè‹¥sshå¼€æœºè‡ªå¯ä¸ç”Ÿæ•ˆåœ¨`~/.bashrc`æ–‡ä»¶ä¸­è¿½åŠ `service ssh start`ã€‚\n\n```shell\necho \"service ssh start\" >> ~/.bashrc\n```\n","tags":["ç©æœº","termux","ubuntu","Android"],"categories":["æ¼«è°ˆ","ç©æœº"]},{"title":"KubernetesçŸ¥è¯†æ¢³ç†-æ ¸å¿ƒç»„ä»¶","url":"/yyg/dc35290c/","content":"## pod\n\nåœ¨kubernetesä¸­åŸºæœ¬æ‰€æœ‰èµ„æºçš„ä¸€çº§å±æ€§éƒ½æ˜¯ä¸€æ ·çš„ï¼Œä¸»è¦åŒ…å«5éƒ¨åˆ†ï¼š\n\n1. `apiVersion <string>` ç‰ˆæœ¬ï¼Œç”±kuberneteså†…éƒ¨å®šä¹‰ï¼Œç‰ˆæœ¬å·å¿…é¡»å¯ä»¥ç”¨kubectl api-versionsæŸ¥è¯¢åˆ°\n2. `kind <string>`ç±»å‹ï¼Œç”±kuberneteså†…éƒ¨å®šä¹‰ï¼Œç‰ˆæœ¬å·å¿…é¡»å¯ä»¥ç”¨kubectl api-resourcesæŸ¥è¯¢åˆ°\n3. `metadata <object>`å…ƒæ•°æ®ï¼Œä¸»è¦æ˜¯èµ„æºæ ‡è¯†å’Œè¯´æ˜ï¼Œå¸¸ç”¨çš„æœ‰nameã€namespaceã€labelssç­‰\n4. `spec <object>`æè¿°ï¼Œè¿™æ˜¯é…ç½®ä¸­æœ€é‡è¦çš„ä¸€éƒ¨åˆ†ï¼Œé‡Œé¢æ˜¯å¯¹å„ç§èµ„æºé…ç½®çš„è¯¦ç»†æè¿°\n5. `status <object>`çŠ¶æ€ä¿¡æ¯ï¼Œé‡Œé¢çš„å†…å®¹ä¸éœ€è¦å®šä¹‰ï¼Œç”±kubernetesè‡ªåŠ¨ç”Ÿæˆ\n\n### Podç”Ÿå‘½å‘¨æœŸ\n\nå°†Podå¯¹è±¡ä»åˆ›å»ºåˆ°ç»“æŸçš„æ—¶é—´èŒƒå›´ç§°ä¸ºPodçš„ç”Ÿå‘½å‘¨æœŸã€‚å…¶ç”Ÿå‘½å‘¨æœŸçš„ä¸»è¦è¿‡ç¨‹å¦‚ä¸‹ï¼š\n\n1. podåˆ›å»º\n2. è¿è¡Œåˆå§‹åŒ–å®¹å™¨\n3. è¿è¡Œä¸»å®¹å™¨å®¹å™¨\n   ï¼ˆ1ï¼‰å¯åŠ¨é’©å­ã€ç»ˆæ­¢é’©å­\n   ï¼ˆ2ï¼‰å­˜æ´»æ€§æ¢æµ‹ã€å°±ç»ªæ€§æ¢æµ‹\n4. podç»ˆæ­¢\n\n![image](KubernetesçŸ¥è¯†æ¢³ç†-æ ¸å¿ƒç»„ä»¶/0.png)\n\nåœ¨æ•´ä¸ªç”Ÿå‘½å‘¨æœŸä¸­ï¼ŒP0dä¼šå‡ºç°5ç§çŠ¶æ€ï¼Œåˆ†åˆ«å¦‚ä¸‹ï¼š\n\n1. æŒ‚èµ·(Pending)ï¼šapiserveriå·²ç»åˆ›å»ºäº†podèµ„æºå¯¹è±¡ï¼Œä½†å®ƒå°šæœªè¢«è°ƒåº¦å®Œæˆæˆ–è€…ä»å¤„äºä¸‹è½½é•œåƒçš„è¿‡ç¨‹ä¸­\n2. è¿è¡Œä¸­(Running)ï¼špodå·²ç»è¢«è°ƒåº¦è‡³æŸèŠ‚ç‚¹ï¼Œå¹¶ä¸”æ‰€æœ‰å®¹å™¨éƒ½å·²ç»è¢«kubeletåˆ›å»ºå®Œæˆ\n3. æˆåŠŸ(Succeeded)ï¼špodä¸­çš„æ‰€æœ‰å®¹å™¨éƒ½å·²ç»æˆåŠŸç»ˆæ­¢å¹¶ä¸”ä¸ä¼šè¢«é‡å¯\n4. å¤±è´¥(Failed)ï¼šæ‰€æœ‰å®¹å™¨éƒ½å·²ç»ç»ˆæ­¢ï¼Œä½†è‡³å°‘æœ‰ä¸€ä¸ªå®¹å™¨ç»ˆæ­¢å¤±è´¥ï¼Œå³å®¹å™¨è¿”å›äº†é0å€¼çš„é€€å‡ºçŠ¶æ€\n5. æœªçŸ¥(Unknown)ï¼šapiserveræ— æ³•æ­£å¸¸è·å–åˆ°podå¯¹è±¡çš„çŠ¶æ€ä¿¡æ¯ï¼Œé€šå¸¸ç”±ç½‘ç»œé€šä¿¡å¤±è´¥æ‰€å¯¼è‡´\n\n#### podçš„åˆ›å»ºè¿‡ç¨‹\n\né€šè¿‡kubectlå°†podé…ç½®ä¼ è¾“ç»™apiserverï¼Œapiserverè½¬åŒ–podä¿¡æ¯å¹¶å­˜å…¥etcdï¼Œå†è¿›è¡Œâ€æ¡æ‰‹â€œåé¦ˆã€‚schedulerç›‘å¬apiserverä¸­podä¿¡æ¯çš„å˜åŒ–ï¼Œä½¿ç”¨ç®—æ³•ä¸ºpodåˆ†é…ä¸»æœºå¹¶æ›´æ–°apiserverçš„ä¿¡æ¯ï¼Œå¯¹åº”nodeèŠ‚ç‚¹ä¸»æœºé€šè¿‡ç›‘å¬æ›´æ–°åçš„ä¿¡æ¯ï¼Œåˆ›å»ºå®¹å™¨å¹¶æ›´æ–°ä¿¡æ¯è‡³apiserverï¼Œapiserverå°†æœ€ç»ˆä¿¡æ¯å­˜å…¥etcdï¼Œè‡³æ­¤podåˆ›å»ºå®Œæˆã€‚\n\n> 1. ç”¨æˆ·é€šè¿‡kubectlæˆ–å…¶ä»–apiå®¢æˆ·ç«¯æäº¤éœ€è¦åˆ›å»ºçš„podä¿¡æ¯ç»™apiServer\n> 2. apiServerå¼€å§‹ç”Ÿæˆpodå¯¹è±¡çš„ä¿¡æ¯ï¼Œå¹¶å°†ä¿¡æ¯å­˜å…¥etcd,ç„¶åè¿”å›ç¡®è®¤ä¿¡æ¯è‡³å®¢æˆ·ç«¯\n> 3. apiServerå¼€å§‹åæ˜ etcdä¸­çš„podå¯¹è±¡çš„å˜åŒ–ï¼Œå…¶å®ƒç»„ä»¶ä½¿ç”¨watchæœºåˆ¶æ¥è·Ÿè¸ªæ£€æŸ¥apiServerä¸Šçš„å˜åŠ¨\n> 4. schedulerå‘ç°æœ‰æ–°çš„podå¯¹è±¡è¦åˆ›å»ºï¼Œå¼€å§‹ä¸ºPodåˆ†é…ä¸»æœºå¹¶å°†ç»“æœä¿¡æ¯æ›´æ–°è‡³apiServer\n> 5. nodeèŠ‚ç‚¹ä¸Šçš„kubeletå‘ç°æœ‰podè°ƒåº¦è¿‡æ¥ï¼Œå°è¯•è°ƒç”¨dockerå¯åŠ¨å®¹å™¨ï¼Œå¹¶å°†ç»“æœå›é€è‡³apiServer\n> 6. apiServerå°†æ¥æ”¶åˆ°çš„podçŠ¶æ€ä¿¡æ¯å­˜å…¥etcdä¸­\n\n![image](KubernetesçŸ¥è¯†æ¢³ç†-æ ¸å¿ƒç»„ä»¶/1.png)\n\n#### podçš„ç»ˆæ­¢è¿‡ç¨‹\n\nç”¨æˆ·å‘é€åˆ é™¤podå‘½ä»¤ï¼Œapiserveræ¥å—å¹¶æ›´æ–°ä¿¡æ¯ï¼ŒpodçŠ¶æ€å˜ä¸ºterminatingã€‚kubeletç›‘å¬æ”¶åˆ°åï¼Œå¯åŠ¨podå…³é—­æŒ‡ä»¤ï¼Œç«¯ç‚¹æ§åˆ¶å™¨ç›‘å¬åˆ°podå…³é—­æŒ‡ä»¤ï¼Œåˆ é™¤å¯¹åº”serviceèµ„æºï¼Œpodåœæ­¢è¿è¡Œï¼Œkubeletè¯·æ±‚apiServerå°†podèµ„æºçš„å®½é™æœŸè®¾ç½®ä¸º0ä»è€Œå®Œæˆåˆ é™¤æ“ä½œï¼Œapiserverå°†æœ€ç»ˆä¿¡æ¯å­˜å…¥etcdï¼Œè‡³æ­¤podåˆ é™¤å®Œæˆã€‚\n\n> 1. ç”¨æˆ·å‘apiServerå‘é€åˆ é™¤podå¯¹è±¡çš„å‘½ä»¤\n> 2. apiServerä¸­çš„podå¯¹è±¡ä¿¡æ¯ä¼šéšç€æ—¶é—´çš„æ¨ç§»è€Œæ›´æ–°ï¼Œåœ¨å®½é™æœŸå†…(é»˜è®¤30s),podè¢«è§†ä¸ºdead\n> 3. å°†podæ ‡è®°ä¸ºterminatingçŠ¶æ€\n> 4. kubeletåœ¨ç›‘æ§åˆ°podå¯¹è±¡è½¬ä¸ºterminatingçŠ¶æ€çš„åŒæ—¶å¯åŠ¨podå…³é—­è¿‡ç¨‹\n> 5. ç«¯ç‚¹æ§åˆ¶å™¨ç›‘æ§åˆ°podå¯¹è±¡çš„å…³é—­è¡Œä¸ºæ—¶å°†å…¶ä»æ‰€æœ‰åŒ¹é…åˆ°æ­¤ç«¯ç‚¹çš„serviceèµ„æºçš„ç«¯ç‚¹åˆ—è¡¨ä¸­ç§»é™¤\n> 6. å¦‚æœå½“å‰podå¯¹è±¡å®šä¹‰äº†preStopé’©å­å¤„ç†å™¨ï¼Œåˆ™åœ¨å…¶æ ‡è®°ä¸ºterminatingåå³ä¼šä»¥åŒæ­¥çš„æ–¹å¼å¯åŠ¨æ‰§è¡Œ\n> 7. podå¯¹è±¡ä¸­çš„å®¹å™¨è¿›ç¨‹æ”¶åˆ°åœæ­¢ä¿¡å·\n> 8. å®½é™æœŸç»“æŸåï¼Œè‹¥podä¸­è¿˜å­˜åœ¨ä»åœ¨è¿è¡Œçš„è¿›ç¨‹ï¼Œé‚£ä¹ˆpodå¯¹è±¡ä¼šæ”¶åˆ°ç«‹å³ç»ˆæ­¢çš„ä¿¡å·\n> 9. kubeletè¯·æ±‚apiServerå°†æ­¤podèµ„æºçš„å®½é™æœŸè®¾ç½®ä¸º0ä»è€Œå®Œæˆåˆ é™¤æ“ä½œï¼Œæ­¤æ—¶podå¯¹äºç”¨æˆ·å·²ä¸å¯è§\n\n#### åˆè¯•åŒ–å®¹å™¨\n\nåˆå§‹åŒ–å®¹å™¨æ˜¯åœ¨Podçš„ä¸»å®¹å™¨å¯åŠ¨ä¹‹å‰è¦è¿è¡Œçš„å®¹å™¨ï¼Œä¸»è¦æ˜¯åšä¸€äº›ä¸»å®¹å™¨çš„å‰ç½®å·¥ä½œï¼Œå®ƒå…·æœ‰ä¸¤å¤§ç‰¹å¾ï¼š\n1ã€åˆå§‹åŒ–å®¹å™¨å¿…é¡»è¿è¡Œå®Œæˆç›´è‡³ç»“æŸï¼Œå¦‚æœæŸä¸ªåˆå§‹åŒ–å®¹å™¨è¿è¡Œå¤±è´¥ï¼Œé‚£ä¹ˆkuberneteséœ€è¦é‡å¯å®ƒç›´è‡³æˆåŠŸå®Œæˆã€‚\n2ã€åˆå§‹åŒ–å®¹å™¨å¿…é¡»æŒ‰ç…§å®šä¹‰çš„é¡ºåºæ‰§è¡Œï¼Œå½“ä¸”ä»…å½“å‰ä¸€ä¸ªæˆåŠŸä¹‹åï¼Œåé¢çš„ä¸€ä¸ªæ‰èƒ½è¿è¡Œã€‚\nåˆå§‹åŒ–å®¹å™¨æœ‰å¾ˆå¤šçš„åº”ç”¨åœºæ™¯ï¼Œä¸‹é¢åˆ—å‡ºçš„æ˜¯æœ€å¸¸è§çš„å‡ ä¸ªï¼š\n1ã€æä¾›ä¸»å®¹å™¨é•œåƒä¸­ä¸å…·å¤‡çš„å·¥å…·ç¨‹åºæˆ–è‡ªå®šä¹‰ä»£ç ã€‚\n2ã€åˆå§‹åŒ–å®¹å™¨è¦å…ˆäºåº”ç”¨å®¹å™¨ä¸²è¡Œå¯åŠ¨å¹¶è¿è¡Œå®Œæˆï¼Œå› æ­¤å¯ç”¨äºå»¶ååº”ç”¨å®¹å™¨çš„å¯åŠ¨ç›´è‡³å…¶ä¾èµ–çš„æ¡ä»¶å¾—åˆ°æ»¡è¶³ã€‚\næ¥ä¸‹æ¥åšä¸€ä¸ªæ¡ˆä¾‹ï¼Œæ¨¡æ‹Ÿä¸‹é¢è¿™ä¸ªéœ€æ±‚ï¼š\nå‡è®¾è¦ä»¥ä¸»å®¹å™¨æ¥è¿è¡ŒNginxï¼Œä½†æ˜¯è¦æ±‚åœ¨è¿è¡ŒNginxä¹‹å‰è¦èƒ½å¤Ÿè¿æ¥ä¸ŠMySQLå’ŒRedisæ‰€åœ¨çš„æœåŠ¡å™¨ã€‚\nä¸ºäº†ç®€åŒ–æµ‹è¯•ï¼Œäº‹å…ˆè§„å®šå¥½MySQLå’ŒRedisæ‰€åœ¨çš„IPåœ°å€åˆ†åˆ«ä¸º192.168.18.103å’Œ192.168.18.104ï¼ˆæ³¨æ„ï¼Œè¿™ä¸¤ä¸ªIPéƒ½ä¸èƒ½pingé€šï¼Œå› ä¸ºç¯å¢ƒä¸­æ²¡æœ‰è¿™ä¸¤ä¸ªIPï¼‰ã€‚\nåˆ›å»ºpod-initcontainer.yamlæ–‡ä»¶ï¼Œå†…å®¹å¦‚ä¸‹ï¼š\n\n```yaml\napiVersion: v1\nkind: Pod\nmetadata:\n  name: pod-initcontainer\n  namespace: dev\n  labels:\n    user: xudaxian\nspec:\n  containers: # å®¹å™¨é…ç½®\n    - name: nginx\n      image: nginx:1.17.1\n      imagePullPolicy: IfNotPresent\n      ports:\n        - name: nginx-port\n          containerPort: 80\n          protocol: TCP\n      resources:\n        limits:\n          cpu: \"2\"\n          memory: \"10Gi\"\n        requests:\n          cpu: \"1\"\n          memory: \"10Mi\"\n  initContainers: # åˆå§‹åŒ–å®¹å™¨é…ç½®\n    - name: test-mysql\n      image: busybox:1.30\n      command: [\"sh\",\"-c\",\"until ping 192.168.18.103 -c 1;do echo waiting for mysql ...;sleep 2;done;\"]\n      securityContext:\n        privileged: true # ä½¿ç”¨ç‰¹æƒæ¨¡å¼è¿è¡Œå®¹å™¨\n    - name: test-redis\n      image: busybox:1.30\n      command: [\"sh\",\"-c\",\"until ping 192.168.18.104 -c 1;do echo waiting for redis ...;sleep 2;done;\"]\n```\n\næ‰§è¡Œå‘½ä»¤åï¼Œtest-mysqlæœªåˆ›å»ºæˆåŠŸï¼Œä¹‹åçš„å®¹å™¨ä¹Ÿæ— æ³•åˆ›å»ºã€‚ä¿®æ”¹ipä¸ºå¯è®¿é—®ipåï¼Œé‡æ–°æ‰§è¡Œå‘½ä»¤ï¼Œä¼šæŒ‰é¡ºåºåˆ›å»ºæˆåŠŸ\n\n#### é’©å­å‡½æ•°\n\nkubernetesåœ¨ä¸»å®¹å™¨çš„å¯åŠ¨ä¹‹åå’Œåœæ­¢ä¹‹å‰æä¾›äº†ä¸¤ä¸ªé’©å­å‡½æ•°ï¼š\n\n- post startï¼šå®¹å™¨åˆ›å»ºä¹‹åæ‰§è¡Œï¼Œå¦‚æœå¤±è´¥äº†ä¼šé‡å¯å®¹å™¨\n\n- pre stopï¼šå®¹å™¨ç»ˆæ­¢ä¹‹å‰æ‰§è¡Œï¼Œæ‰§è¡Œå®Œæˆä¹‹åå®¹å™¨å°†æˆåŠŸç»ˆæ­¢ï¼Œåœ¨å…¶å®Œæˆä¹‹å‰ä¼šé˜»å¡åˆ é™¤å®¹å™¨çš„æ“ä½œ\n\né’©å­å¤„ç†å™¨æ”¯æŒä½¿ç”¨ä¸‹é¢çš„ä¸‰ç§æ–¹å¼å®šä¹‰åŠ¨ä½œï¼š\n\n- execå‘½ä»¤ï¼šåœ¨å®¹å™¨å†…æ‰§è¡Œä¸€æ¬¡å‘½ä»¤ã€‚\n\n```yaml\n  .......\n    lifecycle:\n       postStart: \n          exec:\n             command:\n               - cat\n               - /tmp/healthy\n  .......\n```\n\n- tcpSocketï¼šåœ¨å½“å‰å®¹å™¨å°è¯•è®¿é—®æŒ‡å®šçš„socketã€‚\n\n```yaml\n  .......\n     lifecycle:\n        postStart:\n           tcpSocket:\n              port: 8080\n  .......\n```\n\n- httpGetï¼šåœ¨å½“å‰å®¹å™¨ä¸­å‘æŸurlå‘èµ·HTTPè¯·æ±‚ã€‚\n\n```yaml\n  ....... \n     lifecycle:\n        postStart:\n           httpGet:\n              path: / #URIåœ°å€\n              port: 80 #ç«¯å£å·\n              host: 192.168.109.100 #ä¸»æœºåœ°å€  \n              scheme: HTTP #æ”¯æŒçš„åè®®ï¼Œhttpæˆ–è€…https\n  .......\n```\n\n#### å®¹å™¨æ¢æµ‹\n\nå®¹å™¨æ¢æµ‹ç”¨äºæ£€æµ‹å®¹å™¨ä¸­çš„åº”ç”¨å®ä¾‹æ˜¯å¦æ­£å¸¸å·¥ä½œï¼Œæ˜¯ä¿éšœä¸šåŠ¡å¯ç”¨æ€§çš„ä¸€ç§ä¼ ç»Ÿæœºåˆ¶ã€‚å¦‚æœç»è¿‡æ¢æµ‹ï¼Œå®ä¾‹çš„çŠ¶æ€ä¸ç¬¦åˆé¢„æœŸï¼Œé‚£ä¹ˆkuberneteså°±ä¼šæŠŠè¯¥é—®é¢˜å®ä¾‹â€œæ‘˜é™¤â€ï¼Œä¸æ‰¿æ‹…ä¸šåŠ¡æµé‡ã€‚kubernetesæä¾›äº†ä¸¤ç§æ¢é’ˆæ¥å®ç°å®¹å™¨æ¢æµ‹ï¼Œåˆ†åˆ«æ˜¯ï¼š\n\n- liveness probesï¼šå­˜æ´»æ€§æ¢æµ‹ï¼Œç”¨äºæ£€æµ‹åº”ç”¨å®ä¾‹å½“å‰æ˜¯å¦å¤„äºæ­£å¸¸è¿è¡ŒçŠ¶æ€ï¼Œå¦‚æœä¸æ˜¯ï¼Œk8sä¼šé‡å¯å®¹å™¨ã€‚\n\n- readiness probesï¼šå°±ç»ªæ€§æ¢æµ‹ï¼Œç”¨äºæ£€æµ‹åº”ç”¨å®ä¾‹æ˜¯å¦å¯ä»¥æ¥å—è¯·æ±‚ï¼Œå¦‚æœä¸èƒ½ï¼Œk8sä¸ä¼šè½¬å‘æµé‡ã€‚\n\n> livenessProbeï¼šå­˜æ´»æ€§æ¢æµ‹ï¼Œå†³å®šæ˜¯å¦é‡å¯å®¹å™¨ã€‚\n> readinessProbeï¼šå°±ç»ªæ€§æ¢æµ‹ï¼Œå†³å®šæ˜¯å¦å°†è¯·æ±‚è½¬å‘ç»™å®¹å™¨ã€‚\n\n> k8såœ¨1.16ç‰ˆæœ¬ä¹‹åæ–°å¢äº†startupProbeæ¢é’ˆï¼Œç”¨äºåˆ¤æ–­å®¹å™¨å†…åº”ç”¨ç¨‹åºæ˜¯å¦å·²ç»å¯åŠ¨ã€‚å¦‚æœé…ç½®äº†startupProbeæ¢é’ˆï¼Œå°±ä¼šå…ˆç¦æ­¢å…¶ä»–çš„æ¢é’ˆï¼Œç›´åˆ°startupProbeæ¢é’ˆæˆåŠŸä¸ºæ­¢ï¼Œä¸€æ—¦æˆåŠŸå°†ä¸å†è¿›è¡Œæ¢æµ‹ã€‚\n\nä¸Šé¢ä¸¤ç§æ¢é’ˆç›®å‰å‡æ”¯æŒä¸‰ç§æ¢æµ‹æ–¹å¼ï¼š\n\n- execå‘½ä»¤ï¼šåœ¨å®¹å™¨å†…æ‰§è¡Œä¸€æ¬¡å‘½ä»¤ï¼Œå¦‚æœå‘½ä»¤æ‰§è¡Œçš„é€€å‡ºç ä¸º0ï¼Œåˆ™è®¤ä¸ºç¨‹åºæ­£å¸¸ï¼Œå¦åˆ™ä¸æ­£å¸¸ã€‚\n  \n```yaml\n  â€¦â€¦\n    livenessProbe:\n       exec:\n          command:\n            -    cat\n            -    /tmp/healthy\n  â€¦â€¦\n```\n\n- tcpSocketï¼šå°†ä¼šå°è¯•è®¿é—®ä¸€ä¸ªç”¨æˆ·å®¹å™¨çš„ç«¯å£ï¼Œå¦‚æœèƒ½å¤Ÿå»ºç«‹è¿™æ¡è¿æ¥ï¼Œåˆ™è®¤ä¸ºç¨‹åºæ­£å¸¸ï¼Œå¦åˆ™ä¸æ­£å¸¸ã€‚\n  \n```yaml\n  â€¦â€¦\n     livenessProbe:\n        tcpSocket:\n           port: 8080\n  â€¦â€¦\n```\n\n- httpGetï¼šè°ƒç”¨å®¹å™¨å†…webåº”ç”¨çš„URLï¼Œå¦‚æœè¿”å›çš„çŠ¶æ€ç åœ¨200å’Œ399ä¹‹å‰ï¼Œåˆ™è®¤ä¸ºç¨‹åºæ­£å¸¸ï¼Œå¦åˆ™ä¸æ­£å¸¸ã€‚\n\n```yaml\nâ€¦â€¦\n   livenessProbe:\n      httpGet:\n         path: / #URIåœ°å€\n         port: 80 #ç«¯å£å·\n         host: 127.0.0.1 #ä¸»æœºåœ°å€\n         scheme: HTTP #æ”¯æŒçš„åè®®ï¼Œhttpæˆ–è€…https\nâ€¦â€¦\n```\n\n#### é‡å¯ç­–ç•¥\n\nåœ¨å®¹å™¨æ¢æµ‹ä¸­ï¼Œä¸€æ—¦å®¹å™¨æ¢æµ‹å‡ºç°äº†é—®é¢˜ï¼Œkuberneteså°±ä¼šå¯¹å®¹å™¨æ‰€åœ¨çš„Podè¿›è¡Œé‡å¯ï¼Œå…¶å®è¿™æ˜¯ç”±Podçš„é‡å¯ç­–ç•¥å†³å®šçš„ï¼ŒPodçš„é‡å¯ç­–ç•¥æœ‰3ç§ï¼Œåˆ†åˆ«å¦‚ä¸‹ï¼š\n\n- Alwaysï¼šå®¹å™¨å¤±æ•ˆæ—¶ï¼Œè‡ªåŠ¨é‡å¯è¯¥å®¹å™¨ï¼Œé»˜è®¤å€¼ã€‚\n- OnFailureï¼šå®¹å™¨ç»ˆæ­¢è¿è¡Œä¸”é€€å‡ºç ä¸ä¸º0æ—¶é‡å¯ã€‚\n- Neverï¼šä¸è®ºçŠ¶æ€å¦‚ä½•ï¼Œéƒ½ä¸é‡å¯è¯¥å®¹å™¨ã€‚\n\né‡å¯ç­–ç•¥é€‚ç”¨äºPodå¯¹è±¡ä¸­çš„æ‰€æœ‰å®¹å™¨ï¼Œé¦–æ¬¡éœ€è¦é‡å¯çš„å®¹å™¨ï¼Œå°†åœ¨å…¶éœ€è¦çš„æ—¶å€™ç«‹å³è¿›è¡Œé‡å¯ï¼Œéšåå†æ¬¡é‡å¯çš„æ“ä½œå°†ç”±kubeletå»¶è¿Ÿä¸€æ®µæ—¶é—´åè¿›è¡Œï¼Œä¸”åå¤çš„é‡å¯æ“ä½œçš„å»¶è¿Ÿæ—¶é•¿ä»¥æ­¤ä¸º10sã€20sã€40sã€80sã€160så’Œ300sï¼Œ300sæ˜¯æœ€å¤§çš„å»¶è¿Ÿæ—¶é•¿ã€‚\n\n### Podçš„è°ƒåº¦\n\nåœ¨é»˜è®¤æƒ…å†µä¸‹ï¼Œä¸€ä¸ªPodåœ¨å“ªä¸ªNodeèŠ‚ç‚¹ä¸Šè¿è¡Œï¼Œæ˜¯ç”±Schedulerç»„ä»¶é‡‡ç”¨ç›¸åº”çš„ç®—æ³•è®¡ç®—å‡ºæ¥çš„ï¼Œè¿™ä¸ªè¿‡ç¨‹æ˜¯ä¸å—äººå·¥æ§åˆ¶çš„ã€‚ä½†æ˜¯åœ¨å®é™…ä½¿ç”¨ä¸­ï¼Œè¿™å¹¶ä¸æ»¡è¶³éœ€æ±‚ï¼Œå› ä¸ºå¾ˆå¤šæƒ…å†µä¸‹ï¼Œæˆ‘ä»¬æƒ³æ§åˆ¶æŸäº›Podåˆ°è¾¾æŸäº›èŠ‚ç‚¹ä¸Šï¼Œé‚£ä¹ˆåº”è¯¥æ€ä¹ˆåšï¼Ÿè¿™å°±è¦æ±‚äº†è§£kuberneteså¯¹Podçš„è°ƒåº¦è§„åˆ™ï¼Œkubernetesæä¾›äº†å››å¤§ç±»è°ƒåº¦æ–¹å¼ã€‚\n\n- è‡ªåŠ¨è°ƒåº¦ï¼šè¿è¡Œåœ¨å“ªä¸ªNodeèŠ‚ç‚¹ä¸Šå®Œå…¨ç”±Schedulerç»è¿‡ä¸€ç³»åˆ—çš„ç®—æ³•è®¡ç®—å¾—å‡ºã€‚\n- å®šå‘è°ƒåº¦ï¼šNodeNameã€NodeSelectorã€‚\n- äº²å’Œæ€§è°ƒåº¦ï¼šNodeAffinityã€PodAffinityã€PodAntiAffinityã€‚\n- æ±¡ç‚¹ï¼ˆå®¹å¿ï¼‰è°ƒåº¦ï¼šTaintsã€Tolerationã€‚\n\n#### å®šå‘è°ƒåº¦\n\nå®šå‘è°ƒåº¦ï¼ŒæŒ‡çš„æ˜¯åˆ©ç”¨åœ¨Podä¸Šå£°æ˜çš„`nodeName`æˆ–`nodeSelector`ï¼Œä»¥æ­¤å°†Podè°ƒåº¦åˆ°æœŸæœ›çš„NodeèŠ‚ç‚¹ä¸Šã€‚æ³¨æ„ï¼Œè¿™é‡Œçš„è°ƒåº¦æ˜¯å¼ºåˆ¶çš„ï¼Œè¿™å°±æ„å‘³ç€å³ä½¿è¦è°ƒåº¦çš„ç›®æ ‡Nodeä¸å­˜åœ¨ï¼Œä¹Ÿä¼šå‘ä¸Šé¢è¿›è¡Œè°ƒåº¦ï¼Œåªä¸è¿‡Podè¿è¡Œå¤±è´¥è€Œå·²ã€‚\n\n##### nodeName\n\nnodeNameç”¨äºå¼ºåˆ¶çº¦æŸå°†Podè°ƒåº¦åˆ°æŒ‡å®šçš„nameçš„NodeèŠ‚ç‚¹ä¸Šã€‚è¿™ç§æ–¹å¼ï¼Œå…¶å®æ˜¯ç›´æ¥è·³è¿‡Schedulerçš„è°ƒåº¦é€»è¾‘ï¼Œç›´æ¥å°†Podè°ƒåº¦åˆ°æŒ‡å®šåç§°çš„èŠ‚ç‚¹ã€‚\nåˆ›å»ºä¸€ä¸ªpod-nodename.yamlæ–‡ä»¶ï¼Œå†…å®¹å¦‚ä¸‹ï¼š\n\n```yaml\napiVersion: v1\nkind: Pod\nmetadata:\n  name: pod-nodename\n  namespace: dev\n  labels:\n    user: xudaxian\nspec:\n  containers: # å®¹å™¨é…ç½®\n    - name: nginx\n      image: nginx:1.17.1\n      imagePullPolicy: IfNotPresent\n      ports:\n        - name: nginx-port\n          containerPort: 80\n          protocol: TCP\n  nodeName: k8s-node1 # æŒ‡å®šè°ƒåº¦åˆ°k8s-node1èŠ‚ç‚¹ä¸Š\n```\n\n##### nodeSelector\n\nnodeSelectorç”¨äºå°†Podè°ƒåº¦åˆ°æ·»åŠ äº†æŒ‡å®šæ ‡ç­¾çš„NodeèŠ‚ç‚¹ä¸Šï¼Œå®ƒæ˜¯é€šè¿‡kubernetesçš„label-selectoræœºåˆ¶å®ç°çš„ï¼Œæ¢è¨€ä¹‹ï¼Œåœ¨Podåˆ›å»ºä¹‹å‰ï¼Œä¼šç”±Schedulerä½¿ç”¨MatchNodeSelectorè°ƒåº¦ç­–ç•¥è¿›è¡ŒlabelåŒ¹é…ï¼Œæ‰¾å‡ºç›®æ ‡nodeï¼Œç„¶åå°†Podè°ƒåº¦åˆ°ç›®æ ‡èŠ‚ç‚¹ï¼Œè¯¥åŒ¹é…è§„åˆ™æ˜¯å¼ºåˆ¶çº¦æŸã€‚\n\n```yaml\napiVersion: v1\nkind: Pod\nmetadata:\n  name: pod-nodeselector\n  namespace: dev\nspec:\n  containers: # å®¹å™¨é…ç½®\n    - name: nginx\n      image: nginx:1.17.1\n      imagePullPolicy: IfNotPresent\n      ports:\n        - name: nginx-port\n          containerPort: 80\n          protocol: TCP\n  nodeSelector:\n    nodeenv: pro # æŒ‡å®šè°ƒåº¦åˆ°å…·æœ‰nodeenv=proçš„NodeèŠ‚ç‚¹ä¸Š\n```\n\n#### äº²å’Œæ€§è°ƒåº¦\n\nè™½ç„¶å®šå‘è°ƒåº¦çš„ä¸¤ç§æ–¹å¼ï¼Œä½¿ç”¨èµ·æ¥éå¸¸æ–¹ä¾¿ï¼Œä½†æ˜¯ä¹Ÿæœ‰ä¸€å®šçš„é—®é¢˜ï¼Œé‚£å°±æ˜¯å¦‚æœæ²¡æœ‰æ»¡è¶³æ¡ä»¶çš„Nodeï¼Œé‚£ä¹ˆPodå°†ä¸ä¼šè¢«è¿è¡Œï¼Œå³ä½¿åœ¨é›†ç¾¤ä¸­è¿˜æœ‰å¯ç”¨çš„Nodeåˆ—è¡¨ä¹Ÿä¸è¡Œï¼Œè¿™å°±é™åˆ¶äº†å®ƒçš„ä½¿ç”¨åœºæ™¯ã€‚\nåŸºäºä¸Šé¢çš„é—®é¢˜ï¼Œkubernetesè¿˜æä¾›äº†ä¸€ç§äº²å’Œæ€§è°ƒåº¦ï¼ˆAffinityï¼‰ã€‚å®ƒåœ¨nodeSelectorçš„åŸºç¡€ä¹‹ä¸Šè¿›è¡Œäº†æ‰©å±•ï¼Œå¯ä»¥é€šè¿‡é…ç½®çš„å½¢å¼ï¼Œå®ç°ä¼˜å…ˆé€‰æ‹©æ»¡è¶³æ¡ä»¶çš„Nodeè¿›è¡Œè°ƒåº¦ï¼Œå¦‚æœæ²¡æœ‰ï¼Œä¹Ÿå¯ä»¥è°ƒåº¦åˆ°ä¸æ»¡è¶³æ¡ä»¶çš„èŠ‚ç‚¹ä¸Šï¼Œä½¿å¾—è°ƒåº¦æ›´åŠ çµæ´»ã€‚Affinityä¸»è¦åˆ†ä¸ºä¸‰ç±»ï¼š\n\n- nodeAffinityï¼ˆnodeäº²å’Œæ€§ï¼‰ï¼šä»¥Nodeä¸ºç›®æ ‡ï¼Œè§£å†³Podå¯ä»¥è°ƒåº¦åˆ°é‚£äº›Nodeçš„é—®é¢˜ã€‚\n- podAffinityï¼ˆpodäº²å’Œæ€§ï¼‰ï¼šä»¥Podä¸ºç›®æ ‡ï¼Œè§£å†³Podå¯ä»¥å’Œé‚£äº›å·²å­˜åœ¨çš„Podéƒ¨ç½²åœ¨åŒä¸€ä¸ªæ‹“æ‰‘åŸŸä¸­çš„é—®é¢˜ã€‚\n- podAntiAffinityï¼ˆpodåäº²å’Œæ€§ï¼‰ï¼šä»¥Podä¸ºç›®æ ‡ï¼Œè§£å†³Podä¸èƒ½å’Œé‚£äº›å·²ç»å­˜åœ¨çš„Podéƒ¨ç½²åœ¨åŒä¸€æ‹“æ‰‘åŸŸä¸­çš„é—®é¢˜ã€‚\n\nå…³äºäº²å’Œæ€§å’Œåäº²å’Œæ€§çš„ä½¿ç”¨åœºæ™¯çš„è¯´æ˜ï¼š\n\n- äº²å’Œæ€§ï¼šå¦‚æœä¸¤ä¸ªåº”ç”¨é¢‘ç¹äº¤äº’ï¼Œé‚£ä¹ˆå°±æœ‰å¿…è¦åˆ©ç”¨äº²å’Œæ€§è®©ä¸¤ä¸ªåº”ç”¨å°½å¯èƒ½çš„é è¿‘ï¼Œè¿™æ ·å¯ä»¥è¾ƒå°‘å› ç½‘ç»œé€šä¿¡è€Œå¸¦æ¥çš„æ€§èƒ½æŸè€—ã€‚\n- åäº²å’Œæ€§ï¼šå½“åº”ç”¨é‡‡ç”¨å¤šå‰¯æœ¬éƒ¨ç½²çš„æ—¶å€™ï¼Œé‚£ä¹ˆå°±æœ‰å¿…è¦åˆ©ç”¨åäº²å’Œæ€§è®©å„ä¸ªåº”ç”¨å®ä¾‹æ‰“æ•£åˆ†å¸ƒåœ¨å„ä¸ªNodeä¸Šï¼Œè¿™æ ·å¯ä»¥æé«˜æœåŠ¡çš„é«˜å¯ç”¨æ€§ã€‚\n\n##### nodeAffinityï¼ˆnodeäº²å’Œæ€§ï¼‰\n\næŸ¥çœ‹nodeAffinityçš„å¯é€‰é…ç½®é¡¹ï¼š\n\n```yaml\npod.spec.affinity.nodeAffinity\n  requiredDuringSchedulingIgnoredDuringExecution  NodeèŠ‚ç‚¹å¿…é¡»æ»¡è¶³æŒ‡å®šçš„æ‰€æœ‰è§„åˆ™æ‰å¯ä»¥ï¼Œç›¸å½“äºç¡¬é™åˆ¶\n    nodeSelectorTerms  èŠ‚ç‚¹é€‰æ‹©åˆ—è¡¨\n      matchFields   æŒ‰èŠ‚ç‚¹å­—æ®µåˆ—å‡ºçš„èŠ‚ç‚¹é€‰æ‹©å™¨è¦æ±‚åˆ—è¡¨  \n      matchExpressions   æŒ‰èŠ‚ç‚¹æ ‡ç­¾åˆ—å‡ºçš„èŠ‚ç‚¹é€‰æ‹©å™¨è¦æ±‚åˆ—è¡¨(æ¨è)\n        key    é”®\n        values å€¼\n        operator å…³ç³»ç¬¦ æ”¯æŒExists, DoesNotExist, In, NotIn, Gt, Lt\n  preferredDuringSchedulingIgnoredDuringExecution ä¼˜å…ˆè°ƒåº¦åˆ°æ»¡è¶³æŒ‡å®šçš„è§„åˆ™çš„Nodeï¼Œç›¸å½“äºè½¯é™åˆ¶ (å€¾å‘)     \n    preference   ä¸€ä¸ªèŠ‚ç‚¹é€‰æ‹©å™¨é¡¹ï¼Œä¸ç›¸åº”çš„æƒé‡ç›¸å…³è”\n      matchFields æŒ‰èŠ‚ç‚¹å­—æ®µåˆ—å‡ºçš„èŠ‚ç‚¹é€‰æ‹©å™¨è¦æ±‚åˆ—è¡¨\n      matchExpressions   æŒ‰èŠ‚ç‚¹æ ‡ç­¾åˆ—å‡ºçš„èŠ‚ç‚¹é€‰æ‹©å™¨è¦æ±‚åˆ—è¡¨(æ¨è)\n        key é”®\n        values å€¼\n        operator å…³ç³»ç¬¦ æ”¯æŒIn, NotIn, Exists, DoesNotExist, Gt, Lt  \n    weight å€¾å‘æƒé‡ï¼Œåœ¨èŒƒå›´1-100ã€‚\n```\n\nå…³ç³»ç¬¦çš„ä½¿ç”¨è¯´æ˜:\n\n```yaml\n- matchExpressions:\n    - key: nodeenv # åŒ¹é…å­˜åœ¨æ ‡ç­¾çš„keyä¸ºnodeenvçš„èŠ‚ç‚¹\n      operator: Exists   \n    - key: nodeenv # åŒ¹é…æ ‡ç­¾çš„keyä¸ºnodeenv,ä¸”valueæ˜¯\"xxx\"æˆ–\"yyy\"çš„èŠ‚ç‚¹\n      operator: In    \n      values: [\"xxx\",\"yyy\"]\n    - key: nodeenv # åŒ¹é…æ ‡ç­¾çš„keyä¸ºnodeenv,ä¸”valueå¤§äº\"xxx\"çš„èŠ‚ç‚¹\n      operator: Gt   \n      values: \"xxx\"\n```\n\næ¼”ç¤ºrequiredDuringSchedulingIgnoredDuringExecutionï¼š\nâ—‹åˆ›å»ºpod-nodeaffinity-required.yamlæ–‡ä»¶ï¼Œå†…å®¹å¦‚ä¸‹ï¼š\n\n```yaml\napiVersion: v1\nkind: Pod\nmetadata:\n  name: pod-nodeaffinity-required\n  namespace: dev\nspec:\n  containers: # å®¹å™¨é…ç½®\n    - name: nginx\n      image: nginx:1.17.1\n      imagePullPolicy: IfNotPresent\n      ports:\n        - name: nginx-port\n          containerPort: 80\n          protocol: TCP\n  affinity: # äº²å’Œæ€§é…ç½®\n    nodeAffinity: # nodeäº²å’Œæ€§é…ç½®\n      requiredDuringSchedulingIgnoredDuringExecution: # NodeèŠ‚ç‚¹å¿…é¡»æ»¡è¶³æŒ‡å®šçš„æ‰€æœ‰è§„åˆ™æ‰å¯ä»¥ï¼Œç›¸å½“äºç¡¬è§„åˆ™ï¼Œç±»ä¼¼äºå®šå‘è°ƒåº¦\n        nodeSelectorTerms: # èŠ‚ç‚¹é€‰æ‹©åˆ—è¡¨\n          - matchExpressions:\n              - key: nodeenv # åŒ¹é…å­˜åœ¨æ ‡ç­¾çš„keyä¸ºnodeenvçš„èŠ‚ç‚¹ï¼Œå¹¶ä¸”valueæ˜¯\"xxx\"æˆ–\"yyy\"çš„èŠ‚ç‚¹\n                operator: In\n                values:\n                  - \"xxx\"\n                  - \"yyy\"\n```\n\n> nodeAffinityçš„æ³¨æ„äº‹é¡¹ï¼š\n> \n> - å¦‚æœåŒæ—¶å®šä¹‰äº†nodeSelectorå’ŒnodeAffinityï¼Œé‚£ä¹ˆå¿…é¡»ä¸¤ä¸ªæ¡ä»¶éƒ½æ»¡è¶³ï¼ŒPodæ‰èƒ½è¿è¡Œåœ¨æŒ‡å®šçš„Nodeä¸Šã€‚\n> - å¦‚æœnodeAffinityæŒ‡å®šäº†å¤šä¸ªnodeSelectorTermsï¼Œé‚£ä¹ˆåªéœ€è¦å…¶ä¸­ä¸€ä¸ªèƒ½å¤ŸåŒ¹é…æˆåŠŸå³å¯ã€‚\n> - å¦‚æœä¸€ä¸ªnodeSelectorTermsä¸­æœ‰å¤šä¸ªmatchExpressionsï¼Œåˆ™ä¸€ä¸ªèŠ‚ç‚¹å¿…é¡»æ»¡è¶³æ‰€æœ‰çš„æ‰èƒ½åŒ¹é…æˆåŠŸã€‚\n> - å¦‚æœä¸€ä¸ªPodæ‰€åœ¨çš„Nodeåœ¨Podè¿è¡ŒæœŸé—´å…¶æ ‡ç­¾å‘ç”Ÿäº†æ”¹å˜ï¼Œä¸å†ç¬¦åˆè¯¥Podçš„nodeAffinityçš„è¦æ±‚ï¼Œåˆ™ç³»ç»Ÿå°†å¿½ç•¥æ­¤å˜åŒ–ã€‚\n\n##### podAffinityï¼ˆpodäº²å’Œæ€§ï¼‰\n\npodAffinityä¸»è¦å®ç°ä»¥è¿è¡Œçš„Podä¸ºå‚ç…§ï¼Œå®ç°è®©æ–°åˆ›å»ºçš„Podå’Œå‚ç…§çš„Podåœ¨ä¸€ä¸ªåŒºåŸŸçš„åŠŸèƒ½ã€‚\nPodAffinityçš„å¯é€‰é…ç½®é¡¹ï¼š\n\n```yaml\npod.spec.affinity.podAffinity\n  requiredDuringSchedulingIgnoredDuringExecution  ç¡¬é™åˆ¶\n    namespaces æŒ‡å®šå‚ç…§podçš„namespace\n    topologyKey æŒ‡å®šè°ƒåº¦ä½œç”¨åŸŸ\n    labelSelector æ ‡ç­¾é€‰æ‹©å™¨\n      matchExpressions  æŒ‰èŠ‚ç‚¹æ ‡ç­¾åˆ—å‡ºçš„èŠ‚ç‚¹é€‰æ‹©å™¨è¦æ±‚åˆ—è¡¨(æ¨è)\n        key    é”®\n        values å€¼\n        operator å…³ç³»ç¬¦ æ”¯æŒIn, NotIn, Exists, DoesNotExist.\n      matchLabels    æŒ‡å¤šä¸ªmatchExpressionsæ˜ å°„çš„å†…å®¹  \n  preferredDuringSchedulingIgnoredDuringExecution è½¯é™åˆ¶    \n    podAffinityTerm  é€‰é¡¹\n      namespaces\n      topologyKey\n      labelSelector\n         matchExpressions \n            key    é”®  \n            values å€¼  \n            operator\n         matchLabels \n    weight å€¾å‘æƒé‡ï¼Œåœ¨èŒƒå›´1-1\n```\n\n> topologyKeyç”¨äºæŒ‡å®šè°ƒåº¦çš„ä½œç”¨åŸŸï¼Œä¾‹å¦‚:\n> \n> - å¦‚æœæŒ‡å®šä¸ºkubernetes.io/hostnameï¼Œé‚£å°±æ˜¯ä»¥NodeèŠ‚ç‚¹ä¸ºåŒºåˆ†èŒƒå›´ã€‚\n> - å¦‚æœæŒ‡å®šä¸ºbeta.kubernetes.io/osï¼Œåˆ™ä»¥NodeèŠ‚ç‚¹çš„æ“ä½œç³»ç»Ÿç±»å‹æ¥åŒºåˆ†ã€‚\n\næ¼”ç¤ºrequiredDuringSchedulingIgnoredDuringExecutionã€‚\nåˆ›å»ºpod-podaffinity-requred.yamlæ–‡ä»¶ï¼Œå†…å®¹å¦‚ä¸‹ï¼š\n\n```yaml\napiVersion: v1\nkind: Pod\nmetadata:\n  name: pod-podaffinity-requred\n  namespace: dev\nspec:\n  containers: # å®¹å™¨é…ç½®\n    - name: nginx\n      image: nginx:1.17.1\n      imagePullPolicy: IfNotPresent\n      ports:\n        - name: nginx-port\n          containerPort: 80\n          protocol: TCP\n  affinity: # äº²å’Œæ€§é…ç½®\n    podAffinity: # Podäº²å’Œæ€§\n      requiredDuringSchedulingIgnoredDuringExecution: # ç¡¬é™åˆ¶\n        - labelSelector:\n            matchExpressions: # è¯¥Podå¿…é¡»å’Œæ‹¥æœ‰æ ‡ç­¾podenv=xxxæˆ–è€…podenv=yyyçš„Podåœ¨åŒä¸€ä¸ªNodeä¸Šï¼Œæ˜¾ç„¶æ²¡æœ‰è¿™æ ·çš„Pod\n              - key: podenv\n                operator: In\n                values:\n                  - \"xxx\"\n                  - \"yyy\"\n          topologyKey: kubernetes.io/hostname\n```\n\n##### podAntiAffinityï¼ˆpodåäº²å’Œæ€§ï¼‰\n\npodAntiAffinityä¸»è¦å®ç°ä»¥è¿è¡Œçš„Podä¸ºå‚ç…§ï¼Œè®©æ–°åˆ›å»ºçš„Podå’Œå‚ç…§çš„Podä¸åœ¨ä¸€ä¸ªåŒºåŸŸçš„åŠŸèƒ½ã€‚\nå…¶é…ç½®æ–¹å¼å’ŒpodAffinityä¸€æ ·ã€‚\n\n```yaml\napiVersion: v1\nkind: Pod\nmetadata:\n  name: pod-podantiaffinity-requred\n  namespace: dev\nspec:\n  containers: # å®¹å™¨é…ç½®\n    - name: nginx\n      image: nginx:1.17.1\n      imagePullPolicy: IfNotPresent\n      ports:\n        - name: nginx-port\n          containerPort: 80\n          protocol: TCP\n  affinity: # äº²å’Œæ€§é…ç½®\n    podAntiAffinity: # Podåäº²å’Œæ€§\n      requiredDuringSchedulingIgnoredDuringExecution: # ç¡¬é™åˆ¶\n        - labelSelector:\n            matchExpressions:\n              - key: podenv\n                operator: In\n                values:\n                  - \"pro\"\n          topologyKey: kubernetes.io/hostname\n```\n\n#### æ±¡ç‚¹å’Œå®¹å¿\n\n##### æ±¡ç‚¹ï¼ˆTaintsï¼‰\n\nå‰é¢çš„è°ƒåº¦æ–¹å¼éƒ½æ˜¯ç«™åœ¨Podçš„è§’åº¦ä¸Šï¼Œé€šè¿‡åœ¨Podä¸Šæ·»åŠ å±æ€§ï¼Œæ¥ç¡®å®šPodæ˜¯å¦è¦è°ƒåº¦åˆ°æŒ‡å®šçš„Nodeä¸Šï¼Œå…¶å®æˆ‘ä»¬ä¹Ÿå¯ä»¥ç«™åœ¨Nodeçš„è§’åº¦ä¸Šï¼Œé€šè¿‡åœ¨Nodeä¸Šæ·»åŠ æ±¡ç‚¹å±æ€§ï¼Œæ¥å†³å®šæ˜¯å¦è¿è¡ŒPodè°ƒåº¦è¿‡æ¥ã€‚\nNodeè¢«è®¾ç½®äº†æ±¡ç‚¹ä¹‹åå°±å’ŒPodä¹‹é—´å­˜åœ¨äº†ä¸€ç§ç›¸æ–¥çš„å…³ç³»ï¼Œè¿›è€Œæ‹’ç»Podè°ƒåº¦è¿›æ¥ï¼Œç”šè‡³å¯ä»¥å°†å·²ç»å­˜åœ¨çš„Podé©±é€å‡ºå»ã€‚\næ±¡ç‚¹çš„æ ¼å¼ä¸ºï¼škey=value:effectï¼Œkeyå’Œvalueæ˜¯æ±¡ç‚¹çš„æ ‡ç­¾ï¼Œeffectæè¿°æ±¡ç‚¹çš„ä½œç”¨ï¼Œæ”¯æŒå¦‚ä¸‹ä¸‰ä¸ªé€‰é¡¹ï¼š\n\n- PreferNoScheduleï¼škuberneteså°†å°½é‡é¿å…æŠŠPodè°ƒåº¦åˆ°å…·æœ‰è¯¥æ±¡ç‚¹çš„Nodeä¸Šï¼Œé™¤éæ²¡æœ‰å…¶ä»–èŠ‚ç‚¹å¯ä»¥è°ƒåº¦ã€‚\n- NoScheduleï¼škuberneteså°†ä¸ä¼šæŠŠPodè°ƒåº¦åˆ°å…·æœ‰è¯¥æ±¡ç‚¹çš„Nodeä¸Šï¼Œä½†æ˜¯ä¸ä¼šå½±å“å½“å‰Nodeä¸Šå·²ç»å­˜åœ¨çš„Podã€‚\n- NoExecuteï¼škuberneteså°†ä¸ä¼šæŠŠPodè°ƒåº¦åˆ°å…·æœ‰è¯¥æ±¡ç‚¹çš„Nodeä¸Šï¼ŒåŒæ—¶ä¹Ÿä¼šå°†Nodeä¸Šå·²ç»å­˜åœ¨çš„Podé©±é€ã€‚\n\n![æ±¡ç‚¹çš„ä¸‰ç§æ ¼å¼.png](KubernetesçŸ¥è¯†æ¢³ç†-æ ¸å¿ƒç»„ä»¶/2.webp)\n\n##### å®¹å¿ï¼ˆTolerationï¼‰\n\nä¸Šé¢ä»‹ç»äº†æ±¡ç‚¹çš„ä½œç”¨ï¼Œæˆ‘ä»¬å¯ä»¥åœ¨Nodeä¸Šæ·»åŠ æ±¡ç‚¹ç”¨æ¥æ‹’ç»Podè°ƒåº¦ä¸Šæ¥ï¼Œä½†æ˜¯å¦‚æœå°±æ˜¯æƒ³è®©ä¸€ä¸ªPodè°ƒåº¦åˆ°ä¸€ä¸ªæœ‰æ±¡ç‚¹çš„Nodeä¸Šå»ï¼Œè¿™æ—¶å€™åº”è¯¥æ€ä¹ˆåšï¼Ÿè¿™å°±éœ€è¦ä½¿ç”¨åˆ°å®¹å¿ã€‚\n\n> æ±¡ç‚¹å°±æ˜¯æ‹’ç»ï¼Œå®¹å¿å°±æ˜¯å¿½ç•¥ï¼ŒNodeé€šè¿‡æ±¡ç‚¹æ‹’ç»Podè°ƒåº¦ä¸Šå»ï¼ŒPodé€šè¿‡å®¹å¿å¿½ç•¥æ‹’ç»ã€‚\n\nå®¹å¿çš„è¯¦ç»†é…ç½®ï¼š\n\n```yaml\nkubectl explain pod.spec.tolerations\n......\nFIELDS:\n  key       # å¯¹åº”ç€è¦å®¹å¿çš„æ±¡ç‚¹çš„é”®ï¼Œç©ºæ„å‘³ç€åŒ¹é…æ‰€æœ‰çš„é”®\n  value     # å¯¹åº”ç€è¦å®¹å¿çš„æ±¡ç‚¹çš„å€¼\n  operator  # key-valueçš„è¿ç®—ç¬¦ï¼Œæ”¯æŒEqualå’ŒExistsï¼ˆé»˜è®¤ï¼‰\n  effect    # å¯¹åº”æ±¡ç‚¹çš„effectï¼Œç©ºæ„å‘³ç€åŒ¹é…æ‰€æœ‰å½±å“\n  tolerationSeconds   # å®¹å¿æ—¶é—´, å½“effectä¸ºNoExecuteæ—¶ç”Ÿæ•ˆï¼Œè¡¨ç¤ºpodåœ¨Nodeä¸Šçš„åœç•™æ—¶é—´\n```\n\n> å½“operatorä¸ºEqualçš„æ—¶å€™ï¼Œå¦‚æœNodeèŠ‚ç‚¹æœ‰å¤šä¸ªTaintï¼Œé‚£ä¹ˆPodæ¯ä¸ªTaintéƒ½éœ€è¦å®¹å¿æ‰èƒ½éƒ¨ç½²ä¸Šå»ã€‚\n> å½“operatorä¸ºExistsçš„æ—¶å€™ï¼Œæœ‰å¦‚ä¸‹çš„ä¸‰ç§å†™æ³•ï¼š\n> \n> - å®¹å¿æŒ‡å®šçš„æ±¡ç‚¹ï¼Œæ±¡ç‚¹å¸¦æœ‰æŒ‡å®šçš„effectï¼š\n> - å®¹å¿æŒ‡å®šçš„æ±¡ç‚¹ï¼Œä¸è€ƒè™‘å…·ä½“çš„effectï¼š\n> - å®¹å¿ä¸€åˆ‡æ±¡ç‚¹ï¼ˆæ…ç”¨ï¼‰ï¼š\n\n```yaml\n  tolerations: # å®¹å¿\n    - key: \"tag\" # è¦å®¹å¿çš„æ±¡ç‚¹çš„key\n      operator: Exists # æ“ä½œç¬¦\n      effect: NoExecute # æ·»åŠ å®¹å¿çš„è§„åˆ™ï¼Œè¿™é‡Œå¿…é¡»å’Œæ ‡è®°çš„æ±¡ç‚¹è§„åˆ™ç›¸åŒ\n```\n\n```yaml\n  tolerations: # å®¹å¿\n    - key: \"tag\" # è¦å®¹å¿çš„æ±¡ç‚¹çš„key\n      operator: Exists # æ“ä½œç¬¦\n```\n\n```yaml\n tolerations: # å®¹å¿\n    - operator: Exists # æ“ä½œç¬¦\n```\n\n### Podæ§åˆ¶å™¨\n\nåœ¨kubernetesä¸­ï¼ŒæŒ‰ç…§Podçš„åˆ›å»ºæ–¹å¼å¯ä»¥å°†å…¶åˆ†ä¸ºä¸¤ç±»ï¼š\n\n- è‡ªä¸»å¼Podï¼škubernetesç›´æ¥åˆ›å»ºå‡ºæ¥çš„Podï¼Œè¿™ç§Podåˆ é™¤åå°±æ²¡æœ‰äº†ï¼Œä¹Ÿä¸ä¼šé‡å»ºã€‚\n- æ§åˆ¶å™¨åˆ›å»ºPodï¼šé€šè¿‡Podæ§åˆ¶å™¨åˆ›å»ºçš„Podï¼Œè¿™ç§Podåˆ é™¤ä¹‹åè¿˜ä¼šè‡ªåŠ¨é‡å»ºã€‚\n\nPodæ§åˆ¶å™¨ï¼šPodæ§åˆ¶å™¨æ˜¯ç®¡ç†Podçš„ä¸­é—´å±‚ï¼Œä½¿ç”¨äº†Podæ§åˆ¶å™¨ä¹‹åï¼Œæˆ‘ä»¬åªéœ€è¦å‘Šè¯‰Podæ§åˆ¶å™¨ï¼Œæƒ³è¦å¤šå°‘ä¸ªä»€ä¹ˆæ ·çš„Podå°±å¯ä»¥äº†ï¼Œå®ƒå°±ä¼šåˆ›å»ºå‡ºæ»¡è¶³æ¡ä»¶çš„Podå¹¶ç¡®ä¿æ¯ä¸€ä¸ªPodå¤„äºç”¨æˆ·æœŸæœ›çš„çŠ¶æ€ï¼Œå¦‚æœPodåœ¨è¿è¡Œä¸­å‡ºç°æ•…éšœï¼Œæ§åˆ¶å™¨ä¼šåŸºäºæŒ‡å®šçš„ç­–ç•¥é‡å¯æˆ–é‡å»ºPodã€‚\nåœ¨kubernetesä¸­ï¼Œæœ‰å¾ˆå¤šç±»å‹çš„Podæ§åˆ¶å™¨ï¼Œæ¯ç§éƒ½æœ‰è‡ªå·±çš„é€‚åˆçš„åœºæ™¯ï¼Œå¸¸è§çš„æœ‰ä¸‹é¢è¿™äº›ï¼š\n\n- ReplicationControllerï¼šæ¯”è¾ƒåŸå§‹çš„Podæ§åˆ¶å™¨ï¼Œå·²ç»è¢«åºŸå¼ƒï¼Œç”±ReplicaSetæ›¿ä»£ã€‚\n- ReplicaSetï¼šä¿è¯æŒ‡å®šæ•°é‡çš„Podè¿è¡Œï¼Œå¹¶æ”¯æŒPodæ•°é‡å˜æ›´ï¼Œé•œåƒç‰ˆæœ¬å˜æ›´ã€‚\n- Deploymentï¼šé€šè¿‡æ§åˆ¶ReplicaSetæ¥æ§åˆ¶Podï¼Œå¹¶æ”¯æŒæ»šåŠ¨å‡çº§ã€ç‰ˆæœ¬å›é€€ã€‚\n- Horizontal Pod Autoscalerï¼šå¯ä»¥æ ¹æ®é›†ç¾¤è´Ÿè½½è‡ªåŠ¨è°ƒæ•´Podçš„æ•°é‡ï¼Œå®ç°å‰Šå³°å¡«è°·ã€‚\n- DaemonSetï¼šåœ¨é›†ç¾¤ä¸­çš„æŒ‡å®šNodeä¸Šéƒ½è¿è¡Œä¸€ä¸ªå‰¯æœ¬ï¼Œä¸€èˆ¬ç”¨äºå®ˆæŠ¤è¿›ç¨‹ç±»çš„ä»»åŠ¡ã€‚\n- Jobï¼šå®ƒåˆ›å»ºå‡ºæ¥çš„Podåªè¦å®Œæˆä»»åŠ¡å°±ç«‹å³é€€å‡ºï¼Œç”¨äºæ‰§è¡Œä¸€æ¬¡æ€§ä»»åŠ¡ã€‚\n- CronJobï¼šå®ƒåˆ›å»ºçš„Podä¼šå‘¨æœŸæ€§çš„æ‰§è¡Œï¼Œç”¨äºæ‰§è¡Œå‘¨æœŸæ€§çš„ä»»åŠ¡ã€‚\n- StatefulSetï¼šç®¡ç†æœ‰çŠ¶æ€çš„åº”ç”¨ã€‚\n\n#### ReplicaSetï¼ˆRSï¼‰\n\nReplicaSetçš„ä¸»è¦ä½œç”¨æ˜¯ä¿è¯ä¸€å®šæ•°é‡çš„Podèƒ½å¤Ÿæ­£å¸¸è¿è¡Œï¼Œå®ƒä¼šæŒç»­ç›‘å¬è¿™äº›Podçš„è¿è¡ŒçŠ¶æ€ï¼Œä¸€æ—¦Podå‘ç”Ÿæ•…éšœï¼Œå°±ä¼šé‡å¯æˆ–é‡å»ºã€‚åŒæ—¶å®ƒè¿˜æ”¯æŒå¯¹Podæ•°é‡çš„æ‰©ç¼©å®¹ã€‚\n\n![image-20250327184456480](KubernetesçŸ¥è¯†æ¢³ç†-æ ¸å¿ƒç»„ä»¶/3.png)\n\nReplicaSetçš„èµ„æºæ¸…å•æ–‡ä»¶ï¼š\n\n```yaml\napiVersion: apps/v1 # ç‰ˆæœ¬å· \nkind: ReplicaSet # ç±»å‹ \nmetadata: # å…ƒæ•°æ® \n  name: # rsåç§°\n  namespace: # æ‰€å±å‘½åç©ºé—´ \n  labels: #æ ‡ç­¾ \n    controller: rs \nspec: # è¯¦æƒ…æè¿° \n  replicas: 3 # å‰¯æœ¬æ•°é‡ \n  selector: # é€‰æ‹©å™¨ï¼Œé€šè¿‡å®ƒæŒ‡å®šè¯¥æ§åˆ¶å™¨ç®¡ç†å“ªäº›po\n    matchLabels: # LabelsåŒ¹é…è§„åˆ™ \n      app: nginx-pod \n    matchExpressions: # ExpressionsåŒ¹é…è§„åˆ™ \n      - {key: app, operator: In, values: [nginx-pod]} \ntemplate: # æ¨¡æ¿ï¼Œå½“å‰¯æœ¬æ•°é‡ä¸è¶³æ—¶ï¼Œä¼šæ ¹æ®ä¸‹é¢çš„æ¨¡æ¿åˆ›å»ºpodå‰¯æœ¬ \n  metadata: \n    labels: \n      app: nginx-pod \n  spec: \n    containers: \n      - name: nginx \n        image: nginx:1.17.1 \n        ports: \n        - containerPort: 80\n```\n\nåœ¨è¿™é‡Œï¼Œéœ€è¦æ–°äº†è§£çš„é…ç½®é¡¹å°±æ˜¯specä¸‹é¢å‡ ä¸ªé€‰é¡¹ï¼š\n\n- replicasï¼šæŒ‡å®šå‰¯æœ¬æ•°é‡ï¼Œå…¶å®å°±æ˜¯å½“ç„¶rsåˆ›å»ºå‡ºæ¥çš„Podçš„æ•°é‡ï¼Œé»˜è®¤ä¸º1.\n- selectorï¼šé€‰æ‹©å™¨ï¼Œå®ƒçš„ä½œç”¨æ˜¯å»ºç«‹Podæ§åˆ¶å™¨å’ŒPodä¹‹é—´çš„å…³è”å…³ç³»ï¼Œé‡‡ç”¨äº†Label Selectoræœºåˆ¶ï¼ˆåœ¨Podæ¨¡å—ä¸Šå®šä¹‰Labelï¼Œåœ¨æ§åˆ¶å™¨ä¸Šå®šä¹‰é€‰æ‹©å™¨ï¼Œå°±å¯ä»¥è¡¨æ˜å½“å‰æ§åˆ¶å™¨èƒ½ç®¡ç†å“ªäº›Podäº†ï¼‰ã€‚\n- templateï¼šæ¨¡æ¿ï¼Œå°±æ˜¯å½“å‰æ§åˆ¶å™¨åˆ›å»ºPodæ‰€ä½¿ç”¨çš„æ¨¡æ¿ï¼Œé‡Œé¢å…¶å®å°±æ˜¯å‰é¢å­¦è¿‡çš„Podçš„å®šä¹‰ã€‚\n\n#### Deploymentï¼ˆDeployï¼‰\n\nä¸ºäº†æ›´å¥½çš„è§£å†³æœåŠ¡ç¼–æ’çš„é—®é¢˜ï¼Œkubernetesåœ¨v1.2ç‰ˆæœ¬å¼€å§‹ï¼Œå¼•å…¥äº†Deploymentæ§åˆ¶å™¨ã€‚å€¼å¾—ä¸€æçš„æ˜¯ï¼ŒDeploymentæ§åˆ¶å™¨å¹¶ä¸ç›´æ¥ç®¡ç†Podï¼Œè€Œæ˜¯é€šè¿‡ç®¡ç†ReplicaSetæ¥é—´æ¥ç®¡ç†Podï¼Œå³ï¼šDeploymentç®¡ç†ReplicaSetï¼ŒReplicaSetç®¡ç†Podã€‚æ‰€ä»¥Deploymentçš„åŠŸèƒ½æ¯”ReplicaSetå¼ºå¤§ã€‚\n\n![image-20250327184720728](KubernetesçŸ¥è¯†æ¢³ç†-æ ¸å¿ƒç»„ä»¶/4.png)\n\nDeploymentçš„ä¸»è¦åŠŸèƒ½å¦‚ä¸‹ï¼š\n\n- æ”¯æŒReplicaSetçš„æ‰€æœ‰åŠŸèƒ½ã€‚\n- æ”¯æŒå‘å¸ƒçš„åœæ­¢ã€ç»§ç»­ã€‚\n- æ”¯æŒç‰ˆæœ¬æ»šåŠ¨æ›´æ–°å’Œç‰ˆæœ¬å›é€€ã€‚\n\nDeploymentçš„èµ„æºæ¸…å•ï¼š\n\n```yaml\napiVersion: apps/v1 # ç‰ˆæœ¬å· \nkind: Deployment # ç±»å‹ \nmetadata: # å…ƒæ•°æ® \n  name: # rsåç§° \n  namespace: # æ‰€å±å‘½åç©ºé—´ \n  labels: #æ ‡ç­¾ \n    controller: deploy \nspec: # è¯¦æƒ…æè¿° \n  replicas: 3 # å‰¯æœ¬æ•°é‡ \n  revisionHistoryLimit: 3 # ä¿ç•™å†å²ç‰ˆæœ¬ï¼Œé»˜è®¤ä¸º10 \n  paused: false # æš‚åœéƒ¨ç½²ï¼Œé»˜è®¤æ˜¯false \n  progressDeadlineSeconds: 600 # éƒ¨ç½²è¶…æ—¶æ—¶é—´ï¼ˆsï¼‰ï¼Œé»˜è®¤æ˜¯600 \n  strategy: # ç­–ç•¥ \n    type: RollingUpdate # æ»šåŠ¨æ›´æ–°ç­–ç•¥ \n    rollingUpdate: # æ»šåŠ¨æ›´æ–° \n      maxSurge: 30% # æœ€å¤§é¢å¤–å¯ä»¥å­˜åœ¨çš„å‰¯æœ¬æ•°ï¼Œå¯ä»¥ä¸ºç™¾åˆ†æ¯”ï¼Œä¹Ÿå¯ä»¥ä¸ºæ•´æ•° maxUnavailable: 30% # æœ€å¤§ä¸å¯ç”¨çŠ¶æ€çš„    Pod çš„æœ€å¤§å€¼ï¼Œå¯ä»¥ä¸ºç™¾åˆ†æ¯”ï¼Œä¹Ÿå¯ä»¥ä¸ºæ•´æ•° \n  selector: # é€‰æ‹©å™¨ï¼Œé€šè¿‡å®ƒæŒ‡å®šè¯¥æ§åˆ¶å™¨ç®¡ç†å“ªäº›pod \n    matchLabels: # LabelsåŒ¹é…è§„åˆ™ \n      app: nginx-pod \n    matchExpressions: # ExpressionsåŒ¹é…è§„åˆ™ \n      - {key: app, operator: In, values: [nginx-pod]} \n  template: # æ¨¡æ¿ï¼Œå½“å‰¯æœ¬æ•°é‡ä¸è¶³æ—¶ï¼Œä¼šæ ¹æ®ä¸‹é¢çš„æ¨¡æ¿åˆ›å»ºpodå‰¯æœ¬ \n    metadata: \n      labels: \n        app: nginx-pod \n    spec: \n      containers: \n      - name: nginx \n        image: nginx:1.17.1 \n        ports: \n        - containerPort: 80\n```\n\nDeploymentæ”¯æŒä¸¤ç§é•œåƒæ›´æ–°çš„ç­–ç•¥ï¼šé‡å»ºæ›´æ–°å’Œæ»šåŠ¨æ›´æ–°ï¼ˆé»˜è®¤ï¼‰ï¼Œå¯ä»¥é€šè¿‡strategyé€‰é¡¹è¿›è¡Œé…ç½®ã€‚\n\n```yaml\nstrategy: æŒ‡å®šæ–°çš„Podæ›¿ä»£æ—§çš„Podçš„ç­–ç•¥ï¼Œæ”¯æŒä¸¤ä¸ªå±æ€§\n  type: æŒ‡å®šç­–ç•¥ç±»å‹ï¼Œæ”¯æŒä¸¤ç§ç­–ç•¥\n    Recreateï¼šåœ¨åˆ›å»ºå‡ºæ–°çš„Podä¹‹å‰ä¼šå…ˆæ€æ‰æ‰€æœ‰å·²ç»å­˜åœ¨çš„Pod\n    RollingUpdateï¼šæ»šåŠ¨æ›´æ–°ï¼Œå°±æ˜¯æ€æ­»ä¸€éƒ¨åˆ†ï¼Œå°±å¯åŠ¨ä¸€éƒ¨åˆ†ï¼Œåœ¨æ›´æ–°è¿‡ç¨‹ä¸­ï¼Œå­˜åœ¨ä¸¤ä¸ªç‰ˆæœ¬çš„Pod\n  rollingUpdateï¼šå½“typeä¸ºRollingUpdateçš„æ—¶å€™ç”Ÿæ•ˆï¼Œç”¨äºä¸ºrollingUpdateè®¾ç½®å‚æ•°ï¼Œæ”¯æŒä¸¤ä¸ªå±æ€§ï¼š\n    maxUnavailableï¼šç”¨æ¥æŒ‡å®šåœ¨å‡çº§è¿‡ç¨‹ä¸­ä¸å¯ç”¨çš„Podçš„æœ€å¤§æ•°é‡ï¼Œé»˜è®¤ä¸º25%ã€‚\n    maxSurgeï¼š ç”¨æ¥æŒ‡å®šåœ¨å‡çº§è¿‡ç¨‹ä¸­å¯ä»¥è¶…è¿‡æœŸæœ›çš„Podçš„æœ€å¤§æ•°é‡ï¼Œé»˜è®¤ä¸º25%ã€‚\n```\n\nDeploymentæ”¯æŒç‰ˆæœ¬å‡çº§è¿‡ç¨‹ä¸­çš„æš‚åœã€ç»§ç»­åŠŸèƒ½ä»¥åŠç‰ˆæœ¬å›é€€ç­‰è¯¸å¤šåŠŸèƒ½ï¼Œä¸‹é¢å…·ä½“æ¥çœ‹ï¼š\n\n```yaml\n# ç‰ˆæœ¬å‡çº§ç›¸å…³åŠŸèƒ½\nkubetl rollout å‚æ•° deploy xx  # æ”¯æŒä¸‹é¢çš„é€‰æ‹©\n# status æ˜¾ç¤ºå½“å‰å‡çº§çš„çŠ¶æ€\n# history æ˜¾ç¤ºå‡çº§å†å²è®°å½•\n# pause æš‚åœç‰ˆæœ¬å‡çº§è¿‡ç¨‹\n# resume ç»§ç»­å·²ç»æš‚åœçš„ç‰ˆæœ¬å‡çº§è¿‡ç¨‹\n# restart é‡å¯ç‰ˆæœ¬å‡çº§è¿‡ç¨‹\n# undo å›æ»šåˆ°ä¸Šä¸€çº§ç‰ˆæœ¬ ï¼ˆå¯ä»¥ä½¿ç”¨--to-revisionå›æ»šåˆ°æŒ‡å®šçš„ç‰ˆæœ¬ï¼‰\n```\n\n> deploymentä¹‹æ‰€ä»¥èƒ½å¤Ÿå®ç°ç‰ˆæœ¬çš„å›é€€ï¼Œå°±æ˜¯é€šè¿‡è®°å½•ä¸‹å†å²çš„ReplicaSetæ¥å®ç°çš„ï¼Œä¸€æ—¦æƒ³å›æ»šåˆ°é‚£ä¸ªç‰ˆæœ¬ï¼Œåªéœ€è¦å°†å½“å‰ç‰ˆæœ¬çš„Podæ•°é‡é™ä¸º0ï¼Œç„¶åå°†å›é€€ç‰ˆæœ¬çš„Podæå‡ä¸ºç›®æ ‡æ•°é‡å³å¯ã€‚\n\n#### é‡‘ä¸é›€å‘å¸ƒ\n\nDeploymentæ”¯æŒæ›´æ–°è¿‡ç¨‹ä¸­çš„æ§åˆ¶ï¼Œå¦‚æš‚åœæ›´æ–°æ“ä½œï¼ˆpauseï¼‰æˆ–ç»§ç»­æ›´æ–°æ“ä½œï¼ˆresumeï¼‰ã€‚\nä¾‹å¦‚æœ‰ä¸€æ‰¹æ–°çš„Podèµ„æºåˆ›å»ºå®Œæˆåç«‹å³æš‚åœæ›´æ–°è¿‡ç¨‹ï¼Œæ­¤æ—¶ï¼Œä»…å­˜åœ¨ä¸€éƒ¨åˆ†æ–°ç‰ˆæœ¬çš„åº”ç”¨ï¼Œä¸»ä½“éƒ¨åˆ†è¿˜æ˜¯æ—§çš„ç‰ˆæœ¬ã€‚ç„¶åï¼Œå†ç­›é€‰ä¸€å°éƒ¨åˆ†çš„ç”¨æˆ·è¯·æ±‚åˆ°æ–°ç‰ˆæœ¬çš„Podåº”ç”¨ï¼Œç»§ç»­è§‚å¯Ÿèƒ½å¤Ÿç¨³å®šçš„æŒ‰ç…§æœŸæœ›çš„æ–¹å¼è¿è¡Œï¼Œå¦‚æœæ²¡æœ‰é—®é¢˜ä¹‹åå†ç»§ç»­å®Œæˆä½™ä¸‹çš„Podèµ„æºçš„æ»šåŠ¨æ›´æ–°ï¼Œå¦åˆ™ç«‹å³å›æ»šæ“ä½œã€‚\n\n#### Horizontal Pod Autoscalerï¼ˆHPAï¼‰\n\næˆ‘ä»¬å·²ç»å¯ä»¥é€šè¿‡æ‰‹åŠ¨æ‰§è¡Œkubectl scaleå‘½ä»¤å®ç°Podçš„æ‰©ç¼©å®¹ï¼Œä½†æ˜¯è¿™æ˜¾ç„¶ä¸ç¬¦åˆkubernetesçš„å®šä½ç›®æ ‡â€“è‡ªåŠ¨åŒ–å’Œæ™ºèƒ½åŒ–ã€‚kubernetesæœŸæœ›å¯ä»¥é€šè¿‡ç›‘æµ‹Podçš„ä½¿ç”¨æƒ…å†µï¼Œå®ç°Podæ•°é‡çš„è‡ªåŠ¨è°ƒæ•´ï¼Œäºæ˜¯å°±äº§ç”Ÿäº†HPAè¿™ç§æ§åˆ¶å™¨ã€‚\nHPAå¯ä»¥è·å–æ¯ä¸ªPodçš„åˆ©ç”¨ç‡ï¼Œç„¶åå’ŒHPAä¸­å®šä¹‰çš„æŒ‡æ ‡è¿›è¡Œå¯¹æ¯”ï¼ŒåŒæ—¶è®¡ç®—å‡ºéœ€è¦ä¼¸ç¼©çš„å…·ä½“å€¼ï¼Œæœ€åå®ç°Podçš„æ•°é‡çš„è°ƒæ•´ã€‚å…¶å®HPAå’Œä¹‹å‰çš„Deploymentä¸€æ ·ï¼Œä¹Ÿå±äºä¸€ç§kubernetesèµ„æºå¯¹è±¡ï¼Œå®ƒé€šè¿‡è¿½è¸ªåˆ†æç›®æ ‡Podçš„è´Ÿè½½å˜åŒ–æƒ…å†µï¼Œæ¥ç¡®å®šæ˜¯å¦éœ€è¦é’ˆå¯¹æ€§çš„è°ƒæ•´ç›®æ ‡Podçš„å‰¯æœ¬æ•°ã€‚\n\n![image-20250327185417750](KubernetesçŸ¥è¯†æ¢³ç†-æ ¸å¿ƒç»„ä»¶/5.png)\n\n> è‹¥é›†ç¾¤ä¸­æ²¡æœ‰æ”¶é›†èµ„æºä½¿ç”¨æƒ…å†µçš„ç¨‹åºï¼Œå¯é€‰æ‹©å®‰è£…metrics-server\n\næµ‹è¯•ç¤ºä¾‹ï¼š\n\n```yaml\napiVersion: autoscaling/v1 # ç‰ˆæœ¬å·\nkind: HorizontalPodAutoscaler # ç±»å‹\nmetadata: # å…ƒæ•°æ®\n  name: pc-hpa # deploymentçš„åç§°\n  namespace: dev # å‘½åç±»å‹\nspec:\n  minReplicas: 1 # æœ€å°Podæ•°é‡\n  maxReplicas: 10 # æœ€å¤§Podæ•°é‡\n  targetCPUUtilizationPercentage: 3 # CPUä½¿ç”¨ç‡æŒ‡æ ‡\n  scaleTargetRef:  # æŒ‡å®šè¦æ§åˆ¶çš„Nginxçš„ä¿¡æ¯\n    apiVersion: apps/v1\n    kind: Deployment\n    name: nginx\n```\n\n#### DaemonSetï¼ˆDSï¼‰\n\nDaemonSetç±»å‹çš„æ§åˆ¶å™¨å¯ä»¥ä¿è¯é›†ç¾¤ä¸­çš„æ¯ä¸€å°ï¼ˆæˆ–æŒ‡å®šï¼‰èŠ‚ç‚¹ä¸Šéƒ½è¿è¡Œä¸€ä¸ªå‰¯æœ¬ï¼Œä¸€èˆ¬é€‚ç”¨äºæ—¥å¿—æ”¶é›†ã€èŠ‚ç‚¹ç›‘æ§ç­‰åœºæ™¯ã€‚ä¹Ÿå°±æ˜¯è¯´ï¼Œå¦‚æœä¸€ä¸ªPodæä¾›çš„åŠŸèƒ½æ˜¯èŠ‚ç‚¹çº§åˆ«çš„ï¼ˆæ¯ä¸ªèŠ‚ç‚¹éƒ½éœ€è¦ä¸”åªéœ€è¦ä¸€ä¸ªï¼‰ï¼Œé‚£ä¹ˆè¿™ç±»Podå°±é€‚åˆä½¿ç”¨DaemonSetç±»å‹çš„æ§åˆ¶å™¨åˆ›å»ºã€‚\n\n![image-20250327185800807](KubernetesçŸ¥è¯†æ¢³ç†-æ ¸å¿ƒç»„ä»¶/6.png)\n\nDaemonSetæ§åˆ¶å™¨çš„ç‰¹ç‚¹ï¼š\n\n- æ¯å‘é›†ç¾¤ä¸­æ·»åŠ ä¸€ä¸ªèŠ‚ç‚¹çš„æ—¶å€™ï¼ŒæŒ‡å®šçš„Podå‰¯æœ¬ä¹Ÿå°†æ·»åŠ åˆ°è¯¥èŠ‚ç‚¹ä¸Šã€‚\n- å½“èŠ‚ç‚¹ä»é›†ç¾¤ä¸­ç§»é™¤çš„æ—¶å€™ï¼ŒPodä¹Ÿä¼šè¢«åƒåœ¾å›æ”¶ã€‚\n\nDaemonSetçš„èµ„æºæ¸…å•ï¼š\n\n```yaml\napiVersion: apps/v1 # ç‰ˆæœ¬å·\nkind: DaemonSet # ç±»å‹\nmetadata: # å…ƒæ•°æ®\n  name: # åç§°\n  namespace: #å‘½åç©ºé—´\n  labels: #æ ‡ç­¾\n    controller: daemonset\nspec: # è¯¦æƒ…æè¿°\n  revisionHistoryLimit: 3 # ä¿ç•™å†å²ç‰ˆæœ¬\n  updateStrategy: # æ›´æ–°ç­–ç•¥\n    type: RollingUpdate # æ»šåŠ¨æ›´æ–°ç­–ç•¥\n    rollingUpdate: # æ»šåŠ¨æ›´æ–°\n      maxUnavailable: 1 # æœ€å¤§ä¸å¯ç”¨çŠ¶æ€çš„Podçš„æœ€å¤§å€¼ï¼Œå¯ç”¨ä¸ºç™¾åˆ†æ¯”ï¼Œä¹Ÿå¯ä»¥ä¸ºæ•´æ•°\n  selector: # é€‰æ‹©å™¨ï¼Œé€šè¿‡å®ƒæŒ‡å®šè¯¥æ§åˆ¶å™¨ç®¡ç†é‚£äº›Pod\n    matchLabels: # LabelsåŒ¹é…è§„åˆ™\n      app: nginx-pod\n    matchExpressions: # ExpressionsåŒ¹é…è§„åˆ™\n      - key: app\n        operator: In\n        values:\n          - nginx-pod\n  template: # æ¨¡æ¿ï¼Œå½“å‰¯æœ¬æ•°é‡ä¸è¶³æ—¶ï¼Œä¼šæ ¹æ®ä¸‹é¢çš„æ¨¡æ¿åˆ›å»ºPodæ¨¡æ¿\n     metadata:\n       labels:\n         app: nginx-pod\n     spec:\n       containers:\n         - name: nginx\n           image: nginx:1.17.1\n           ports:\n             - containerPort: 80\n```\n\n#### Job\n\nJobä¸»è¦ç”¨äºè´Ÿè´£æ‰¹é‡å¤„ç†çŸ­æš‚çš„ä¸€æ¬¡æ€§ä»»åŠ¡ã€‚\nJobçš„ç‰¹ç‚¹ï¼š\n\n- å½“Jobåˆ›å»ºçš„Podæ‰§è¡ŒæˆåŠŸç»“æŸæ—¶ï¼ŒJobå°†è®°å½•æˆåŠŸç»“æŸçš„Podæ•°é‡ã€‚\n- å½“æˆåŠŸç»“æŸçš„Podè¾¾åˆ°æŒ‡å®šçš„æ•°é‡æ—¶ï¼ŒJobå°†å®Œæˆæ‰§è¡Œã€‚\n\n> Jobå¯ä»¥ä¿è¯æŒ‡å®šæ•°é‡çš„Podæ‰§è¡Œå®Œæˆã€‚\n\n![image-20250327185958115](KubernetesçŸ¥è¯†æ¢³ç†-æ ¸å¿ƒç»„ä»¶/7.png)\n\nJobçš„èµ„æºæ¸…å•ï¼š\n\n```yaml\napiVersion: batch/v1 # ç‰ˆæœ¬å·\nkind: Job # ç±»å‹\nmetadata: # å…ƒæ•°æ®\n  name:  # åç§°\n  namespace:  #å‘½åç©ºé—´\n  labels: # æ ‡ç­¾\n    controller: job\nspec: # è¯¦æƒ…æè¿°\n  completions: 1 # æŒ‡å®šJobéœ€è¦æˆåŠŸè¿è¡ŒPodçš„æ€»æ¬¡æ•°ï¼Œé»˜è®¤ä¸º1\n  parallelism: 1 # æŒ‡å®šJobåœ¨ä»»ä¸€æ—¶åˆ»åº”è¯¥å¹¶å‘è¿è¡ŒPodçš„æ•°é‡ï¼Œé»˜è®¤ä¸º1\n  activeDeadlineSeconds: 30 # æŒ‡å®šJobå¯ä»¥è¿è¡Œçš„æ—¶é—´æœŸé™ï¼Œè¶…è¿‡æ—¶é—´è¿˜æ²¡ç»“æŸï¼Œç³»ç»Ÿå°†ä¼šå°è¯•è¿›è¡Œç»ˆæ­¢\n  backoffLimit: 6 # æŒ‡å®šJobå¤±è´¥åè¿›è¡Œé‡è¯•çš„æ¬¡æ•°ï¼Œé»˜è®¤ä¸º6\n  manualSelector: true # æ˜¯å¦å¯ä»¥ä½¿ç”¨selectoré€‰æ‹©å™¨é€‰æ‹©Podï¼Œé»˜è®¤ä¸ºfalse\n  selector: # é€‰æ‹©å™¨ï¼Œé€šè¿‡å®ƒæŒ‡å®šè¯¥æ§åˆ¶å™¨ç®¡ç†é‚£äº›Pod\n    matchLabels: # LabelsåŒ¹é…è§„åˆ™\n      app: counter-pod\n    matchExpressions: # ExpressionsåŒ¹é…è§„åˆ™\n      - key: app\n        operator: In\n        values:\n          - counter-pod\n  template: # æ¨¡æ¿ï¼Œå½“å‰¯æœ¬æ•°é‡ä¸è¶³æ—¶ï¼Œä¼šæ ¹æ®ä¸‹é¢çš„æ¨¡æ¿åˆ›å»ºPodæ¨¡æ¿\n     metadata:\n       labels:\n         app: counter-pod\n     spec:\n       restartPolicy: Never # é‡å¯ç­–ç•¥åªèƒ½è®¾ç½®ä¸ºNeveræˆ–OnFailure\n       containers:\n         - name: counter\n           image: busybox:1.30\n           command: [\"/bin/sh\",\"-c\",\"for i in 9 8 7 6 5 4 3 2 1;do echo $i;sleep 20;done\"]\n```\n\n> å…³äºæ¨¡æ¿ä¸­çš„é‡å¯ç­–ç•¥çš„è¯´æ˜ï¼š\n> \n> - å¦‚æœè®¾ç½®ä¸ºOnFailureï¼Œåˆ™Jobä¼šåœ¨Podå‡ºç°æ•…éšœçš„æ—¶å€™é‡å¯å®¹å™¨ï¼Œè€Œä¸æ˜¯åˆ›å»ºPodï¼Œfailedæ¬¡æ•°ä¸å˜ã€‚\n> - å¦‚æœè®¾ç½®ä¸ºNeverï¼Œåˆ™Jobä¼šåœ¨Podå‡ºç°æ•…éšœçš„æ—¶å€™åˆ›å»ºæ–°çš„Podï¼Œå¹¶ä¸”æ•…éšœPodä¸ä¼šæ¶ˆå¤±ï¼Œä¹Ÿä¸ä¼šé‡å¯ï¼Œfailedæ¬¡æ•°+1ã€‚\n> - å¦‚æœæŒ‡å®šä¸ºAlwaysçš„è¯ï¼Œå°±æ„å‘³ç€ä¸€ç›´é‡å¯ï¼Œæ„å‘³ç€Podä»»åŠ¡ä¼šé‡å¤æ‰§è¡Œï¼Œè¿™å’ŒJobçš„å®šä¹‰å†²çªï¼Œæ‰€ä»¥ä¸èƒ½è®¾ç½®ä¸ºAlwaysã€‚\n\n#### CronJobï¼ˆCJï¼‰\n\nCronJobæ§åˆ¶å™¨ä»¥ Jobæ§åˆ¶å™¨èµ„æºä¸ºå…¶ç®¡æ§å¯¹è±¡ï¼Œå¹¶å€ŸåŠ©å®ƒç®¡ç†podèµ„æºå¯¹è±¡ï¼ŒJobæ§åˆ¶å™¨å®šä¹‰çš„ä½œä¸šä»»åŠ¡åœ¨å…¶æ§åˆ¶å™¨èµ„æºåˆ›å»ºä¹‹åä¾¿ä¼šç«‹å³æ‰§è¡Œï¼Œä½†CronJobå¯ä»¥ä»¥ç±»ä¼¼äºLinuxæ“ä½œç³»ç»Ÿçš„å‘¨æœŸæ€§ä»»åŠ¡ä½œä¸šè®¡åˆ’çš„æ–¹å¼æ§åˆ¶å…¶è¿è¡Œ**æ—¶é—´ç‚¹**åŠ**é‡å¤è¿è¡Œ**çš„æ–¹å¼ã€‚ä¹Ÿå°±æ˜¯è¯´ï¼Œ**CronJobå¯ä»¥åœ¨ç‰¹å®šçš„æ—¶é—´ç‚¹(åå¤çš„)å»è¿è¡Œjobä»»åŠ¡**ã€‚\n\nCronJobçš„èµ„æºæ¸…å•æ–‡ä»¶ï¼š\n\n```yaml\napiVersion: batch/v1beta1 # ç‰ˆæœ¬å·\nkind: CronJob # ç±»å‹       \nmetadata: # å…ƒæ•°æ®\n  name: # rsåç§° \n  namespace: # æ‰€å±å‘½åç©ºé—´ \n  labels: #æ ‡ç­¾\n    controller: cronjob\nspec: # è¯¦æƒ…æè¿°\n  schedule: # cronæ ¼å¼çš„ä½œä¸šè°ƒåº¦è¿è¡Œæ—¶é—´ç‚¹,ç”¨äºæ§åˆ¶ä»»åŠ¡åœ¨ä»€ä¹ˆæ—¶é—´æ‰§è¡Œ\n  concurrencyPolicy: # å¹¶å‘æ‰§è¡Œç­–ç•¥ï¼Œç”¨äºå®šä¹‰å‰ä¸€æ¬¡ä½œä¸šè¿è¡Œå°šæœªå®Œæˆæ—¶æ˜¯å¦ä»¥åŠå¦‚ä½•è¿è¡Œåä¸€æ¬¡çš„ä½œä¸š\n  failedJobHistoryLimit: # ä¸ºå¤±è´¥çš„ä»»åŠ¡æ‰§è¡Œä¿ç•™çš„å†å²è®°å½•æ•°ï¼Œé»˜è®¤ä¸º1\n  successfulJobHistoryLimit: # ä¸ºæˆåŠŸçš„ä»»åŠ¡æ‰§è¡Œä¿ç•™çš„å†å²è®°å½•æ•°ï¼Œé»˜è®¤ä¸º3\n  startingDeadlineSeconds: # å¯åŠ¨ä½œä¸šé”™è¯¯çš„è¶…æ—¶æ—¶é•¿\n  jobTemplate: # jobæ§åˆ¶å™¨æ¨¡æ¿ï¼Œç”¨äºä¸ºcronjobæ§åˆ¶å™¨ç”Ÿæˆjobå¯¹è±¡;ä¸‹é¢å…¶å®å°±æ˜¯jobçš„å®šä¹‰\n    metadata:\n    spec:\n      completions: 1\n      parallelism: 1\n      activeDeadlineSeconds: 30\n      backoffLimit: 6\n      manualSelector: true\n      selector:\n        matchLabels:\n          app: counter-pod\n        matchExpressions: è§„åˆ™\n          - {key: app, operator: In, values: [counter-pod]}\n      template:\n        metadata:\n          labels:\n            app: counter-pod\n        spec:\n          restartPolicy: Never \n          containers:\n          - name: counter\n            image: busybox:1.30\n            command: [\"bin/sh\",\"-c\",\"for i in 9 8 7 6 5 4 3 2 1; do echo $i;sleep 20;done\"]\néœ€è¦é‡ç‚¹è§£é‡Šçš„å‡ ä¸ªé€‰é¡¹ï¼š\nschedule: cronè¡¨è¾¾å¼ï¼Œç”¨äºæŒ‡å®šä»»åŠ¡çš„æ‰§è¡Œæ—¶é—´\n    */1    *      *    *     *\n    <åˆ†é’Ÿ> <å°æ—¶> <æ—¥> <æœˆä»½> <æ˜ŸæœŸ>\n\n    åˆ†é’Ÿ å€¼ä» 0 åˆ° 59.\n    å°æ—¶ å€¼ä» 0 åˆ° 23.\n    æ—¥ å€¼ä» 1 åˆ° 31.\n    æœˆ å€¼ä» 1 åˆ° 12.\n    æ˜ŸæœŸ å€¼ä» 0 åˆ° 6, 0 ä»£è¡¨æ˜ŸæœŸæ—¥\n    å¤šä¸ªæ—¶é—´å¯ä»¥ç”¨é€—å·éš”å¼€ï¼› èŒƒå›´å¯ä»¥ç”¨è¿å­—ç¬¦ç»™å‡ºï¼›*å¯ä»¥ä½œä¸ºé€šé…ç¬¦ï¼› /è¡¨ç¤ºæ¯...\nconcurrencyPolicy:\n    Allow:   å…è®¸Jobså¹¶å‘è¿è¡Œ(é»˜è®¤)\n    Forbid:  ç¦æ­¢å¹¶å‘è¿è¡Œï¼Œå¦‚æœä¸Šä¸€æ¬¡è¿è¡Œå°šæœªå®Œæˆï¼Œåˆ™è·³è¿‡ä¸‹ä¸€æ¬¡è¿è¡Œ\n    Replace: æ›¿æ¢ï¼Œå–æ¶ˆå½“å‰æ­£åœ¨è¿è¡Œçš„ä½œä¸šå¹¶ç”¨æ–°ä½œä¸šæ›¿æ¢å®ƒ\n```\n\n#### StatefulSetï¼ˆæœ‰çŠ¶æ€ï¼‰\n\næ— çŠ¶æ€åº”ç”¨ï¼š\n\n- è®¤ä¸ºPodéƒ½æ˜¯ä¸€æ ·çš„ã€‚\n- æ²¡æœ‰é¡ºåºè¦æ±‚ã€‚\n- ä¸ç”¨è€ƒè™‘åœ¨å“ªä¸ªNodeèŠ‚ç‚¹ä¸Šè¿è¡Œã€‚\n- éšæ„è¿›è¡Œä¼¸ç¼©å’Œæ‰©å±•ã€‚\n\næœ‰çŠ¶æ€åº”ç”¨ï¼š\n\n- æœ‰é¡ºåºçš„è¦æ±‚ã€‚\n- è®¤ä¸ºæ¯ä¸ªPodéƒ½æ˜¯ä¸ä¸€æ ·çš„ã€‚\n- éœ€è¦è€ƒè™‘åœ¨å“ªä¸ªNodeèŠ‚ç‚¹ä¸Šè¿è¡Œã€‚\n- éœ€è¦æŒ‰ç…§é¡ºåºè¿›è¡Œä¼¸ç¼©å’Œæ‰©å±•ã€‚\n- è®©æ¯ä¸ªPodéƒ½æ˜¯ç‹¬ç«‹çš„ï¼Œä¿æŒPodå¯åŠ¨é¡ºåºå’Œå”¯ä¸€æ€§ã€‚\n\nStatefulSetæ˜¯Kubernetesæä¾›çš„ç®¡ç†æœ‰çŠ¶æ€åº”ç”¨çš„è´Ÿè½½ç®¡ç†æ§åˆ¶å™¨ã€‚\nStatefulSetéƒ¨ç½²éœ€è¦HeadLinessServiceï¼ˆæ— å¤´æœåŠ¡ï¼‰ã€‚\n\n> ä¸ºä»€ä¹ˆéœ€è¦HeadLinessServiceï¼ˆæ— å¤´æœåŠ¡ï¼‰ï¼Ÿ\n> \n> - åœ¨ç”¨Deploymentæ—¶ï¼Œæ¯ä¸€ä¸ªPodåç§°æ˜¯æ²¡æœ‰é¡ºåºçš„ï¼Œæ˜¯éšæœºå­—ç¬¦ä¸²ï¼Œå› æ­¤æ˜¯Podåç§°æ˜¯æ— åºçš„ï¼Œä½†æ˜¯åœ¨StatefulSetä¸­è¦æ±‚å¿…é¡»æ˜¯æœ‰åº ï¼Œæ¯ä¸€ä¸ªPodä¸èƒ½è¢«éšæ„å–ä»£ï¼ŒPodé‡å»ºåpodåç§°è¿˜æ˜¯ä¸€æ ·çš„ã€‚\n> - è€ŒPod IPæ˜¯å˜åŒ–çš„ï¼Œæ‰€ä»¥æ˜¯ä»¥Podåç§°æ¥è¯†åˆ«ã€‚Podåç§°æ˜¯Podå”¯ä¸€æ€§çš„æ ‡è¯†ç¬¦ï¼Œå¿…é¡»æŒä¹…ç¨³å®šæœ‰æ•ˆã€‚è¿™æ—¶å€™è¦ç”¨åˆ°æ— å¤´æœåŠ¡ï¼Œå®ƒå¯ä»¥ç»™æ¯ä¸ªPodä¸€ä¸ªå”¯ä¸€çš„åç§° ã€‚\n> \n> StatefulSetå¸¸ç”¨æ¥éƒ¨ç½²RabbitMQé›†ç¾¤ã€Zookeeperé›†ç¾¤ã€MySQLé›†ç¾¤ã€Eurekaé›†ç¾¤ç­‰ã€‚\n\næ¼”ç¤ºç¤ºä¾‹ï¼š\n\n```yaml\napiVersion: v1\nkind: Service\nmetadata:\n  name: service-headliness\n  namespace: dev\nspec:\n  selector:\n    app: nginx-pod\n  clusterIP: None # å°†clusterIPè®¾ç½®ä¸ºNoneï¼Œå³å¯åˆ›å»ºheadliness Service\n  type: ClusterIP\n  ports:\n    - port: 80 # Serviceçš„ç«¯å£\n      targetPort: 80 # Podçš„ç«¯å£\n...\n\napiVersion: apps/v1\nkind: StatefulSet\nmetadata:\n  name: pc-statefulset\n  namespace: dev\nspec:\n  replicas: 3\n  serviceName: service-headliness\n  selector:\n    matchLabels:\n      app: nginx-pod\n  template:\n    metadata:\n      labels:\n        app: nginx-pod\n    spec:\n      containers:\n        - name: nginx\n          image: nginx:1.17.1\n          ports:\n            - containerPort: 80\n```\n\n## Service\n\nåœ¨kubernetesä¸­ï¼ŒPodæ˜¯åº”ç”¨ç¨‹åºçš„è½½ä½“ï¼Œæˆ‘ä»¬å¯ä»¥é€šè¿‡Podçš„IPæ¥è®¿é—®åº”ç”¨ç¨‹åºï¼Œä½†æ˜¯Podçš„IPåœ°å€ä¸æ˜¯å›ºå®šçš„ï¼Œè¿™å°±æ„å‘³ç€ä¸æ–¹ä¾¿ç›´æ¥é‡‡ç”¨Podçš„IPå¯¹æœåŠ¡è¿›è¡Œè®¿é—®ã€‚\nä¸ºäº†è§£å†³è¿™ä¸ªé—®é¢˜ï¼Œkubernetesæä¾›äº†Serviceèµ„æºï¼ŒServiceä¼šå¯¹æä¾›åŒä¸€ä¸ªæœåŠ¡çš„å¤šä¸ªPodè¿›è¡Œèšåˆï¼Œå¹¶ä¸”æä¾›ä¸€ä¸ªç»Ÿä¸€çš„å…¥å£åœ°å€ï¼Œé€šè¿‡è®¿é—®Serviceçš„å…¥å£åœ°å€å°±èƒ½è®¿é—®åˆ°åé¢çš„PodæœåŠ¡ã€‚\n\n![image-20250328172653361](KubernetesçŸ¥è¯†æ¢³ç†-æ ¸å¿ƒç»„ä»¶/8.png)\n\nServiceåœ¨å¾ˆå¤šæƒ…å†µä¸‹åªæ˜¯ä¸€ä¸ªæ¦‚å¿µï¼ŒçœŸæ­£èµ·ä½œç”¨çš„å…¶å®æ˜¯kube-proxyæœåŠ¡è¿›ç¨‹ï¼Œæ¯ä¸ªNodeèŠ‚ç‚¹ä¸Šéƒ½è¿è¡Œäº†ä¸€ä¸ªkube-proxyçš„æœåŠ¡è¿›ç¨‹ã€‚å½“åˆ›å»ºServiceçš„æ—¶å€™ä¼šé€šè¿‡API Serverå‘etcdå†™å…¥åˆ›å»ºçš„Serviceçš„ä¿¡æ¯ï¼Œè€Œkube-proxyä¼šåŸºäºç›‘å¬çš„æœºåˆ¶å‘ç°è¿™ç§Serviceçš„å˜åŒ–ï¼Œç„¶åå®ƒä¼šå°†æœ€æ–°çš„Serviceä¿¡æ¯è½¬æ¢ä¸ºå¯¹åº”çš„è®¿é—®è§„åˆ™ã€‚\n\n![image-20250328172807052](KubernetesçŸ¥è¯†æ¢³ç†-æ ¸å¿ƒç»„ä»¶/9.png)\n\nkube-proxyç›®å‰æ”¯æŒä¸‰ç§å·¥ä½œæ¨¡å¼ï¼š\n\n- userspaceæ¨¡å¼ï¼š\n  \n  - userspaceæ¨¡å¼ä¸‹ï¼Œkube-proxyä¼šä¸ºæ¯ä¸€ä¸ªServiceåˆ›å»ºä¸€ä¸ªç›‘å¬ç«¯å£ï¼Œå‘å‘Cluster IPçš„è¯·æ±‚è¢«iptablesè§„åˆ™é‡å®šå‘åˆ°kube-proxyç›‘å¬çš„ç«¯å£ä¸Šï¼Œkube-proxyæ ¹æ®LBç®—æ³•ï¼ˆè´Ÿè½½å‡è¡¡ç®—æ³•ï¼‰é€‰æ‹©ä¸€ä¸ªæä¾›æœåŠ¡çš„Podå¹¶å’Œå…¶å»ºç«‹è¿æ¥ï¼Œä»¥ä¾¿å°†è¯·æ±‚è½¬å‘åˆ°Podä¸Šã€‚\n  \n  - è¯¥æ¨¡å¼ä¸‹ï¼Œkube-proxyå……å½“äº†ä¸€ä¸ªå››å±‚è´Ÿè½½å‡è¡¡å™¨çš„è§’è‰²ã€‚ç”±äºkube-proxyè¿è¡Œåœ¨userspaceä¸­ï¼Œåœ¨è¿›è¡Œè½¬å‘å¤„ç†çš„æ—¶å€™ä¼šå¢åŠ å†…æ ¸å’Œç”¨æˆ·ç©ºé—´ä¹‹é—´çš„æ•°æ®æ‹·è´ï¼Œè™½ç„¶æ¯”è¾ƒç¨³å®šï¼Œä½†æ˜¯æ•ˆç‡éå¸¸ä½ä¸‹ã€‚\n\n![image-20250328172925938](KubernetesçŸ¥è¯†æ¢³ç†-æ ¸å¿ƒç»„ä»¶/10.png)\n\n- iptablesæ¨¡å¼ï¼š\n  \n  - iptablesæ¨¡å¼ä¸‹ï¼Œkube-proxyä¸ºServiceåç«¯çš„æ¯ä¸ªPodåˆ›å»ºå¯¹åº”çš„iptablesè§„åˆ™ï¼Œç›´æ¥å°†å‘å‘Cluster IPçš„è¯·æ±‚é‡å®šå‘åˆ°ä¸€ä¸ªPodçš„IPä¸Šã€‚\n  \n  - è¯¥æ¨¡å¼ä¸‹kube-proxyä¸æ‰¿æ‹…å››å±‚è´Ÿè½½å‡è¡¡å™¨çš„è§’è‰²ï¼Œåªè´Ÿè´£åˆ›å»ºiptablesè§„åˆ™ã€‚è¯¥æ¨¡å¼çš„ä¼˜ç‚¹åœ¨äºè¾ƒuserspaceæ¨¡å¼æ•ˆç‡æ›´é«˜ï¼Œä½†æ˜¯ä¸èƒ½æä¾›çµæ´»çš„LBç­–ç•¥ï¼Œå½“åç«¯Podä¸å¯ç”¨çš„æ—¶å€™æ— æ³•è¿›è¡Œé‡è¯•ã€‚\n\n![image-20250328173051549](KubernetesçŸ¥è¯†æ¢³ç†-æ ¸å¿ƒç»„ä»¶/11.png)\n\nipvsæ¨¡å¼ï¼š\n\n- ipvsæ¨¡å¼å’Œiptablesç±»ä¼¼ï¼Œkube-proxyç›‘æ§Podçš„å˜åŒ–å¹¶åˆ›å»ºç›¸åº”çš„ipvsè§„åˆ™ã€‚ipvsç›¸å¯¹iptablesè½¬å‘æ•ˆç‡æ›´é«˜ï¼Œé™¤æ­¤ä¹‹å¤–ï¼Œipvsæ”¯æŒæ›´å¤šçš„LBï¼ˆè´Ÿè½½å‡è¡¡ï¼‰ç®—æ³•ã€‚\n\n![image-20250328173219942](KubernetesçŸ¥è¯†æ¢³ç†-æ ¸å¿ƒç»„ä»¶/12.png)\n\n### Serviceç±»å‹\n\nServiceçš„èµ„æºæ¸…å•ï¼š\n\n```yaml\napiVersion: v1 # ç‰ˆæœ¬\nkind: Service # ç±»å‹\nmetadata: # å…ƒæ•°æ®\n  name: # èµ„æºåç§°\n  namespace: # å‘½åç©ºé—´\nspec:\n  selector: # æ ‡ç­¾é€‰æ‹©å™¨ï¼Œç”¨äºç¡®å®šå½“å‰Serviceä»£ç†é‚£äº›Pod\n    app: nginx\n  type: NodePort # Serviceçš„ç±»å‹ï¼ŒæŒ‡å®šServiceçš„è®¿é—®æ–¹å¼\n  clusterIP: # è™šæ‹ŸæœåŠ¡çš„IPåœ°å€\n  sessionAffinity: # sessionäº²å’Œæ€§ï¼Œæ”¯æŒClientIPã€Noneä¸¤ä¸ªé€‰é¡¹ï¼Œé»˜è®¤å€¼ä¸ºNone\n  ports: # ç«¯å£ä¿¡æ¯\n    - port: 8080 # Serviceç«¯å£\n      protocol: TCP # åè®®\n      targetPort : # Podç«¯å£\n      nodePort:  # ä¸»æœºç«¯å£\n```\n\n> spec.typeçš„è¯´æ˜ï¼š\n> \n> - ClusterIPï¼šé»˜è®¤å€¼ï¼Œå®ƒæ˜¯kubernetesç³»ç»Ÿè‡ªåŠ¨åˆ†é…çš„è™šæ‹ŸIPï¼Œåªèƒ½åœ¨é›†ç¾¤å†…éƒ¨è®¿é—®ã€‚\n> - NodePortï¼šå°†Serviceé€šè¿‡æŒ‡å®šçš„Nodeä¸Šçš„ç«¯å£æš´éœ²ç»™å¤–éƒ¨ï¼Œé€šè¿‡æ­¤æ–¹æ³•ï¼Œå°±å¯ä»¥åœ¨é›†ç¾¤å¤–éƒ¨è®¿é—®æœåŠ¡ã€‚\n> - LoadBalancerï¼šä½¿ç”¨å¤–æ¥è´Ÿè½½å‡è¡¡å™¨å®Œæˆåˆ°æœåŠ¡çš„è´Ÿè½½åˆ†å‘ï¼Œæ³¨æ„æ­¤æ¨¡å¼éœ€è¦å¤–éƒ¨äº‘ç¯å¢ƒçš„æ”¯æŒã€‚\n> - ExternalNameï¼šæŠŠé›†ç¾¤å¤–éƒ¨çš„æœåŠ¡å¼•å…¥é›†ç¾¤å†…éƒ¨ï¼Œç›´æ¥ä½¿ç”¨ã€‚\n\n#### ClusterIPç±»å‹çš„Service\n\nEndpointï¼ˆå®é™…ä¸­ä½¿ç”¨çš„ä¸å¤šï¼‰\n\n- Endpointæ˜¯kubernetesä¸­çš„ä¸€ä¸ªèµ„æºå¯¹è±¡ï¼Œå­˜å‚¨åœ¨etcdä¸­ï¼Œç”¨æ¥è®°å½•ä¸€ä¸ªserviceå¯¹åº”çš„æ‰€æœ‰Podçš„è®¿é—®åœ°å€ï¼Œå®ƒæ˜¯æ ¹æ®serviceé…ç½®æ–‡ä»¶ä¸­çš„selectoræè¿°äº§ç”Ÿçš„ã€‚\n- ä¸€ä¸ªserviceç”±ä¸€ç»„Podç»„æˆï¼Œè¿™äº›Podé€šè¿‡Endpointsæš´éœ²å‡ºæ¥ï¼ŒEndpointsæ˜¯å®ç°å®é™…æœåŠ¡çš„ç«¯ç‚¹é›†åˆã€‚æ¢è¨€ä¹‹ï¼Œserviceå’ŒPodä¹‹é—´çš„è”ç³»æ˜¯é€šè¿‡Endpointså®ç°çš„ã€‚\n\n![image-20250328173454822](KubernetesçŸ¥è¯†æ¢³ç†-æ ¸å¿ƒç»„ä»¶/13.png)\n\n è´Ÿè½½åˆ†å‘ç­–ç•¥\n\nå¯¹Serviceçš„è®¿é—®è¢«åˆ†å‘åˆ°äº†åç«¯çš„Podä¸Šå»ï¼Œç›®å‰kubernetesæä¾›äº†ä¸¤ç§è´Ÿè½½åˆ†å‘ç­–ç•¥ï¼š\n\n- å¦‚æœä¸å®šä¹‰ï¼Œé»˜è®¤ä½¿ç”¨kube-proxyçš„ç­–ç•¥ï¼Œæ¯”å¦‚éšæœºã€è½®è¯¢ç­‰ã€‚\n- åŸºäºå®¢æˆ·ç«¯åœ°å€çš„ä¼šè¯ä¿æŒæ¨¡å¼ï¼Œå³æ¥è‡ªåŒä¸€ä¸ªå®¢æˆ·ç«¯å‘èµ·çš„æ‰€æœ‰è¯·æ±‚éƒ½ä¼šè½¬å‘åˆ°å›ºå®šçš„ä¸€ä¸ªPodä¸Šï¼Œè¿™å¯¹äºä¼ ç»ŸåŸºäºSessionçš„è®¤è¯é¡¹ç›®æ¥è¯´å¾ˆå‹å¥½ï¼Œæ­¤æ¨¡å¼å¯ä»¥åœ¨specä¸­æ·»åŠ sessionAffinity: ClusterIPé€‰é¡¹ã€‚\n\n#### HeadLinessç±»å‹çš„Service\n\nåœ¨æŸäº›åœºæ™¯ä¸­ï¼Œå¼€å‘äººå‘˜å¯èƒ½ä¸æƒ³ä½¿ç”¨Serviceæä¾›çš„è´Ÿè½½å‡è¡¡åŠŸèƒ½ï¼Œè€Œå¸Œæœ›è‡ªå·±æ¥æ§åˆ¶è´Ÿè½½å‡è¡¡ç­–ç•¥ï¼Œé’ˆå¯¹è¿™ç§æƒ…å†µï¼Œkubernetesæä¾›äº†HeadLinesss Serviceï¼Œè¿™ç±»Serviceä¸ä¼šåˆ†é…Cluster IPï¼Œå¦‚æœæƒ³è¦è®¿é—®Serviceï¼Œåªèƒ½é€šè¿‡Serviceçš„åŸŸåè¿›è¡ŒæŸ¥è¯¢ã€‚\n\n#### NodePortç±»å‹çš„Service\n\nåœ¨ä¹‹å‰çš„æ¡ˆä¾‹ä¸­ï¼Œåˆ›å»ºçš„Serviceçš„IPåœ°å€åªèƒ½åœ¨é›†ç¾¤å†…éƒ¨æ‰å¯ä»¥è®¿é—®ï¼Œå¦‚æœå¸Œæœ›Serviceæš´éœ²ç»™é›†ç¾¤å¤–éƒ¨ä½¿ç”¨ï¼Œé‚£ä¹ˆå°±éœ€è¦ä½¿ç”¨åˆ°å¦å¤–ä¸€ç§ç±»å‹çš„Serviceï¼Œç§°ä¸ºNodePortç±»å‹çš„Serviceã€‚NodePortçš„å·¥ä½œåŸç†å°±æ˜¯å°†Serviceçš„ç«¯å£æ˜ å°„åˆ°Nodeçš„ä¸€ä¸ªç«¯å£ä¸Šï¼Œç„¶åå°±å¯ä»¥é€šè¿‡NodeIP:NodePortæ¥è®¿é—®Serviceäº†ã€‚\n\n![image-20250328173809010](KubernetesçŸ¥è¯†æ¢³ç†-æ ¸å¿ƒç»„ä»¶/14.png)\n\n#### LoadBalancerç±»å‹çš„Service\n\n![image-20250328173923606](KubernetesçŸ¥è¯†æ¢³ç†-æ ¸å¿ƒç»„ä»¶/15.png)\n\n#### ExternalNameç±»å‹çš„Service\n\nExternalNameç±»å‹çš„Serviceç”¨äºå¼•å…¥é›†ç¾¤å¤–éƒ¨çš„æœåŠ¡ï¼Œå®ƒé€šè¿‡externalNameå±æ€§æŒ‡å®šä¸€ä¸ªæœåŠ¡çš„åœ°å€ï¼Œç„¶ååœ¨é›†ç¾¤å†…éƒ¨è®¿é—®æ­¤Serviceå°±å¯ä»¥è®¿é—®åˆ°å¤–éƒ¨çš„æœåŠ¡äº†ã€‚\n\n![image-20250328174018302](KubernetesçŸ¥è¯†æ¢³ç†-æ ¸å¿ƒç»„ä»¶/16.png)\n\n## Ingress\n\næˆ‘ä»¬å·²ç»çŸ¥é“ï¼ŒServiceå¯¹é›†ç¾¤ä¹‹å¤–æš´éœ²æœåŠ¡çš„ä¸»è¦æ–¹å¼æœ‰ä¸¤ç§ï¼šNodePortå’ŒLoadBalancerï¼Œä½†æ˜¯è¿™ä¸¤ç§æ–¹å¼ï¼Œéƒ½æœ‰ä¸€å®šçš„ç¼ºç‚¹ï¼š\n\n- NodePortæ–¹å¼çš„ç¼ºç‚¹æ˜¯ä¼šå ç”¨å¾ˆå¤šé›†ç¾¤æœºå™¨çš„ç«¯å£ï¼Œé‚£ä¹ˆå½“é›†ç¾¤æœåŠ¡å˜å¤šçš„æ—¶å€™ï¼Œè¿™ä¸ªç¼ºç‚¹å°±æ„ˆå‘æ˜æ˜¾ã€‚\n- LoadBalancerçš„ç¼ºç‚¹æ˜¯æ¯ä¸ªServiceéƒ½éœ€è¦ä¸€ä¸ªLBï¼Œæµªè´¹ï¼Œéº»çƒ¦ï¼Œå¹¶ä¸”éœ€è¦kubernetesä¹‹å¤–çš„è®¾å¤‡çš„æ”¯æŒã€‚\n\nåŸºäºè¿™ç§ç°çŠ¶ï¼Œkubernetesæä¾›äº†Ingressèµ„æºå¯¹è±¡ï¼ŒIngressåªéœ€è¦ä¸€ä¸ªNodePortæˆ–è€…ä¸€ä¸ªLBå°±å¯ä»¥æ»¡è¶³æš´éœ²å¤šä¸ªServiceçš„éœ€æ±‚ï¼Œå·¥ä½œæœºåˆ¶å¤§è‡´å¦‚ä¸‹å›¾æ‰€ç¤ºï¼š\n\n![image-20250328174120763](KubernetesçŸ¥è¯†æ¢³ç†-æ ¸å¿ƒç»„ä»¶/17.png)\n\nå®é™…ä¸Šï¼ŒIngressç›¸å½“äºä¸€ä¸ªä¸ƒå±‚çš„è´Ÿè½½å‡è¡¡å™¨ï¼Œæ˜¯kuberneteså¯¹åå‘ä»£ç†çš„ä¸€ä¸ªæŠ½è±¡ï¼Œå®ƒçš„å·¥ä½œåŸç†ç±»ä¼¼äºNginxï¼Œå¯ä»¥ç†è§£ä¸ºIngressé‡Œé¢å»ºç«‹äº†è¯¸å¤šæ˜ å°„è§„åˆ™ï¼ŒIngress Controlleré€šè¿‡ç›‘å¬è¿™äº›é…ç½®è§„åˆ™å¹¶è½¬åŒ–ä¸ºNginxçš„åå‘ä»£ç†é…ç½®ï¼Œç„¶åå¯¹å¤–æä¾›æœåŠ¡ã€‚\n\n- Ingressï¼škubernetesä¸­çš„ä¸€ä¸ªå¯¹è±¡ï¼Œä½œç”¨æ˜¯å®šä¹‰è¯·æ±‚å¦‚ä½•è½¬å‘åˆ°Serviceçš„è§„åˆ™ã€‚\n- Ingress Controllerï¼šå…·ä½“å®ç°åå‘ä»£ç†åŠè´Ÿè½½å‡è¡¡çš„ç¨‹åºï¼Œå¯¹Ingresså®šä¹‰çš„è§„åˆ™è¿›è¡Œè§£æï¼Œæ ¹æ®é…ç½®çš„è§„åˆ™æ¥å®ç°è¯·æ±‚è½¬å‘ï¼Œå®ç°çš„æ–¹å¼æœ‰å¾ˆå¤šï¼Œæ¯”å¦‚Nginxï¼ŒContourï¼ŒHaproxyç­‰ã€‚\n\nIngressï¼ˆä»¥Nginxï¼‰çš„å·¥ä½œåŸç†å¦‚ä¸‹ï¼š\n\n- ç”¨æˆ·ç¼–å†™Ingressè§„åˆ™ï¼Œè¯´æ˜é‚£ä¸ªåŸŸåå¯¹åº”kubernetesé›†ç¾¤ä¸­çš„é‚£ä¸ªServiceã€‚\n- Ingressæ§åˆ¶å™¨åŠ¨æ€æ„ŸçŸ¥IngressæœåŠ¡è§„åˆ™çš„å˜åŒ–ï¼Œç„¶åç”Ÿæˆä¸€æ®µå¯¹åº”çš„Nginxçš„åå‘ä»£ç†é…ç½®ã€‚\n- Ingressæ§åˆ¶å™¨ä¼šå°†ç”Ÿæˆçš„Nginxé…ç½®å†™å…¥åˆ°ä¸€ä¸ªè¿è¡Œç€çš„NginxæœåŠ¡ä¸­ï¼Œå¹¶åŠ¨æ€æ›´æ–°ã€‚\n- åˆ°æ­¤ä¸ºæ­¢ï¼Œå…¶å®çœŸæ­£åœ¨å·¥ä½œçš„å°±æ˜¯ä¸€ä¸ªNginxäº†ï¼Œå†…éƒ¨é…ç½®äº†ç”¨æˆ·å®šä¹‰çš„è¯·æ±‚è§„åˆ™ã€‚\n\n![image-20250328174300573](KubernetesçŸ¥è¯†æ¢³ç†-æ ¸å¿ƒç»„ä»¶/18.png)\n\n> Ingressæ”¯æŒHttpä»£ç†å’ŒHttpsä»£ç†\n\n## æ•°æ®å­˜å‚¨\n\nåœ¨å‰é¢å·²ç»æåˆ°ï¼Œå®¹å™¨çš„ç”Ÿå‘½å‘¨æœŸå¯èƒ½å¾ˆçŸ­ï¼Œä¼šè¢«é¢‘ç¹åœ°åˆ›å»ºå’Œé”€æ¯ã€‚é‚£ä¹ˆå®¹å™¨åœ¨é”€æ¯æ—¶ï¼Œä¿å­˜åœ¨å®¹å™¨ä¸­çš„æ•°æ®ä¹Ÿä¼šè¢«æ¸…é™¤ã€‚è¿™ç§ç»“æœå¯¹ç”¨æˆ·æ¥è¯´ï¼Œåœ¨æŸäº›æƒ…å†µä¸‹æ˜¯ä¸ä¹æ„çœ‹åˆ°çš„ã€‚ä¸ºäº†æŒä¹…åŒ–ä¿å­˜å®¹å™¨çš„æ•°æ®ï¼Œkuberneteså¼•å…¥äº†Volumeçš„æ¦‚å¿µã€‚\n\nVolumeæ˜¯Podä¸­èƒ½å¤Ÿè¢«å¤šä¸ªå®¹å™¨è®¿é—®çš„å…±äº«ç›®å½•ï¼Œå®ƒè¢«å®šä¹‰åœ¨Podä¸Šï¼Œç„¶åè¢«ä¸€ä¸ªPodé‡Œçš„å¤šä¸ªå®¹å™¨æŒ‚è½½åˆ°å…·ä½“çš„æ–‡ä»¶ç›®å½•ä¸‹ï¼Œkubernetesé€šè¿‡Volumeå®ç°åŒä¸€ä¸ªPodä¸­ä¸åŒå®¹å™¨ä¹‹é—´çš„æ•°æ®å…±äº«ä»¥åŠæ•°æ®çš„æŒä¹…åŒ–å­˜å‚¨ã€‚Volumeçš„ç”Ÿå‘½å®¹å™¨ä¸ä¸Podä¸­å•ä¸ªå®¹å™¨çš„ç”Ÿå‘½å‘¨æœŸç›¸å…³ï¼Œå½“å®¹å™¨ç»ˆæ­¢æˆ–è€…é‡å¯æ—¶ï¼ŒVolumeä¸­çš„æ•°æ®ä¹Ÿä¸ä¼šä¸¢å¤±ã€‚\n\nkubernetesçš„Volumeæ”¯æŒå¤šç§ç±»å‹ï¼Œæ¯”è¾ƒå¸¸è§çš„æœ‰ä¸‹é¢å‡ ä¸ªï¼š\n\n- ç®€å•å­˜å‚¨ï¼šEmptyDirã€HostPathã€NFS\n- é«˜çº§å­˜å‚¨ï¼šPVã€PVC\n- é…ç½®å­˜å‚¨ï¼šConfigMapã€Secret\n\n### åŸºæœ¬å­˜å‚¨\n\n#### EmptyDir\n\nEmptyDiræ˜¯æœ€åŸºç¡€çš„Volumeç±»å‹ï¼Œä¸€ä¸ªEmptyDirå°±æ˜¯Hostä¸Šçš„ä¸€ä¸ªç©ºç›®å½•ã€‚\n\nEmptyDiræ˜¯åœ¨Podè¢«åˆ†é…åˆ°Nodeæ—¶åˆ›å»ºçš„ï¼Œå®ƒçš„åˆå§‹å†…å®¹ä¸ºç©ºï¼Œå¹¶ä¸”æ— é¡»æŒ‡å®šå®¿ä¸»æœºä¸Šå¯¹åº”çš„ç›®å½•æ–‡ä»¶ï¼Œå› ä¸ºkubernetesä¼šè‡ªåŠ¨åˆ†é…ä¸€ä¸ªç›®å½•ï¼Œå½“Podé”€æ¯æ—¶ï¼Œ EmptyDirä¸­çš„æ•°æ®ä¹Ÿä¼šè¢«æ°¸ä¹…åˆ é™¤ã€‚ EmptyDirç”¨é€”å¦‚ä¸‹ï¼š\n\n- ä¸´æ—¶ç©ºé—´ï¼Œä¾‹å¦‚ç”¨äºæŸäº›åº”ç”¨ç¨‹åºè¿è¡Œæ—¶æ‰€éœ€çš„ä¸´æ—¶ç›®å½•ï¼Œä¸”æ— é¡»æ°¸ä¹…ä¿ç•™\n- ä¸€ä¸ªå®¹å™¨éœ€è¦ä»å¦ä¸€ä¸ªå®¹å™¨ä¸­è·å–æ•°æ®çš„ç›®å½•ï¼ˆå¤šå®¹å™¨å…±äº«ç›®å½•ï¼‰\n\næ¥ä¸‹æ¥ï¼Œé€šè¿‡ä¸€ä¸ªå®¹å™¨ä¹‹é—´æ–‡ä»¶å…±äº«çš„æ¡ˆä¾‹æ¥ä½¿ç”¨ä¸€ä¸‹EmptyDirã€‚\n\nåœ¨ä¸€ä¸ªPodä¸­å‡†å¤‡ä¸¤ä¸ªå®¹å™¨nginxå’Œbusyboxï¼Œç„¶åå£°æ˜ä¸€ä¸ªVolumeåˆ†åˆ«æŒ‚åœ¨åˆ°ä¸¤ä¸ªå®¹å™¨çš„ç›®å½•ä¸­ï¼Œç„¶ånginxå®¹å™¨è´Ÿè´£å‘Volumeä¸­å†™æ—¥å¿—ï¼Œbusyboxä¸­é€šè¿‡å‘½ä»¤å°†æ—¥å¿—å†…å®¹è¯»åˆ°æ§åˆ¶å°ã€‚\n\n![image-20250328174613499](KubernetesçŸ¥è¯†æ¢³ç†-æ ¸å¿ƒç»„ä»¶/19.png)\n\n#### HostPath\n\nä¸ŠèŠ‚è¯¾æåˆ°ï¼ŒEmptyDirä¸­æ•°æ®ä¸ä¼šè¢«æŒä¹…åŒ–ï¼Œå®ƒä¼šéšç€Podçš„ç»“æŸè€Œé”€æ¯ï¼Œå¦‚æœæƒ³ç®€å•çš„å°†æ•°æ®æŒä¹…åŒ–åˆ°ä¸»æœºä¸­ï¼Œå¯ä»¥é€‰æ‹©HostPathã€‚\n\nHostPathå°±æ˜¯å°†Nodeä¸»æœºä¸­ä¸€ä¸ªå®é™…ç›®å½•æŒ‚åœ¨åˆ°Podä¸­ï¼Œä»¥ä¾›å®¹å™¨ä½¿ç”¨ï¼Œè¿™æ ·çš„è®¾è®¡å°±å¯ä»¥ä¿è¯Podé”€æ¯äº†ï¼Œä½†æ˜¯æ•°æ®ä¾æ®å¯ä»¥å­˜åœ¨äºNodeä¸»æœºä¸Šã€‚\n\n![image-20250328174658800](KubernetesçŸ¥è¯†æ¢³ç†-æ ¸å¿ƒç»„ä»¶/20.png)\n\n#### NFS\n\nHostPathå¯ä»¥è§£å†³æ•°æ®æŒä¹…åŒ–çš„é—®é¢˜ï¼Œä½†æ˜¯ä¸€æ—¦NodeèŠ‚ç‚¹æ•…éšœäº†ï¼ŒPodå¦‚æœè½¬ç§»åˆ°äº†åˆ«çš„èŠ‚ç‚¹ï¼Œåˆä¼šå‡ºç°é—®é¢˜äº†ï¼Œæ­¤æ—¶éœ€è¦å‡†å¤‡å•ç‹¬çš„ç½‘ç»œå­˜å‚¨ç³»ç»Ÿï¼Œæ¯”è¾ƒå¸¸ç”¨çš„ç”¨NFSã€CIFSã€‚\n\nNFSæ˜¯ä¸€ä¸ªç½‘ç»œæ–‡ä»¶å­˜å‚¨ç³»ç»Ÿï¼Œå¯ä»¥æ­å»ºä¸€å°NFSæœåŠ¡å™¨ï¼Œç„¶åå°†Podä¸­çš„å­˜å‚¨ç›´æ¥è¿æ¥åˆ°NFSç³»ç»Ÿä¸Šï¼Œè¿™æ ·çš„è¯ï¼Œæ— è®ºPodåœ¨èŠ‚ç‚¹ä¸Šæ€ä¹ˆè½¬ç§»ï¼Œåªè¦Nodeè·ŸNFSçš„å¯¹æ¥æ²¡é—®é¢˜ï¼Œæ•°æ®å°±å¯ä»¥æˆåŠŸè®¿é—®ã€‚\n\n![image-20250328174744542](KubernetesçŸ¥è¯†æ¢³ç†-æ ¸å¿ƒç»„ä»¶/21.png)\n\n### é«˜çº§å­˜å‚¨\n\nå‰é¢å·²ç»å­¦ä¹ äº†ä½¿ç”¨NFSæä¾›å­˜å‚¨ï¼Œæ­¤æ—¶å°±è¦æ±‚ç”¨æˆ·ä¼šæ­å»ºNFSç³»ç»Ÿï¼Œå¹¶ä¸”ä¼šåœ¨yamlé…ç½®nfsã€‚ç”±äºkubernetesæ”¯æŒçš„å­˜å‚¨ç³»ç»Ÿæœ‰å¾ˆå¤šï¼Œè¦æ±‚å®¢æˆ·å…¨éƒ½æŒæ¡ï¼Œæ˜¾ç„¶ä¸ç°å®ã€‚ä¸ºäº†èƒ½å¤Ÿå±è”½åº•å±‚å­˜å‚¨å®ç°çš„ç»†èŠ‚ï¼Œæ–¹ä¾¿ç”¨æˆ·ä½¿ç”¨ï¼Œ kuberneteså¼•å…¥PVå’ŒPVCä¸¤ç§èµ„æºå¯¹è±¡ã€‚\n\n- PVï¼ˆPersistent Volumeï¼‰æ˜¯æŒä¹…åŒ–å·çš„æ„æ€ï¼Œæ˜¯å¯¹åº•å±‚çš„å…±äº«å­˜å‚¨çš„ä¸€ç§æŠ½è±¡ã€‚ä¸€èˆ¬æƒ…å†µä¸‹PVç”±kubernetesç®¡ç†å‘˜è¿›è¡Œåˆ›å»ºå’Œé…ç½®ï¼Œå®ƒä¸åº•å±‚å…·ä½“çš„å…±äº«å­˜å‚¨æŠ€æœ¯æœ‰å…³ï¼Œå¹¶é€šè¿‡æ’ä»¶å®Œæˆä¸å…±äº«å­˜å‚¨çš„å¯¹æ¥ã€‚\n- PVCï¼ˆPersistent Volume Claimï¼‰æ˜¯æŒä¹…å·å£°æ˜çš„æ„æ€ï¼Œæ˜¯ç”¨æˆ·å¯¹äºå­˜å‚¨éœ€æ±‚çš„ä¸€ç§å£°æ˜ã€‚æ¢å¥è¯è¯´ï¼ŒPVCå…¶å®å°±æ˜¯ç”¨æˆ·å‘kubernetesç³»ç»Ÿå‘å‡ºçš„ä¸€ç§èµ„æºéœ€æ±‚ç”³è¯·ã€‚\n\n![image-20250329114433511](KubernetesçŸ¥è¯†æ¢³ç†-æ ¸å¿ƒç»„ä»¶/22.png)\n\nä½¿ç”¨äº†PVå’ŒPVCä¹‹åï¼Œå·¥ä½œå¯ä»¥å¾—åˆ°è¿›ä¸€æ­¥çš„ç»†åˆ†ï¼š\n\n- å­˜å‚¨ï¼šå­˜å‚¨å·¥ç¨‹å¸ˆç»´æŠ¤\n- PVï¼š kubernetesç®¡ç†å‘˜ç»´æŠ¤\n- PVCï¼škubernetesç”¨æˆ·ç»´æŠ¤\n\n#### PV\n\nPVæ˜¯å­˜å‚¨èµ„æºçš„æŠ½è±¡ï¼Œä¸‹é¢æ˜¯èµ„æºæ¸…å•æ–‡ä»¶:\n\n```yaml\napiVersion: v1  \nkind: PersistentVolume\nmetadata:\n  name: pv2\nspec:\n  nfs: # å­˜å‚¨ç±»å‹ï¼Œä¸åº•å±‚çœŸæ­£å­˜å‚¨å¯¹åº”\n  capacity:  # å­˜å‚¨èƒ½åŠ›ï¼Œç›®å‰åªæ”¯æŒå­˜å‚¨ç©ºé—´çš„è®¾ç½®\n    storage: 2Gi\n  accessModes:  # è®¿é—®æ¨¡å¼\n  storageClassName: # å­˜å‚¨ç±»åˆ«\n  persistentVolumeReclaimPolicy: # å›æ”¶ç­–ç•¥\n```\n\nPV çš„å…³é”®é…ç½®å‚æ•°è¯´æ˜ï¼š\n\n- **å­˜å‚¨ç±»å‹**\n  \n  åº•å±‚å®é™…å­˜å‚¨çš„ç±»å‹ï¼Œkubernetesæ”¯æŒå¤šç§å­˜å‚¨ç±»å‹ï¼Œæ¯ç§å­˜å‚¨ç±»å‹çš„é…ç½®éƒ½æœ‰æ‰€å·®å¼‚\n\n- **å­˜å‚¨èƒ½åŠ›ï¼ˆcapacityï¼‰**\n\nç›®å‰åªæ”¯æŒå­˜å‚¨ç©ºé—´çš„è®¾ç½®( storage=1Gi )ï¼Œä¸è¿‡æœªæ¥å¯èƒ½ä¼šåŠ å…¥IOPSã€ååé‡ç­‰æŒ‡æ ‡çš„é…ç½®\n\n- **è®¿é—®æ¨¡å¼ï¼ˆaccessModesï¼‰**\n  \n  ç”¨äºæè¿°ç”¨æˆ·åº”ç”¨å¯¹å­˜å‚¨èµ„æºçš„è®¿é—®æƒé™ï¼Œè®¿é—®æƒé™åŒ…æ‹¬ä¸‹é¢å‡ ç§æ–¹å¼ï¼š\n  \n  - ReadWriteOnceï¼ˆRWOï¼‰ï¼šè¯»å†™æƒé™ï¼Œä½†æ˜¯åªèƒ½è¢«å•ä¸ªèŠ‚ç‚¹æŒ‚è½½\n  - ReadOnlyManyï¼ˆROXï¼‰ï¼š åªè¯»æƒé™ï¼Œå¯ä»¥è¢«å¤šä¸ªèŠ‚ç‚¹æŒ‚è½½\n  - ReadWriteManyï¼ˆRWXï¼‰ï¼šè¯»å†™æƒé™ï¼Œå¯ä»¥è¢«å¤šä¸ªèŠ‚ç‚¹æŒ‚è½½\n  \n  `éœ€è¦æ³¨æ„çš„æ˜¯ï¼Œåº•å±‚ä¸åŒçš„å­˜å‚¨ç±»å‹å¯èƒ½æ”¯æŒçš„è®¿é—®æ¨¡å¼ä¸åŒ`\n\n- **å›æ”¶ç­–ç•¥ï¼ˆpersistentVolumeReclaimPolicyï¼‰**\n  \n  å½“PVä¸å†è¢«ä½¿ç”¨äº†ä¹‹åï¼Œå¯¹å…¶çš„å¤„ç†æ–¹å¼ã€‚ç›®å‰æ”¯æŒä¸‰ç§ç­–ç•¥ï¼š\n  \n  - Retain ï¼ˆä¿ç•™ï¼‰ ä¿ç•™æ•°æ®ï¼Œéœ€è¦ç®¡ç†å‘˜æ‰‹å·¥æ¸…ç†æ•°æ®\n  - Recycleï¼ˆå›æ”¶ï¼‰ æ¸…é™¤ PV ä¸­çš„æ•°æ®ï¼Œæ•ˆæœç›¸å½“äºæ‰§è¡Œ rm -rf /thevolume/*\n  - Delete ï¼ˆåˆ é™¤ï¼‰ ä¸ PV ç›¸è¿çš„åç«¯å­˜å‚¨å®Œæˆ volume çš„åˆ é™¤æ“ä½œï¼Œå½“ç„¶è¿™å¸¸è§äºäº‘æœåŠ¡å•†çš„å­˜å‚¨æœåŠ¡\n  \n  `éœ€è¦æ³¨æ„çš„æ˜¯ï¼Œåº•å±‚ä¸åŒçš„å­˜å‚¨ç±»å‹å¯èƒ½æ”¯æŒçš„å›æ”¶ç­–ç•¥ä¸åŒ`\n\n- **å­˜å‚¨ç±»åˆ«**\n  \n  PVå¯ä»¥é€šè¿‡storageClassNameå‚æ•°æŒ‡å®šä¸€ä¸ªå­˜å‚¨ç±»åˆ«\n  \n  - å…·æœ‰ç‰¹å®šç±»åˆ«çš„PVåªèƒ½ä¸è¯·æ±‚äº†è¯¥ç±»åˆ«çš„PVCè¿›è¡Œç»‘å®š\n  - æœªè®¾å®šç±»åˆ«çš„PVåˆ™åªèƒ½ä¸ä¸è¯·æ±‚ä»»ä½•ç±»åˆ«çš„PVCè¿›è¡Œç»‘å®š\n\n- **çŠ¶æ€ï¼ˆstatusï¼‰**\n  \n  ä¸€ä¸ª PV çš„ç”Ÿå‘½å‘¨æœŸä¸­ï¼Œå¯èƒ½ä¼šå¤„äº4ä¸­ä¸åŒçš„é˜¶æ®µï¼š\n  \n  - Availableï¼ˆå¯ç”¨ï¼‰ï¼š è¡¨ç¤ºå¯ç”¨çŠ¶æ€ï¼Œè¿˜æœªè¢«ä»»ä½• PVC ç»‘å®š\n  - Boundï¼ˆå·²ç»‘å®šï¼‰ï¼š è¡¨ç¤º PV å·²ç»è¢« PVC ç»‘å®š\n  - Releasedï¼ˆå·²é‡Šæ”¾ï¼‰ï¼š è¡¨ç¤º PVC è¢«åˆ é™¤ï¼Œä½†æ˜¯èµ„æºè¿˜æœªè¢«é›†ç¾¤é‡æ–°å£°æ˜\n  - Failedï¼ˆå¤±è´¥ï¼‰ï¼š è¡¨ç¤ºè¯¥ PV çš„è‡ªåŠ¨å›æ”¶å¤±è´¥\n\n#### PVC\n\nPVCæ˜¯èµ„æºçš„ç”³è¯·ï¼Œç”¨æ¥å£°æ˜å¯¹å­˜å‚¨ç©ºé—´ã€è®¿é—®æ¨¡å¼ã€å­˜å‚¨ç±»åˆ«éœ€æ±‚ä¿¡æ¯ã€‚ä¸‹é¢æ˜¯èµ„æºæ¸…å•æ–‡ä»¶:\n\n```yaml\napiVersion: v1\nkind: PersistentVolumeClaim\nmetadata:\n  name: pvc\n  namespace: dev\nspec:\n  accessModes: # è®¿é—®æ¨¡å¼\n  selector: # é‡‡ç”¨æ ‡ç­¾å¯¹PVé€‰æ‹©\n  storageClassName: # å­˜å‚¨ç±»åˆ«\n  resources: # è¯·æ±‚ç©ºé—´\n    requests:\n      storage: 5Gi\n```\n\nPVC çš„å…³é”®é…ç½®å‚æ•°è¯´æ˜ï¼š\n\n- **è®¿é—®æ¨¡å¼ï¼ˆaccessModesï¼‰**\n\nç”¨äºæè¿°ç”¨æˆ·åº”ç”¨å¯¹å­˜å‚¨èµ„æºçš„è®¿é—®æƒé™\n\n- **é€‰æ‹©æ¡ä»¶ï¼ˆselectorï¼‰**\n  \n  é€šè¿‡Label Selectorçš„è®¾ç½®ï¼Œå¯ä½¿PVCå¯¹äºç³»ç»Ÿä¸­å·±å­˜åœ¨çš„PVè¿›è¡Œç­›é€‰\n\n- **å­˜å‚¨ç±»åˆ«ï¼ˆstorageClassNameï¼‰**\n  \n  PVCåœ¨å®šä¹‰æ—¶å¯ä»¥è®¾å®šéœ€è¦çš„åç«¯å­˜å‚¨çš„ç±»åˆ«ï¼Œåªæœ‰è®¾ç½®äº†è¯¥classçš„pvæ‰èƒ½è¢«ç³»ç»Ÿé€‰å‡º\n\n- **èµ„æºè¯·æ±‚ï¼ˆResources ï¼‰**\n  \n  æè¿°å¯¹å­˜å‚¨èµ„æºçš„è¯·æ±‚\n\n#### ç”Ÿå‘½å‘¨æœŸ\n\nPVCå’ŒPVæ˜¯ä¸€ä¸€å¯¹åº”çš„ï¼ŒPVå’ŒPVCä¹‹é—´çš„ç›¸äº’ä½œç”¨éµå¾ªä»¥ä¸‹ç”Ÿå‘½å‘¨æœŸï¼š\n\n- **èµ„æºä¾›åº”**ï¼šç®¡ç†å‘˜æ‰‹åŠ¨åˆ›å»ºåº•å±‚å­˜å‚¨å’ŒPV\n\n- **èµ„æºç»‘å®š**ï¼šç”¨æˆ·åˆ›å»ºPVCï¼Œkubernetesè´Ÿè´£æ ¹æ®PVCçš„å£°æ˜å»å¯»æ‰¾PVï¼Œå¹¶ç»‘å®š\n  \n  åœ¨ç”¨æˆ·å®šä¹‰å¥½PVCä¹‹åï¼Œç³»ç»Ÿå°†æ ¹æ®PVCå¯¹å­˜å‚¨èµ„æºçš„è¯·æ±‚åœ¨å·²å­˜åœ¨çš„PVä¸­é€‰æ‹©ä¸€ä¸ªæ»¡è¶³æ¡ä»¶çš„\n  \n  - ä¸€æ—¦æ‰¾åˆ°ï¼Œå°±å°†è¯¥PVä¸ç”¨æˆ·å®šä¹‰çš„PVCè¿›è¡Œç»‘å®šï¼Œç”¨æˆ·çš„åº”ç”¨å°±å¯ä»¥ä½¿ç”¨è¿™ä¸ªPVCäº†\n  - å¦‚æœæ‰¾ä¸åˆ°ï¼ŒPVCåˆ™ä¼šæ— é™æœŸå¤„äºPendingçŠ¶æ€ï¼Œç›´åˆ°ç­‰åˆ°ç³»ç»Ÿç®¡ç†å‘˜åˆ›å»ºäº†ä¸€ä¸ªç¬¦åˆå…¶è¦æ±‚çš„PV\n  \n  PVä¸€æ—¦ç»‘å®šåˆ°æŸä¸ªPVCä¸Šï¼Œå°±ä¼šè¢«è¿™ä¸ªPVCç‹¬å ï¼Œä¸èƒ½å†ä¸å…¶ä»–PVCè¿›è¡Œç»‘å®šäº†\n\n- **èµ„æºä½¿ç”¨**ï¼šç”¨æˆ·å¯åœ¨podä¸­åƒvolumeä¸€æ ·ä½¿ç”¨pvc\n  \n  Podä½¿ç”¨Volumeçš„å®šä¹‰ï¼Œå°†PVCæŒ‚è½½åˆ°å®¹å™¨å†…çš„æŸä¸ªè·¯å¾„è¿›è¡Œä½¿ç”¨ã€‚\n\n- **èµ„æºé‡Šæ”¾**ï¼šç”¨æˆ·åˆ é™¤pvcæ¥é‡Šæ”¾pv\n  \n  å½“å­˜å‚¨èµ„æºä½¿ç”¨å®Œæ¯•åï¼Œç”¨æˆ·å¯ä»¥åˆ é™¤PVCï¼Œä¸è¯¥PVCç»‘å®šçš„PVå°†ä¼šè¢«æ ‡è®°ä¸ºâ€œå·²é‡Šæ”¾â€ï¼Œä½†è¿˜ä¸èƒ½ç«‹åˆ»ä¸å…¶ä»–PVCè¿›è¡Œç»‘å®šã€‚é€šè¿‡ä¹‹å‰PVCå†™å…¥çš„æ•°æ®å¯èƒ½è¿˜è¢«ç•™åœ¨å­˜å‚¨è®¾å¤‡ä¸Šï¼Œåªæœ‰åœ¨æ¸…é™¤ä¹‹åè¯¥PVæ‰èƒ½å†æ¬¡ä½¿ç”¨ã€‚\n\n- **èµ„æºå›æ”¶**ï¼škubernetesæ ¹æ®pvè®¾ç½®çš„å›æ”¶ç­–ç•¥è¿›è¡Œèµ„æºçš„å›æ”¶\n  \n  å¯¹äºPVï¼Œç®¡ç†å‘˜å¯ä»¥è®¾å®šå›æ”¶ç­–ç•¥ï¼Œç”¨äºè®¾ç½®ä¸ä¹‹ç»‘å®šçš„PVCé‡Šæ”¾èµ„æºä¹‹åå¦‚ä½•å¤„ç†é—ç•™æ•°æ®çš„é—®é¢˜ã€‚åªæœ‰PVçš„å­˜å‚¨ç©ºé—´å®Œæˆå›æ”¶ï¼Œæ‰èƒ½ä¾›æ–°çš„PVCç»‘å®šå’Œä½¿ç”¨\n\n![img](KubernetesçŸ¥è¯†æ¢³ç†-æ ¸å¿ƒç»„ä»¶/23.png)\n\n#### é…ç½®å­˜å‚¨\n\n##### ConfigMap\n\nConfigMapæ˜¯ä¸€ç§æ¯”è¾ƒç‰¹æ®Šçš„å­˜å‚¨å·ï¼Œå®ƒçš„ä¸»è¦ä½œç”¨æ˜¯ç”¨æ¥å­˜å‚¨é…ç½®ä¿¡æ¯çš„ã€‚\n\nåˆ›å»ºconfigmap.yamlï¼Œå†…å®¹å¦‚ä¸‹ï¼š\n\n```yaml\napiVersion: v1\nkind: ConfigMap\nmetadata:\n  name: configmap\n  namespace: dev\ndata:\n  info: |\n    username:admin\n    password:123456\n```\n\næ¥ä¸‹æ¥ï¼Œä½¿ç”¨æ­¤é…ç½®æ–‡ä»¶åˆ›å»ºconfigmap\n\n```yaml\n# åˆ›å»ºconfigmap\n[root@k8s-master01 ~]# kubectl create -f configmap.yaml\nconfigmap/configmap created\n\n# æŸ¥çœ‹configmapè¯¦æƒ…\n[root@k8s-master01 ~]# kubectl describe cm configmap -n dev\nName:         configmap\nNamespace:    dev\nLabels:       <none>\nAnnotations:  <none>\n\nData\n====\ninfo:\n....\nusername:admin\npassword:123456\n\nEvents:  <none>\n```\n\næ¥ä¸‹æ¥åˆ›å»ºä¸€ä¸ªpod-configmap.yamlï¼Œå°†ä¸Šé¢åˆ›å»ºçš„configmapæŒ‚è½½è¿›å»\n\n```yaml\napiVersion: v1\nkind: Pod\nmetadata:\n  name: pod-configmap\n  namespace: dev\nspec:\n  containers:\n  - name: nginx\n    image: nginx:1.17.1\n    volumeMounts: # å°†configmapæŒ‚è½½åˆ°ç›®å½•\n    - name: config\n      mountPath: /configmap/config\n  volumes: # å¼•ç”¨configmap\n  - name: config\n    configMap:\n      name: configmap\n# åˆ›å»ºpod\n[root@k8s-master01 ~]# kubectl create -f pod-configmap.yaml\npod/pod-configmap created\n\n# æŸ¥çœ‹pod\n[root@k8s-master01 ~]# kubectl get pod pod-configmap -n dev\nNAME            READY   STATUS    RESTARTS   AGE\npod-configmap   1/1     Running   0          6s\n\n#è¿›å…¥å®¹å™¨\n[root@k8s-master01 ~]# kubectl exec -it pod-configmap -n dev /bin/sh\n# cd /configmap/config/\n# ls\ninfo\n# more info\nusername:admin\npassword:123456\n\n# å¯ä»¥çœ‹åˆ°æ˜ å°„å·²ç»æˆåŠŸï¼Œæ¯ä¸ªconfigmapéƒ½æ˜ å°„æˆäº†ä¸€ä¸ªç›®å½•\n# keyè¡¨ç¤ºæ–‡ä»¶     valueè¡¨ç¤ºæ–‡ä»¶ä¸­çš„å†…å®¹\n# æ­¤æ—¶å¦‚æœæ›´æ–°configmapçš„å†…å®¹, å®¹å™¨ä¸­çš„å€¼ä¹Ÿä¼šåŠ¨æ€æ›´æ–°\n```\n\n##### Secret\n\nåœ¨kubernetesä¸­ï¼Œè¿˜å­˜åœ¨ä¸€ç§å’ŒConfigMapéå¸¸ç±»ä¼¼çš„å¯¹è±¡ï¼Œç§°ä¸ºSecretå¯¹è±¡ã€‚å®ƒä¸»è¦ç”¨äºå­˜å‚¨æ•æ„Ÿä¿¡æ¯ï¼Œä¾‹å¦‚å¯†ç ã€ç§˜é’¥ã€è¯ä¹¦ç­‰ç­‰ã€‚\n\né¦–å…ˆä½¿ç”¨base64å¯¹æ•°æ®è¿›è¡Œç¼–ç \n\n```yaml\n[root@k8s-master01 ~]# echo -n 'admin' | base64 #å‡†å¤‡username\nYWRtaW4=\n[root@k8s-master01 ~]# echo -n '123456' | base64 #å‡†å¤‡password\nMTIzNDU2\n```\n\næ¥ä¸‹æ¥ç¼–å†™secret.yamlï¼Œå¹¶åˆ›å»ºSecret\n\n```yaml\napiVersion: v1\nkind: Secret\nmetadata:\n  name: secret\n  namespace: dev\ntype: Opaque\ndata:\n  username: YWRtaW4=\n  password: MTIzNDU2\n# åˆ›å»ºsecret\n[root@k8s-master01 ~]# kubectl create -f secret.yaml\nsecret/secret created\n\n# æŸ¥çœ‹secretè¯¦æƒ…\n[root@k8s-master01 ~]# kubectl describe secret secret -n dev\nName:         secret\nNamespace:    dev\nLabels:       <none>\nAnnotations:  <none>\nType:  Opaque\nData\n====\npassword:  6 bytes\nusername:  5 bytes\n```\n\nåˆ›å»ºpod-secret.yamlï¼Œå°†ä¸Šé¢åˆ›å»ºçš„secretæŒ‚è½½è¿›å»ï¼š\n\n```yaml\napiVersion: v1\nkind: Pod\nmetadata:\n  name: pod-secret\n  namespace: dev\nspec:\n  containers:\n  - name: nginx\n    image: nginx:1.17.1\n    volumeMounts: # å°†secretæŒ‚è½½åˆ°ç›®å½•\n    - name: config\n      mountPath: /secret/config\n  volumes:\n  - name: config\n    secret:\n      secretName: secret\n# åˆ›å»ºpod\n[root@k8s-master01 ~]# kubectl create -f pod-secret.yaml\npod/pod-secret created\n\n# æŸ¥çœ‹pod\n[root@k8s-master01 ~]# kubectl get pod pod-secret -n dev\nNAME            READY   STATUS    RESTARTS   AGE\npod-secret      1/1     Running   0          2m28s\n\n# è¿›å…¥å®¹å™¨ï¼ŒæŸ¥çœ‹secretä¿¡æ¯ï¼Œå‘ç°å·²ç»è‡ªåŠ¨è§£ç äº†\n[root@k8s-master01 ~]# kubectl exec -it pod-secret /bin/sh -n dev\n/ # ls /secret/config/\npassword  username\n/ # more /secret/config/username\nadmin\n/ # more /secret/config/password\n123456\n```\n\nè‡³æ­¤ï¼Œå·²ç»å®ç°äº†åˆ©ç”¨secretå®ç°äº†ä¿¡æ¯çš„ç¼–ç ã€‚\n\n## å®‰å…¨è®¤è¯\n\nKubernetesä½œä¸ºä¸€ä¸ªåˆ†å¸ƒå¼é›†ç¾¤çš„ç®¡ç†å·¥å…·ï¼Œä¿è¯é›†ç¾¤çš„å®‰å…¨æ€§æ˜¯å…¶ä¸€ä¸ªé‡è¦çš„ä»»åŠ¡ã€‚æ‰€è°“çš„å®‰å…¨æ€§å…¶å®å°±æ˜¯ä¿è¯å¯¹Kubernetesçš„å„ç§**å®¢æˆ·ç«¯**è¿›è¡Œ**è®¤è¯å’Œé‰´æƒ**æ“ä½œã€‚\n\n**å®¢æˆ·ç«¯**\n\nåœ¨Kubernetesé›†ç¾¤ä¸­ï¼Œå®¢æˆ·ç«¯é€šå¸¸æœ‰ä¸¤ç±»ï¼š\n\n- **User Account**ï¼šä¸€èˆ¬æ˜¯ç‹¬ç«‹äºkubernetesä¹‹å¤–çš„å…¶ä»–æœåŠ¡ç®¡ç†çš„ç”¨æˆ·è´¦å·ã€‚\n- **Service Account**ï¼škubernetesç®¡ç†çš„è´¦å·ï¼Œç”¨äºä¸ºPodä¸­çš„æœåŠ¡è¿›ç¨‹åœ¨è®¿é—®Kubernetesæ—¶æä¾›èº«ä»½æ ‡è¯†ã€‚\n\n![img](KubernetesçŸ¥è¯†æ¢³ç†-æ ¸å¿ƒç»„ä»¶/24.png)\n\n**è®¤è¯ã€æˆæƒä¸å‡†å…¥æ§åˆ¶**\n\nApiServeræ˜¯è®¿é—®åŠç®¡ç†èµ„æºå¯¹è±¡çš„å”¯ä¸€å…¥å£ã€‚ä»»ä½•ä¸€ä¸ªè¯·æ±‚è®¿é—®ApiServerï¼Œéƒ½è¦ç»è¿‡ä¸‹é¢ä¸‰ä¸ªæµç¨‹ï¼š\n\n- Authenticationï¼ˆè®¤è¯ï¼‰ï¼šèº«ä»½é‰´åˆ«ï¼Œåªæœ‰æ­£ç¡®çš„è´¦å·æ‰èƒ½å¤Ÿé€šè¿‡è®¤è¯\n- Authorizationï¼ˆæˆæƒï¼‰ï¼š åˆ¤æ–­ç”¨æˆ·æ˜¯å¦æœ‰æƒé™å¯¹è®¿é—®çš„èµ„æºæ‰§è¡Œç‰¹å®šçš„åŠ¨ä½œ\n- Admission Controlï¼ˆå‡†å…¥æ§åˆ¶ï¼‰ï¼šç”¨äºè¡¥å……æˆæƒæœºåˆ¶ä»¥å®ç°æ›´åŠ ç²¾ç»†çš„è®¿é—®æ§åˆ¶åŠŸèƒ½ã€‚\n\n![img](KubernetesçŸ¥è¯†æ¢³ç†-æ ¸å¿ƒç»„ä»¶/25.png)\n\n### è®¤è¯ç®¡ç†\n\nKubernetesé›†ç¾¤å®‰å…¨çš„æœ€å…³é”®ç‚¹åœ¨äºå¦‚ä½•è¯†åˆ«å¹¶è®¤è¯å®¢æˆ·ç«¯èº«ä»½ï¼Œå®ƒæä¾›äº†3ç§å®¢æˆ·ç«¯èº«ä»½è®¤è¯æ–¹å¼ï¼š\n\n- HTTP Baseè®¤è¯ï¼šé€šè¿‡ç”¨æˆ·å+å¯†ç çš„æ–¹å¼è®¤è¯\n  \n\nè¿™ç§è®¤è¯æ–¹å¼æ˜¯æŠŠâ€œç”¨æˆ·å:å¯†ç â€ç”¨BASE64ç®—æ³•è¿›è¡Œç¼–ç åçš„å­—ç¬¦ä¸²æ”¾åœ¨HTTPè¯·æ±‚ä¸­çš„Header AuthorizationåŸŸé‡Œå‘é€ç»™æœåŠ¡ç«¯ã€‚æœåŠ¡ç«¯æ”¶åˆ°åè¿›è¡Œè§£ç ï¼Œè·å–ç”¨æˆ·ååŠå¯†ç ï¼Œç„¶åè¿›è¡Œç”¨æˆ·èº«ä»½è®¤è¯çš„è¿‡ç¨‹ã€‚\n\n- HTTP Tokenè®¤è¯ï¼šé€šè¿‡ä¸€ä¸ªTokenæ¥è¯†åˆ«åˆæ³•ç”¨æˆ·\n  \n\nè¿™ç§è®¤è¯æ–¹å¼æ˜¯ç”¨ä¸€ä¸ªå¾ˆé•¿çš„éš¾ä»¥è¢«æ¨¡ä»¿çš„å­—ç¬¦ä¸²--Tokenæ¥è¡¨æ˜å®¢æˆ·èº«ä»½çš„ä¸€ç§æ–¹å¼ã€‚æ¯ä¸ªTokenå¯¹åº”ä¸€ä¸ªç”¨æˆ·åï¼Œå½“å®¢æˆ·ç«¯å‘èµ·APIè°ƒç”¨è¯·æ±‚æ—¶ï¼Œéœ€è¦åœ¨HTTP Headeré‡Œæ”¾å…¥Tokenï¼ŒAPI Serveræ¥åˆ°Tokenåä¼šè·ŸæœåŠ¡å™¨ä¸­ä¿å­˜çš„tokenè¿›è¡Œæ¯”å¯¹ï¼Œç„¶åè¿›è¡Œç”¨æˆ·èº«ä»½è®¤è¯çš„è¿‡ç¨‹ã€‚\n\n- HTTPSè¯ä¹¦è®¤è¯ï¼šåŸºäºCAæ ¹è¯ä¹¦ç­¾åçš„åŒå‘æ•°å­—è¯ä¹¦è®¤è¯æ–¹å¼\n  \n\nè¿™ç§è®¤è¯æ–¹å¼æ˜¯å®‰å…¨æ€§æœ€é«˜çš„ä¸€ç§æ–¹å¼ï¼Œä½†æ˜¯åŒæ—¶ä¹Ÿæ˜¯æ“ä½œèµ·æ¥æœ€éº»çƒ¦çš„ä¸€ç§æ–¹å¼ã€‚\n\n![img](KubernetesçŸ¥è¯†æ¢³ç†-æ ¸å¿ƒç»„ä»¶/26.png)\n\n**HTTPSè®¤è¯å¤§ä½“åˆ†ä¸º3ä¸ªè¿‡ç¨‹ï¼š**\n\n1. è¯ä¹¦ç”³è¯·å’Œä¸‹å‘\n   \n\nâ€‹    HTTPSé€šä¿¡åŒæ–¹çš„æœåŠ¡å™¨å‘CAæœºæ„ç”³è¯·è¯ä¹¦ï¼ŒCAæœºæ„ä¸‹å‘æ ¹è¯ä¹¦ã€æœåŠ¡ç«¯è¯ä¹¦åŠç§é’¥ç»™ç”³è¯·è€…\n\n2. å®¢æˆ·ç«¯å’ŒæœåŠ¡ç«¯çš„åŒå‘è®¤è¯\n\nï¼ˆ1ï¼‰ å®¢æˆ·ç«¯å‘æœåŠ¡å™¨ç«¯å‘èµ·è¯·æ±‚ï¼ŒæœåŠ¡ç«¯ä¸‹å‘è‡ªå·±çš„è¯ä¹¦ç»™å®¢æˆ·ç«¯ï¼Œ å®¢æˆ·ç«¯æ¥æ”¶åˆ°è¯ä¹¦åï¼Œé€šè¿‡ç§é’¥è§£å¯†è¯ä¹¦ï¼Œåœ¨è¯ä¹¦ä¸­è·å¾—æœåŠ¡ç«¯çš„å…¬é’¥ï¼Œ å®¢æˆ·ç«¯åˆ©ç”¨æœåŠ¡å™¨ç«¯çš„å…¬é’¥è®¤è¯è¯ä¹¦ä¸­çš„ä¿¡æ¯ï¼Œå¦‚æœä¸€è‡´ï¼Œåˆ™è®¤å¯è¿™ä¸ªæœåŠ¡å™¨\nï¼ˆ2ï¼‰å®¢æˆ·ç«¯å‘é€è‡ªå·±çš„è¯ä¹¦ç»™æœåŠ¡å™¨ç«¯ï¼ŒæœåŠ¡ç«¯æ¥æ”¶åˆ°è¯ä¹¦åï¼Œé€šè¿‡ç§é’¥è§£å¯†è¯ä¹¦ï¼Œåœ¨è¯ä¹¦ä¸­è·å¾—å®¢æˆ·ç«¯çš„å…¬é’¥ï¼Œå¹¶ç”¨è¯¥å…¬é’¥è®¤è¯è¯ä¹¦ä¿¡æ¯ï¼Œç¡®è®¤å®¢æˆ·ç«¯æ˜¯å¦åˆæ³•\n\n3. æœåŠ¡å™¨ç«¯å’Œå®¢æˆ·ç«¯è¿›è¡Œé€šä¿¡\n\næœåŠ¡å™¨ç«¯å’Œå®¢æˆ·ç«¯åå•†å¥½åŠ å¯†æ–¹æ¡ˆåï¼Œå®¢æˆ·ç«¯ä¼šäº§ç”Ÿä¸€ä¸ªéšæœºçš„ç§˜é’¥å¹¶åŠ å¯†ï¼Œç„¶åå‘é€åˆ°æœåŠ¡å™¨ç«¯ã€‚\næœåŠ¡å™¨ç«¯æ¥æ”¶è¿™ä¸ªç§˜é’¥åï¼ŒåŒæ–¹æ¥ä¸‹æ¥é€šä¿¡çš„æ‰€æœ‰å†…å®¹éƒ½é€šè¿‡è¯¥éšæœºç§˜é’¥åŠ å¯†\n\n> æ³¨æ„: Kuberneteså…è®¸åŒæ—¶é…ç½®å¤šç§è®¤è¯æ–¹å¼ï¼Œåªè¦å…¶ä¸­ä»»æ„ä¸€ä¸ªæ–¹å¼è®¤è¯é€šè¿‡å³å¯\n\n### æˆæƒç®¡ç†\n\næˆæƒå‘ç”Ÿåœ¨è®¤è¯æˆåŠŸä¹‹åï¼Œé€šè¿‡è®¤è¯å°±å¯ä»¥çŸ¥é“è¯·æ±‚ç”¨æˆ·æ˜¯è°ï¼Œ ç„¶åKubernetesä¼šæ ¹æ®äº‹å…ˆå®šä¹‰çš„æˆæƒç­–ç•¥æ¥å†³å®šç”¨æˆ·æ˜¯å¦æœ‰æƒé™è®¿é—®ï¼Œè¿™ä¸ªè¿‡ç¨‹å°±ç§°ä¸ºæˆæƒã€‚\n\næ¯ä¸ªå‘é€åˆ°ApiServerçš„è¯·æ±‚éƒ½å¸¦ä¸Šäº†ç”¨æˆ·å’Œèµ„æºçš„ä¿¡æ¯ï¼šæ¯”å¦‚å‘é€è¯·æ±‚çš„ç”¨æˆ·ã€è¯·æ±‚çš„è·¯å¾„ã€è¯·æ±‚çš„åŠ¨ä½œç­‰ï¼Œæˆæƒå°±æ˜¯æ ¹æ®è¿™äº›ä¿¡æ¯å’Œæˆæƒç­–ç•¥è¿›è¡Œæ¯”è¾ƒï¼Œå¦‚æœç¬¦åˆç­–ç•¥ï¼Œåˆ™è®¤ä¸ºæˆæƒé€šè¿‡ï¼Œå¦åˆ™ä¼šè¿”å›é”™è¯¯ã€‚\n\nAPI Serverç›®å‰æ”¯æŒä»¥ä¸‹å‡ ç§æˆæƒç­–ç•¥ï¼š\n\n- AlwaysDenyï¼šè¡¨ç¤ºæ‹’ç»æ‰€æœ‰è¯·æ±‚ï¼Œä¸€èˆ¬ç”¨äºæµ‹è¯•\n- AlwaysAllowï¼šå…è®¸æ¥æ”¶æ‰€æœ‰è¯·æ±‚ï¼Œç›¸å½“äºé›†ç¾¤ä¸éœ€è¦æˆæƒæµç¨‹ï¼ˆKubernetesé»˜è®¤çš„ç­–ç•¥ï¼‰\n- ABACï¼šåŸºäºå±æ€§çš„è®¿é—®æ§åˆ¶ï¼Œè¡¨ç¤ºä½¿ç”¨ç”¨æˆ·é…ç½®çš„æˆæƒè§„åˆ™å¯¹ç”¨æˆ·è¯·æ±‚è¿›è¡ŒåŒ¹é…å’Œæ§åˆ¶\n- Webhookï¼šé€šè¿‡è°ƒç”¨å¤–éƒ¨RESTæœåŠ¡å¯¹ç”¨æˆ·è¿›è¡Œæˆæƒ\n- Nodeï¼šæ˜¯ä¸€ç§ä¸“ç”¨æ¨¡å¼ï¼Œç”¨äºå¯¹kubeletå‘å‡ºçš„è¯·æ±‚è¿›è¡Œè®¿é—®æ§åˆ¶\n- RBACï¼šåŸºäºè§’è‰²çš„è®¿é—®æ§åˆ¶ï¼ˆkubeadmå®‰è£…æ–¹å¼ä¸‹çš„é»˜è®¤é€‰é¡¹ï¼‰\n\nRBAC(Role-Based Access Control) åŸºäºè§’è‰²çš„è®¿é—®æ§åˆ¶ï¼Œä¸»è¦æ˜¯åœ¨æè¿°ä¸€ä»¶äº‹æƒ…ï¼š**ç»™å“ªäº›å¯¹è±¡æˆäºˆäº†å“ªäº›æƒé™**\n\nå…¶ä¸­æ¶‰åŠåˆ°äº†ä¸‹é¢å‡ ä¸ªæ¦‚å¿µï¼š\n\n- å¯¹è±¡ï¼šUserã€Groupsã€ServiceAccount\n- è§’è‰²ï¼šä»£è¡¨ç€ä¸€ç»„å®šä¹‰åœ¨èµ„æºä¸Šçš„å¯æ“ä½œåŠ¨ä½œ(æƒé™)çš„é›†åˆ\n- ç»‘å®šï¼šå°†å®šä¹‰å¥½çš„è§’è‰²è·Ÿç”¨æˆ·ç»‘å®šåœ¨ä¸€èµ·\n\n![img](KubernetesçŸ¥è¯†æ¢³ç†-æ ¸å¿ƒç»„ä»¶/27.png)\n\nRBACå¼•å…¥äº†4ä¸ªé¡¶çº§èµ„æºå¯¹è±¡ï¼š\n\n- Roleã€ClusterRoleï¼šè§’è‰²ï¼Œç”¨äºæŒ‡å®šä¸€ç»„æƒé™\n- RoleBindingã€ClusterRoleBindingï¼šè§’è‰²ç»‘å®šï¼Œç”¨äºå°†è§’è‰²ï¼ˆæƒé™ï¼‰èµ‹äºˆç»™å¯¹è±¡\n\n**Roleã€ClusterRole**\n\nä¸€ä¸ªè§’è‰²å°±æ˜¯ä¸€ç»„æƒé™çš„é›†åˆï¼Œè¿™é‡Œçš„æƒé™éƒ½æ˜¯è®¸å¯å½¢å¼çš„ï¼ˆç™½åå•ï¼‰ã€‚\n\n```yaml\n# Roleåªèƒ½å¯¹å‘½åç©ºé—´å†…çš„èµ„æºè¿›è¡Œæˆæƒï¼Œéœ€è¦æŒ‡å®šnameapce\nkind: Role\napiVersion: rbac.authorization.k8s.io/v1beta1\nmetadata:\n  namespace: dev\n  name: authorization-role\nrules:\n- apiGroups: [\"\"]  # æ”¯æŒçš„APIç»„åˆ—è¡¨,\"\" ç©ºå­—ç¬¦ä¸²ï¼Œè¡¨ç¤ºæ ¸å¿ƒAPIç¾¤\n  resources: [\"pods\"] # æ”¯æŒçš„èµ„æºå¯¹è±¡åˆ—è¡¨\n  verbs: [\"get\", \"watch\", \"list\"] # å…è®¸çš„å¯¹èµ„æºå¯¹è±¡çš„æ“ä½œæ–¹æ³•åˆ—è¡¨\n# ClusterRoleå¯ä»¥å¯¹é›†ç¾¤èŒƒå›´å†…èµ„æºã€è·¨namespacesçš„èŒƒå›´èµ„æºã€éèµ„æºç±»å‹è¿›è¡Œæˆæƒ\nkind: ClusterRole\napiVersion: rbac.authorization.k8s.io/v1beta1\nmetadata:\n name: authorization-clusterrole\nrules:\n- apiGroups: [\"\"]\n  resources: [\"pods\"]\n  verbs: [\"get\", \"watch\", \"list\"]\n```\n\néœ€è¦è¯¦ç»†è¯´æ˜çš„æ˜¯ï¼Œrulesä¸­çš„å‚æ•°ï¼š\n\n- apiGroups: æ”¯æŒçš„APIç»„åˆ—è¡¨\n  \n  \n  \n```yaml\n  \"\",\"apps\", \"autoscaling\", \"batch\"\n```\n\n- resourcesï¼šæ”¯æŒçš„èµ„æºå¯¹è±¡åˆ—è¡¨\n  \n```yaml\n  \"services\", \"endpoints\", \"pods\",\"secrets\",\"configmaps\",\"crontabs\",\"deployments\",\"jobs\",\n  \"nodes\",\"rolebindings\",\"clusterroles\",\"daemonsets\",\"replicasets\",\"statefulsets\",\n  \"horizontalpodautoscalers\",\"replicationcontrollers\",\"cronjobs\"\n```\n\n- verbsï¼šå¯¹èµ„æºå¯¹è±¡çš„æ“ä½œæ–¹æ³•åˆ—è¡¨\n  \n```yaml\n  \"get\", \"list\", \"watch\", \"create\", \"update\", \"patch\", \"delete\", \"exec\"\n```\n\n**RoleBindingã€ClusterRoleBinding**\n\nè§’è‰²ç»‘å®šç”¨æ¥æŠŠä¸€ä¸ªè§’è‰²ç»‘å®šåˆ°ä¸€ä¸ªç›®æ ‡å¯¹è±¡ä¸Šï¼Œç»‘å®šç›®æ ‡å¯ä»¥æ˜¯Userã€Groupæˆ–è€…ServiceAccountã€‚\n\n```yaml\n# RoleBindingå¯ä»¥å°†åŒä¸€namespaceä¸­çš„subjectç»‘å®šåˆ°æŸä¸ªRoleä¸‹ï¼Œåˆ™æ­¤subjectå³å…·æœ‰è¯¥Roleå®šä¹‰çš„æƒé™\nkind: RoleBinding\napiVersion: rbac.authorization.k8s.io/v1beta1\nmetadata:\n  name: authorization-role-binding\n  namespace: dev\nsubjects:\n - kind: User\n  name: heima\n  apiGroup: rbac.authorization.k8s.io\nroleRef:\n  kind: Role\n  name: authorization-role\n  apiGroup: rbac.authorization.k8s.io\n# ClusterRoleBindingåœ¨æ•´ä¸ªé›†ç¾¤çº§åˆ«å’Œæ‰€æœ‰namespaceså°†ç‰¹å®šçš„subjectä¸ClusterRoleç»‘å®šï¼Œæˆäºˆæƒé™\nkind: ClusterRoleBinding\napiVersion: rbac.authorization.k8s.io/v1beta1\nmetadata:\n name: authorization-clusterrole-binding\nsubjects:\n - kind: User\n  name: heima\n  apiGroup: rbac.authorization.k8s.io\nroleRef:\n  kind: ClusterRole\n  name: authorization-clusterrole\n  apiGroup: rbac.authorization.k8s.io\n```\n\n**RoleBindingå¼•ç”¨ClusterRoleè¿›è¡Œæˆæƒ**\n\nRoleBindingå¯ä»¥å¼•ç”¨ClusterRoleï¼Œå¯¹å±äºåŒä¸€å‘½åç©ºé—´å†…ClusterRoleå®šä¹‰çš„èµ„æºä¸»ä½“è¿›è¡Œæˆæƒã€‚\n\nä¸€ç§å¾ˆå¸¸ç”¨çš„åšæ³•å°±æ˜¯ï¼Œé›†ç¾¤ç®¡ç†å‘˜ä¸ºé›†ç¾¤èŒƒå›´é¢„å®šä¹‰å¥½ä¸€ç»„è§’è‰²ï¼ˆClusterRoleï¼‰ï¼Œç„¶ååœ¨å¤šä¸ªå‘½åç©ºé—´ä¸­é‡å¤ä½¿ç”¨è¿™äº›ClusterRoleã€‚è¿™æ ·å¯ä»¥å¤§å¹…æé«˜æˆæƒç®¡ç†å·¥ä½œæ•ˆç‡ï¼Œä¹Ÿä½¿å¾—å„ä¸ªå‘½åç©ºé—´ä¸‹çš„åŸºç¡€æ€§æˆæƒè§„åˆ™ä¸ä½¿ç”¨ä½“éªŒä¿æŒä¸€è‡´ã€‚\n\n```yaml\n# è™½ç„¶authorization-clusterroleæ˜¯ä¸€ä¸ªé›†ç¾¤è§’è‰²ï¼Œä½†æ˜¯å› ä¸ºä½¿ç”¨äº†RoleBinding\n# æ‰€ä»¥heimaåªèƒ½è¯»å–devå‘½åç©ºé—´ä¸­çš„èµ„æº\nkind: RoleBinding\napiVersion: rbac.authorization.k8s.io/v1beta1\nmetadata:\n  name: authorization-role-binding-ns\n  namespace: dev\nsubjects:\n - kind: User\n  name: heima\n  apiGroup: rbac.authorization.k8s.io\nroleRef:\n  kind: ClusterRole\n  name: authorization-clusterrole\n  apiGroup: rbac.authorization.k8s.io\n```\n\n### å‡†å…¥æ§åˆ¶\n\né€šè¿‡äº†å‰é¢çš„è®¤è¯å’Œæˆæƒä¹‹åï¼Œè¿˜éœ€è¦ç»è¿‡å‡†å…¥æ§åˆ¶å¤„ç†é€šè¿‡ä¹‹åï¼Œapiserveræ‰ä¼šå¤„ç†è¿™ä¸ªè¯·æ±‚ã€‚\n\nå‡†å…¥æ§åˆ¶æ˜¯ä¸€ä¸ªå¯é…ç½®çš„æ§åˆ¶å™¨åˆ—è¡¨ï¼Œå¯ä»¥é€šè¿‡åœ¨Api-Serverä¸Šé€šè¿‡å‘½ä»¤è¡Œè®¾ç½®é€‰æ‹©æ‰§è¡Œå“ªäº›å‡†å…¥æ§åˆ¶å™¨ï¼š\n\n```yaml\n--admission-control=NamespaceLifecycle,LimitRanger,ServiceAccount,PersistentVolumeLabel,\n                      DefaultStorageClass,ResourceQuota,DefaultTolerationSeconds\n```\n\nåªæœ‰å½“æ‰€æœ‰çš„å‡†å…¥æ§åˆ¶å™¨éƒ½æ£€æŸ¥é€šè¿‡ä¹‹åï¼Œapiserveræ‰æ‰§è¡Œè¯¥è¯·æ±‚ï¼Œå¦åˆ™è¿”å›æ‹’ç»ã€‚\n\nå½“å‰å¯é…ç½®çš„Admission Controlå‡†å…¥æ§åˆ¶å¦‚ä¸‹ï¼š\n\n- AlwaysAdmitï¼šå…è®¸æ‰€æœ‰è¯·æ±‚\n- AlwaysDenyï¼šç¦æ­¢æ‰€æœ‰è¯·æ±‚ï¼Œä¸€èˆ¬ç”¨äºæµ‹è¯•\n- AlwaysPullImagesï¼šåœ¨å¯åŠ¨å®¹å™¨ä¹‹å‰æ€»å»ä¸‹è½½é•œåƒ\n- DenyExecOnPrivilegedï¼šå®ƒä¼šæ‹¦æˆªæ‰€æœ‰æƒ³åœ¨Privileged Containerä¸Šæ‰§è¡Œå‘½ä»¤çš„è¯·æ±‚\n- ImagePolicyWebhookï¼šè¿™ä¸ªæ’ä»¶å°†å…è®¸åç«¯çš„ä¸€ä¸ªWebhookç¨‹åºæ¥å®Œæˆadmission controllerçš„åŠŸèƒ½ã€‚\n- Service Accountï¼šå®ç°ServiceAccountå®ç°äº†è‡ªåŠ¨åŒ–\n- SecurityContextDenyï¼šè¿™ä¸ªæ’ä»¶å°†ä½¿ç”¨SecurityContextçš„Podä¸­çš„å®šä¹‰å…¨éƒ¨å¤±æ•ˆ\n- ResourceQuotaï¼šç”¨äºèµ„æºé…é¢ç®¡ç†ç›®çš„ï¼Œè§‚å¯Ÿæ‰€æœ‰è¯·æ±‚ï¼Œç¡®ä¿åœ¨namespaceä¸Šçš„é…é¢ä¸ä¼šè¶…æ ‡\n- LimitRangerï¼šç”¨äºèµ„æºé™åˆ¶ç®¡ç†ï¼Œä½œç”¨äºnamespaceä¸Šï¼Œç¡®ä¿å¯¹Podè¿›è¡Œèµ„æºé™åˆ¶\n- InitialResourcesï¼šä¸ºæœªè®¾ç½®èµ„æºè¯·æ±‚ä¸é™åˆ¶çš„Podï¼Œæ ¹æ®å…¶é•œåƒçš„å†å²èµ„æºçš„ä½¿ç”¨æƒ…å†µè¿›è¡Œè®¾ç½®\n- NamespaceLifecycleï¼šå¦‚æœå°è¯•åœ¨ä¸€ä¸ªä¸å­˜åœ¨çš„namespaceä¸­åˆ›å»ºèµ„æºå¯¹è±¡ï¼Œåˆ™è¯¥åˆ›å»ºè¯·æ±‚å°†è¢«æ‹’ç»ã€‚å½“åˆ é™¤ä¸€ä¸ªnamespaceæ—¶ï¼Œç³»ç»Ÿå°†ä¼šåˆ é™¤è¯¥namespaceä¸­æ‰€æœ‰å¯¹è±¡ã€‚\n- DefaultStorageClassï¼šä¸ºäº†å®ç°å…±äº«å­˜å‚¨çš„åŠ¨æ€ä¾›åº”ï¼Œä¸ºæœªæŒ‡å®šStorageClassæˆ–PVçš„PVCå°è¯•åŒ¹é…é»˜è®¤çš„StorageClassï¼Œå°½å¯èƒ½å‡å°‘ç”¨æˆ·åœ¨ç”³è¯·PVCæ—¶æ‰€éœ€äº†è§£çš„åç«¯å­˜å‚¨ç»†èŠ‚\n- DefaultTolerationSecondsï¼šè¿™ä¸ªæ’ä»¶ä¸ºé‚£äº›æ²¡æœ‰è®¾ç½®forgiveness tolerationså¹¶å…·æœ‰notready:NoExecuteå’Œunreachable:NoExecuteä¸¤ç§taintsçš„Podè®¾ç½®é»˜è®¤çš„â€œå®¹å¿â€æ—¶é—´ï¼Œä¸º5min\n- PodSecurityPolicyï¼šè¿™ä¸ªæ’ä»¶ç”¨äºåœ¨åˆ›å»ºæˆ–ä¿®æ”¹Podæ—¶å†³å®šæ˜¯å¦æ ¹æ®Podçš„security contextå’Œå¯ç”¨çš„PodSecurityPolicyå¯¹Podçš„å®‰å…¨ç­–ç•¥è¿›è¡Œæ§åˆ¶\n\n> æœ¬ç¯‡çŸ¥è¯†æ¥æºäºBç«™è§†é¢‘BV1Qv41167ck\n","tags":["è¿ç»´","k8s","pod","çŸ¥è¯†æ¢³ç†","Linux","PV/PVC","Ingress","Service"],"categories":["å®¹å™¨åŒ–","k8s","æ¢³ç†æ€»ç»“","çŸ¥è¯†æ¢³ç†"]},{"title":"JenkinsçŸ¥è¯†æ¢³ç†","url":"/yyg/f0979e05/","content":"{% folding cyan,ğŸ”œä»€ä¹ˆæ˜¯Jenkinsï¼ŸğŸ”š %}\n\nJenkinsæ˜¯ä¸€æ¬¾åŸºäºJavaå¼€å‘çš„å¼€æº CI&CD è½¯ä»¶ï¼Œç”¨äºè‡ªåŠ¨åŒ–å„ç§ä»»åŠ¡ï¼ŒåŒ…æ‹¬æ„å»ºã€æµ‹è¯•å’Œéƒ¨ç½²è½¯ä»¶ã€‚Jenkinsæä¾›å¤šç§å®‰è£…æ–¹å¼ï¼Œæä¾›è¶…è¿‡1000ä¸ªæ’ä»¶æ¥æ»¡è¶³ä»»ä½•é¡¹ç›®çš„éœ€è¦ã€‚\n\nJenkinsçš„ç‰¹å¾ï¼š\n\n- å¼€æºçš„Javaè¯­è¨€å¼€å‘æŒç»­é›†æˆå·¥å…·ï¼Œæ”¯æŒæŒç»­é›†æˆï¼ŒæŒç»­éƒ¨ç½²ã€‚\n- æ˜“äºå®‰è£…éƒ¨ç½²é…ç½®ï¼šå¯é€šè¿‡yumå®‰è£…ï¼Œæˆ–ä¸‹è½½waråŒ…ä»¥åŠé€šè¿‡dockerå®¹å™¨ç­‰å¿«é€Ÿå®ç°å®‰è£…éƒ¨ç½²ï¼Œå¯æ–¹ä¾¿webç•Œé¢é…ç½®ç®¡ç†ã€‚\n- æ¶ˆæ¯é€šçŸ¥åŠæµ‹è¯•æŠ¥å‘Šï¼šé›†æˆRSS/E-mailé€šè¿‡RSSå‘å¸ƒæ„å»ºç»“æœæˆ–å½“æ„å»ºå®Œæˆæ—¶é€šè¿‡e-mailé€šçŸ¥ï¼Œç”ŸæˆJUnit/TestNGæµ‹è¯•æŠ¥å‘Šã€‚\n- åˆ†å¸ƒå¼æ„å»ºï¼šæ”¯æŒåˆ¶Jenkinsèƒ½å¤Ÿè®©å¤šå°è®¡ç®—æœºä¸€èµ·æ„å»º/æµ‹è¯•ã€‚\n- æ–‡ä»¶è¯†åˆ«ï¼šJenkinsèƒ½å¤Ÿè·Ÿè¸ªå“ªæ¬¡æ„å»ºç”Ÿæˆå“ªäº›jar,å“ªæ¬¡æ„å»ºä½¿ç”¨å“ªä¸ªç‰ˆæœ¬çš„jarç­‰ã€‚\n- ä¸°å¯Œçš„æ’ä»¶æ”¯æŒï¼šæ”¯æŒæ‰©å±•æ’ä»¶ï¼Œä½ å¯ä»¥å¼€å‘é€‚åˆè‡ªå·±å›¢é˜Ÿä½¿ç”¨çš„å·¥å…·ï¼Œå¦‚git,svn,maven,dockerç­‰ã€‚\n\n{% endfolding %}\n\n> æœ¬æ–‡é€šè¿‡GitLab+Jenkins+Tomcatï¼Œæ„å»ºCI/CDæµç¨‹ã€‚\n\n## ä¸»æœºè§„åˆ’\n\n| ä¸»æœºå | ip            | æ‰€éœ€è½¯ä»¶                 | ç”¨é€”                            |\n| ------ | ------------- | --------------------------------- | --------------------------------- |\n| 121    | 192.168.1.121 | GitLab-12.4.2 | ä»£ç æ‰˜ç®¡ |\n| 124   | 192.168.1.124 | Jenkinsã€JDK-21ã€Maven-3.9.9ã€<br />Gitã€SonarQube | JenkinsæŒç»­é›†æˆ |\n| 125   | 192.168.1.125 | JDK-1.8ã€Tomcat-8.5 | å‘å¸ƒæµ‹è¯• |\n\n> æœåŠ¡å™¨æ“ä½œç³»ç»Ÿä¸ºcentos7.9\n\n## éƒ¨ç½²æ­¥éª¤\n\n### éƒ¨ç½²GitLab\n\n#### å®‰è£…GitLab\n\nå®‰è£…ä¾èµ–\n\n```\nyum -y install policycoreutils-python policycoreutils postfix\n```\n\nä¸‹è½½å¹¶å®‰è£…gitlab\n\n```shell\n#ä¸‹è½½gitlabå®‰è£…åŒ…\ncurl -O  http://mirrors.tuna.tsinghua.edu.cn/gitlab-ce/yum/el7/gitlab-ce-12.4.2-ce.0.el7.x86_64.rpm\n#å®‰è£…gitlab\nrpm -i gitlab-ce-12.4.2-ce.0.el7.x86_64.rpm\n```\n\nä¿®æ”¹gitlabé»˜è®¤è®¿é—®ç«¯å£\n\n```shell\nvi /etc/gitlab/gitlab.rb\n\n#å°†é»˜è®¤ç«¯å£80ä¿®æ”¹ä¸º82\nexternal_url \"http://192.168.1.121:82\"\nnginx['listen_port'] = 82\n```\n\né‡è½½é…ç½®ï¼Œå¯åŠ¨gitlab\n\n```shell\ngitlab-ctl reconfigure\ngitlab-ctl restart\n```\n\né…ç½®é˜²ç«å¢™ç­–ç•¥\n\n```shell\nfirewall-cmd --add-port=82/tcp --permanent\nfirewall-cmd --reload\nfirewall-cmd --list-all\n```\n\n> åœ¨æµè§ˆå™¨ä¸­è¾“å…¥http://192.168.1.121:82/,ä¿®æ”¹rootç”¨æˆ·å¯†ç ï¼Œå¹¶ç”¨rootç”¨æˆ·ç™»å½•gitlab\n\n#### ç®¡ç†GitLab\n\nï¼ˆ1ï¼‰åˆ›å»ºç»„\n\nä½¿ç”¨ç®¡ç†å‘˜rootåˆ›å»ºç»„ï¼Œä¸€ä¸ªç»„é‡Œé¢å¯ä»¥æœ‰å¤šä¸ªé¡¹ç›®åˆ†æ”¯ï¼Œå¯ä»¥å°†å¼€å‘æ·»åŠ åˆ°ç»„é‡Œé¢è¿›è¡Œè®¾ç½®æƒé™ï¼Œä¸åŒçš„ç»„å°±æ˜¯å…¬å¸ä¸åŒçš„å¼€å‘é¡¹ç›®æˆ–è€…æœåŠ¡æ¨¡å—ï¼Œä¸åŒçš„ç»„æ·»åŠ ä¸åŒçš„å¼€å‘å³å¯å®ç°å¯¹å¼€å‘è®¾ç½®æƒé™çš„ç®¡ç†ã€‚\n\nï¼ˆ2ï¼‰åˆ›å»ºé¡¹ç›®\n\nï¼ˆ3ï¼‰åˆ›å»ºç”¨æˆ·\n\nåœ¨ç®¡ç†ä¸­å¿ƒ-æ¦‚è§ˆ-ç”¨æˆ·ä¸­ï¼Œåˆ›å»ºä¸€ä¸ªæ–°ç”¨æˆ·`test1`ï¼Œå¹¶è®¾ç½®å¯†ç ï¼Œå°†ç”¨æˆ·åŠ å…¥åˆšåˆ›å»ºçš„é¡¹ç›®ä¸­ã€‚\n\n> Gitlabç”¨æˆ·åœ¨ç»„é‡Œé¢æœ‰5ç§ä¸åŒæƒé™ï¼š\n>\n> - Guestï¼šå¯ä»¥åˆ›å»ºissueã€å‘è¡¨è¯„è®ºï¼Œä¸èƒ½è¯»å†™ç‰ˆæœ¬åº“\n> - Reporterï¼šå¯ä»¥å…‹éš†ä»£ç ï¼Œä¸èƒ½æäº¤ï¼ŒQAã€PMå¯ä»¥èµ‹äºˆè¿™ä¸ªæƒé™\n> - Developerï¼šå¯ä»¥å…‹éš†ä»£ç ã€å¼€å‘ã€æäº¤ã€push,æ™®é€šå¼€å‘å¯ä»¥èµ‹äºˆè¿™ä¸ªæƒé™\n> - Maintainerï¼šå¯ä»¥åˆ›å»ºé¡¹ç›®ã€æ·»åŠ tagã€ä¿æŠ¤åˆ†æ”¯ã€æ·»åŠ é¡¹ç›®æˆå‘˜ã€ç¼–è¾‘é¡¹ç›®ï¼Œæ ¸å¿ƒå¼€å‘å¯ä»¥èµ‹äºˆè¿™ä¸ªæƒé™\n> - Ownerï¼šå¯ä»¥è®¾ç½®é¡¹ç›®è®¿é—®æƒé™Visibility Levelã€åˆ é™¤é¡¹ç›®ã€è¿ç§»é¡¹ç›®ã€ç®¡ç†ç»„æˆå‘˜ï¼Œå‰å‘ç»„ç»„é•¿å¯ä»¥èµ‹äºˆè¿™ä¸ªæƒé™\n\n#### ä¸Šä¼ é¡¹ç›®ä»£ç \n\n> ä½¿ç”¨ideaåˆ›å»ºjavaé¡¹ç›®ï¼Œå¹¶ä¸Šä¼ è‡³gitlabä»“åº“\n>\n> æœ¬æ–‡ä¸­ä½¿ç”¨çš„javaé¡¹ç›®ä»£ç ï¼Œæºè‡ªbç«™upä¸»ï¼Œ''æ¶£æ²·aé‘æƒ·''ï¼ŒåŸæ–‡é“¾æ¥ä¸ºï¼š https://www.yuque.com/huanfqc/jenkins/jenkinsã€‚\n>\n> javaä»£ç åœ°å€ä¸ºï¼š https://share.feijipan.com/s/qdEO7czl\n\nå°†é¡¹ç›®å¯¼å…¥ideaä¸­ï¼Œå¹¶é…ç½®gitlabç›¸å…³è®¾ç½®ï¼Œæ¨é€ä»£ç ï¼Œå…·ä½“æ­¥éª¤å‚è€ƒä¸Šé¢æåˆ°çš„åŸæ–‡é“¾æ¥ã€‚\n\n### éƒ¨ç½²Jenkins\n\n> å®‰è£…jenkins-2.19*ç‰ˆæœ¬æ—¶ï¼Œæ— æ³•æ­£å¸¸å®‰è£…ä¸­æ–‡æ’ä»¶ã€‚æœ¬æ–‡ä½¿ç”¨çš„jdkä¸ºjdk-21ã€jenkinsä¸º2.492.3ï¼Œä¸”å‡ä¸ºrpmæ–¹å¼å®‰è£…\n\nï¼ˆ1ï¼‰å®‰è£…jdk\n\n```shell\nyum install -y wget && wget https://download.oracle.com/java/21/latest/jdk-21_linux-x64_bin.rpm\nrpm -ivh jdk-21_linux-x64_bin.rpm\n#æŸ¥çœ‹ç‰ˆæœ¬\njava -version\n```\n\nï¼ˆ2ï¼‰å®‰è£…Jenkins\n\n```shell\n#ä¸‹è½½jenkins\ncurl -O https://mirrors.tuna.tsinghua.edu.cn/jenkins/redhat-stable/jenkins-2.492.3-1.1.noarch.rpm\n#å®‰è£…\nrpm -ivh jenkins-2.492.3-1.1.noarch.rpm\n```\n\nï¼ˆ3ï¼‰ä¿®æ”¹jenkinsçš„é…ç½®æ–‡ä»¶\n\n```shell\nvi /etc/sysconfig/jenkins\n#ä¿®æ”¹é»˜è®¤ç”¨æˆ·ä¸ºroot\nJENKINS_USER=\"root\"\n#ä¿®æ”¹é»˜è®¤ç«¯å£ä¸º8888\nJENKINS_PORT=8888\n```\n\nï¼ˆ4ï¼‰é…ç½®é˜²ç«å¢™ç­–ç•¥ï¼Œå¹¶å¯åŠ¨jenkins\n\n```shell\nfirewall-cmd --add-port=8888/tcp --permanent\nfirewall-cmd --reload\nfirewall-cmd --list-all\n#å¯åŠ¨jenkins\nsystemctl daemon-reload\nsystemctl start jenkins\nsystemctl enable jenkins\n```\n\nï¼ˆ5ï¼‰æŸ¥çœ‹jenkinsçš„adminåˆå§‹åŒ–å¯†ç \n\n```shell\ncat /var/lib/jenkins/secrets/initialAdminPassword\n```\n\nï¼ˆ6ï¼‰åœ¨æµè§ˆå™¨ä¸­è¾“å…¥http://192.168.1.124:8888/è®¿é—®ï¼Œè¾“å…¥adminåˆå§‹åŒ–å¯†ç ã€‚\n\nï¼ˆ7ï¼‰ç‚¹å‡»`é€‰æ‹©æ’ä»¶æ¥å®‰è£…`ï¼Œé€‰æ‹©`æ— `ï¼Œè·³è¿‡å®‰è£…æ’ä»¶ï¼Œä¸ºä¹‹åé‡æ–°é…ç½®ä¸‹è½½æ’ä»¶çš„å›½å†…æºåšå‡†å¤‡ã€‚\n\n![img](JenkinsçŸ¥è¯†æ¢³ç†/1.png)\n\nï¼ˆ8ï¼‰æŒ‰å¼•å¯¼å®Œæˆjenkinsçš„å®‰è£…ã€‚\n\n#### é…ç½®å›½å†…æ’ä»¶æº\n\nï¼ˆ1ï¼‰é€‰æ‹©å·¦ä¾§è¾¹æ ä¸­çš„Jenkins -Manage Jenkins-Manage Pluginsï¼Œé€‰æ‹©Availableï¼Œç­‰å¾…æ’ä»¶ç›¸å…³æ–‡ä»¶çš„åŠ è½½ã€‚\n\nï¼ˆ2ï¼‰è¿›å…¥æ’ä»¶çš„ç›®å½•ï¼Œå°†åœ°å€ä¿®æ”¹ä¸ºå›½å†…æº\n\n```shell\ncd /var/lib/jenkins/updates && ll\nsed -i 's|http://updates.jenkins-ci.org/download|https://mirrors.tuna.tsinghua.edu.cn/jenkins|g' default.json\nsed -i 's|http://www.google.com|https://www.baidu.com|g' default.json\n```\n\nï¼ˆ3ï¼‰è®¿é—®jenkinsï¼Œé€‰æ‹©å·¦ä¾§è¾¹æ ä¸­çš„Jenkins -Manage Jenkins-Manage Pluginsï¼Œé€‰æ‹©Advancedï¼ŒæŠŠUpdate Siteæ”¹ä¸º`https://mirrors.tuna.tsinghua.edu.cn/jenkins/updates/update-center.json`ï¼ˆæˆ–è€…`https://mirrors.huaweicloud.com/jenkins/updates/update-center.json`ï¼‰ï¼Œä¿å­˜ï¼Œåœ¨æµè§ˆå™¨ä¸­è¾“å…¥`http://192.168.1.124:8888/restart`ï¼Œç‚¹å‡»å¹¶é‡å¯jenkinsã€‚\n\n#### è®¾ç½®ä¸­æ–‡\n\nå®‰è£…ä¸­æ–‡æ’ä»¶ï¼Œé€‰æ‹©å·¦ä¾§è¾¹æ ä¸­çš„Jenkins -Manage Jenkins-Manage Pluginsï¼Œé€‰æ‹©Advancedï¼Œæœç´¢`chinese`ï¼Œå‹¾é€‰æ’ä»¶ï¼Œå¹¶ç‚¹å‡»ä¸‹è½½å¹¶é‡å¯ã€‚\n\n#### ç®¡ç†ç”¨æˆ·æƒé™\n\nå®‰è£…`Role-based Authorization Strategy`æ’ä»¶ï¼Œç®¡ç†ç”¨æˆ·æƒé™ã€‚å®‰è£…å®Œæˆåï¼Œï¼ˆæ–°ç‰ˆjenkinsï¼‰é€‰æ‹©Manage Jenkins-Securityï¼Œæˆæƒç­–ç•¥é€‰æ‹©Role-Based Strategyã€‚é€‰æ‹©Manage Jenkins-Manage and Assign Rolesï¼Œè¿›è¡Œè§’è‰²çš„åˆ›å»ºå’Œåˆ†é…ç®¡ç†ã€‚\n\n#### å‡­è¯ç®¡ç†\n\nï¼ˆ1ï¼‰å®‰è£…`Credentials Binding`æ’ä»¶ï¼Œè¿›è¡Œå‡­è¯ç®¡ç†ã€‚\n\nå‡­è¯ç±»å‹ï¼š\n\n- Username with passwordï¼šç”¨æˆ·åå’Œå¯†ç \n- SSH Username with private keyï¼šä½¿ç”¨ssHç”¨æˆ·å’Œå¯†é’¥\n- Secret fileï¼šéœ€è¦ä¿å¯†çš„æ–‡æœ¬æ–‡ä»¶ï¼Œä½¿ç”¨æ—¶Jenkinsä¼šå°†æ–‡ä»¶å¤åˆ¶åˆ°ä¸€ä¸ªä¸´æ—¶ç›®å½•ä¸­ï¼Œå†å°†æ–‡ä»¶è·¯å¾„è®¾ç½®åˆ°ä¸€ä¸ªå˜é‡ä¸­ï¼Œç­‰æ„å»ºç»“æŸåï¼Œæ‰€å¤åˆ¶çš„Secret fileå°±ä¼šè¢«åˆ é™¤ã€‚\n- Secret textï¼šéœ€è¦ä¿å­˜çš„ä¸€ä¸ªåŠ å¯†çš„æ–‡æœ¬ä¸²ï¼Œå¦‚é’‰é’‰æœºå™¨äººæˆ–Githubçš„api token\n- Certificateï¼šé€šè¿‡ä¸Šä¼ è¯ä¹¦æ–‡ä»¶çš„æ–¹å¼\n\n> å¸¸ç”¨çš„å‡­è¯ç±»å‹æœ‰ï¼šUsername with password(ç”¨æˆ·å¯†ç )å’ŒSSH Username with private key(SSHå¯†é’¥)\n\nï¼ˆ2ï¼‰å®‰è£…`git`æ’ä»¶ï¼Œå¹¶åœ¨æœåŠ¡å™¨ä¸Šä¸‹è½½gitã€‚\n\n```shell\nyum -y install git\n```\n\n##### å¯†ç å‡­è¯\n\nï¼ˆ1ï¼‰åˆ›å»ºjenkinsé¡¹ç›®å’Œå¯†ç å‡­è¯ã€‚é€‰æ‹©Manage Jenkins-Credentialsï¼Œç‚¹å‡»`å…¨å±€`-`Add Credentials`ï¼Œæ·»åŠ gitlabç”¨æˆ·test1çš„ç”¨æˆ·åå’Œå¯†ç ï¼Œåˆ›å»ºå‡­è¯ã€‚\n\n![img](JenkinsçŸ¥è¯†æ¢³ç†/2.png)\n\nï¼ˆ2ï¼‰åˆ›å»ºä¸€ä¸ªæ–°ä»»åŠ¡`test01`ï¼Œç‚¹å‡»é…ç½®ï¼Œè®¾ç½®æºç ç®¡ç†ä¸ºGitï¼Œå¡«å†™gitlabçš„é¡¹ç›®ä»“åº“åœ°å€ï¼ˆhttpå¼€å¤´ï¼‰ï¼Œé€‰æ‹©test1çš„å‡­è¯ï¼Œä¿å­˜å³å¯ã€‚\n\nï¼ˆ3ï¼‰è¿›å…¥test01ï¼Œç‚¹å‡»Build Nowï¼Œç­‰å¾…ä»»åŠ¡æ„å»ºå®Œæˆåï¼Œç‚¹å‡»æ§åˆ¶å°è¾“å‡ºæŸ¥çœ‹è¯¦ç»†ä¿¡æ¯ã€‚\n\n![img](JenkinsçŸ¥è¯†æ¢³ç†/3.png)\n\n![img](JenkinsçŸ¥è¯†æ¢³ç†/4.png)\n\n##### SSHå¯†é’¥å‡­è¯\n\nï¼ˆ1ï¼‰åœ¨jenkinsæœåŠ¡å™¨ä¸­åˆ›å»ºSSHå¯†é’¥ã€‚\n\n```shell\nssh-keygen -t rsa\n#æŸ¥çœ‹å…¬é’¥å†…å®¹\ncat ~/.ssh/id_rsa.pub\n# æµ‹è¯• SSH è¿æ¥\nssh -T git@192.168.1.121\n# æŸ¥çœ‹æ˜¯å¦æœ‰gitlabä¸»æœºï¼Œç¡®ä¿æœ‰è¯¥ä¸»æœºï¼Œå¦åˆ™ä½¿ç”¨sshå‡­è¯æ—¶ä¼šæŠ¥é”™\ncat ~/.ssh/known_hosts\n```\n\nï¼ˆ2ï¼‰ä½¿ç”¨ç®¡ç†å‘˜è´¦æˆ·ç™»å½•Gitlabï¼Œé€‰æ‹©`è®¾ç½®`-`SSHå¯†é’¥`ï¼Œå¡«å…¥SSHå…¬é’¥å†…å®¹ï¼Œå¹¶ä¿å­˜ã€‚\n\nï¼ˆ3ï¼‰åœ¨æœåŠ¡å™¨ä¸­ä½¿ç”¨å‘½ä»¤`cat ~/.ssh/id_rsa`ï¼ŒæŸ¥çœ‹ç§é’¥å†…å®¹ã€‚åœ¨jenkinsä¸­åˆ›å»ºSSHå¯†é’¥å‡­è¯ï¼Œè¾“å…¥ç”¨æˆ·årootå’ŒSSHç§é’¥å†…å®¹ï¼Œä¿å­˜å³å¯ã€‚\n\n![img](JenkinsçŸ¥è¯†æ¢³ç†/5.png)\n\nï¼ˆ4ï¼‰åˆ›å»ºä¸€ä¸ªæ–°ä»»åŠ¡`test02`ï¼Œç‚¹å‡»é…ç½®ï¼Œè®¾ç½®æºç ç®¡ç†ä¸ºGitï¼Œå¡«å†™gitlabçš„é¡¹ç›®ä»“åº“åœ°å€ï¼ˆgitå¼€å¤´ï¼‰ï¼Œé€‰æ‹©SSHå‡­è¯ï¼Œä¿å­˜å³å¯ã€‚\n\nï¼ˆ5ï¼‰è¿›å…¥test02ï¼Œç‚¹å‡»Build Nowï¼Œç­‰å¾…ä»»åŠ¡æ„å»ºå®Œæˆåï¼Œç‚¹å‡»æ§åˆ¶å°è¾“å‡ºæŸ¥çœ‹è¯¦ç»†ä¿¡æ¯ã€‚\n\n![img](JenkinsçŸ¥è¯†æ¢³ç†/6.png)\n\n### å®‰è£…Maven\n\nï¼ˆ1ï¼‰ä¸‹è½½å®‰è£…Maven\n\n```shell\ncurl -O https://mirrors.tuna.tsinghua.edu.cn/apache/maven/maven-3/3.9.9/binaries/apache-maven-3.9.9-bin.tar.gz\n#åˆ›å»ºå­˜å‚¨ç›®å½•\nmkdir -p /opt/maven\ntar -vxzf apache-maven-3.9.9-bin.tar.gz -C /opt/maven/\n#é…ç½®ç¯å¢ƒå˜é‡ï¼Œä½¿ç¯å¢ƒç”Ÿæ•ˆ\necho \"\nexport MAVEN_HOME=/opt/maven/apache-maven-3.9.9\nexport PATH=\\$PATH:\\$MAVEN_HOME/bin\" >> /etc/profile\nsource /etc/profile\n#æŸ¥çœ‹mavenç‰ˆæœ¬\nmvn -v\n```\n\nï¼ˆ2ï¼‰é…ç½®jenkinsä¸mavenå…³è”\n\nåœ¨Manage Jenkins-Toolsä¸­é…ç½®`JDKå®‰è£…`å’Œ`Mavenå®‰è£…`ï¼Œé…ç½®å…¶å¯¹åº”å®‰è£…è·¯å¾„ã€‚\n\n![img](JenkinsçŸ¥è¯†æ¢³ç†/8.png)\n\nåœ¨Manage Jenkins-System-å…¨å±€å±æ€§ä¸­ï¼Œæ–°å¢3ä¸ª`Environment variables`ã€‚\n\n![img](JenkinsçŸ¥è¯†æ¢³ç†/7.png)\n\nï¼ˆ3ï¼‰ä¿®æ”¹Mavençš„æœ¬åœ°ä»“åº“ä½ç½®\n\n```shell\n#åˆ›å»ºæœ¬åœ°ä»“åº“\nmkdir -p /data/jenkins/repo\n#ä¿®æ”¹Mavençš„é…ç½®æ–‡ä»¶\nvi /opt/maven/apache-maven-3.9.9/conf/settings.xml\n#å°†<localRepository>/path/to/local/repo</localRepository>ä¿®æ”¹ä¸º\n  <localRepository>/data/jenkins/repo</localRepository>\n  \n#åœ¨<id>maven-default-http-blocker</id>æ‰€åœ¨çš„é•œåƒåæ·»åŠ é˜¿é‡Œäº‘é•œåƒæº\n#    <mirror>\n#      <id>maven-default-http-blocker</id>\n#      <mirrorOf>external:http:*</mirrorOf>\n#      <name>Pseudo repository to mirror external repositories initially using HTTP.</name>\n#      <url>http://0.0.0.0/</url>\n#      <blocked>true</blocked>\n#    </mirror>\n    <mirror>\n      <id>alimaven</id>\n      <name>aliyun maven</name>\n      <url>http://maven.aliyun.com/nexus/content/groups/public</url>\n      <mirrorOf>central</mirrorOf>\n    </mirror>\n\n```\n\nï¼ˆ4ï¼‰æµ‹è¯•Mavené…ç½®\n\nåœ¨jenkinsä¸­é€‰æ‹©ä»»åŠ¡`test02`ï¼Œé€‰æ‹©é…ç½®-Environment-Build Stepsï¼Œé€‰æ‹©Execute shellä¸­è¾“å…¥å‘½ä»¤`mvn clean package`,ä¿å­˜åï¼Œç‚¹å‡»Build Nowï¼Œç­‰å¾…ä»»åŠ¡æ„å»ºå®Œæˆåï¼Œç‚¹å‡»æ§åˆ¶å°è¾“å‡ºæŸ¥çœ‹è¯¦ç»†ä¿¡æ¯ã€‚\n\n![img](JenkinsçŸ¥è¯†æ¢³ç†/9.png)\n\n![img](JenkinsçŸ¥è¯†æ¢³ç†/10.png)\n\næ­¤æ—¶æœåŠ¡å™¨ä¸Šçš„test02ä»»åŠ¡ç›®å½•ä¸­ä¼šæ–°å¢ä¸€ä¸ª`target`ç›®å½•ã€‚\n\n> [root@124 workspace]# ls\n> test01  test01@tmp  test02  test02@tmp\n> [root@124 workspace]# cd test01\n> [root@124 test01]# ls\n> pom.xml  src\n> [root@124 test01]# cd ..\n> [root@124 workspace]# ls\n> test01  test01@tmp  test02  test02@tmp\n> [root@124 workspace]# cd test02\n> [root@124 test02]# ls\n> pom.xml  src  **target**\n> [root@124 test02]# pwd\n> /var/lib/jenkins/workspace/test02\n> [root@124 test02]#\n\n### å®‰è£…Tomcat\n\nä¸‹è½½jdk-1.8å’Œtomcat-9\n\n```shell\nyum install -y java-1.8.0-openjdk*\ncurl -O https://mirrors.huaweicloud.com/apache/tomcat/tomcat-9/v9.0.104/bin/apache-tomcat-9.0.104.tar.gz\n#åˆ›å»ºå­˜å‚¨ç›®å½•\nmkdir -p /opt/tomcat/\n#è§£å‹\ntar -zxvf apache-tomcat-9.0.104.tar.gz -C /opt/tomcat/\n#å¯åŠ¨tomcat\n/opt/tomcat/apache-tomcat-9.0.104/bin/startup.sh\n```\n\né…ç½®é˜²ç«å¢™ç­–ç•¥\n\n```\nfirewall-cmd --add-port=8080/tcp --permanent\nfirewall-cmd --reload\nfirewall-cmd --list-all\n```\n\nåœ¨æµè§ˆå™¨ä¸­è®¿é—®`http://192.168.1.125:8080/`ã€‚\n\n![img](JenkinsçŸ¥è¯†æ¢³ç†/11.png)\n\né…ç½®tomcatçš„ç”¨æˆ·è§’è‰²\n\n```xml\nvi  /opt/tomcat/apache-tomcat-9.0.104/conf/tomcat-users.xml\n\n<!--åœ¨tomcat-usersæ ‡ç­¾ä¸‹æ·»åŠ ä»¥ä¸‹å†…å®¹ -->\n\n<role rolename=\"tomcat\"/>\n<role rolename=\"role1\"/>\n<role rolename=\"manager-script\"/>\n<role rolename=\"manager-gui\"/>\n<role rolename=\"manager-status\"/>\n<role rolename=\"admin-gui\"/>\n<role rolename=\"admin-script\"/>\n<user username=\"tomcat\" password=\"tomcat\" roles=\"manager-gui,manager-script,tomcat,admin-gui,admin-script\"/>\n\n```\n\né…ç½®tomcatçš„è¿œç¨‹è®¿é—®åœ°å€èŒƒå›´\n\n```xml\nvi /opt/tomcat/apache-tomcat-9.0.104/webapps/manager/META-INF/context.xml\n<!-- å°†ä»¥ä¸‹å†…å®¹æ³¨é‡Š-->\n  <Valve className=\"org.apache.catalina.valves.RemoteAddrValve\"\n         allow=\"127\\.\\d+\\.\\d+\\.\\d+|::1|0:0:0:0:0:0:0:1\" />\n\n```\n\né‡å¯tomcatï¼Œè¾“å…¥ç”¨æˆ·åå’Œå¯†ç è¿›è¡Œè®¿é—®ã€‚\n\n```shell\n#åœæ­¢è¿è¡Œ\n/opt/tomcat/apache-tomcat-9.0.104/bin/shutdown.sh\n#å¯åŠ¨\n/opt/tomcat/apache-tomcat-9.0.104/bin/startup.sh\n```\n\n### Jenkinsæ„å»ºé¡¹ç›®\n\nJenkinsä¸­è‡ªåŠ¨æ„å»ºé¡¹ç›®çš„ç±»å‹æœ‰å¾ˆå¤šï¼Œå¸¸ç”¨çš„æœ‰ä»¥ä¸‹ä¸‰ç§ï¼š\n\n- è‡ªç”±é£æ ¼è½¯ä»¶é¡¹ç›®(FreeStyle Project)\n- Mavené¡¹ç›®(Maven Project)\n- æµæ°´çº¿é¡¹ç›®(Pipeline Project)\n\n> æœ¬æ–‡æ„å»ºé¡¹ç›®æ—¶ä½¿ç”¨çš„waråŒ…ï¼Œæºè‡ªbç«™upä¸»ï¼Œ''æ¶£æ²·aé‘æƒ·''ï¼ŒåŸæ–‡é“¾æ¥ä¸ºï¼š https://www.yuque.com/huanfqc/jenkins/jenkinsã€‚\n>\n> waråŒ…é¡¹ç›®ä»£ç åœ°å€ä¸ºï¼šhttps://share.feijipan.com/s/BWEO9Jadï¼ŒwaråŒ…æ„å»ºå…·ä½“è¿‡ç¨‹è§åŸæ–‡ã€‚\n\n#### Jenkinsæ„å»ºè‡ªç”±é£æ ¼é¡¹ç›®\n\nï¼ˆ1ï¼‰å®‰è£… `Deploy to container` æ’ä»¶\n\nï¼ˆ2ï¼‰æ–°å»ºé¡¹ç›®freestyle_demoï¼Œé…ç½®å¹¶æ‹‰å–gitlabä¸­test_warä»£ç ï¼Œè¯¥è¿‡ç¨‹é™¤åŒ…å«æ­¥éª¤ã€Šéƒ¨ç½²Jenkinsã€‹çš„è¿‡ç¨‹å¤–ï¼Œè¿˜éœ€è¿›è¡Œæ„å»ºåæ“ä½œï¼Œå…·ä½“å¦‚ä¸‹å›¾ã€‚\n\n![img](JenkinsçŸ¥è¯†æ¢³ç†/12.png)\n\nï¼ˆ3ï¼‰é…ç½®ä¿å­˜åï¼Œï¼Œç‚¹å‡»Build Nowï¼Œç­‰å¾…ä»»åŠ¡æ„å»ºå®Œæˆåï¼Œè®¿é—®tomcatï¼Œå¯ä»¥çœ‹åˆ°`/websocketChat-1.0-SNAPSHOT`è™šæ‹Ÿç›®å½•å·²å‡ºç°ã€‚\n\n![img](JenkinsçŸ¥è¯†æ¢³ç†/13.png)\n\n#### Jenkinsæ„å»ºMavené¡¹ç›®\n\nï¼ˆ1ï¼‰å®‰è£…`Maven Integration`æ’ä»¶\n\nï¼ˆ2ï¼‰æ–°å»ºé¡¹ç›®maven-demoï¼Œé…ç½®å¹¶æ‹‰å–gitlabä¸­test_warä»£ç ï¼Œè¯¥è¿‡ç¨‹é™¤åŒ…å«æ­¥éª¤ã€ŠJenkinsæ„å»ºè‡ªç”±é£æ ¼é¡¹ç›®ã€‹çš„è¿‡ç¨‹å¤–ï¼Œè¿˜éœ€è¦åœ¨Buildæ—¶è¿›è¡Œä¿®æ”¹ï¼Œå…·ä½“å¦‚ä¸‹å›¾ã€‚\n\n![img](JenkinsçŸ¥è¯†æ¢³ç†/14.png)\n\n> æ„å»ºæ—¶å‡ºç°æŠ¥é”™å¯å°†ä¹‹å‰é…ç½®çš„é˜¿é‡Œäº‘é•œåƒåœ°å€æ”¹ä¸ºhttps\n\nï¼ˆ3ï¼‰é…ç½®ä¿å­˜åï¼Œç‚¹å‡»Build Nowï¼Œç­‰å¾…ä»»åŠ¡æ„å»ºå®Œæˆåï¼Œè®¿é—®tomcatï¼Œå¯ä»¥çœ‹åˆ°`/websocketChat-1.0-SNAPSHOT`è™šæ‹Ÿç›®å½•å·²å‡ºç°ã€‚\n\n#### Jenkinsæ„å»ºPipelineæµæ°´çº¿é¡¹ç›®\n\nPipeline,ç®€å•æ¥è¯´ï¼Œå°±æ˜¯ä¸€å¥—è¿è¡Œåœ¨Jenkinsä¸Šçš„å·¥ä½œæµæ¡†æ¶ï¼Œå°†åŸæ¥ç‹¬ç«‹è¿è¡Œäºå•ä¸ªæˆ–è€…å¤šä¸ªèŠ‚ç‚¹çš„ä»»åŠ¡è¿æ¥èµ·æ¥ï¼Œå®ç°å•ä¸ªä»»åŠ¡éš¾ä»¥å®Œæˆçš„å¤æ‚æµç¨‹ç¼–æ’å’Œå¯è§†åŒ–çš„å·¥ä½œã€‚\n\nå¦‚ä½•åˆ›å»ºJenkins Pipelineå‘¢ï¼Ÿ\n\n- Pipelineè„šæœ¬æ˜¯ç”±Groovyè¯­è¨€å®ç°çš„ã€‚\n\n- Pipelineæ”¯æŒä¸¤ç§è¯­æ³•ï¼šDeclarative(å£°æ˜å¼)å’ŒScripted Pipeline(è„šæœ¬å¼)è¯­æ³•ã€‚\n\n- Pipelineä¹Ÿæœ‰ä¸¤ç§åˆ›å»ºæ–¹æ³•ï¼šå¯ä»¥ç›´æ¥åœ¨Jenkinsçš„Web Ulç•Œé¢ä¸­è¾“å…¥è„šæœ¬ï¼›ä¹Ÿå¯ä»¥é€šè¿‡åˆ›å»ºä¸€ä¸ªJenkinsfileè„šæœ¬æ–‡ä»¶æ”¾å…¥é¡¹ç›®æºç åº“ä¸­ï¼ˆä¸€èˆ¬æˆ‘ä»¬éƒ½æ¨èåœ¨Jenkinsä¸­ç›´æ¥ä»æºä»£ç æ§åˆ¶(SCM)ä¸­ç›´æ¥è½½å…¥Jenkinsfile Pipelineè¿™ç§æ–¹æ³•)ã€‚\n\n##### åœ¨Jenkinsçš„Web Ulä¸­åˆ›å»ºPipelineè„šæœ¬å‘å¸ƒé¡¹ç›®\n\nï¼ˆ1ï¼‰å®‰è£…Pipelineæ’ä»¶\n\nï¼ˆ2ï¼‰æ–°å»ºä»»åŠ¡Pipeline-demoï¼Œä½¿ç”¨å£°æ˜å¼è¯­æ³•ï¼Œåœ¨Jenkinsçš„Web Ulé‡Œåˆ›å»ºPipelineè„šæœ¬ï¼›å®ç°ä»ä»£ç æ‹‰å–ã€ç¼–è¯‘æ„å»ºã€åˆ°å‘å¸ƒé¡¹ç›®ã€‚\n\nåœ¨Pipeline-demoçš„é…ç½®ç•Œé¢ï¼Œé€‰æ‹©æ„å»ºè§¦å‘å™¨-æµæ°´çº¿ï¼Œé€‰æ‹©ä¸€ä¸ªè„šæœ¬æ¨¡æ¿Hello Wordã€‚\n\n![img](JenkinsçŸ¥è¯†æ¢³ç†/15.png)\n\nç‚¹å‡»`æµæ°´çº¿è¯­æ³•`ï¼Œåœ¨ç‰‡æ®µç”Ÿæˆå™¨ä¸­é€‰æ‹©`checkoutï¼šCheck out from version control`ï¼ŒæŒ‰å¼•å¯¼å¡«å†™é¡¹ç›®åœ°å€å’Œå‡­è¯ï¼Œç”Ÿæˆæµæ°´çº¿è„šæœ¬ï¼Œå°†æ‹‰å–ä»£ç è„šæœ¬ç²˜è´´åˆ°ä¿®æ”¹åçš„æ¨¡æ¿ä¸­ã€‚\n\nåœ¨ç‰‡æ®µç”Ÿæˆå™¨ä¸­é€‰æ‹©`shï¼šShell Script`ï¼Œå¡«å†™ç¼–è¯‘å‘½ä»¤ï¼Œç”Ÿæˆæµæ°´çº¿è„šæœ¬ï¼Œå°†è„šæœ¬ç²˜è´´åˆ°ä¿®æ”¹åçš„æ¨¡æ¿ä¸­ã€‚\n\nåœ¨ç‰‡æ®µç”Ÿæˆå™¨ä¸­é€‰æ‹©`deployï¼šDeploy war/ear to a container`ï¼ŒæŒ‰å¼•å¯¼å¡«å†™ï¼Œç”Ÿæˆæµæ°´çº¿è„šæœ¬ï¼Œå°†è„šæœ¬ç²˜è´´åˆ°ä¿®æ”¹åçš„æ¨¡æ¿ä¸­ã€‚\n\n```groovy\npipeline {\n    agent any\n\n    stages {\n        stage('æ‹‰å–ä»£ç ') {\n            steps {\n                checkout scmGit(branches: [[name: '*/master']], extensions: [], userRemoteConfigs: [[credentialsId: 'fbf87557-40b6-468a-91c5-2cfa1b2e33e8', url: 'http://192.168.1.121:82/test/test_war_demo.git']])\n            }\n        }\n        stage('ç¼–è¯‘æ„å»º') {\n            steps {\n                sh 'mvn clean package'\n            }\n        }\n        stage('å‘å¸ƒé¡¹ç›®') {\n            steps {\n                deploy adapters: [tomcat9(credentialsId: '4d9b76aa-078c-462b-81f1-33fe1d9c971c', path: '', url: 'http://192.168.1.125:8080/')], contextPath: null, war: 'target/*.war'\n            }\n        }\n    }\n}\n\n```\n\nï¼ˆ3ï¼‰é…ç½®ä¿å­˜åï¼Œç‚¹å‡»Build Nowï¼Œç­‰å¾…ä»»åŠ¡æ„å»ºå®Œæˆåï¼Œè®¿é—®tomcatï¼Œå¯ä»¥çœ‹åˆ°`/websocketChat-1.0-SNAPSHOT`è™šæ‹Ÿç›®å½•å·²å‡ºç°ã€‚\n\n##### ä½¿ç”¨Jenkinsfileè„šæœ¬å‘å¸ƒé¡¹ç›®\n\nï¼ˆ1ï¼‰åœ¨ideaä¸­çš„é¡¹ç›®ç›®å½•ä¸‹ï¼Œé€‰æ‹©New-Fileï¼Œåˆ›å»ºJenkinsfileæ–‡ä»¶ï¼Œå°†Pipelineè„šæœ¬å†…å®¹ç²˜è´´è¿›å»ï¼Œéšä»£ç ä¸€èµ·å‘å¸ƒåˆ°é¡¹ç›®ä»“åº“ä¸­ã€‚\n\n![img](JenkinsçŸ¥è¯†æ¢³ç†/16.png)\n\n![img](JenkinsçŸ¥è¯†æ¢³ç†/17.png)\n\nï¼ˆ2ï¼‰åœ¨ä»»åŠ¡Pipeline-demoçš„é…ç½®ç•Œé¢ï¼Œé€‰æ‹©æ„å»ºè§¦å‘å™¨-æµæ°´çº¿ï¼Œå®šä¹‰å†…å®¹é€‰æ‹©`Pipeline script from SCM`-`GIt`ï¼Œå¡«å†™é¡¹ç›®åœ°å€å’Œå‡­è¯ï¼Œè„šæœ¬è·¯å¾„å¡«å†™`Jenkinsfile`ã€‚\n\n![img](JenkinsçŸ¥è¯†æ¢³ç†/18.png)\n\nï¼ˆ3ï¼‰é…ç½®ä¿å­˜åï¼Œç‚¹å‡»Build Nowï¼Œç­‰å¾…ä»»åŠ¡æ„å»ºå®Œæˆåï¼Œè®¿é—®tomcatï¼Œå¯ä»¥çœ‹åˆ°`/websocketChat-1.0-SNAPSHOT`è™šæ‹Ÿç›®å½•å·²å‡ºç°ã€‚\n\n#### å¸¸ç”¨æ„å»ºè§¦å‘å™¨\n\nJenkinså†…ç½®4ç§æ„å»ºè§¦å‘å™¨ï¼š\n\n- è§¦å‘è¿œç¨‹æ„å»º\n\n- å…¶ä»–å·¥ç¨‹æ„å»ºåè§¦å‘(Build after other projects are build)\n\n- å®šæ—¶æ„å»º(Build periodically)\n\n  > å®šæ—¶å­—ç¬¦ä¸²ä»å·¦å¾€å³åˆ†åˆ«ä¸ºï¼šåˆ† æ—¶ æ—¥ æœˆ å‘¨ \n  >\n  > å®šæ—¶è¡¨è¾¾å¼çš„ä¾‹å­ï¼š\n  >\n  > æ¯30åˆ†é’Ÿæ„å»ºä¸€æ¬¡ï¼šHä»£è¡¨å½¢å‚\n  >\n  > H/30 * * * *\n  >\n  > æ¯2ä¸ªå°æ—¶æ„å»ºä¸€æ¬¡ï¼š\n  >\n  > H H/2 * * *\n  >\n  > æ¯å¤©çš„8ç‚¹ï¼Œ12ç‚¹ï¼Œ22ç‚¹ï¼Œä¸€å¤©æ„å»º3æ¬¡ï¼šï¼ˆå¤šä¸ªæ—¶é—´ç‚¹ä¸­é—´ç”¨é€—å·éš”å¼€ï¼‰\n  >\n  > 0 8,12,22 * * *\n\n- è½®è¯¢SCM(Poll SCM)\n\n> è½®è¯¢SCM,æ˜¯æŒ‡å®šæ—¶æ‰«ææœ¬åœ°ä»£ç ä»“åº“çš„ä»£ç æ˜¯å¦æœ‰å˜æ›´ï¼Œå¦‚æœä»£ç æœ‰å˜æ›´å°±è§¦å‘é¡¹ç›®æ„å»ºã€‚\n\nï¼ˆ1ï¼‰è§¦å‘è¿œç¨‹æ„å»º\n\nåœ¨ä»»åŠ¡Pipeline-demoçš„é…ç½®ç•Œé¢ï¼Œé€‰æ‹©`æ„å»ºè§¦å‘å™¨`-`è§¦å‘è¿œç¨‹æ„å»º (ä¾‹å¦‚,ä½¿ç”¨è„šæœ¬)`ï¼Œè‡ªå®šä¹‰èº«ä»½éªŒè¯ä»¤ç‰Œä¸º`test`ï¼Œä¿å­˜é…ç½®ã€‚åœ¨æµè§ˆå™¨ä¸­è®¿é—®ï¼š\n\n> jenkinsåœ°å€/job/Pipeline-demo/build?token=`TOKEN_NAME`  \n\nhttp://192.168.1.124:8888/job/Pipeline-demo/build?token=test ï¼Œè¿”å›æŸ¥çœ‹ä»»åŠ¡çŠ¶æ€å·²ç»å¼€å§‹æ„å»ºã€‚\n\nï¼ˆ2ï¼‰å…¶ä»–å·¥ç¨‹æ„å»ºåè§¦å‘(Build after other projects are build)\n\nå½“éœ€è¦å¤šä¸ªä»»åŠ¡å…ˆåæ‰§è¡Œæ—¶å¯ç”¨ã€‚æ¯”å¦‚è‹¥å¸Œæœ›æ‰§è¡Œ`freestyle_demo`ä»»åŠ¡åï¼Œå†æ‰§è¡Œ`Pipeline-demo`ï¼Œåœ¨ä»»åŠ¡Pipeline-demoçš„é…ç½®ç•Œé¢ï¼Œé€‰æ‹©`æ„å»ºè§¦å‘å™¨`-`Build after other projects are built`ï¼Œä¸­è¾“å…¥`freestyle_demo`ï¼Œé€‰æ‹©`åªæœ‰æ„å»ºç¨³å®šæ—¶è§¦å‘`ï¼Œä¿å­˜é…ç½®ã€‚freestyle_demoä»»åŠ¡æ„å»ºå®Œæˆåï¼Œfreestyle_demoå¼€å§‹è¿›è¡Œæ„å»ºã€‚\n\nï¼ˆ3ï¼‰å®šæ—¶æ„å»º(Build periodically)\n\nåœ¨ä»»åŠ¡Pipeline-demoçš„é…ç½®ç•Œé¢ï¼Œé€‰æ‹©`æ„å»ºè§¦å‘å™¨`-`Build periodically`ï¼Œè®¾ç½®`*/1 * * * *`ï¼ˆä¸€åˆ†é’Ÿä¸€æ¬¡ï¼‰ï¼Œä¿å­˜é…ç½®ï¼Œfreestyle_demoä»»åŠ¡ä¼šæ¯åˆ†é’Ÿæ„å»ºä¸€æ¬¡ã€‚\n\nï¼ˆ4ï¼‰è½®è¯¢SCM(Poll SCM)\n\nè½®è¯¢SCMä¹Ÿè¦è®¾ç½®æ—¶é—´å‘¨æœŸï¼Œä¸è¿‡ä¸å®šæ—¶æ„å»ºä¸åŒçš„æ˜¯ï¼Œå¦‚æœåœ¨æ—¶é—´å‘¨æœŸå†…ä»£ç ä»“åº“æœªå‘ç”Ÿå˜åŒ–ï¼Œä»»åŠ¡æ„å»ºå°±ä¸ä¼šè¿›è¡Œã€‚æ¯”å¦‚ï¼šåœ¨ä»»åŠ¡Pipeline-demoçš„é…ç½®ç•Œé¢ï¼Œé€‰æ‹©`æ„å»ºè§¦å‘å™¨`-`Poll SCM`ï¼Œè®¾ç½®`*/1 * * * *`ï¼ˆä¸€åˆ†é’Ÿä¸€æ¬¡ï¼‰ï¼Œä¿å­˜é…ç½®ã€‚å¦‚æœåœ¨ä¹‹åçš„ä¸€åˆ†é’Ÿå†…ä»£ç å˜æ›´ï¼ŒPipeline-demoä»»åŠ¡ä¼šè¿›è¡Œæ„å»ºï¼Œåä¹‹ï¼Œç›´åˆ°ä»£ç å˜æ›´åçš„é‚£ä¸€åˆ†é’Ÿå‘¨æœŸå†…è¿›è¡Œæ„å»ºã€‚\n\n#### Git hookæ„å»ºè§¦å‘å™¨ï¼ˆå¸¸ç”¨ï¼‰\n\n> å½“GitLabå‡ºç°ä»£ç å˜æ›´æ—¶ï¼Œä¼šæäº¤æ„å»ºè¯·æ±‚åˆ°Jenkinsï¼ŒJenkinsæ”¶åˆ°è¯·æ±‚åï¼Œè§¦å‘æ„å»ºã€‚\n>\n\nï¼ˆ1ï¼‰å®‰è£…GitLabæ’ä»¶å’ŒGitLab Hookæ’ä»¶ï¼ˆæ–°ç‰ˆæœ¬è‡ªå¸¦GitLab Hookæ’ä»¶ï¼‰\n\nï¼ˆ2ï¼‰åœ¨Jenkinsçš„ä»»åŠ¡Pipeline-demoçš„é…ç½®ç•Œé¢ï¼Œé€‰æ‹©`æ„å»ºè§¦å‘å™¨`-`Build when a change is pushed to GitLab. GitLab webhook URL: http://192.168.1.124:8888/project/Pipeline-demo`ï¼Œä¼šå‡ºç°ä»¥ä¸‹è¡¨æ ¼ä¸­çš„é€‰é¡¹ï¼Œé»˜è®¤é€‰æ‹©å³å¯ã€‚\n\n| **äº‹ä»¶ç±»å‹**              | **è§¦å‘æ¡ä»¶**                                 |\n| ------------------------- | -------------------------------------------- |\n| **Push Events**           | ä»£ç æ¨é€åˆ°åˆ†æ”¯æˆ–æ ‡ç­¾ï¼ŒåŒ…æ‹¬æ–°åˆ†æ”¯åˆ›å»ºã€‚       |\n| **Push on Branch Delete** | åˆ†æ”¯è¢«åˆ é™¤æ—¶ã€‚                               |\n| **Opened Merge Request**  | åˆ›å»ºæ–°çš„åˆå¹¶è¯·æ±‚æ—¶è§¦å‘ã€‚                     |\n| **New Commits in MR**     | å‘å·²å­˜åœ¨çš„MRæ¨é€æ–°æäº¤æ—¶è§¦å‘ï¼ˆæ›´æ–°MRï¼‰ã€‚     |\n| **Accepted (Merged) MR**  | åˆå¹¶è¯·æ±‚è¢«åˆå¹¶åˆ°ç›®æ ‡åˆ†æ”¯ï¼ˆå¦‚`main`ï¼‰æ—¶è§¦å‘ã€‚ |\n| **Closed MR**             | åˆå¹¶è¯·æ±‚è¢«å…³é—­ï¼ˆæœªåˆå¹¶ï¼‰æ—¶è§¦å‘ã€‚             |\n\nï¼ˆ3ï¼‰åœ¨Jenkinsä¸­é€‰æ‹©Manage Jenkins-System-GitLabä¸­ï¼Œå–æ¶ˆå‹¾é€‰`Enable authentication for '/project' end-point`ï¼Œä¿å­˜è®¾ç½®ã€‚\n\nï¼ˆ4ï¼‰åœ¨GitLabçš„ç®¡ç†å‘˜è´¦æˆ·ä¸­é€‰æ‹©ç®¡ç†ä¸­å¿ƒ-è®¾ç½®-ç½‘ç»œ-å¤–å‘è¯·æ±‚ä¸­å‹¾é€‰`Allow requests to the local network from web hooks and services` ï¼Œä¿å­˜é…ç½®ã€‚\n\nï¼ˆ5ï¼‰åœ¨GitLabçš„é¡¹ç›®ä»“åº“ä¸­é€‰æ‹©è®¾ç½®-é›†æˆï¼Œè¾“å…¥webhook URLï¼Œé€‰æ‹©é»˜è®¤é…ç½®ï¼Œä¿å­˜ã€‚åœ¨ç”Ÿæˆçš„Webhookå³ä¾§ï¼Œé€‰æ‹©Test-Push eventsï¼Œæ˜¾ç¤º`Hook executed successfully: HTTP 200`ï¼Œå³ä¸ºæˆåŠŸã€‚\n\n#### å‚æ•°åŒ–æ„å»º\n\nï¼ˆ1ï¼‰åœ¨æºç ä¸­åˆ›å»ºåˆ†æ”¯v1ï¼Œå¹¶ä¿®æ”¹Jenkinsfileè„šæœ¬ä¸­çš„åˆ†æ”¯åç§°ï¼Œæäº¤ä»£ç åˆ°gitlabã€‚\n\n> ä¿®æ”¹å‰ï¼š checkout scmGit(branches: [[name: '*/master']]\n>\n>  ä¿®æ”¹åï¼šcheckout scmGit(branches: [[name: '*/${branch}']]\n\nï¼ˆ2ï¼‰åœ¨Jenkinsçš„ä»»åŠ¡Pipeline-demoçš„é…ç½®ç•Œé¢ï¼Œé€‰æ‹©`This project is parameterized`-`String Parameter`ï¼Œå…·ä½“è®¾ç½®å¦‚ä¸‹å›¾ã€‚\n\n![img](JenkinsçŸ¥è¯†æ¢³ç†/19.png)\n\nï¼ˆ3ï¼‰ä¿å­˜è®¾ç½®ï¼Œåœ¨ä»»åŠ¡Pipeline-demoç•Œé¢é€‰æ‹©`Build with Parameters`ï¼Œè¾“å…¥åˆ†æ”¯çš„åç§°ï¼Œç‚¹å‡»Buildï¼Œè¿›è¡Œæ„å»ºã€‚\n\n#### é…ç½®é‚®ä»¶æœåŠ¡å™¨\n\nï¼ˆ1ï¼‰å®‰è£…Email Extension TemplateVersionæ’ä»¶\n\nï¼ˆ2ï¼‰é€‰æ‹©Manage Jenkins-Credentialsï¼Œç‚¹å‡»`å…¨å±€`-`Add Credentials`ï¼Œåˆ›å»ºé‚®ä»¶æœåŠ¡å™¨çš„å¯†ç å‡­è¯ï¼Œè´¦æˆ·ä¸ºé‚®ç®±åœ°å€ï¼Œå¯†ç ä¸ºè·å–çš„é‚®ç®±æˆæƒç ã€‚\n\nï¼ˆ3ï¼‰é€‰æ‹©`System`ï¼Œåœ¨`Jenkins Location``-ç³»ç»Ÿç®¡ç†å‘˜é‚®ä»¶åœ°å€`å‡ºè¾“å…¥æ³¨å†Œé‚®ç®±ï¼Œåœ¨`Extended E-mail Notification`å¤„ï¼Œè¾“å…¥æ³¨å†Œé‚®ç®±å’Œç«¯å£ï¼Œç‚¹å‡»`é«˜çº§`ï¼Œé€‰æ‹©å¯†ç å‡­è¯ï¼Œå‹¾é€‰`Use SSL`ï¼Œåœ¨`Default user e-mail suffix`ä¸­é‚®ç®±åç¼€ï¼Œ`Default Content Type`é€‰æ‹©`HTML (text/html)`ï¼Œ`Default Recipients`è¾“å…¥æ³¨å†Œé‚®ç®±ï¼Œåœ¨é‚®ä»¶é€šçŸ¥éƒ¨åˆ†è¾“å…¥SMTPæœåŠ¡å™¨å’Œç”¨æˆ·é»˜è®¤é‚®ä»¶åç¼€ï¼Œç‚¹å‡»é«˜çº§å®Œå–„ä¿¡æ¯ï¼Œå‹¾é€‰`é€šè¿‡å‘é€æµ‹è¯•é‚®ä»¶æµ‹è¯•é…ç½®`æµ‹è¯•é‚®ä»¶æœåŠ¡å™¨ã€‚\n\nï¼ˆ4ï¼‰æ„å»ºé‚®ä»¶æœåŠ¡å™¨æ¨¡æ¿\n\nåœ¨é¡¹ç›®æ ¹ç›®å½•ä¸‹åˆ›å»ºemail.htmlæ¨¡æ¿\n\n```html\n<!DOCTYPE html>\n<html>\n<head>\n    <meta charset=\"UTF-8\">\n    <title>${ENV, var=\"JOB_NAME\"}-ç¬¬${BUILD_NUMBER}æ¬¡æ„å»ºæ—¥å¿—</title>\n\n</head>\n\n<body leftmargin=\"8\" marginwidth=\"0\" topmargin=\"8\" marginheight=\"4\"\n      offset=\"0\">\n<table width=\"95%\" cellpadding=\"0\" cellspacing=\"0\"\n       style=\"font-size: 11pt; font-family: Tahoma, Arial, Helvetica, sans-serif\">\n    <tr>\n        <td>(æœ¬é‚®ä»¶æ˜¯ç¨‹åºè‡ªåŠ¨ä¸‹å‘çš„ï¼Œè¯·å‹¿å›å¤ï¼)</td>\n\n    </tr>\n\n    <tr>\n        <td><h2>\n                <font color=\"#0000FF\">æ„å»ºç»“æœ - ${BUILD_STATUS}</font>\n\n            </h2></td>\n\n    </tr>\n\n    <tr>\n        <td><br />\n            <b><font color=\"#0B610B\">æ„å»ºä¿¡æ¯</font></b>\n\n            <hr size=\"2\" width=\"100%\" align=\"center\" /></td>\n\n    </tr>\n\n    <tr>\n        <td>\n            <ul>\n                <li>é¡¹ç›®åç§°&nbsp;ï¼š&nbsp;${PROJECT_NAME}</li>\n\n                <li>æ„å»ºç¼–å·&nbsp;ï¼š&nbsp;ç¬¬${BUILD_NUMBER}æ¬¡æ„å»º</li>\n\n                <li>è§¦å‘åŸå› ï¼š&nbsp;${CAUSE}</li>\n\n                <li>æ„å»ºæ—¥å¿—ï¼š&nbsp;<a href=\"${BUILD_URL}console\">${BUILD_URL}console</a></li>\n\n                <li>æ„å»º&nbsp;&nbsp;Url&nbsp;ï¼š&nbsp;<a href=\"${BUILD_URL}\">${BUILD_URL}</a></li>\n\n                <li>å·¥ä½œç›®å½•&nbsp;ï¼š&nbsp;<a href=\"${PROJECT_URL}ws\">${PROJECT_URL}ws</a></li>\n\n                <li>é¡¹ç›®&nbsp;&nbsp;Url&nbsp;ï¼š&nbsp;<a href=\"${PROJECT_URL}\">${PROJECT_URL}</a></li>\n\n            </ul>\n\n        </td>\n\n    </tr>\n\n    <tr>\n        <td><b><font color=\"#0B610B\">Changes Since Last\n                    Successful Build:</font></b>\n\n            <hr size=\"2\" width=\"100%\" align=\"center\" /></td>\n\n    </tr>\n\n    <tr>\n        <td>\n            <ul>\n                <li>å†å²å˜æ›´è®°å½• : <a href=\"${PROJECT_URL}changes\">${PROJECT_URL}changes</a></li>\n\n            </ul> ${CHANGES_SINCE_LAST_SUCCESS,reverse=true, format=\"Changes for Build #%n:<br />%c<br />\",showPaths=true,changesFormat=\"<pre>[%a]<br />%m</pre>\",pathFormat=\"&nbsp;&nbsp;&nbsp;&nbsp;%p\"}\n        </td>\n\n    </tr>\n\n    <tr>\n        <td><b>Failed Test Results</b>\n\n            <hr size=\"2\" width=\"100%\" align=\"center\" /></td>\n\n    </tr>\n\n    <tr>\n        <td><pre\n                    style=\"font-size: 11pt; font-family: Tahoma, Arial, Helvetica, sans-serif\">$FAILED_TESTS</pre>\n\n            <br /></td>\n\n    </tr>\n\n    <tr>\n        <td><b><font color=\"#0B610B\">æ„å»ºæ—¥å¿— (æœ€å 100è¡Œ):</font></b>\n\n            <hr size=\"2\" width=\"100%\" align=\"center\" /></td>\n\n    </tr>\n\n    <tr>\n        <td><textarea cols=\"80\" rows=\"30\" readonly=\"readonly\"\n                      style=\"font-family: Courier New\">${BUILD_LOG, maxLines=100}</textarea>\n\n        </td>\n\n    </tr>\n\n</table>\n\n</body>\n\n</html>\n```\n\nï¼ˆ5ï¼‰ä¿®æ”¹Jenkinsfileæ–‡ä»¶ï¼Œæ·»åŠ ä¸stagesåŒçº§çš„postéƒ¨åˆ†ï¼Œæ·»åŠ æ„å»ºåå‘é€é‚®ä»¶\n\n```groovy\npipeline {\n    agent any\n\n    stages {\n        stage('æ‹‰å–ä»£ç ') {\n            steps {\n                checkout scmGit(branches: [[name: '*/master']], extensions: [], userRemoteConfigs: [[credentialsId: 'fbf87557-40b6-468a-91c5-2cfa1b2e33e8', url: 'http://192.168.1.121:82/test/test_war_demo.git']])\n            }\n        }\n        stage('ç¼–è¯‘æ„å»º') {\n            steps {\n                sh 'mvn clean package'\n            }\n        }\n        stage('å‘å¸ƒé¡¹ç›®') {\n            steps {\n                deploy adapters: [tomcat9(credentialsId: '4d9b76aa-078c-462b-81f1-33fe1d9c971c', path: '', url: 'http://192.168.1.125:8080/')], contextPath: null, war: 'target/*.war'\n            }\n        }\n    }\n    post {\n        always {\n            emailext(\n                subject: 'æ„å»ºé€šçŸ¥ï¼š${PROJECT_NAME} - Build # ${BUILD_NUMBER} - ${BUILD_STATUS}!',\n                body: '${FILE,path=\"email.html\"}',\n                to: 'é‚®ç®±åœ°å€1,é‚®ç®±åœ°å€2'\n            )\n        }\n    }\n}\n\n```\n\n### å®‰è£…SonarQube\n\nJenkinsé›†æˆSonarQubeè¿›è¡Œä»£ç å®¡æŸ¥ã€‚\n\n> SonarQube7.9å¼€å§‹ä¸å†æ”¯æŒmysqlï¼ŒSonarQube7.8å®‰è£…æ”¯æŒmysql >=5.6 && <8.0\n\nï¼ˆ1ï¼‰å®‰è£…SonarQubeå‰éœ€è¦å®‰è£…mysqlæ•°æ®åº“\n\n```shell\n#é…ç½®mysql5.7çš„yumæº\nvi /etc/yum.repos.d/mysql-community.repo\n\n[mysql-connectors-community]\nname=MySQL Connectors Community\nbaseurl=https://mirrors.tuna.tsinghua.edu.cn/mysql/yum/mysql-connectors-community-el7-$basearch/\nenabled=1\ngpgcheck=1\ngpgkey=https://repo.mysql.com/RPM-GPG-KEY-mysql-2022\n\n[mysql-tools-community]\nname=MySQL Tools Community\nbaseurl=https://mirrors.tuna.tsinghua.edu.cn/mysql/yum/mysql-tools-community-el7-$basearch/\nenabled=1\ngpgcheck=1\ngpgkey=https://repo.mysql.com/RPM-GPG-KEY-mysql-2022\n\n[mysql-5.7-community]\nname=MySQL 5.7 Community Server\nbaseurl=https://mirrors.tuna.tsinghua.edu.cn/mysql/yum/mysql-5.7-community-el7-$basearch/\nenabled=1\ngpgcheck=1\ngpgkey=https://repo.mysql.com/RPM-GPG-KEY-mysql-2022\n\n\n#å®‰è£…mysql\nyum -y install mysql-server\n# æŸ¥çœ‹ç‰ˆæœ¬\nmysql -V\nsystemctl start mysqld\nsystemctl enable mysqld\n# æŸ¥çœ‹MySQLçš„åˆå§‹å¯†ç \ngrep \"password\" /var/log/mysqld.log\n# MySQLçš„å®‰å…¨æ€§é…ç½®\nmysql_secure_installation\n#æŒ‰å¼•å¯¼é…ç½®å®Œåï¼Œç™»å½•å¹¶åˆ›å»ºæ•°æ®åº“\nmysql -uroot -p\ncreate database sonar;\n#æŸ¥çœ‹æ•°æ®åº“\nshow databases;\n```\n\nï¼ˆ2ï¼‰å®‰è£…SonarQube\n\n```shell\n#é…ç½®ç³»ç»Ÿç›¸å…³å‚æ•°\necho \"vm.max_map_count=524288\nfs.file-max=131072\" >> /etc/sysctl.conf\nsysctl -p\n\n#ä¸‹è½½ä¾èµ–å·¥å…·\nyum install -y unzip\nwget https://binaries.sonarsource.com/Distribution/sonarqube/sonarqube-7.8.zip\nmkdir -p /opt/sonar\nunzip -q sonarqube-7.8.zip -d /opt/sonar\n#åˆ›å»ºç”¨æˆ·\nuseradd sonar\npasswd sonar\n#ä¿®æ”¹sonarqubeæ–‡ä»¶æƒé™\nchown -R sonar:sonar /opt/sonar/sonarqube-7.8\n```\n\nï¼ˆ3ï¼‰ä¿®æ”¹`conf`ç›®å½•ä¸‹çš„`sonar.properties`é…ç½®æ–‡ä»¶\n\n```shell\nsonar.jdbc.username=root\nsonar.jdbc.password=æ•°æ®åº“å¯†ç \nsonar.jdbc.url=jdbc:mysql://localhost:3306/sonar?useUnicode=true&characterEncoding=utf8&rewriteBatchedStatements=true&useConfigs=maxPerformance&useSSL=false\n```\n\nï¼ˆ4ï¼‰ä¿®æ”¹`conf`ç›®å½•ä¸‹`wrapper.conf`çš„jdk-1.8çš„è·¯å¾„\n\n```shell\nwrapper.java.command=/usr/lib/jvm/java-1.8.0-openjdk-1.8.0.412.b08-1.el7_9.x86_64/bin/java\n```\n\nï¼ˆ5ï¼‰è¿›å…¥`bin/linux-x86-64/`ç›®å½•ï¼Œä½¿ç”¨sonarç”¨æˆ·å¯åŠ¨sonarqube\n\n```shell\nsu sonar\n./sonar.sh start\n#æŸ¥çœ‹å¯åŠ¨æ—¥å¿—\ntail ../../logs/sonar.log\n```\n\n> ä½¿ç”¨é»˜è®¤è´¦æˆ·ç™»å½•ï¼Œè´¦å·å¯†ç éƒ½æ˜¯admin\n\nï¼ˆ6ï¼‰ç™»å½•sonarqubeåï¼Œé€‰æ‹© `Administration` - `Security`- `Global Permissions`ï¼Œä¸ºadminå‹¾é€‰ `Administer System`**ã€**`Administer`**ã€**`Execute Analysis`ã€`Create` æƒé™ã€‚å•å‡»å³ä¸Šè§’å¤´åƒä¸‹æ‹‰æ¡†ï¼Œé€‰æ‹© `My Account` - `Security`ï¼Œéšæ„å¡«å†™tokenåç§°ï¼Œå®Œæˆ Token çš„åˆ›å»ºã€‚\n\n#### **é…ç½®Jenkinsä¸sonarqubeé›†æˆ**\n\nï¼ˆ1ï¼‰åœ¨Jenkinsä¸Šå®‰è£…`SonarQube Scanner`æ’ä»¶ï¼Œå®‰è£…å®Œæˆåï¼Œé€‰æ‹©`Manage Jenkins` -`Tools`-`SonarQube Scanner å®‰è£…`ï¼Œç‚¹å‡»`æ–°å¢SonarQube Scanner` ï¼Œè¾“å…¥åç§°ï¼Œç‰ˆæœ¬é€‰æ‹©`SonarQube Scanner 4.2.0.1873`ï¼Œç‚¹å‡»ä¿å­˜ã€‚\n\n> **SonarQube 7.8** å¯¹åº” **Sonar-Scanner 4.2**\n>\n> **SonarQube 8.9 LTS** å¯¹åº” **Sonar-Scanner 4.6**\n\nï¼ˆ2ï¼‰åœ¨Jenkinsä¸­é…ç½®SonarQubeçš„tokenå‡­è¯ã€‚é€‰æ‹©ç±»å‹ä¸º`Secret text`ï¼Œè¾“å…¥tokenï¼Œç‚¹å‡»åˆ›å»ºã€‚\n\nï¼ˆ3ï¼‰åœ¨Jenkinsä¸­é€‰æ‹©System-SonarQube installationsï¼Œç‚¹å‡»`Add SonarQube`ï¼Œè¾“å…¥SonarQubeçš„åœ°å€ã€é€‰æ‹©åˆ›å»ºçš„tokenå‡­è¯ï¼Œä¿å­˜é›†æˆSonarQubeã€‚\n\n#### **éæµæ°´çº¿ä»»åŠ¡æ·»åŠ SonarQubeä»£ç å®¡æŸ¥**\n\nåœ¨freestyle_demoä»»åŠ¡ä¸­é€‰æ‹©é…ç½®-Build Stepsï¼Œç‚¹å‡»å¢åŠ æ„å»ºæ­¥éª¤ï¼Œé€‰æ‹©`Execute SonarQube Scanner`ï¼Œé€‰æ‹©JDKï¼Œè¾“å…¥åˆ†æå†…å®¹ï¼Œä¿å­˜é…ç½®åï¼Œç‚¹å‡»Build Nowï¼Œç­‰å¾…ä»»åŠ¡æ„å»ºå®Œæˆã€‚åœ¨SonarQubeé‡ŒæŸ¥çœ‹ä»£ç åˆ†æç»“æœã€‚\n\n```json\nsonar.projectKey=websocketChat\nsonar.projectName=websocketChat\nsonar.projectVersion=1.0\nsonar.sources=.\nsonar.java.binaries=./target/classes\nsonar.exclusions=**/test/**,**/target/**\nsonar.java.source=1.8\nsonar.java.target=1.8\nsonar.sourceEncoding=UTF-8\n```\n\n![img](JenkinsçŸ¥è¯†æ¢³ç†/20.png)\n\n![img](JenkinsçŸ¥è¯†æ¢³ç†/21.png)\n\n#### **æµæ°´çº¿ä»»åŠ¡æ·»åŠ SonarQubeä»£ç å®¡æŸ¥**\n\nï¼ˆ1ï¼‰åœ¨é¡¹ç›®æ ¹ç›®å½•ä¸‹ï¼Œåˆ›å»ºsonar-project.propertiesï¼Œå†™å…¥ä»¥ä¸‹å†…å®¹ã€‚\n\n```json\nsonar.projectKey=Pipeline-demo\nsonar.projectName=Pipeline-demo\nsonar.projectVersion=1.0\nsonar.sources=.\nsonar.java.binaries=./target/classes\nsonar.exclusions=**/test/**,**/target/**\nsonar.java.source=1.8\nsonar.java.target=1.8\nsonar.sourceEncoding=UTF-8\n```\n\nï¼ˆ2ï¼‰åœ¨Jenkinsfileçš„stageså‰ï¼Œå¼•å…¥åœ¨Jenkinsä¸­å®‰è£…çš„SonarQube Scannerä½œä¸ºé¢„ç½®ç¯å¢ƒå˜é‡ï¼Œä¹‹ååœ¨æ‹‰å–ä»£ç æ­¥éª¤åï¼Œæ·»åŠ å®¡æŸ¥ä»£ç çš„æ­¥éª¤ã€‚\n\n```groovy\npipeline {\n    agent any\n     environment {\n         //å¼•å…¥åœ¨Jenkinsä¸­å®‰è£…çš„SonarQube Scanner\n        scannerHome = tool 'sonar-scanner-jenkins'\n            }\n    stages {\n        stage('æ‹‰å–ä»£ç ') {\n            steps {\n                checkout scmGit(branches: [[name: '*/master']], extensions: [], userRemoteConfigs: [[credentialsId: 'fbf87557-40b6-468a-91c5-2cfa1b2e33e8', url: 'http://192.168.1.121:82/test/test_war_demo.git']])\n            }\n        }\n        stage('å®¡æŸ¥ä»£ç ') {\n            steps { \n                    //å¼•å…¥åœ¨Jenkinsä¸­é…ç½®çš„SonarQubeæœåŠ¡å™¨è®¾ç½®\n                withSonarQubeEnv('SonarQube-jenkins') {\n                    sh '${scannerHome}/bin/sonar-scanner'\n                    }\n            }\n        }\n        stage('ç¼–è¯‘æ„å»º') {\n            steps {\n                sh 'mvn clean package'\n            }\n        }\n        stage('å‘å¸ƒé¡¹ç›®') {\n            steps {\n                deploy adapters: [tomcat9(credentialsId: '4d9b76aa-078c-462b-81f1-33fe1d9c971c', path: '', url: 'http://192.168.1.125:8080/')], contextPath: null, war: 'target/*.war'\n            }\n        }\n    }\n    post {\n        always {\n            emailext(\n                subject: 'æ„å»ºé€šçŸ¥ï¼š${PROJECT_NAME} - Build # ${BUILD_NUMBER} - ${BUILD_STATUS}!',\n                body: '${FILE,path=\"email.html\"}',\n                to: 'é‚®ç®±åœ°å€'\n            )\n        }\n    }\n}\n```\n\nï¼ˆ3ï¼‰ä»£ç å®Œæˆå˜æ›´åï¼Œåœ¨æµæ°´çº¿ä»»åŠ¡æ‰§è¡Œå®Œæˆï¼Œåœ¨SonarQubeé‡ŒæŸ¥çœ‹ä»£ç åˆ†æç»“æœã€‚\n\n![img](JenkinsçŸ¥è¯†æ¢³ç†/22.png)\n\n## åº”ç”¨æ¡ˆä¾‹\n\n> è¯¥åº”ç”¨æ¡ˆä¾‹å‚è€ƒæ¥æºäºbç«™upä¸»ï¼Œ''æ¶£æ²·aé‘æƒ·''ï¼ŒåŸæ–‡é“¾æ¥ä¸ºï¼š https://www.yuque.com/huanfqc/jenkins/jenkinsã€‚\n\nä½¿ç”¨Jenkins+GitLab+Docker+SonarQubeï¼Œåœ¨192.168.1.125ä¸Šéƒ¨ç½²è‹¥ä¾çš„springbootå‰åç«¯åˆ†ç¦»é¡¹ç›®ã€‚\n\n### ç¯å¢ƒå‡†å¤‡\n\nè®¾ç½®JenkinsæœåŠ¡å™¨å…å¯†ç™»å½•192.168.1.125\n\n```shell\nssh-copy-id -i /root/.ssh/id_rsa.pub root@192.168.1.125\n```\n\n#### å®‰è£…docker\n\n```shell\nbash <(curl -sSL https://linuxmirrors.cn/docker.sh)\n#ä¿®æ”¹é•œåƒæºå’Œé»˜è®¤é…ç½®æ–‡ä»¶è·¯å¾„\nvi /etc/docker/daemon.json\n{\n  \"data-root\": \"/data/dockerData\",\n  \"registry-mirrors\": [\n        \"https://docker.1ms.run\",\n        \"https://docker.xuanyuan.me\"\n    ]\n}\n#å¯åŠ¨docker\nsystemctl start docker\nsystemctl enable docker\n```\n\n#### è·å–å¹¶ä¿®æ”¹æºç é…ç½®\n\nï¼ˆ1ï¼‰æ‹‰å–è‹¥ä¾é¡¹ç›®æºç åˆ°æœ¬åœ°ï¼Œå¹¶å°†ruoyi-uiç›®å½•ä¸RuoYi-Vueé¡¹ç›®æ”¾ç½®åœ¨åŒä¸€çº§\n\n```shell\ngit clone https://gitee.com/y_project/RuoYi-Vue.git\n```\n\n![img](JenkinsçŸ¥è¯†æ¢³ç†/23.png)\n\nï¼ˆ2ï¼‰ä¿®æ”¹`ruoyi-ui`ç›®å½•ä¸­çš„`vue.config.js`æ–‡ä»¶ï¼Œå°†`localhost`ä¿®æ”¹ä¸ºéƒ¨ç½²ä¸»æœºçš„ipï¼Œå³192.168.1.125ã€‚\n\n```json\n#ä¿®æ”¹å‰\nconst baseUrl = 'http://localhost:8080' // åç«¯æ¥å£\n#ä¿®æ”¹å\nconst baseUrl = 'http://192.168.1.125:8080' // åç«¯æ¥å£\n```\n\nï¼ˆ3ï¼‰ä¿®æ”¹`RuoYi-Vue\\ruoyi-admin\\src\\main\\resources\\application.yml`æ–‡ä»¶ï¼Œå°†redisé…ç½®çš„ipæ”¹ä¸º192.168.1.125ã€‚\n\n```\n  # redis é…ç½®\n  redis:\n    # åœ°å€\n    host: 192.168.1.125\n```\n\nï¼ˆ4ï¼‰ä¿®æ”¹`RuoYi-Vue\\ruoyi-admin\\src\\main\\resources\\application-druid.yml`æ–‡ä»¶ï¼Œå°†mysqlçš„é“¾æ¥åœ°å€æ”¹ä¸º192.168.1.125ã€‚\n\n```\n # ä¸»åº“æ•°æ®æº\n            master:\n                url: jdbc:mysql://192.168.1.125:3306/ry-vue?useUnicode=true&characterEncoding=utf8&zeroDateTimeBehavior=convertToNull&useSSL=true&serverTimezone=GMT%2B8\n              \n```\n\nï¼ˆ5ï¼‰åœ¨ruoyi-uiç›®å½•ä¸‹ï¼Œåˆ›å»ºsonar-project.propertiesï¼Œå†™å…¥ä»¥ä¸‹å†…å®¹ï¼Œæ·»åŠ SonarQubeä»£ç å®¡æŸ¥\n\n```groovy\nsonar.projectKey=ruoyi-ui\nsonar.projectName=ruoyi-ui\nsonar.projectVersion=1.0\nsonar.sources=.\nsonar.sourceEncoding=UTF-8\n```\n\nï¼ˆ6ï¼‰åœ¨ruoyi-uiç›®å½•ä¸‹åˆ›å»ºå‰ç«¯é¡¹ç›®çš„Jenkinsfileæ–‡ä»¶\n\n```groovy\npipeline {\n    agent any\n     environment {\n         //å¼•å…¥åœ¨Jenkinsä¸­å®‰è£…çš„SonarQube Scanner\n        scannerHome = tool 'sonar-scanner-jenkins'\n            }\n    stages {\n        stage('æ‹‰å–ä»£ç ') {\n            steps {\n                checkout scmGit(branches: [[name: '*/master']], extensions: [], userRemoteConfigs: [[credentialsId: 'fbf87557-40b6-468a-91c5-2cfa1b2e33e8', url: 'http://192.168.1.121:82/test/ruoyi-ui.git']])\n            }\n        }\n        stage('å®¡æŸ¥ä»£ç ') {\n            steps { \n                    //å¼•å…¥åœ¨Jenkinsä¸­é…ç½®çš„SonarQubeæœåŠ¡å™¨è®¾ç½®\n                withSonarQubeEnv('SonarQube-jenkins') {\n                    sh '${scannerHome}/bin/sonar-scanner'\n                    }\n            }\n        }\n               stage('æ‰“åŒ…ï¼Œéƒ¨ç½²ç½‘ç«™') {\n\t\t  steps {\n\t\t    script {\n\t\t\t    nodejs(nodeJSInstallationName: 'nodejs14') {\n                              sh '''\n                npm install\n                # æ„å»ºç”Ÿäº§ç¯å¢ƒ\n                npm run build:prod\n            '''\n               }\n\t\t\t    // å°†æ„å»ºäº§ç‰©éƒ¨ç½²åˆ° Nginx å®¹å™¨æŒ‚è½½çš„ç›®å½•\n          sh '''\n            \n            # å°†æ•´ä¸ª dist ç›®å½•å¤åˆ¶åˆ°æŒ‚è½½ç›®å½•\n            scp -r dist 192.168.1.125:/data/ruoyi/nginx/html/\n            ssh 192.168.1.125 docker restart nginx\n        '''\n\t\t\t   \n\t\t\t}\n\t\t  }\n       \n        }\n\n    }\n}\n\n```\n\n7ï¼‰åœ¨RuoYi-Vueç›®å½•ä¸‹ï¼Œåˆ›å»ºsonar-project.propertiesï¼Œå†™å…¥ä»¥ä¸‹å†…å®¹ï¼Œæ·»åŠ SonarQubeä»£ç å®¡æŸ¥\n\n```groovy\nsonar.projectKey=ruoyi-api\nsonar.projectName=ruoyi-api\nsonar.projectVersion=1.0\nsonar.sources=.\nsonar.java.binaries=./ruoyi-admin/target/classes\nsonar.exclusions=**/test/**,**/target/**\nsonar.java.source=1.8\nsonar.java.target=1.8\nsonar.sourceEncoding=UTF-8\n```\n\nï¼ˆ8ï¼‰åœ¨RuoYi-Vueç›®å½•ä¸‹åˆ›å»ºåç«¯é¡¹ç›®çš„Jenkinsfileæ–‡ä»¶\n\n```groovy\npipeline {\n    agent any\n    environment {\n         //å¼•å…¥åœ¨Jenkinsä¸­å®‰è£…çš„SonarQube Scanner\n        scannerHome = tool 'sonar-scanner-jenkins'\n            }\n    stages {\n        stage('æ‹‰å–ä»£ç ') {\n            steps {\n                checkout scmGit(branches: [[name: '*/master']], extensions: [], userRemoteConfigs: [[credentialsId: 'fbf87557-40b6-468a-91c5-2cfa1b2e33e8', url: 'http://192.168.1.121:82/test/ruoyi-api.git']])\n            }\n        }\n        stage('ç¼–è¯‘æ„å»º') {\n            steps {\n                sh 'mvn clean package'\n            }\n        }\n        stage('å®¡æŸ¥ä»£ç ') {\n            steps { \n                    //å¼•å…¥åœ¨Jenkinsä¸­é…ç½®çš„SonarQubeæœåŠ¡å™¨è®¾ç½®\n                withSonarQubeEnv('SonarQube-jenkins') {\n                    sh '${scannerHome}/bin/sonar-scanner'\n                    }\n            }\n        }\n        stage('å‘å¸ƒé¡¹ç›®') {\n            steps {\n                script {\n                    sh '''\n                       ssh 192.168.1.125  \"mkdir -p /data/ruoyi-api\"\n                        scp ruoyi-admin/target/*.jar  192.168.1.125:/data/ruoyi-api/ruoyi.jar\n                    '''\n                    // åˆ›å»ºDockerfile\n                    sh '''\n                             ssh 192.168.1.125 'cat > /data/ruoyi-api/Dockerfile <<-EOF\n\tFROM openjdk:8\n\tMAINTAINER xie\n\tVOLUME /tmp\n\tADD ruoyi.jar ruoyi.jar\n\tENTRYPOINT [\"java\",\"-jar\",\"/ruoyi.jar\"]\n\tEXPOSE 8080\n\tEOF'\n                    '''\n\n                    // æ„å»ºé•œåƒ\n                    sh '''\n                        ssh 192.168.1.125 \"docker build -t ruoyi:1.0 /data/ruoyi-api\"\n                    '''\n\n                    // åœæ­¢å¹¶åˆ é™¤ç°æœ‰çš„å®¹å™¨\n                    sh '''\n                        EXISTING_CONTAINER=$(ssh 192.168.1.125 \"docker ps -a -q -f name=ruoyi\")\n                        if [ -n \"$EXISTING_CONTAINER\" ]; then\n                            echo \"å®¹å™¨ 'ruoyi' å·²å­˜åœ¨ï¼Œåœæ­¢å¹¶åˆ é™¤æ—§å®¹å™¨...\"\n                           ssh 192.168.1.125 \"docker rm -f $EXISTING_CONTAINER\"\n                        fi\n                    '''\n\n                    // è¿è¡Œæ–°çš„å®¹å™¨\n                    sh '''\n                       ssh 192.168.1.125 \"docker run -d --name ruoyi -p 8080:8080 ruoyi:1.0\"\n                    '''\n                }\n            }\n        }\n    }\n}\n```\n\n#### éƒ¨ç½²é¡¹ç›®æ‰€éœ€å®¹å™¨\n\nè¯¥é¡¹ç›®ä¸­è¦ç”¨åˆ°nginxã€mysqlå’Œredisï¼Œéœ€æå‰éƒ¨ç½²å¥½å®¹å™¨ã€‚å¯¹åº”å®¹å™¨ç‰ˆæœ¬ä¸ºnginx:1.18.0ã€mysql:8.0.19ã€redis:6.0.8 \n\nï¼ˆ1ï¼‰åˆ›å»ºæ‰€éœ€ç›®å½•\n\n```shell\nmkdir -p /data/ruoyi\nmkdir -p /data/ruoyi/nginx/conf\nmkdir -p /data/ruoyi/mysql/db\n```\n\nï¼ˆ2ï¼‰åˆ›å»ºnginxä¸´æ—¶å®¹å™¨ï¼Œä¿®æ”¹é…ç½®æ–‡ä»¶\n\n```shell\ndocker run --rm -v /data/ruoyi/nginx/conf:/backup nginx:1.18.0 \\\n  sh -c \"cp -r /etc/nginx/. /backup\"\n```\n\nä¿®æ”¹`/data/ruoyi/nginx/conf/conf.d`ä¸­çš„default.confæ–‡ä»¶\n\n```yaml\nserver {\n    listen 80;\n\n    proxy_set_header Host $http_host;\n    proxy_set_header X-Real-IP $remote_addr;\n    proxy_set_header X-Forwarded-For $proxy_add_x_forwarded_for;\n    proxy_set_header REMOTE-HOST $remote_addr;\n\n    server_name localhost;\n\n    location / {\n        root /usr/share/nginx/html/dist;\n        index index.html index.htm;\n        try_files $uri /index.html;\n    }\n\n    location /prod-api/ {\n        proxy_set_header Host $http_host;\n        proxy_set_header X-Real-IP $remote_addr;\n        proxy_set_header REMOTE-HOST $remote_addr;\n        proxy_set_header X-Forwarded-For $proxy_add_x_forwarded_for;\n        proxy_pass http://192.168.1.125:8080/;   #æ³¨æ„ä¿®æ”¹ip\n    }\n\n    if ($request_uri ~ \"/actuator\") {\n        return 403;\n    }\n}\n\n```\n\nï¼ˆ3ï¼‰å°†`RuoYi-Vue\\sql`ä¸­çš„sqlæ–‡ä»¶ï¼Œæ‹·è´åˆ°192.168.1.125ä¸»æœºçš„`/data/ruoyi/mysql/db`ç›®å½•\n\nï¼ˆ4ï¼‰æ’°å†™ymlï¼Œä½¿ç”¨docker composeç¼–æ’éƒ¨ç½²å®¹å™¨\n\n```yaml\n#æ’°å†™ymlæ–‡ä»¶\nvi ruoyi.yml\n\n\nservices:\n  nginx:\n    image: nginx:1.18.0\n    container_name: nginx\n    restart: always\n    volumes:\n      - /data/ruoyi/nginx/conf:/etc/nginx\n      - /data/ruoyi/nginx/logs:/var/log/nginx\n      - /data/ruoyi/nginx/html:/usr/share/nginx/html\n    environment:\n      TZ: \"Asia/Shanghai\"\n    ports:\n      - \"80:80\"\n    networks:\n      ruoyi:\n        ipv4_address: 172.20.112.11\n  mysql:\n    container_name: mysql\n    image: mysql:8.0.19\n    restart: always\n    environment:\n      MYSQL_ROOT_PASSWORD: \"password\"\n      MYSQL_ALLOW_EMPTY_PASSWORD: \"no\"\n      MYSQL_DATABASE: \"ry-vue\"\n      TZ: \"Asia/Shanghai\"\n    ports:\n      - \"3306:3306\"\n    volumes:\n      - /data/ruoyi/mysql/db:/var/lib/mysql\n      - /data/ruoyi/mysql/conf:/etc/my.cnf\n      - /data/ruoyi/mysql/init:/docker-entrypoint-initdb.d\n    command: --default-authentication-plugin=mysql_native_password\n    networks:\n      ruoyi:\n        ipv4_address: 172.20.112.12\n  redis:\n    container_name: redis\n    image: redis:6.0.8\n    restart: always\n    environment:\n      TZ: \"Asia/Shanghai\"\n    ports:\n      - \"6379:6379\"\n    volumes:\n      - /data/ruoyi/redis/conf:/etc/redis/redis.conf\n      - /data/ruoyi/redis/data:/data\n    command: redis-server /etc/redis/redis.conf\n    networks:\n      ruoyi:\n        ipv4_address: 172.20.112.13\n\n\nnetworks:\n ruoyi:\n  driver: bridge\n  ipam:\n   config:\n    - subnet: 172.20.112.0/24\n```\n\nï¼ˆ5ï¼‰æ‰§è¡Œå‘½ä»¤åˆ›å»ºå®¹å™¨\n\n```shell\ndocker compose -f ruoyi.yml up -d\n#æŸ¥çœ‹å®¹å™¨è¿è¡ŒçŠ¶æ€\ndocker ps\n#å¯¼å…¥æ•°æ®åº“\ndocker exec -it mysql bash\nmysql -u root -ppassword ry-vue < /var/lib/mysql/ry_20250417.sql\nmysql -u root -ppassword ry-vue < /var/lib/mysql/quartz.sql\n```\n\n#### ä¸Šä¼ ä»£ç åˆ°GitLab\n\nï¼ˆ1ï¼‰åˆ›å»ºruoyi-uiå’Œruoyi-apiä¸¤ä¸ªä»“åº“åˆ†åˆ«å­˜æ”¾å‰ç«¯å’Œåç«¯ä»£ç \n\nï¼ˆ2ï¼‰åœ¨ruoyi-uiç›®å½•ä¸‹ï¼Œæ‰“å¼€cmdï¼Œè¾“å…¥å‘½ä»¤ä¸Šä¼ ä»£ç \n\n```shell\ngit init\ngit remote add origin http://192.168.1.121:82/test/ruoyi-ui.git\n#æ·»åŠ è¯¥ç›®å½•ä¸‹çš„gitæƒé™é…ç½®\ngit config  user.name \"test1\"\ngit config  user.email \"test1@gitlab\"\n#ç»§ç»­ä¸Šä¼ \ngit add .\ngit commit -m \"ruoyi-ui\"\ngit push -u origin master\n```\n\nï¼ˆ3ï¼‰åœ¨`RuoYi-Vue`ç›®å½•ä¸‹ï¼Œæ‰“å¼€cmdï¼Œè¾“å…¥å‘½ä»¤ä¸Šä¼ ä»£ç \n\n```shell\ngit init\ngit remote add origin http://192.168.1.121:82/test/ruoyi-api.git\n#æ·»åŠ è¯¥ç›®å½•ä¸‹çš„gitæƒé™é…ç½®\ngit config  user.name \"test1\"\ngit config  user.email \"test1@gitlab\"\n#ç»§ç»­ä¸Šä¼ \ngit add .\ngit commit -m \"ruoyi-api\"\ngit push -u origin master\n```\n\n#### é…ç½®Jenkinsæµæ°´çº¿\n\nï¼ˆ1ï¼‰å®‰è£…nodejså’ŒNodeJSæ’ä»¶\n\nåœ¨jenkinsæœåŠ¡å™¨ä¸Šå®‰è£…nodejs\n\n```shell\nwget https://nodejs.org/dist/latest-fermium/node-v14.21.3-linux-x64.tar.gz\ntar -vxzf node-v14.21.3-linux-x64.tar.gz  -C /opt\nmv /opt/node-v14.21.3-linux-x64 /opt/nodejs\n#é…ç½®ç¯å¢ƒå˜é‡\necho \"\nexport NODE_HOME=/opt/nodejs\nexport PATH=$NODE_HOME/bin:$PATH\" >> /etc/profile\n#å˜é‡ç”Ÿæ•ˆ\n source /etc/profile\n#æŸ¥çœ‹ç‰ˆç‰ˆæœ¬\nnode -v\nnpm -v\n#é…ç½®é•œåƒæº\nnpm config set registry https://registry.npmmirror.com\nnpm config set sass_binary_site=https://npm.taobao.org/mirrors/node-sass\n```\n\nï¼ˆ2ï¼‰é…ç½®NodeJSè®¾ç½®\n\nåœ¨`Manage Jenkins` -`Tools`-NodeJS å®‰è£…ä¸­ï¼Œç‚¹å‡»`æ–°å¢NodeJS`ï¼Œå¡«å†™nodejsçš„åç§°ä¸º`nodejs14`,è¾“å…¥åœ¨æœåŠ¡å™¨å®‰è£…çš„nodejsè·¯å¾„`/opt/nodejs`ï¼Œä¿å­˜åº”ç”¨ã€‚\n\nï¼ˆ3ï¼‰åˆ›å»º`ruoyi-ui`æµæ°´çº¿ä»»åŠ¡ï¼Œåœ¨æµæ°´çº¿-å®šä¹‰ä¸­é€‰æ‹©`Pipeline script from SCM`ï¼ŒSCMé€‰æ‹©`Git`ï¼Œå¡«å†™ruoyi-uiçš„gitä»“åº“åœ°å€å’Œç™»å½•å‡­è¯ï¼Œå…¶ä»–é€‰é¡¹ä¿æŒé»˜è®¤ï¼Œä¿å­˜åº”ç”¨ã€‚\n\nï¼ˆ4ï¼‰ç‚¹å‡»`Build Now`ï¼Œç­‰å¾…ä»»åŠ¡æ‰§è¡Œå®Œæˆã€‚åœ¨æµè§ˆå™¨ä¸­è®¿é—®`http://192.168.1.125/`ï¼ŒæŸ¥çœ‹å‰ç«¯éƒ¨ç½²æƒ…å†µã€‚\n\n![img](JenkinsçŸ¥è¯†æ¢³ç†/24.png)\n\nï¼ˆ5ï¼‰åˆ›å»º`ruoyi-api`æµæ°´çº¿ä»»åŠ¡ï¼Œåœ¨æµæ°´çº¿-å®šä¹‰ä¸­é€‰æ‹©`Pipeline script from SCM`ï¼ŒSCMé€‰æ‹©`Git`ï¼Œå¡«å†™ruoyi-apiçš„gitä»“åº“åœ°å€å’Œç™»å½•å‡­è¯ï¼Œå…¶ä»–é€‰é¡¹ä¿æŒé»˜è®¤ï¼Œä¿å­˜åº”ç”¨ã€‚\n\nï¼ˆ6ï¼‰ç‚¹å‡»`Build Now`ï¼Œç­‰å¾…ä»»åŠ¡æ‰§è¡Œå®Œæˆã€‚åœ¨æµè§ˆå™¨ä¸­è®¿é—®`http://192.168.1.125/`ï¼Œå¯æ­£å¸¸ç™»å½•ï¼Œå³ä¸ºæˆåŠŸã€‚\n\n![img](JenkinsçŸ¥è¯†æ¢³ç†/25.png)\n\nï¼ˆ7ï¼‰è®¿é—®sonarQubeï¼Œåˆ†åˆ«æŸ¥çœ‹å‰åç«¯ä»£ç çš„å…·ä½“è´¨é‡å®¡æŸ¥æƒ…å†µã€‚\n\n![img](JenkinsçŸ¥è¯†æ¢³ç†/26.png)\n\n\n\n\n\n> æœ¬ç¯‡çŸ¥è¯†æ¥æºäºBç«™è§†é¢‘BV1pF411Y7tq\n","tags":["çŸ¥è¯†æ¢³ç†","CI/CD","è‡ªåŠ¨åŒ–è¿ç»´","GitLab","Jenkins","Linuxè¿ç»´","SonarQube"],"categories":["è‡ªåŠ¨åŒ–è¿ç»´","æ¢³ç†æ€»ç»“","Jenkins","çŸ¥è¯†æ¢³ç†","GitLab","SonarQube"]},{"title":"Ansibleæœ€æ–°ç‰ˆå®‰è£…","url":"/yyg/10ac2e4/","content":"## pipæ–¹å¼å®‰è£…\n\n### åŸºç¡€ç¯å¢ƒå‡†å¤‡\n\nï¼ˆ1ï¼‰å®‰è£…è½¯ä»¶ä¾èµ–\n\n```shell\nyum install -y zlib zlib-dev zlib-devel  sqlite-devel openssl-devel  bzip2-devel libffi libffi-devel gcc gcc-c++ perl perl-core perl-CPAN perl-IPC-Cmd make tk-devel readline-devel libpcap-devel gdbm-devel  xz-devel\n```\n\nï¼ˆ2ï¼‰ä¸‹è½½å¹¶å®‰è£…æ–°ç‰ˆopenssl\n\n```shell\nwget https://github.com/openssl/openssl/releases/download/openssl-3.5.0/openssl-3.5.0.tar.gz \ntar -zxvf openssl-3.5.0.tar.gz\ncd openssl-3.5.0\n#ç¼–è¯‘å®‰è£…\n./config --prefix=/usr/local/openssl-3.5.0 --libdir=lib --openssldir=/etc/ssl\nmake -j1 depend && make -j8 && make install_sw\n```\n\nï¼ˆ3ï¼‰ä¸‹è½½python3å®‰è£…åŒ…\n\n```shell\ncurl -O https://mirrors.huaweicloud.com/python/3.13.3/Python-3.13.3.tgz\ntar -zxvf Python-3.13.3.tgz\ncd Python-3.13.3\n./configure --with-openssl=/usr/local/openssl-3.5.0 --with-openssl-rpath=auto --prefix=/usr/local/python3.13\nmake -j8 && make altinstall\n#è®¾ç½®è½¯é“¾æ¥\nln -s /usr/local/python3.13/bin/python3.13 /usr/bin/python3\nln -s /usr/local/python3.13/bin/pip3.13 /usr/bin/pip3\n\n##éªŒè¯ç‰ˆæœ¬\npython3 --version\npip3 --version\n```\n\n### å®‰è£…Ansible\n\n```shell\npython3 -m pip install ansible\necho 'export PATH=\"$HOME/.local/bin:$PATH\"' >> ~/.bashrc\nsource ~/.bashrc\n#æŸ¥çœ‹ç‰ˆæœ¬\nansible --version\n```\n\nåˆ›å»ºå…¨å±€é…ç½®æ–‡ä»¶`ansible.cfg`\n\n```\nmkdir -p /etc/ansible\nvi /etc/ansible/ansible.cfg\n[defaults]\n#ä¸»æœºæ¸…å•å­˜åœ¨æ–‡ä»¶\ninventory=/etc/ansible/hosts\n#ä½¿ç”¨çš„ Pythonè§£é‡Šå™¨è·¯å¾„\ninterpreter_python = /usr/bin/python3\n#æŸ¥çœ‹é…ç½®æ–‡ä»¶ç”Ÿæ•ˆ\nansible --version\n```\n\n> [root@124 ~]# ansible --version\n> ansible [core 2.18.4]\n>   config file = **/etc/ansible/ansible.cfg**\n>   configured module search path = ['/root/.ansible/plugins/modules', '/usr/share/ansible/plugins/modules']\n>   ansible python module location = /root/.local/lib/python3.13/site-packages/ansible\n>   ansible collection location = /root/.ansible/collections:/usr/share/ansible/collections\n>   executable location = /root/.local/bin/ansible\n>   python version = 3.13.3 (main, Apr 12 2025, 22:15:40) [GCC 4.8.5 20150623 (Red Hat 4.8.5-44)] (/usr/bin/python3)\n>   jinja version = 3.1.6\n>   libyaml = True\n\n## å®¹å™¨æ–¹å¼å®‰è£…\n\n### ä½¿ç”¨å®˜æ–¹ç¤¾åŒºå®¹å™¨\n\n `community-ee-minimal` é•œåƒï¼šåªåŒ…å« `ansible-core`\n\n`community-ee-base` é•œåƒï¼šåŒ…å«`nsible-core`ã€`ansible.posix`ã€`ansible.utils`ã€`ansible.windows`çš„å¤šä¸ªåŸºç¡€é›†åˆ\n\næœ¬æ–‡ä¸­ä½¿ç”¨`community-ee-base` é•œåƒè¿›è¡Œå®‰è£…ã€‚\n\n> å®¹å™¨æ–¹å¼å®‰è£…é€‚ç”¨äºè¢«æ§ä¸»æœºpythonç‰ˆæœ¬ä¸º3.13åŠä»¥ä¸Šçš„æƒ…å†µ\n\nï¼ˆ1ï¼‰åŸºæœ¬ç¯å¢ƒå‡†å¤‡\n\n```shell\nmkdir  -p /data/code\nmkdir  -p /data/ansible\n#åˆ›å»ºå…¨å±€é…ç½®æ–‡ä»¶\nvi /data/ansible/ansible.cfg\n[defaults]\n#ä¸»æœºæ¸…å•å­˜åœ¨æ–‡ä»¶\ninventory=/etc/ansible/hosts\ninterpreter_python = /usr/bin/python3\n\n#åˆ›å»ºé…ç½®æ–‡ä»¶\nvi /data/code/ansible.cfg\n[defaults]\n#ä¸»æœºæ¸…å•å­˜åœ¨æ–‡ä»¶\ninventory=/data/code/hosts\ninterpreter_python = /usr/bin/python3\n\n#åˆ›å»ºä¸»æœºæ¸…å•æ–‡ä»¶\nvi /data/code/hosts\n[webservers]\n192.168.1.124\n192.168.1.125\n```\n\nåœ¨å®‰è£…ansibleå®¹å™¨çš„ä¸»æœºä¸Šè®¾ç½®å…å¯†ç™»å½•ï¼Œå¹¶å°†å¯†é’¥æ–‡ä»¶ä¼ è‡³è¢«æ§ä¸»æœº\n\n```\nssh-keygen \nssh-copy-id -i ~/.ssh/id_rsa.pub root@å—æ§ä¸»æœºip\n```\n\nï¼ˆ2ï¼‰å®‰è£…`ghcr.io/ansible-community/community-ee-base`å®¹å™¨\n\n- æ–¹å¼ä¸€ï¼šç›´æ¥ä½¿ç”¨dockerå‘½ä»¤ï¼š\n\n```shell\n docker run -itd  --name ansible --user \"0\" -v /root/.ssh:/root/.ssh -v /data/ansible:/etc/ansible -v /data/code:/data/code ghcr.io/ansible-community/community-ee-base\n```\n\n- æ–¹å¼äºŒï¼šä½¿ç”¨docker composeå®‰è£…\n\n```yaml\n#åˆ›å»ºymlæ–‡ä»¶\nvi ansible.yml\n\nservices:\n  ansible:\n    image: ghcr.io/ansible-community/community-ee-base\n    container_name: ansible\n    restart: always\n    tty: true\n    stdin_open: true\n    volumes:\n      - /root/.ssh:/root/.ssh\n      - /data/ansible:/etc/ansible\n      - /data/code:/data/code\n    user: \"0\"\n    networks:\n      ansible-net:\n        ipv4_address: 172.20.17.11\n\nnetworks:\n ansible-net:\n  driver: bridge\n  ipam:\n   config:\n    - subnet: 172.20.17.0/24\n    \n#å®‰è£…\ndocker compose -f ansible.yml up -d\n```\n\nï¼ˆ3ï¼‰å®‰è£…æˆåŠŸåï¼Œè¿›å…¥å®¹å™¨æŸ¥çœ‹\n\n```\ndocker exec -it ansible bash\n```\n\næŸ¥çœ‹ç‰ˆæœ¬\n\n```\nansible --version\n```\n\n> [root@123 runner]# ansible --version\n> ansible [core 2.18.3]\n>   config file = /etc/ansible/ansible.cfg\n>   configured module search path = ['/root/.ansible/plugins/modules', '/usr/share/ansible/plugins/modules']\n>   ansible python module location = /usr/local/lib/python3.13/site-packages/ansible\n>   ansible collection location = /root/.ansible/collections:/usr/share/ansible/collections\n>   executable location = /usr/local/bin/ansible\n>   python version = 3.13.2 (main, Feb  4 2025, 00:00:00) [GCC 14.2.1 20250110 (Red Hat 14.2.1-7)] (/usr/bin/python3)\n>   jinja version = 3.1.5\n>   libyaml = True\n\næ‰§è¡Œansibleå‘½ä»¤æµ‹è¯•\n\n```\nansible all -m ping\n```\n\n> [root@123 code]# ansible all -m ping\n> 192.168.1.125 | SUCCESS => {\n>     \"changed\": false,\n>     \"ping\": \"pong\"\n> }\n> 192.168.1.124 | SUCCESS => {\n>     \"changed\": false,\n>     \"ping\": \"pong\"\n> }\n\n### æ„å»ºè‡ªç”¨Ansibleé•œåƒ\n\nï¼ˆ1ï¼‰æ’°å†™DockerFileæ–‡ä»¶\n\n```\nvi DockerFile\n\nFROM centos:7\nRUN curl -o /etc/yum.repos.d/CentOS-Base.repo http://mirrors.aliyun.com/repo/Centos-7.repo && yum install epel-release -y && yum install ansible -y\n\n#åˆ›å»ºansibleé•œåƒ\ndocker build -f DockerFile -t ansible:1.0 --load .\n```\n\nï¼ˆ2ï¼‰åŸºæœ¬ç¯å¢ƒå‡†å¤‡\n\n```shell\nmkdir  -p /data/code\nmkdir  -p /data/ansible\n#åˆ›å»ºå…¨å±€é…ç½®æ–‡ä»¶\nvi /data/ansible/ansible.cfg\n[defaults]\n#ä¸»æœºæ¸…å•å­˜åœ¨æ–‡ä»¶\ninventory=/etc/ansible/hosts\ninterpreter_python = /usr/bin/python\n\n#åˆ›å»ºé…ç½®æ–‡ä»¶\nvi /data/code/ansible.cfg\n[defaults]\n#ä¸»æœºæ¸…å•å­˜åœ¨æ–‡ä»¶\ninventory=/data/code/hosts\ninterpreter_python = /usr/bin/python\n\n#åˆ›å»ºä¸»æœºæ¸…å•æ–‡ä»¶\nvi /data/code/hosts\n[webservers]\n192.168.1.122\n192.168.1.123\n192.168.1.124\n```\n\nï¼ˆ3ï¼‰åœ¨å®‰è£…ansibleå®¹å™¨çš„ä¸»æœºä¸Šè®¾ç½®å…å¯†ç™»å½•ï¼Œå¹¶å°†å¯†é’¥æ–‡ä»¶ä¼ è‡³è¢«æ§ä¸»æœº\n\n```\nssh-keygen \nssh-copy-id -i ~/.ssh/id_rsa.pub root@å—æ§ä¸»æœºip\n```\n\nï¼ˆ4ï¼‰å®‰è£…å®¹å™¨\n\n- æ–¹å¼ä¸€ï¼šç›´æ¥ä½¿ç”¨dockerå‘½ä»¤ï¼š\n\n```shell\n docker run -itd  --name ansible -v /root/.ssh:/root/.ssh -v /data/ansible:/etc/ansible -v /data/code:/data/code ansible:1.0\n```\n\n- æ–¹å¼äºŒï¼šä½¿ç”¨docker composeå®‰è£…\n\n```yaml\n#åˆ›å»ºymlæ–‡ä»¶\nvi ansible.yml\n\nservices:\n  ansible:\n    image: ansible:1.0\n    container_name: ansible\n    restart: always\n    tty: true\n    stdin_open: true\n    volumes:\n      - /root/.ssh:/root/.ssh\n      - /data/ansible:/etc/ansible\n      - /data/code:/data/code\n    user: \"0\"\n    networks:\n      ansible-net:\n        ipv4_address: 172.20.17.11\n\nnetworks:\n ansible-net:\n  driver: bridge\n  ipam:\n   config:\n    - subnet: 172.20.17.0/24\n    \n    \n#å®‰è£…\ndocker compose -f ansible.yml up -d\n```\n\nï¼ˆ5ï¼‰å®‰è£…æˆåŠŸåï¼Œè¿›å…¥å®¹å™¨æŸ¥çœ‹\n\n```\ndocker exec -it ansible bash\n```\n\næŸ¥çœ‹ç‰ˆæœ¬\n\n```shell\nansible --version\n```\n\n> [root@c7668aa8c849 ~]# ansible --version\n> ansible 2.9.27\n>   config file = /etc/ansible/ansible.cfg\n>   configured module search path = [u'/root/.ansible/plugins/modules', u'/usr/share/ansible/plugins/modules']\n>   ansible python module location = /usr/lib/python2.7/site-packages/ansible\n>   executable location = /usr/bin/ansible\n>   python version = 2.7.5 (default, Oct 14 2020, 14:45:30) [GCC 4.8.5 20150623 (Red Hat 4.8.5-44)]\n\næ‰§è¡Œansibleå‘½ä»¤æµ‹è¯•\n\n```\nansible all -m ping\n```\n\n> [root@c7668aa8c849 code]# ansible all -m ping\n> 192.168.1.122 | SUCCESS => {\n>     \"changed\": false,\n>     \"ping\": \"pong\"\n> }\n> 192.168.1.124 | SUCCESS => {\n>     \"changed\": false,\n>     \"ping\": \"pong\"\n> }\n> 192.168.1.123 | SUCCESS => {\n>     \"changed\": false,\n>     \"ping\": \"pong\"\n> }","tags":["CI/CD","è‡ªåŠ¨åŒ–è¿ç»´","Ansible","Linuxè¿ç»´"],"categories":["è‡ªåŠ¨åŒ–è¿ç»´","Ansible"]},{"title":"AnsibleçŸ¥è¯†æ¢³ç†","url":"/yyg/e80721f/","content":"{% folding cyan,ğŸ”œä»€ä¹ˆæ˜¯Ansibleï¼ŸğŸ”š %}\n\nAnsible æ˜¯ä¸€æ¬¾ IT è‡ªåŠ¨åŒ–å·¥å…·ã€‚ä¸»è¦åº”ç”¨åœºæ™¯æœ‰é…ç½®ç³»ç»Ÿã€è½¯ä»¶éƒ¨ç½²ã€æŒç»­å‘å¸ƒåŠä¸åœæœå¹³æ»‘æ»šåŠ¨æ›´æ–°çš„é«˜çº§ä»»åŠ¡ç¼–æ’ã€‚\n\nAnsible æä¾›å¼€æºè‡ªåŠ¨åŒ–ï¼Œå¯é™ä½å¤æ‚æ€§å¹¶åœ¨ä»»ä½•åœ°æ–¹è¿è¡Œã€‚ä½¿ç”¨ Ansible å¯ä»¥è‡ªåŠ¨æ‰§è¡Œå‡ ä¹ä»»ä½•ä»»åŠ¡ã€‚\n\n{% endfolding %}\n\n## æ¶æ„\n\n> `Ansible`ï¼šAnsibleæ ¸å¿ƒç¨‹åºã€‚\n> `HostInventory`ï¼šè®°å½•ç”±Ansibleç®¡ç†çš„ä¸»æœºä¿¡æ¯ï¼ŒåŒ…æ‹¬ç«¯å£ã€å¯†ç ã€ipç­‰ã€‚\n> `Playbooks`ï¼šâ€œå‰§æœ¬â€YAMLæ ¼å¼æ–‡ä»¶ï¼Œå¤šä¸ªä»»åŠ¡å®šä¹‰åœ¨ä¸€ä¸ªæ–‡ä»¶ä¸­ï¼Œå®šä¹‰ä¸»æœºéœ€è¦è°ƒç”¨å“ªäº›æ¨¡å—æ¥å®Œæˆçš„åŠŸèƒ½ã€‚\n> `CoreModules`ï¼š**æ ¸å¿ƒæ¨¡å—**ï¼Œä¸»è¦æ“ä½œæ˜¯é€šè¿‡è°ƒç”¨æ ¸å¿ƒæ¨¡å—æ¥å®Œæˆç®¡ç†ä»»åŠ¡ã€‚\n> `CustomModules`ï¼šè‡ªå®šä¹‰æ¨¡å—ï¼Œå®Œæˆæ ¸å¿ƒæ¨¡å—æ— æ³•å®Œæˆçš„åŠŸèƒ½ï¼Œæ”¯æŒå¤šç§è¯­è¨€ã€‚\n> `ConnectionPlugins`ï¼šè¿æ¥æ’ä»¶ï¼ŒAnsibleå’ŒHosté€šä¿¡ä½¿ç”¨\n\n![image-20250331194718453](AnsibleçŸ¥è¯†æ¢³ç†/1.png)\n\n## Ansibleé‡è¦æ¦‚å¿µ\n\n### æ§åˆ¶èŠ‚ç‚¹\n\næ§åˆ¶èŠ‚ç‚¹æ˜¯è¿è¡Œ Ansible  Ansible CLI å·¥å…· çš„æœºå™¨ã€‚å®ƒè´Ÿè´£ä¸å—æ§èŠ‚ç‚¹ï¼ˆè¢«ç®¡ç†èŠ‚ç‚¹ï¼‰è¿›è¡Œé€šä¿¡ï¼Œå‘å‡ºå‘½ä»¤å¹¶æ‰§è¡Œä»»åŠ¡ã€‚\n\n### å—æ§èŠ‚ç‚¹ï¼ˆè¢«ç®¡ç†èŠ‚ç‚¹ï¼‰\n\nä¹Ÿç§°ä¸ºâ€œä¸»æœºâ€ï¼Œè¿™äº›æ˜¯ç”¨ Ansible ç®¡ç†çš„ç›®æ ‡è®¾å¤‡ã€‚Ansibleæ§åˆ¶èŠ‚ç‚¹ä¼šåœ¨è¿™äº›æœºå™¨ä¸Šæ‰§è¡Œä»»åŠ¡ã€‚å—æ§èŠ‚ç‚¹ä¸éœ€è¦å®‰è£…ä»»ä½•ä»£ç†ã€‚\n\n### åº“å­˜ (Inventory)\n\nåŒ…å«è¦ç®¡ç†çš„ç›®æ ‡ä¸»æœºæˆ–èŠ‚ç‚¹çš„æ¸…å•ã€‚å®ƒæ˜¯ Ansible ç”¨æ¥å®šä¹‰ç›®æ ‡ä¸»æœºä¿¡æ¯çš„é…ç½®æ–‡ä»¶ï¼Œæ”¯æŒé™æ€æˆ–åŠ¨æ€çš„ä¸»æœºæ¸…å•ã€‚å®ƒè¿˜ç”¨äºåˆ†é…ç»„ï¼Œè¿™æ—¢å…è®¸åœ¨å‰§é›†ä¸­é€‰æ‹©èŠ‚ç‚¹ï¼Œä¹Ÿå…è®¸æ‰¹é‡åˆ†é…å˜é‡ã€‚\n\n### å‰§æœ¬ï¼ˆPlaybookï¼‰\n\nPlaybook æ˜¯ Ansible é…ç½®ç®¡ç†çš„æ ¸å¿ƒéƒ¨åˆ†ï¼Œæ˜¯ä¸€ç»„ç”¨äºè‡ªåŠ¨åŒ–æ‰§è¡Œä»»åŠ¡çš„ YAML æ–‡ä»¶ã€‚Playbook å¯ä»¥æ‰§è¡Œå¤šä¸ªæ­¥éª¤ï¼ˆä¾‹å¦‚å®‰è£…è½¯ä»¶ã€å¯åŠ¨æœåŠ¡ç­‰ï¼‰ï¼Œå¹¶å®šä¹‰æ‰§è¡Œé¡ºåºã€ä»»åŠ¡ç­‰ã€‚\n\n### æ¨¡å— (Modules)\n\næ¨¡å—æ˜¯ Ansible ä¸­æ‰§è¡Œå®é™…ä»»åŠ¡çš„å•å…ƒã€‚å®ƒä»¬æ˜¯é«˜åº¦å¯å¤ç”¨çš„ä»£ç å—ï¼Œè´Ÿè´£æ‰§è¡Œç‰¹å®šçš„æ“ä½œï¼ˆå¦‚å®‰è£…è½¯ä»¶åŒ…ã€é…ç½®æ–‡ä»¶ç­‰ï¼‰ã€‚\n\n### è§’è‰² (Roles)\n\nè§’è‰²æ˜¯ Playbook çš„ä¸€ç§ç»„ç»‡æ–¹å¼ï¼Œç”¨äºæŠŠå¤šä¸ªä»»åŠ¡ã€æ–‡ä»¶ã€æ¨¡æ¿ã€å˜é‡ç­‰ç»„ç»‡æˆä¸€ä¸ªå®Œæ•´çš„åŠŸèƒ½æ¨¡å—ã€‚è§’è‰²å¸®åŠ©å°†å¤æ‚çš„é…ç½®æ‹†åˆ†æˆå¯å¤ç”¨çš„ç»„ä»¶ã€‚å¯åœ¨å‰§é›†å†…éƒ¨ä½¿ç”¨çš„å¯é‡ç”¨ Ansible å†…å®¹ã€‚\n\n### ä»»åŠ¡ (Tasks)\n\nä»»åŠ¡æ˜¯ Playbook ä¸­å®šä¹‰çš„å…·ä½“æ“ä½œã€‚æ¯ä¸ªä»»åŠ¡é€šå¸¸ä¼šè°ƒç”¨ä¸€ä¸ª Ansible æ¨¡å—æ¥æ‰§è¡Œç‰¹å®šçš„æ“ä½œã€‚æ˜¯ad-hoc æ›´é€‚åˆä¸´æ—¶æ‰§è¡Œå‘½ä»¤çš„æ‰§è¡Œåœºæ™¯ã€‚\n\n### æ’ä»¶\n\næ‰©å±• Ansible æ ¸å¿ƒåŠŸèƒ½çš„ä»£ç ç‰‡æ®µã€‚æ’ä»¶å¯ä»¥æ§åˆ¶æ‚¨å¦‚ä½•è¿æ¥åˆ°è¢«ç®¡ç†èŠ‚ç‚¹ï¼ˆè¿æ¥æ’ä»¶ï¼‰ã€æ“ä½œæ•°æ®ï¼ˆè¿‡æ»¤å™¨æ’ä»¶ï¼‰ï¼Œç”šè‡³æ§åˆ¶åœ¨æ§åˆ¶å°ä¸­æ˜¾ç¤ºçš„å†…å®¹ï¼ˆå›è°ƒæ’ä»¶ï¼‰ã€‚\n\n### é›†åˆ\n\nAnsible å†…å®¹çš„åˆ†å‘æ ¼å¼ï¼Œå¯ä»¥åŒ…å«å‰§æœ¬ã€è§’è‰²ã€æ¨¡å—å’Œæ’ä»¶ã€‚\n\n## Ansibleä»»åŠ¡æ‰§è¡Œæ¨¡å¼\n\nAnsible ç³»ç»Ÿç”±æ§åˆ¶ä¸»æœºå¯¹è¢«ç®¡èŠ‚ç‚¹çš„æ“ä½œæ–¹å¼å¯åˆ†ä¸ºä¸¤ç±»ï¼Œå³`ad-hoc`å’Œ`playbook`ï¼š\n\n- ad-hocæ¨¡å¼(ç‚¹å¯¹ç‚¹æ¨¡å¼)\n  ã€€ã€€ä½¿ç”¨å•ä¸ªæ¨¡å—ï¼Œæ”¯æŒæ‰¹é‡æ‰§è¡Œå•æ¡å‘½ä»¤ã€‚ad-hoc å‘½ä»¤æ˜¯ä¸€ç§å¯ä»¥å¿«é€Ÿè¾“å…¥çš„å‘½ä»¤ï¼Œè€Œä¸”ä¸éœ€è¦ä¿å­˜èµ·æ¥çš„å‘½ä»¤ã€‚\n- playbookæ¨¡å¼(å‰§æœ¬æ¨¡å¼)\n  ã€€ã€€æ˜¯Ansibleä¸»è¦ç®¡ç†æ–¹å¼ï¼Œä¹Ÿæ˜¯AnsibleåŠŸèƒ½å¼ºå¤§çš„å…³é”®æ‰€åœ¨ã€‚**playbooké€šè¿‡å¤šä¸ªtaské›†åˆå®Œæˆä¸€ç±»åŠŸèƒ½**ã€‚å¯ä»¥ç®€å•åœ°æŠŠplaybookç†è§£ä¸ºé€šè¿‡ç»„åˆå¤šæ¡ad-hocæ“ä½œçš„é…ç½®æ–‡ä»¶ã€‚\n\n## Ansibleå®‰è£…ï¼ˆcentos 7ï¼‰\n\nä¿®æ”¹ç³»ç»Ÿé•œåƒæºä¸ºé˜¿é‡Œäº‘é•œåƒæº\n\n```shell\ncd /etc/yum.repos.d\nmv CentOS-Base.repo CentOS-Base.repo.bak\ncurl -o /etc/yum.repos.d/CentOS-Base.repo http://mirrors.aliyun.com/repo/Centos-7.repo\n```\n\n### æ–¹å¼ä¸€ï¼šä½¿ç”¨yumå®‰è£…\n\nå®‰è£…`epel-release`åŒ…ä¸`Ansible`\n\n```shell\nyum install epel-release -y\nyum install ansible -y\n#æŸ¥çœ‹ç‰ˆæœ¬\n ansible --version\n```\n\n### æ–¹å¼äºŒï¼šä½¿ç”¨pipå®‰è£…\n\n```shell\nyum install python3 python3-devel python3-pip -y\npython3 -m pip install ansible\n#æŸ¥çœ‹ç‰ˆæœ¬\n ansible --version\n```\n\n## Ansible é…ç½®æ–‡ä»¶\n\né…ç½®æ–‡ä»¶è¯»å–çš„ä¼˜å…ˆçº§é¡ºåºå¦‚ä¸‹ï¼š\n\n1. æ£€æŸ¥ç¯å¢ƒå˜é‡`ANSIBLE_CONFIG`æŒ‡å‘çš„è·¯å¾„æ–‡ä»¶(export ANSIBLE_CONFIG=xxxx)ï¼›\n2. æ£€æŸ¥å½“å‰é¡¹ç›®ç›®å½•ä¸‹çš„ansible.cfgé…ç½®æ–‡ä»¶ï¼›\n3. `~/.ansible.cfg`ï¼Œæ£€æŸ¥å½“å‰ç›®å½•ä¸‹çš„ansible.cfgé…ç½®æ–‡ä»¶ï¼›\n4. `/etc/ansible/ansible.cfg`æ£€æŸ¥etcç›®å½•çš„é…ç½®æ–‡ä»¶ã€‚\n\n## Ansibleå…å¯†ç™»å½•\n\n### rootç”¨æˆ·\n\næ§åˆ¶èŠ‚ç‚¹è®¾ç½®sshå…å¯†ç™»å½•ï¼Œå¹¶å°†å¯†é’¥ä¼ è‡³å—æ§èŠ‚ç‚¹ä¸Šã€‚\n\n```shell\nssh-keygen -t dsa -f ~/.ssh/id_dsa -P \"\"\nssh-copy-id -i ~/.ssh/id_dsa.pub root@å—æ§ä¸»æœºip\n```\n\n### æ™®é€šç”¨æˆ·\n\næ§åˆ¶èŠ‚ç‚¹å’Œè¢«æ§èŠ‚ç‚¹éƒ½è¦æœ‰æ™®é€šç”¨æˆ·ï¼Œæ­¤å¤„ä»¥`test`ç”¨æˆ·ä¸ºä¾‹ã€‚\n\n```shell\n#æ·»åŠ testç”¨æˆ·ï¼Œå¹¶è®¾ç½®å¯†ç \nuseradd test\npasswd test\n```\n\nåœ¨æ§åˆ¶èŠ‚ç‚¹è®¾ç½®sshå…å¯†ç™»å½•ï¼Œå¹¶å°†å¯†é’¥ä¼ è‡³å—æ§èŠ‚ç‚¹ã€‚\n\n```shell\nssh-keygen -t dsa -f ~/.ssh/id_dsa -P \"\"\nssh-copy-id -i ~/.ssh/id_dsa.pub test@å—æ§ä¸»æœºip\n```\n\nä¿®æ”¹æ‰€æœ‰ä¸»æœºçš„`test`ç”¨æˆ·çš„sudoæƒé™ã€‚\n\n```shell\nvisudo\ntest    ALL=(ALL)       NOPASSWD: ALL\n```\n\nä¿®æ”¹æ§åˆ¶èŠ‚ç‚¹çš„é…ç½®æ–‡ä»¶`/etc/ansible/ansible.cfg`ï¼Œè®¾ç½®æ™®é€šç”¨æˆ·æƒé™æå‡ã€‚\n\n```shell\nvi /etc/ansible/ansible.cfg\n#å°†ä»¥ä¸‹å†…å®¹æ³¨é‡Šå–æ¶ˆ\n[privilege_escalation]\nbecome=True   #å¯ç”¨æƒé™æå‡\nbecome_method=sudo  #é€šè¿‡ sudo æå‡åˆ° root ç”¨æˆ·çš„æƒé™\nbecome_user=root  #ä½œä¸º root ç”¨æˆ·æ‰§è¡Œä»»åŠ¡\nbecome_ask_pass=False  #ç¦ç”¨å¯†ç æç¤º\n```\n\n## Ansible Ad-Hocä¸å¸¸ç”¨æ¨¡å—\n\n### Ad-Hoc\n\nad-hocå³ä¸ºå‘½ä»¤è¡Œæ¨¡å¼ï¼Œæ‰§è¡Œå®Œå³ç»“æŸã€‚\n\n**å‘½ä»¤è¯­æ³•ç»“æ„ï¼š**\n\n`ansible 'groups' -m command -a 'df -h'`,å…¶å«ä¹‰å¦‚ä¸‹å›¾ï¼š\n\n![image-20250407162815663](AnsibleçŸ¥è¯†æ¢³ç†/2.png)\n\n**æ‰§è¡Œè¿‡ç¨‹ï¼š**\n\n1. åŠ è½½é…ç½®æ–‡ä»¶ï¼Œé»˜è®¤`/etc/ansible/ansible.cfg`;\n2. æŸ¥æ‰¾å¯¹åº”çš„ä¸»æœºé…ç½®æ–‡ä»¶ï¼Œæ‰¾åˆ°è¦æ‰§è¡Œçš„ä¸»æœºæˆ–è€…ç»„ï¼š\n3. åŠ è½½å¯¹åº”çš„æ¨¡å—æ–‡ä»¶ï¼Œå¦‚`command`;\n4. é€šè¿‡`ansible`å°†æ¨¡å—æˆ–å‘½ä»¤ç”Ÿæˆå¯¹åº”çš„ä¸´æ—¶`py`æ–‡ä»¶ï¼Œå¹¶å°†è¯¥æ–‡ä»¶ä¼ è¾“è‡³è¿œç¨‹æœåŠ¡å™¨å¯¹åº”æ‰§è¡Œç”¨æˆ·`$HOME/.ansible/tmp/ansible-tmp-number/XXX.PY`;\n5. è¿œç¨‹ä¸»æœºæ‰§è¡Œè¯¥æ–‡ä»¶ï¼›\n6. æ‰§è¡Œå¹¶è¿”å›ç»“æœï¼›\n7. åˆ é™¤ä¸´æ—¶`py`æ–‡ä»¶ï¼Œ`sleep 0`é€€å‡ºï¼›\n\n**æ‰§è¡ŒçŠ¶æ€ï¼š**\n\nä½¿ç”¨ad-hocæ‰§è¡Œä¸€æ¬¡è¿œç¨‹å‘½ä»¤ï¼Œæ³¨æ„è§‚å¯Ÿè¿”å›ç»“æœçš„é¢œè‰²ï¼š\n\n- ç»¿è‰²ï¼šä»£è¡¨å—æ§èŠ‚ç‚¹æ²¡æœ‰è¢«ä¿®æ”¹\n- é»„è‰²ï¼šä»£è¡¨å—æ§èŠ‚ç‚¹å‘ç°å˜æ›´\n- çº¢è‰²ï¼šä»£è¡¨å‡ºç°äº†æ•…éšœï¼Œæ³¨æ„æŸ¥çœ‹æç¤º\n\n### å¸¸ç”¨æ¨¡å—\n\n#### commandæ¨¡å—\n\n**åŸºæœ¬æ ¼å¼å’Œå¸¸ç”¨å‚æ•°**\n\n```shell\nansible 'ç»„/IP' -m command -a '[å‚æ•°] å‘½ä»¤'\n```\n\n| å‚æ•°      | é€‰é¡¹                 | å«ä¹‰                 |\n|:------- |:------------------ |:------------------ |\n| chdir   | chdir /opt         | æ‰§è¡Œansibleæ—¶ï¼Œåˆ‡æ¢åˆ°æŒ‡å®šç›®å½• |\n| creates | creates /data/file | å¦‚æœæ–‡ä»¶å­˜åœ¨ï¼Œåˆ™è·³è¿‡æ‰§è¡Œ       |\n| removes | removes /data/file | å¦‚æœæ–‡ä»¶å­˜åœ¨ï¼Œåˆ™æ‰§è¡Œ         |\n\n> [root@121 ~]# ansible webservers -m command -a 'ls /root'                      \n> \n> 192.168.1.122 | CHANGED | rc=0 >>\n> anaconda-ks.cfg\n> test.txt\n> 192.168.1.121 | CHANGED | rc=0 >>\n> anaconda-ks.cfg\n> test\n> \n> [root@121 ~]# ansible webservers -m **command** -a '**creates**=/root/test.txt hostname'\n> 192.168.1.122 | SUCCESS | rc=0 >>\n> skipped, since /root/test.txt exists\n> 192.168.1.121 | CHANGED | rc=0 >>\n> 121\n> [root@121 ~]# ansible webservers -m **command** -a '**removes**=/root/test.txt hostname'\n> 192.168.1.122 | CHANGED | rc=0 >>\n> 122\n> 192.168.1.121 | SUCCESS | rc=0 >>\n> skipped, since /root/test.txt does not exist\n> [root@121 ~]#\n\n<mark>shellæ¨¡å—æ”¯æŒç®¡é“ç¬¦ï¼Œcommandæ¨¡å—ä¸æ”¯æŒ</mark>\n\n#### shellæ¨¡å—\n\n**åŸºæœ¬æ ¼å¼å’Œå¸¸ç”¨å‚æ•°**\n\n```shell\nansible 'ç»„/IP/all' -m shell -a '[å‚æ•°] å‘½ä»¤'\n```\n\n> ansible webservers -m shell -a 'ps aux | grep sshd'\n\n#### yum/apt æ¨¡å—\n\n| å¸¸ç”¨å‚æ•°                     | åŠŸèƒ½                      |\n| ---------------------------- | ------------------------- |\n| name                         | éœ€è¦å®‰è£…çš„æœåŠ¡å          |\n| state=present(ç¼ºçœå€¼)/absent | çŠ¶æ€ï¼Œabasentè¡¨ç¤ºå¸è½½æœåŠ¡ |\n\n> #å®‰è£…æœåŠ¡\n>\n> ansible webservers -m yum -a 'name=httpd'\t\t\t\n>\n> #å¸è½½æœåŠ¡\n>\n> ansible webservers -m yum -a 'name=httpd state=absent'\t\t\t\t\n\n#### copyæ¨¡å—\n\n**åŸºæœ¬æ ¼å¼å’Œå¸¸ç”¨å‚æ•°**\n\n```shell\nansible < > -m copy -a 'src=   dest=   [owner= ] [mode=]   '\n```\n\n| å¸¸ç”¨å‚æ•° | åŠŸèƒ½                                 | æ³¨æ„äº‹é¡¹                                                   |\n| -------- | ------------------------------------ | ---------------------------------------------------------- |\n| src      | æŒ‡å®šæºæ–‡ä»¶çš„è·¯å¾„ï¼ˆæ”¯æŒç›®å½•æˆ–æ–‡ä»¶ï¼‰   | è‹¥æºä¸ºç›®å½•ï¼Œç›®æ ‡ä¹Ÿéœ€ä¸ºç›®å½•                                 |\n| dest     | æŒ‡å®šç›®æ ‡æ–‡ä»¶çš„ä½ç½®ï¼ˆå¿…é¡»ä¸ºç»å¯¹è·¯å¾„ï¼‰ | 1. è‹¥æºä¸ºç›®å½•ï¼Œç›®æ ‡éœ€ä¸ºç›®å½•2. ç›®æ ‡æ–‡ä»¶å·²å­˜åœ¨æ—¶ä¼šè¦†ç›–åŸå†…å®¹ |\n| mode     | è®¾ç½®ç›®æ ‡æ–‡ä»¶çš„æƒé™                   |                                                            |\n| owner    | è®¾ç½®ç›®æ ‡æ–‡ä»¶çš„å±ä¸»                   |                                                            |\n| group    | è®¾ç½®ç›®æ ‡æ–‡ä»¶çš„å±ç»„                   |                                                            |\n| content  | ç›´æ¥æŒ‡å®šç›®æ ‡æ–‡ä»¶çš„å†…å®¹               | ä¸å¯ä¸ `src` å‚æ•°åŒæ—¶ä½¿ç”¨                                  |\n\n> ansible dbservers -m copy -a 'src=/etc/fstab dest=/opt/fstab.bak owner=root mode=640'\n> ansible dbservers -a 'ls -l /opt'\n> ansible dbservers -a 'cat /opt/fstab.bak'\n\n#### systemd æ¨¡å—\n\n| å¸¸ç”¨å‚æ•°      | åŠŸèƒ½                                                         |\n| ------------- | ------------------------------------------------------------ |\n| name          | æŒ‡å®šéœ€è¦æ§åˆ¶çš„æœåŠ¡åç§°                                       |\n| state         | æŒ‡å®šæœåŠ¡çŠ¶æ€ï¼Œå¯é€‰å€¼ï¼š`stopped`ã€`started`ã€`reloaded`ã€`restarted`ã€`status` |\n| enabled       | è®¾ç½®æœåŠ¡æ˜¯å¦å¼€æœºå¯åŠ¨ï¼Œ`yes` ä¸ºå¯åŠ¨ï¼Œ`no` ä¸ºä¸å¯åŠ¨            |\n| daemon_reload | è®¾ä¸º `yes` æ—¶é‡å¯ systemd æœåŠ¡ï¼Œä½¿ unit æ–‡ä»¶ç”Ÿæ•ˆ             |\n\n>  ansible webservers -m systemd -a 'name=firewalld state=started enabled=yes'\n\n#### fileæ¨¡å—\n\n**åŸºæœ¬æ ¼å¼å’Œå¸¸ç”¨å‚æ•°**\n\n```shell\nansible < > -m file -a ''\n```\n\n| å¸¸ç”¨å‚æ•° |åŠŸèƒ½                                                         | å¤‡æ³¨                          |\n| :------- | ------------------------------------------------------------ | -------------------------------- |\n| path     | æŒ‡å®šè¿œç¨‹æœåŠ¡å™¨çš„è·¯å¾„                                         | ä¹Ÿå¯å†™æˆ `dest` æˆ– `name`        |\n| state    | å®šä¹‰æ“ä½œç±»å‹ï¼š- `directory`ï¼šåˆ›å»ºç›®å½•- `touch`ï¼šåˆ›å»ºæ–‡ä»¶- `link`ï¼šåˆ›å»ºè½¯é“¾æ¥- `hard`ï¼šåˆ›å»ºç¡¬é“¾æ¥- `absent`ï¼šåˆ é™¤ç›®å½•/æ–‡ä»¶/é“¾æ¥ |                                  |\n| mode     | è®¾ç½®æ–‡ä»¶/ç›®å½•æƒé™                                            | é»˜è®¤å€¼ï¼š- æ–‡ä»¶ `644`- ç›®å½• `755` |\n| owner    | è®¾ç½®å±ä¸»                                                     | é»˜è®¤ `root`                      |\n| group    | è®¾ç½®å±ç»„                                                     | é»˜è®¤ `root`                      |\n| recurse  | é€’å½’ä¿®æ”¹                                                     | yesæˆ–no |\n| src      | ç›®æ ‡ä¸»æœºä¸Šçš„æºæ–‡ä»¶ï¼ˆä¸ `copy` æ¨¡å—ä¸åŒï¼‰                     |                                  |\n\n> #åˆ›å»º/dataç›®å½•ï¼Œæˆæƒtestå±ç»„\n>\n> ansible  webservers  -m file -a 'owner=test group=test mode=644 path=/data state=directory recurse=yes '\t\t\t\n\n#### groupæ¨¡å—\n\n**åŸºæœ¬æ ¼å¼å’Œå¸¸ç”¨å‚æ•°**\n\n```shell\nansible <ç»„/IP/all> -m group -a ' '\n```\n\n| **å‚æ•°** | **åŠŸèƒ½**                   | **å¯é€‰å€¼/è¯´æ˜**                       |\n| -------- | -------------------------- | ------------------------------------- |\n| name     | æŒ‡å®šç”¨æˆ·åï¼ˆå¿…é€‰å‚æ•°ï¼‰     |                                       |\n| state    | æ§åˆ¶è´¦å·çš„åˆ›å»ºæˆ–åˆ é™¤       | `present`ï¼šåˆ›å»ºè´¦å·`absent`ï¼šåˆ é™¤è´¦å· |\n| system   | æŒ‡å®šæ˜¯å¦ä¸ºç³»ç»Ÿè´¦å·         | `yes`ï¼šç³»ç»Ÿè´¦å·`no`ï¼šæ™®é€šè´¦å·         |\n| gid      | æŒ‡å®šç»„IDï¼ˆä¿®æ”¹ç”¨æˆ·æ‰€å±ç»„ï¼‰ | æ•°å€¼æ ¼å¼ï¼ˆå¦‚ `1001`ï¼‰                 |\n\n> ansible  webservers  -m group -a 'name=www gid=666 state=present '\n\n#### useræ¨¡å—\n\n**åŸºæœ¬æ ¼å¼å’Œå¸¸ç”¨å‚æ•°**\n\n```shell\nansible <ç»„/IP/all> -m user -a ' '\n```\n\n| **å‚æ•°**      | **åŠŸèƒ½**                                         | **å¯é€‰å€¼/è¯´æ˜**                                             |\n| ------------- | ------------------------------------------------ | ----------------------------------------------------------- |\n| `name`        | æŒ‡å®šç”¨æˆ·åï¼ˆå¿…é€‰ï¼‰                               |                                                             |\n| `state`       | æ§åˆ¶è´¦å·çš„åˆ›å»ºæˆ–åˆ é™¤                             | `present`ï¼šåˆ›å»º`absent`ï¼šåˆ é™¤                               |\n| `system`      | æŒ‡å®šæ˜¯å¦ä¸ºç³»ç»Ÿè´¦å·                               | `yes`ï¼šç³»ç»Ÿè´¦å·ï¼ˆå¦‚ `mysql`ï¼‰`no`ï¼šæ™®é€šè´¦å·                 |\n| `uid`         | æŒ‡å®šç”¨æˆ·UID                                      | æ•°å€¼ï¼ˆå¦‚ `1001`ï¼‰ï¼Œéœ€å”¯ä¸€                                   |\n| `group`       | æŒ‡å®šç”¨æˆ·åŸºæœ¬ç»„                                   | ç»„åæˆ–GIDï¼ˆéœ€æå‰å­˜åœ¨ï¼‰                                     |\n| `groups`      | æŒ‡å®šç”¨æˆ·æ‰€å±é™„åŠ ç»„                               | ç»„ååˆ—è¡¨ï¼ˆå¦‚ `groups=wheel,admin`ï¼‰                         |\n| `shell`       | è®¾ç½®ç”¨æˆ·é»˜è®¤shell                                | è·¯å¾„ï¼ˆå¦‚ `/bin/bash`ï¼‰                                      |\n| `create_home` | æ˜¯å¦åˆ›å»ºå®¶ç›®å½•                                   | `yes`ï¼šè‡ªåŠ¨åˆ›å»º`no`ï¼šä¸åˆ›å»ºï¼ˆé»˜è®¤è¡Œä¸ºå¯èƒ½ä¾èµ–ç³»ç»Ÿï¼‰         |\n| `password`    | è®¾ç½®ç”¨æˆ·å¯†ç                                      | **å»ºè®®ä½¿ç”¨åŠ å¯†åçš„å­—ç¬¦ä¸²**ï¼ˆå¦‚ `password=\"$6$åŠ å¯†å­—ç¬¦ä¸²\"`ï¼‰ |\n| `remove`      | åˆ é™¤ç”¨æˆ·æ—¶æ˜¯å¦åŒæ—¶åˆ é™¤å®¶ç›®å½•ï¼ˆéœ€`state=absent`ï¼‰ | `yes`ï¼šåˆ é™¤å®¶ç›®å½•`no`ï¼šä¿ç•™                                 |\n\n1ã€ åˆ›å»ºwwwç”¨æˆ·ï¼ŒæŒ‡å®šuid666,åŸºæœ¬ç»„www\n\n```shell\nansible webservers -m user -a 'name=www uid=666 group=www shell=/sbin/nologin create home=no'\n```\n\n2ã€ åˆ›å»ºdbç”¨æˆ·ï¼ŒåŸºæœ¬ç»„æ˜¯root,é™„åŠ ç»„ï¼Œadm,sys\n\n```shell\nansible webservers -m user -a 'name=db group=root groups=adm,sys append=yes shell=/bin/bash create_home=yes'\n```\n\n3ã€ åˆ›å»ºä¸€ä¸ªdddç”¨æˆ·ï¼Œå¯†ç 123ï¼Œéœ€è¦æ­£å¸¸ç™»å½•ç³»ç»Ÿ\n\nï¼ˆ1ï¼‰å¯†ç åŠ å¯†\n\n```shell\nansible localhost -m debug -a \"msg={{ '123' | password_hash('sha512', 'salt123') }}\"\n```\n\n| å‚æ•°                   | ä½œç”¨                     | æ³¨æ„äº‹é¡¹                                                     |\n| ---------------------- | ------------------------ | ------------------------------------------------------------ |\n| `sha512`               | æŒ‡å®šå“ˆå¸Œç®—æ³•ï¼ˆæ¨èï¼‰     | æ”¯æŒ `sha256`/`md5` ç­‰ï¼Œä½† `sha512` æ›´å®‰å…¨ 2                 |\n| `salt123`              | è‡ªå®šä¹‰ç›å€¼               | ç›å€¼éœ€ä¸ºå­—æ¯/æ•°å­—ï¼Œå« `-` æˆ– `_` ä¼šå¯¼è‡´å“ˆå¸Œå¤±è´¥ï¼ˆè¿”å› `*0`ï¼‰ 5 |\n| `password_hash` è¿‡æ»¤å™¨ | å°†æ˜æ–‡å¯†ç è½¬ä¸ºåŠ å¯†å­—ç¬¦ä¸² | éœ€é€šè¿‡ `{{ }}` è°ƒç”¨ä¸”ä¸å˜é‡ç”¨ `                              |\n\n> localhost | SUCCESS => {\n>     \"msg\": \"**$6$salt123$c806NQq6Oqk29MjZdmHxTw7sK3BB1K498o7sZC47UiwQmjx5NJyi5ZhWWGngXf3UfyELHQ1wRJ//oW/Y94azv0**\"\n> }\n\nï¼ˆ2ï¼‰æ’°å†™åˆ›å»ºå‘½ä»¤ï¼Œå®Œæˆåˆ›å»º\n\n```shell\nansible webservers -m user -a \"name=ddd password=ç¬¬ä¸€æ­¥è·å–çš„åŠ å¯†å¯†ç  shell=/bin/bash create_home=yes\"\n```\n\n4ã€ åˆ›å»ºä¸€ä¸ªdevç”¨æˆ·ï¼Œå¹¶ä¸ºå…¶ç”Ÿæˆå¯¹åº”çš„ç§˜é’¥\n\n```shell\nansible webservers -m user -a 'name=dev generate_ssh_key=yes ssh_key_bits=2048 ssh_key_file=.ssh/id_rsa'\n```\n\n#### mount æ¨¡å—\n\n| å¸¸ç”¨å‚æ•° | åŠŸèƒ½                                                         |\n| -------- | ------------------------------------------------------------ |\n| src      | æŒ‡å®šè¦æŒ‚è½½çš„è®¾å¤‡æˆ–åˆ†åŒºè·¯å¾„ã€‚                                 |\n| path     | æŒ‡å®šè¦æŒ‚è½½åˆ°çš„ç›®æ ‡è·¯å¾„ã€‚                                     |\n| fstype   | æŒ‡å®šè¦æŒ‚è½½çš„æ–‡ä»¶ç³»ç»Ÿç±»å‹ã€‚                                   |\n| state    | æŒ‡å®šæŒ‚è½½çŠ¶æ€ï¼Œå¯é€‰å€¼ä¸º `mounted`ã€ï¼ˆä¸´æ—¶æŒ‚è½½ï¼‰`present`ï¼ˆæ°¸ä¹…æŒ‚è½½ï¼‰ã€`unmounted` ï¼ˆä¸´æ—¶å¸è½½ï¼‰æˆ– `absent`ï¼ˆå¸è½½ï¼‰ã€‚ |\n| opts     | æŒ‡å®šæŒ‚è½½é€‰é¡¹ï¼Œä¾‹å¦‚æŒ‚è½½é€‰é¡¹æˆ–å‚æ•°ã€‚                           |\n\n> #å°†192.168.1.121ä¸Šçš„/nfsç›®å½•æŒ‚è½½åˆ°192.168.1.122çš„/nfsç›®å½•\n>\n> ansible 192.168.1.122 -m mount -a 'src=192.168.1.121:/nfs path=/nfs fstype=nfs opts=defaults state=present '\n\n#### cronæ¨¡å—\n\n**åŸºæœ¬æ ¼å¼å’Œå¸¸ç”¨å‚æ•°**\n\n```shell\nansible <ç»„/IP/all> -m cron -a ' '\n```\n\n| å¸¸ç”¨å‚æ•°                      | åŠŸèƒ½                                          |\n| ----------------------------- | --------------------------------------------- |\n| minute/hour/day/month/weekday | åˆ†/æ—¶/æ—¥/æœˆ/å‘¨                                |\n| job                           | ä»»åŠ¡è®¡åˆ’è¦æ‰§è¡Œçš„å‘½ä»¤                          |\n| name                          | ä»»åŠ¡è®¡åˆ’çš„åç§°                                |\n| user                          | æŒ‡å®šè®¡åˆ’ä»»åŠ¡å±äºå“ªä¸ªç”¨æˆ·ï¼Œé»˜è®¤æ˜¯rootç”¨æˆ·      |\n| state                         | presentè¡¨ç¤ºæ·»åŠ ï¼ˆå¯ä»¥çœç•¥ï¼‰ï¼Œabsentè¡¨ç¤ºç§»é™¤ã€‚ |\n\n> #æ·»åŠ ä¸€ä¸ªæ¯å¤©19ç‚¹æ‰§è¡Œ/data/test.shè„šæœ¬çš„å®šæ—¶ä»»åŠ¡ï¼Œä»»åŠ¡åä¸ºscript-testã€‚\n>\n> ansible webservers -m cron -a 'name=\"script-test\" hour=19 minute=00 job=\"/bin/bash /data/test.sh\" '\n>\n> #æ³¨é‡Šè¯¥å®šæ—¶ä»»åŠ¡\n>\n> ansible webservers -m cron -a 'name=\"script-test\" hour=19 minute=00 job=\"/bin/bash /data/test.sh\" disabled=yes '\n>\n> #åˆ é™¤è¯¥å®šæ—¶ä»»åŠ¡\n>\n> ansible webservers -m cron -a 'name=\"script-test\" hour=19 minute=00 job=\"/bin/bash /data/test.sh\" state=absent '\n\n#### archive æ¨¡å—\n\n| å¸¸ç”¨å‚æ•° | åŠŸèƒ½                                                         |\n| -------- | ------------------------------------------------------------ |\n| path     | æŒ‡å®šè¦æ‰“åŒ…çš„æºç›®å½•æˆ–æ–‡ä»¶çš„è·¯å¾„ã€‚                             |\n| dest     | æŒ‡å®šæ‰“åŒ…æ–‡ä»¶çš„è¾“å‡ºè·¯å¾„ã€‚                                     |\n| format   | æŒ‡å®šæ‰“åŒ…æ–‡ä»¶çš„æ ¼å¼ï¼Œå¯ä»¥æ˜¯ zipã€tarã€gz æˆ– bzip2ã€‚é»˜è®¤ä¸º tar æ ¼å¼ã€‚ |\n| remove   | æŒ‡å®šæ˜¯å¦åœ¨æ‰“åŒ…æ–‡ä»¶ä¹‹åï¼Œåˆ é™¤æºç›®å½•æˆ–æ–‡ä»¶ã€‚å¯é€‰å€¼ä¸º yes æˆ– noã€‚é»˜è®¤ä¸º noï¼Œå³ä¸åˆ é™¤æºç›®å½•æˆ–æ–‡ä»¶ã€‚ |\n\n#### unarchive æ¨¡å—\n\n| å¸¸ç”¨å‚æ•°       | åŠŸèƒ½                                                       |\n| -------------- | ---------------------------------------------------------- |\n| **copy**       | æŒ‡å®šæ˜¯å¦å°†æ‰“åŒ…æ–‡ä»¶å¤åˆ¶åˆ°è¿œç¨‹èŠ‚ç‚¹ä»¥è¿›è¡Œè§£å‹ç¼©ã€‚             |\n| **remote_src** | (å·²å¼ƒç”¨) æ”¹ç”¨ `copy` å‚æ•°ã€‚                                |\n| **src**        | æŒ‡å®šè¦è§£å‹ç¼©çš„æ‰“åŒ…æ–‡ä»¶è·¯å¾„ï¼Œå¯ä»¥æ˜¯æœ¬åœ°è·¯å¾„æˆ–è¿œç¨‹è·¯å¾„ã€‚     |\n| **dest**       | æŒ‡å®šè¦å°†æ–‡ä»¶è§£å‹ç¼©åˆ°çš„ç›®æ ‡ç›®å½•ã€‚                           |\n| **creates**    | æŒ‡å®šä¸€ä¸ªæ–‡ä»¶è·¯å¾„ï¼Œå¦‚æœè¯¥æ–‡ä»¶å·²ç»å­˜åœ¨ï¼Œåˆ™ä¸è¿›è¡Œè§£å‹ç¼©æ“ä½œã€‚ |\n| **remote_tmp** | ç”¨äºæŒ‡å®šè¿œç¨‹èŠ‚ç‚¹ä¸Šçš„ä¸´æ—¶ç›®å½•ã€‚é»˜è®¤ä¸º `/tmp`ã€‚              |\n\n> 1ã€ å°†æ§åˆ¶ç«¯çš„å‹ç¼©åŒ…ï¼Œè§£å‹åˆ°è¢«æ§ç«¯ï¼š\n>\n> ansible webservers -m unarchive -a 'src=./test.tar.gz dest=/mnt'\n> 2ã€ å°†è¢«æ§ç«¯çš„å‹ç¼©åŒ…è§£å‹åˆ°è¢«æ§ç«¯ï¼š\n>\n> ansible webservers -m unarchive -a 'src=/tmp/config_vpn_new.zip dest=/mnt remote_src=yes'\n\n#### lineinfileæ¨¡å—\n\nå«ä¹‰ï¼šæ›¿æ¢|è¿½åŠ |åˆ é™¤\n\n| å‚æ•°         | é€‰é¡¹                    | å«ä¹‰                                          |\n| ------------ | ----------------------- | --------------------------------------------- |\n| path         | æ—                       | æŒ‡å®šè¦æ“ä½œçš„ç›®æ ‡æ–‡ä»¶è·¯å¾„                      |\n| regexp       | æ—                       | ä½¿ç”¨æ­£åˆ™è¡¨è¾¾å¼åŒ¹é…æ–‡ä»¶ä¸­çš„è¡Œ                  |\n| line         | æ—                       | æŒ‡å®šè¦ä¿®æ”¹æˆ–æ’å…¥çš„æ–°æ–‡æœ¬å†…å®¹                  |\n| insertafter  | æ—                       | å°†æ–‡æœ¬æ’å…¥åˆ°ã€Œæ­£åˆ™åŒ¹é…è¡Œã€ä¹‹å                |\n| insertbefore | æ—                       | å°†æ–‡æœ¬æ’å…¥åˆ°ã€Œæ­£åˆ™åŒ¹é…è¡Œã€ä¹‹å‰                |\n| state        | absent / present (é»˜è®¤) | `absent`åˆ é™¤åŒ¹é…è¡Œï¼Œ`present`ç¡®ä¿æ–‡æœ¬å­˜åœ¨     |\n| backrefs     | yes / no                | `yes`å¯ç”¨æ­£åˆ™åå‘å¼•ç”¨ï¼Œ`no`æœªåŒ¹é…æ—¶ä¸æ“ä½œæ–‡ä»¶ |\n| backup       | æ—                       | ä¿®æ”¹å‰æ˜¯å¦åˆ›å»ºå¤‡ä»½æ–‡ä»¶ï¼ˆå¸ƒå°”å€¼ï¼‰              |\n| create       | æ—                       | å½“ç›®æ ‡æ–‡ä»¶ä¸å­˜åœ¨æ—¶æ˜¯å¦åˆ›å»ºæ–°æ–‡ä»¶ï¼ˆå¸ƒå°”å€¼ï¼‰    |\n\n> 1ã€æ›¿æ¢httpd.confæ–‡ä»¶ä¸­ï¼ŒListenä¸ºListen8080;\n>\n> ansible webservers -m lineinfile -a 'path=/etc/httpd/conf/httpd.conf regexp=\"^Listen\" line=\"Listen 8080\"'\n>\n> 2ã€ ç»™ä¸»æœºå¢åŠ ä¸€ä¸ªç½‘å…³ï¼š\n>\n> ansible webservers -m lineinfile -a 'path=/etc/sysconfig/network-scripts/ifcfg-eth1 line=\"GATEWAY=172.16.1.200\"'\n> 3ã€ åˆ é™¤ä¸»æœºçš„ç½‘å…³ï¼š\n>\n> ansible webservers -m lineinfile -a 'path=/etc/sysconfig/network-scripts/ifcfg-ethl regexp=\"^GATEWAY\" state=absent'\n\n## Ansible Playbook\n\nplaybookæ˜¯ä¸€ä¸ªç”±ymlè¯­æ³•ç¼–å†™çš„æ–‡æœ¬æ–‡ä»¶ï¼Œå®ƒç”±`play`å’Œ`task`ä¸¤éƒ¨åˆ†ç»„æˆã€‚\n`play`ï¼šä¸»è¦å®šä¹‰è¦æ“ä½œä¸»æœºæˆ–è€…ä¸»æœºç»„ã€‚\n\n`task`ï¼šä¸»è¦å®šä¹‰å¯¹ä¸»æœºæˆ–ä¸»æœºç»„å…·ä½“æ‰§è¡Œçš„ä»»åŠ¡ï¼Œå¯ä»¥æ˜¯ä¸€ä¸ªä»»åŠ¡ï¼Œä¹Ÿå¯ä»¥æ˜¯å¤šä¸ªä»»åŠ¡(æ¨¡å—)ã€‚\n\nplaybookæ˜¯ç”±ä¸€ä¸ªæˆ–å¤šä¸ªplayç»„æˆï¼Œä¸€ä¸ªplayå¯ä»¥åŒ…å«å¤šä¸ªtaskä»»åŠ¡ã€‚\n\nå¯ä»¥ç†è§£ä¸ºï¼šä½¿ç”¨å¤šä¸ªä¸åŒçš„æ¨¡å—æ¥å…±åŒå®Œæˆä¸€ä»¶äº‹æƒ…ã€‚\n\n### Playbookä¹¦å†™æ ¼å¼\n\nplaybookæ˜¯ç”±ymlè¯­æ³•ä¹¦å†™ï¼Œç»“æ„æ¸…æ™°ï¼Œå¯è¯»æ€§å¼ºã€‚\n\n| è¯­æ³•   | æè¿°                                                         |\n| ------ | ------------------------------------------------------------ |\n| ç¼©è¿›   | **YAML** ä½¿ç”¨å›ºå®šçš„ç¼©è¿›é£æ ¼è¡¨ç¤ºå±‚çº§ç»“æ„ï¼Œæ¯ä¸ªç¼©è¿›ç”±<mark>ä¸¤ä¸ªç©ºæ ¼</mark>ç»„æˆï¼Œä¸èƒ½ä½¿ç”¨ **tabs** |\n| å†’å·   | ä»¥å†’å·ç»“å°¾çš„é™¤å¤–ï¼Œå…¶ä»–æ‰€æœ‰å†’å·åé¢å¿…é¡»æœ‰ç©ºæ ¼                 |\n| çŸ­æ¨ªçº¿ | è¡¨ç¤ºåˆ—è¡¨é¡¹ï¼Œä½¿ç”¨ä¸€ä¸ªçŸ­æ¨ªæ åŠ ä¸€ä¸ªç©ºæ ¼ã€‚å¤šä¸ªé¡¹ä½¿ç”¨åŒæ ·çš„ç¼©è¿›çº§åˆ«ä½œä¸ºåŒä¸€åˆ—è¡¨ |\n\n### Playbookåº”ç”¨å®ä¾‹ï¼š\n\n#### å®‰è£…nignx\n\nï¼ˆ1ï¼‰æ’°å†™playbookæ–‡ä»¶\n\n```yaml\nvi nginx.yml\n\n- hosts: webservers\n  tasks:\n    - name: å®‰è£…nignx\n      yum:\n        name: nginx\n        state: present\n    - name: å¯åŠ¨nignx\n      systemd:\n        name: nginx\n        state: started\n        enabled: yes\n```\n\nï¼ˆ2ï¼‰æ£€æŸ¥æ–‡ä»¶æ˜¯å¦æœ‰è¯­æ³•é”™è¯¯\n\n```shell\nansible-playbook --syntax nginx.yml\næˆ–\nansible-playbook --syntax-check nginx.yml\n```\n\n> [root@121 data]# ansible-playbook --syntax nginx.yml\n>\n> playbook: nginx.yml\n\nï¼ˆ3ï¼‰è¿›è¡Œæ¨¡æ‹Ÿæ‰§è¡Œ\n\n```shell\nansible-playbook -C nginx.yml\n```\n\n> [root@121 data]# ansible-playbook -C nginx.yml\n>\n> PLAY [webservers] **************************************************************\n>\n> TASK [Gathering Facts] *********************************************************\n> ok: [192.168.1.122]\n> ok: [192.168.1.121]\n>\n> TASK [å®‰è£…nignx] *****************************************************************\n> changed: [192.168.1.122]\n> changed: [192.168.1.121]\n>\n> TASK [å¯åŠ¨nignx] *****************************************************************\n> changed: [192.168.1.121]\n> changed: [192.168.1.122]\n>\n> PLAY RECAP *********************************************************************\n> 192.168.1.121              : ok=3    changed=2    unreachable=0    failed=0    skipped=0    rescued=0    ignored=0\n> 192.168.1.122              : ok=3    changed=2    unreachable=0    failed=0    skipped=0    rescued=0    ignored=0\n\nï¼ˆ4ï¼‰å®é™…æ‰§è¡Œ\n\n```shell\nansible-playbook nginx.yml\n```\n\n> [root@121 data]# ansible-playbook nginx.yml\n>\n> PLAY [webservers] **************************************************************\n>\n> TASK [Gathering Facts] *********************************************************\n> ok: [192.168.1.122]\n> ok: [192.168.1.121]\n>\n> TASK [å®‰è£…nignx] ***************************************************************                                                   **\n> changed: [192.168.1.121]\n> changed: [192.168.1.122]\n>\n> TASK [å¯åŠ¨nignx] *****************************************************************\n> changed: [192.168.1.122]\n> changed: [192.168.1.121]\n>\n> PLAY RECAP *********************************************************************\n> 192.168.1.121              : ok=3    changed=2    unreachable=0    failed=0    skipped=0    rescued=0    ignored=0\n> 192.168.1.122              : ok=3    changed=2    unreachable=0    failed=0    skipped=0    rescued=0    ignored=0\n\n#### å®‰è£…NFSæœåŠ¡\n\nä»»åŠ¡é¡ºåºï¼š\n\n- ä¸‹è½½nfsç¨‹åº\n- æŒ‚è½½nfsé…ç½®æ–‡ä»¶ï¼ˆè®¾ç½®è§¦å‘å™¨ï¼Œä¿®æ”¹é…ç½®æ–‡ä»¶åï¼Œä½¿é…ç½®é‡å¯ç”Ÿæ•ˆï¼‰\n- åˆå§‹åŒ–è®¾ç½®nfsï¼ˆè®¾ç½®ç”¨æˆ·ã€ç»„ã€æˆæƒï¼‰\n- å¯åŠ¨nfs\n\n> è®¾ç½®çš„è§¦å‘å™¨æ˜¯handlesï¼Œåœ¨ç¬¬äºŒæ­¥ä¸­æ·»åŠ notifyä¿¡æ¯ï¼Œå½“é…ç½®æ–‡ä»¶ä¿®æ”¹æ—¶ï¼Œhandlesè·å–notifyä¸­çš„ä¿¡æ¯ï¼Œé‡å¯nfsæœåŠ¡ï¼Œä½¿å¾—é…ç½®é‡æ–°ç”Ÿæ•ˆ\n\næ–‡ä»¶å‡†å¤‡ï¼š\n\n```shell\n#åˆ›å»ºç›®å½•å­˜æ”¾è¯¥é¡¹ç›®\nmkdir nfs\n#åˆ›å»ºnfsé…ç½®æ–‡ä»¶ï¼Œå°†ä»¥ä¸‹å†…å®¹å†™å…¥\nvi exports.j2\n\n/ansible_test 192.168.1.0/24(rw,all_squash,anonuid=7777,anongid=7777)\n\n```\n\n> å°†ansibleçš„é…ç½®æ–‡ä»¶`ansible.cfg`å’Œ`hosts`ï¼Œæå‰æ”¾ç½®åœ¨è¯¥é¡¹ç›®ç›®å½•ä¸‹\n\nåˆ›å»ºnfså‰§æœ¬\n\n```yaml\nvi nfs.yml\n\n- hosts: webservers\n  tasks:\n    - name: download nfs\n      yum:\n        name: nfs-utils\n        state: present\n    - name: configure nfs\n      copy:\n        src: ./exports.j2\n        dest: /etc/exports\n      notify: restart nfs  #è§¦å‘ä¿¡æ¯\n    - name: init group\n      group:\n        name: bbb\n        gid: 7777\n    - name: init user\n      user:\n        name: bbb\n        uid: 7777\n        group: bbb\n        shell: /sbin/nologin\n        create_home: no\n    - name: init directory\n      file:\n        path: /ansible_test\n        state: directory\n        owner: bbb\n        group: bbb\n        mode: \"0755\"\n    - name: start nfs\n      systemd:\n        name: nfs\n        state: started\n        enabled: yes\n  handlers:  #è§¦å‘å™¨\n    - name: restart nfs\n      systemd:\n        name: nfs\n        state: restarted\n\n```\n\næ‰§è¡Œå¹¶éªŒè¯\n\n```shell\n ansible-playbook --syntax-check nfs.yml\n ansible-playbook -C nfs.yml\n ansible-playbook nfs.yml\n \n #æŸ¥çœ‹nfsæœåŠ¡\n showmount -e 192.168.1.121\n showmount -e 192.168.1.122\n \n #æŒ‚è½½æµ‹è¯•\n mount -t nfs 192.168.1.121:/ansible_test /data/test\n mount -t nfs 192.168.1.122:/ansible_test /data/test1\n```\n\n> [root@121 ~]# df -h\n> æ–‡ä»¶ç³»ç»Ÿ                     å®¹é‡  å·²ç”¨  å¯ç”¨ å·²ç”¨% æŒ‚è½½ç‚¹\n> devtmpfs                     898M     0  898M    0% /dev\n> tmpfs                        910M     0  910M    0% /dev/shm\n> tmpfs                        910M  9.7M  901M    2% /run\n> tmpfs                        910M     0  910M    0% /sys/fs/cgroup\n> /dev/mapper/centos-root       17G  1.7G   16G   10% /\n> /dev/sda1                   1014M  153M  862M   16% /boot\n> tmpfs                        182M     0  182M    0% /run/user/0\n> 192.168.1.121:/ansible_test   17G  1.7G   16G   10% /data/test\n> 192.168.1.122:/ansible_test   17G  2.2G   15G   13% /data/test1\n\n#### å®‰è£…rsyncæœåŠ¡\n\n##### rsyncæœåŠ¡ç«¯ï¼š\n\nä»»åŠ¡é¡ºåºï¼š\n\n- ä¸‹è½½rsyncç¨‹åº\n- æŒ‚è½½rsyncé…ç½®æ–‡ä»¶ï¼ˆè®¾ç½®è§¦å‘å™¨ï¼Œä¿®æ”¹é…ç½®æ–‡ä»¶åï¼Œä½¿é…ç½®é‡å¯ç”Ÿæ•ˆï¼‰\n- åˆå§‹åŒ–è®¾ç½®rsyncï¼ˆè®¾ç½®ç”¨æˆ·ã€ç»„ã€æˆæƒï¼‰\n- åˆ›å»ºè™šæ‹Ÿç”¨æˆ·å’Œå¯†ç \n- å¯åŠ¨rsync\n\n> è®¾ç½®çš„è§¦å‘å™¨æ˜¯handlesï¼Œå½“é…ç½®æ–‡ä»¶æˆ–è™šæ‹Ÿç”¨æˆ·å¯†ç ä¿®æ”¹æ—¶ï¼Œhandlesè·å–notifyä¸­çš„ä¿¡æ¯ï¼Œé‡å¯rsyncæœåŠ¡ï¼Œä½¿å¾—é…ç½®é‡æ–°ç”Ÿæ•ˆ\n\næ–‡ä»¶å‡†å¤‡ï¼š\n\n```shell\n#åˆ›å»ºç›®å½•å­˜æ”¾è¯¥é¡¹ç›®\nmkdir rsync\n#å¤åˆ¶rsyncé…ç½®æ–‡ä»¶rsyncd.confå¹¶ä¿®æ”¹ï¼ˆå¯å…ˆæ‰‹åŠ¨ä¸‹è½½rsyncï¼Œæ‹·è´é…ç½®æ–‡ä»¶åå†å¸è½½ï¼Œä¹Ÿå¯ç›´æ¥ä½¿ç”¨ä»¥ä¸‹å†…å®¹ï¼‰\n\nuid = ansible_www\ngid = ansible_www\nport = 873\nfake super = yes\nuse chroot = yes\nmax connections = 4\ntimeout = 900\nread only = false\nlist = false\nauth users = rsync_backup\nsecrets file = /etc/rsync.passwd\nlog file = /var/log/rsyncd.log\n[backup]\npath = /backup\n```\n\n> å°†ansibleçš„é…ç½®æ–‡ä»¶`ansible.cfg`å’Œ`hosts`ï¼Œæå‰æ”¾ç½®åœ¨è¯¥é¡¹ç›®ç›®å½•ä¸‹\n\nåˆ›å»ºrsyncå‰§æœ¬\n\n\n```yaml\nvi rsync.yml\n\n- hosts: webservers\n  tasks:\n    - name: download rsync\n      yum:\n        name: rsync\n        state: present\n    - name: configure rsync\n      copy:\n        src: ./rsyncd.conf\n        dest: /etc/rsyncd.conf\n        owner: root\n        group: root\n        mode: \"0644\"\n      notify: restart rsync\n    - name: init group\n      group:\n        name: ansible_www\n        gid: 8888\n    - name: init user\n      user:\n        name: ansible_www\n        uid: 8888\n        group: ansible_www\n        shell: /sbin/nologin\n        create_home: no\n    - name: init directory\n      file:\n        path: /backup\n        state: directory\n        owner: ansible_www\n        group: ansible_www\n        mode: \"0755\"\n        recurse: yes\n    - name: init rsync user passwd\n      copy:\n        content: \"rsync_backup:123456\"\n        dest: /etc/rsync.passwd\n        owner: root\n        group: root\n        mode: 0600\n      notify: restart rsync\n    - name: start rsync\n      systemd:\n        name: rsyncd\n        state: started\n        enabled: yes\n  handlers:\n    - name: restart rsync\n      systemd:\n        name: rsyncd\n        state: restarted\n```\n\næ‰§è¡Œå¹¶éªŒè¯\n\n```shell\nansible-playbook --syntax-check rsync.yml \nansible-playbook -C rsync.yml \nansible-playbook rsync.yml  \n\n#éªŒè¯\nrsync -avz host_group rsync_backup@192.168.1.122::backup\n```\n\n##### rsyncå®¢æˆ·ç«¯ï¼š\n\nä»»åŠ¡é¡ºåºï¼š\n\n- å°†è„šæœ¬æ¨é€è‡³è¢«æ§ç«¯æŒ‡å®šè·¯å¾„ä¸‹\n- é…ç½®å®šæ—¶ä»»åŠ¡\n\nåˆ›å»ºrsync-clientå‰§æœ¬\n\n```yaml\nvi rsync-client.yml\n\n- hosts: localhost\n  tasks:\n    - name: create scripts path\n      file:\n        path: /scripts\n        owner: root\n        group: root\n        state: directory\n        mode: 0755\n    - name: push scripts\n      copy:\n        src: test.sh\n        dest: /scripts/test.sh\n        owner: root\n        group: root\n        mode: 0755\n    - name: contable job\n      cron:\n        name: \"push backup data\"\n        minute: \"*/1\"\n        job: \"/bin/bash /scripts/test.sh &>/dev/null\"\n\n```\n\nåˆ›å»ºtest.shä»¥ä¾›æµ‹è¯•\n\n```shell\n#!/bin/bash\nRSYNC_PASSWORD=\"123456\"  rsync -avz /backup/ rsync_backup@192.168.1.122::backup\n```\n\næŸ¥çœ‹æ˜¯å¦æœ‰å®šæ—¶ä»»åŠ¡\n\n```shell\ncrontab -l\n```\n\n> #Ansible: push backup data\n>\n> */1 * * * * /bin/bash /scripts/test.sh &>/dev/null\n\n#### ä½¿ç”¨Ansibleéƒ¨ç½²å¤šèŠ‚ç‚¹phpmyadmin\n\n##### é¡¹ç›®éœ€æ±‚\n\n- ä½¿ç”¨LNMPéƒ¨ç½²phpmyadmin\n- nginxï¼ˆHaproxyï¼‰ä½œä¸ºè´Ÿè½½å‡è¡¡\n- Rediså®ç°ä¼šè¯ä¿æŒ\n\n##### ä¸»æœºè§„åˆ’\n\n| ä¸»æœºå | ip            | ç”¨é€”                              |\n| ------ | ------------- | --------------------------------- |\n| 121    | 192.168.1.121 | Ansibleæ§åˆ¶èŠ‚ç‚¹ã€nignx+PHP        |\n| 122    | 192.168.1.122 | Ansibleå—æ§èŠ‚ç‚¹ã€nignx+PHP        |\n| 123    | 192.168.1.123 | Ansibleå—æ§èŠ‚ç‚¹ã€nignxï¼ˆHaproxyï¼‰ |\n| 124    | 192.168.1.124 | Ansibleå—æ§èŠ‚ç‚¹ã€nignxï¼ˆHaproxyï¼‰ |\n| 125    | 192.168.1.125 | Ansibleå—æ§èŠ‚ç‚¹ã€Redis            |\n\n##### éƒ¨ç½²æ­¥éª¤\n\n###### ç¯å¢ƒå‡†å¤‡\n\n> 121èŠ‚ç‚¹ä¸Šè¦å‡†å¤‡å¥½Ansibleï¼Œå¹¶è®¾ç½®ä»¥ä¸Š5å°æœºå™¨å…å¯†ç™»å½•ï¼Œå…·ä½“å‚ç…§ä¸Šæ–¹çš„é…ç½®è¿‡ç¨‹ã€‚\n\n```shell\n#åˆ›å»ºå­˜æ”¾é¡¹ç›®æ–‡ä»¶ç›®å½•\nmkdir /data/phpmyadmin\n#å°†ansibleçš„é…ç½®æ–‡ä»¶`ansible.cfg`å’Œ`hosts`ï¼Œå¤åˆ¶åˆ°è¯¥phpmyadminç›®å½•ä¸‹ï¼Œå¹¶ä¿®æ”¹é…ç½®\ncp /etc/ansible/ansible.cfg /data/phpmyadmin/ansible.cfg\n#ä¿®æ”¹é…ç½®æ–‡ä»¶ä¸­çš„è·¯å¾„ï¼Œå¹¶å–æ¶ˆæ³¨é‡Š\ninventory      = /data/phpmyadmin/host_group\n\ncp /etc/ansible/hosts /data/phpmyadmin/host_group\n#ä¿®æ”¹ä¸»æœºç»„\n[webservers]\n192.168.1.121\n192.168.1.122\n\n[dbservers]\n192.168.1.125\n\n[lbservers]\n192.168.1.123\n192.168.1.124\n```\n\nç¡®è®¤é…ç½®æ–‡ä»¶çš„è¯»å–è·¯å¾„æ˜¯å¦ä¸ºå½“å‰é¡¹ç›®ä¸‹çš„`/data/phpmyadmin/ansible.cfg`\n\n> [root@121 phpmyadmin]# ansible --version\n> ansible 2.9.27\n>   config file = **/data/phpmyadmin/ansible.cfg**\n>   configured module search path = [u'/root/.ansible/plugins/modules', u'/usr/share/ansible/plugins/modules']\n>   ansible python module location = /usr/lib/python2.7/site-packages/ansible\n>   executable location = /usr/bin/ansible\n>   python version = 2.7.5 (default, Jun 28 2022, 15:30:04) [GCC 4.8.5 20150623 (Red Hat 4.8.5-44)]\n\néªŒè¯ä¸»æœºæ˜¯å¦éƒ½å¯pingé€š\n\n> [root@121 phpmyadmin]# ansible all -m ping\n> 192.168.1.122 | SUCCESS => {\n>     \"ansible_facts\": {\n>         \"discovered_interpreter_python\": \"/usr/bin/python\"\n>     },\n>     \"changed\": false,\n>     \"ping\": \"pong\"\n> }\n> 192.168.1.124 | SUCCESS => {\n>     \"ansible_facts\": {\n>         \"discovered_interpreter_python\": \"/usr/bin/python\"\n>     },\n>     \"changed\": false,\n>     \"ping\": \"pong\"\n> }\n> 192.168.1.123 | SUCCESS => {\n>     \"ansible_facts\": {\n>         \"discovered_interpreter_python\": \"/usr/bin/python\"\n>     },\n>     \"changed\": false,\n>     \"ping\": \"pong\"\n> }\n> 192.168.1.125 | SUCCESS => {\n>     \"ansible_facts\": {\n>         \"discovered_interpreter_python\": \"/usr/bin/python\"\n>     },\n>     \"changed\": false,\n>     \"ping\": \"pong\"\n> }\n> 192.168.1.121 | SUCCESS => {\n>     \"ansible_facts\": {\n>         \"discovered_interpreter_python\": \"/usr/bin/python\"\n>     },\n>     \"changed\": false,\n>     \"ping\": \"pong\"\n> }\n\n###### å®‰è£…Redis\n\nä»»åŠ¡é¡ºåºï¼š\n\n- ä¸‹è½½redisç¨‹åº\n- æŒ‚è½½redisé…ç½®æ–‡ä»¶ï¼ˆè®¾ç½®è§¦å‘å™¨ï¼Œä¿®æ”¹é…ç½®æ–‡ä»¶åï¼Œä½¿é…ç½®é‡å¯ç”Ÿæ•ˆï¼‰\n- å¯åŠ¨redis\n\n> è®¾ç½®è§¦å‘å™¨handlesï¼Œé‡å¯redisæœåŠ¡\n\nï¼ˆ1ï¼‰å°†redisçš„é…ç½®æ–‡ä»¶`redis.conf`ï¼Œæ‹·è´è‡³`/data/phpmyadmin/files`ç›®å½•ä¸‹\n\n```shell\nmkdir /data/phpmyadmin/files\n# è‹¥æ— redis.confæ–‡ä»¶å¯å…ˆåœ¨æ§åˆ¶èŠ‚ç‚¹ä¸Šä½¿ç”¨å‘½ä»¤yum -y install redisä¸‹è½½åå†æ‹·è´\ncp /etc/redis.conf /data/phpmyadmin/files\n#ä¿®æ”¹é…ç½®æ–‡ä»¶,å°†è¦å®‰è£…redisçš„ä¸»æœºipåŠ å…¥\nbind 127.0.0.1 192.168.1.125\n```\n\nï¼ˆ2ï¼‰\n\n```yaml\nvi redis.yml\n\n- hosts: dbservers\n  tasks:\n    - name: download redis\n      yum:\n        name: redis\n        state: present\n    - name: configure redis\n      copy:\n        src: ./files/redis.conf\n        dest: /etc/redis.conf\n        owner: redis\n        group: root\n        mode: 0640\n      notify: restart redis\n    - name: start redis\n      systemd:\n        name: redis\n        state: started\n        enabled: yes\n  handlers:\n    - name: restart redis\n      systemd:\n        name: redis\n        state: restarted\n\n```\n\nï¼ˆ3ï¼‰å®‰è£…å¹¶æµ‹è¯•\n\n```shell\nansible-playbook --syntax-check redis.yml\nansible-playbook -C redis.yml\nansible-playbook redis.yml\n#æµ‹è¯•ï¼Œä¹‹å‰æ§åˆ¶èŠ‚ç‚¹121å®‰è£…äº†redisï¼Œå¯ç›´æ¥åœ¨121ä¸Šæµ‹è¯•\n#æ³¨æ„é˜²ç«å¢™ç«¯å£\nredis-cli -h 192.168.1.125\n```\n\n> [root@121 phpmyadmin]# redis-cli -h 192.168.1.125\n> 192.168.1.125:6379>\n\n###### å®‰è£…Mariadb\n\nåœ¨192.168.1.125ä¸Šå®‰è£…Mariadb\n\n```shell\n yum -y install mariadb-server\n systemctl start mariadb\n systemctl enable mariadb\n #è®¾ç½®rootç”¨æˆ·å¯†ç \n mysqladmin -uroot password '123456'\n #ç™»å½•åˆ›å»ºç”¨æˆ·\n mysql -uroot -p123456\n #åˆ›å»ºæ•°æ®åº“\n create database php_db;\n #åˆ›å»ºæ•°æ®åº“ç”¨æˆ·\n grant all on php_db.* to php_user@'%' identified by '123456';\n```\n\n###### å®‰è£…nginxã€PHP\n\nä»»åŠ¡é¡ºåºï¼š\n\n- ä¸‹è½½nginxã€PHPç¨‹åº\n- æŒ‚è½½nginxã€PHPé…ç½®æ–‡ä»¶ï¼ˆè®¾ç½®è§¦å‘å™¨ï¼Œä¿®æ”¹é…ç½®æ–‡ä»¶åï¼Œä½¿é…ç½®é‡å¯ç”Ÿæ•ˆï¼‰\n- åˆå§‹åŒ–è®¾ç½®nginxï¼ˆè®¾ç½®ç”¨æˆ·ã€ç»„ã€æˆæƒï¼‰\n- å¯åŠ¨nginxã€PHP\n\n> è®¾ç½®è§¦å‘å™¨handlesï¼Œé‡å¯nginxã€PHPæœåŠ¡\n\nï¼ˆ1ï¼‰è®¾ç½®php7ä¸‹è½½æºï¼Œåœ¨121ï¼Œ122ä¸Šæ‰§è¡Œ\n\n```shell\nrpm -Uvh https://mirror.webtatic.com/yum/el7/epel-release.rpm\nrpm -Uvh https://mirror.webtatic.com/yum/el7/webtatic-release.rpm\n```\n\nï¼ˆ2ï¼‰å°†nginxã€phpçš„é…ç½®æ–‡ä»¶ï¼Œæ‹·è´è‡³`/data/phpmyadmin/files`ç›®å½•ä¸‹ï¼Œå¹¶ä¿®æ”¹é…ç½®\n\n```shell\n#nginxé…ç½®æ–‡ä»¶\ncp /etc/nginx/nginx.conf /data/phpmyadmin/files\n#phpé…ç½®æ–‡ä»¶\ncp /etc/php.ini /data/phpmyadmin/files\ncp /etc/php-fpm.d/www.conf /data/phpmyadmin/files\n```\n\nä¿®æ”¹nginxé…ç½®æ–‡ä»¶ï¼Œå°†ç”¨æˆ·ä¿®æ”¹ä¸º`www`ã€‚\n\n```\nvi nginx.conf\nuser www;\n```\n\nåœ¨`/data/phpmyadmin/files`ç›®å½•ä¸‹ï¼Œæ–°å¢`phpmyadmin`çš„nginxä»£ç†æ–‡ä»¶\n\n```\nvi phpmyadmin.conf\n\nserver {\n    listen 80;\n    server_name ansible.phpmyadmin.local;\n\n    # ç¡®ä¿æ­¤è·¯å¾„ä¸phpMyAdminå®é™…è·¯å¾„å®Œå…¨ä¸€è‡´\n    root /code/phpmyadmin;\n    index index.php;\n\n    location / {\n        try_files $uri $uri/ /index.php$is_args$args;\n    }\n\n    location ~ \\.php$ {\n        # ç»å¯¹è·¯å¾„å¿…é¡»å®Œæ•´æ­£ç¡®\n        fastcgi_param SCRIPT_FILENAME $document_root$fastcgi_script_name;\n        fastcgi_pass 127.0.0.1:9000;\n        fastcgi_index index.php;\n        include fastcgi_params;\n\n        # æ·»åŠ å…³é”®å‚æ•°\n        fastcgi_split_path_info ^(.+\\.php)(/.+)$;\n        fastcgi_intercept_errors on;\n        fastcgi_param PATH_INFO $fastcgi_path_info;\n    }\n}\n\n```\n\nä¿®æ”¹phpé…ç½®æ–‡ä»¶`php.ini`ï¼Œè®¾ç½®redisè¿æ¥ã€‚\n\n```\nvi php.ini\n[Session]\n\nsession.save_handler = redis\nsession.save_path = \"tcp://192.168.1.125:6379?weight=1&timeout=2.5\"\n```\n\nä¿®æ”¹phpé…ç½®æ–‡ä»¶`www.conf`ï¼Œè®¾ç½®ç”¨æˆ·å’Œç»„ï¼Œå¹¶æ³¨é‡Šéƒ¨åˆ†è®¾ç½®ã€‚\n\n```\nvi www.conf\n\n[www]\nuser = www\ngroup = www\n\n;php_value[session.save_handler] = files\n;php_value[session.save_path]    = /var/lib/php/session\n\n```\n\nï¼ˆ3ï¼‰ä¸‹è½½phpmyadmin\n\n```shell\n#phpmyadminç¨‹åºä¸‹è½½åˆ°/data/phpmyadmin/filesç›®å½•ä¸‹\ncurl -O https://files.phpmyadmin.net/phpMyAdmin/5.2.2/phpMyAdmin-5.2.2-all-languages.zip\n\n#è§£å‹ç¨‹åº\nunzip phpMyAdmin-5.2.2-all-languages.zip\n#å¤åˆ¶å¹¶ä¿®æ”¹é…ç½®æ–‡ä»¶ï¼Œè¿æ¥mariadbæ•°æ®åº“\ncp phpMyAdmin-5.2.2-all-languages/config.sample.inc.php config.inc.php\n#ä¿®æ”¹localhostä¸º192.168.1.125\n$cfg['Servers'][$i]['host'] = '192.168.1.125';\n```\n\nï¼ˆ4ï¼‰åˆ›å»ºnignx-phpå‰§æœ¬\n\n```yaml\nvi nginx-php.yml\n\n- hosts: webservers\n  tasks:\n    - name: download nginx\n      yum:\n        name: nginx\n        state: present\n    - name: download php\n      yum:\n        name: \"{{ packages }}\"\n      vars:\n        packages:\n        - php72w\n        - php72w-cli\n        - php72w-common\n        - php72w-devel\n        - php72w-embedded\n        - php72w-fpm\n        - php72w-gd\n        - php72w-mbstring\n        - php72w-mysqlnd\n        - php72w-opcache\n        - php72w-pdo\n        - php72w-xml\n        - php72w-ldap\n        - php72w-pecl-redis\n\n    - name: configure nginx\n      copy:\n        src: ./files/nginx.conf\n        dest: /etc/nginx/nginx.conf\n        owner: root\n        group: root\n        mode: 0644\n      notify: restart nginx\n    - name: init group www\n      group:\n        name: www\n        gid: 666\n    - name: init user www\n      user:\n        name: www\n        uid: 666\n        group: www\n        shell: /sbin/nologin\n        create_home: no\n    - name: start nginx\n      systemd:\n        name: nginx\n        state: started        \n        enabled: yes\n\n    - name: configure php.ini\n      copy:\n        src: ./files/php.ini\n        dest: /etc/php.ini\n        owner: root\n        group: root\n        mode: 0644\n      notify: restart php    \n    - name: configure www.conf\n      copy:\n        src: ./files/www.conf\n        dest: /etc/php-fpm.d/www.conf\n        owner: root\n        group: root\n        mode: 0644\n      notify: restart php        \n    - name: start php\n      systemd:\n        name: php-fpm\n        state: started        \n        enabled: yes\n        \n    - name: copy nginx conf \n      copy:\n        src: ./files/phpmyadmin.conf\n        dest: /etc/nginx/conf.d/phpmyadmin.conf\n      notify: restart nginx      \n    - name: create code directory\n      file:\n        path: /code\n        state: directory\n        owner: www\n        group: www\n        mode: \"0755\"\n        recurse: yes    \n    - name: unarchive phpmyadmin   #è§£å‹phpmyadmin\n      unarchive: \n        src: ./files/phpMyAdmin-5.2.2-all-languages.zip\n        dest: /code/\n        owner: www\n        group: www\n        creates: /code/phpMyAdmin-5.2.2-all-languages/config.inc.php        \n    - name: create link  #åˆ›å»ºè½¯è¿æ¥\n      file: \n        src: /code/phpMyAdmin-5.2.2-all-languages/\n        dest: /code/phpmyadmin \n        state: link\n    - name: change phpmyadmin configure \n      copy:\n        src: ./files/config.inc.php\n        dest: /code/phpMyAdmin-5.2.2-all-languages/config.inc.php  \n          \n        \n  handlers: \n    - name: restart nginx\n      systemd:\n        name: nginx\n        state: restarted\n    - name: restart php\n      systemd:\n        name: php-fpm\n        state: restarted\n\n```\n\nï¼ˆ5ï¼‰å®‰è£…å¹¶æµ‹è¯•\n\n```shell\nansible-playbook --syntax-check nginx-php.yml\nansible-playbook -C nginx-php.yml\nansible-playbook nginx-php.yml\n```\n\nï¼ˆ6ï¼‰åœ¨æœ¬æœºç”µè„‘`C:\\Windows\\System32\\drivers\\etc\\hosts`é…ç½®hosts\n\n```shell\n#åˆ†åˆ«é…ç½®121ï¼Œ122çš„hostsè¿›è¡Œè®¿é—®æµ‹è¯•\n192.168.1.121 ansible.phpmyadmin.local\n192.168.1.122 ansible.phpmyadmin.local\n```\n\nï¼ˆ7ï¼‰æµè§ˆå™¨è®¿é—®`ansible.phpmyadmin.local`ï¼Œç”¨æˆ·å¯†ç æ˜¯å®‰è£…Mariadbæ•°æ®åº“æ—¶ï¼Œåˆ›å»ºçš„ç”¨æˆ·`php_user`åŠå…¶å¯†ç `123456`ã€‚\n\n![image-20250411224722322](AnsibleçŸ¥è¯†æ¢³ç†/3.png)\n\n![image-20250411224810891](AnsibleçŸ¥è¯†æ¢³ç†/4.png)\n\n###### è´Ÿè½½å‡è¡¡æ–¹å¼ä¸€ï¼šnginx\n\nï¼ˆ1ï¼‰å¤åˆ¶nginxçš„é…ç½®æ–‡ä»¶`nginx.conf`ï¼Œè‡³`/data/phpmyadmin/files`ç›®å½•ä¸‹å¹¶å‘½åä¸º`nginx.conf.lb`\n\n```shell\ncp /etc/nginx.conf /data/phpmyadmin/files/nginx.conf.lb\n```\n\nï¼ˆ2ï¼‰åœ¨`/data/phpmyadmin/files`ç›®å½•ä¸‹åˆ›å»ºé…ç½®æ–‡ä»¶`proxy.conf`ï¼Œç”¨ä½œè´Ÿè½½å‡è¡¡\n\n```shell\nvi proxy.conf\n\nupstream ansible {\n    server 192.168.1.121;\n    server 192.168.1.122;\n}\nserver {\n    listen 80;\n    server_name ansible.phpmyadmin.local;\n    location / {\n        proxy_pass http://ansible;\n        proxy_set_header Host $http_host;\n    }\n\n}\n\n```\n\nï¼ˆ3ï¼‰åˆ›å»ºlb-nginxå‰§æœ¬\n\n```yaml\nvi lb-nginx.yml\n\n- hosts: lbservers\n  tasks:\n    - name: download nginx\n      yum:\n        name: nginx\n        state: present\n    - name: configure nginx\n      copy:\n        src: ./files/nginx.conf.lb\n        dest: /etc/nginx/nginx.conf\n      notify: restart nginx\n    - name: copy nginx conf\n      copy:\n        src: ./files/proxy.conf\n        dest: /etc/nginx/conf.d/proxy.conf\n      notify: restart nginx\n    - name: start nginx\n      systemd:\n        name: nginx\n        state: started\n        enabled: yes\n  handlers:\n    - name: restart nginx\n      systemd:\n        name: nginx\n        state: restarted\n```\n\nï¼ˆ4ï¼‰å®‰è£…å¹¶æµ‹è¯•\n\n```shell\nansible-playbook --syntax-check lb-nginx.yml\nansible-playbook -C lb-nginx.yml\nansible-playbook lb-nginx.yml\n```\n\nï¼ˆ5ï¼‰åœ¨æœ¬æœºç”µè„‘`C:\\Windows\\System32\\drivers\\etc\\hosts`é…ç½®hosts\n\n```shell\n192.168.1.123 ansible.phpmyadmin.local\n192.168.1.124 ansible.phpmyadmin.local\n```\n\nï¼ˆ6ï¼‰æµè§ˆå™¨è®¿é—®`ansible.phpmyadmin.local`,å¹¶è§‚å¯Ÿ`æ•°æ®åº“æœåŠ¡å™¨`-`ç”¨æˆ·`ï¼Œåˆ·æ–°æŸ¥çœ‹ç”¨æˆ·æ˜¯å¦ä¸º121ä¸122åˆ‡æ¢æ˜¾ç¤ºã€‚\n\n###### è´Ÿè½½å‡è¡¡æ–¹å¼äºŒï¼šhaproxy\n\nï¼ˆ1ï¼‰è®¾ç½®haproxyä¸‹è½½æº\n\n```shell\nrpm -Uvh https://repo.ius.io/ius-release-el7.rpm\n```\n\nï¼ˆ2ï¼‰å°†`/etc/haproxy/haproxy.cfg`ï¼Œè‡³`/data/phpmyadmin/files`ç›®å½•ä¸‹\n\n```shell\ncp /etc/haproxy/haproxy.cfg /data/phpmyadmin/files\n```\n\n> å¯å…ˆåœ¨ä»»æ„ä¸€å°æœåŠ¡å™¨å®‰è£…haproxyï¼Œè·å–/etc/haproxy/haproxy.cfgæ–‡ä»¶\n\nï¼ˆ3ï¼‰ä¿®æ”¹`haproxy.cfg`é…ç½®æ–‡ä»¶ï¼Œæ–°å¢ä»¥ä¸‹å†…å®¹ã€‚\n\n```\nfrontend web\n                bind *:8080\n                mode http\n                acl ansible_domain hdr_reg(host) -i ansible.phpmyadmin.local\n                use_backend ansible_cluster if ansible_domain\nbackend ansible_cluster\n                balance roundrobin\n                option httpchk HEAD / HTTP/1.1\\r\\nHost:\\ ansible.phpmyadmin.local\n                server server1 192.168.1.121:80 check port 80 inter 3s rise 2 fall 3\n                server server2 192.168.1.122:80 check port 80 inter 3s rise 2 fall 3\n\n```\n\nï¼ˆ4ï¼‰åˆ›å»ºlb-haproxyå‰§æœ¬\n\n```yaml\nvi lb-haproxy.yml\n\n- hosts: lbservers\n  tasks:\n    - name: download haproxy\n      yum:\n        name: haproxy22\n        state: present\n    - name: configure haproxy\n      copy:\n        src: ./files/haproxy.cfg\n        dest: /etc/haproxy/haproxy.cfg\n        owner: root\n        group: root\n        mode: 0644\n      notify: restart haproxy  \n    - name: start haproxy\n      systemd:\n        name: haproxy\n        state: started        \n        enabled: yes\n  handlers: \n    - name: restart haproxy\n      systemd:\n        name: haproxy\n        state: restarted\n```\n\nï¼ˆ5ï¼‰å®‰è£…å¹¶æµ‹è¯•\n\n```shell\nansible-playbook --syntax-check lb-haproxy.yml\nansible-playbook -C lb-haproxy.yml\nansible-playbook lb-haproxy.yml\n```\n\nï¼ˆ5ï¼‰åœ¨æœ¬æœºç”µè„‘`C:\\Windows\\System32\\drivers\\etc\\hosts`é…ç½®hosts\n\n```shell\n192.168.1.123 ansible.phpmyadmin.local\n192.168.1.124 ansible.phpmyadmin.local\n```\n\nï¼ˆ6ï¼‰æµè§ˆå™¨è®¿é—®`ansible.phpmyadmin.local:8080`,å¹¶è§‚å¯Ÿ`æ•°æ®åº“æœåŠ¡å™¨`-`ç”¨æˆ·`ï¼Œåˆ·æ–°æŸ¥çœ‹ç”¨æˆ·æ˜¯å¦ä¸º121ä¸122åˆ‡æ¢æ˜¾ç¤ºã€‚\n\n\n\n> æœ¬ç¯‡çŸ¥è¯†æ¥æºäºBç«™è§†é¢‘BV11JZcYwEDd\n\n","tags":["çŸ¥è¯†æ¢³ç†","CI/CD","è‡ªåŠ¨åŒ–è¿ç»´","Ansible","Linuxè¿ç»´"],"categories":["è‡ªåŠ¨åŒ–è¿ç»´","æ¢³ç†æ€»ç»“","Ansible","çŸ¥è¯†æ¢³ç†"]},{"title":"Hexo-Butterflyç¾åŒ–æ•™ç¨‹-[2]Butterflyä¸»é¢˜å®‰è£…","url":"/yyg/80ffa402/","content":"\n## æ‹‰å–ä¸»é¢˜ä»£ç \n\n```shell\ngit clone -b master https://github.com/jerryc127/hexo-theme-butterfly.git themes/butterfly\n```\n\n## é…ç½®ä¸»é¢˜åº”ç”¨\n\nå°†`blog`æ ¹ç›®å½•ä¸‹çš„`_config.yml`æ–‡ä»¶ä¸­çš„ä¸»é¢˜é…ç½®ç”±`landscape`æ”¹ä¸º`butterfly`ã€‚\n\n```yaml\ntheme: butterfly\n```\n\nå°†`blog\\themes\\butterfly`ç›®å½•ä¸‹çš„`_config.yml`æ–‡ä»¶å¤åˆ¶ä¸€ä»½åˆ°`blog`æ ¹ç›®å½•ä¸‹ï¼Œå¹¶å°†å¤åˆ¶çš„æ–‡ä»¶æ”¹åä¸º`_config.butterfly.yml`ã€‚\n\n## å®‰è£…æ’ä»¶\n\n```shell\nnpm install hexo-renderer-pug hexo-renderer-stylus --save\n```\n\n## æµ‹è¯•éªŒè¯\n\n```\n#æœ¬åœ°æµ‹è¯•\nhexo clean && hexo g && hexo s\n```\n\nåœ¨æµè§ˆå™¨ä¸­è®¿é—® `http://localhost:4000/` ï¼ŒæŸ¥çœ‹Butterflyä¸»é¢˜å®‰è£…æ˜¯å¦æˆåŠŸã€‚\n\n{% folding green open,åšå®¢æ­å»ºç³»åˆ—æ–‡ç«  %}\n\n{% series åšå®¢æ­å»ºæ•™ç¨‹ %}\n\n{% endfolding %}","tags":["Hexo","åšå®¢æ•™ç¨‹","Butterfly"],"categories":["åšå®¢æ•™ç¨‹","åšå®¢æ­å»º"]},{"title":"è·¨åŸæ¬å®¶æ€»ç»“","url":"/yyg/4c3a1bc3/","content":"\n## å†™åœ¨å‰é¢\n\nã€€ã€€ä»Šå¤©ç»ˆäºå½»åº•å®Œæˆäº†ä»AåŸåˆ°BåŸçš„è·¨åŸæ¬å®¶ï¼Œå¼€å§‹åœ¨BåŸå¼€å¯ç”Ÿæ´»çš„æ–°ç¯‡ç« ã€‚\n\n## æ¬å®¶å…¨è¿‡ç¨‹\n\nã€€ã€€å¹´åä»è€å®¶å›åˆ°AåŸä¹‹åï¼Œå¼€å§‹æ­£å¼ç€æ‰‹è€ƒè™‘æ¬åˆ°BåŸçš„äº‹æƒ…ï¼Œæ­¤æ—¶ç¦»æˆ¿ç§Ÿåˆ°æœŸè¿˜æœ‰åŠä¸ªå¤šæœˆçš„æ—¶é—´ã€‚\n\n### æ‰¾æˆ¿å’Œçœ‹æˆ¿\n\nã€€ã€€é¦–å…ˆï¼Œç¡®å®šç§Ÿæˆ¿çš„éœ€æ±‚ï¼ŒåŒ…å«ç§Ÿæˆ¿è´¹ç”¨ï¼ˆæˆ¿ç§Ÿé¢„ç®—ä»·ä½ã€æŠ¼é‡‘åŠé€€è¿˜çš„è¦æ±‚ã€æ°´ç”µã€å¤©ç„¶æ°”ã€ç‰©ä¸šè´¹ã€ç½‘è´¹ã€æ˜¯å¦æœ‰çœ‹æˆ¿è´¹ã€ä¸­ä»‹è´¹ç­‰å…¶ä»–è´¹ç”¨ï¼‰ï¼›æˆ¿å­çš„åŸºæœ¬æ¡ä»¶ï¼ˆé‡‡å…‰ã€å¤§å°ã€å®¶å…·ã€ç©ºè°ƒã€é˜³å°ã€æš–æ°”ã€æ— çº¿ç½‘ã€ç¯å¢ƒæ˜¯å¦å®‰é™ï¼‰ï¼Œå…¶ä¸­æˆ¿å­çš„è¿™äº›åŸºæœ¬æ¡ä»¶åˆåˆ†ä¸ºåˆšéœ€å’ŒäºŒçº§éœ€æ±‚ï¼Œæ¯•ç«Ÿè¦å®Œå…¨æ»¡è¶³æ¡ä»¶çš„å°‘ä¹‹åˆå°‘ï¼Œå…ˆè€ƒè™‘æ»¡è¶³åˆšéœ€çš„æƒ…å†µä¸‹ï¼Œå†çœ‹æ˜¯å¦åˆç¬¦åˆäºŒçº§éœ€æ±‚çš„ï¼›é™„è¿‘ç”Ÿæ´»è®¾æ–½ï¼ˆè¶…å¸‚ã€èœå¸‚åœºã€ç†å‘åº—ã€å…¬å›­ã€å…¬äº¤ã€åœ°é“è·ç¦»ç­‰ï¼‰ã€‚\n\nã€€ã€€äº†è§£BåŸå¸‚çš„æ°´ã€ç”µã€å¤©ç„¶æ°”çš„ä»·æ ¼ï¼Œæ–¹ä¾¿ä¹‹åæ‰¾æˆ¿æ—¶è¿›è¡Œè¯„ä¼°å’Œè°ˆåˆ¤ã€‚\n\nã€€ã€€å‰æœŸå·¥ä½œå®Œæˆåï¼Œå¼€å§‹è¿›è¡Œç½‘ä¸Šæ‰¾æˆ¿ã€‚åœ¨å„å¤§ç§Ÿæˆ¿appä¸Šï¼Œä¼˜å…ˆæ‰¾æˆ¿ä¸œç›´ç§Ÿ/ä¸ªäººæˆ¿æºï¼ˆä¸»æµçŸ­è§†é¢‘å¹³å°å’Œé—®ç­”ç¤¾åŒºéƒ½æœ‰ç›¸å…³æ•™ç¨‹ï¼‰ï¼Œå‰æœŸå¯èƒ½ä¼šéº»çƒ¦ä¸€ç‚¹ï¼Œä½†å¯ä»¥çœä¸‹ä¸€ç¬”ä¸­ä»‹è´¹ï¼Œä¹Ÿèƒ½é¿å…ä¸€äº›ä¸å¿…è¦çš„éº»çƒ¦ã€‚\n\nã€€ã€€æˆ‘èŠ±è´¹5å¤©æ—¶é—´ï¼Œæ‰¾äº†6å¥—å¾…çœ‹æˆ¿ã€‚å¹¶æ ¹æ®éœ€æ±‚ç¡®å®šäº†å¾…çœ‹çš„ä¼˜å…ˆçº§ï¼Œå…ˆçœ‹ç¦»è½¦ç«™æœ€è¿‘çš„ï¼ˆç›®çš„æ˜¯é™ä½å®¢è§‚å› ç´ å½±å“çš„é™åº¦ã€æ›´å¥½çš„ç•™ä½ç²¾åŠ›ï¼‰ï¼Œç„¶åçœ‹ä¼˜å…ˆçº§é«˜çš„ã€‚çœ‹çš„æ—¶å€™ï¼Œé™¤äº†è¦æ»¡è¶³ä¹‹å‰çš„éœ€æ±‚ã€è¿˜è¦çœ‹ä¸‹æˆ¿é—´å†…è®¾æ–½çš„å¥½åï¼Œå¦‚é—¨é”ã€ç©ºè°ƒã€çª—å£ã€åºŠã€æ¡Œæ¤…ã€æŸœå­ã€å¦‚ä½•æ™¾æ™’è¡£æœå’Œé‹å­ï¼Œé‡ç‚¹å…³æ³¨å‘¨å›´ç¯å¢ƒå™ªéŸ³ç¨‹åº¦æ˜¯å¦åœ¨æ¥å—èŒƒå›´å†…ã€‚\n\nã€€ã€€çœ‹å®Œæˆ¿åï¼Œå†å»é™„è¿‘æŸ¥çœ‹ç”Ÿæ´»è®¾æ–½æ˜¯å¦é½å…¨ã€‚\n\nã€€ã€€å…¨éƒ¨çœ‹å®Œåï¼Œè¿›è¡Œç»¼åˆå¯¹æ¯”ï¼Œç¡®å®šç§Ÿæˆ¿ï¼Œå¹¶å’Œæˆ¿ä¸œçº¦å®šå…¥ä½å’Œç­¾åˆåŒæ—¶é—´ï¼Œæ²Ÿé€šå¥½æ‰€æœ‰è´¹ç”¨å¹¶åšå¥½ç•™è¯ã€‚\n\n> æˆ‘2å¤©æ—¶é—´çœ‹å®Œäº†6å¥—ï¼Œæœ€åç¡®å®šçš„ä¸‹æ¥çš„æ˜¯åœ¨ç¬¬ä¸€å¤©çœ‹çš„ã€‚å…¶å®ï¼Œç¬¬ä¸€å¤©çœ‹å®Œä¹‹åï¼Œå¿ƒé‡ŒåŸºæœ¬ä¸Šå°±æœ‰äº†å¤§è‡´çš„é€‰æ‹©ã€‚å¦‚æœæ—¶é—´ä¸Šè¾ƒä¸ºç´§å¼ ï¼Œç›´æ¥åœ¨ç¬¬ä¸€å¤©å†…çœ‹3-4å¥—ï¼Œç„¶ååœ¨å…¶ä¸­è¿›è¡Œé€‰æ‹©å³å¯ï¼ˆå‰ææ˜¯æŒ‰ä¹‹å‰ç¡®å®šå¥½çš„ä¼˜å…ˆçº§è¿›è¡Œçš„ï¼‰ã€‚\n\n### è¡Œææ‰“åŒ…\n\nã€€ã€€ç¡®å®šè¡Œææ‰“åŒ…å’Œè¿è¾“æ–¹å¼å‰ï¼Œå…ˆè¦ç¡®å®šå¥½å‡†å¤‡èˆå¼ƒçš„ç‰©å“ã€å¦‚æœè¾ƒå¤šçš„è¯å¯åˆ—ä¸€ä¸ªæ¸…å•ï¼Œå¹¶åšå¥½åˆ†ç±»å’Œå¤„ç†è®¡åˆ’ã€‚è¾ƒå¥½çš„è¡£æœã€é‹å­å¯é€‰æ‹©æèµ æˆ–è€…é€‰æ‹©ä¸Šé—¨å›æ”¶ã€‚\n\nã€€ã€€æˆ‘é€‰æ‹©çš„è¡Œææ‰“åŒ…æ–¹å¼æ˜¯å°†è¡£ç‰©ã€è¢«è¤¥å’Œæ—¥ç”¨å“ç­‰é€šè¿‡ç‰©æµæ–¹å¼é‚®å¯„BåŸå¸‚çš„æ–°ä½å€ï¼Œè‡ªå·±å†æºå¸¦ä¸€ä¸ªè¢«è¤¥å’Œç”µå­è®¾å¤‡è¿›è¡Œæ¬å®¶ã€‚å› ä¸ºæˆ‘çš„è¡Œæè¾ƒå°‘ï¼Œè‡ªå·±æºå¸¦æ—¶ä¹Ÿå¾ˆæ–¹ä¾¿ã€‚æºå¸¦è¢«è¤¥å¯ä»¥åœ¨ç‰©æµæœªåˆ°ä¹‹æ—¶ï¼Œä¹Ÿèƒ½ä½è¿›æ–°å®¶ï¼Œéšèº«æºå¸¦ç”µå­è®¾å¤‡ï¼Œä¹Ÿèƒ½é¿å…ç‰©æµé€”ä¸­æŸæ¯ã€‚\n\nã€€ã€€ç¡®å®šå¥½æ‰“åŒ…æ–¹å¼åï¼Œäº†è§£è·¨åŸæ¬å®¶è¦åšçš„å‡†å¤‡å·¥ä½œï¼Œè´­ä¹°æ‰“åŒ…å·¥å…·å’Œç¡®å®šä½¿ç”¨çš„ç‰©æµå•†å®¶ã€‚æˆ‘è¿™æ¬¡å‡†å¤‡çš„æ‰“åŒ…å·¥å…·æœ‰çº¸ç®±ï¼ˆ60x40x50ï¼Œæ‰“åŒ…æ—¶è¦ä¿è¯æ¯ä¸€ä¸ªç®±å­è‡³å°‘è¦è£…20kgï¼‰ã€å·¥ä¸špeè†œã€çœŸç©ºå‹ç¼©è¢‹ã€å®½èƒ¶å¸¦ã€‚\n\n> è¿™æ¬¡å·¥ä¸špeè†œå·®ç‚¹ä¸å¤Ÿç”¨äº†ï¼Œä¸‹æ¬¡å†å¤šä¹°ç‚¹ã€‚ä¹Ÿå¯è€ƒè™‘ä¹°äº›çƒ­ç¼©è†œã€‚\n\nã€€ã€€åœ¨ç½‘ä¸Šæ‰¾æˆ¿çš„æœŸé—´ï¼Œæˆ‘è¿›è¡Œäº†ä¸€æ¬¡æ¨¡æ‹Ÿæ‰“åŒ…ï¼Œé€šè¿‡æ¨¡æ‹Ÿæ‰“åŒ…å’Œå¯ä»¥ç¡®å®šä¸¤ä»¶äº‹ï¼š\n\nã€€ã€€ã€€ä¸€æ˜¯é€šè¿‡ç‰©æµæ–¹å¼è¿è¾“è¡Œæçš„å¤§è‡´é‡é‡ï¼Œæ–¹ä¾¿é€‰å–ç‰©æµæ—¶è¿›è¡Œå¯¹æ¯”åˆ†æã€‚\n\nã€€ã€€ã€€äºŒæ˜¯æ‰“åŒ…æ‰€éœ€çš„å¤§è‡´æ—¶é—´ï¼Œå¯æ›´å¥½çš„è§„åˆ’è¡Œç¨‹ã€‚\n\nã€€ã€€é€šè¿‡æ¨¡æ‹Ÿæ‰“åŒ…åï¼Œåœ¨è¿›è¡Œåå®é™…æ‰“åŒ…æ—¶ï¼Œä¹Ÿç›¸å¯¹è½»æ¾äº›ï¼Œæ—¶é—´ä¸Šä¹Ÿæ¯”ä¹‹å‰æ›´å¿«äº†ä¸€äº›ã€‚\n\nã€€ã€€ç¡®å®šå¥½ç§Ÿæˆ¿åï¼Œå…ˆè·Ÿæˆ¿ä¸œè¦æˆ¿å­çš„å¿«é€’åœ°å€ï¼Œä¹‹ååœ¨æ ¹æ®AåŸå¸‚å’ŒBåŸå¸‚çš„åœ°å€å’Œæ‰“åŒ…è¡Œæçš„é‡é‡é€‰å–æ€§ä»·æ¯”è¾ƒé«˜çš„ç‰©æµï¼Œï¼ˆé€‰å–ç‰©æµæ—¶æ³¨æ„ç±»å‹å’Œé‡è´§ä¸Šæ¥¼æ˜¯å¦æ”¶è´¹ï¼‰ã€‚\n\nã€€ã€€æ‰“åŒ…å¥½è¡Œæåï¼Œä¸‹å•ç­‰å¾…ç‰©æµäººå‘˜ä¸Šé—¨æ”¶è´§å³å¯ã€‚\n\n> ä½¿ç”¨60x40x50çš„çº¸ç®±è£…è¡Œææ—¶ï¼Œè‹¥é‡é‡ï¼œ20kgï¼Œä½¿ç”¨ä½“ç§¯è®¡ç®—ï¼Œè¡Œæå®é™…é‡é‡ï¼œè®¡ç®—é‡é‡ï¼Œå³è¡Œæå®é™…é‡é‡ï¼œ20kgï¼Œè®¡ç®—é‡é‡å´ä¸º20kgï¼›è‹¥é‡é‡â‰¥20kgï¼Œä½¿ç”¨é‡é‡è®¡ç®—ï¼Œåˆ™è¡Œæå®é™…é‡é‡=è®¡ç®—é‡é‡ï¼Œå‡â‰¥20kgã€‚æ‰€ä»¥ä½¿ç”¨60x40x50çš„çº¸ç®±ï¼Œè¦è£…è‡³å°‘20kgçš„è¡Œæï¼Œæ‰ä¸ä¼šåœ¨è¡Œæé‡é‡ä¸Šè®©ç‰©æµå…¬å¸æœ‰æœºå¯ä¹˜\n> \n> ä¸åŒç‰©æµå…¬å¸é‚®å¯„è¡Œææ—¶çº¸ç®±ï¼ˆ60x40x50ï¼‰ä½“ç§¯ä¸é‡é‡æ¢ç®—æ¯”ä¸åŒï¼Œåˆ†åˆ«æœ‰6000ã€8000ä¸¤ç§ï¼š\n> \n> æ¨¡å¼ä¸€ï¼š60x40x50Ã·6000=20kgï¼ˆæˆ‘æœ¬æ¬¡ä½¿ç”¨çš„ï¼‰\n> \n> æ¨¡å¼äºŒï¼š60x40x50Ã·8000=15kg\n\nã€€ã€€å‰©ä½™è¡Œæå¯åœ¨å‡ºå‘å»BåŸå¸‚å½“å¤©æ‰“åŒ…ï¼Œå¹¶å°†å‡†å¤‡èˆå¼ƒçš„ç‰©å“å¤„ç†å®Œã€‚\n\nã€€ã€€åœ¨å‡ºå‘å»BåŸå¸‚å‰ï¼Œå¿…é¡»å’ŒAåŸå¸‚æˆ¿ä¸œå°†æŠ¼é‡‘é€€è¿˜æ—¥æœŸä¸è¦æ±‚åå•†å¥½ï¼Œå½»åº•ç»“æ¸…AåŸç§Ÿæˆ¿çš„äº‹æƒ…ã€‚\n\n### æ¬æ–°å®¶ã€è§„åˆ’å¹¶å®Œæˆå¸ƒå±€\n\nã€€ã€€åˆ°BåŸå¸‚æ–°ä½å€åï¼Œå…ˆè®°å½•ä¸‹æˆ¿é—´ä¹‹å†…æ‰€æœ‰ç‰©å“çš„åŸå§‹é¢è²Œï¼Œå†å’ŒBåŸå¸‚æˆ¿ä¸œåå•†å¥½æˆ¿é—´çš„å®¶å…·åŠæ³¨æ„äº‹é¡¹ï¼Œæœ€åç¡®å®šåˆåŒå†…å®¹ï¼ŒæœŸé—´æåˆ°çš„æ‰€æœ‰éœ€æ±‚å’Œæ³¨æ„äº‹é¡¹è¦ç•™è¯ã€‚\n\nã€€ã€€å¸ƒç½®æˆ¿é—´æ—¶ï¼Œå…ˆæ ¹æ®æˆ¿é—´è§„æ ¼å’Œè‡ªå·±çš„å–œå¥½ï¼Œé‡æ–°è§„åˆ’å¸ƒå±€ï¼Œå¸ƒç½®å®¶å…·ã€‚ç»“æŸåï¼Œå†æ ¹æ®éœ€è¦è¿›è¡Œç‰©å“çš„æ·»ç½®ã€‚\n\n> ä»æ¬å…¥æ–°å®¶åˆ°å½»åº•å®Œæˆæˆ¿é—´é‡æ–°å¸ƒå±€ï¼Œæˆ‘æ€»è®¡ç”¨äº†2å¤©æ—¶é—´ã€‚ä¹Ÿæ­£å¼å¼€å§‹åœ¨BåŸå¼€å¯ç”Ÿæ´»çš„æ–°ç¯‡ç« ã€‚\n\n## æ„Ÿå—æ€»ç»“\n\nã€€ã€€ç¬¬ä¸€æ¬¡è·¨åŸæ¬å®¶ï¼Œæ€»ä½“æ„Ÿå—è¿˜ä¸é”™ï¼Œæ²¡æœ‰åˆšæ¯•ä¸šæ‰¾æˆ¿æ—¶çš„é‚£ç§æ…Œä¹±äº†ï¼Œå…¨è¿‡ç¨‹çš„èŠ‚å¥ï¼Œä¹ŸæŠŠæ¡çš„é¡ºç•…äº†ä¸€äº›ã€‚\n\nã€€ã€€è™½ç„¶å›çœ‹æœ¬æ¬¡æ¬å®¶çš„å…¨è¿‡ç¨‹ï¼Œç›¸å¯¹æ²¡é¢„æƒ³çš„é‚£ä¹ˆéº»çƒ¦ï¼Œè¿™å¾—ç›Šäºæ¯ä¸€å¤§æ­¥çš„å‡†å¤‡å·¥ä½œåšçš„è¿˜ç®—æ˜æ™°ã€‚\n\nã€€ã€€ä»æ¬å®¶å¼€å§‹åˆ°å®Œå…¨ç»“æŸï¼Œæ•´ä½“èŠ±è´¹ç®—ä¸‹æ¥å·²ç»èµ¶ä¸Šç°åœ¨æˆ¿å­çš„æˆ¿ç§Ÿäº†ğŸ˜‚ï¼Œä¸è¿‡ï¼Œå‡¡äº‹éƒ½æœ‰ç¬¬ä¸€æ¬¡å˜›ï¼Œè¿™æ¬¡è¿›è¡Œå¤ç›˜æ€»ç»“ä¸‹æˆ‘çš„â€œç›´æ¥ç»éªŒâ€ï¼Œä¸‹æ¬¡è‚¯å®šå¯ä»¥åšçš„æ›´å¥½ğŸ˜ã€‚\n\nã€€ã€€åŠ æ²¹å§ï¼ï¼ï¼ä¸çœ‹åˆ°æœ¬æ–‡çš„è¯¸ä½å…±å‹‰ã€‚","tags":["å¤ç›˜","ä¹”è¿æ–°å±…","è·¨åŸæ¬å®¶"],"categories":["æ¼«è°ˆ","æ¬å®¶"]},{"title":"ä¼‘é—²å¨±ä¹-1æœˆ","url":"/yyg/64b9e8e0/","content":"\n## ç™»å±±-åµ©å±±\n\nâ€‹    å‰ä¸¤å¤©ï¼Œå»äº†ç™»å°çˆ¬äº†åµ©å±±ï¼Œåœ¨ç™»å°ä¸¤å¤©çš„æ€»ä½“æ„Ÿè§‰è¿˜ä¸é”™ã€‚\n\n### äººæ–‡é£æƒ…\n\nâ€‹    ä¹‹å‰åšæ”»ç•¥çœ‹åˆ°ç™»å°çš„ç‚’åˆ€å‰Šä¸é”™ã€‚ç‰¹åœ°å»å°äº†å°ï¼Œåœ°å€æ˜¯ç™»å°æ±½è½¦å®¢è¿æ€»ç«™æ—çš„å°åº—ï¼Œä¸ªäººè§‰å¾—å‘³é“ä¸é”™ï¼Œåˆ†é‡è¶³ï¼Œä»·æ ¼é€‚ä¸­ã€‚\n\nâ€‹    ç™»å°äººæ°‘ä¹Ÿå¾ˆçƒ­æƒ…ï¼Œæ‰¾æ°‘å®¿æ—¶ï¼Œé‡åˆ°çš„è€æ¿éƒ½å¾ˆçƒ­å¿ƒï¼Œä¹Ÿéƒ½å¾ˆè€å¿ƒçš„è§£ç­”ä½å®¿éœ€æ±‚ã€‚\n\nâ€‹    ç™»å°å‘å±•èŠ‚å¥èˆ’ç¼“ï¼ŒåŸå¸‚å…¬å…±äº¤é€šä»¥å…¬äº¤ä¸ºä¸»ï¼Œå¹¶ä¸”å…¬äº¤çš„ç­æ¬¡ä¹‹é—´æ—¶é—´å¤§éƒ½åœ¨30åˆ†é’Ÿä»¥ä¸Šï¼Œå‡ºç§Ÿè½¦å¾ˆå¤šã€‚\n\n### ç™»å±±\n\nâ€‹    è¿™æ¬¡å»åµ©å±±çˆ¬çš„æ˜¯å¤ªå®¤å±±ï¼Œå»å¹´å»äº†å°‘å®¤å±±ã€‚\n\nâ€‹    çˆ¬å¤ªå®¤å±±é€‰æ‹©çš„ä¸Šå±±è·¯çº¿æ˜¯åµ©é˜³ä¹¦é™¢--å³»æå³°ï¼Œè¿™æ¬¡ä¸åŒäºçˆ¬æ³°å±±æ—¶çš„â€œç‰¹çºµå…µå¼â€çˆ¬æ³•ï¼Œèµ°èµ°åœåœï¼Œæ€»è·¯ç¨‹6.2å…¬é‡Œï¼Œç”¨æ—¶3å°æ—¶ã€‚æ²¿é€”æœ‰å¾ˆå¤šè¡¥ç»™ç‚¹ï¼Œå†¬å¤©é£æ™¯ä¸€èˆ¬ã€‚ä¸‹å±±è·¯çº¿æ˜¯å³»æå³°--å¢å´–ç€‘å¸ƒï¼Œè¿™æ¡è·¯çº¿æ˜¯å¤ªå®¤å±±3æ¡è·¯çº¿ä¸­æœ€é•¿çš„ï¼Œä¹Ÿæ˜¯æœ€é™©å³»çš„ã€‚è·¯ä¸Šä¼šæ—¶ä¸æ—¶çš„ç¢°è§å‡ åªå°çŒ«ï¼Œä¸€çº¿å¤©å°é˜¶å¾ˆé™¡ï¼Œè¿˜æœ‰ä¸¤åº§åŠæ¡¥ï¼Œè¿™æ¡è·¯å±±è„šæœ‰æ»‘é›ªåœºï¼Œäººå¾ˆå¤šã€‚æ€»è·¯ç¨‹9.7å…¬é‡Œï¼Œç”¨æ—¶2ä¸ªåŠå°æ—¶ã€‚\n\nâ€‹    ç™»å±±ä¹‹åéœ€è¦åŠæ—¶è¿›è¡Œè‚Œè‚‰æ‹‰ä¼¸æ¢å¤ï¼Œä¸ç„¶ä¼šå‡ºç°è…¿éƒ¨è‚Œè‚‰é…¸èƒ€çš„æƒ…å†µã€‚æˆ‘è¿™æ¬¡å°±æ˜¯æ²¡æœ‰è¿›è¡ŒåŠæ—¶çš„æ‹‰ä¼¸ï¼Œå¯¼è‡´çˆ¬åçš„ç¬¬äºŒå¤©ï¼Œå¤§è…¿å¤–ä¾§è‚Œè‚‰å’Œå°è…¿å†…ä¾§è‚Œè‚‰é…¸ç–¼ã€‚\n\n<mark>ç™»å±±ä¹‹åçš„å½“å¤©æ™šä¸Šåšè‚Œè‚‰æ‹‰ä¼¸ã€æ³¡è„šã€æ´—çƒ­æ°´æ¾¡ï¼Œå¯¹ç¼“è§£è‚Œè‚‰é…¸èƒ€å’Œæ¢å¤å¾ˆæœ‰å¸®åŠ©ã€‚</mark>\n","tags":["æ—…æ¸¸","çˆ¬å±±","ä¼‘é—²å¨±ä¹"],"categories":["æ¼«è°ˆ","ä¼‘é—²å¨±ä¹"]},{"title":"dockeréƒ¨ç½²SonarQube","url":"/yyg/12643dd2/","content":"## å‰è¨€\n\n{% folding cyan,ğŸ”œä»€ä¹ˆæ˜¯SonarQubeï¼ŸğŸ”š %}\n\n>  SonarQubeæ˜¯ä¸€ä¸ªå¼€æºçš„ä»£ç è´¨é‡ç®¡ç†å¹³å°ï¼Œé€šè¿‡ä¸€ç³»åˆ—çš„è§„åˆ™åº“å¯¹ä»£ç çš„æ‰«ææ£€æŸ¥ï¼Œæå‡ä»£ç çš„è´¨é‡ã€‚\n>\n> è¿è¡Œ SonarQube æœåŠ¡å™¨åˆ†æéœ€è¦ä¸‰ä¸ªç»„ä»¶ï¼šSonarQube Serverã€å­˜å‚¨æ•°æ®åº“ï¼ˆæœ¬æ–‡ä¸­ä½¿ç”¨PostgreSQLï¼‰ã€ scannersæ‰«æç¨‹åºã€‚\n>\n> å…¶ä¸­UIä¸º<mark>SonarQube Server </mark>ï¼šè´Ÿè´£æä¾›Webç•Œé¢ã€å¤„ç†ä»£ç åˆ†ææŠ¥å‘Šå¹¶å°†å…¶ä¿å­˜åœ¨ å­˜å‚¨æ•°æ®åº“ä¸­çš„è®¡ç®—å¼•æ“ï¼ˆSonarQube Server ä¸­è¿˜é›†æˆæœ‰Elasticsearchï¼‰ã€‚\n>\n> <mark>å­˜å‚¨æ•°æ®åº“ </mark>ï¼šSonarQube Serverçš„é…ç½®ï¼›ä»£ç æ‰«ææœŸé—´ç”Ÿæˆçš„ä»£ç è´¨é‡å’Œå®‰å…¨æ€§æŒ‡æ ‡å’Œé—®é¢˜ã€‚\n>\n> Â <mark>scannersæ‰«æç¨‹åº</mark>ï¼šç”¨äºåˆ†æé¡¹ç›®ï¼Œæ ¹æ®è¯­è¨€æœ‰æ‰€ä¸åŒã€‚\n\n{% endfolding %}\n\n## ç¯å¢ƒå‡†å¤‡\n\nï¼ˆ1ï¼‰ä½¿ç”¨è„šæœ¬å®‰è£…dockerã€docker-compose\n\n```shell\nbash <(curl -sSL https://linuxmirrors.cn/docker.sh)\n```\n\nï¼ˆ2ï¼‰é…ç½®é•œåƒåŠ é€Ÿ\n\n```shell\nvi /etc/docker/daemon.json\n\n{\n  \"data-root\": \"/data/dockerData\",\n  \"registry-mirrors\": [\n    \"https://docker.mirrors.sjtug.sjtu.edu.cn\",\n    \"https://docker.mirrors.ustc.edu.cn\",\n    \"https://mirror.iscas.ac.cn\",\n    \"https://docker.rainbond.cc\",\n    \"https://docker.kubesre.xyz\"],\n    \"log-driver\":\"json-file\",\n    \"log-opts\":{\"max-size\" :\"50m\",\"max-file\":\"3\"}\n}\n```\n\nï¼ˆ3ï¼‰å¯åŠ¨dockeræœåŠ¡\n\n```shell\nsystemctl start docker\nsystemctl enable docker\nsystemctl status docker\n```\n\nï¼ˆ4ï¼‰è®¾ç½®è¿›ç¨‹å¯èƒ½å…·æœ‰çš„æœ€å¤§å†…å­˜æ˜ å°„åŒºåŸŸæ•°Â ï¼ˆvm.max\\_map\\_countï¼‰Â å¤§äºæˆ–ç­‰äºÂ 524288ï¼Œæ‰“å¼€çš„æ–‡ä»¶æè¿°ç¬¦çš„æœ€å¤§æ•°é‡Â ï¼ˆfs.file-maxï¼‰Â å¤§äºæˆ–ç­‰äºÂ 131072ã€‚\n\n```shell\necho \"vm.max_map_count=524288\nfs.file-max=131072\" >> /etc/sysctl.conf\nsysctl -p\n```\n\nï¼ˆ5ï¼‰é…ç½®å®‰å…¨ç­–ç•¥\n\n```shell\nfirewall-cmd --add-port=9000/tcp --permanent\nfirewall-cmd --reload\nfirewall-cmd --list-all\n```\n\n## éƒ¨ç½²sonarqube\n\nï¼ˆ1ï¼‰åˆ›å»ºæ‰€éœ€ç›®å½•\n\n```shell\nmkdir -p /data/sonarqube/data /data/sonarqube/extensions /data/sonarqube/logs /data/sonarqube/temp\nchmod -R 777 /data/sonarqube/\nmkdir -p /data/sonarqube/sonarqube-sql /data/sonarqube/sonarqube-sql/data\n```\n\nï¼ˆ2ï¼‰åˆ›å»ºdockerÂ composeæ–‡ä»¶ï¼Œç¼–æ’åˆ›å»ºsonarqubeã€æ•°æ®åº“å®¹å™¨ã€‚\n\n```shell\nvi sonarqube.yml\n*****************************************************\nservices:\n  sonarqube:\n    image: sonarqube:community\n    container_name: sonarqube\n    restart: always\n    volumes:\n      - /data/sonarqube/data:/opt/sonarqube/data\n      - /data/sonarqube/extensions:/opt/sonarqube/extensions\n      - /data/sonarqube/logs:/opt/sonarqube/logs\n      - /data/sonarqube/temp:/opt/sonarqube/temp\n    environment:\n      SONAR_JDBC_URL: jdbc:postgresql://sonarqube-sql:5432/postgres\n      SONAR_JDBC_USERNAME: postgres\n      SONAR_JDBC_PASSWORD: Qwer#1234\n    ports:\n      - \"9000:9000\"\n    depends_on:\n      sonarqube-sql:\n        condition: service_healthy\n    networks:\n      net:\n        ipv4_address: 172.20.112.11\n  sonarqube-sql:\n    image: postgres:15\n    hostname: postgresql\n    container_name: sonarqube-sql\n    restart: always\n    volumes:\n      - /data/sonarqube/sonarqube-sql:/var/lib/postgresql\n      - /data/sonarqube/sonarqube-sql/data:/var/lib/postgresql/data\n    environment:\n      POSTGRES_USER: postgres\n      POSTGRES_DB: postgres\n      POSTGRES_PASSWORD: Qwer#1234\n      TZ: \"Asia/Shanghai\"\n    healthcheck:\n      test: [\"CMD-SHELL\", \"pg_isready\"]\n      interval: 10s\n      timeout: 5s\n      retries: 5\n    networks:\n      net:\n        ipv4_address: 172.20.112.12\n\n\nnetworks:\n net:\n  driver: bridge\n  ipam:\n   config:\n    - subnet: 172.20.112.0/24\n*****************************************************\n\n```\n\nï¼ˆ3ï¼‰æ‰§è¡Œå‘½ä»¤ï¼Œåˆ›å»ºå®¹å™¨\n\n```shell\ndocker compose -f sonarqube.yml up -d\n```\n\n## **éƒ¨ç½²**SonarScanneré›†æˆVUE\n\nï¼ˆ1ï¼‰åœ¨VUEé¡¹ç›®çš„æ ¹ç›®å½•ä¸‹åˆ›å»ºsonar-project.propertiesæ–‡ä»¶ï¼Œå¹¶æ·»åŠ é…ç½®é¡¹\n\n```shell\nvi sonar-project.properties\n*****************************************************\nsonar.projectKey=sonarqubeä¸­åˆ›å»ºçš„é¡¹ç›®åç§°\nsonar.projectName=VUEé¡¹ç›®å\nsonar.projectVersion=VUEé¡¹ç›®ç‰ˆæœ¬\nsonar.sources=.  #VUEé¡¹ç›®æºæ–‡ä»¶çš„ç›®å½•\nsonar.language=vue   #é¡¹ç›®è¯­è¨€\nsonar.sourceEncoding=UTF-8  #é¡¹ç›®ç¼–ç \nsonar.host.url=http://192.168.32.12:9000/ #sonarqubeæœåŠ¡å™¨ç«¯çš„åœ°å€\nsonar.token=sonarqubeä¸­åˆ›å»ºé¡¹ç›®çš„token\n*****************************************************\n#ä¿®æ”¹æ–‡ä»¶æƒé™\nchmod -R 777 sonar-project.properties\n\n```\n\nï¼ˆ2ï¼‰åˆ›å»ºSonarScannerå®¹å™¨æ‰«æé¡¹ç›®ä»£ç \n\n```shell\n docker run  --rm \\\n -v \"/home/code/vue-test:/usr/src\"  \\\n sonarsource/sonar-scanner-cli\n```\n\næ ¹æ®é¡¹ç›®ä»£ç çš„å¤šå°‘æ—¶é—´ä¼šæœ‰æ‰€ä¸åŒï¼Œä»¥ä¸‹æ˜¯æ‰«æå®Œæˆåçš„æç¤ºã€‚\n\n> 09:13:23.107Â WARNÂ Â ThisÂ mayÂ leadÂ toÂ missing/brokenÂ featuresÂ inÂ SonarQube\n\n> 09:13:23.324Â INFOÂ Â CPDÂ ExecutorÂ 61Â filesÂ hadÂ noÂ CPDÂ blocks\n\n> 09:13:23.325Â INFOÂ Â CPDÂ ExecutorÂ CalculatingÂ CPDÂ forÂ 325Â files\n\n> 09:13:23.634Â INFOÂ Â CPDÂ ExecutorÂ CPDÂ calculationÂ finishedÂ (done)Â |Â time=309ms\n\n> 09:13:23.641Â INFOÂ Â SCMÂ revisionÂ IDÂ '4941a614714697243a5a8f7824fc921ff5f84345'\n\n> 09:13:24.131Â INFOÂ Â AnalysisÂ reportÂ generatedÂ inÂ 462ms,Â dirÂ size=18.8Â MB\n\n> 09:13:25.560Â INFOÂ Â AnalysisÂ reportÂ compressedÂ inÂ 1429ms,Â zipÂ size=8.3Â MB\n\n> 09:14:10.518Â INFOÂ Â AnalysisÂ reportÂ uploadedÂ inÂ 44955ms\n\n> 09:14:10.519Â INFOÂ Â ANALYSISÂ SUCCESSFUL,Â youÂ canÂ findÂ theÂ resultsÂ at:Â [http://192.168.32.12:9000/](http://192.168.32.12:9000/)[dashboard?id=test4](http://116.63.39.38:9000/dashboard?id=test4)\n\n> 09:14:10.519Â INFOÂ Â NoteÂ thatÂ youÂ willÂ beÂ ableÂ toÂ accessÂ theÂ updatedÂ dashboardÂ onceÂ theÂ serverÂ hasÂ processedÂ theÂ submittedÂ analysisÂ report\n\n> 09:14:10.519Â INFOÂ Â MoreÂ aboutÂ theÂ reportÂ processingÂ atÂ [http://192.168.32.12:9000/api/ce/task?id=acfc4bc2-7b20-4166-bde6-93d970ac62b3](http://116.63.39.38:9000/api/ce/task?id=acfc4bc2-7b20-4166-bde6-93d970ac62b3)\n\n> 09:14:10.601Â INFOÂ Â AnalysisÂ totalÂ time:Â 3:49.166Â s\n\n> 09:14:10.602Â INFOÂ Â SonarScannerÂ EngineÂ completedÂ successfully\n\n> 09:14:10.636Â INFOÂ Â EXECUTIONÂ SUCCESS\n\n> 09:14:10.637Â INFOÂ Â TotalÂ time:Â 17:51.245s\n\n## **éƒ¨ç½²**SonarScanneré›†æˆPHP\n\nï¼ˆ1ï¼‰åœ¨PHPé¡¹ç›®çš„æ ¹ç›®å½•ä¸‹åˆ›å»ºsonar-project.propertiesæ–‡ä»¶ï¼Œå¹¶æ·»åŠ é…ç½®é¡¹\n\n```shell\nvi sonar-project.properties\n*****************************************************\nsonar.projectKey=sonarqubeä¸­åˆ›å»ºçš„é¡¹ç›®åç§°\nsonar.projectName=PHPé¡¹ç›®å\nsonar.projectVersion=PHPé¡¹ç›®ç‰ˆæœ¬\nsonar.sources=.  #PHPé¡¹ç›®æºæ–‡ä»¶çš„ç›®å½•\nsonar.language=php   #é¡¹ç›®è¯­è¨€\nsonar.sourceEncoding=UTF-8  #é¡¹ç›®ç¼–ç \nsonar.host.url=http://192.168.32.12:9000/ #sonarqubeæœåŠ¡å™¨ç«¯çš„åœ°å€\nsonar.token=sonarqubeä¸­åˆ›å»ºé¡¹ç›®çš„token\n*****************************************************\n#ä¿®æ”¹æ–‡ä»¶æƒé™\nchmod -R 777 sonar-project.properties\n\n```\n\nï¼ˆ2ï¼‰åˆ›å»ºSonarScannerå®¹å™¨æ‰«æé¡¹ç›®ä»£ç \n\n```shell\n docker run  --rm \\\n -v \"/home/code/php-test:/usr/src\"  \\\n sonarsource/sonar-scanner-cli\n```\n\næ ¹æ®é¡¹ç›®ä»£ç çš„å¤šå°‘æ—¶é—´ä¼šæœ‰æ‰€ä¸åŒï¼Œä»¥ä¸‹æ˜¯æ‰«æå®Œæˆåçš„æç¤ºã€‚\n\n> 09:13:23.107Â WARNÂ Â ThisÂ mayÂ leadÂ toÂ missing/brokenÂ featuresÂ inÂ SonarQube\n\n> 09:13:23.324Â INFOÂ Â CPDÂ ExecutorÂ 61Â filesÂ hadÂ noÂ CPDÂ blocks\n\n> 09:13:23.325Â INFOÂ Â CPDÂ ExecutorÂ CalculatingÂ CPDÂ forÂ 325Â files\n\n> 09:13:23.634Â INFOÂ Â CPDÂ ExecutorÂ CPDÂ calculationÂ finishedÂ (done)Â |Â time=309ms\n\n> 09:13:23.641Â INFOÂ Â SCMÂ revisionÂ IDÂ '4941a614714697243a5a8f7824fc921ff5f84345'\n\n> 09:13:24.131Â INFOÂ Â AnalysisÂ reportÂ generatedÂ inÂ 462ms,Â dirÂ size=18.8Â MB\n\n> 09:13:25.560Â INFOÂ Â AnalysisÂ reportÂ compressedÂ inÂ 1429ms,Â zipÂ size=8.3Â MB\n\n> 09:14:10.518Â INFOÂ Â AnalysisÂ reportÂ uploadedÂ inÂ 44955ms\n\n> 09:14:10.519Â INFOÂ Â ANALYSISÂ SUCCESSFUL,Â youÂ canÂ findÂ theÂ resultsÂ at:Â [http://192.168.32.12:9000/](http://192.168.32.12:9000/)[dashboard?id=test4](http://116.63.39.38:9000/dashboard?id=test4)\n\n> 09:14:10.519Â INFOÂ Â NoteÂ thatÂ youÂ willÂ beÂ ableÂ toÂ accessÂ theÂ updatedÂ dashboardÂ onceÂ theÂ serverÂ hasÂ processedÂ theÂ submittedÂ analysisÂ report\n\n> 09:14:10.519Â INFOÂ Â MoreÂ aboutÂ theÂ reportÂ processingÂ atÂ [http://192.168.32.12:9000/api/ce/task?id=acfc4bc2-7b20-4166-bde6-93d970ac62b3](http://116.63.39.38:9000/api/ce/task?id=acfc4bc2-7b20-4166-bde6-93d970ac62b3)\n\n> 09:14:10.601Â INFOÂ Â AnalysisÂ totalÂ time:Â 3:49.166Â s\n\n> 09:14:10.602Â INFOÂ Â SonarScannerÂ EngineÂ completedÂ successfully\n\n> 09:14:10.636Â INFOÂ Â EXECUTIONÂ SUCCESS\n\n> 09:14:10.637Â INFOÂ Â TotalÂ time:Â 17:51.245s\n","tags":["è¿ç»´","ä»£ç åˆ†æ","Linux","DevOps","docker","SonarQube","SonarScanner"],"categories":["å®¹å™¨åŒ–","docker"]},{"title":"é¡¹ç›®æ¼æ´é—®é¢˜è®°å½•","url":"/yyg/8a0457d3/","content":"## **SSL 2.0 å’Œ 3.0 çš„æ¼æ´ä¿®å¤ï¼š**\n\nSSL (Secure Sockets Layer) æ˜¯ä¸€ç§åŠ å¯†åè®®ï¼Œæ›¾è¢«å¹¿æ³›ç”¨äºç½‘ç»œé€šä¿¡ä¸­ä»¥ç¡®ä¿æ•°æ®çš„å®‰å…¨ä¼ è¾“ã€‚SSL 2.0 å’Œ 3.0 æ˜¯æ—©æœŸçš„ç‰ˆæœ¬ï¼Œä½†å®ƒä»¬å·²ç»è¢«è®¤ä¸ºä¸å†å®‰å…¨ï¼Œå› æ­¤è¢«ç°ä»£åè®®ï¼ˆå¦‚ TLS 1.2 å’Œ TLS 1.3ï¼‰æ‰€å–ä»£ã€‚\n\nSSL 2.0 å’Œ 3.0 çš„æ¼æ´ï¼š\n\n- SSL 2.0ï¼šå­˜åœ¨å¤šä¸ªå®‰å…¨æ¼æ´ï¼ŒåŒ…æ‹¬è¾ƒå¼±çš„åŠ å¯†ç®—æ³•ã€ç¼ºä¹å®‰å…¨æ€§éªŒè¯ç­‰ã€‚å®ƒå·²ç»è¢«å¹¿æ³›å¼ƒç”¨ã€‚\n- SSL 3.0ï¼šè™½ç„¶ç›¸è¾ƒäº SSL 2.0 æ”¹è¿›äº†åŠ å¯†ç®—æ³•ï¼Œä½†ä»ç„¶å­˜åœ¨è¯¸å¦‚ POODLE æ”»å‡»ï¼ˆPadding Oracle On Downgraded Legacy Encryptionï¼‰ç­‰ä¸¥é‡çš„å®‰å…¨é—®é¢˜ï¼Œå› æ­¤å®ƒä¹Ÿå·²ç»ä¸å†æ¨èä½¿ç”¨ã€‚\n\nå¦‚ä½•æ£€æµ‹ SSL 2.0 å’Œ SSL 3.0ï¼š\n\n1. ä½¿ç”¨å·¥å…·æ‰«æï¼šè®¸å¤šå®‰å…¨æ‰«æå·¥å…·ï¼ˆå¦‚ OpenSSLï¼‰å¯ä»¥å¸®åŠ©æ£€æµ‹ç½‘ç«™æ˜¯å¦æ”¯æŒ SSL 2.0 å’Œ SSL 3.0ã€‚\n\n```\nopenssl s_client -connect <hostname>:443 -ssl2\nopenssl s_client -connect <hostname>:443 -ssl3\n```\n\nå¦‚æœè¿æ¥æˆåŠŸï¼Œè¡¨ç¤ºè¯¥åè®®è¢«æœåŠ¡å™¨æ”¯æŒã€‚\n\n1. æœåŠ¡å™¨é…ç½®æ£€æŸ¥ï¼šä½ å¯ä»¥æ£€æŸ¥æœåŠ¡å™¨ä¸Šçš„ SSL/TLS é…ç½®ï¼Œç¡®ä¿ä¸å†æ”¯æŒ SSL 2.0 æˆ– SSL 3.0ã€‚\n\n- å¯¹äº Apacheï¼Œæ£€æŸ¥ `ssl.conf` æˆ– `httpd.conf` æ–‡ä»¶ä¸­çš„ `SSLProtocol` é…ç½®ï¼š\n\n```\nSSLProtocol all -SSLv2 -SSLv3\n```\n\n- å¯¹äº Nginxï¼Œæ£€æŸ¥ `nginx.conf` æ–‡ä»¶ä¸­çš„ `ssl_protocols` é…ç½®ï¼š\n\n```\nssl_protocols TLSv1.2 TLSv1.3;\n```\n\n1. åœ¨æµè§ˆå™¨å¼€å‘è€…å·¥å…·ä¸­æ£€æŸ¥ï¼šä½ ä¹Ÿå¯ä»¥é€šè¿‡æµè§ˆå™¨çš„å¼€å‘è€…å·¥å…·ï¼ˆå¦‚ Chrome æˆ– Firefoxï¼‰æ¥æŸ¥çœ‹ç½‘ç»œè¯·æ±‚çš„åŠ å¯†åè®®ç‰ˆæœ¬ã€‚åœ¨å¼€å‘è€…å·¥å…·çš„â€œç½‘ç»œâ€é€‰é¡¹å¡ä¸­ï¼ŒæŸ¥çœ‹ HTTPS è¯·æ±‚çš„è¯¦ç»†ä¿¡æ¯ï¼Œåè®®ç‰ˆæœ¬ä¼šåœ¨å“åº”å¤´éƒ¨æ˜¾ç¤ºã€‚\n2. è‡ªåŠ¨åŒ–æ‰«æå·¥å…·ï¼šå¯ä»¥ä½¿ç”¨è‡ªåŠ¨åŒ–å·¥å…·ï¼ˆå¦‚ Nmapï¼‰æ¥æ‰«ææœåŠ¡å™¨æ”¯æŒçš„ SSL/TLS åè®®ã€‚ä¾‹å¦‚ï¼š\n\n```\nnmap --script ssl-enum-ciphers -p 443 <hostname>\n```\n\n## **\"SWEET32\" ï¼š**\n\n\"SWEET32\" æ˜¯ä¸€ç§é’ˆå¯¹ TLS å’Œ SSL åè®®ä¸­çš„ ä¸­ç­‰å¼ºåº¦åŠ å¯†å¥—ä»¶ï¼ˆå¦‚ 3DESï¼‰çš„æ”»å‡»æ–¹å¼ï¼Œä¸»è¦ç”¨äº 2-å—ç¢°æ’æ”»å‡»ï¼ˆbirthday bound attackï¼‰ã€‚å…·ä½“æ¥è¯´ï¼Œå®ƒå½±å“çš„æ˜¯ ä½¿ç”¨ 64 ä½å—å¤§å°çš„åŠ å¯†ç®—æ³•ï¼Œæ¯”å¦‚ 3DES å’Œä¸€äº›è¾ƒè€çš„åŠ å¯†å¥—ä»¶ã€‚\n\n### ä¸ºä»€ä¹ˆä¸­ç­‰å¼ºåº¦åŠ å¯†å¥—ä»¶ä¸å®‰å…¨ï¼Ÿ\n\n- SWEET32 æ”»å‡»åŸç†ï¼š ç”±äº 3DESï¼ˆå’Œå…¶ä»–åŸºäº 64 ä½å—çš„åŠ å¯†ç®—æ³•ï¼‰çš„è®¾è®¡ç¼ºé™·ï¼Œæ”»å‡»è€…å¯ä»¥åœ¨é•¿æ—¶é—´çš„æ•°æ®æµé‡ä¸­æ‰¾åˆ°åŠ å¯†æ•°æ®å—çš„ç¢°æ’ï¼Œä»è€Œæ³„éœ²ä¿¡æ¯ã€‚æ”»å‡»çš„æˆåŠŸæ¦‚ç‡éšç€åŠ å¯†æ•°æ®é‡çš„å¢åŠ è€Œå¢åŠ ã€‚\n- æ¨èçš„åšæ³•ï¼š ç”±äºè¿™ç§æ”»å‡»åœ¨å¤§æ•°æ®ä¼ è¾“ä¸­æ›´å®¹æ˜“æˆåŠŸï¼ˆæ¯”å¦‚é•¿æ—¶é—´çš„ HTTPS ä¼šè¯ï¼‰ï¼Œç°ä»£çš„æœ€ä½³å®è·µæ˜¯ç¦ç”¨æ‰€æœ‰ 64 ä½å—å¤§å°çš„åŠ å¯†ç®—æ³•ï¼Œå¦‚ 3DESã€‚\n\næŸ¥çœ‹æœåŠ¡å™¨æ”¯æŒçš„æ‰€æœ‰åŠ å¯†å¥—ä»¶ï¼š\n\n```\nopenssl s_client -connect example.com:443 -cipher 'ALL'\n```\n\n### è§£å†³æ–¹æ³•\n\n1. ç¦ç”¨ä¸­ç­‰å¼ºåº¦çš„åŠ å¯†å¥—ä»¶ï¼ˆå¦‚ 3DESï¼‰ï¼š æœåŠ¡å™¨åº”è¯¥é…ç½®ä¸ºåªæ”¯æŒ å¼ºåŠ å¯†å¥—ä»¶ï¼Œä¾‹å¦‚ AES åŠ å¯†å’Œ ChaCha20ï¼ŒåŒæ—¶ç¦ç”¨ 3DESã€RC4 ç­‰ä¸å®‰å…¨çš„å¥—ä»¶ã€‚\n\nå¦‚æœä½ æœ‰è®¿é—®æœåŠ¡å™¨é…ç½®çš„æƒé™ï¼Œå¯ä»¥æ ¹æ®ä½¿ç”¨çš„ Web æœåŠ¡å™¨ï¼ˆå¦‚ Apacheã€Nginx ç­‰ï¼‰è¿›è¡Œç›¸åº”é…ç½®ã€‚\n\nä¾‹å¦‚ï¼Œåœ¨ Apache ä¸­ï¼Œä½ å¯ä»¥åœ¨ `ssl.conf` æ–‡ä»¶ä¸­ç¦ç”¨ 3DES å’Œå…¶ä»–å¼±å¥—ä»¶ï¼š\n\n```\nSSLCipherSuite HIGH:!aNULL:!MD5:!3DES\n```\n\nå¯¹äº Nginxï¼Œå¯ä»¥ä½¿ç”¨ç±»ä¼¼çš„é…ç½®ï¼š\n\n```\nssl_ciphers 'TLS_AES_128_GCM_SHA256:TLS_AES_256_GCM_SHA384:ECDHE-RSA-AES128-GCM-SHA256:ECDHE-RSA-AES256-GCM-SHA384:!3DES';\n```\n\n1. å¯ç”¨ç°ä»£çš„åŠ å¯†å¥—ä»¶ï¼š æ¨èå¯ç”¨ AES æˆ– ChaCha20 ç­‰ç°ä»£åŠ å¯†å¥—ä»¶ã€‚ç¡®ä¿å¯ç”¨çš„å¥—ä»¶ç¬¦åˆ TLS 1.2 æˆ– TLS 1.3 çš„æ ‡å‡†ã€‚\n\nä¾‹å¦‚ï¼Œä¸‹é¢æ˜¯ä¸€ä¸ªæ¨èçš„åŠ å¯†å¥—ä»¶é…ç½®ï¼Œå®ƒä»…å¯ç”¨äº†å¼ºåŠ å¯†ç®—æ³•ï¼š\n\n```\nSSLProtocol TLSv1.2 TLSv1.3\nSSLCipherSuite ECDHE-RSA-AES256-GCM-SHA384:ECDHE-RSA-AES128-GCM-SHA256:TLS_AES_128_GCM_SHA256:TLS_AES_256_GCM_SHA384\n```\n\n1. å‡çº§åˆ° TLS 1.2 æˆ– TLS 1.3ï¼š ç¡®ä¿æœåŠ¡å™¨ä»…æ”¯æŒ TLS 1.2 æˆ– TLS 1.3ï¼Œè€Œ SSLv3 å’Œ TLS 1.0/1.1 åº”è¯¥è¢«ç¦ç”¨ã€‚ç°ä»£çš„åŠ å¯†å¥—ä»¶å’Œåè®®ç‰ˆæœ¬å¯ä»¥æœ‰æ•ˆåœ°é™ä½ SWEET32 æ”»å‡»çš„é£é™©ã€‚\n\nåœ¨æœåŠ¡å™¨çš„é…ç½®æ–‡ä»¶ssl.confä¸­ï¼Œç¡®ä¿ç¦ç”¨äº†æ—§çš„åè®®ç‰ˆæœ¬ï¼š\n\n```\nSSLProtocol TLSv1.2 TLSv1.3\n```","tags":["è¿ç»´","æ¼æ´æ‰«æ","é¡¹ç›®é—®é¢˜æ€»ç»“"],"categories":["æ¢³ç†æ€»ç»“","é¡¹ç›®é—®é¢˜æ€»ç»“"]},{"title":"Windows 10ï¼ˆx86_64ï¼‰ä½¿ç”¨QEMUå®‰è£…ARMè™šæ‹Ÿæœº","url":"/yyg/a785f75e/","content":"\n## åŸºç¡€ç¯å¢ƒ\n\nç³»ç»Ÿï¼šWindowsÂ 10\n\nç¡¬ä»¶ï¼šåŒç½‘å¡ï¼ˆæœ¬ç¯‡ä¸­ä½¿ç”¨çš„æ˜¯ä¸¤ä¸ªæ— çº¿ç½‘å¡ï¼‰\n\næ‰€éœ€è½¯ä»¶ï¼šQEMUã€tap-windows\n\næ‰€éœ€è½¯ä»¶å›ºä»¶ï¼šQEMU\\_EFI.fd\n\nARMé•œåƒï¼šopenEuler-22.03-LTS-SP4-aarch64-dvd.iso\n\n## ç¯å¢ƒå‡†å¤‡\n\n1ã€è¿›å…¥QEMUå®˜ç½‘[https://qemu.weilnetz.de/](https://qemu.weilnetz.de/)ï¼Œä¸‹è½½exeç¨‹åºï¼Œæœ¬ç¯‡ä¸­ä½¿ç”¨çš„æ˜¯`qemu-w64-setup-20240903.exe`ï¼ŒÂ æŒ‰å¼•å¯¼è¿›è¡Œå®‰è£…ã€‚ï¼ˆæœ€æ–°ç‰ˆæ— éœ€é…ç½®ç¯å¢ƒå˜é‡ï¼‰\n\næ‰“å¼€å‘½ä»¤æç¤ºç¬¦è¾“å…¥`qemu-system-aarch64Â -version`ï¼ŒæŸ¥çœ‹åˆ°å…¶è¯¦ç»†ç‰ˆæœ¬å·å³ä¸ºå®‰è£…æˆåŠŸã€‚\n\n> QEMUÂ emulatorÂ versionÂ 9.1.0Â (v9.1.0-12064-gc658eebf44)\n\n> CopyrightÂ (c)Â 2003-2024Â FabriceÂ BellardÂ andÂ theÂ QEMUÂ ProjectÂ developers\n\n![image.png](Windows 10ï¼ˆx86_64ï¼‰ä½¿ç”¨QEMUå®‰è£…ARMè™šæ‹Ÿæœº/1.png)\n\n2ã€ä¸‹è½½QEMU\\_EFI.fdå›ºä»¶ï¼Œä¸‹è½½åœ°å€ï¼š[https://releases.linaro.org/components/kernel/uefi-linaro/16.02/release/qemu64/](https://releases.linaro.org/components/kernel/uefi-linaro/16.02/release/qemu64/)ã€‚\n\n![image.png](Windows 10ï¼ˆx86_64ï¼‰ä½¿ç”¨QEMUå®‰è£…ARMè™šæ‹Ÿæœº/2.png)\n\n3ã€ä¸‹è½½ARMé•œåƒï¼Œè¿›å…¥OpenEulerå®˜ç½‘ï¼Œåœ¨é•œåƒä»“åˆ—è¡¨ä¸­æ‰¾åˆ°å¹¶ä¸‹è½½openEuler-22.03-LTS-SP4-aarch64-dvd.isoé•œåƒã€‚\n\n![image.png](Windows 10ï¼ˆx86_64ï¼‰ä½¿ç”¨QEMUå®‰è£…ARMè™šæ‹Ÿæœº/3.png)\n\n4ã€å®‰è£…tap-windowsï¼Œå®‰è£…å®Œæˆååœ¨æœ¬æœºçš„ç½‘å¡é€‚é…å™¨ä¸­ä¼šå‡ºç°ä¸€ä¸ªä¸º`TAP-WindowsÂ AdapterÂ V9`çš„ç½‘å¡ï¼Œå¹¶å°†å…¶åæ”¹ä¸º`tap0`ã€‚ï¼ˆåˆšå®‰è£…æ—¶ç½‘å¡ä¸ºæœªè¿æ¥çŠ¶æ€ï¼‰\n\n![image.png](Windows 10ï¼ˆx86_64ï¼‰ä½¿ç”¨QEMUå®‰è£…ARMè™šæ‹Ÿæœº/4.png)\n\n5ã€å…±äº«`æœ¬æœºæ— çº¿ç½‘å¡ï¼ˆæœ¬ç¯‡ä¸­åä¸ºWLANÂ 1ï¼‰`çš„ç½‘ç»œã€‚å³å‡»æœ¬æœºæ— çº¿ç½‘å¡ï¼ˆWLANÂ 1ï¼‰çš„å±æ€§ï¼Œåœ¨WLANå±æ€§-å…±äº«ä¸­å°†ç½‘ç»œå…±äº«ç»™`tap0`ã€‚å¦‚ä¸‹å›¾ã€‚\n\n![image.png](Windows 10ï¼ˆx86_64ï¼‰ä½¿ç”¨QEMUå®‰è£…ARMè™šæ‹Ÿæœº/5.png)\n\n## å®‰è£…è¿‡ç¨‹\n\n1ã€å°†QEMU\\_EFI.fdå’ŒopenEuler-22.03-LTS-SP4-aarch64-dvd.isoé•œåƒæ”¾åœ¨åŒä¸€æ–‡ä»¶å¤¹ä¸­ï¼Œåœ¨è¯¥æ–‡ä»¶å¤¹ä¸‹æ‰“å¼€`å‘½ä»¤æŒ‡ç¤ºç¬¦`ã€‚\n\n2ã€è¾“å…¥å‘½ä»¤ä¸ºè™šæ‹Ÿæœºåˆ›å»ºä¸€ä¸ªè™šæ‹Ÿç£ç›˜æ–‡ä»¶ã€‚\n\n```yaml\nqemu-img.exe create -f qcow2 \"F:\\arm-os-test\\openeuler.qcow2\" 60G\n```\n\n> * `qemu-img.exe`:Â è°ƒç”¨Â QEMUÂ çš„å›¾åƒç®¡ç†å·¥å…·ã€‚\n> \n> * `create`:Â æŒ‡ä»¤ç”¨äºåˆ›å»ºä¸€ä¸ªæ–°çš„ç£ç›˜æ˜ åƒæ–‡ä»¶ã€‚\n> \n> * `-fÂ qcow2`:Â æŒ‡å®šè¦åˆ›å»ºçš„æ–‡ä»¶æ ¼å¼ä¸ºÂ QCOW2ï¼Œè¿™æ˜¯ä¸€ç§æ”¯æŒå‹ç¼©å’Œå¿«ç…§çš„æ ¼å¼ã€‚\n> \n> * `\"F:\\arm-os-test\\openeuler.qcow2\"`:Â æŒ‡å®šè™šæ‹Ÿç¡¬ç›˜çš„æ–‡ä»¶è·¯å¾„åŠåç§°ã€‚\n> \n> * `60G`:Â è®¾ç½®è™šæ‹Ÿç¡¬ç›˜çš„å¤§å°ä¸ºÂ 60Â GBã€‚\n\nå‘½ä»¤æ‰§è¡Œåä¼šåœ¨è¯¥æ–‡ä»¶å¤¹ä¸‹ç”Ÿæˆä¸€ä¸ªåä¸º`openeuler.qcow2`çš„ç£ç›˜æ–‡ä»¶ã€‚\n\n3ã€æ‰§è¡Œå‘½ä»¤ï¼Œå®‰è£…openEulerã€‚\n\n```yaml\n qemu-system-aarch64.exe -m 8192 -cpu cortex-a72 -smp 4,sockets=2,cores=2 -M virt -bios \"F:\\arm-os-test\\QEMU_EFI.fd\" -net nic -net tap,ifname=tap0 -device VGA -device nec-usb-xhci -device usb-mouse -device usb-kbd -drive if=none,file=\"F:\\arm-os-test\\openeuler.qcow2\",id=hd0 -device virtio-blk-device,drive=hd0 -drive if=none,file=\"F:\\arm-os-test\\openEuler-22.03-LTS-SP4-aarch64-dvd.iso\",id=cdrom,media=cdrom -device virtio-scsi-device -device scsi-cd,drive=cdrom\n```\n\n> * `qemu-system-aarch64.exe`:Â å¯åŠ¨Â AArch64Â æ¶æ„çš„Â QEMUÂ æ¨¡æ‹Ÿå™¨ã€‚\n> \n> * `-mÂ 8192`:Â åˆ†é…Â 8Â GBÂ çš„å†…å­˜ç»™è™šæ‹Ÿæœºã€‚\n> \n> * `-cpuÂ cortex-a72`:Â æŒ‡å®šä½¿ç”¨Â Cortex-A72Â CPUÂ æ¨¡å‹ã€‚\n> \n> * `-smpÂ 4,sockets=2,cores=2`:Â é…ç½®Â 4Â ä¸ªÂ CPUÂ æ ¸å¿ƒï¼Œåˆ†ä¸ºÂ 2Â ä¸ªæ’æ§½ï¼Œæ¯ä¸ªæ’æ§½Â 2Â ä¸ªæ ¸å¿ƒã€‚\n> \n> * `-MÂ virt`:Â ä½¿ç”¨â€œvirtâ€æœºå™¨ç±»å‹ï¼Œé€‚åˆè™šæ‹ŸåŒ–ã€‚\n> \n> * `-biosÂ \"F:\\arm-os-test\\QEMU_EFI.fd\"`:Â æŒ‡å®šÂ EFIÂ BIOSÂ æ–‡ä»¶ã€‚\n> \n> * `-netÂ nicÂ -netÂ tap,ifname=tap0`:Â è®¾ç½®ç½‘ç»œï¼Œä½¿ç”¨Â NICÂ å’ŒÂ tapÂ æ¥å£ã€‚\n> \n> * `-deviceÂ VGA`:Â æ·»åŠ Â VGAÂ æ˜¾ç¤ºè®¾å¤‡ã€‚\n> \n> * `-deviceÂ nec-usb-xhci`:Â æ·»åŠ Â USBÂ æ§åˆ¶å™¨ã€‚\n> \n> * `-deviceÂ usb-mouseÂ -deviceÂ usb-kbd`:Â æ·»åŠ Â USBÂ é¼ æ ‡å’Œé”®ç›˜è®¾å¤‡ã€‚\n> \n> * `-driveÂ if=none,file=\"F:\\arm-os-test\\openeuler.qcow2\",id=hd0Â -deviceÂ virtio-blk-device,drive=hd0`:Â é…ç½®ä¸€ä¸ªÂ VirtIOÂ å—è®¾å¤‡ä½œä¸ºä¸»ç£ç›˜ã€‚\n> \n> * `-driveÂ if=none,file=\"F:\\arm-os-test\\openEuler-22.03-LTS-SP4-aarch64-dvd.iso\",id=cdrom,media=cdrom`:Â è®¾ç½®Â CD-ROMÂ é©±åŠ¨å™¨ï¼Œä½¿ç”¨æŒ‡å®šçš„Â ISOã€‚\n> \n> * `-deviceÂ virtio-scsi-deviceÂ -deviceÂ scsi-cd,drive=cdrom`:Â æ·»åŠ Â SCSIÂ æ§åˆ¶å™¨ï¼Œå¹¶è¿æ¥Â CD-ROMÂ é©±åŠ¨å™¨ã€‚\n\næ‰§è¡Œå‘½ä»¤åï¼Œåœ¨å¼¹å‡ºçš„ç³»ç»Ÿå®‰è£…ç•Œé¢ï¼ŒæŒ‰å¼•å¯¼è¿›è¡Œç³»ç»Ÿçš„é…ç½®å’Œå®‰è£…ã€‚\n\n## è¿æ¥äº’è”ç½‘\n\n1ã€ç³»ç»Ÿå®‰è£…å®Œæˆåï¼Œåœ¨tap0ç½‘å¡çš„å±æ€§ä¸­æŸ¥çœ‹ipåœ°å€ï¼Œå°†ipåœ°å€æ”¹ä¸ºä¸ä¸»æœºåŒä¸€ç½‘æ®µçš„ipï¼ŒDNSå’Œç½‘å…³ä¸ä¸»æœºä¸€è‡´ã€‚æ‰§è¡Œå‘½ä»¤å¯åŠ¨ç³»ç»Ÿã€‚\n\n```yaml\nqemu-system-aarch64.exe -m 8192 -cpu cortex-a72 -smp 4,sockets=2,cores=2 -M virt -bios \"F:\\arm-os-test\\QEMU_EFI.fd\" -net nic -net tap,ifname=tap0 -device VGA -device nec-usb-xhci -device usb-mouse -device usb-kbd -drive if=none,file=\"F:\\arm-os-test\\openeuler.qcow2\",id=hd0 -device virtio-blk-device,drive=hd0\n```\n\n> å¯åŠ¨ç³»ç»Ÿå‘½ä»¤æ˜¯å°†å®‰è£…å‘½ä»¤ä¸­å»é™¤isoæŒ‚è½½éƒ¨åˆ†å»é™¤å¾—åˆ°çš„\n\n![image.png](Windows 10ï¼ˆx86_64ï¼‰ä½¿ç”¨QEMUå®‰è£…ARMè™šæ‹Ÿæœº/6.png)\n\n2ã€é…ç½®ç³»ç»ŸIPåœ°å€ã€‚ä½¿ç”¨tap0ç½‘å¡çš„åœ°å€ä½œä¸ºç½‘å…³ï¼Œé…ç½®å®Œæˆå¹¶å¯ç”¨åï¼Œä½¿ç”¨sshå·¥å…·è¿æ¥ã€‚\n\n![image.png](Windows 10ï¼ˆx86_64ï¼‰ä½¿ç”¨QEMUå®‰è£…ARMè™šæ‹Ÿæœº/7.png)\n\n> <mark>è‹¥å‡ºç°æµ‹è¯•ç½‘ç»œè”é€šæ€§å¤±è´¥çš„æƒ…å†µï¼Œè¿›è¡Œä»¥ä¸‹æ“ä½œï¼š</mark>\n> \n> <mark>1ã€å–æ¶ˆå…±äº«æ— çº¿ç½‘å¡çš„ç½‘ç»œ</mark>\n> \n> <mark>2ã€é‡æ–°å…±äº«ç½‘ç»œ</mark>\n> \n> <mark>3ã€å¯åŠ¨è™šæ‹Ÿæœº</mark>\n\n8ã€æµ‹è¯•ç½‘ç»œçš„è¿é€šæ€§ï¼Œå¯æˆåŠŸè®¿é—®ç½‘ç»œã€‚\n\n![image.png](Windows 10ï¼ˆx86_64ï¼‰ä½¿ç”¨QEMUå®‰è£…ARMè™šæ‹Ÿæœº/8.png)\n\næ­¤æ—¶å®‰è£…çš„ARMæ¶æ„çš„è™šæ‹Ÿæœºå¯æ­£å¸¸è®¿é—®ç½‘ç»œï¼Œä½†è¿›è¡Œå‘å¸ƒçš„ä¸šåŠ¡æ— æ³•åœ¨æœ¬åœ°ä¸»æœºè®¿é—®ã€‚å³è™šæ‹Ÿæœºå¯è®¿é—®äº’è”ç½‘ï¼Œä½†æ— æ³•è®¿é—®æœ¬åœ°ä¸»æœºã€‚\n\n## æœ¬åœ°ä¸»æœºè¿é€šè™šæ‹Ÿæœºä¸šåŠ¡\n\nè¦æˆåŠŸè®¿é—®è™šæ‹Ÿæœºä¸­å‘å¸ƒçš„ä¸šåŠ¡ï¼Œéœ€è¦ä½¿ç”¨ä¸€ä¸ªæ–°çš„æ— çº¿ç½‘å¡ï¼ˆæœ¬ç¯‡ä¸­åä¸ºWLANÂ 2ï¼‰ï¼Œç”¨æ¥å’Œtap0è¿›è¡Œ`æ¡¥æ¥`ã€‚\n\n1ã€å°†ä¸¤å¼ æ— çº¿ç½‘å¡è¿æ¥åŒä¸€ç½‘ç»œä¸­ï¼Œåœ¨æ§åˆ¶é¢æ¿-ç½‘ç»œè¿æ¥ä¸­ï¼ŒæŒ‰ä½`Ctrl`,åˆ†åˆ«é€‰ä¸­ç½‘å¡`tap0`å’Œ`WLANÂ 2`Â ï¼Œå³é”®é€‰æ‹©æ¡¥æ¥ï¼Œåˆ›å»ºä¸€ä¸ªç½‘æ¡¥ã€‚\n\n![image.png](Windows 10ï¼ˆx86_64ï¼‰ä½¿ç”¨QEMUå®‰è£…ARMè™šæ‹Ÿæœº/9.png)\n\n> <mark>å½“tap0å’ŒWLANÂ 2éƒ½æ˜¾ç¤ºâ€œå·²å¯ç”¨ï¼Œæ¡¥æ¥çš„â€ï¼Œä¸”ç½‘æ¡¥å¤„æ˜¾ç¤ºè¿æ¥åˆ°çš„æ— çº¿ç½‘ç»œåç§°æ—¶ï¼Œåœ¨æœ¬åœ°ä¸»æœºå’Œè™šæ‹Ÿæœºä¸­å‡å¯pingé€šå¯¹æ–¹åœ°å€ã€‚ï¼ˆæ­¤æ—¶æœ¬åœ°ä¸»æœºçš„ipåº”ä½¿ç”¨WLANåˆ†é…çš„ï¼‰</mark>\n\n2ã€å³é”®æŸ¥çœ‹ç½‘æ¡¥å±æ€§ï¼Œåœ¨`Internetåè®®ç‰ˆæœ¬Â 4(TCP/IPv4)å±æ€§`ä¸­å¯æŸ¥çœ‹åˆ°ç½‘å…³åœ°å€ä¸æœ¬æœºä¸€è‡´ã€‚\n\n![image.png](Windows 10ï¼ˆx86_64ï¼‰ä½¿ç”¨QEMUå®‰è£…ARMè™šæ‹Ÿæœº/10.png)\n\n3ã€å°†è™šæ‹Ÿæœºçš„ç½‘å…³ä¿®æ”¹ä¸ºç½‘å…³å¯¹åº”åœ°å€ï¼Œå…³é—­è™šæ‹Ÿæœºã€‚é‡æ–°ä½¿ç”¨å‘½ä»¤å¯åŠ¨è™šæ‹Ÿæœºã€‚\n\nè‹¥è™šæ‹Ÿæœºå’Œæœ¬åœ°ä¸»æœºå‡å¯pingé€šäº’è”ç½‘ä¸”å¯ç›¸äº’pingé€šï¼Œæ­¤æ—¶åœ¨æœ¬åœ°ä¸»æœºå¯æ­£å¸¸è®¿é—®è™šæ‹Ÿæœºå‘å¸ƒä¸šåŠ¡ã€‚","tags":["QEMU","x86-ARM","x86ç¯å¢ƒå®‰è£…ARMè™šæ‹Ÿæœº"],"categories":["Linuxè¿ç»´","æ¢³ç†æ€»ç»“","çŸ¥è¯†æ¢³ç†","QEMU"]},{"title":"eNSPæ¨¡æ‹Ÿç½‘ç»œè®¾å¤‡è®¿é—®çœŸå®ç½‘ç»œ","url":"/yyg/f5b762ea/","content":"## æ·»åŠ Loopbackç¯å›ç½‘å¡\n\nï¼ˆ1ï¼‰ä½¿ç”¨Win+Â Rè°ƒå‡ºâ€è¿è¡Œâ€œï¼Œè¾“å…¥`hdwwiz`ï¼Œç¡®å®šåå¼€å§‹æ·»åŠ æ–°ç¡¬ä»¶å‘å¯¼ã€‚\n\nï¼ˆ2ï¼‰æŒ‰å‘å¯¼æ“ä½œï¼Œé€‰æ‹©`å®‰è£…æˆ‘æ‰‹åŠ¨ä»åˆ—è¡¨é€‰æ‹©çš„ç¡¬ä»¶(é«˜çº§)(M)`ã€‚\n\n![image.png](eNSPæ¨¡æ‹Ÿç½‘ç»œè®¾å¤‡è®¿é—®çœŸå®ç½‘ç»œ/1.png)\n\nï¼ˆ3ï¼‰é€‰æ‹©å®‰è£…çš„ç¡¬ä»¶ç±»å‹ä¸º`ç½‘ç»œé€‚é…å™¨`ï¼Œé€‰å®šè®¾å¤‡é©±åŠ¨ç¨‹åºçš„å‚å•†ä¸º`Microsoft`ï¼Œå‹å·ä¸º`MicrosoftÂ KM-TESTç¯å›é€‚é…å™¨`ã€‚\n\n![image.png](eNSPæ¨¡æ‹Ÿç½‘ç»œè®¾å¤‡è®¿é—®çœŸå®ç½‘ç»œ/2.png)\n\nï¼ˆ4ï¼‰æŒ‰å‘å¯¼å®‰è£…ï¼Œç‚¹å‡»å®Œæˆå³å¯ã€‚\n\n## å…±äº«ä¸»æœºç½‘ç»œ\n\nï¼ˆ1ï¼‰æ‰“å¼€æ§åˆ¶é¢æ¿--ç½‘ç»œå’ŒInternet--ç½‘ç»œè¿æ¥ï¼Œæ‰¾åˆ°æ–°åˆ›å»ºçš„ç¯å›ç½‘å¡ï¼Œæœ¬ä¸»æœºä¸­ä¸º`ä»¥å¤ªç½‘Â 8`ã€‚é€‰æ‹©æœ¬æœºè¿æ¥ç½‘ç»œï¼Œæ­¤å¤–ä¸ºWLANï¼Œåœ¨å±æ€§ä¸­é€‰æ‹©å…±äº«ï¼Œå‹¾é€‰`å…è®¸å…¶ä»–ç½‘ç»œç”¨æˆ·é€šè¿‡æ­¤è®¡ç®—æœºçš„Internetè¿æ¥æ¥è¿æ¥(N)`ï¼Œé€‰æ‹©æ–°åˆ›å»ºçš„ç¯å›ç½‘å¡`ä»¥å¤ªç½‘Â 8`ï¼Œä¿å­˜å³å¯ã€‚\n\n![image.png](eNSPæ¨¡æ‹Ÿç½‘ç»œè®¾å¤‡è®¿é—®çœŸå®ç½‘ç»œ/3.png)\n\nï¼ˆ2ï¼‰ä¿å­˜åï¼Œä¼šé»˜è®¤ç»™ç¯å›ç½‘å¡åˆ†é…ipåœ°å€`192.168.137.1`ã€‚é‡å¯ç½‘å¡ä½¿å¾—é…ç½®ç”Ÿæ•ˆã€‚\n\n![image.png](eNSPæ¨¡æ‹Ÿç½‘ç»œè®¾å¤‡è®¿é—®çœŸå®ç½‘ç»œ/4.png)\n\nï¼ˆ3ï¼‰æ‰“å¼€eNSPè½¯ä»¶ï¼Œæ‰“å¼€Cloudçš„è®¾ç½®ï¼Œåˆ†åˆ«åˆ›å»ºä¸€ä¸ªç»‘å®šä¿¡æ¯ä¸º`UDP`å’Œç¯å›ç½‘å¡`ä»¥å¤ªç½‘Â 8Â --Â IPï¼š192.168.137.1`çš„ç«¯å£ï¼Œå¹¶è®¾ç½®ç«¯å£æ˜ å°„çš„å…¥ç«¯å£å’Œå‡ºç«¯å£ç¼–å·ï¼Œå‹¾é€‰åŒå‘é€šé“ï¼Œç‚¹å‡»å¢åŠ ã€‚\n\n![image.png](eNSPæ¨¡æ‹Ÿç½‘ç»œè®¾å¤‡è®¿é—®çœŸå®ç½‘ç»œ/5.png)\n\nï¼ˆ4ï¼‰å¼€å¯ç½‘ç»œæ‹“æ‰‘ï¼Œè®¾ç½®ä¸»æœºä¸ºDHCPï¼Œç­‰å¾…ä¸»æœºåˆ†é…å‡ºipåï¼Œä½¿ç”¨pingå‘½ä»¤éªŒè¯æ˜¯å¦è¿æ¥å¤–éƒ¨çœŸå®ç½‘ç»œã€‚\n\n![image.png](eNSPæ¨¡æ‹Ÿç½‘ç»œè®¾å¤‡è®¿é—®çœŸå®ç½‘ç»œ/6.png)\n\n![image.png](eNSPæ¨¡æ‹Ÿç½‘ç»œè®¾å¤‡è®¿é—®çœŸå®ç½‘ç»œ/7.png)","tags":["ç½‘ç»œè®¾å¤‡","enspæ¨¡æ‹Ÿä»¿çœŸ"],"categories":["Linuxè¿ç»´","æ¢³ç†æ€»ç»“","ç½‘ç»œåˆ†æ","çŸ¥è¯†æ¢³ç†"]},{"title":"Linuxå®ç°æ¨¡æ‹ŸIPMI","url":"/yyg/9ec93abd/","content":"## ç¯å¢ƒå‡†å¤‡ï¼š\n\nï¼ˆ1ï¼‰ä½¿ç”¨è„šæœ¬å®‰è£…dockerã€docker-compose\n\n```shell\nbash <(curl -sSL https://linuxmirrors.cn/docker.sh)\n```\n\nï¼ˆ2ï¼‰é…ç½®é•œåƒåŠ é€Ÿ\n\n```shell\nvi /etc/docker/daemon.json\n\n{\n  \"data-root\": \"/data/dockerData\",\n  \"registry-mirrors\": [\"https://registry.cn-hangzhou.aliyuncs.com\",\n    \"https://huecker.io\",\n    \"https://docker.rainbond.cc\",\n    \"https://dockerhub.timeweb.cloud\",\n    \"https://dockerhub.icu\",\n    \"https://docker.registry.cyou\",\n    \"https://docker-cf.registry.cyou\",\n    \"https://dockercf.jsdelivr.fyi\",\n    \"https://docker.jsdelivr.fyi\",\n    \"https://dockertest.jsdelivr.fyi\",\n    \"https://mirror.aliyuncs.com\",\n    \"https://dockerproxy.com\",\n    \"https://mirror.baidubce.com\",\n    \"https://docker.m.daocloud.io\",\n    \"https://docker.nju.edu.cn\",\n    \"https://docker.mirrors.sjtug.sjtu.edu.cn\",\n    \"https://docker.mirrors.ustc.edu.cn\",\n    \"https://mirror.iscas.ac.cn\",\n    \"https://docker.rainbond.cc\",\n    \"https://docker.kubesre.xyz\"],\n    \"log-driver\":\"json-file\",\n    \"log-opts\":{\"max-size\" :\"50m\",\"max-file\":\"3\"}\n}\n```\n\nï¼ˆ3ï¼‰å¯åŠ¨dockeræœåŠ¡\n\n```shell\nsystemctl start docker\nsystemctl enable docker\nsystemctl status docker\n```\n\n## éƒ¨ç½²IPMI Simulatorå®¹å™¨\n\nï¼ˆ1ï¼‰åœ¨IPMI Simulatorå®˜æ–¹ä»“åº“ä¸­ä¸‹è½½æºç åŒ…\n\nhttps://github.com/vapor-ware/ipmi-simulator\n\nï¼ˆ2ï¼‰ä¸‹è½½å®Œæˆå¹¶è§£å‹åï¼Œä¿®æ”¹Dockerfileæ–‡ä»¶\n\n```dockerfile\nFROM alpine\nLABEL maintainer=\"vapor@vapor.io\"\n\nRUN apk --update --no-cache add openipmi-lanserv\n\n# Create the directories that will be used to persist state information\n# for the IPMI simulator instance.\nRUN mkdir -p /tmp/chassis\n\nCOPY . /tmp/ipmisim\n\n# æ–°åŠ éƒ¨åˆ†\nRUN chmod +x /tmp/ipmisim/bin/chassis_control.sh\n# æ–°åŠ éƒ¨åˆ†\nEXPOSE 623\n\nEXPOSE 623/udp\n\nCMD [\"ipmi_sim\", \"-n\", \"-c\", \"/tmp/ipmisim/lan.conf\", \"-f\", \"/tmp/ipmisim/sim.emu\"]\n```\n\nï¼ˆ3ï¼‰ç”Ÿæˆé•œåƒæ–‡ä»¶ï¼Œè¿è¡Œå®¹å™¨\n\n```shell\ndocker build -f Dockerfile -t vaporio/ipmi-simulator .\n```\n\n```shell\ndocker run -d --name ipmi-simulator --restart always -p 623:623/udp -p 623:623/tcp vaporio/ipmi-simulator\n```\n\nï¼ˆ4ï¼‰ é…ç½®é˜²ç«å¢™ç­–ç•¥\n\n```shell\nfirewall-cmd --add-port=623/tcp --permanent\nfirewall-cmd --add-port=623/udp --permanent\nsudo firewall-cmd --reload\nsudo firewall-cmd --list-all\n```\n\nï¼ˆ5ï¼‰åœ¨ä¸»æœºä¸ŠæŸ¥çœ‹æ¨¡æ‹ŸIPMIçš„åº•ç›˜å’Œç”µæºçŠ¶æ€\n\n```shell\n ipmitool -I lan -H ä¸»æœºip -p 623 -U ADMIN -P ADMIN chassis status\n```\n\n> System Power         : on\n> Power Overload       : false\n> Power Interlock      : inactive\n> Main Power Fault     : false\n> Power Control Fault  : false\n> Power Restore Policy : always-off\n> Last Power Event     :\n> Chassis Intrusion    : inactive\n> Front-Panel Lockout  : inactive\n> Drive Fault          : false\n> Cooling/Fan Fault    : false\n\næ‰©å±•å‘½ä»¤ï¼š\n\nIPMIè®¾å¤‡çš„ç”µæºçŠ¶æ€\n\n```shell\n#æ‰“å¼€\nipmitool -I lan -H ä¸»æœºip -p 623 -U ADMIN -P ADMIN chassis power on\n#å…³é—­\nipmitool -I lan -H ä¸»æœºip -p 623 -U ADMIN -P ADMIN chassis power off\n#é‡å¯\nipmitool -I lan -H ä¸»æœºip -p 623 -U ADMIN -P ADMIN chassis power reset\n#æ ‡è¯†æœºç®±ï¼ˆä½¿æŒ‡ç¤ºç¯é—ªçƒï¼‰\nipmitool -I lan -H ä¸»æœºip -p 623 -U ADMIN -P ADMIN chassis identify 5\n```\n\nè¯»å–ç³»ç»ŸçŠ¶æ€\n\n```shell\n#æ˜¾ç¤ºç³»ç»Ÿä¼ æ„Ÿå™¨\nipmitool -I lan -H ä¸»æœºip -p 623 -U ADMIN -P ADMIN sensor list\n#æ˜¾ç¤ºç³»ç»Ÿç°æœ‰å¯æ›¿ä»£å™¨ä»¶åˆ—è¡¨\nipmitool -I lan -H ä¸»æœºip -p 623 -U ADMIN -P ADMIN fru list\n#æ˜¾ç¤ºç³»ç»ŸSDR Repositoryè®¾å¤‡åˆ—è¡¨\nipmitool -I lan -H ä¸»æœºip -p 623 -U ADMIN -P ADMIN sdr list\n#æ˜¾ç¤ºç³»ç»Ÿå¹³å°äº‹ä»¶è¿‡æ»¤çš„åˆ—è¡¨\nipmitool -I lan -H ä¸»æœºip -p 623 -U ADMIN -P ADMIN pef filter list\n#æ˜¾ç¤ºç³»ç»Ÿå¹³å°ç­–ç•¥åˆ—è¡¨\nipmitool -I lan -H ä¸»æœºip -p 623 -U ADMIN -P ADMIN pef policy list\n```\n\nç³»ç»Ÿæ—¥å¿—\n\n```shell\n#æ˜¾ç¤ºæ‰€æœ‰ç³»ç»Ÿäº‹ä»¶æ—¥å¿—\nipmitool -I lan -H ä¸»æœºip -p 623 -U ADMIN -P ADMIN sel elist\n#æ˜¾ç¤ºå½“å‰BMCçš„æ—¶é—´\nipmitool -I lan -H ä¸»æœºip -p 623 -U ADMIN -P ADMIN sel time get\n#ä¿®æ”¹å½“å‰BMCçš„æ—¶é—´\nipmitool -I lan -H ä¸»æœºip -p 623 -U ADMIN -P ADMIN sel time set \"09/25/2024 18:29:20\"\n\n\n```\n\nç³»ç»Ÿç›¸å…³\n\n```shell\n#æŸ¥çœ‹BMCä¿¡æ¯\nipmitool -I lan -H ä¸»æœºip -p 623 -U ADMIN -P ADMIN bmc info\n#BMCå†·å¯åŠ¨\nipmitool -I lan -H ä¸»æœºip -p 623 -U ADMIN -P ADMIN bmc reset cold\n#BMCå¯åŠ¨\nipmitool -I lan -H ä¸»æœºip -p 623 -U ADMIN -P ADMIN bmc reset warm\n#æ˜¾ç¤ºç³»ç»Ÿé»˜è®¤é€šé“\nipmitool -I lan -H ä¸»æœºip -p 623 -U ADMIN -P ADMIN channel info\n#æ˜¾ç¤ºæ‰€æœ‰ç”¨æˆ·\nipmitool -I lan -H ä¸»æœºip -p 623 -U ADMIN -P ADMIN user list\n```\n","tags":["è¿ç»´","IPMI","Linux","docker"],"categories":["å®¹å™¨åŒ–","docker"]},{"title":"Slimç¼©å°å®¹å™¨é•œåƒå¤§å°","url":"/yyg/fd02fe22/","content":"## å‰è¨€\n\n{% folding cyan,ğŸ”œSlimğŸ”š %}\n\n[GitHub - slimtoolkit/slimï¼š Slimï¼ˆtoolkitï¼‰ï¼šä¸è¦æ›´æ”¹å®¹å™¨é•œåƒä¸­çš„ä»»ä½•å†…å®¹ï¼Œå¹¶å°†å…¶ç¼©å°å¤šè¾¾ 30 å€ï¼ˆå¯¹äºç¼–è¯‘è¯­è¨€ç”šè‡³æ›´å¤šï¼‰ï¼Œä½¿å…¶ä¹Ÿå®‰å…¨ï¼ï¼ˆå…è´¹å’Œå¼€æºï¼‰](https://github.com/slimtoolkit/slim)\n\nSlimæ˜¯ä¸€ä¸ªåœ¨ä¸æ›´æ”¹å®¹å™¨é•œåƒçš„æƒ…å†µä¸‹ï¼Œå°†å…¶å¤§å°ç¼©å°å¤šå¤§30å€çš„å®¹å™¨å·¥å…·ã€‚å¹¶ä¸”è¯¥å·¥å…·å…¼å®¹å¤šç§å¹³å°å’Œæ¶æ„ã€‚æœ¬æ–‡ä¸»è¦ä»‹ç»Linuxå¹³å°X86_64æ¶æ„çš„Slimçš„ä½¿ç”¨ã€‚\n\ngithubä¸Šå®˜æ–¹ç»™å‡ºäº†ä»¥ä¸‹å®¹å™¨é•œåƒä¼˜åŒ–å‰åå¤§å°çš„ç¤ºä¾‹ï¼š\n\n> Node.jsåº”ç”¨ç¨‹åºæ˜ åƒï¼š\n> \n> - ä» ubuntuï¼š14.04 - 432MB => 14MB ï¼ˆç¼©å°Â **30.85X**)\n> - æ¥è‡ª debianï¼šjessie - 406MB => 25.1MB ï¼ˆç¼©å°Â **16.21X**ï¼‰)\n> - æ¥è‡ª nodeï¼šalpine - 66.7MB => 34.7MBï¼ˆç¼©å°Â **1.92 å€**ï¼‰)\n> - æ¥è‡ª nodeï¼šdistroless - 72.7MB => 39.7MB ï¼ˆç¼©å°Â **1.83 å€ï¼‰**)\n> \n> Python åº”ç”¨ç¨‹åºæ˜ åƒï¼š\n> \n> - ä» ubuntuï¼š14.04 - 438MB => 16.8MB ï¼ˆç¼©å°Â **25.99X**)\n> - æ¥è‡ª pythonï¼š2.7-alpine - 84.3MB => 23.1MB ï¼ˆç¼©å°Â **3.65 å€ï¼‰**)\n> - ä» pythonï¼š2.7.15 - 916MB => 27.5MB ï¼ˆç¼©å°Â **33.29X**)\n> - ä» centosï¼š7 - 647MB => 23MB ï¼ˆç¼©å°Â **28.57 å€ï¼‰**)\n> - ä» centos/python-27-centos7 - 700MB => 24MBï¼ˆç¼©å°Â **29.01X**ï¼‰)\n> - ä» python2.7ï¼šdistroless å¼€å§‹ - 60.7MB => 18.3MB ï¼ˆç¼©å°Â **3.32 å€ï¼‰**)\n> \n> Ruby åº”ç”¨ç¨‹åºæ˜ åƒï¼š\n> \n> - ä» ubuntuï¼š14.04 - 433MB => 13.8MB ï¼ˆç¼©å°Â **31.31X**)\n> - æ¥è‡ª rubyï¼š2.2-alpine - 319MB => 27MB ï¼ˆç¼©å°Â **11.88X**)\n> - ä» rubyï¼š2.5.3 - 978MB => 30MB ï¼ˆç¼©å°Â **32.74X**)\n> \n> Go åº”ç”¨ç¨‹åºæ˜ åƒï¼š\n> \n> - æ¥è‡ª golangï¼šlatest - 700MB => 1.56MB ï¼ˆç¼©å°Â **448.76X**)\n> - ä» ubuntuï¼š14.04 - 531MB => 1.87MB ï¼ˆç¼©å°Â **284.10X**)\n> - æ¥è‡ª golangï¼šalpine - 258MB => 1.56MB ï¼ˆç¼©å°Â **165.61X**)\n> - ä» centosï¼š7 - 615MB => 1.87MB ï¼ˆç¼©å°Â **329.14X**)\n> \n> Rust åº”ç”¨ç¨‹åºé•œåƒï¼š\n> \n> - ä» rustï¼š1.31 - 2GB => 14MB ï¼ˆç¼©å°Â **147.16X**)\n> \n> Java åº”ç”¨ç¨‹åºæ˜ åƒï¼š\n> \n> - ä» ubuntuï¼š14.04 - 743.6 MB => 100.3 MB\n> \n> PHP åº”ç”¨ç¨‹åºæ˜ åƒï¼š\n> \n> - ä» phpï¼š7.0-cli - 368MB => 26.6MB ï¼ˆç¼©å°Â **13.85 å€**ï¼‰)\n> \n> Haskell åº”ç”¨ç¨‹åºå›¾åƒï¼š\n> \n> - ï¼ˆScotty æœåŠ¡ï¼‰ ä» haskell å¼€å§‹ï¼š8 - 2.09GB => 16.6MB ï¼ˆç¼©å°Â **125.32X**)\n> - ï¼ˆScotty æœåŠ¡ï¼‰ ä» haskell å¼€å§‹ï¼š7 - 1.5GB => 21MB ï¼ˆç¼©å° 71Xï¼‰\n> \n> Elixir åº”ç”¨ç¨‹åºå›¾ç‰‡ï¼š\n> \n> - ï¼ˆPhoenix æœåŠ¡ï¼‰ ä» elixirï¼š1.6 - 1.1 GB => 37 MB ï¼ˆç¼©å°Â **29.25 å€ï¼‰**)\n\n{% endfolding %}\n\n## å®‰è£…å¹¶ä½¿ç”¨Slim\n\nSlimæä¾›äº†å¤šç§å®‰è£…æ–¹å¼ï¼ŒåŒ…æ‹¬è§£äºŒè¿›åˆ¶æ–‡ä»¶è§£å‹å®‰è£…ã€ä½¿ç”¨è„šæœ¬ä¸€é”®å®‰è£…ã€æ‹‰å–é•œåƒå®‰è£…ã€‚æ­¤å¤„ä»¥nginxã€tomcatã€httpdé•œåƒä¸ºä¾‹ï¼Œè¿›è¡Œé•œåƒç¼©å°ã€‚\n\n### äºŒè¿›åˆ¶æ–‡ä»¶è§£å‹å®‰è£…\n\n```shell\n# ä¸‹è½½äºŒè¿›åˆ¶æ–‡ä»¶\ncurl -L -o ds.tar.gz https://github.com/slimtoolkit/slim/releases/download/1.40.11/dist_linux.tar.gz\n#è§£å‹æ–‡ä»¶å¹¶ç§»åŠ¨å®‰è£…ç¨‹åº\ntar -xvf ds.tar.gz\nmv  dist_linux/slim /usr/local/bin/\nmv  dist_linux/slim-sensor /usr/local/bin/\n#æŸ¥çœ‹ç‰ˆå—\nslim -v\n\n\n#æ‰§è¡Œç¼©å°å‘½ä»¤\nslim build é•œåƒIDÂ \n```\n\n### è„šæœ¬ä¸€é”®å®‰è£…\n\næ­¤æ–¹å¼å¯åœ¨ Linuxï¼ˆx86 å’Œ ARMï¼‰å’Œ macOSï¼ˆx86 å’Œ Apple Siliconï¼‰ä¸Šä½¿ç”¨ã€‚\n\n```shell\ncurl -sL https://raw.githubusercontent.com/slimtoolkit/slim/master/scripts/install-slim.sh | sudo -E bash -\n\n#æ‰§è¡Œç¼©å°å‘½ä»¤\nslim build é•œåƒID\n```\n\né•œåƒç¼©å°å‰å¤§å°\n\n> docker images\n> REPOSITORY   TAG       IMAGE ID       CREATED       SIZE\n> <mark>nginx</mark>        latest    39286ab8a5e1   3 weeks ago   <mark>188MB</mark>\n> <mark>tomcat</mark>       latest    c2a444ea6cd7   4 weeks ago   <mark>508MB</mark>\n\næ‰§è¡Œå‘½ä»¤ç¼©å°\n\n> <mark> slim build 39286ab8a5e1 </mark>\n> cmd=build info=param.http.probe message='using default probe'\n> cmd=build state=started\n> cmd=build info=params image-build-engine='internal' target.type='image' target.image='39286ab8a5e1' continue.mode='probe' rt.as.user='true' keep.perms='true' tags=''\n> cmd=build state=image.inspection.start\n> cmd=build info=image id='sha256:39286ab8a5e14aeaf5fdd6e2fac76e0c8d31a0c07224f0ee5e6be502f12e93f3' size.bytes='187706879' size.human='188 MB'\n> cmd=build info=image.stack id='sha256:39286ab8a5e14aeaf5fdd6e2fac76e0c8d31a0c07224f0ee5e6be502f12e93f3' index='0' name='nginx:latest'\n> ......\n> \n> <mark>slim build c2a444ea6cd7</mark>\n> cmd=build info=param.http.probe message='using default probe'\n> cmd=build state=started\n> cmd=build info=params continue.mode='probe' rt.as.user='true' keep.perms='true' tags='' image-build-engine='internal' target.type='image' target.image='c2a444ea6cd7'\n> cmd=build state=image.inspection.start\n> cmd=build info=image size.bytes='507583233' size.human='508 MB' id='sha256:c2a444ea6cd7a0df0600cbd7ed249e1b5f8635ec7f55420a07444703f0aab70e'\n> cmd=build info=image.stack id='sha256:c2a444ea6cd7a0df0600cbd7ed249e1b5f8635ec7f55420a07444703f0aab70e' index='0' name='tomcat:latest'\n> cmd=build info=image.exposed_ports list='8080/tcp'\n> cmd=build state=image.inspection.done\n> cmd=build state=container.inspection.start\n> cmd=build info=container status='created' name='slimk_5648_20240905085045' id='a62eca6f410e99620c4050b063ab6d8ebe1d0b60340e0ac47da88dce4902f97c'\n> ......\n\né•œåƒç¼©å°åå¤§å°\n\n>  docker images\n> REPOSITORY    TAG       IMAGE ID       CREATED          SIZE\n> <mark>tomcat.slim</mark>   latest    97901079a904   21 seconds ago   <mark>212MB</mark>\n> <mark>nginx.slim</mark>    latest    9131fc2c397d   3 minutes ago    <mark>13.3MB</mark>\n> <mark>nginx </mark>        latest    39286ab8a5e1   3 weeks ago      <mark>188MB</mark>\n> <mark>tomcat</mark>        latest    c2a444ea6cd7   4 weeks ago      <mark>508MB</mark>\n\n### å®¹å™¨å®‰è£…\n\n```shell\n#æ‹‰å–é•œåƒ\ndocker pull dslim/slim\n#æ‰§è¡Œç¼©å°å‘½ä»¤\ndocker run -it --rm -v /var/run/docker.sock:/var/run/docker.sock dslim/slim build é•œåƒID\n```\n\né•œåƒç¼©å°å‰å¤§å°\n\n> docker images\n> REPOSITORY    TAG       IMAGE ID       CREATED          SIZE\n> tomcat.slim   latest    97901079a904   7 minutes ago    212MB\n> nginx.slim    latest    9131fc2c397d   10 minutes ago   13.3MB\n> nginx         latest    39286ab8a5e1   3 weeks ago      188MB\n> tomcat        latest    c2a444ea6cd7   4 weeks ago      508MB\n> <mark>httpd </mark>        latest    9cb0a2315602   7 weeks ago      <mark>148MB</mark>\n> dslim/slim    latest    6205a57fba8b   7 months ago     56.3MB\n\næ‰§è¡Œé•œåƒç¼©å°å‘½ä»¤\n\n> <mark>docker run -it --rm -v /var/run/docker.sock:/var/run/docker.sock dslim/slim</mark> <mark>build  9cb0a2315602</mark>\n> \n> cmd=build info=param.http.probe message='using default probe'\n> cmd=build state=started\n> cmd=build info=params continue.mode='probe' rt.as.user='true' keep.perms='true' tags='' image-build-engine='internal' target.type='image' target.image='9cb0a2315602'\n> cmd=build state=image.inspection.start\n> cmd=build info=image id='sha256:9cb0a231560203a9b46325ef6dfe0d21d524813acb74447fd276b9813a9fdd44' size.bytes='148177949' size.human='148 MB'\n> cmd=build info=image.stack index='0' name='httpd:latest' id='sha256:9cb0a231560203a9b46325ef6dfe0d21d524813acb74447fd276b9813a9fdd44'\n> cmd=build info=image.exposed_ports list='80/tcp'\n> cmd=build state=image.inspection.done\n> cmd=build state=container.inspection.start\n> cmd=build info=container status='created' name='slimk_1_20240905090155' id='6d058318cd7729d4e3831a4aecb5d2884853bc2efbf1d6a6d233f04ade3225a5'\n> cmd=build info=container status='running' name='slimk_1_20240905090155' id='6d058318cd7729d4e3831a4aecb5d2884853bc2efbf1d6a6d233f04ade3225a5'\n> cmd=build info=container message='obtained IP address' ip='172.17.0.3'\n> cmd=build info=cmd.startmonitor status='sent'\n> cmd=build info=event.startmonitor.done status='received'\n> cmd=build info=container name='slimk_1_20240905090155' id='6d058318cd7729d4e3831a4aecb5d2884853bc2efbf1d6a6d233f04ade3225\n> \n> ......\n\né•œåƒç¼©å°åå¤§å°\n\n>  docker images\n> REPOSITORY    TAG       IMAGE ID       CREATED          SIZE\n> <mark>httpd.slim</mark>    latest    692af09a91c2   57 seconds ago  <mark> 8.13MB</mark>\n> tomcat.slim   latest    97901079a904   9 minutes ago    212MB\n> nginx.slim    latest    9131fc2c397d   12 minutes ago   13.3MB\n> nginx         latest    39286ab8a5e1   3 weeks ago      188MB\n> tomcat        latest    c2a444ea6cd7   4 weeks ago      508MB\n> <mark>httpd </mark>        latest    9cb0a2315602   7 weeks ago     <mark> 148MB</mark>\n> dslim/slim    latest    6205a57fba8b   7 months ago     56.3MB\n","tags":["è¿ç»´","Slim","Linux","docker","ç¼©å°å®¹å™¨é•œåƒå¤§å°"],"categories":["å®¹å™¨åŒ–","docker"]},{"title":"docker éƒ¨ç½² SkyWalking","url":"/yyg/f5933c9f/","content":"\n## å‰è¨€\n\n{% folding cyan,ğŸ”œä»€ä¹ˆæ˜¯SkyWalkingï¼ŸğŸ”š %}\n\n> æ˜¯ä¸€æ¬¾ä¼˜ç§€çš„å›½äº§ APM å·¥å…·ã€‚\n> \n> åˆ†å¸ƒå¼ç³»ç»Ÿçš„åº”ç”¨ç¨‹åºæ€§èƒ½ç›‘è§†å·¥å…·ï¼Œä¸“ä¸ºå¾®æœåŠ¡ã€äº‘åŸç”Ÿæ¶æ„å’ŒåŸºäºå®¹å™¨ï¼ˆDockerã€K8sã€Mesosï¼‰æ¶æ„è€Œè®¾è®¡ã€‚\n> \n> æä¾›åˆ†å¸ƒå¼è¿½è¸ªã€æœåŠ¡ç½‘æ ¼é¥æµ‹åˆ†æã€åº¦é‡èšåˆå’Œå¯è§†åŒ–ä¸€ä½“åŒ–è§£å†³æ–¹æ¡ˆã€‚\n> \n> SkyWalkingæ¶æ„åˆ†ä¸ºUIã€OAPã€å­˜å‚¨ã€æ¢é’ˆ4éƒ¨åˆ†ã€‚\n> \n> å…¶ä¸­UIä¸º<mark>SkyWalking UI </mark>ï¼šè´Ÿè´£æä¾›æ§å°ã€æŸ¥çœ‹é“¾è·¯ç­‰ç­‰ï¼›<mark>ï¼ˆå¯è§†åŒ–æ˜¾ç¤ºï¼‰</mark>\n> \n> OAPä¸º<mark>SkyWalking OAP </mark>ï¼šè´Ÿè´£æ¥æ”¶ Agentï¼ˆæ¢é’ˆï¼‰ å‘é€çš„ Tracing æ•°æ®ä¿¡æ¯ï¼Œç„¶åè¿›è¡Œ<mark>åˆ†æ</mark>(Analysis Core) ï¼Œå­˜å‚¨åˆ°å¤–éƒ¨å­˜å‚¨å™¨( Storage )ï¼Œæœ€ç»ˆæä¾›æŸ¥è¯¢( Query )åŠŸèƒ½ã€‚<mark>ï¼ˆæ•°æ®åˆ†æï¼‰</mark>\n> \n> <mark>å­˜å‚¨</mark>ä¸ºTracing æ•°æ®å­˜å‚¨ã€‚ç›®å‰æ”¯æŒ ESã€MySQLã€Sharding Sphereã€TiDBã€H2 å¤šç§å­˜å‚¨å™¨ã€‚è€Œæˆ‘ä»¬ç›®å‰é‡‡ç”¨çš„æ˜¯ ES ï¼Œä¸»è¦è€ƒè™‘æ˜¯ SkyWalking å¼€å‘å›¢é˜Ÿè‡ªå·±çš„ç”Ÿäº§ç¯å¢ƒé‡‡ç”¨ ES ä¸ºä¸»ã€‚<mark>ï¼ˆå­˜å‚¨æ•°æ®ï¼‰</mark>\n> \n> æ¢é’ˆä¸ºÂ <mark>AgentÂ </mark>ï¼šè´Ÿè´£ä»åº”ç”¨ä¸­ï¼Œæ”¶é›†é“¾è·¯ä¿¡æ¯ï¼Œå‘é€ç»™ SkyWalking OAP æœåŠ¡å™¨ã€‚ç›®å‰æ”¯æŒ SkyWalkingã€Zikpinã€Jaeger ç­‰æä¾›çš„ Tracing æ•°æ®ä¿¡æ¯ã€‚è€Œæˆ‘ä»¬ç›®å‰é‡‡ç”¨çš„æ˜¯ï¼ŒSkyWalking Agent æ”¶é›† SkyWalking Tracing æ•°æ®ï¼Œä¼ é€’ç»™æœåŠ¡å™¨ã€‚<mark>ï¼ˆæ”¶é›†æ•°æ®ï¼‰</mark>\n\n{% endfolding %}\n\n## ç¯å¢ƒå‡†å¤‡\n\nï¼ˆ1ï¼‰ä½¿ç”¨è„šæœ¬å®‰è£…dockerã€docker-compose\n\n```shell\nbash <(curl -sSL https://linuxmirrors.cn/docker.sh)\n```\n\nï¼ˆ2ï¼‰é…ç½®é•œåƒåŠ é€Ÿ\n\n```json\nvi /etc/docker/daemon.json\n\n{\n  \"data-root\": \"/data/dockerData\",\n  \"registry-mirrors\": [\"https://registry.cn-hangzhou.aliyuncs.com\",\n    \"https://huecker.io\",\n    \"https://docker.rainbond.cc\",\n    \"https://dockerhub.timeweb.cloud\",\n    \"https://dockerhub.icu\",\n    \"https://docker.registry.cyou\",\n    \"https://docker-cf.registry.cyou\",\n    \"https://dockercf.jsdelivr.fyi\",\n    \"https://docker.jsdelivr.fyi\",\n    \"https://dockertest.jsdelivr.fyi\",\n    \"https://mirror.aliyuncs.com\",\n    \"https://dockerproxy.com\",\n    \"https://mirror.baidubce.com\",\n    \"https://docker.m.daocloud.io\",\n    \"https://docker.nju.edu.cn\",\n    \"https://docker.mirrors.sjtug.sjtu.edu.cn\",\n    \"https://docker.mirrors.ustc.edu.cn\",\n    \"https://mirror.iscas.ac.cn\",\n    \"https://docker.rainbond.cc\",\n    \"https://docker.kubesre.xyz\"],\n    \"log-driver\":\"json-file\",\n    \"log-opts\":{\"max-size\" :\"50m\",\"max-file\":\"3\"}\n}\n```\n\nï¼ˆ3ï¼‰å¯åŠ¨dockeræœåŠ¡\n\n```shell\nsystemctl start docker\nsystemctl enable docker\nsystemctl status docker\n```\n\nï¼ˆ4ï¼‰è®¾ç½®ä¸å†…å­˜æ˜ å°„ç›¸å…³çš„å†…æ ¸å‚æ•°ä¸º262144ï¼ŒæŸ¥çœ‹åº”ç”¨åˆ°ç³»ç»Ÿçš„å†…æ ¸å‚æ•°ã€‚\n\n```shell\necho \"vm.max_map_count=262144\" >> /etc/sysctl.conf\nsysctl -p\n```\n\n## éƒ¨ç½²æ­¥éª¤\n\nï¼ˆ1ï¼‰åˆ›å»ºéƒ¨ç½²æ–‡ä»¶æ‰€éœ€çš„å­˜å‚¨ç›®å½•\n\n```shell\nmkdir -p /data/elasticsearch/data /data/elasticsearch/logs /data/skywalking/oap\nchmod -R 777 /data/elasticsearch\n```\n\nï¼ˆ2ï¼‰åˆ›å»ºä¸´æ—¶skywalking-oap-serverå®¹å™¨ï¼Œå°†skywalkingé…ç½®æ–‡ä»¶æ‹·è´åˆ°æ˜ å°„ç›®å½•ä¸­ã€‚\n\n```shell\ncd /data/skywalking/oap\n# åˆ›å»ºä¸´æ—¶skywalking-oap-serverå®¹å™¨ï¼Œæ‹·è´skywalkingé…ç½®æ–‡ä»¶åˆ°ä¸»æœºç›®å½•\ndocker run -itd --name=oap-temp apache/skywalking-oap-server:9.5.0\ndocker cp  oap-temp:/skywalking/config/. .\ndocker rm -f oap-temp\n```\n\nï¼ˆ3ï¼‰ä¿®æ”¹skywalkingçš„é…ç½®æ–‡ä»¶application.ymlï¼Œå°†elasticsearchä½œä¸ºæ•°æ®å­˜å‚¨ã€‚\n\n```shell\nvi application.yml\n\nstorage:\n  selector: ${SW_STORAGE:elasticsearch} #å°†h2ä¿®æ”¹ä¸ºelasticsearch\n  elasticsearch:\n    namespace: ${SW_NAMESPACE:\"\"}\n    clusterNodes: ${SW_STORAGE_ES_CLUSTER_NODES:æœ¬æœºip:9200} #localhostä¿®æ”¹ä¸ºä¸»æœºip\n    protocol: ${SW_STORAGE_ES_HTTP_PROTOCOL:\"http\"}\n    connectTimeout: ${SW_STORAGE_ES_CONNECT_TIMEOUT:3000}\n    socketTimeout: ${SW_STORAGE_ES_SOCKET_TIMEOUT:30000}\n    responseTimeout: ${SW_STORAGE_ES_RESPONSE_TIMEOUT:15000}\n    numHttpClientThread: ${SW_STORAGE_ES_NUM_HTTP_CLIENT_THREAD:0}\n    user: ${SW_ES_USER:\"elastic\"} #å¡«å†™esçš„è´¦å·\n    password: ${SW_ES_PASSWORD:\"elastic\"} #å¡«å†™eså¯†ç \n    trustStorePath: ${SW_STORAGE_ES_SSL_JKS_PATH:\"\"}\n    trustStorePass: ${SW_STORAGE_ES_SSL_JKS_PASS:\"\"}\n```\n\nï¼ˆ4ï¼‰åˆ›å»ºdocker-composeæ–‡ä»¶ï¼Œç¼–æ’éƒ¨ç½²skywalkingã€esã€skywalking-uiã€‚\n\n```yaml\nvi skywalking.yml\n\nservices:\n  elasticsearch:\n    image: elasticsearch:8.15.0\n    container_name: elasticsearch\n    restart: always\n    environment:\n      - discovery.type=single-node\n      - ES_JAVA_OPTS=-Xms1g -Xmx1g\n      - ELASTIC_PASSWORD=elastic\n      - TZ=Asia/Shanghai\n    ports:\n      - \"9200:9200\"\n      - \"9300:9300\"\n    healthcheck:\n      test: [ \"CMD-SHELL\", \"curl --silent --fail -u elastic:elasitc localhost:9200/_cluster/health || exit 1\" ]\n      interval: 30s\n      timeout: 10s\n      retries: 3\n      start_period: 10s\n  logging:\n      driver: \"json-file\"\n      options:\n        max-size: \"50m\"\n        max-file: \"3\"\n    volumes:\n      - /data/elasticsearch/data:/usr/share/elasticsearch/data\n      - /data/elasticsearch/logs:/usr/share/elasticsearch/logs\n      - /data/elasticsearch/plugins:/usr/share/elasticsearch/plugins\n    networks:\n      skywalking-network:\n        ipv4_address: 172.20.110.11\n    ulimits:\n      memlock:\n        soft: -1\n        hard: -1\n\n  skywalking-oap:\n    image: apache/skywalking-oap-server:9.5.0\n    container_name: skywalking-oap\n    restart: always\n    ports:\n      - \"11800:11800\"\n      - \"12800:12800\"\n      - \"1234:1234\"  \n    healthcheck:\n      test: [ \"CMD-SHELL\", \"/skywalking/bin/swctl health\" ]\n      interval: 30s\n      timeout: 10s\n      retries: 3\n      start_period: 10s\n    depends_on:\n      elasticsearch:\n        condition: service_healthy\n    environment:\n      - SW_STORAGE=elasticsearch\n      - SW_HEALTH_CHECKER=default\n      - TZ=Asia/Shanghai\n      - JVM_Xms=512M\n      - JVM_Xmx=1024M\n      - SW_STORAGE_ES_CLUSTER_NODES=æœ¬æœºip:9200\n    volumes:\n      - /data/skywalking/oap:/skywalking/config\n    networks:\n      skywalking-network:\n        ipv4_address: 172.20.110.12\n\n\n  skywalking-ui:\n    image: apache/skywalking-ui:9.5.0\n    container_name: skywalking-ui\n    restart: always\n    environment:\n      - SW_OAP_ADDRESS=http://æœ¬æœºip:12800\n      - SW_ZIPKIN_ADDRESS=http://æœ¬æœºip:9412\n      - TZ=Asia/Shanghai\n    ports:\n      - \"8080:8080\"\n    depends_on:\n      skywalking-oap:\n        condition: service_healthy\n    networks:\n      skywalking-network:\n        ipv4_address: 172.20.110.13\n\nnetworks:\n  skywalking-network:\n    driver: bridge\n    ipam:\n      config:\n        - subnet: 172.20.110.0/24\n```\n```shell\ndocker compose -f skywalking.yml up -d\n```\n\nSkywalkingå¯é€šè¿‡ä»¥ä¸‹ä¸¤ç§æ–¹å¼è¿æ¥esï¼Œä½œä¸ºå­˜å‚¨ã€‚ï¼ˆä½¿ç”¨å…¶ä¸­ä¸€ç§å³å¯ï¼‰\n\n**Skywalking é€šè¿‡ HTTPè®¤è¯è¿æ¥ Elasticsearch**\n\n```shell\n#å…³é—­esçš„sslè¯ä¹¦è®¤è¯\ndocker exec -it elasticsearch bash -c ' sed -i \"s/  enabled: true/  enabled: false/g\" /usr/share/elasticsearch/config/elasticsearch.yml'\ndocker exec -it elasticsearch bash -c 'cat /usr/share/elasticsearch/config/elasticsearch.yml'\ndocker restart elasticsearch\ndocker restart skywalking-oap\n```\n\n**Skywalking é€šè¿‡ HTTPS SSL è®¤è¯è¿æ¥ Elasticsearch**\n\n(1)å°†esçš„crtå’Œkeyè¯ä¹¦æ–‡ä»¶ï¼Œè½¬åŒ–ä¸ºp12æ ¼å¼\n\n```shell\nopenssl pkcs12 -export -in ca.crt -inkey ca.key -out es.p12 -name esca -CAfile es.crt\n```\n\nè¾“å…¥ä¸¤æ¬¡keypassï¼Œå…¶ä¸­-nameå‚æ•°ä¸ºåˆ«åã€‚\n\n> openssl pkcs12 -export -in ca.crt -inkey ca.key -out es.p12 -name esca -CAfile es.crt\n> Enter Export Password:\n> Verifying - Enter Export Password: \n\nï¼ˆ2ï¼‰å°†p12æ ¼å¼è¯ä¹¦è½¬åŒ–ä¸ºjksè¯ä¹¦\n\nå®‰è£…JDKã€‚`keytool`Â æ˜¯ JDK ä¸­çš„ä¸€éƒ¨åˆ†ï¼Œéœ€è¦å®‰è£…JDKï¼Œè¿›è¡Œè¯ä¹¦è½¬åŒ–æ“ä½œã€‚\n\n```shell\n yum install - java-11-openjdk-devel\n```\n\nstorepass å‚æ•°ä¸ºjksè¯ä¹¦å¯†ç ï¼Œsrcstorepasså‚æ•°ä¸ºp12è¯ä¹¦å¯†ç ã€‚\n\n```shell\nkeytool -importkeystore -v -srckeystore es.p12 -srcstoretype PKCS12  -srcstorepass wasd2345  -deststoretype JKS -destkeystore es.jks -storepass qiswasd2345\n```\n\n> storage:\n> selector: ${SW_STORAGE:elasticsearch}\n> elasticsearch:\n>  namespace: ${SW_NAMESPACE:\"\"}\n>  clusterNodes: ${SW_STORAGE_ES_CLUSTER_NODES:<mark>esæ‰€åœ¨æœåŠ¡å™¨åœ°å€:443</mark>}\n>  protocol: 443${SW_STORAGE_ES_HTTP_PROTOCOL:\"<mark>https</mark>\"}\n>  connectTimeout: ${SW_STORAGE_ES_CONNECT_TIMEOUT:3000}\n>  socketTimeout: ${SW_STORAGE_ES_SOCKET_TIMEOUT:30000}\n>  responseTimeout: ${SW_STORAGE_ES_RESPONSE_TIMEOUT:15000}\n>  numHttpClientThread: ${SW_STORAGE_ES_NUM_HTTP_CLIENT_THREAD:0}\n>  user: ${SW_ES_USER:\"<mark>esç”¨æˆ·å</mark>\"}\n>  password: ${SW_ES_PASSWORD:\"<mark>eså¯†ç </mark>\"}\n>  trustStorePath: ${SW_STORAGE_ES_SSL_JKS_PATH:\"<mark>jksè¯ä¹¦åœ°å€</mark>\"}\n>  trustStorePass: <mark></mark>${SW_STORAGE_ES_SSL_JKS_PASS:\"<mark>jksè¯ä¹¦å¯†ç </mark>\"}\n\n### å¼€å¯Linuxç›‘æ§\n\n#### å®‰è£…Prometheus node-exporterä» VM æ”¶é›†æŒ‡æ ‡æ•°æ®ã€‚ï¼ˆæºç æ–¹å¼ï¼‰\n\n```shell\nyum install -y wget\nwget https://github.com/prometheus/node_exporter/releases/download/v1.8.2/node_exporter-1.8.2.linux-amd64.tar.gz\ntar -xvzf node_exporter-1.8.2.linux-amd64.tar.gz\ncd \nmv node_exporter-1.8.2.linux-amd64/node_exporter /usr/sbin/\ncd /usr/sbin/\n./node_exporter\n```\n\néªŒè¯æ˜¯å¦è¿è¡Œ\n\n```shell\ncurl http://localhost:9100/metrics\n```\n\nåˆ›å»ºnode_exporteræœåŠ¡æ–‡ä»¶\n\n```shell\nvi /usr/lib/systemd/system/node_exporter.service\n\n[Unit]\nDescription=node exporter service\nDocumentation=https://prometheus.io\nAfter=network.target\n\n[Service]\nType=simple\nUser=root\nGroup=root\n#node_exporterçš„å­˜æ”¾ä½ç½®\nExecStart=/usr/sbin/node_exporter  \nRestart=on-failure\n\n[Install]\nWantedBy=multi-user.target\n```\n\né‡æ–°åŠ è½½ç³»ç»Ÿç®¡ç†å™¨é…ç½®æ–‡ä»¶ï¼Œå¯åŠ¨node_exporteræœåŠ¡å¹¶è®¾ç½®å¼€æœºè‡ªå¯\n\n```shell\nsystemctl daemon-reload\nsystemctl start node_exporter\nsystemctl enable node_exporter\nsystemctl status node_exporter\n```\n\n#### å®‰è£…Prometheus node-exporterï¼ˆå®¹å™¨æ–¹å¼ï¼‰\n\n```yaml\nservices:\n  node-exporter:\n    image: quay.io/prometheus/node-exporter\n    container_name: node-exporter\n    volumes:\n      - /proc:/host/proc:ro\n      - /sys:/host/sys:ro\n      - /:/rootfs:ro\n    command:\n      - '--path.procfs=/host/proc'\n      - '--path.rootfs=/rootfs'\n      - '--path.sysfs=/host/sys'\n    restart: always\n    environment:\n      - TZ=Asia/Shanghai\n    ports:\n      - 9100:9100\n    networks:\n       linux_exporter:\n        ipv4_address: 172.20.104.11\n\nnetworks:\n  linux_exporter:\n    driver: bridge\n    ipam:\n      config:\n        - subnet: 172.20.104.0/24\n```\n\n#### å®‰è£… OpenTelemetry Collector\n\nåˆ›å»ºOpenTelemetry Collectoré…ç½®æ–‡ä»¶\n\n```shell\nmkdir /data/opentelemetry-collector\nvi /data/opentelemetry-collector/config.yaml\n\nreceivers:\n  prometheus:\n    config:\n     scrape_configs:\n       - job_name: 'vm-monitoring' #è¦ä¸skywalking-oapä¸­çš„otel-rulesçš„vm.yamlä¸­çš„åç§°ä¿æŒä¸€è‡´\n         scrape_interval: 5s\n         static_configs:\n           - targets: ['10.10.2.145:9100']\n             labels:\n               host_name: 10.10.2.145\n               service: oap-server\nprocessors:\n  batch:\n\nexporters:\n  otlp:\n    endpoint: 10.10.2.145:11800\n    tls:\n      insecure: true\n  logging:\n    loglevel: debug\n\nservice:\n  pipelines:\n    metrics:\n      receivers: [prometheus]\n      processors: [batch]\n      exporters: [otlp, logging]\n```\n\n```yaml\nservices:\n  otelcol:\n    image: otel/opentelemetry-collector\n    container_name: otelcol\n    restart: always\n    environment:\n      - TZ=Asia/Shanghai\n    volumes:\n      - /data/opentelemetry-collector/config.yaml:/etc/otelcol/config.yaml\n    networks:\n       opentelemetry:\n        ipv4_address: 172.20.101.11\n\nnetworks:\n  opentelemetry:\n    driver: bridge\n    ipam:\n      config:\n        - subnet: 172.20.101.0/24\n```\n\n> opentelemetry-collectoræœ€æ–°é•œåƒé…ç½®æ–‡ä»¶å˜æ›´\n>\n> åœ¨æœ€æ–°ç‰ˆçš„å®¹å™¨é•œåƒä¸­ï¼ˆ0.113.0ï¼‰ä¸­ä½¿ç”¨å¯¼å‡ºå™¨exportersä¸­ä½¿ç”¨debugä»£æ›¿loggingã€‚\n>\n> å³åœ¨v0.86.0ç‰ˆæœ¬ä¹‹å‰ä½¿ç”¨logging\n>\n> ```\n> exporters:\n>   otlp:\n>     endpoint: ip+ç«¯å£\n>     tls:\n>       insecure: true\n>   logging:\n>     loglevel: debug\n> ```\n>\n> ä¹‹åä½¿ç”¨debug\n\n> ```\n> exporters:\n>   otlp:\n>     endpoint: ip+ç«¯å£\n>     tls:\n>       insecure: true\n>   debug:\n>     verbosity: detailed\n> ```\n\n### SkyWalkingæœåŠ¡è‡ªç›‘æ§å¼€å¯\n\nå¼€å¯åç«¯é¥æµ‹ï¼Œåœ¨skywalking-oapçš„é…ç½®æ–‡ä»¶application.ymlä¸­ï¼Œæ‰¾åˆ°promethusçš„éƒ¨åˆ†ï¼Œä¿®æ”¹å‚æ•°ã€‚\n\n```shell\ntelemetry:\n  selector: ${SW_TELEMETRY:prometheus} #å°†noneä¿®æ”¹ä¸ºprometheus\n  none:\n  prometheus:\n    host: ${SW_TELEMETRY_PROMETHEUS_HOST:0.0.0.0}\n    port: ${SW_TELEMETRY_PROMETHEUS_PORT:1234}\n    sslEnabled: ${SW_TELEMETRY_PROMETHEUS_SSL_ENABLED:false}\n    sslKeyPath: ${SW_TELEMETRY_PROMETHEUS_SSL_KEY_PATH:\"\"}\n    sslCertChainPath: ${SW_TELEMETRY_PROMETHEUS_SSL_CERT_CHAIN_PATH:\"\"}\n```\n\n åœ¨OpenTelemetry Collectoré…ç½®æ–‡ä»¶ä¸­åŠ å…¥è‡ªç›‘æ§çš„å‚æ•°\n\n```yaml\nreceivers:\n  prometheus:\n    config:\n     scrape_configs:\n       - job_name: 'vm-monitoring'\n         scrape_interval: 5s\n         static_configs:\n           - targets: ['10.10.2.145:9100']\n             labels:\n               host_name: 10.10.2.145\n               service: skywalking-oap-server\n  prometheus/2:  #æ–°å¢\n    config:\n     scrape_configs:\n       - job_name: 'skywalking-so11y'  #è¦ä¸skywalking-oapä¸­çš„otel-rulesçš„oap.yamlä¸­çš„åç§°ä¿æŒä¸€è‡´\n         scrape_interval: 5s\n         static_configs:\n           - targets: ['10.10.2.145:1234']   #ç«¯å£ä¸º1234\n             labels:\n               host_name: 10.10.2.145_self\n               service: skywalking-oap\n\n\nprocessors:\n  batch:\n  batch/2:\n\nexporters:\n  otlp:\n    endpoint: 10.10.2.145:11800\n    tls:\n      insecure: true\n  logging:\n    loglevel: debug\n  otlp/2:\n    endpoint: 10.10.2.145:11800\n    tls:\n      insecure: true\n  logging/2:\n    loglevel: debug\n\nservice:\n  pipelines:\n    metrics:\n      receivers: [prometheus, prometheus/2]\n      processors: [batch, batch/2]\n      exporters: [otlp, otlp/2, logging, logging/2]\n```\n\nä¾æ¬¡é‡å¯otelcolå®¹å™¨å’Œskywalking-oapï¼ŒæŸ¥çœ‹æ˜¯å¦ç”Ÿæˆè‡ªç›‘æ§ã€‚\n\n### å¼€å¯æ•°æ®åº“MySQL/MariaDBç›‘æ§\n\nï¼ˆ1ï¼‰éƒ¨ç½²mysqld_exporter\n\n```yaml\nservices:\n  mysqld_exporter:\n    image: prom/mysqld-exporter\n    container_name: mysqld_exporter\n    restart: always\n    environment:\n      - TZ=Asia/Shanghai\n    ports:\n      - \"9104:9104\"\n    command:\n      - \"--mysqld.username=user:password\"   #ç”¨æˆ·åå’Œå¯†ç \n      - \"--mysqld.address=10.10.2.145:3306\"   #ipå’Œç«¯å£å·\n    networks:\n       sw-mysql:\n        ipv4_address: 172.20.102.11\n\nnetworks:\n  sw-mysql:\n    driver: bridge\n    ipam:\n      config:\n        - subnet: 172.20.102.0/24\n```\n\nï¼ˆ2ï¼‰ åœ¨OpenTelemetry Collectoré…ç½®æ–‡ä»¶ä¸­mysqlçš„ç›‘æ§å‚æ•°\n\n```yaml\nreceivers:\n  prometheus:\n    config:\n     scrape_configs:\n       - job_name: 'vm-monitoring'\n         scrape_interval: 5s\n         static_configs:\n           - targets: ['10.10.2.145:9100']\n             labels:\n               host_name: 10.10.2.145\n               service: skywalking-oap-server\n  prometheus/2:\n    config:\n     scrape_configs:\n       - job_name: 'skywalking-so11y'\n         scrape_interval: 5s\n         static_configs:\n           - targets: ['10.10.2.145:1234']\n             labels:\n               host_name: 10.10.2.145_self\n               service: skywalking-oap\n\n  prometheus/3:  #mysqlã€mariadbçš„ç›‘æ§éƒ¨åˆ†\n    config:\n     scrape_configs:\n       - job_name: 'mysql-monitoring' #è¦ä¸skywalking-oapä¸­çš„otel-rules/mysqlç›®å½•ä¸­çš„yamlæ–‡ä»¶ä¸­çš„åç§°ä¿æŒä¸€è‡´\n         scrape_interval: 5s\n         static_configs:\n           - targets: ['10.10.2.145:9104']\n             labels:\n               host_name: mariadb-monitoring\n\nprocessors:\n  batch:\n  batch/2:\n  batch/3:\n\nexporters:\n  otlp:\n    endpoint: 10.10.2.145:11800\n    tls:\n      insecure: true\n  logging:\n    loglevel: debug\n  otlp/2:\n    endpoint: 10.10.2.145:11800\n    tls:\n      insecure: true\n  logging/2:\n    loglevel: debug\n  otlp/3:\n    endpoint: 10.10.2.145:11800\n    tls:\n      insecure: true\n  logging/3:\n    loglevel: debug\n\nservice:\n  pipelines:\n    metrics:\n      receivers:\n      - prometheus\n      - prometheus/2\n      - prometheus/3\n      processors:\n      - batch\n      - batch/2\n      - batch/3\n      exporters:\n      - otlp\n      - otlp/2\n      - otlp/3\n      - logging\n      - logging/2\n      - logging/3\n```\n\nä¾æ¬¡é‡å¯otelcolå®¹å™¨å’Œskywalking-oapï¼ŒæŸ¥çœ‹æ˜¯å¦ç”Ÿæˆmysqlæˆ–mariadbçš„ç›‘æ§æ•°æ®ã€‚\n\n### å¼€å¯Elasticsearchç›‘æ§\n\nï¼ˆ1ï¼‰éƒ¨ç½²elasticsearch_exporter\n\n```yaml\nservices:\n  elasticsearch_exporter:\n    image: quay.io/prometheuscommunity/elasticsearch-exporter:latest\n    container_name: elasticsearch_exporter\n    restart: always\n    environment:\n      - TZ=Asia/Shanghai\n    ports:\n      - \"9114:9114\"\n    command:\n      #- '--es.uri=http://elastic:elastic@10.10.2.145:9200'   #esä½¿ç”¨httpåè®®\n      - '--es.uri=https://elastic:elastic@10.10.2.145:9200' \n      - \"--es.ssl-skip-verify\"   #è¿æ¥åˆ°esæ—¶è·³è¿‡SSLéªŒè¯\n    networks:\n       es_exporter:\n        ipv4_address: 172.20.103.11\n\nnetworks:\n  es_exporter:\n    driver: bridge\n    ipam:\n      config:\n        - subnet: 172.20.103.0/24\n```\n\nï¼ˆ2ï¼‰åœ¨OpenTelemetry Collectoré…ç½®æ–‡ä»¶ä¸­esçš„ç›‘æ§å‚æ•°\n\n```yaml\nreceivers:\n  prometheus:\n    config:\n     scrape_configs:\n       - job_name: 'elasticsearch-monitoring'\n         scrape_interval: 5s\n         static_configs:\n           - targets: ['10.10.2.145:9114']\n             labels:\n               host_name: elasticsearch-monitoring\n\n\nprocessors:\n  batch:\n\nexporters:\n  otlp:\n    endpoint: 10.10.2.145:11800\n    tls:\n      insecure: true\n  logging:\n    loglevel: debug\n\nservice:\n  pipelines:\n    metrics:\n      receivers:\n      - prometheus\n      processors:\n      - batch\n      exporters:\n      - otlp\n      - logging\n```\n\nä¾æ¬¡é‡å¯otelcolå®¹å™¨å’Œskywalking-oapï¼ŒæŸ¥çœ‹æ˜¯å¦ç”Ÿæˆesçš„ç›‘æ§æ•°æ®ã€‚\n\n### å¼€å¯æ•°æ®åº“PostgreSQLç›‘æ§\n\nï¼ˆ1ï¼‰éƒ¨ç½²postgres-exporter\n\n```yaml\nservices:\n  postgres-exporter:\n    image: quay.io/prometheuscommunity/postgres-exporter\n    container_name: postgres-exporter\n    restart: always\n    environment:\n      TZ: \"Asia/Shanghai\"\n      DATA_SOURCE_URI: \"localhost:5432/postgres?sslmode=disable\"\n      DATA_SOURCE_USER: \"postgres\"\n      DATA_SOURCE_PASS: \"password\"\n    ports:\n      - \"9187:9187\"\n    networks:\n       sw-pgsql:\n        ipv4_address: 172.20.105.11\n\nnetworks:\n  sw-pgsql:\n    driver: bridge\n    ipam:\n      config:\n        - subnet: 172.20.105.0/24\n```\n\nï¼ˆ2ï¼‰åœ¨OpenTelemetry Collectoré…ç½®æ–‡ä»¶ä¸­postgres sqlçš„ç›‘æ§å‚æ•°\n\n```yaml\nreceivers:\n  prometheus:\n    config:\n     scrape_configs:\n       - job_name: 'postgresql-monitoring'\n         scrape_interval: 5s\n         static_configs:\n           - targets: ['10.10.2.145:9187']\n             labels:\n               host_name: postgresql-monitoring\n\n\nprocessors:\n  batch:\n\nexporters:\n  otlp:\n    endpoint: 10.10.2.145:11800\n    tls:\n      insecure: true\n  logging:\n    loglevel: debug\n\nservice:\n  pipelines:\n    metrics:\n      receivers:\n      - prometheus\n      processors:\n      - batch\n      exporters:\n      - otlp\n      - logging\n```\n\nä¾æ¬¡é‡å¯skywalking-oapå®¹å™¨å’Œotelcolï¼ŒæŸ¥çœ‹æ˜¯å¦ç”Ÿæˆpostgres sqlçš„ç›‘æ§æ•°æ®ã€‚\n\n### å¼€å¯æ•°æ®åº“MongoDBç›‘æ§\n\nï¼ˆ1ï¼‰éƒ¨ç½²mongodb_exporter\n\n```yaml\nservices:\n  mongodb_exporter:\n    image: percona/mongodb_exporter:0.40\n    container_name: mongodb_exporter\n    restart: always\n    ports:\n      - \"9216:9216\"\n    environment:\n      - TZ=Asia/Shanghai\n      - MONGODB_URI=mongodb://user:password@192.168.1.23:27017/?authSource=admin\n    command:\n      - --collect-all\n      - --web.listen-address=:9216\n    networks:\n       sw-mongodb:\n        ipv4_address: 172.20.106.11\n\nnetworks:\n  sw-mongodb:\n    driver: bridge\n    ipam:\n      config:\n        - subnet: 172.20.106.0/24\n```\n\n(2)åœ¨OpenTelemetry Collectoré…ç½®æ–‡ä»¶ä¸­mongodbçš„ç›‘æ§å‚æ•°\n\n```yaml\nreceivers:\n  prometheus:\n    config:\n     scrape_configs:\n       - job_name: 'mongodb-monitoring'\n         scrape_interval: 5s\n         static_configs:\n           - targets: ['10.10.2.145:9216']\n             labels:\n               host_name: mongodb-monitoring\n\n\nprocessors:\n  batch:\n\nexporters:\n  otlp:\n    endpoint: 10.10.2.145:11800\n    tls:\n      insecure: true\n  logging:\n    loglevel: debug\n\nservice:\n  pipelines:\n    metrics:\n      receivers:\n      - prometheus\n      processors:\n      - batch\n      exporters:\n      - otlp\n      - logging\n```\n\n### .NETé¡¹ç›®æœåŠ¡é“¾è·¯è¿½è¸ª\n\n#### å®‰è£… SkyWalking .NET Core Agentï¼ˆWindowsç¯å¢ƒï¼‰\n\nï¼ˆ1ï¼‰åœ¨Visual Studioä¸­çš„é¡¹ç›®ä¸­å®‰è£…`nuget`åŒ…`SkyAPM.Agent.AspNetCore`ã€‚\n\nï¼ˆ2ï¼‰åœ¨`launchSettings.json`æ–‡ä»¶ä¸­æ–°å¢ç¯å¢ƒå˜é‡`\"ASPNETCORE_HOSTINGSTARTUPASSEMBLIES\": \"SkyAPM.Agent.AspNetCore\"`å’Œ `\"SKYWALKING__SERVICENAME\": \"æœåŠ¡åï¼ˆä¸æ‰§è¡Œçš„dllç¨‹åºçš„åç§°ä¸€è‡´ï¼‰\"`ã€‚\n\n```json\n  \"profiles\": {\n    \"http\": {\n      \"commandName\": \"Project\",\n      \"dotnetRunMessages\": true,\n      \"launchBrowser\": true,\n      \"applicationUrl\": \"http://localhost:5205\",\n      \"environmentVariables\": {\n        \"ASPNETCORE_ENVIRONMENT\": \"Development\",\n        //æ–°å¢ç¯å¢ƒå˜é‡\n        \"ASPNETCORE_HOSTINGSTARTUPASSEMBLIES\": \"SkyAPM.Agent.AspNetCore\",\n        \"SKYWALKING__SERVICENAME\": \"æœåŠ¡åï¼ˆä¸æ‰§è¡Œçš„dllç¨‹åºçš„åç§°ä¸€è‡´ï¼‰\"\n      }\n    },\n    \"https\": {\n      \"commandName\": \"Project\",\n      \"dotnetRunMessages\": true,\n      \"launchBrowser\": true,\n      \"applicationUrl\": \"https://localhost:7105;http://localhost:5205\",\n      \"environmentVariables\": {\n        \"ASPNETCORE_ENVIRONMENT\": \"Development\",\n        //æ–°å¢ç¯å¢ƒå˜é‡\n        \"ASPNETCORE_HOSTINGSTARTUPASSEMBLIES\": \"SkyAPM.Agent.AspNetCore\",\n        \"SKYWALKING__SERVICENAME\": \"æœåŠ¡åï¼ˆä¸æ‰§è¡Œçš„dllç¨‹åºçš„åç§°ä¸€è‡´ï¼‰\"\n      }\n    },\n    \"IIS Express\": {\n      \"commandName\": \"IISExpress\",\n      \"launchBrowser\": true,\n      \"environmentVariables\": {\n        \"ASPNETCORE_ENVIRONMENT\": \"Development\",\n         //æ–°å¢ç¯å¢ƒå˜é‡\n        \"ASPNETCORE_HOSTINGSTARTUPASSEMBLIES\": \"SkyAPM.Agent.AspNetCore\",\n        \"SKYWALKING__SERVICENAME\": \"æœåŠ¡åï¼ˆä¸æ‰§è¡Œçš„dllç¨‹åºçš„åç§°ä¸€è‡´ï¼‰\"\n      }\n    }\n  }\n,\n```\n\nï¼ˆ3ï¼‰åœ¨Program.csä¸­æ·»åŠ é…ç½®å‚æ•°ã€‚\n\n```cs\n//SkyApm\nbuilder.Services.AddSkyApmExtensions();\nEnvironment.SetEnvironmentVariable\n(\"ASPNETCORE_HOSTINGSTARTUPASSEMBLIES\", \"SkyAPM.Agent.AspNetCore\");\nEnvironment.SetEnvironmentVariable(\"SKYWALKING__SERVICENAME\", \"æœåŠ¡åï¼ˆä¸æ‰§è¡Œçš„dllç¨‹åºçš„åç§°ä¸€è‡´ï¼‰\");\n```\n\nï¼ˆ4ï¼‰æ·»åŠ skyapm.jsonæ–‡ä»¶ï¼Œæ·»åŠ æ–¹å¼æœ‰ä¸¤ç§ï¼š\n\nä¸€æ˜¯åœ¨dllè¿è¡Œç¨‹åºçš„åŒç›®å½•ä¸‹åˆ›å»ºskyapm.jsonï¼Œå¹¶å†™å…¥ä»¥ä¸‹å†…å®¹ã€‚\n\n```json\n{\n  \"SkyWalking\": {\n    \"ServiceName\": \"æœåŠ¡åï¼ˆä¸æ‰§è¡Œçš„dllç¨‹åºçš„åç§°ä¸€è‡´ï¼‰\",\n    \"Namespace\": \"\",\n    \"HeaderVersions\": [\n      \"sw8\"\n    ],\n    \"Sampling\": {\n      \"SamplePer3Secs\": -1,\n      \"Percentage\": -1.0\n    },\n    \"Logging\": {\n      \"Level\": \"Information\",\n      \"FilePath\": \"logs\\\\skyapm-{Date}.log\"\n    },\n    \"Transport\": {\n      \"Interval\": 3000,\n      \"ProtocolVersion\": \"v8\",\n      \"QueueSize\": 30000,\n      \"BatchSize\": 3000,\n      \"gRPC\": {\n        \"Servers\": \"SkyWalkingæœåŠ¡ip:11800\",\n        \"Timeout\": 10000,\n        \"ConnectTimeout\": 10000,\n        \"ReportTimeout\": 600000,\n        \"Authentication\": \"\"\n      }\n    }\n  }\n}\n\n```\n\näºŒæ˜¯åœ¨Visual Studioçš„æ§åˆ¶å°ä¸­è¾“å…¥å‘½ä»¤åˆ›å»ºskyapm.jsonã€‚\n\n```shell\ndotnet tool install -g SkyAPM.DotNet.CLI\ndotnet skyapm config æœåŠ¡åï¼ˆä¸æ‰§è¡Œçš„dllç¨‹åºçš„åç§°ä¸€è‡´ï¼‰ SkyWalkingæœåŠ¡ip:11800\n```\n\nï¼ˆ5ï¼‰é…ç½®å®Œæˆåï¼Œåœ¨è¿è¡Œçš„æœåŠ¡å™¨ä¸­åŠ å…¥ç¯å¢ƒå˜é‡\n\næ–¹å¼ä¸€ï¼šåœ¨æœåŠ¡å™¨æ·»åŠ \n\n```\nvi  ~/.bashrc\n\n\nexport ASPNETCORE_ENVIRONMENT=development\nexport ASPNETCORE_HOSTINGSTARTUPASSEMBLIES=SkyAPM.Agent.AspNetCore\nexport SKYWALKING__SERVICENAME=æœåŠ¡å\n\n\n#ä½¿å¾—é…ç½®ç”Ÿæ•ˆ\nsource ~/.bashrc\n```\n\næ–¹å¼äºŒï¼šåœ¨å®¹å™¨ä¸­æ·»åŠ ï¼Œå¯åœ¨Dockerfileæ–‡ä»¶ä¸­æ·»åŠ \n\n```\nFROM mcr.microsoft.com/dotnet/aspnet:8.0 AS base\n......\nENV ASPNETCORE_ENVIRONMENT=development\nENV ASPNETCORE_HOSTINGSTARTUPASSEMBLIES=SkyAPM.Agent.AspNetCore\nENV SKYWALKING__SERVICENAME=æœåŠ¡å\n#å®¹å™¨å…¥å£ç‚¹\nENTRYPOINT [\"dotnet\", \"xxx\"]\n```\n\nï¼ˆ6ï¼‰è®¿é—®.NETé¡¹ç›®ï¼ŒæŸ¥çœ‹Skywalkingä¸­å¸¸è§„æœåŠ¡-æœåŠ¡ä¸­ç”Ÿæˆçš„æœåŠ¡ç›‘æ§ã€‚ï¼ˆæ•ˆæœå›¾åœ¨æœ€åï¼‰\n\n#### å®‰è£… SkyWalking .NET Core Agentï¼ˆLinuxç¯å¢ƒï¼‰\n\né€‚ç”¨äºåœ¨Linuxä¸Šåˆ›å»ºçš„.NETé¡¹ç›®\n\nï¼ˆ1ï¼‰å®‰è£… SkyWalking .NET Core Agent\n\n```shell\ndotnet add package SkyAPM.Agent.AspNetCore\nexport ASPNETCORE_HOSTINGSTARTUPASSEMBLIES=SkyAPM.Agent.AspNetCore\nexport SKYWALKING__SERVICENAME=æœåŠ¡åï¼ˆä¸æ‰§è¡Œçš„dllç¨‹åºçš„åç§°ä¸€è‡´ï¼‰\n```\n\nï¼ˆ2ï¼‰å®‰è£…SkyAPM.DotNet.CLIï¼Œç”¨äºç”Ÿæˆskyapm.json\n\n```shell\ndotnet tool install -g SkyAPM.DotNet.CLI\ndotnet skyapm config æœåŠ¡åï¼ˆä¸æ‰§è¡Œçš„dllç¨‹åºçš„åç§°ä¸€è‡´ï¼‰ SkyWalkingæœåŠ¡ip:11800\n```\n\nï¼ˆ3ï¼‰é…ç½®å®Œæˆåï¼Œåœ¨è¿è¡Œçš„æœåŠ¡å™¨ä¸­åŠ å…¥ç¯å¢ƒå˜é‡\n\næ–¹å¼ä¸€ï¼šåœ¨æœåŠ¡å™¨æ·»åŠ \n\n```\nvi  ~/.bashrc\n\n\nexport ASPNETCORE_ENVIRONMENT=development\nexport ASPNETCORE_HOSTINGSTARTUPASSEMBLIES=SkyAPM.Agent.AspNetCore\nexport SKYWALKING__SERVICENAME=æœåŠ¡å\n\n\n#ä½¿å¾—é…ç½®ç”Ÿæ•ˆ\nsource ~/.bashrc\n```\n\næ–¹å¼äºŒï¼šåœ¨å®¹å™¨ä¸­æ·»åŠ ï¼Œå¯åœ¨Dockerfileæ–‡ä»¶ä¸­æ·»åŠ \n\n```\nFROM mcr.microsoft.com/dotnet/aspnet:8.0 AS base\n......\nENV ASPNETCORE_ENVIRONMENT=development\nENV ASPNETCORE_HOSTINGSTARTUPASSEMBLIES=SkyAPM.Agent.AspNetCore\nENV SKYWALKING__SERVICENAME=æœåŠ¡å\n#å®¹å™¨å…¥å£ç‚¹\nENTRYPOINT [\"dotnet\", \"xxx\"]\n```\n\nï¼ˆ4ï¼‰è®¿é—®.NETé¡¹ç›®ï¼ŒæŸ¥çœ‹Skywalkingä¸­å¸¸è§„æœåŠ¡-æœåŠ¡ä¸­ç”Ÿæˆçš„æœåŠ¡ç›‘æ§ã€‚\n\n![img](dockeréƒ¨ç½²SkyWalking/1.png)\n\n### æ¥å…¥å‰ç«¯ç›‘æ§\n\nï¼ˆ1ï¼‰é¡¹ç›®ä¸­æ·»åŠ skywalking-client-jsåŒ…\n\n```JSON\nnpm install skywalking-client-js --save\n```\n\nï¼ˆ2ï¼‰åœ¨vue.config.jsä¸­é…ç½®ä»£ç†\n\n```JSON\nproxy:{\n      '/browser': {\n        target:'SkyWalkingæœåŠ¡ip:12800',//è¿™é‡Œæ˜¯è·¯ç”±å’ŒæŠ¥é”™æŠ¥å‘Šçš„ä»£ç†\n        changeOrigin: true\n      },\n      '/v3':{\n        target:'SkyWalkingæœåŠ¡ip:12800',\n        changeOrigin: true//è¿™é‡Œæ˜¯è¿½è¸ªæŠ¥å‘Šçš„ä»£ç†\n      }\n}\n```\n\nï¼ˆ3ï¼‰åœ¨main.jsä¸­æ¥å…¥skywalking-client-js\n\n```JSON\n//skywalkingç›‘æ§ç³»ç»Ÿ\nimport ClientMonitor from 'skywalking-client-js';\n//æ³¨å†Œskywalking\nClientMonitor.register({\n    service: 'æœåŠ¡å',//æœåŠ¡åç§°        \n    serviceVersion:'',//åº”ç”¨ç‰ˆæœ¬å·\n    traceSDKInternal:true,//è¿½è¸ªsdk\n    pagePath: location.href,//å½“å‰è·¯ç”±åœ°å€\n    useFmp: true\n});\n```\n\n(4)åœ¨å¯¹åº”ä¸šåŠ¡ç³»ç»Ÿçš„æœåŠ¡å™¨ä¸­ï¼Œåœ¨å¯¹åº”å‘å¸ƒnignxä»£ç†æœåŠ¡ä¸­åŠ å…¥å¯¹åº”çš„ä»£ç†é…ç½®ã€‚\n\n```JSON\n    location /browser/ {\n        proxy_pass http://SkyWalkingæœåŠ¡ip:12800/browser/;\n        client_max_body_size 1000M;\n    }\n        location /v3/ {\n        proxy_pass http://SkyWalkingæœåŠ¡ip:12800/v3/;\n        client_max_body_size 1000M;\n    }\n```\n","tags":["è¿ç»´","APMå·¥å…·","Linux","DevOps","docker","åˆ†å¸ƒå¼é“¾è·¯è¿½è¸ª","SkyWalking"],"categories":["å®¹å™¨åŒ–","docker"]},{"title":"åœ¨Githubä¸Šä½¿ç”¨OsmosFeedæ­å»ºåœ¨çº¿RSSé˜…è¯»å™¨ï¼ˆæ— éœ€æœåŠ¡å™¨ï¼‰","url":"/yyg/5ea27f40/","content":"\n# åœ¨Githubä¸Šä½¿ç”¨OsmosFeedæ­å»ºåœ¨çº¿RSSé˜…è¯»å™¨ï¼ˆæ— éœ€æœåŠ¡å™¨ï¼‰\n\n## å‰è¨€\n\nåœ¨æ­å»º`äº‘é‡é˜`åšå®¢ç½‘ç«™æœŸé—´ï¼Œçœ‹äº†å¥½å¤šå…·æœ‰ä¸ªäººç‰¹è‰²çš„åšå®¢ç½‘ç«™ï¼Œæœ‰ä¸å°‘éƒ½æœ‰RSSè®¢é˜…åŠŸèƒ½ï¼Œé‚£RSSæ˜¯ä»€ä¹ˆå‘¢ï¼Ÿå’±ä»¬å…ˆå” å” ã€‚\n\n{% folding cyan,ğŸ”œRSSğŸ”š %}\n\nRSS å…¨ç§° Really Simple Syndicationï¼ˆçœŸæ­£ç®€æ˜“è”åˆï¼‰ï¼Œæ˜¯ä¸€ç§åŸºäºXMLï¼ˆå¯æ‰©å±•æ ‡è®°è¯­è¨€ï¼‰çš„å†…å®¹åˆ†å‘åè®®ï¼Œå®ƒå…è®¸ç”¨æˆ·è®¢é˜…ç½‘ç«™çš„å†…å®¹æ›´æ–°ï¼Œå¦‚æ–°é—»ã€åšå®¢æ–‡ç« ç­‰ã€‚å¥½åƒè¿˜æœ‰å¦å¤–çš„è¯´æ³•æ˜¯Rich Site Summaryï¼ˆç½‘ç«™å†…å®¹æ‘˜è¦ï¼‰å’Œ RDF Site Summaryï¼ˆèµ„æºæè¿°æ¡†æ¶ç«™ç‚¹æ‘˜è¦ï¼‰ï¼Œä¸è¿‡å…¶å®éƒ½æè¿°çš„æ˜¯ä»è®¢é˜…æºè·å–æ›´æ–°çš„å†…å®¹ï¼Œå¹¶å°†è·å–çš„å†…å®¹æ•´åˆé›†ä¸­æ˜¾ç¤ºï¼Œæ–¹ä¾¿ç”¨æˆ·è¿›è¡ŒæŸ¥çœ‹ã€‚\n\nç½‘ä¸Šæœ‰å…³RSSçš„ç›¸å…³ä»‹ç»æœ‰å¾ˆå¤šï¼Œæ„Ÿå…´è¶£çš„è¯å¯ä»¥æœç´¢äº†è§£ä¸‹ã€‚\n\n{% endfolding %}\n\nè®¢é˜…äº†RSSï¼Œåªè¦å†ç»“åˆRSSé˜…è¯»å™¨ï¼Œå°±å¯ä»¥ç›´æ¥çœ‹åˆ°æœ‰å…³åšå®¢çš„æœ€æ–°æ–‡ç« ï¼Œé‚£æˆ‘ä»¬å°±é‡ç‚¹æRSSé˜…è¯»å™¨ã€‚RSSé˜…è¯»å™¨æ— è®ºæ˜¯è‡ªå»ºè¿˜æ˜¯ä½¿ç”¨ç°æˆçš„ï¼Œéƒ½æœ‰å¾ˆå¤šç±»å‹ï¼Œåƒæµè§ˆå™¨æ’ä»¶ã€æ‰‹æœºç«¯ã€ç”µè„‘ç«¯ç¨‹åºã€webç«¯ç­‰ã€‚æ­å»ºä¸€ä¸ªwebç«¯ï¼Œæ–¹ä¾¿ã€çœäº‹ã€å¯¹ç»ˆç«¯ä¾èµ–å°ã€‚\n\n[OsmosFeed](https://github.com/osmoscraft/osmosfeed)æ˜¯GitHubä¸Šä¸€ä¸ªå¼€æºçš„Webç‰ˆRSSé˜…è¯»å™¨ï¼Œå¯ä»¥ä½¿ç”¨ GitHub Pagesæ‰˜ç®¡ï¼Œåˆ©ç”¨GitHub Actionså®ç°å†…å®¹å®šæœŸè‡ªåŠ¨æ›´æ–°ï¼Œä¸»é¢˜å¯è‡ªå®šä¹‰ã€‚\n\næœ¬ç«™çš„`æ–‡ç•Œ`å°±æ˜¯ä½¿ç”¨OsmosFeedæ­å»ºå¹¶æ‰˜ç®¡åœ¨GitHub Pagesä¸Šçš„ã€‚{% btn '/yygrss/index.html',ç‚¹æˆ‘è·³è½¬æŸ¥çœ‹,far fa-hand-point-right,outline  blue %}\n\n## æ­å»ºè¿‡ç¨‹\n\n### åˆ›å»ºä»“åº“\n\n1.è®¿é—®OsmosFeedä»“åº“çš„[é…ç½®æ•™ç¨‹](https://github.com/osmoscraft/osmosfeed/blob/master/README_zh.md)ï¼Œç‚¹å‡»æ•™ç¨‹ä¸­â€åˆ›å»ºæ–°ä»“åº“â€œä¸­çš„ç¬¬ä¸€æ­¥â€ä½¿ç”¨osmosfeed-templateå®˜æ–¹æ¨¡æ¿åˆ›å»ºä»“åº“â€œï¼Œé¡µé¢è·³è½¬è‡³åˆ›å»ºæ–°ä»“åº“ç•Œé¢ï¼Œè®¾ç½®ä»“åº“åå¹¶å°†å¯è§æ€§è®¾ä¸ºPublicï¼Œç‚¹å‡»åˆ›å»ºCreate repositoryæŒ‰é’®æ–°å»ºä»“åº“ã€‚\n\n![image-20240826224400783](åœ¨Githubä¸Šä½¿ç”¨OsmosFeedæ­å»ºåœ¨çº¿RSSé˜…è¯»å™¨ï¼ˆæ— éœ€æœåŠ¡å™¨ï¼‰/1.png)\n\n2.è¿›å…¥åˆšåˆ›å»ºå¥½çš„ä»“åº“ï¼Œè¿›å…¥ç›®å½•`.github/workflows`,ä¿®æ”¹`update-feed.yaml`æ–‡ä»¶ä¸ºä»¥ä¸‹å†…å®¹ã€‚\n\n```yaml\nname: Build site on schedule or main branch update\n\non:\n  push:\n    branches:\n      - main\n  schedule:\n    # Adjust refresh schedule here. By default, it runs once per day.\n    # Syntax reference: https://docs.github.com/en/actions/reference/events-that-trigger-workflows#schedule\n    # Recommended tool: https://crontab.guru/\n    - cron: \"0 11 * * *\"    #è®¾ç½®çš„æ‰§è¡Œæ—¶é—´å‘¨æœŸ\n\njobs:\n  build:\n    runs-on: ubuntu-latest\n\n    steps:\n      - uses: actions/checkout@v4\n      - name: Setup Node.js environment\n        uses: actions/setup-node@v4.0.3\n        with:\n          node-version: \"20\"\n      - name: Install dependencies\n        run: npm i\n      - name: Build the feed\n        run: npm run build\n      - name: Deploy to GitHub Pages\n        uses: peaceiris/actions-gh-pages@v4\n        with:\n          github_token: ${{ secrets.action_token }}   #action_tokenä¸ºè®¾ç½®çš„Actions secrets ï¼Œåé¢ä¼šè®²åˆ°\n          publish_dir: ./public\n```\n\n3.è¿›å…¥åˆšåˆ›å»ºå¥½çš„ä»“åº“ï¼Œä¿®æ”¹æ ¹ç›®å½•ä¸‹çš„osmosfeed.yamlæ–‡ä»¶ï¼Œå°†`cacheUrl:`è¡Œå‰çš„`#`å»é™¤ï¼Œå¹¶å°†`GITHUB_USERNAME`ä¿®æ”¹ä¸ºè‡ªå·±çš„githubåç§°ï¼Œ`REPO_NAME`ä¿®æ”¹ä¸ºæœ¬ä»“åº“çš„åã€‚`sources`ä¸‹çš„`- href:`ä¸ºRSS/Atomæºã€‚\n\n```yaml\ncacheUrl: https://GITHUB_USERNAME.github.io/REPO_NAME/cache.json\nsources:\n  - href: https://css-tricks.com/feed/\n  - href: https://www.freecodecamp.org/news/rss/\n  - href: https://daverupert.com/atom.xml\n```\n\n### è®¾ç½®èº«ä»½éªŒè¯ä»¤ç‰Œ\n\n1.ç‚¹å‡»è‡ªå·±çš„å¤´åƒï¼Œé€‰æ‹© â€œSettingsâ€ -> â€œDeveloper settingsâ€ -> â€œPersonal access tokensâ€->â€Tokensï¼ˆclassicï¼‰â€œï¼Œç‚¹å‡» â€œGenerate new tokenâ€ï¼Œé€‰æ‹©â€Generate new tokenï¼ˆclassicï¼‰â€œï¼ŒéªŒè¯åï¼ŒæŒ‡å®šä¸€ä¸ªæè¿°æ€§åç§°ï¼Œé€‰æ‹©ä»¤ç‰Œçš„æœ‰æ•ˆæ—¶é—´ï¼Œé€‰æ‹©è¦æˆäºˆæ­¤ä»¤ç‰Œçš„èŒƒå›´æˆ–æƒé™ã€‚åªéœ€è¦é€‰æ‹©repoä¸€é¡¹å³å¯ã€‚ç‚¹å‡»â€Generate tokenâ€œï¼Œå®Œæˆåˆ›å»ºã€‚\n\n![image-20240826230331732](åœ¨Githubä¸Šä½¿ç”¨OsmosFeedæ­å»ºåœ¨çº¿RSSé˜…è¯»å™¨ï¼ˆæ— éœ€æœåŠ¡å™¨ï¼‰/2.png)\n\n2.åˆ›å»ºå®Œæˆåï¼Œå¤åˆ¶ä¿å­˜tokenï¼Œåé¢è¦ç”¨ã€‚\n\n3.è¿›å…¥åˆšåˆ›å»ºå¥½çš„ä»“åº“ï¼Œè¿›å…¥ä»“åº“çš„â€œSettingsâ€ -> â€œSecrets and variablesâ€ -> â€œActionsâ€ã€‚ç‚¹å‡»â€Repository secretsâ€œä¸­çš„â€œNew repository secretâ€ï¼Œè¾“å…¥Actions secrets çš„åå­—ä¸ºaction_tokenï¼ˆä¸update-feed.yamlæ–‡ä»¶ä¸­çš„ä¿æŒä¸€è‡´ï¼‰ï¼Œå¹¶å°†ç¬¬2æ­¥å¤åˆ¶çš„tokenç²˜è´´è‡³Secretsæ¡†ä¸­ï¼Œç‚¹å‡»â€Add secretâ€œä¿å­˜ã€‚\n\n![image-20240826231333139](åœ¨Githubä¸Šä½¿ç”¨OsmosFeedæ­å»ºåœ¨çº¿RSSé˜…è¯»å™¨ï¼ˆæ— éœ€æœåŠ¡å™¨ï¼‰/3.png)\n\n### éƒ¨ç½²GitHub Pages\n\n1.è¿›å…¥ä»“åº“çš„â€œSettingsâ€ -> â€œPagesâ€ ï¼Œåœ¨Branchä¸­é€‰æ‹©â€gh-pagesâ€œï¼Œç›®å½•é€‰æ‹©â€/(root)â€œï¼Œç‚¹å‡»â€saveâ€œä¿å­˜ã€‚\n\n![image-20240826232546187](åœ¨Githubä¸Šä½¿ç”¨OsmosFeedæ­å»ºåœ¨çº¿RSSé˜…è¯»å™¨ï¼ˆæ— éœ€æœåŠ¡å™¨ï¼‰/4.png)\n\n![image-20240826232701080](åœ¨Githubä¸Šä½¿ç”¨OsmosFeedæ­å»ºåœ¨çº¿RSSé˜…è¯»å™¨ï¼ˆæ— éœ€æœåŠ¡å™¨ï¼‰/5.png)\n\n2. åˆ·æ–°é¡µé¢ï¼Œç›´åˆ°ç•Œé¢ä¸Šå‡ºç° `Your site is published at https://githubç”¨æˆ·å.github.io/ä»“åº“å`çš„ç¡®è®¤ä¿¡æ¯ï¼ˆæœ€å¤šç­‰å¾…1ï¼3åˆ†é’Ÿï¼‰å³å¯ç¦»å¼€ã€‚å®Œæˆéƒ¨ç½²ã€‚éƒ¨ç½²çš„è¯¦ç»†è¿‡ç¨‹å¯ä»¥è¿›å…¥ä»“åº“çš„â€Actions\"ï¼Œè¿›è¡ŒæŸ¥çœ‹å…·ä½“è¿‡ç¨‹ä¸å¼‚å¸¸æƒ…å†µã€‚\n\n![image-20240826235331777](åœ¨Githubä¸Šä½¿ç”¨OsmosFeedæ­å»ºåœ¨çº¿RSSé˜…è¯»å™¨ï¼ˆæ— éœ€æœåŠ¡å™¨ï¼‰/6.png)\n\n{% folding green open,åšå®¢æ­å»ºç³»åˆ—æ–‡ç«  %}\n\n{% series åšå®¢æ­å»ºæ•™ç¨‹ %}\n\n{% endfolding %}","tags":["åšå®¢","é­”æ”¹","åœ¨çº¿rssé˜…è¯»å™¨","GitHub Pages"],"categories":["åšå®¢æ•™ç¨‹","rssé˜…è¯»å™¨"]},{"title":"ä¸€äº›å…è´¹çš„gptç½‘ç«™","url":"/yyg/30035ff1/","content":"\n{% card CodeNews,https://codenews.cc/chatgpt,,,å…è´¹å…ç™»å½•,fas fa-paperclip,,96px,80px %}\n\n{% card æ€å¦AI,https://chat.ttext.cn/,,,å…è´¹å…ç™»å½•,fas fa-paperclip,,96px,80px %}\n\n{% card FreeGPT,https://free.netfly.top/#/chat,,,å…è´¹å…ç™»å½•,fas fa-paperclip,,96px,80px %}\n\n{% card æ™ºèƒ½AIåŠ©æ‰‹,https://chat.tinycms.xyz:3002/#/chat,,,å…è´¹å…ç™»å½•,fas fa-paperclip,,96px,80px %}\n\n{% card RawChat,https://sharedchat.cn/,,,å…è´¹å…ç™»å½•,fas fa-paperclip,,96px,80px %}\n\n{% card FreeChat-é•œåƒ,https://free-chat.cn/?sockstack&section=table,,,ChatGPTé•œåƒç½‘ç«™åˆ—è¡¨,fas fa-paperclip,,96px,80px %}\n\n{% card SockStack,https://www.sockstack.cn/chat-mirrors,,,ChatGPTé•œåƒç½‘ç«™åˆ—è¡¨,fas fa-paperclip,,96px,80px %}\n","tags":["å…è´¹gpt","äººå·¥æ™ºèƒ½åŠ©æ‰‹"],"categories":["æ¼«è°ˆ","å…è´¹gptç½‘ç«™"]},{"title":"Watchtowerè‡ªåŠ¨æ›´æ–°dockerå®¹å™¨","url":"/yyg/d3a49a0e/","content":"## åŸºç¡€ç¯å¢ƒ\n\nç³»ç»Ÿï¼šopenEuler 22.03 (LTS-SP4) X86\n\nè½¯ä»¶ï¼šdocker-26.1.3ã€ docker compose-2.27.0\n\n## å…³äºWatchtower\n\nWatchtower æ˜¯ä¸€ä¸ªåº”ç”¨ç¨‹åºï¼Œç›‘æ§æ­£åœ¨è¿è¡Œçš„ Docker å®¹å™¨ï¼Œå¹¶ç›‘è§†è¿™äº›å®¹å™¨çš„é•œåƒç‰ˆæœ¬çš„å˜åŒ–ã€‚å¦‚æœ Watchtower æ£€æµ‹åˆ°å®¹å™¨çš„é•œåƒå·²æ›´æ”¹ï¼Œå®ƒå°†è‡ªåŠ¨æ‹‰å–æ–°é•œåƒï¼Œå…³é—­ç°æœ‰å®¹å™¨ï¼Œä½¿ç”¨æœ€åˆéƒ¨ç½²æ—¶çš„ç›¸åŒé€‰é¡¹é‡æ–°å¯åŠ¨å®ƒï¼Œå®ç°å®¹å™¨çš„ä¼˜é›…å‡çº§ã€‚\n\n## å®‰è£…docker\n\n(1)é…ç½®yumæºä¸‹è½½dockerã€‚\n\n```shell\nyum-config-manager --add-repo http://mirrors.aliyun.com/docker-ce/linux/centos/docker-ce.repo\nsed -i 's/\\$releasever/7/g' /etc/yum.repos.d/docker-ce.repo\n```\n\nï¼ˆ2ï¼‰å®‰è£…æœ€æ–°ç‰ˆdockerå’Œdocker composeã€‚\n\n```shell\n# ä¸‹è½½ä¾èµ–åŠdockerã€docker compose\nyum install -y container-selinux\nyum install -y docker-ce docker-ce-cli containerd.io docker-compose-plugin \n```\n\nï¼ˆ3ï¼‰ä¿®æ”¹Dockerçš„æ•°æ®ç›®å½•ä¸ºâ€œ/data/dockerDataâ€ï¼Œå¹¶é…ç½®dockeré•œåƒæºã€‚\n\n```shell\necho '{\n  \"data-root\": \"/data/dockerData\",\n \"registry-mirrors\": [\"https://dhub.kubesre.xyzcu\"]\n}' > /etc/docker/daemon.json\n```\n\nï¼ˆ4ï¼‰å¯åŠ¨DockeræœåŠ¡ï¼Œå¹¶è®¾ç½®ä¸ºå¼€æœºè‡ªå¯åŠ¨ã€‚\n\n```shell\nsystemctl start docker\nsystemctl enable docker\n```\n\n## å®‰è£…Watchtower\n\n### æ–¹å¼ä¸€ï¼šé€šè¿‡dockerå‘½ä»¤å®‰è£…\n\n```shell\ndocker run -itd --name watchtower \\\n--restart=always \\\n-v /var/run/docker.sock:/var/run/docker.sock \\\n-e TZ=Asia/Shanghai \\\ncontainrrr/watchtower \\\n--interval 60 \\\n--cleanup\n```\n\n> `--restart=always`  è®¾ç½®å®¹å™¨å¼€æœºè‡ªå¯\n> \n> ` -v /var/run/docker.sock:/var/run/docker.sock`  è¯»å–dockerå®ˆæŠ¤è¿›ç¨‹çš„API\n> \n> `-e TZ=Asia/Shanghai` ä½¿ç”¨æœ¬åœ°æ—¶åŒº\n> \n> `--interval 60` è®¾ç½®è½®è¯¢é—´éš”ä¸º60ç§’\n> \n> `--cleanup` æ›´æ–°ååˆ é™¤æ—§é•œåƒ\n\n### æ–¹å¼äºŒï¼šä½¿ç”¨composeæ–‡ä»¶å®‰è£…\n\n```shell\nservices:\n watchtower:\n    image: containrrr/watchtower\n    container_name: watchtower\n    restart: always\n    environment:\n       - TZ=Asia/Shanghai\n    volumes:\n      - /var/run/docker.sock:/var/run/docker.sock\n    command: --interval 60 --cleanup\n    user: \"0\"\n    networks:\n      watchtower-net:\n        ipv4_address: 172.20.17.11\n\nnetworks:\n watchtower-net:\n  driver: bridge\n  ipam:\n   config:\n    - subnet: 172.20.17.0/24\n```\n\n## Watchtoweræ›´å¤šåº”ç”¨\n\n### 1.watchtower ç›‘æ§æ›´æ–°è¿œç¨‹ Dockerä¸»æœº\n\nï¼ˆ1ï¼‰åœ¨è¿œç¨‹ä¸»æœºä¸Šå¯ç”¨è¿œç¨‹ API è®¿é—®ã€‚\n\n```shell\n #ä¿®æ”¹dockeræœåŠ¡æ–‡ä»¶\n vi /usr/lib/systemd/system/docker.service\n #åœ¨è¯¥è¡ŒååŠ å…¥ -H tcp://0.0.0.0:2375\n ExecStart=/usr/bin/dockerd -H fd:// --containerd=/run/containerd/containerd.sock -H tcp://0.0.0.0:2375\n #é‡å¯æœåŠ¡å’Œdocker\n systemctl daemon-reload\n systemctl restart docker\n \n #æ·»åŠ é˜²ç«å¢™ç­–ç•¥\nsudo firewall-cmd --add-port=2375/tcp --permanent\nsudo firewall-cmd --reload\nsudo firewall-cmd --list-all\n```\n\nï¼ˆ2ï¼‰åœ¨æœ¬æœºåˆ›å»ºwatchtowerï¼Œç›‘æ§è¿œç¨‹ä¸»æœºçš„dockerå®¹å™¨\n\n```shell\ndocker run -d --name watchtower-1 \\\n-e TZ=Asia/Shanghai \\\ncontainrrr/watchtower \\\n--interval 60 \\\n--cleanup \\\n--host \"tcp://10.0.1.2:2375\"\n```\n\n### 2.æŒ‰æ ‡ç­¾ç­›é€‰\n\næŒ‰æ ‡ç­¾ç­›é€‰è¿›è¡Œå®¹å™¨çš„æ›´æ–°ï¼Œéœ€è¦åœ¨åˆ›å»ºå®¹å™¨æ—¶ï¼Œç»™å®¹å™¨æ‰“ä¸ŠåŒ…å«`com.centurylinklabs.watchtower.enable`çš„æ ‡ç­¾ï¼Œ`com.centurylinklabs.watchtower.enable=false`è¡¨ç¤ºç¦ç”¨å¯¹å®¹å™¨çš„ç›‘æ§å’Œæ›´æ–°ï¼Œ`com.centurylinklabs.watchtower.enable=true`è¡¨ç¤ºå¯ç”¨å¯¹å®¹å™¨çš„ç›‘æ§å’Œæ›´æ–°ï¼Œ<mark>æ­¤ç±»æƒ…å†µåªé€‚ç”¨äºåˆ›å»ºæ–°å®¹å™¨æ—¶ã€‚</mark>\n\n```shell\n#ç¦ç”¨å¯¹å®¹å™¨çš„ç›‘æ§å’Œæ›´æ–°\ndocker run -itd \\\n--label=com.centurylinklabs.watchtower.enable=false --name test-httpd httpd\n#å¯ç”¨å¯¹å®¹å™¨çš„ç›‘æ§å’Œæ›´æ–°\ndocker run -d --label=com.centurylinklabs.watchtower.enable=true --name test-httpd httpd\n```\n\n### 3.ç¦ç”¨å®¹å™¨åç§°ç­›é€‰\n\nè¦ç¦ç”¨ç‰¹å®šå®¹å™¨ï¼Œéœ€è¦åœ¨watchtoweråˆ›å»ºæ—¶åŠ å…¥`--disable-containers`å‚æ•°ï¼Œå¹¶åœ¨è¯¥å‚æ•°ååŠ ä¸Šå®¹å™¨åç§°ï¼Œå¦‚`httpd`ï¼Œè¿è¡Œæ—¶å°±ä¼šä¸ç›‘æ§åç§°ä¸­å«æœ‰httpdçš„å®¹å™¨ã€‚\n\n```shell\ndocker run -d \\\n--name watchtower \\\n--restart=always \\\n-v /var/run/docker.sock:/var/run/docker.sock \\\n-e TZ=Asia/Shanghai \\\ncontainrrr/watchtower \\\n--interval 60 \\\n--cleanup \\\n--disable-containers httpd\n```\n\n### 4. å¸¸ç”¨å‘½ä»¤å‚æ•°\n\néƒ¨åˆ†å¸¸ç”¨å‚æ•°è®¾ç½®å¦‚ä¸‹è¡¨æ‰€ç¤ºã€‚\n\n| å‚æ•°                     | ç¤ºä¾‹                                                                                                                                                                           | è¯´æ˜                    |\n| ---------------------- | ---------------------------------------------------------------------------------------------------------------------------------------------------------------------------- | --------------------- |\n| --schedule \"0 9 * * *\" | `docker run -itd --name watchtower --restart always -v /var/run/docker.sock:/var/run/docker.sock -e TZ=Asia/Shanghai containrrr/watchtower --cleanup --schedule \"0 9 * * *\"` | æ¯å¤©ä¹ç‚¹æ‰§è¡Œæ›´æ–°è°ƒåº¦            |\n| --run-once             | `docker run -rm --name watchtower --restart always -v /var/run/docker.sock:/var/run/docker.sock -e TZ=Asia/Shanghai containrrr/watchtower --cleanup --run-once`              | æ‰‹åŠ¨æ›´æ–°ä¸€æ¬¡ï¼Œå¹¶å°†watchtoweråˆ é™¤ |\n| å®¹å™¨å                    | `docker run -itd --name watchtower --restart always -v /var/run/docker.sock:/var/run/docker.sock -e TZ=Asia/Shanghai containrrr/watchtower --cleanup nginx httpd`            | æŒ‡å®šæ›´æ–°å®¹å™¨nginxã€httpd     |\n| --monitor-only         | `docker run -itd --name watchtower --restart always -v /var/run/docker.sock:/var/run/docker.sock -e TZ=Asia/Shanghai containrrr/watchtower --cleanup --monitor-only`         | åªæ£€æŸ¥å®¹å™¨æ˜¯å¦éœ€è¦æ›´æ–°ï¼Œä¸åº”ç”¨æ›´æ–°     |\n\næ›´å¤šå‚æ•°è®¾ç½®ï¼Œå¯æŸ¥çœ‹watchtowerå®˜æ–¹æ–‡æ¡£ã€‚\n\n{% link watchtowerå®˜æ–¹æ–‡æ¡£,https://containrrr.dev/watchtower/arguments/ %}\n","tags":["è¿ç»´","Linux","docker","è‡ªåŠ¨æ›´æ–°å®¹å™¨","Watchtower"],"categories":["å®¹å™¨åŒ–","docker"]},{"title":"dockerå®¹å™¨æ—¥å¿—é…ç½®ç®¡ç†","url":"/yyg/3b57c0c6/","content":"è¿è¡Œçš„é¡¹ç›®å®¹å™¨çªç„¶å°±åœäº†ï¼ŒæŸ¥çœ‹å®¹å™¨æ—¥å¿—å‘ç°ç£ç›˜ç©ºé—´ä¸è¶³ï¼Œå¯¼è‡´å®¹å™¨æ²¡æ³•è¿è¡Œäº†ã€‚\n\n> Error response from daemon: Cannot restart container docker-p: mkdir /home/dockerData/overlay2/7bef1e2fa4788ab4d5db7e2e850d7ceeed09185b55c175f20c1500d28a0cc874d: <mark>no space left on device</mark>\n\nå…ˆä½¿ç”¨`df -h`çœ‹ä¸‹ç£ç›˜ä½¿ç”¨æƒ…å†µã€‚\n\n> overlay                     413G  413G  0   100% /home/dockerData/overlay2/fea24dfbbe9f7d6d8309....../merged\n> overlay                     413G  413G  0   100% /home/dockerData/overlay2/7bef1e2fa4788ab4d5db....../merged\n\nå®¹å™¨çš„å­˜å‚¨ç›®å½•`/home/dockerData/`ï¼ˆå…¶é»˜è®¤å­˜å‚¨ç›®å½•æ˜¯`/var/lib/docker`ï¼Œæˆ‘è¿™å„¿æ˜¯é‡æ–°é…ç½®çš„ï¼‰ç›´æ¥æŠŠç£ç›˜ç”¨å®Œäº†ã€‚\n\næ‰¾åˆ°åŸå› å°±å¥½åŠäº†ï¼Œç›´æ¥åˆ°å®¹å™¨çš„å­˜å‚¨ç›®å½•`/home/dockerData/`å…ˆåä½¿ç”¨`du -sh`å‘½ä»¤åˆ†åˆ«æŸ¥çœ‹`overlay2`å’Œ`containers`ä¸¤ä¸ªç›®å½•ä»¥åŠé‡Œé¢çš„æ–‡ä»¶ã€‚å‘ç°containersç›®å½•é‡Œçš„å®¹å™¨æ–‡ä»¶`98bbe7f17fa335f1b6e17......`å ç”¨äº†409Gã€‚ \n\n> du -sh overlay2\n> 3.7G    overlay2\n> \n>  du -sh containers/98bbe7f17fa335f1b6e17......\n> 409G    containers/98bbe7f17fa335f1b6e17......\n\nå†æ·±å…¥å®¹å™¨æ–‡ä»¶å‘ç°ï¼Œæºå¤´æ˜¯å®¹å™¨çš„æ—¥å¿—æ–‡ä»¶`98bbe7f17fa335f1b6e17......-json.log`ã€‚\n\næŠŠè¿™ä¸ªæ—¥å¿—æ–‡ä»¶è¿›è¡Œåˆ é™¤ä¹‹åï¼Œå†é‡å¯å®¹å™¨ï¼Œä¸šåŠ¡å°±æ¢å¤æ­£å¸¸äº†ã€‚\n\nä¸ºé˜²æ­¢è¿™ç§æƒ…å†µå†æ¬¡å‘ç”Ÿï¼Œéœ€è¦åœ¨Â Docker å®ˆæŠ¤ç¨‹åº`/etc/docker/daemon.json`é…ç½®æ—¥å¿—è®°å½•é©±åŠ¨ç¨‹åºï¼Œé…ç½®å…·ä½“å†…å®¹å¦‚ä¸‹ï¼š\n\n```json\n  \"log-driver\":\"json-file\",\n  \"log-opts\":{\"max-size\" :\"50m\",\"max-file\":\"2\"}\n```\n\n> `\"log-driver\":\"json-file\"`   Dockerçš„é»˜è®¤æ—¥å¿—è®°å½•é©±åŠ¨ç¨‹åºã€‚æ—¥å¿—æ ¼å¼ä¸ºJSONã€‚\n> \n> `\"max-size\" :\"50m\"`  æ—¥å¿—åˆ‡å‰²å‰çš„æœ€å¤§ä¸º50Mã€‚\n> \n> `\"max-file\":\"2\"`  ä¿ç•™çš„æœ€å¤§æ—¥å¿—æ–‡ä»¶æ•°é‡ä¸º2ã€‚\n\né…ç½®å®Œæˆåï¼Œé‡å¯dockerã€‚\n\n```shell\nsudo systemctl daemon-reload\nsudo systemctl restart docker\n```\n\nå…³äºdockerçš„æ—¥å¿—æ›´å¤šç›¸å…³å†…å®¹ï¼Œå¯å‚è€ƒä¸‹é¢é“¾æ¥ä¸­çš„å†…å®¹ã€‚\n\n{% link Docker æ—¥å¿—ç®¡ç†æœ€ä½³å®è·µï¼çœ‹è¿™ç¯‡å°±å¤Ÿäº†ï¼,https://segmentfault.com/a/1190000023144155 %}\n","tags":["è¿ç»´","çŸ¥è¯†æ¢³ç†","Linux","docker"],"categories":["å®¹å™¨åŒ–","docker","æ¢³ç†æ€»ç»“","çŸ¥è¯†æ¢³ç†"]},{"title":"Hexo-Butterflyç¾åŒ–æ•™ç¨‹-[9]ç¹æ²™","url":"/yyg/ca46b09/","content":"\n## å‰è¨€\n\nå¹³æ—¶åœ¨å·¥ä½œå’Œç”Ÿæ´»ä¸­ï¼Œæœ‰ä¸€äº›å¾ˆå¥½ç”¨çš„è½¯ä»¶ã€ç½‘ç«™ï¼Œå°±æƒ³ç€æ‰¾ä¸€ä¸ªåœ°æ–¹éƒ½ç»™è®°ä¸‹æ¥ã€‚åœ¨åˆ›å»ºhexoåšå®¢æ—¶ï¼Œçœ‹åˆ°äº†æœ‰åœ¨åšå®¢é‡Œæ·»åŠ ç½‘ç«™å¯¼èˆªçš„ï¼Œæ„Ÿè§‰è¿™æ ·æŒºä¸é”™çš„ï¼Œä¹Ÿå°±æœ‰äº†`ç¹æ²™`ï¼šä¸€ä¸ªæœå½•ï¼ˆä¸ªäººï¼‰å¥½ç”¨è½¯ä»¶å’Œç½‘ç«™çš„åœ°æ–¹ã€‚æ ·å¼å€Ÿç”¨äº†[Leonus ](https://blog.leonus.cn/)åšä¸»çš„[ä½œå“æ¨èå¡ç‰‡â€”æ ‡ç­¾å¤–æŒ‚ | Leonus](https://blog.leonus.cn/2022/butterflyTag.html)ï¼Œåšäº†ä¸€ç‚¹ä¿®æ”¹é€‚é…ï¼š\n\n- `å¡ç‰‡ç›’å­å¯ä¸€è¡Œæ”¾å¤šä¸ª`\n\n- `ç›’å†…çš„æç¤ºæ–‡æœ¬å†…å®¹è½¬æˆäº†ä¸€ä¸ªå¤–éƒ¨ç‹¬ç«‹æ˜¾ç¤ºçš„æç¤ºæ¡†æ–‡æœ¬`\n  ï¼ˆå°šå¾…ä¼˜åŒ–ï¼Œè‹¥æœ‰å¥½çš„ä¼˜åŒ–æ–¹å¼ï¼Œè¯·Qæˆ‘ä¸€ä¸‹ï¼‰ï¼Œå…·ä½“æ•ˆæœå¯ä»¥ç‚¹å‡»ä¸‹é¢çš„æŒ‰é’®é¢„è§ˆã€‚\n\n{% hideBlock ç‚¹å‡»é¢„è§ˆæ•ˆæœ,#386768,color %}\n\n![image-20240810223933689](Hexo-Butterflyç¾åŒ–æ•™ç¨‹[9]-ç¹æ²™/1.png)\n\n{% endhideBlock %}\n\n## æ•™ç¨‹\n\nï¼ˆ1ï¼‰åœ¨`åšå®¢æ ¹ç›®å½•\\themes\\butterfly\\scripts\\tag`ä¸­åˆ›å»º`card.js` å¹¶ç²˜å…¥ä»¥ä¸‹ä»£ç ï¼š\n\n```js\n/**\n * card\n * {% card name,url,bg,star,text,icon,tag,w,h %}\n * {% card æ ‡é¢˜,é“¾æ¥,èƒŒæ™¯,è¯„åˆ†,è¯„ä»·,å›¾æ ‡,æ ‡ç­¾,å®½åº¦,é«˜åº¦ %}\n */\n\n'use strict'\n\n// åˆ†æ•°è½¬æˆæ˜Ÿæ˜Ÿ\nfunction tostar(num) {\n    let tmp = ''\n    for (let i = 0; i < Math.floor(num); i++) { tmp += '<i class=\"fa-solid fa-star\" style=\"color: #FFB636;\"></i>' } // æ•´æ•°éƒ¨åˆ†åŠ å®å¿ƒæ˜Ÿæ˜Ÿ\n    if (num - Math.floor(num) != 0) tmp += '<i class=\"fa-solid fa-star-half-alt\" style=\"color: #FFB636;\"></i>' // å°æ•°éƒ¨åˆ†è½¬æˆåŠæ˜Ÿ\n    for (let i = 0; i < 5 - Math.ceil(num); i++) { tmp += '<i class=\"fa-regular fa-star\"></i>' } // ä¸å¤Ÿ5ä¸ªè¡¥ç©ºå¿ƒæ˜Ÿæ˜Ÿ\n    return tmp\n}\n\nfunction card(args) {\n    args = args.join(' ').split(',')\n\n    // è·å–å‚æ•°\n    let name = (args[0] || 'æœªçŸ¥').trim()\n    let url = (args[1] || '').trim()\n    let bg = (args[2] ? `background-image: url(${args[2]});` : 'background-color: #333;').trim()\n    let star = tostar(Number(args[3]) || 0)\n    let text = (args[4] || 'æš‚æ— è¯´æ˜').trim()   \n    let icon = (args[5] || '').trim()\n    let tag = (args[6] || '').trim()\n    let w = args[7] || '200px'\n    let h = args[8] || '275px'\n\n    return `<div title=\"${name}\" referrerPolicy=\"no-referrer\" class=\"card_box\" style=\"${bg} width:${w}; height:${h};\">\n    <div class=\"card_mask\">\n      <span class=\"tooltiptext\">${text}</span>  //æ­¤å¤„æ–°æ·»åŠ äº†tooltiptextç±»åï¼Œæ·»åŠ äº†æ–°cssæ ·å¼\n      ${url?'<a href=\"'+url+'\">æŸ¥çœ‹è¯¦æƒ…</a>':''}\n    </div>\n    <div class=\"card_top\">\n      <i class=\"${icon}\"></i>\n      <span>${tag}</span>\n    </div>\n    <div class=\"card_content\">\n      <span>${name}</span>\n      <div>${star}</div>\n    </div>\n  </div>`\n}\n\nhexo.extend.tag.register('card', card, { ends: false })\n```\n\nï¼ˆ2ï¼‰åœ¨ `åšå®¢æ ¹ç›®å½•\\themes\\butterfly\\source\\css\\_tags` ä¸­åˆ›å»º `card.styl` å¹¶ç²˜å…¥ä»¥ä¸‹ä»£ç ï¼š\n\n```js\n.card_box\n  display: inline-flex       //æ­¤å¤„å°†flexæ”¹ä¸ºinline-flexï¼Œä½¿å¾—cardç›’å­å¯ä»¥ä¸€è¡Œæ”¾å¤šä¸ª\n  justify-content: space-between\n  flex-direction: column\n  background-position: center\n  background-size: cover\n  border-radius: 12px\n  position: relative\n  overflow: hidden\n  padding: 10px\n  color: #fff !important\n  margin: 10px auto\n  &::after\n    content: ''\n    position: absolute\n    height: 100%\n    width: 100%\n    left: 0\n    top: 0\n    background: rgba(0,0,0,0.1)\n    transition: .5s\n    z-index: 0\n  &:hover\n    .card_mask\n      opacity: 1\n      pointer-events: auto\n  .card_top\n    display: flex\n    z-index: 1\n    align-items: center\n    justify-content: space-between\n  .card_mask\n    position: absolute\n    pointer-events: none\n    z-index: 2\n    transition: .5s\n    opacity: 0\n    width: 100%\n    height: 100%\n    left: 0\n    top: 0\n    padding: 20px\n    background: #333\n    span\n      display: block\n      height: calc(100% - 40px)\n      overflow: auto\n    a\n      text-align: center\n      background: #fff\n      color: #333 !important\n      border-radius: 5px\n      position: absolute\n      width: calc(100% - 40px)\n      bottom: 20px\n      left: 20px\n      &:hover\n        text-decoration: none !important\n        color: white !important\n        background: #49b1f5\n\n  .card_content\n    z-index: 1\n    span\n      font-size: 18px\n      font-weight: bold\n\n/* ##################è¿™éƒ¨åˆ†ä¸ºæ–°åŠ æ ·å¼ä»£ç ################## */\n\n/* card_mask æ–‡æœ¬ */\n.card_mask .tooltiptext {\n    visibility: hidden;\n    background-color: #f5f9fc;\n    color: #000;\n    text-align: center;\n    padding: 5px 0;\n    border-radius: 6px;\n\n    /* å®šä½ */\n    position: fixed;\n    z-index: 1;\n}\n\n/* é¼ æ ‡ç§»åŠ¨ä¸Šå»åæ˜¾ç¤ºæç¤ºæ¡† */\n.card_mask:hover .tooltiptext {\n     visibility: visible;\n     max-width: 40%;\n     word-wrap: break-word;\n     text-align: center;\n     max-height: 10%;\n     top: 10%;\n     padding: 5px;\n     margin-right:20%;    \n}\n/* ##################è¿™éƒ¨åˆ†ä¸ºæ–°åŠ æ ·å¼ä»£ç ################## */\n\n[data-theme='dark']\n  .card_box\n    color: #ddd !important\n    &::after\n      background: rgba(0,0,0,0.1)\n```\n\n## åº”ç”¨\n\nåº”ç”¨å‚æ•°æ ¼å¼ï¼š\n\n```\n{% card æ ‡é¢˜,é“¾æ¥,èƒŒæ™¯,è¯„åˆ†,è¯„ä»·,å›¾æ ‡,æ ‡ç­¾,å®½åº¦,é«˜åº¦ %}\n```\n\nå…·ä½“åº”ç”¨çš„å‚æ•°åº”ç”¨è®¿é—®`Leonus | ä½œå“æ¨èå¡ç‰‡â€”æ ‡ç­¾å¤–æŒ‚`çš„åŸé“¾æ¥æŸ¥çœ‹ã€‚é“¾æ¥å¦‚ä¸‹ï¼š\n\n{% link Leonus | ä½œå“æ¨èå¡ç‰‡â€”æ ‡ç­¾å¤–æŒ‚,https://blog.leonus.cn/2022/butterflyTag.html,https://q1.qlogo.cn/g?b=qq&nk=990320751&s=5 %}\n\n{% folding green open,åšå®¢æ­å»ºç³»åˆ—æ–‡ç«  %}\n\n{% series åšå®¢æ­å»ºæ•™ç¨‹ %}\n\n{% endfolding %}\n","tags":["Hexo","åšå®¢æ•™ç¨‹","ç¾åŒ–æ•™ç¨‹","Butterfly"],"categories":["åšå®¢æ•™ç¨‹","ç¾åŒ–æ•™ç¨‹"]},{"title":"podman-5.1.2 éƒ¨ç½²","url":"/yyg/c10999ab/","content":"\n## åŸºç¡€ç¯å¢ƒ\n\nç³»ç»Ÿï¼šopenEuler 22.03 (LTS-SP4) X86\n\nè½¯ä»¶ï¼špodman-5.1.2ã€podman-compose-1.2.0\n\n## é…ç½®yumæº\n\n```shell\necho '[baseos]\nname=CentOS-Stream-9-Base-mirrors.aliyun.com\nbaseurl=https://mirrors.aliyun.com/centos-stream/9-stream/BaseOS/x86_64/os/\ngpgcheck=0\n\n[appstream]\nname=CentOS-Stream-9-Appstream-mirrors.aliyun.com\nbaseurl=https://mirrors.aliyun.com/centos-stream/9-stream/AppStream/x86_64/os/\ngpgcheck=0' > /etc/yum.repos.d/CentOS.repo\n```\n\n## å®‰è£…podmanå’Œpodman-compose\n\n```shell\n# å®‰è£…podman podman-docker\nyum install -y podman podman-docker\n# ä¸‹è½½podman-compose\npip install podman-compose\n# åˆ›å»ºæ–‡ä»¶ï¼Œä½¿ç”¨dockerå‘½ä»¤æ—¶ä¸æŠ¥é”™\ntouch /etc/containers/nodocker\n```\n\n<mark>å®‰è£…`podman-docker`åå¯ä½¿ç”¨dockerå‘½ä»¤</mark>\n\n## å¯åŠ¨å¹¶æŸ¥çœ‹ç‰ˆæœ¬\n\n```shell\n# å¯åŠ¨podman\nsystemctl start podman\n# è®¾ç½®å¼€æœºè‡ªå¯\nsystemctl enable podman\n# æŸ¥çœ‹ç‰ˆæœ¬\npodman --version\n```\n\n## æ°¸ä¹…å¯ç”¨cgroups-v2\n\n{% folding cyan,ğŸ“šæµ·æ‹¾ğŸš cgroups-v2 %}\n\ncgroup v2 for containers éœ€è¦å†…æ ¸ç‰ˆæœ¬ 4.15 æˆ–æ›´é«˜ï¼Œè€Œå»ºè®®åœ¨ 5.2 æˆ–æ›´é«˜å†ä½¿ç”¨ cgroup v2ã€‚\n\n{% endfolding %}\n\npodmanå®‰è£…å®Œæˆåï¼Œç›´æ¥ä½¿ç”¨podmanå‘½ä»¤æ—¶ï¼Œä¼šå‡ºç°ä»¥ä¸‹æç¤ºï¼Œå¤§è‡´æ„æ€æ˜¯è¯´cgroups-v1å·²è¢«å¼ƒç”¨ï¼Œè¦è®¾ç½®ç¯å¢ƒå˜é‡`PODMAN_IGNORE_CGROUPSV1_WARNING`ï¼Œä»¥å¯ç”¨ cgroups-v2ã€‚\n\n> WARN[0000] Using cgroups-v1 which is deprecated in favor of cgroups-v2 with Podman v5 and will be removed in a future version. Set environment variable `PODMAN_IGNORE_CGROUPSV1_WARNING` to hide this warning.\n\nï¼ˆ1ï¼‰ç¡®å®šç³»ç»Ÿæ˜¯å¦æ”¯æŒ cgroups-v2\n\n```shell\ngrep cgroup /proc/filesystems\n```\n\nå¦‚æœç³»ç»Ÿæ”¯æŒä¼šæ˜¾ç¤ºä»¥ä¸‹å†…å®¹ï¼š\n\n> nodev   cgroup\n> nodev   cgroup2\n\nï¼ˆ2ï¼‰è¾“å…¥`ls /sys/fs/cgroup/cgroup.controllers`æ£€æŸ¥æ˜¯å¦å·²ç»æ¿€æ´»cgroups-v2ï¼Œå¦‚æœæ˜¾ç¤º<mark>ls: cannot access '/sys/fs/cgroup/cgroup.controllers': No such file or directory</mark>ï¼Œåˆ™è¡¨ç¤ºè¿˜æœªæ¿€æ´»ã€‚\n\nï¼ˆ3ï¼‰æ°¸ä¹…æ¿€æ´»cgroups-v2\n\næ‰“å¼€GRUB é…ç½®æ–‡ä»¶`/etc/default/grub`ï¼Œä¿®æ”¹å†…æ ¸å‘½ä»¤è¡Œå‚æ•°ã€‚åœ¨`GRUB_CMDLINE_LINUX`æ‰€åœ¨è¡ŒåŠ å…¥ä»¥ä¸‹å‚æ•°ï¼š\n\n```shell\nsystemd.unified_cgroup_hierarchy=1\n```\n\n> GRUB_CMDLINE_LINUX=\"resume=/dev/mapper/openeuler-swap rd.lvm.lv=openeuler/root rd.lvm.lv=openeuler/swap cgroup_disable=files apparmor=0 crashkernel=512M <mark>systemd.unified_cgroup_hierarchy=1</mark>\"\n\nï¼ˆ4ï¼‰æ›´æ–°GRUBé…ç½®ï¼Œé‡å¯ç³»ç»Ÿä½¿æ›´æ”¹çš„å‚æ•°ç”Ÿæ•ˆã€‚\n\n```shell\n# æ›´æ–°GRUBé…ç½®\nsudo grub2-mkconfig -o /boot/grub2/grub.cfg\n# é‡å¯\nreboot\n```\n\n## éªŒè¯cgroups-v2\n\né‡å¯ç³»ç»Ÿåï¼Œè¾“å…¥å‘½ä»¤æŸ¥çœ‹podmançš„cgroupVersionçš„ç‰ˆæœ¬ï¼Œæ˜¾ç¤ºç‰ˆæœ¬ä¸ºv2ï¼Œåˆ™å¯ç”¨æˆåŠŸã€‚å¹¶ä¸”åœ¨è¾“å…¥podmanå‘½ä»¤æ—¶ï¼Œä¸ä¼šåœ¨æœ‰æç¤ºã€‚\n\n```shell\npodman info | grep cgroupVersion\n```\n\n>   cgroupVersion: v2\n\n## é…ç½®é•œåƒæº\n\næ‰“å¼€é…ç½®æ–‡ä»¶`/etc/containers/registries.conf`ï¼Œé…ç½®å›½å†…é•œåƒæºï¼ŒåŠ é€Ÿæ‹‰å–é•œåƒã€‚\n\n```shell\necho 'unqualified-search-registries = [\"docker.io\"]\n[[registry]]\nprefix = \"docker.io\"\nlocation = \"dockerhub.icu\"\ninsecure = true\n[[registry.mirror]]\nlocation = \"ghcr.geekery.cn\"\ninsecure = true\n[[registry.mirror]]\nlocation = \"hub.rat.dev\"\ninsecure = true\n[[registry.mirror]]\nlocation = \"docker.wanpeng.top\"\ninsecure = true\n[[registry.mirror]]\nlocation = \"f1361db2.m.daocloud.io\"\ninsecure = true' >> /etc/containers/registries.conf\n```\n\n## æ‹‰å–é•œåƒæµ‹è¯•\n\n```\npodman run hello-world\n```\n\næˆåŠŸæ‹‰å–å¹¶è¿è¡Œåä¼šæ˜¾ç¤ºä»¥ä¸‹æ•ˆæœï¼š\n\n>     Resolved \"hello-world\" as an alias (/etc/containers/registries.conf.d/000-shortnames.conf)\n>     Trying to pull quay.io/podman/hello:latest...\n>     Getting image source signatures\n>     Copying blob 81df7ff16254 done   |\n>     Copying config 5dd467fce5 done   |\n>     Writing manifest to image destination\n>     !... Hello Podman World ...!\n>     \n>              .--\"--.\n>            / -     - \\\n>           / (O)   (O) \\\n>        ~~~| -=(,Y,)=- |\n>         .---. /`  \\   |~~\n>      ~/  o  o \\~~~~.----. ~~\n>       | =(X)= |~  / (O (O) \\\n>        ~~~~~~~  ~| =(Y_)=-  |\n>       ~~~~    ~~~|   U      |~~\n>     \n>     Project:   https://github.com/containers/podman\n>     Website:   https://podman.io\n>     Desktop:   https://podman-desktop.io\n>     Documents: https://docs.podman.io\n>     YouTube:   https://youtube.com/@Podman\n>     X/Twitter: @Podman_io\n>     Mastodon:  @Podman_io@fosstodon.org\n","tags":["è¿ç»´","Linux","podman"],"categories":["å®¹å™¨åŒ–","podman"]},{"title":"x86æœåŠ¡å™¨æ„å»ºARMæ¶æ„dockeré•œåƒ","url":"/yyg/4451cec/","content":"\n## åŸºç¡€ç¯å¢ƒ\n\næ“ä½œç³»ç»Ÿï¼šopenEuler 22.03 (LTS-SP2)\n\nè½¯ä»¶ï¼šDocker-26.1.2 ã€Docker Compose-v2.27.0\n\n## å®‰è£…Docker\n\nï¼ˆ1ï¼‰é…ç½®yumæºä¸‹è½½dockerã€‚\n\n```shell\nyum-config-manager --add-repo http://mirrors.aliyun.com/docker-ce/linux/centos/docker-ce.repo\nsed -i 's/\\$releasever/7/g' /etc/yum.repos.d/docker-ce.repo\n```\n\nï¼ˆ2ï¼‰å®‰è£…æœ€æ–°ç‰ˆdockerå’Œdocker composeã€‚\n\n```shell\n# ä¸‹è½½ä¾èµ–åŠdockerã€docker compose\nyum install -container-selinux\nyum install -y docker-ce docker-ce-cli containerd.io docker-compose-plugin \n```\n\nï¼ˆ3ï¼‰ä¿®æ”¹Dockerçš„æ•°æ®ç›®å½•ä¸ºâ€œ/data/dockerDataâ€ï¼Œå¹¶é…ç½®dockeré•œåƒæºã€‚\n\n```shell\necho '{\n  \"data-root\": \"/data/dockerData\",\n \"registry-mirrors\": [\"https://dockerhub.icu\"]\n}' > /etc/docker/daemon.json\n```\n\nï¼ˆ4ï¼‰å¯åŠ¨DockeræœåŠ¡ï¼Œå¹¶è®¾ç½®ä¸ºå¼€æœºè‡ªå¯åŠ¨ã€‚\n\n```shell\nsystemctl start docker\nsystemctl enable docker\n```\n\n## ä½¿ç”¨Â `register`Â æ³¨å†Œå¯æ”¯æŒçš„æ¶æ„è§£æå™¨\n\n```shell\ndocker run --rm --privileged multiarch/qemu-user-static:register --reset\n```\n\næŸ¥çœ‹äºŒè¿›åˆ¶æ ¼å¼çš„è§£é‡Šå™¨æ˜¯å¦å¯ç”¨ï¼Œæ˜¾ç¤º`enabled`ï¼Œå³ä¸ºå¯ç”¨ã€‚\n\n```shell\nls  /proc/sys/fs/binfmt_misc/ \ncat /proc/sys/fs/binfmt_misc/qemu-aarch64\n```\n\n## æ‹‰å–åŸºç¡€armé•œåƒ\n\næ­¤å¤„ä»¥httpdé•œåƒä¸ºä¾‹ï¼Œåœ¨x86æœåŠ¡å™¨ä¸Šæ‹‰å–arm64æ¶æ„çš„httpdé•œåƒï¼Œå…¶ä¸­`--platform=arm64`æŒ‡å®šæ‹‰å–çš„é•œåƒæ¶æ„ä½arm64ï¼Œ`--platform=amd64`åˆ™æ˜¯æ‹‰å–x86æ¶æ„çš„é•œåƒã€‚\n\n```shell\ndocker pull --platform=arm64 httpd:latest\n```\n\n## å®šä¹‰Dockerfileï¼Œåˆ›å»ºæ–°é•œåƒ\n\né€šè¿‡ä½¿ç”¨Dockerfileåˆ›å»ºæ–°armé•œåƒçš„æ–¹å¼æœ‰ä¸¤ç§ï¼Œä¸€ç§æ˜¯ç›´æ¥ä¸‹è½½`qemu-aarch64-static`ç¨‹åºï¼Œåœ¨æ„å»ºé•œåƒæ—¶ç›´æ¥æ‹·è´è¿›é•œåƒä¸­ï¼›å¦ä¸€ç§æ˜¯æ‹‰å–`multiarch/qemu-user-static:x86_64-aarch64`é•œåƒï¼Œé€šè¿‡å¤šé˜¶æ®µæ„å»ºï¼Œä»`multiarch/qemu-user-static:x86_64-aarch64`é•œåƒä¸­å¤åˆ¶Â `qemu-aarch64-static`ç¨‹åºÂ åˆ°Â `httpd`Â é•œåƒä¸­ã€‚\n\n### æ–¹å¼ä¸€ï¼šä¸‹è½½ç¨‹åºï¼Œç›´æ¥å¤åˆ¶\n\nï¼ˆ1ï¼‰åœ¨ä¸‹è½½`qemu-aarch64-static`ç¨‹åºæ—¶ï¼Œå¯ç›´æ¥ä¸‹è½½è¯¥ç¨‹åºï¼Œä¹Ÿå¯å…ˆä¸‹è½½å…¶å‹ç¼©åŒ…ï¼Œå†è§£å‹ã€‚\n\n```shell\n# ç›´æ¥ä¸‹è½½ç¨‹åºï¼ˆæ¨èï¼‰\nwget https://github.com/multiarch/qemu-user-static/releases/download/v7.2.0-1/qemu-aarch64-static\n# å…ˆä¸‹è½½å…¶å‹ç¼©åŒ…ï¼Œå†è§£å‹\nwget https://github.com/multiarch/qemu-user-static/releases/download/v7.2.0-1/qemu-aarch64-static.tar.gz\ntar -vzxf qemu-aarch64-static.tar.gz\n# èµ‹äºˆå¯æ‰§è¡Œæƒé™\nchmod +x /usr/bin/qemu-aarch64-static\n```\n\nï¼ˆ2ï¼‰åˆ›å»ºDockerfileæ–‡ä»¶ï¼Œåœ¨httpdé•œåƒçš„åŸºç¡€ä¸Šæ„å»ºæ–°é•œåƒï¼Œ`qemu-aarch64-static`<mark>ç¨‹åºå¿…é¡»å’ŒDockerfileæ–‡ä»¶åœ¨åŒä¸€ç›®å½•ä¸‹</mark>ã€‚Dockerfileæ–‡ä»¶çš„å…·ä½“å†…å®¹å¦‚ä¸‹ï¼š\n\n```dockerfile\nFROM httpd:latest\n# å°†qemu-aarch64-staticç¨‹åºæ‹·è´è¿›é•œåƒçš„/usr/bin/ç›®å½•\nCOPY ./qemu-aarch64-static /usr/bin/qemu-aarch64-static\n# å°†æµ‹è¯•çš„htmlæ–‡ä»¶æ‹·è´åˆ°é•œåƒçš„ç›¸å…³ç›®å½•\nCOPY ./index.html  /usr/local/apache2/htdocs/\n```\n\nï¼ˆ3ï¼‰æŒ‡å®šæ„å»ºçš„æ¶æ„ï¼Œæ‰§è¡Œå‘½ä»¤å¼€å§‹æ„å»ºæ–°é•œåƒï¼Œæ„å»ºå®Œæˆåï¼ŒæŸ¥çœ‹æ–°é•œåƒçš„æ¶æ„å¹¶å¯¼å‡ºä¸ºtaræ–‡ä»¶ï¼Œåœ¨armæœåŠ¡å™¨ä¸Šè¿›è¡ŒéªŒè¯ã€‚\n\n```shell\n# æ„å»ºé•œåƒ\ndocker build --platform arm64 -t httpd:1.00 .\n# æŸ¥çœ‹æ–°é•œåƒçš„æ¶æ„\n docker inspect httpd:1.00 | grep Architecture\n# å¯¼å‡ºé•œåƒä¸ºtaræ–‡ä»¶\ndocker save -o httpd.tar httpd:1.00\n```\n\n### æ–¹å¼äºŒï¼šé€šè¿‡é•œåƒå¤šé‡æ„å»ºå¤åˆ¶\n\nï¼ˆ1ï¼‰åˆ›å»ºDockerfileæ–‡ä»¶ï¼Œåˆ†ä¸¤ä¸ªé˜¶æ®µæ„å»ºæ–°é•œåƒï¼Œç¬¬ä¸€é˜¶æ®µä» `multiarch/qemu-user-static` é•œåƒä¸­è·å–`qemu-aarch64-static`ç¨‹åºï¼Œç¬¬äºŒé˜¶æ®µåœ¨httpdé•œåƒçš„åŸºç¡€ä¸Šæ„å»ºæ–°é•œåƒï¼ŒDockerfileæ–‡ä»¶çš„å…·ä½“å†…å®¹å¦‚ä¸‹ï¼š\n\n```dockerfile\n# ç¬¬ä¸€é˜¶æ®µï¼šä»multiarch/qemu-user-staticé•œåƒä¸­è·å–qemu-aarch64-staticç¨‹åº  \nFROM multiarch/qemu-user-static:x86_64-aarch64 as qemu\n# ç¬¬äºŒé˜¶æ®µï¼šåœ¨httpdé•œåƒçš„åŸºç¡€ä¸Šæ„å»ºæ–°é•œåƒ\nFROM httpd:latest\n# å°†qemu-aarch64-staticç¨‹åºæ‹·è´è¿›é•œåƒçš„/usr/bin/ç›®å½•\nCOPY --from=qemu /usr/bin/qemu-aarch64-static /usr/bin/\n# å°†æµ‹è¯•çš„htmlæ–‡ä»¶æ‹·è´åˆ°é•œåƒçš„ç›¸å…³ç›®å½•\nCOPY ./index.html  /usr/local/apache2/htdocs/\n```\n\nï¼ˆ2ï¼‰æŒ‡å®šæ„å»ºçš„æ¶æ„ï¼Œæ‰§è¡Œå‘½ä»¤å¼€å§‹æ„å»ºæ–°é•œåƒï¼Œæ„å»ºå®Œæˆåï¼ŒæŸ¥çœ‹æ–°é•œåƒçš„æ¶æ„å¹¶å¯¼å‡ºä¸ºtaræ–‡ä»¶ï¼Œåœ¨armæœåŠ¡å™¨ä¸Šè¿›è¡ŒéªŒè¯ã€‚\n\n```shell\n# æ„å»ºé•œåƒ\ndocker build --platform arm64 -t httpd:1.00 .\n# æŸ¥çœ‹æ–°é•œåƒçš„æ¶æ„\n docker inspect httpd:1.00 | grep Architecture\n# å¯¼å‡ºé•œåƒä¸ºtaræ–‡ä»¶\ndocker save -o httpd.tar httpd:1.00\n```\n\n<mark>æ‰©å±•ï¼šé€šè¿‡é•œåƒå¤šé‡æ„å»ºå¤åˆ¶ä¹Ÿå¯ç”¨è¯¥dockerå‘½ä»¤ç›´æ¥æ›¿ä»£ã€‚</mark>\n\n```shell\ndocker build --rm --platform arm64 -t \"httpd:1.00\" -<<EOF\nFROM multiarch/qemu-user-static:x86_64-aarch64 as qemu\nFROM httpd:latest\nCOPY --from=qemu /usr/bin/qemu-aarch64-static /usr/bin\nCOPY ./index.html  /usr/local/apache2/htdocs/\nEOF\n```\n\n## åœ¨armæœåŠ¡å™¨ä¸ŠéªŒè¯\n\nå°†æ–°çš„é•œåƒtaræ–‡ä»¶å¯¼å…¥åˆ°armæœåŠ¡å™¨ä¸Šï¼Œåˆ›å»ºæ–°å®¹å™¨éªŒè¯é•œåƒæ˜¯å¦å¯ç”¨åŠé•œåƒä¸­çš„htmlæ–‡ä»¶æ˜¯å¦ç”Ÿæ•ˆã€‚\n\n```shell\n# å¯¼å…¥æ–°é•œåƒ\ndocker load -i httpd.tar\n# æŸ¥çœ‹æ–°é•œåƒçš„æ¶æ„\ndocker inspect httpd:1.00 | grep Architecture\n# è¿è¡Œæ–°å®¹å™¨\ndocker run -itd --name test httpd:1.00\n# æŸ¥çœ‹è¿è¡ŒçŠ¶æ€\ndocker ps\n# æŸ¥çœ‹å®¹å™¨IP\ndocker inspect test | grep IPAddress\n# è®¿é—®æµ‹è¯•ä¸Šä¼ çš„htmlæ–‡ä»¶æ˜¯å¦ç”Ÿæ•ˆ\ncurl 172.17.0.2\n```\n","tags":["è¿ç»´","Linux","è·¨æ¶æ„é•œåƒ","x86-ARM","dockeré•œåƒ"],"categories":["å®¹å™¨åŒ–","Linuxè¿ç»´","docker","å®¹å™¨ç®¡ç†"]},{"title":"ä½¿ç”¨portainerç®¡ç†å®¹å™¨","url":"/yyg/c60df0d6/","content":"## åŸºç¡€ç¯å¢ƒ\n\nç³»ç»Ÿç¯å¢ƒï¼š\n\næ“ä½œç³»ç»Ÿï¼šCentOS 7.9\n\nè½¯ä»¶ç¯å¢ƒï¼š\n\nDocker-26.1.4ã€Docker Compose-2.27.1 ã€portainer-2.20.3\n\né…ç½®é˜¿é‡Œyumæº :\n\n```shell\ncd /etc/yum.repos.d\nmv CentOS-Base.repo CentOS-Base.repo.bak\ncurl -o /etc/yum.repos.d/CentOS-Base.repo http://mirrors.aliyun.com/repo/Centos-7.repo\n```\n\né…ç½®é˜²ç«å¢™ç­–ç•¥ï¼š\n\n```shell\nfirewall-cmd --add-port=9443/tcp --permanent\nsudo firewall-cmd --reload\nsudo firewall-cmd --list-all\n```\n\n## å®‰è£…Docker\n\nï¼ˆ1ï¼‰å®‰è£… yum-utils è½¯ä»¶åŒ…ï¼ˆæä¾› yum-config-manager å®ç”¨ç¨‹åºï¼‰å¹¶è®¾ç½®å­˜å‚¨åº“ã€‚\n\n```shell\n# å®‰è£… yum-utils è½¯ä»¶åŒ…\nyum install -y yum-utils\n# è®¾ç½®docker-ceå­˜å‚¨åº“\nyum-config-manager --add-repo http://mirrors.aliyun.com/docker-ce/linux/centos/docker-ce.repo\n```\n\nï¼ˆ2ï¼‰å®‰è£…æœ€æ–°ç‰ˆdockerå’Œdocker composeã€‚\n\n```shell\nyum install -y docker-ce docker-ce-cli containerd.io docker-buildx-plugin docker-compose-plugin\n```\n\nï¼ˆ3ï¼‰ä¿®æ”¹Dockerçš„æ•°æ®ç›®å½•ä¸ºâ€œ/data/dockerDataâ€,å¹¶ä¿®æ”¹dockeré•œåƒæºã€‚\n\n```shell\n# åˆ›å»ºDockerå®ˆæŠ¤è¿›ç¨‹é…ç½®æ–‡ä»¶,ç¼–è¾‘é…ç½®æ–‡ä»¶/etc/docker/daemon.jsonï¼Œé…ç½®dockeræ•°æ®ç›®å½•ï¼Œå¹¶ä¿®æ”¹dockeré•œåƒæº\necho '{\n  \"data-root\": \"/data/dockerData\",\n    \"registry-mirrors\": [\n    \"https://registry.docker-cn.com\",\n    \"http://hub-mirror.c.163.com\",\n    \"https://dockerhub.azk8s.cn\",\n    \"https://mirror.ccs.tencentyun.com\",\n    \"https://registry.cn-hangzhou.aliyuncs.com\",\n    \"https://docker.mirrors.ustc.edu.cn\",\n    \"https://docker.m.daocloud.io\",\n    \"https://noohub.ru\",\n    \"https://huecker.io\",\n    \"https://dockerhub.timeweb.cloud\"\n  ]\n}' > /etc/docker/daemon.json\n```\n\nï¼ˆ4ï¼‰å¯åŠ¨DockeræœåŠ¡ï¼Œå¹¶è®¾ç½®ä¸ºå¼€æœºè‡ªå¯åŠ¨ã€‚\n\n```shell\n# å¯åŠ¨DockeræœåŠ¡\nsystemctl start docker\n# è®¾ç½®Dockerä¸ºå¼€æœºè‡ªå¯åŠ¨\nsystemctl enable docker\n# æŸ¥çœ‹DockeræœåŠ¡çŠ¶æ€\nsystemctl status docker\n```\n\n## å®‰è£…portainer\n\nï¼ˆ1ï¼‰æ‹‰å–portaineré•œåƒå¹¶åˆ›å»ºå®¹å™¨\n\næ–¹å¼ä¸€ï¼šä½¿ç”¨dockerå‘½ä»¤\n\n```\ndocker run -d -p 9443:9443 --name portainer --restart=always -v /var/run/docker.sock:/var/run/docker.sock -v /data/portainer:/data portainer/portainer-ce:2.20.3\n```\n\næ–¹å¼äºŒï¼šä½¿ç”¨composeæ–‡ä»¶å®‰è£…\n\n```shell\nvi portainer.yml\n--------------------------------------------------\nservices:\n  portainer:\n    image: portainer/portainer-ce:2.20.3\n    container_name: portainer\n    restart: always\n    ports:\n      - \"9443:9443\"\n    volumes:\n      - /var/run/docker.sock:/var/run/docker.sock\n      - /data/portainer:/data\n    user: \"0\"\n    networks:\n      net:\n        ipv4_address: 172.20.110.10\n\nnetworks:\n net:\n  driver: bridge\n  ipam:\n   config:\n    - subnet: 172.20.110.0/24\n--------------------------------------------------\n#è¿è¡Œå®‰è£…\ndocker compose -f portainer.yml up -d\n```\n\nï¼ˆ2ï¼‰åˆå§‹åŒ–portainerï¼Œè®¾ç½®adminç”¨æˆ·çš„å¯†ç \n\n![image-20240718163227768](ä½¿ç”¨portainerç®¡ç†å®¹å™¨/1.png)\n\nï¼ˆ3ï¼‰è¿›å…¥ç³»ç»Ÿåï¼Œç‚¹å‡»â€œGet Startedâ€ï¼ŒæŸ¥çœ‹æœ¬æœºçš„å®¹å™¨ï¼Œå¦‚ä¸‹å›¾ã€‚\n\n![image-20240718164748722](ä½¿ç”¨portainerç®¡ç†å®¹å™¨/2.png)\n\n## å¤šå®ä¾‹ç¯å¢ƒç®¡ç†\n\nPortainerå¯ä»¥ç®¡ç†å¤šä¸ªç¯å¢ƒï¼ŒåŒ…æ‹¬Docker Standaloneã€Docker Swarmã€Kubernetesã€ACIç­‰ã€‚\n\nä½¿ç”¨Portainerç®¡ç†å¤šDocker Standaloneå®ä¾‹ï¼Œæœ‰ä¸¤ç§æ–¹å¼ï¼Œåˆ†åˆ«æ˜¯apiå’Œå®¢æˆ·ç«¯å®¹å™¨ã€‚\n\n### æ–¹å¼ä¸€ï¼šä½¿ç”¨docker api ç®¡ç†Docker Standaloneå®ä¾‹\n\nï¼ˆ1ï¼‰åœ¨å…¶ä»–å®ä¾‹ç¯å¢ƒä¸Šï¼Œä¿®æ”¹dockeræœåŠ¡çš„é…ç½®æ–‡ä»¶ï¼Œè®©Dockerå®ˆæŠ¤è¿›ç¨‹é€šè¿‡TCPåœ¨çš„2375ç«¯å£ç›‘å¬è¿æ¥ï¼Œå¹¶é€šè¿‡UNIXå¥—æ¥å­—åœ¨æœ¬åœ°ç›‘å¬è¿æ¥ã€‚\n\nå³åœ¨ExecStartåæ·»åŠ -H tcp://0.0.0.0:2375 -H unix:///var/run/docker.sockå‚æ•°ã€‚\n\n```shell\nvi /usr/lib/systemd/system/docker.service\n#ä¿®æ”¹å†…å®¹å¦‚ä¸‹\n[Service]\nExecStart=/usr/bin/dockerd -H fd:// --containerd=/run/containerd/containerd.sock -H tcp://0.0.0.0:2375 -H unix:///var/run/docker.sock\n```\n\nï¼ˆ2ï¼‰é‡æ–°åŠ è½½é…ç½®ï¼Œä½¿é…ç½®ç”Ÿæ•ˆã€‚\n\n```\n#é‡æ–°åŠ è½½é…ç½®\nsystemctl daemon-reload\n#é‡å¯docker\nsystemctl restart docker\n```\n\nï¼ˆ3ï¼‰è®¾ç½®é˜²ç«å¢™ç­–ç•¥\n\n```\n#åªå…è®¸Portainerä¸»æœºè®¿é—®è¯¥ä¸»æœºçš„2375ç«¯å£\nsudo firewall-cmd --permanent --add-rich-rule=\"rule family=\"ipv4\" source address=\"192.168.22.23/32\" port protocol=\"tcp\" port=\"2357\" accept\"\n```\n\nï¼ˆ4ï¼‰ç‚¹å‡»Environment-relatedèœå•ä¸­çš„Environmentsï¼Œç‚¹å‡»Add environmentæŒ‰é’®ï¼Œæ·»åŠ Docker Standaloneï¼Œå¦‚ä¸‹å›¾ã€‚\n\n![image-20240723122531889](ä½¿ç”¨portainerç®¡ç†å®¹å™¨/3.png)\n\nï¼ˆ5ï¼‰é€‰æ‹©APIï¼Œå¡«å†™åç§°å’ŒDocker Standaloneå®ä¾‹çš„ipå’Œç«¯å£ï¼ˆ2375ï¼‰ï¼Œç‚¹å‡»Connectï¼Œè¿æ¥æˆåŠŸåï¼Œç‚¹å‡»Closeï¼Œå¦‚ä¸‹å›¾ã€‚\n\n![image-20240723122857044](ä½¿ç”¨portainerç®¡ç†å®¹å™¨/4.png)\n\n### æ–¹å¼äºŒï¼šä½¿ç”¨agentå®¹å™¨ç®¡ç†Docker Standaloneå®ä¾‹\n\nï¼ˆ1ï¼‰åœ¨å…¶ä»–å®ä¾‹ç¯å¢ƒä¸Šï¼Œéƒ¨ç½²agentå®¹å™¨è¿›è¡Œè¿æ¥ï¼Œå…·ä½“å‘½ä»¤å¦‚ä¸‹ï¼š\n\n```\ndocker run -d \\\n  -p 9001:9001 \\\n  --name portainer_agent \\\n  --restart=always \\\n  -v /var/run/docker.sock:/var/run/docker.sock \\\n  -v /var/lib/docker/volumes:/var/lib/docker/volumes \\\n  portainer/agent:2.20.3\n```\n\nï¼ˆ2ï¼‰è®¾ç½®é˜²ç«å¢™ç­–ç•¥\n\n```\n#åªå…è®¸Portainerä¸»æœºè®¿é—®è¯¥ä¸»æœºçš„9001ç«¯å£\nsudo firewall-cmd --permanent --add-rich-rule=\"rule family=\"ipv4\" source address=\"192.168.22.23/9001\" port protocol=\"tcp\" port=\"9001\" accept\"\n```\n\nè¿æ¥æˆåŠŸåï¼Œåœ¨Homeç•Œé¢æŸ¥çœ‹ä¸¤ç§æ–¹å¼è¿æ¥çš„Docker Standaloneå®ä¾‹\n\n![image-20240723124359442](ä½¿ç”¨portainerç®¡ç†å®¹å™¨/5.png)\n\n","tags":["docker","portainer"],"categories":["å®¹å™¨åŒ–","Linuxè¿ç»´","docker","å®¹å™¨ç®¡ç†"]},{"title":"é¡¹ç›®é—®é¢˜æ€»ç»“","url":"/yyg/2855a772/","content":"\n### centos 7 å¼€å¯SSHæœåŠ¡åŠé™æ€ipè®¾ç½®\n\næ­¥éª¤ 1ï¼š é…ç½®è¿œç¨‹ç™»å½•æœåŠ¡\n\n```PowerShell\n#é…ç½®è¿œç¨‹sshæœåŠ¡ï¼š\n#å¼€å¯sshæœåŠ¡ï¼š\nvi /etc/ssh/sshd_config,è¿›å…¥é…ç½®æ–‡ä»¶ç•Œé¢\næ‰¾åˆ° #port22è¿™ä¸€è¡Œï¼Œå°†å‰ç¼€æ³¨é‡Šç¬¦åˆ æ‰\næ‰¾åˆ°#PermitRootLoginè¿™ä¸€è¡Œï¼Œå°†å‰ç¼€æ³¨é‡Šç¬¦åˆ æ‰å¹¶ä¿®æ”¹PermitRootLoginç©ºæ ¼åçš„å†…å®¹ä¸ºyes\næ‰¾åˆ° #PasswordAuthenticationè¿™ä¸€è¡Œï¼Œå°†å‰ç¼€æ³¨é‡Šç¬¦åˆ æ‰\nä¿å­˜å¹¶é€€å‡ºé…ç½®æ–‡ä»¶ï¼Œ:wqï¼\né‡å¯sshæœåŠ¡ï¼Œå‘½ä»¤ä¸ºï¼š/etc/init.d/ssh restart\nè‹¥ç³»ç»Ÿä¸‹é‡å¯sshæœåŠ¡éªŒè¯ç ä¸ç”Ÿæ•ˆï¼Œåˆ™rebooté‡å¯ç³»ç»Ÿå³å¯ç”Ÿæ•ˆ\n```\n\næ­¥éª¤ 2ï¼šå¼€æ”¾ç«¯å£åŠé‡æ–°åŠ è½½é˜²ç«å¢™\n\n```PowerShell\nfirewall-cmd --zone=public --add-port=22/tcp --permanent\nfirewall-cmd --reload\n```\n\næ­¥éª¤ 3ï¼š è®¾ç½® IP åœ°å€ï¼Œç½‘å…³ DNS\n\n```PowerShell\n#é¦–å…ˆè¦ç¼–è¾‘ç½‘å¡çš„é…ç½®æ–‡ä»¶ï¼ŒCentOS 7.9ç½‘å¡é…ç½®æ–‡ä»¶çš„è·¯å¾„ï¼š/etc/sysconfig/network-scripts/ifcfg-eth0,æ­¤è·¯å¾„éå¸¸é‡è¦ï¼Œä»¥åä¸»æœºç½‘ç»œä¸é€šï¼Œå¯ä»æ­¤é…ç½®æ–‡ä»¶ä¸­æŸ¥çœ‹ã€‚\nvi /etc/sysconfig/network-scripts/ifcfg-eth0\n```\n\næ­¥éª¤ 4ï¼š è¿›å…¥é…ç½®æ–‡ä»¶ï¼ŒæŒ‰ i å¯¹é…ç½®æ–‡ä»¶è¿›è¡Œç¼–è¾‘\n\n```PowerShell\næ‰¾åˆ°BOOTPROTOè¿™ä¸€è¡Œï¼Œå°†åé¢æ”¹ä¸ºstatic\næ‰¾åˆ°ONBOOTè¿™ä¸€è¡Œï¼Œå°†åé¢æ”¹ä¸ºyes\nåœ¨æœ«å°¾æ·»åŠ IPåœ°å€ã€ç½‘å…³DNS\nIPADDR=172.20.1.80\nGATEWAY=172.20.1.1\nNETMASK=255.255.255.0\nDNS1=8.8.8.8\nDNS2=114.114.114.114\n#é…ç½®å®Œæˆä¹‹åï¼Œé‡å¯ç½‘ç»œæœåŠ¡å³å¯\n#é‡å¯ç½‘å¡ä¹‹å‰ä¸€å®šè¦é‡æ–°è½½å…¥ä¸€ä¸‹é…ç½®æ–‡ä»¶ï¼Œä¸ç„¶ä¸èƒ½ç«‹å³ç”Ÿæ•ˆ \nnmcli c reload\nnmcli d connect eth0 #é‡å¯ç½‘å¡\n```\n\næˆåŠŸä¹‹åï¼Œè¿›è¡Œ ping æµ‹è¯•ã€‚\n\n### Centos9 ä¸‹è½½python2\n\n1. å®‰è£…[zlib](https://so.csdn.net/so/search?q=zlib&spm=1001.2101.3001.7020)åº“ï¼Œä¸ç„¶å®‰è£…pipæ—¶ä¼šæŠ¥é”™ï¼ˆè¿˜è¦é‡æ–°ç¼–è¯‘pythonï¼‰\n\n```Plain\n yum -y install zlib*\n```\n\n1. å®‰è£… GCC åŒ…ï¼Œå¦‚æœæ²¡æœ‰å®‰è£… GCCï¼Œè¯·ä½¿ç”¨ä»¥ä¸‹å‘½ä»¤è¿›è¡Œå®‰è£…\n\n```Shell\nyum -y install gcc openssl-devel bzip2-devel\n```\n\n1. ä¸‹è½½Python-2.7.18\n\n```Plain\n cd /usr/src\n yum -y install wget\n wget https://www.python.org/ftp/python/2.7.18/Python-2.7.18.tgz\n tar xzf Python-2.7.18.tgz\n```\n\n1. åœ¨ç¼–è¯‘ä¹‹å‰è¿˜éœ€è¦åœ¨å®‰è£…æºæ–‡ä»¶ä¸­ä¿®æ”¹Modules/Setup.distæ–‡ä»¶ï¼Œå°†æ³¨é‡Šå»æ‰\n\n```Shell\n#zlib zlibmodule.c -I$(prefix)/include -L$(exec_prefix)/lib -lz\n```\n\n1. ç¼–è¯‘Python-2.7.18ï¼ˆ`make altinstall`ç”¨äºé˜²æ­¢æ›¿æ¢é»˜è®¤çš„ python äºŒè¿›åˆ¶æ–‡ä»¶ /usr/bin/pythonï¼‰\n\n```Shell\ncd /usr/src/Python-2.7.18\n./configure --enable-optimizations\nmake altinstall\n```\n\nä¸è¦è¦†ç›–æˆ–é“¾æ¥åŸå§‹çš„ Python äºŒè¿›åˆ¶æ–‡ä»¶ï¼Œè¿™å¯èƒ½ä¼šæŸåç³»ç»Ÿ\n\n1. è®¾ç½®ç¯å¢ƒå˜é‡\n\n```Shell\nvim /etc/profile\nexport PYTHON_HOME=/usr/local/\nPATH=$PATH:$PYTHON_HOME/bin\nsource /etc/profile\n```\n\n1. ä¸‹è½½å®‰è£…pip\n\næ–¹æ³•ä¸€ï¼š\n\n```Shell\ncurl \"https://bootstrap.pypa.io/pip/2.7/get-pip.py\" -o \"get-pip.py\"\npython2.7 get-pip.py \n```\n\næ–¹æ³•äºŒï¼š\n\n```Shell\n#å®‰è£…setuptools\nwget https://pypi.python.org/packages/2.7/s/setuptools/setuptools-0.6c11-py2.7.egg --no-check-certificate\nchmod +x setuptools-0.6c11-py2.7.egg\nsh setuptools-0.6c11-py2.7.egg\n#å®‰è£…pip\nchmod +x pip-1.3.1.tar.gz\ntar xzvf pip-1.3.1.tar.gz\ncd pip-1.3.1\npython2.7 setup.py install\n```\n\n### centoså®‰è£…gnuplotï¼ˆcentos9éœ€è¦å®‰è£…æœ€æ–°ç‰ˆgnuplotï¼‰\n\nhttps://blog.csdn.net/weixin_33720452/article/details/91719651\n\ngnuplotå®˜ç½‘\n\nhttp://www.gnuplot.info/\n\n#### è§£å†³gnuplotç”»å›¾ä¸­æ–‡ä¹±ç é—®é¢˜\n\nåœ¨ win10 çš„ C:\\Windows\\Fonts ç›®å½•ä¸‹ï¼Œæ‰¾åˆ° â€œå®‹ä½“â€ï¼ˆsimsun.ttcï¼‰\n\næ”¾åœ¨ centos9 çš„ /usr/share/fonts/ ç›®å½•ä¸‹ã€‚\n\nåœ¨rootç›®å½•ä¸‹æ–°å»ºä¸€ä¸ªâ€œ.gnuplotâ€æ–‡ä»¶å°†ä»¥ä¸‹ä»£ç å†™è¿›æ–‡ä»¶ä¸­å³å¯\n\n```Shell\n########################\n### è®¾ç½®é»˜è®¤è¾“å…¥ä¸­æ–‡ ###\n########################\n\n# è®¾ç½®ç»ˆç«¯å­—ä½“\nset term x11 font \"Monospace\" enhanced\n\n# è®¾ç½®ç»ˆç«¯ç¼–ç ä¸ºUTF-8\nset encoding utf8\n\n# è®¾ç½®æ ‡ç­¾å’Œæ ‡é¢˜çš„å­—ä½“å’Œå¤§å°\nset label font \",14\"\nset title font \",16\"\n\n# è®¾ç½®ä¸­æ–‡å­—ä½“å’Œå¤§å°\nset label font \"å®‹ä½“,14\"\nset title font \"å®‹ä½“,16\"\n\n# è®¾ç½®åˆ»åº¦æ ‡ç­¾å’Œå›¾ä¾‹çš„å­—ä½“å’Œå¤§å°\nset key font \",14\"\nset xtics font \",14\"\nset ytics font \",14\"\n\n# è®¾ç½®ä¸­æ–‡å­—ä½“å’Œå¤§å°\nset key font \"å®‹ä½“,14\"\nset xtics font \"å®‹ä½“,14\"\nset ytics font \"å®‹ä½“,14\"\n\n#########################\n### é¿å…ä¹±ç é—®é¢˜ ###\n#########################\n\n# è®¾ç½®ç»ˆç«¯ä¸ºPNGæ ¼å¼ï¼Œå¹¶æŒ‡å®šè¾“å‡ºæ–‡ä»¶åç§°\nset term png font \",14\" enhanced size 800,600\n\n# è®¾ç½®ç»ˆç«¯ç¼–ç ä¸ºUTF-8\nset encoding utf8\n```\n\n### Git cloneä»£ç åˆ°æœ¬åœ°æ¯æ¬¡è¦è¾“å…¥ç”¨æˆ·åå’Œå¯†ç \n\n```Shell\n# è¿è¡Œæ”¹å‘½ä»¤åçš„ç¬¬ä¸€æ¬¡æ‰§è¡Œgit pullæˆ–git pushæˆ–git cloneå‘½ä»¤ä»éœ€è¦è¾“å…¥ç”¨æˆ·åå¯†ç \ngit config --global credential.helper store\n```\n\n### dockerä¸­çš„Apiå®¹å™¨()ç¼ºå°‘GDè€Œä½¿å¾—éªŒè¯ç æ— æ³•æ˜¾ç¤º\n\n#### æ–¹æ³•ä¸€ï¼š\n\n1. è¿›å…¥åˆ°ä½ çš„Dockerå®¹å™¨ä¸­ã€‚å¯ä»¥ä½¿ç”¨ä»¥ä¸‹å‘½ä»¤è¿›å…¥å®¹å™¨çš„ç»ˆç«¯ï¼š\n\n```Plaintext\ndocker exec -it [å®¹å™¨ID] /bin/bash\n```\n\nå…¶ä¸­`[å®¹å™¨ID]`æ˜¯ä½ çš„APIå®¹å™¨çš„IDã€‚\n\n1. å®‰è£…GDåº“ã€‚æ ¹æ®ä½ çš„æ“ä½œç³»ç»Ÿå’Œå®¹å™¨é…ç½®ï¼Œå¯ä»¥å°è¯•ä»¥ä¸‹å‘½ä»¤ï¼š\n   1. ```Plaintext\n      apt-get update\n      apt-get install -y libgd-dev\n      docker-php-ext-configure gd --with-freetype-dir=/usr/include/ --with-jpeg-dir=/usr/include/\n      docker-php-ext-install -j$(nproc) gd\n      ```\n2. é€€å‡ºå®¹å™¨ç»ˆç«¯å¹¶é‡æ–°å¯åŠ¨å®¹å™¨ï¼Œé—®é¢˜è§£å†³ã€‚\n\n![img](é¡¹ç›®é—®é¢˜æ€»ç»“/1711208815491-1-1711208824466-4.png)\n\n#### æ–¹æ³•äºŒï¼š\n\n1. ç¼–è¯‘ phpGD åº“æ‰©å±•\n\n```PowerShell\n# æ›´æ–°è½¯ä»¶æº\napt-get update\n# å®‰è£…ç›¸å…³åº“\napt-get install -y libwebp-dev libjpeg-dev libpng-dev libfreetype6-dev zlib1g-dev\n# è§£å‹æºç \ndocker-php-source extract \n# gd æºç æ–‡ä»¶å¤¹\ncd /usr/src/php/ext/gd\ndocker-php-ext-configure gd --with-webp=/usr/include/webp --with-jpeg=/usr/include --with-freetype=/usr/include/freetype2\næˆ– \ndocker-php-ext-configure gd --with-webp-dir=/usr/include/webp --with-jpeg-dir=/usr/include --with-freetype-dir=/usr/include/freetype2\n#å®‰è£…\nmake && make install\n```\n\n1. å®‰è£… gd æ‰©å±•\n\n```PowerShell\ndocker-php-ext-install gd\n```\n\n### dockerå®¹å™¨ä¸­éƒ¨ç½²çš„é¡¹ç›®æ— æ³•ä¸giteeä¸Šçš„ä»£ç åŒæ­¥\n\n1. è¿›å…¥å­˜å‚¨é¡¹ç›®ä»£ç çš„ç›®å½•\n2. **å¼ºåˆ¶è¦†ç›–æœ¬åœ°ä»£ç **\n\n```PowerShell\ngit fetch --all\ngit reset --hard origin/master\n```\n\n### ç½‘ç«™è®¿é—®æ˜¾ç¤º â€œIndex ofâ€ åˆ—è¡¨é¡µé¢\n\nåªéœ€è¦åœ¨è¯¥ç›®å½•ä¸‹è®¾ç½®ä¸€ä¸ª.htaccessæ–‡ä»¶,å¹¶åœ¨è¯¥æ–‡ä»¶ä¸­æ³¨å…¥ä»¥ä¸‹ä»£ç \n\n```PowerShell\nOptions -Indexes\n```\n\n**ç»™.shæ·»åŠ å¯æ‰§è¡Œæƒé™å¹¶è¿è¡Œ**\n\n1ã€æ·»åŠ å¯æ‰§è¡Œæƒé™\n\n```Plain\nchmod +x xxx.sh\n```\n\n2ã€æ‰§è¡Œ.shæ–‡ä»¶\n\n```Plain\n./xxx.sh\n```\n\n### åŒæ—¶æ—¥å¿—åŒæ—¶æ‰“å°åœ¨å±å¹•å’Œæ–‡ä»¶ä¸­\n\n```Shell\n#å°†è¾“å‡ºç»“æœåŒæ—¶æ‰“å°åœ¨å±å¹•å’Œtest.logæ–‡ä»¶ä¸­\ndocker images | grep mysql | tee -a test.log\n```\n\n### å¸¸ç”¨å‘½ä»¤ï¼š\n\n```PowerShell\ndocker ps | grep pj-zznu\n docker exec -it   /bin/bash\n apt-get dist-upgrade\n```\n\n### é¡¹ç›®ä¸­çš„apiç•Œé¢ä¸æ˜¾ç¤º\n\nè¿›å…¥php.iniæ–‡ä»¶æ‰€åœ¨ä½ç½®ï¼Œå°†display_errors = offæ”¹ä¸ºdisplay_errors = Onï¼Œå¹¶å°† .htaccess æ”¹ä¸º.htaccess.bakï¼ˆæˆ–åˆ é™¤ï¼‰å³å¯\n\n```PowerShell\n cd /usr/local/etc/php/\n cat php.ini |grep display\n mv .htaccess .htaccess.bak\n```\n\n### ä¸€é”®éƒ¨ç½²docker-composeæ–‡ä»¶ï¼Œå¹¶ç”Ÿæˆé•œåƒè„šæœ¬\n\n```Shell\n#!/bin/bash\n\n# åˆ›å»ºdocker-composeæ–‡ä»¶ï¼Œå®‰è£…éƒ¨ç½²å®¹å™¨\n#æ–°å»ºdocker-composeæ–‡ä»¶\ntouch docker-compose.yml\n\nread -p \"è¯·è¾“å…¥å®¹å™¨åç§°ï¼š\" container_name\nread -p \"è¯·è¾“å…¥é•œåƒåç§°(æ ¼å¼å¦‚ mysql:5.8)ï¼š\" images_name\necho \"è¯·è¾“å…¥environmentæ‰€éœ€å†…å®¹ï¼Œå¯è¾“å…¥å¤šè¡Œæ•°æ®ï¼ŒæŒ‰Ctrl+Dç»“æŸï¼š\"\nenvironment_things=$(cat)\nread -p \"è¯·è¾“å…¥ç«¯å£å·(æ ¼å¼å¦‚\"\\\"3306:3306\"\\\",å¼•å·ä¹Ÿæœ‰)ï¼š\" port_name\nread -p \"è¯·è¾“å…¥æ˜ å°„ç›®å½•(æ ¼å¼å¦‚/data/database/pj-zznu-ywgl-1.0:/var/lib/mysql)ï¼š\" contents_name\nread -p \"è¯·è¾“å…¥å®¹å™¨ipåœ°å€(æ ¼å¼å¦‚ 172.1.21.12)ï¼š\" ip_name\n#å°†é…ç½®å†™å…¥æ–‡ä»¶\nif [ -n \"$environment_things\" ] && [ -n \"$port_name\" ]; then\n  echo \"version: '2.2'\nservices:\n  $container_name:\n    image: $images_name\n    container_name: $container_name\n    restart: always\n    environment:\n      $environment_things\n    ports:\n      - $port_name\n    volumes:\n      - $contents_name\n    user: \\\"0\\\"\n    networks:\n      net:\n        ipv4_address: $ip_name\n\" > docker-compose.yml\nelif [ -z \"$environment_things\" ]; then\n  echo \"environmentè®¾ç½®å·²è·³è¿‡\n  \"\n  echo \"version: '2.2'\nservices:\n  $container_name:\n    image: $images_name\n    container_name: $container_name\n    restart: always\n    ports:\n      - $port_name\n    volumes:\n      - $contents_name\n    user: \\\"0\\\"\n    networks:\n      net:\n        ipv4_address: $ip_name\n\" > docker-compose.yml\nelif [ -z \"$port_name\" ]; then\n  echo \"ç«¯å£è®¾ç½®å·²è·³è¿‡\n  \"\n  echo \"version: '2.2'\nservices:\n  $container_name:\n    image: $images_name\n    container_name: $container_name\n    restart: always\n    environment:\n      $environment_things\n    volumes:\n      - $contents_name\n    user: \\\"0\\\"\n    networks:\n      net:\n        ipv4_address: $ip_name\n\" > docker-compose.yml\nelif [ -z \"$environment_things\" ] && [ -z \"$port_name\" ]; then\n  echo \"environmentå’Œç«¯å£è®¾ç½®å·²è·³è¿‡\n  \"\n  echo \"version: '2.2'\nservices:\n  $container_name:\n    image: $images_name\n    container_name: $container_name\n    restart: always\n    volumes:\n      - $contents_name\n    user: \\\"0\\\"\n    networks:\n      net:\n        ipv4_address: $ip_name\n\" > docker-compose.yml\nfi\n\n\n#ç»™docker-composeæ–‡ä»¶æ·»åŠ å¯æ‰§è¡Œæƒé™\nchmod +x docker-compose.yml\n\n#é‡å‘½åæ–‡ä»¶\nmv docker-compose.yml docker-compose-$container_name.yml\n\n#è¿è¡Œdocker-composeæ–‡ä»¶ï¼Œç”Ÿæˆå®¹å™¨\ndocker compose -f docker-compose-$container_name.yml up -d\n```\n\nåœ¨httpdå®¹å™¨ä¸­æ”¹å˜æ˜ å°„ç›®å½•\n\n```Shell\ndocker cp htttpd-test:/usr/local/apache2/conf/httpd.conf httpd.conf\n#å°†httpd.confä¸­çš„DocumentRootä¿®æ”¹ä¸ºå®¹å™¨ä¸­è¦æ˜ å°„çš„æ–°ç›®å½•\n#é‡å¯å³å¯\ndocker restart tl-dev-stat\n```\n\n### nginxè·¨ä¸»æœºä»£ç†å®¹å™¨\n\nå¦‚ä¸‹å›¾æ‰€ç¤ºï¼Œä¸»æœº2ä¸Šçš„nginxè¦è¦æƒ³ä»£ç†åˆ°ä¸»æœº1çš„å®¹å™¨ï¼Œæœ‰ä¸¤ç§æ–¹å¼ï¼š\n\n![image-20240323234857825](é¡¹ç›®é—®é¢˜æ€»ç»“/image-20240323234857825-1711208939935-6.png)\n\n1. äºŒæ¬¡ä»£ç†\n\nåœ¨ä¸»æœº1ä¸Šå®‰è£…nginxï¼Œé€šè¿‡ä¸»æœº1ä¸Šçš„nginxå°†å®¹å™¨ä»£ç†å‡ºæ¥ï¼Œå†ä½¿ç”¨ä¸»æœºäºŒä¸Šçš„nginxï¼Œå°†ä¸»æœº1ä»£ç†å‡ºæ¥\n\n2. é…ç½®è·¯ç”±\n\nç›´æ¥å°†å®¹å™¨çš„ipæˆ–è€…dockerç½‘ç»œå†™å…¥ä¸»æœº2çš„è·¯ç”±\n\ndockerå®¹å™¨è®¾ç½®87ã€95ç«¯å£åœ¨æµè§ˆå™¨è®¿é—®å—é™çš„è§£å†³æ–¹æ³•\n\nhttps://blog.csdn.net/qq_44159028/article/details/115705470\n\ndockerä¿®æ”¹é»˜è®¤å­˜å‚¨è·¯å¾„\n\n```Shell\n#/data/dockerä¸ºå­˜å‚¨æ–°è·¯å¾„\n#############ä¿®æ”¹å†…å®¹################\nvi /etc/docker/daemon.json \n{\n  \"data-root\": \"/data/docker\"\n}\n#############ä¿®æ”¹å†…å®¹################\nsystemctl restart docker\n```\n\n### apiå®¹å™¨å†…å®‰è£…æ•°æ®åº“ä¾èµ–\n\n```Shell\n#è¿›å…¥apiå®¹å™¨åå®‰è£…\ndocker-php-ext-install mysqli\ndocker-php-ext-install pdo_mysql\napt-get install libpq-dev\ndocker-php-ext-install pdo_pgsql\ndocker-php-ext-install pgsql\napt-get install libxml2-dev -y\ndocker-php-ext-install soap\n```\n\n### apiå®¹å™¨å†…æ·»åŠ /apiåˆ°000-default.confé…ç½®æ–‡ä»¶\n\n```Shell\ncd  /etc/apache2/sites-available\n#å†™å…¥å‘½ä»¤\n sed -i '/<\\/VirtualHost>/i\\\nAlias \\/api \"\\/var\\/www\\/html\\/OpenAPI\"\\\n\\<Directory \"\\/var\\/www\\/html\\/OpenAPI\"\\>\\\n    Options FollowSymLinks\\\n    AllowOverride None\\\n    Require all granted\\\n\\<\\/Directory\\>' 000-default.conf\n```\n\n### åœ¨äº‘æœåŠ¡å™¨ä¸Šä½¿ç”¨openEuler 20.03 LTSå®‰è£…è½¯ä»¶æ—¶å€™æŠ¥é”™:Error: GPG check FAILED\n\næ–¹æ³•1ã€å¯ä»¥åœ¨å®‰è£…åŒ…çš„åé¢åŠ ä¸€ä¸ª â€œâ€“nogpgcheckâ€ è¿™ä¸ªå‚æ•°ï¼Œå¯ç»•è¿‡GPGéªŒè¯æˆåŠŸå®‰è£…ã€‚\n\næ–¹æ³•2ã€å¯ä»¥åœ¨å®‰è£…åŒ…çš„åé¢åŠ ä¸€ä¸ª â€œ --nogpgcheck --nobestâ€œè¿™ä¸ªå‚æ•°\n\næ–¹æ³•3ã€\n\nhttps://blog.csdn.net/xukeworknet/article/details/84681626\n\nå¹¶ä¿®æ”¹openEuler.repoä¸­çš„gpgcheckä¸º0\n\n### cephå‡ºç°`1 monitors have not enabled msgr2`\n\n```Shell\nceph mon enable-msgr2\n```\n\n### cephå‡ºç°`mons are allowing insecure global_id reclaim`\n\n```Shell\nceph config set mon auth_allow_insecure_global_id_reclaim false\n```\n\n### dockerå®‰è£…zipã€pcntlã€imagick\n\n```Shell\ndocker-php-ext-install zip\ndocker-php-ext-install pcntl\n#å®‰è£…imagick\napt-get install imagemagick\napt-get install libmagick++-dev\npecl install imagick\ndocker-php-ext-enable imagick\nphp -m|grep imagick\n```\n\n### nginxä»£ç†httpsï¼Œå¹¶å°†httpå¼ºåˆ¶è½¬ä¸ºhttps\n\nå®‰è£…httpsè¯ä¹¦\n\n```Shell\n#åˆ›å»ºè¯ä¹¦ç›®å½•ï¼Œå¹¶èµ‹äºˆæƒé™\nmkdir -p /etc/nginx/https-ca\nchmod  -R 777 /etc/nginx/https-ca\ncd /etc/nginx/https-ca\n#åˆ›å»ºç§é’¥\nopenssl genrsa -des3 -out ca.key 2048\n#ç”Ÿæˆcaè¯ä¹¦ï¼Œipä¸ºæœ¬æœºip\nopenssl req -sha512 -new \\\n     -subj \"/C=CN/ST=CN/L=CN/O=test/OU=test/CN=test\" \\\n     -key ca.key \\\n     -out ca.csr\n #å¤‡ä»½è¯ä¹¦\n cp ca.key  ca.key.org\n #è½¬åŒ–ä¸ºä¸å¸¦å¯†ç çš„ç§é’¥\n openssl rsa -in ca.key.org -out ca.key\n #ä½¿ç”¨è¯ä¹¦è¿›è¡Œç­¾å\n  openssl x509 -req -days 100000  -in ca.csr -signkey ca.key -out ca.crt\nsudo firewall-cmd  --add-port=443/tcp --permanent\nsudo firewall-cmd  --add-port=80/tcp --permanent\nsudo firewall-cmd --reload\nsudo firewall-cmd --list-all\n\n#ä¿®æ”¹nginx.conf\nsudo cp nginx.conf nginx.conf.bak\n#å°†80éƒ¨åˆ†æ³¨é‡Š\n###################################\n#    server {\n#        listen       80;\n#        listen       [::]:80;\n#        server_name  _;\n#        root         /usr/share/nginx/html;\n#\n#        # Load configuration files for the default server block.\n#        include /etc/nginx/default.d/*.conf;\n#\n#        error_page 404 /404.html;\n#            location = /40x.html {\n#        }\n#\n#        error_page 500 502 503 504 /50x.html;\n#            location = /50x.html {\n#        }\n#    }\n#\n###################################\n#å°†æœ€åçš„éƒ¨åˆ†ä¿®æ”¹æˆå¦‚ä¸‹å†…å®¹ï¼š\n###################################\nserver {\n        listen       443 ssl http2;\n        listen       [::]:443 ssl http2;\n        server_name  _;\n        root         /usr/share/nginx/html;\n\n        ssl_certificate \"/etc/nginx/https-ca/ca.crt\";\n        ssl_certificate_key \"/etc/nginx/https-ca/ca.key\";\n        ssl_session_cache shared:SSL:1m;\n        ssl_session_timeout  10m;\n       # ssl_ciphers PROFILE=SYSTEM;\n\n        ssl_prefer_server_ciphers on;\n\n        # Load configuration files for the default server block.\n        include /etc/nginx/default.d/*.conf;\n\n        error_page 404 /404.html;\n            location = /40x.html {\n        }\n\n        error_page 500 502 503 504 /50x.html;\n            location = /50x.html {\n        }\n    }\n\n###################################\n\n#åœ¨/etc/nginx/conf.dä¸­å¯¹åº”ä¸šåŠ¡çš„nginxé…ç½®æ–‡ä»¶ä¸­åŠ å…¥ä»¥ä¸‹å†…å®¹\n######################################\nserver {\n    listen 443 ssl http2;\n    listen [::]:443 ssl http2;\n    server_name mlzy.hactcm.edu.cn;\n    root /usr/share/nginx/html;\n\n    ssl_certificate \"/etc/nginx/ssl/ca.crt\"; #è¯ä¹¦ä½ç½®\n    ssl_certificate_key \"/etc/nginx/ssl/ca.key\"; #å¯†é’¥ä½ç½®\n    ssl_session_cache shared:SSL:1m;\n    ssl_session_timeout 10m;\n\n    ssl_prefer_server_ciphers on;\n\n    location / {\n        proxy_pass http://211.69.32.39/; #ä¸»æœºip\n        proxy_set_header Host $host;\n        client_max_body_size 1000M;\n    }\n\n    error_page 497 https://$host$request_uri;\n\n    if ($scheme != \"https\") {\n        return 301 https://$host$request_uri;\n    }\n}\n######################################\n```\n\n### armæ¶æ„éƒ¨ç½²dotnet:8.0å®¹å™¨\n\nä½¿ç”¨docker composeç¼–æ’éƒ¨ç½²å®¹å™¨æ—¶ï¼Œdotnet8å‡ºç°æ— æ³•å¯åŠ¨ç°è±¡ï¼Œå…·ä½“å¼‚å¸¸æ—¥å¿—å¦‚ä¸‹ï¼š\n\n> GC: Failed to initialize GCToOSInterface\n> \n> GC initialization failed with error 0x80004005\n> \n> Failed to create CoreCLR, HRESULT: 0x80004005\n\n```Shell\n #è¦ä½¿å¾—å®¹å™¨æ­£å¸¸è¿è¡Œï¼Œéœ€è¦å°†æ ‡æ³¨éƒ¨åˆ†åŠ å…¥composeæ–‡ä»¶\ntest-dotnet:\n    image: test-dotnet:1.0\n    container_name: test-dotnet\n    restart: always\n    security_opt:  #åŠ å…¥\n      - \"seccomp=unconfined\" #åŠ å…¥\n    volumes:\n      - /xxxxx/:/xxxxx\n    user: \"0\"\n    networks:\n      net:\n        ipv4_address: 172.20.106.74\n```\n\n<mark>dotnet8å®¹å™¨çš„é»˜è®¤å¼€æ”¾ç«¯å£ä¸º8080</mark>\n\n### liunxå®‰è£…db_load\n\n```Shell\n#Debian\napt-get install db-util\n\n#Ubuntu\napt-get install db-util\n\n#Alpine\napk add db\n\n#Arch Linux\npacman -S db\n\n#Kali Linux\napt-get install db-util\n\n#CentOS\nyum install libdb-utils\n\n#Fedora\ndnf install libdb-utils\n\n#Raspbian\napt-get install db-util\n\n#Docker\ndocker run cmd.cat/db_load db_load\n```\n\n### æŸ¥çœ‹å½“å‰ç›®å½•ä¸‹æ–‡ä»¶æ•°é‡\n\n```Shell\n#å½“å‰ç›®å½•ä¸‹çš„æ–‡ä»¶æ•°é‡ï¼ˆä¸åŒ…å«å­ç›®å½•ä¸­çš„æ–‡ä»¶ï¼‰\nls -l | grep \"^-\" | wc -l\n#å½“å‰ç›®å½•ä¸‹çš„ç›®å½•æ•°é‡ï¼ˆä¸åŒ…å«å­ç›®å½•ï¼‰\nls -l | grep \"^d\" | wc -l\n#æŸ¥çœ‹å½“å‰ç›®å½•ä¸‹çš„æ–‡ä»¶æ•°é‡ï¼ˆåŒ…å«å­ç›®å½•ä¸­çš„æ–‡ä»¶ï¼‰æ³¨æ„ï¼šRï¼Œä»£è¡¨å­ç›®å½•\nls -lR | grep \"^-\" | wc -l\n#æŸ¥çœ‹å½“å‰ç›®å½•ä¸‹çš„ç›®å½•ä¸ªæ•°ï¼ˆä¸åŒ…å«å­ç›®å½•ä¸­çš„ç›®å½•ï¼‰\nls -l | grep \"^d\" | wc -l\n#æŸ¥çœ‹å½“å‰ç›®å½•ä¸‹çš„ç›®å½•æ•°é‡ï¼ˆåŒ…å«å­ç›®å½•ä¸­çš„ç›®å½•ï¼‰æ³¨æ„ï¼šRï¼Œä»£è¡¨å­ç›®å½•\nls -lR | grep \"^d\" | wc -l\n# ä¾‹å¦‚ï¼šç»Ÿè®¡æ‰€æœ‰ä»¥â€œ20161124â€å¼€å¤´çš„ç›®å½•ä¸‹çš„å…¨éƒ¨æ–‡ä»¶æ•°é‡\nls -lR 20161124*/|grep \"^-\"| wc -l\n```\n\n### åœ¨x86æœºå™¨ä¸Šä½¿ç”¨**QEMUå’ŒTAP-Windowså®‰è£…****arm****è™šæ‹Ÿæœº**\n\n```Shell\n#åœ¨qemuæ‰€åœ¨ç›®å½•æ‰“å¼€cmdï¼Œæ‰§è¡Œä»¥ä¸‹å‘½ä»¤\n#åˆ›å»ºç¡¬ç›˜é•œåƒ\nqemu-img create -f qcow2 openEuler-22.03-LTS-SP2-aarch64.img 20G\n#å®‰è£…ç³»ç»Ÿ\nqemu-system-aarch64 -m 4096 -cpu cortex-a57 -smp 2 -M virt -bios F:\\qemu\\script\\QEMU_EFI.fd -net nic -net tap,ifname=TAP -device nec-usb-xhci -device usb-kbd -device usb-mouse -device VGA -drive if=none,file=F:\\OS\\openEuler-22.03-LTS-SP2-aarch64-dvd.iso,id=cdrom,media=cdrom -device virtio-scsi-device -device scsi-cd,drive=cdrom -drive if=none,file=E:\\centos-clean-VBox\\openEuler-arm\\openEuler-arm.qcow2,id=hd0 -device virtio-blk-device,drive=hd0\nqemu-system-aarch64 -m 4G -cpu cortex-a72 -smp 2 -M virt -bios F:\\qemu\\script\\QEMU_EFI.fd -device nec-usb-xhci -device usb-kbd -device usb-mouse -device VGA -cdrom F:\\OS\\openEuler-22.03-LTS-SP2-aarch64-dvd.iso -hda E:\\centos-VBox\\openeuler-arm-172.20.1.60\\openEuler-22.03-LTS-SP2-aarch64.img\n```","tags":["æ€»ç»“","è¿ç»´"],"categories":["æ¢³ç†æ€»ç»“"]},{"title":"ELK | ä½¿ç”¨ dockeréƒ¨ç½²ä¸‰èŠ‚ç‚¹ Elasticsearch é›†ç¾¤","url":"/yyg/56088d5a/","content":"## ç¯å¢ƒå‡†å¤‡\n\n1. ç¡¬ä»¶ç¯å¢ƒ\n\n   æ“ä½œç³»ç»Ÿï¼šCentos Stream 9\n\n   CPUï¼š4é¢—\n\n   å†…å­˜ï¼š8GB\n\n   ç¡¬ç›˜ï¼š50GB\n\n2. è½¯ä»¶ç¯å¢ƒ\n\n   dockerç‰ˆæœ¬ï¼š26.1.0\n\n   docker composeç‰ˆæœ¬ï¼šv2.26.1\n\n## éƒ¨ç½²è¿‡ç¨‹\n\n### å‡†å¤‡åŸºç¡€ç¯å¢ƒï¼Œå®‰è£…Docker\n\n1ã€å®‰è£… yum-utils è½¯ä»¶åŒ…ï¼ˆæä¾› yum-config-manager å®ç”¨ç¨‹åºï¼‰å¹¶è®¾ç½®å­˜å‚¨åº“ï¼Œå‘½ä»¤å¦‚ä¸‹ã€‚\n\n```\n# å®‰è£… yum-utils è½¯ä»¶åŒ…\nyum install -y yum-utils\n# è®¾ç½®docker-ceå­˜å‚¨åº“\nyum-config-manager --add-repo https://download.docker.com/linux/centos/docker-ce.repo\n```\n\n2ã€å®‰è£…æœ€æ–°ç‰ˆdockeråŠå…¶ç»„ä»¶ï¼Œå‘½ä»¤å¦‚ä¸‹ã€‚\n\n```\nyum install -y docker-ce docker-ce-cli containerd.io docker-buildx-plugin docker-compose-plugin\n```\n\n3ã€å¯åŠ¨DockeræœåŠ¡ï¼Œå¹¶è®¾ç½®ä¸ºå¼€æœºè‡ªå¯åŠ¨ï¼Œå‘½ä»¤å¦‚ä¸‹ã€‚\n\n```\n# å¯åŠ¨DockeræœåŠ¡\nsystemctl start docker\n# è®¾ç½®Dockerä¸ºå¼€æœºè‡ªå¯åŠ¨\nsystemctl enable docker\n# æŸ¥çœ‹DockeræœåŠ¡çŠ¶æ€\nsystemctl status docker\n```\n\n4ã€ä¿®æ”¹Dockerçš„æ•°æ®ç›®å½•ä¸ºâ€œ/data/dockerDataâ€ï¼Œå¹¶é‡å¯dockeræœåŠ¡ä½¿é…ç½®ç”Ÿæ•ˆã€‚\n\n```\n# åˆ›å»ºDockerå®ˆæŠ¤è¿›ç¨‹é…ç½®æ–‡ä»¶\n# ç¼–è¾‘é…ç½®æ–‡ä»¶/etc/docker/daemon.jsonï¼Œé…ç½®dockeræ•°æ®ç›®å½•\nvi /etc/docker/daemon.json\n**************************daemon.json**************************\n{\n  \"data-root\": \"/data/dockerData\"\n}\n**************************daemon.json**************************\n\n# é‡å¯dockeræœåŠ¡ï¼Œä½¿é…ç½®ç”Ÿæ•ˆ\nsystemctl restart docker\n```\n\n5ã€è®¾ç½®ä¸å†…å­˜æ˜ å°„ç›¸å…³çš„å†…æ ¸å‚æ•°ä¸º262144ï¼ŒæŸ¥çœ‹åº”ç”¨åˆ°ç³»ç»Ÿçš„å†…æ ¸å‚æ•°ã€‚\n\n```\necho \"vm.max_map_count=262144\" >> /etc/sysctl.conf\nsysctl -p\n```\n\n6ã€é…ç½®é˜²ç«å¢™ç­–ç•¥\n\n```\nfirewall-cmd --add-port=9200/tcp --permanent\nfirewall-cmd --add-port=80/tcp --permanent\nfirewall-cmd --add-port=443/tcp --permanent\nfirewall-cmd --add-port=5601/tcp --permanent\nfirewall-cmd --reload\nfirewall-cmd --list-all\n```\n\n### éƒ¨ç½²elké›†ç¾¤\n\n1ã€åˆ›å»ºæ„å»ºå®¹å™¨æ‰€éœ€è¦çš„æ–‡ä»¶ç›®å½•ï¼Œå¹¶èµ‹äºˆç›¸åº”çš„è®¿é—®æƒé™ã€‚\n\n```\ncd /data\nmkdir es-node1  es-node2  es-node3  elk-kibana\nchmod g+rwx es-node1  es-node2  es-node3  elk-kibana\nchgrp 0 es-node1  es-node2  es-node3  elk-kibana\n```\n\n2ã€åœ¨/data/script ç›®å½•ä¸‹ï¼Œåˆ›å»ºå¹¶ç¼–è¾‘ .env æ–‡ä»¶ï¼Œç”¨æ¥é…ç½®elkçš„ç¯å¢ƒå˜é‡ã€‚\n\n```\nmkdir /data/script\nvi /data/script/.env\n**************************.env**************************\n# Elasticsearchçš„å¯†ç \nELASTIC_PASSWORD=elk#bd@123\n# Kibanaçš„å¯†ç \nKIBANA_PASSWORD=elk#bd@123\n# Elastic Stackçš„ç‰ˆæœ¬å·\nSTACK_VERSION=8.13.3\n# Elastic Stackçš„é›†ç¾¤åç§°\nCLUSTER_NAME=ELK-docker-Cluster\n# æŒ‡å®šElastic Stackçš„è®¸å¯è¯ç±»å‹\nLICENSE=basic\n# æŒ‡å®šElasticsearchçš„ç«¯å£å·\nES_PORT=9200\n# æŒ‡å®šKibanaçš„ç«¯å£å·\nKIBANA_PORT=5601\n# æŒ‡å®šå†…å­˜é™åˆ¶\nMEM_LIMIT=2147483648\n# æŒ‡å®šDocker Composeé¡¹ç›®çš„åç§°\nCOMPOSE_PROJECT_NAME=elk-docker-project\n**************************.env**************************\n```\n\n3ã€åˆ›å»ºlogstashå®¹å™¨æ‰€éœ€çš„ç›®å½•å’Œé…ç½®æ–‡ä»¶ã€‚\n\n```\nmkdir -p logstash/config logstash/pipeline\necho 'http.host: \"0.0.0.0\"' > /data/logstash/config/logstash.yml\nvi /data/logstash/pipeline/logstash.conf\n**************************logstash.conf**************************\ninput {\n  beats {\n    port => 5044\n  }\n}\n\noutput {\n  elasticsearch {\n    hosts => [\"https://es-node1:9200\"]\n    index => \"%{[@metadata][beat]}-%{[@metadata][version]}-%{+YYYY.MM.dd}\"\n    user => \"elastic\"\n    password => \"elk#bd@123\"\n    cacert=> \"/usr/share/logstash/config/certs/ca/ca.crt\"\n  }\n}\n**************************logstash.conf**************************\n```\n\n4ã€åˆ›å»ºdocker composeæ–‡ä»¶ï¼Œç¼–æ’åˆ›å»ºesåˆå§‹åŒ–èŠ‚ç‚¹ã€esä¸‰èŠ‚ç‚¹ã€Kibanaã€logstashå®¹å™¨ã€‚\n\n```\nvi /data/script/elk.yml\n**************************elk.yml**************************\nservices:\n  es-setup:\n    image: docker.elastic.co/elasticsearch/elasticsearch:${STACK_VERSION}\n    container_name: es-setup\n    volumes:\n      - /data/elk-certs:/usr/share/elasticsearch/config/certs\n    user: \"0\"\n    networks:\n      net:\n        ipv4_address: 172.20.100.10\n    command: >\n      bash -c '\n        if [ x${ELASTIC_PASSWORD} == x ]; then\n          echo \"Set the ELASTIC_PASSWORD environment variable in the .env file\";\n          exit 1;\n        elif [ x${KIBANA_PASSWORD} == x ]; then\n          echo \"Set the KIBANA_PASSWORD environment variable in the .env file\";\n          exit 1;\n        fi;\n        \n        if [ ! -f config/certs/ca.zip ]; then\n          echo \"Creating CA\";\n          bin/elasticsearch-certutil ca --silent --pem -out config/certs/ca.zip;\n          unzip config/certs/ca.zip -d config/certs;\n        fi;\n        if [ ! -f config/certs/certs.zip ]; then\n          echo \"Creating certs\";\n          echo -ne \\\n          \"instances:\\n\"\\\n          \"  - name: es-node1\\n\"\\\n          \"    dns:\\n\"\\\n          \"      - es-node1\\n\"\\\n          \"      - localhost\\n\"\\\n          \"    ip:\\n\"\\\n          \"      - 127.0.0.1\\n\"\\\n          \"  - name: es-node2\\n\"\\\n          \"    dns:\\n\"\\\n          \"      - es-node2\\n\"\\\n          \"      - localhost\\n\"\\\n          \"    ip:\\n\"\\\n          \"      - 127.0.0.1\\n\"\\\n          \"  - name: es-node3\\n\"\\\n          \"    dns:\\n\"\\\n          \"      - es-node3\\n\"\\\n          \"      - localhost\\n\"\\\n          \"    ip:\\n\"\\\n          \"      - 127.0.0.1\\n\"\\\n          > config/certs/instances.yml;\n          bin/elasticsearch-certutil cert --silent --pem -out config/certs/certs.zip --in config/certs/instances.yml --ca-cert config/certs/ca/ca.crt --ca-key config/certs/ca/ca.key;\n          unzip config/certs/certs.zip -d config/certs;\n        fi;\n\n        echo \"Setting file permissions\";\n        chown -R root:root config/certs;\n        find . -type d -exec chmod 750 \\{\\} \\;;\n        find . -type f -exec chmod 640 \\{\\} \\;;\n        echo \"Waiting for Elasticsearch availability\";\n        until curl -s --cacert config/certs/ca/ca.crt https://es-node1:9200 | grep -q \"missing authentication credentials\"; do sleep 30; done;\n        echo \"Setting kibana_system password\";\n        until curl -s -X POST --cacert config/certs/ca/ca.crt -u \"elastic:${ELASTIC_PASSWORD}\" -H \"Content-Type: application/json\" https://es-node1:9200/_security/user/kibana_system/_password -d \"{\\\"password\\\":\\\"${KIBANA_PASSWORD}\\\"}\" | grep -q \"^{}\"; do sleep 10; done;\n        echo \"All done!\";\n      '\n    healthcheck:\n      test: [\"CMD-\", \"[ -f config/certs/es-node1/es-node1.crt ]\"]\n      interval: 1s\n      timeout: 5s\n      retries: 120\n\n  es-node1:\n    depends_on:\n      es-setup:\n        condition: service_healthy\n    image: docker.elastic.co/elasticsearch/elasticsearch:${STACK_VERSION}\n    container_name: es-node1\n    restart: always\n    networks:\n      net:\n        ipv4_address: 172.20.100.11\n    volumes:\n      - /data/elk-certs:/usr/share/elasticsearch/config/certs\n      - /data/es-node1:/usr/share/elasticsearch/data\n    ports:\n      - ${ES_PORT}:9200\n    environment:\n      - node.name=es-node1\n      - cluster.name=${CLUSTER_NAME}\n      - cluster.initial_master_nodes=es-node1,es-node2,es-node3\n      - discovery.seed_hosts=es-node2,es-node3\n      - ELASTIC_PASSWORD=${ELASTIC_PASSWORD}\n      - bootstrap.memory_lock=true\n      - xpack.security.enabled=true\n      - xpack.security.http.ssl.enabled=true\n      - xpack.security.http.ssl.key=certs/es-node1/es-node1.key\n      - xpack.security.http.ssl.certificate=certs/es-node1/es-node1.crt\n      - xpack.security.http.ssl.certificate_authorities=certs/ca/ca.crt\n      - xpack.security.transport.ssl.enabled=true\n      - xpack.security.transport.ssl.key=certs/es-node1/es-node1.key\n      - xpack.security.transport.ssl.certificate=certs/es-node1/es-node1.crt\n      - xpack.security.transport.ssl.certificate_authorities=certs/ca/ca.crt\n      - xpack.security.transport.ssl.verification_mode=certificate\n      - xpack.license.self_generated.type=${LICENSE}\n    mem_limit: ${MEM_LIMIT}\n    ulimits:\n      memlock:\n        soft: -1\n        hard: -1\n    healthcheck:\n      test:\n        [\n          \"CMD-\",\n          \"curl -s --cacert config/certs/ca/ca.crt https://localhost:9200 | grep -q 'missing authentication credentials'\",\n        ]\n      interval: 10s\n      timeout: 10s\n      retries: 120\n    extra_hosts:\n      - \"es-node1:172.20.100.11\"\n      - \"es-node2:172.20.100.12\"\n      - \"es-node3:172.20.100.13\"\n\n  es-node2:\n    depends_on:\n      - es-node1\n    image: docker.elastic.co/elasticsearch/elasticsearch:${STACK_VERSION}\n    container_name: es-node2\n    restart: always\n    networks:\n      net:\n        ipv4_address: 172.20.100.12\n    volumes:\n      - /data/elk-certs:/usr/share/elasticsearch/config/certs\n      - /data/es-node2:/usr/share/elasticsearch/data\n    environment:\n      - node.name=es-node2\n      - cluster.name=${CLUSTER_NAME}\n      - cluster.initial_master_nodes=es-node1,es-node2,es-node3\n      - discovery.seed_hosts=es-node1,es-node3\n      - bootstrap.memory_lock=true\n      - xpack.security.enabled=true\n      - xpack.security.http.ssl.enabled=true\n      - xpack.security.http.ssl.key=certs/es-node2/es-node2.key\n      - xpack.security.http.ssl.certificate=certs/es-node2/es-node2.crt\n      - xpack.security.http.ssl.certificate_authorities=certs/ca/ca.crt\n      - xpack.security.transport.ssl.enabled=true\n      - xpack.security.transport.ssl.key=certs/es-node2/es-node2.key\n      - xpack.security.transport.ssl.certificate=certs/es-node2/es-node2.crt\n      - xpack.security.transport.ssl.certificate_authorities=certs/ca/ca.crt\n      - xpack.security.transport.ssl.verification_mode=certificate\n      - xpack.license.self_generated.type=${LICENSE}\n    mem_limit: ${MEM_LIMIT}\n    ulimits:\n      memlock:\n        soft: -1\n        hard: -1\n    healthcheck:\n      test:\n        [\n          \"CMD-\",\n          \"curl -s --cacert config/certs/ca/ca.crt https://localhost:9200 | grep -q 'missing authentication credentials'\",\n        ]\n      interval: 10s\n      timeout: 10s\n      retries: 120\n    extra_hosts:\n      - \"es-node1:172.20.100.11\"\n      - \"es-node2:172.20.100.12\"\n      - \"es-node3:172.20.100.13\"\n\n  es-node3:\n    depends_on:\n      - es-node2\n    image: docker.elastic.co/elasticsearch/elasticsearch:${STACK_VERSION}\n    container_name: es-node3\n    restart: always\n    networks:\n      net:\n        ipv4_address: 172.20.100.13\n    volumes:\n      - /data/elk-certs:/usr/share/elasticsearch/config/certs\n      - /data/es-node3:/usr/share/elasticsearch/data\n    environment:\n      - node.name=es-node3\n      - cluster.name=${CLUSTER_NAME}\n      - cluster.initial_master_nodes=es-node1,es-node2,es-node3\n      - discovery.seed_hosts=es-node1,es-node2\n      - bootstrap.memory_lock=true\n      - xpack.security.enabled=true\n      - xpack.security.http.ssl.enabled=true\n      - xpack.security.http.ssl.key=certs/es-node3/es-node3.key\n      - xpack.security.http.ssl.certificate=certs/es-node3/es-node3.crt\n      - xpack.security.http.ssl.certificate_authorities=certs/ca/ca.crt\n      - xpack.security.transport.ssl.enabled=true\n      - xpack.security.transport.ssl.key=certs/es-node3/es-node3.key\n      - xpack.security.transport.ssl.certificate=certs/es-node3/es-node3.crt\n      - xpack.security.transport.ssl.certificate_authorities=certs/ca/ca.crt\n      - xpack.security.transport.ssl.verification_mode=certificate\n      - xpack.license.self_generated.type=${LICENSE}\n    mem_limit: ${MEM_LIMIT}\n    ulimits:\n      memlock:\n        soft: -1\n        hard: -1\n    healthcheck:\n      test:\n        [\n          \"CMD-\",\n          \"curl -s --cacert config/certs/ca/ca.crt https://localhost:9200 | grep -q 'missing authentication credentials'\",\n        ]\n      interval: 10s\n      timeout: 10s\n      retries: 120\n    extra_hosts:\n      - \"es-node1:172.20.100.11\"\n      - \"es-node2:172.20.100.12\"\n      - \"es-node3:172.20.100.13\"\n\n  kibana:\n    depends_on:\n      es-node1:\n        condition: service_healthy\n      es-node2:\n        condition: service_healthy\n      es-node3:\n        condition: service_healthy\n    image: docker.elastic.co/kibana/kibana:${STACK_VERSION}\n    container_name: kibana\n    restart: always\n    networks:\n      net:\n        ipv4_address: 172.20.100.14\n    volumes:\n      - /data/elk-certs:/usr/share/kibana/config/certs\n      - /data/kibana:/usr/share/kibana/data\n    ports:\n      - ${KIBANA_PORT}:5601\n    environment:\n      - SERVERNAME=kibana\n      - ELASTICSEARCH_HOSTS=https://es-node1:9200\n      - ELASTICSEARCH_USERNAME=kibana_system\n      - ELASTICSEARCH_PASSWORD=${KIBANA_PASSWORD}\n      - ELASTICSEARCH_SSL_CERTIFICATEAUTHORITIES=config/certs/ca/ca.crt\n    mem_limit: ${MEM_LIMIT}\n    healthcheck:\n      test:\n        [\n          \"CMD-\",\n          \"curl -s -I http://localhost:5601 | grep -q 'HTTP/1.1 302 Found'\",\n        ]\n      interval: 10s\n      timeout: 10s\n      retries: 120\n  logstash:\n    image: docker.elastic.co/logstash/logstash:${STACK_VERSION}\n    container_name: logstash\n    volumes:\n      - /data/elk-certs:/usr/share/logstash/config/certs\n      - /data/logstash/pipeline:/usr/share/logstash/pipeline\n      - /data/logstash/config/logstash.yml:/usr/share/logstash/config/logstash.yml\n    user: \"0\"\n    restart: always\n    ports:\n      - 5044:5044\n    networks:\n      net:\n        ipv4_address: 172.20.100.15\n    extra_hosts:\n      - \"es-node1:172.20.100.11\"\n      - \"es-node2:172.20.100.12\"\n      - \"es-node3:172.20.100.13\"\nnetworks:\n  net:\n    driver: bridge\n    ipam:\n      config:\n        - subnet: 172.20.100.0/24\n**************************elk.yml**************************\n```\n\næ‰§è¡Œå‘½ä»¤ï¼Œåˆ›å»ºå®¹å™¨\n\n```\ndocker compose -f /data/script/elk.yml up -d\n```\n\n> [+] Running 42/16\n> âœ” es-node3 Pulled 35.6s\n> âœ” es-setup Pulled 35.6s\n> âœ” logstash Pulled 96.0s\n> âœ” kibana Pulled 99.3s\n> âœ” es-node2 Pulled 35.6s\n> âœ” es-node1 Pulled 35.6s\n>\n> [+] Running 7/7\n> âœ” Network elk-docker-project_net Creaâ€¦ 0.6s\n> âœ” Container es-setup Healthy 21.6s\n> âœ” Container logstash Started 12.5s\n> âœ” Container es-node1 Healthy 72.5s\n> âœ” Container es-node2 Healthy 72.5s\n> âœ” Container es-node3 Healthy 73.0s\n> âœ” Container kibana Started 73.4s\n\nå®¹å™¨åˆ›å»ºå®Œæˆåï¼ŒæŸ¥çœ‹å„å®¹å™¨çŠ¶æ€æ˜¯å¦æ­£å¸¸\n\n```\ndocker ps\n```\n\n> CONTAINER ID IMAGE COMMAND CREATED STATUS PORTS NAMES\n> 5b591d4ade82 docker.elastic.co/kibana/kibana:8.13.3 â€œ/bin/tini â€” /usr/lâ€¦â€ 5 minutes ago Up 4 minutes (healthy) 0.0.0.0:5601->5601/tcp, :::5601->5601/tcp kibana\n> e2e75a54149e docker.elastic.co/elasticsearch/elasticsearch:8.13.3 â€œ/bin/tini â€” /usr/lâ€¦â€ 5 minutes ago Up 5 minutes (healthy) 9200/tcp, 9300/tcp es-node3\n> b8c8357f3634 docker.elastic.co/elasticsearch/elasticsearch:8.13.3 â€œ/bin/tini â€” /usr/lâ€¦â€ 5 minutes ago Up 5 minutes (healthy) 9200/tcp, 9300/tcp es-node2\n> c552940bd559 docker.elastic.co/elasticsearch/elasticsearch:8.13.3 â€œ/bin/tini â€” /usr/lâ€¦â€ 5 minutes ago Up 5 minutes (healthy) 0.0.0.0:9200->9200/tcp, :::9200->9200/tcp, 9300/tcp es-node1\n> 0366974065d8 docker.elastic.co/logstash/logstash:8.13.3 â€œ/usr/local/bin/dockâ€¦â€ 5 minutes ago Up 5 minutes 0.0.0.0:5044->5044/tcp, :::5044->5044/tcp, 9600/tcp logstash\n\n5ã€ä¿®æ”¹kibanaçš„é…ç½®æ–‡ä»¶ï¼Œå°†å…¶è¯­è¨€è½¬åŒ–ä¸ºä¸­æ–‡ã€‚\n\n```\ndocker cp kibana:/usr/share/kibana/config/kibana.yml .\nvi kibana.yml\n**************************kibana.yml**************************\n #\n# ** THIS IS AN AUTO-GENERATED FILE **\n#\n\n# Default Kibana configuration for docker target\nserver.host: \"0.0.0.0\"\nserver.shutdownTimeout: \"5s\"\nelasticsearch.hosts: [ \"http://elasticsearch:9200\" ]\nmonitoring.ui.container.elasticsearch.enabled: true\ni18n.locale: \"zh-CN\"\nserver.publicBaseUrl: \"http://localhost:5601/\"\n**************************kibana.yml**************************\ndocker cp kibana.yml  kibana:/usr/share/kibana/config/kibana.yml\ndocker restart kibana\n```\n\n6ã€åœ¨æµè§ˆå™¨ä¸­åˆ†åˆ«è®¿é—®`https://10.10.2.103:9200/`å’Œ`http://10.10.2.103:5601/`ï¼Œè¾“å…¥è´¦æˆ·å’Œå¯†ç ï¼Œè¿›è¡ŒæŸ¥çœ‹ï¼Œå¦‚ä¸‹å›¾æ‰€ç¤ºã€‚\n\n![img](ä½¿ç”¨ dockeréƒ¨ç½²ä¸‰èŠ‚ç‚¹ Elasticsearch é›†ç¾¤(ELK)/1.png)\n\n![img](ä½¿ç”¨ dockeréƒ¨ç½²ä¸‰èŠ‚ç‚¹ Elasticsearch é›†ç¾¤(ELK)/2.png)\n\n![img](ä½¿ç”¨ dockeréƒ¨ç½²ä¸‰èŠ‚ç‚¹ Elasticsearch é›†ç¾¤(ELK)/3.png)\n\n### æ¨é€Linuxæ—¥å¿—ï¼ŒéªŒè¯éƒ¨ç½²\n\n1ã€å®‰è£…Filebeatæ—¥å¿—é‡‡é›†å™¨\n\nï¼ˆ1ï¼‰é€šè¿‡rpmæ–¹å¼å®‰è£…Filebeatæ—¥å¿—é‡‡é›†å™¨ã€‚\n\n```\n#ä¸‹è½½rpmåŒ…\ncurl -L -O https://artifacts.elastic.co/downloads/beats/filebeat/filebeat-8.13.3-x86_64.rpm\n#æ‰§è¡Œå®‰è£…\nrpm -vi filebeat-8.13.3-x86_64.rpm\n```\n\nï¼ˆ2ï¼‰é…ç½®Filebeat\n\n```\n#å¯åŠ¨Filebeat\nsystemctl start filebeat\n#æŸ¥çœ‹Filebeatè¿è¡ŒçŠ¶æ€\nsystemctl status filebeat\n#è®¾ç½®Filebeatä¸ºå¼€æœºè‡ªå¯\nsystemctl enable filebeat\n```\n\n2ã€é…ç½®Filebeatæ”¶é›†Linuxæ—¥å¿—\n\nï¼ˆ1ï¼‰é…ç½®filebeatæ–‡ä»¶ï¼Œå°†æ—¥å¿—å‘é€åˆ° Logstash æœåŠ¡ã€‚\n\n```\n# ä¿®æ”¹filebeaté…ç½®æ–‡ä»¶\nmv /etc/filebeat/filebeat.yml /etc/filebeat/filebeat.yml.bak\n# æ–°å»ºfilebeaté…ç½®æ–‡ä»¶\nvi /etc/filebeat/filebeat.yml\n**************************filebeat-dns.yml**************************\n# é…ç½®æ–‡ä»¶è¾“å…¥ï¼Œç›‘è§†æ—¥å¿—æ–‡ä»¶\nfilebeat.inputs:\n- type: log\n  enabled: true\n  # æŒ‡å®š DNS æ—¥å¿—æ–‡ä»¶è·¯å¾„\n  paths:\n    - /var/log/messages* \n  # æ ‡è¯†æ—¥å¿—ç±»å‹ä¸ºelk-linux\n  fields:\n    type: elk-linux      \n  # å°†é¢å¤–çš„å­—æ®µæ·»åŠ åˆ°æ ¹çº§åˆ«    \n  fields_under_root: true        \n\n# é…ç½®è¾“å‡ºåˆ° Logstash\n# æŒ‡å®š Logstash æœåŠ¡çš„åœ°å€å’Œç«¯å£\noutput.logstash:\n  hosts: [\"10.10.2.103:5044\"]   \n**************************filebeat-dns.yml**************************\n```\n\nï¼ˆ2ï¼‰é‡å¯filebeatæœåŠ¡ï¼ŒéªŒè¯é…ç½®æ˜¯å¦ç”Ÿæ•ˆ\n\n```\n# é‡å¯filebeat\nsystemctl restart filebeat\n# åˆ é™¤é”æ–‡ä»¶åï¼Œé‡æ–°å¯åŠ¨ Filebeat æœåŠ¡\nrm -rf /var/lib/filebeat/filebeat.lock\n# è¿è¡Œå¹¶æŸ¥çœ‹ Filebeat çš„è¿è¡Œæ—¥å¿—\nfilebeat -e -c /etc/filebeat/filebeat.yml\n```\n\n3ã€åœ¨æµè§ˆå™¨ä¸­ç™»å½•Kibanaï¼Œç‚¹å‡»å·¦ä¾§èœå•ä¸­çš„ â€œStack Managementâ€ï¼Œç®¡ç†åˆ›å»ºæ•°æ®è§†å›¾ã€‚å¦‚ä¸‹å›¾æ‰€ç¤ºã€‚\n\n![img](ä½¿ç”¨ dockeréƒ¨ç½²ä¸‰èŠ‚ç‚¹ Elasticsearch é›†ç¾¤(ELK)/4.png)\n\n4ã€åœ¨â€œStack Managementâ€ç•Œé¢ä¸­ï¼Œç‚¹å‡»â€œæ•°æ®è§†å›¾â€ï¼Œé€‰æ‹©ç´¢å¼•æ¨¡å¼ï¼Œåˆ›å»ºâ€œelk-linuxâ€è§†å›¾ã€‚å¦‚ä¸‹å›¾æ‰€ç¤ºã€‚\n\n![img](ä½¿ç”¨ dockeréƒ¨ç½²ä¸‰èŠ‚ç‚¹ Elasticsearch é›†ç¾¤(ELK)/5.png)\n\n![img](ä½¿ç”¨ dockeréƒ¨ç½²ä¸‰èŠ‚ç‚¹ Elasticsearch é›†ç¾¤(ELK)/6.png)\n\n5ã€æ•°æ®è§†å›¾åˆ›å»ºå®Œæˆåï¼Œé€‰æ‹©å·¦ä¾§èœå•ä¸­çš„â€œDiscoverâ€ï¼ŒæŸ¥çœ‹Linuxæ—¥å¿—è¯¦ç»†å†…å®¹ã€‚å¦‚ä¸‹å›¾æ‰€ç¤ºã€‚ç”±æ­¤ï¼Œelké›†ç¾¤æ­å»ºå®Œæˆã€‚\n\n![img](ä½¿ç”¨ dockeréƒ¨ç½²ä¸‰èŠ‚ç‚¹ Elasticsearch é›†ç¾¤(ELK)/7.png)\n\n![img](ä½¿ç”¨ dockeréƒ¨ç½²ä¸‰èŠ‚ç‚¹ Elasticsearch é›†ç¾¤(ELK)/8.png)","tags":["ELK","æ—¥å¿—åˆ†æ","Kibana","docker","Logstash","Elasticsearch"],"categories":["æ—¥å¿—åˆ†æ","ELK"]},{"title":"Hexo-Butterflyç¾åŒ–æ•™ç¨‹-[1]åŸºç¡€ç¯å¢ƒ","url":"/yyg/e102aa73/","content":"\n## åŸºç¡€ç¯å¢ƒï¼š\n\n1. æ“ä½œç³»ç»Ÿï¼šWindows10/11\n2. è¿è¡Œç¯å¢ƒï¼šnode.js\n\n## å®ç°è¿‡ç¨‹ï¼š\n\n### å®‰è£…node.js\n\nåœ¨node.jsä¸­æ–‡å®˜ç½‘`https://www.nodejs.com.cn/download_current.html`ï¼Œä¸‹è½½é€‚ç”¨äºWindowsçš„64ä½å®‰è£…åŒ…ï¼Œå®‰è£…JavaScriptè¿è¡Œç¯å¢ƒã€‚ä¸‹è½½å®Œæˆåï¼ŒåŒå‡»å®‰è£…ç¨‹åºï¼ŒæŒ‰å¼•å¯¼è¿›è¡Œå®‰è£…ï¼Œåœ¨å®‰è£…è¿‡ç¨‹ä¸­éœ€å‹¾é€‰â€Automatically install the necessary tools. â€¦â€¦â€œï¼Œå¦‚å›¾æ‰€ç¤ºã€‚å®‰è£…è¿‡ç¨‹ä¸­ï¼Œå¼¹å‡ºå‘½ä»¤æŒ‡ç¤ºç¬¦ï¼Œå›è½¦ä¸‹è½½ä¾èµ–å·¥å…·ã€‚\n\n![img](Hexo-Butterflyç¾åŒ–æ•™ç¨‹[1]-åŸºç¡€ç¯å¢ƒ/1.png)\n\nå®‰è£…å®Œæˆåï¼Œä½¿ç”¨å¿«æ·é”®`win+r`,è°ƒç”¨è¿è¡Œçª—å£ï¼Œè¾“å…¥`cmd`ï¼Œåœ¨å‘½ä»¤æŒ‡ç¤ºç¬¦ä¸­è¾“å…¥å‘½ä»¤ï¼ŒéªŒè¯nodeå’Œnpmç‰ˆæœ¬å·ã€‚\n\n```\nnode -v\nnpm -v\n```\n\n![img](Hexo-Butterflyç¾åŒ–æ•™ç¨‹[1]-åŸºç¡€ç¯å¢ƒ/2.png)\n\n### å®‰è£…git\n\nä»å®˜ç½‘`https://git-scm.com/download/win`ä¸‹è½½å®‰è£…ç¨‹åºï¼ŒæŒ‰å®‰è£…å¼•å¯¼ä¸€ç›´ç‚¹å‡»ä¸‹ä¸€æ­¥å³å¯ã€‚\n\n### å®‰è£…hexo\n\nåœ¨å‘½ä»¤æŒ‡ç¤ºç¬¦ä¸­è¾“å…¥å‘½ä»¤å®‰è£…hexoã€‚\n\n```\nnpm install hexo-cli -g \n```\n\nåˆ›å»ºåšå®¢å­˜æ”¾ç›®å½•\n\nè¿›å…¥è¦å­˜æ”¾åšå®¢ç›®å½•çš„ç£ç›˜ï¼Œä»¥â€œFâ€ç›˜ä¸ºä¾‹ï¼Œåœ¨å¦‚ä¸‹å›¾æ‰€ç¤ºçš„ç£ç›˜è·¯å¾„æ¡†ä¸­è¾“å…¥â€œcmdâ€ï¼Œç‚¹å‡»å›è½¦ï¼Œæ‰“å¼€å‘½åæŒ‡ç¤ºç¬¦ã€‚\n\n![img](Hexo-Butterflyç¾åŒ–æ•™ç¨‹[1]-åŸºç¡€ç¯å¢ƒ/3.png)\n\nåœ¨å…¶ä¸­è¾“å…¥å¦‚ä¸‹å‘½ä»¤åˆ›å»ºåšå®¢ç›®å½•ï¼Œæ­¤å¤„çš„â€œblogâ€ä¸ºè‡ªå®šä¹‰åç§°ã€‚ç­‰å¾…åšå®¢ç›®å½•åˆå§‹åŒ–å®Œæˆã€‚\n\n```\nhexo init blog\n```\n\nåˆå§‹åŒ–å®Œæˆåï¼Œè¿›å…¥blogç›®å½•ï¼Œåœ¨ç£ç›˜è·¯å¾„æ¡†ä¸­è¾“å…¥â€œcmdâ€ï¼Œç‚¹å‡»å›è½¦ï¼Œè¾“å…¥ä»¥ä¸‹å‘½ä»¤ä¸‹è½½ä¾èµ–å’Œæµ‹è¯•åšå®¢æ˜¯å¦éƒ¨ç½²æˆåŠŸã€‚\n\n```\n#ä¸‹è½½ä¾èµ–\nnpm install\n\n#æœ¬åœ°æµ‹è¯•\nhexo clean && hexo g && hexo s\n```\n\næˆåŠŸæ˜¾ç¤ºçš„å‘½ä»¤ç»†èŠ‚å¦‚ä¸‹ï¼š\n\n> F:\\blog>hexo clean && hexo g && hexo s\n> INFO Validating config\n> INFO Deleted database.\n> INFO Validating config\n> INFO Start processing\n> INFO Files loaded in 463 ms\n> INFO Generated: archives/index.html\n> INFO Generated: archives/2024/index.html\n> INFO Generated: archives/2024/04/index.html\n> INFO Generated: index.html\n> INFO Generated: css/style.css\n> INFO Generated: fancybox/jquery.fancybox.min.css\n> INFO Generated: fancybox/jquery.fancybox.min.js\n> INFO Generated: js/jquery-3.6.4.min.js\n> INFO Generated: js/script.js\n> INFO Generated: css/images/banner.jpg\n> INFO Generated: 2024/04/18/hello-world/index.html\n> INFO 11 files generated in 660 ms\n> INFO Validating config\n> INFO Start processing\n> INFO Hexo is running at http://localhost:4000/ . Press Ctrl+C to stop.\n\nåœ¨æµè§ˆå™¨ä¸­è®¿é—® `http://localhost:4000/` ï¼ŒæŸ¥çœ‹é»˜è®¤åšå®¢ç•Œé¢ã€‚\n\n{% folding green open,åšå®¢æ­å»ºç³»åˆ—æ–‡ç«  %}\n\n{% series åšå®¢æ­å»ºæ•™ç¨‹ %}\n\n{% endfolding %}\n\n","tags":["Hexo","åšå®¢æ•™ç¨‹","Butterfly"],"categories":["åšå®¢æ•™ç¨‹","åšå®¢æ­å»º"]},{"title":"LAMPéƒ¨ç½²","url":"/yyg/a8d3d305/","content":"\n## åŸºç¡€ç¯å¢ƒ\n\nç³»ç»Ÿç¯å¢ƒï¼š\nCentOS Stream 9\n\nè½¯ä»¶ç¯å¢ƒï¼š\nApache-2.4.57\nMysql-8.0.36ï¼ˆmariaDBï¼‰\nPHP-8.0.30\n\n## éƒ¨ç½²è¿‡ç¨‹\n\n### é…ç½®å®‰å…¨ç­–ç•¥\n\n```\nfirewall-cmd --add-port=80/tcp --permanent\nfirewall-cmd --reload\nfirewall-cmd --list-all\n```\n\n### å®‰è£…Apache\n\n```\nyum -y install httpd\nsystemctl start httpd\nsystemctl enable httpd\n# æŸ¥çœ‹ç‰ˆæœ¬\nhttpd -v\n```\n\n### å®‰è£…PHP\n\n```\n# å®‰è£…phpç›¸åº”æ¨¡å—\nyum -y install php php-curl php-dom php-exif php-fileinfo php-fpm php-gd php-hash php-mbstring php-mysqli php-openssl php-pcre php-xml\n# æŸ¥çœ‹ç‰ˆæœ¬\nphp -v\n# æµ‹è¯•php\necho \"<?php phpinfo(); ?>\" > /var/www/html/test.php\n#åœ¨æµè§ˆå™¨ä¸­è®¿é—®http://æœ¬æœºip/test.php\n# åˆ é™¤æµ‹è¯•ç”¨ä¾‹\nrm -f /var/www/html/test.php\n```\n\n### å®‰è£…Mysql\n\n```\nyum -y install mysql-server\n# æŸ¥çœ‹ç‰ˆæœ¬\nmysql -V\nsystemctl start mysqld\nsystemctl enable mysqld\n# æŸ¥çœ‹MySQLçš„åˆå§‹å¯†ç \ngrep \"password\" /var/log/mysql/mysqld.log\n# MySQLçš„å®‰å…¨æ€§é…ç½®\nmysql_secure_installation\n```\n\n> Securing the MySQL server deployment.\n> \n> Connecting to MySQL using a blank password.\n> \n> VALIDATE PASSWORD COMPONENT can be used to test passwords\n> and improve security. It checks the strength of password\n> and allows the users to set only those passwords which are\n> secure enough. Would you like to setup VALIDATE PASSWORD component?\n> \n> Press y|Y for Yes, any other key for No: y\n> \n> There are three levels of password validation policy:\n> \n> LOW Length >= 8\n> MEDIUM Length >= 8, numeric, mixed case, and special characters\n> STRONG Length >= 8, numeric, mixed case, special characters and dictionary file\n> \n> Please enter 0 = LOW, 1 = MEDIUM and 2 = STRONG: 0\n> Please set the password for root here.\n> \n> New password:\n> \n> Re-enter new password:\n> \n> Estimated strength of the password: 50\n> Do you wish to continue with the password provided?(Press y|Y for Yes, any other key for No) : y\n> By default, a MySQL installation has an anonymous user,\n> allowing anyone to log into MySQL without having to have\n> a user account created for them. This is intended only for\n> testing, and to make the installation go a bit smoother.\n> You should remove them before moving into a production\n> environment.\n> \n> Remove anonymous users? (Press y|Y for Yes, any other key for No) : y\n> Success.\n> \n> Normally, root should only be allowed to connect from\n> â€˜localhostâ€™. This ensures that someone cannot guess at\n> the root password from the network.\n> \n> Disallow root login remotely? (Press y|Y for Yes, any other key for No) : y\n> Success.\n> \n> By default, MySQL comes with a database named â€˜testâ€™ that\n> anyone can access. This is also intended only for testing,\n> and should be removed before moving into a production\n> environment.\n> \n> Remove test database and access to it? (Press y|Y for Yes, any other key for No) : y\n> \n> - Dropping test databaseâ€¦\n>   Success.\n> - Removing privileges on test databaseâ€¦\n>   Success.\n> \n> Reloading the privilege tables will ensure that all changes\n> made so far will take effect immediately.\n> \n> Reload privilege tables now? (Press y|Y for Yes, any other key for No) : y\n> Success.\n> \n> All done!\n\n### éªŒè¯æµ‹è¯•\n\nå®‰è£…WordPressè¿›è¡ŒéªŒè¯LAMPçš„éªŒè¯æµ‹è¯•\n\nï¼ˆ1ï¼‰ä¸‹è½½å¹¶é…ç½®WordPress\n\n```\ncd /var/www/html/\n# å®‰è£…ä¸‹è½½è§£å‹å·¥å…·\nyum -y install wget tar\n# ä¸‹è½½å¹¶è§£å‹WordPressç¨‹åº\nwget https://cn.wordpress.org/latest-zh_CN.tar.gz\ntar zxvf latest-zh_CN.tar.gz\n```\n\nï¼ˆ2ï¼‰åˆ›å»ºæ•°æ®åº“\n\n```\ncreate user 'wordpress'@'localhost' identified by 'wordpress@123';\ngrant all privileges on wordpress.* to 'wordpress'@'localhost';\nflush privileges;\nexit;\n```\n\nï¼ˆ3ï¼‰é‡å¯æœåŠ¡\n\n```\nsystemctl restart httpd\n```\n\nï¼ˆ4ï¼‰WordPressåˆå§‹åŒ–é…ç½®\n\nåœ¨`/var/www/html/wordpress`ä¸­åˆ›å»ºwp-config.phpæ–‡ä»¶ã€‚\n\n```\nvi /var/www/html/wordpress/wp-config.php\n**************************wp-config.php**************************\n<?php\n/**\n * WordPress åŸºç¡€é…ç½®æ–‡ä»¶\n *\n * è¿™ä¸ªæ–‡ä»¶è¢«å®‰è£…ç¨‹åºç”¨äºè‡ªåŠ¨ç”Ÿæˆ wp-config.php é…ç½®æ–‡ä»¶\n * æ‚¨ä¸å¿…ä½¿ç”¨ç½‘ç«™ï¼Œå¯ä»¥å°†è¿™ä¸ªæ–‡ä»¶å¤åˆ¶åˆ°ã€Œwp-config.phpã€å¹¶å¡«å†™è¿™äº›å€¼ã€‚\n *\n * æœ¬æ–‡ä»¶åŒ…å«ä»¥ä¸‹é…ç½®é€‰é¡¹ï¼š\n *\n * * æ•°æ®åº“è®¾ç½®\n * * å¯†é’¥\n * * æ•°æ®åº“è¡¨åå‰ç¼€\n * * ABSPATH\n *\n * @link https://wordpress.org/documentation/article/editing-wp-config-php/\n *\n * @package WordPress\n */\n\n// ** æ•°æ®åº“è®¾ç½® - æ‚¨å¯ä»¥ä»æ‚¨çš„ä¸»æœºè·å–è¿™äº›ä¿¡æ¯ ** //\n/** WordPress æ•°æ®åº“åç§° */\ndefine( 'DB_NAME', 'wordpress' );\n\n/** æ•°æ®åº“ç”¨æˆ·å */\ndefine( 'DB_USER', 'wordpress' );\n\n/** æ•°æ®åº“å¯†ç  */\ndefine( 'DB_PASSWORD', 'wordpress@123' );\n\n/** æ•°æ®åº“ä¸»æœº */\ndefine( 'DB_HOST', 'localhost' );\n\n/** åˆ›å»ºè¡¨æ—¶ä½¿ç”¨çš„æ•°æ®åº“å­—ç¬¦é›†ã€‚ */\ndefine( 'DB_CHARSET', 'utf8mb4' );\n\n/** æ•°æ®åº“æ’åºè§„åˆ™ç±»å‹ã€‚å¦‚ä¸ç¡®å®šï¼Œè¯·å‹¿æ›´æ”¹ã€‚ */\ndefine( 'DB_COLLATE', '' );\n\n/**#@+\n * èº«ä»½éªŒè¯å”¯ä¸€å¯†é’¥ä¸ç›ã€‚\n *\n * å°†è¿™äº›æ›´æ”¹ä¸ºä»»æ„ç‹¬ä¸€æ— äºŒçš„å­—ç¬¦ä¸²ï¼æ‚¨å¯ä»¥ä½¿ç”¨\n * {@link https://api.wordpress.org/secret-key/1.1/salt/ WordPress.org å¯†é’¥æœåŠ¡}\n * ç”Ÿæˆè¿™äº›ã€‚\n *\n * æ‚¨å¯ä»¥éšæ—¶æ›´æ”¹è¿™äº›å†…å®¹ä»¥ä½¿æ‰€æœ‰ç°æœ‰ cookies å¤±æ•ˆã€‚\n * è¿™å°†å¼ºåˆ¶æ‰€æœ‰ç”¨æˆ·å¿…é¡»é‡æ–°ç™»å½•ã€‚\n *\n * @since 2.6.0\n */\ndefine( 'AUTH_KEY',         'T]opAWiO&i]=T0%gG|Cr8ZiHC4(AjG3#,Oa%Z,Xus}tB:CMH*m?TAJ!g8rCgn9G{' );\ndefine( 'SECURE_AUTH_KEY',  'u]bD9(4N<|LD=!XlaLf8mI5vQM!!Wy,`=9[2g1g86Cp~EZnUe$q{P3W.[aH$n,bV' );\ndefine( 'LOGGED_IN_KEY',    '-}sR0i@QOgDAbYWs:blZjDaJF-NdN|l5Vtiw2kVy(TUd0]:7~_)Lsg(t5kP>FVs~' );\ndefine( 'NONCE_KEY',        ':*qn^%vaF;vWh$f/rR*SI8]Er=jpW{bKRWt4/F25b:ULoJGi&:*B{SP9D$Dx]t1=' );\ndefine( 'AUTH_SALT',        ':1NyIcq-rH.2Qe@cH{xbKICQ`>!bmz_cKl@SQcLYM]||y9}dII:4j<d~sG~[mGR/' );\ndefine( 'SECURE_AUTH_SALT', 'IRC$m2W;1CZ`PaR315_evXujKAgHr?x1.fLws,8tJ_$g+0EJkY?Y$LF*QXi*7h=l' );\ndefine( 'LOGGED_IN_SALT',   'Zcg^hRDB5DXV<v?NxVNBMoT=s#mFvCw$A%!8{uBdl6EeZ`IhB.~8FNPprKgB>sKZ' );\ndefine( 'NONCE_SALT',       'T#D,{:EEHw`~F~B2%R/TP*Kt-,/-| /](V-MJz7Nr?)XBr~rnEY*Hfs1rwUUMYi-' );\n\n/**#@-*/\n\n/**\n * WordPress æ•°æ®è¡¨å‰ç¼€ã€‚\n *\n * å¦‚æœæ‚¨ä¸ºæ¯ä¸ªå®‰è£…åˆ†é…ä¸€ä¸ªå”¯ä¸€å‰ç¼€ï¼Œæ‚¨å¯ä»¥åœ¨ä¸€ä¸ªæ•°æ®åº“ä¸­æ‹¥æœ‰å¤šä¸ªå®‰è£…ã€‚\n * è¯·åªä½¿ç”¨æ•°å­—ã€å­—æ¯å’Œä¸‹åˆ’çº¿ï¼\n */\n$table_prefix = 'wp_';\n\n/**\n * å¼€å‘è€…ä¸“ç”¨ï¼šWordPress è°ƒè¯•æ¨¡å¼ã€‚\n *\n * å°†æ­¤å€¼æ›´æ”¹ä¸º true ä»¥å¯ç”¨å¼€å‘è¿‡ç¨‹ä¸­çš„é€šçŸ¥æ˜¾ç¤ºã€‚\n * å¼ºçƒˆå»ºè®®æ’ä»¶å’Œä¸»é¢˜å¼€å‘äººå‘˜åœ¨å…¶å¼€å‘ç¯å¢ƒä¸­ä½¿ç”¨ WP_DEBUGã€‚\n *\n * æœ‰å…³å¯ç”¨äºè°ƒè¯•çš„å…¶ä»–å¸¸é‡çš„ä¿¡æ¯ï¼Œè¯·è®¿é—®æ–‡æ¡£ã€‚\n *\n * @link https://wordpress.org/documentation/article/debugging-in-wordpress/\n */\ndefine( 'WP_DEBUG', false );\n\n/**\n * ç®€ä½“ä¸­æ–‡ä¸“å±ï¼šICP å¤‡æ¡ˆå·æ˜¾ç¤º\n *\n * åœ¨è®¾ç½® â†’ å¸¸è§„ä¸­è®¾ç½®ä½ çš„ ICP å¤‡æ¡ˆå·ã€‚\n * å¯è°ƒç”¨ç®€ç  [cn_icp] æˆ–å‡½æ•° cn_icp() æ˜¾ç¤ºã€‚\n *\n * @since 6.5.0\n * @link https://cn.wordpress.org/support/i10n-features/\n */\ndefine( 'CN_ICP', true );\n\n/**\n * ç®€ä½“ä¸­æ–‡ä¸“å±ï¼šå…¬å®‰å¤‡æ¡ˆå·æ˜¾ç¤º\n *\n * åœ¨è®¾ç½® â†’ å¸¸è§„ä¸­è®¾ç½®ä½ çš„å…¬å®‰å¤‡æ¡ˆå·ã€‚\n * å¯è°ƒç”¨ç®€ç  [cn_ga] æˆ–å‡½æ•° cn_ga() æ˜¾ç¤ºã€‚\n *\n * @since 6.5.0\n * @link https://cn.wordpress.org/support/i10n-features/\n */\ndefine( 'CN_GA', true );\n\n/* åœ¨è¿™è¡Œå’Œã€Œåœæ­¢ç¼–è¾‘ã€è¡Œä¹‹é—´æ·»åŠ ä»»ä½•è‡ªå®šä¹‰å€¼ã€‚ */\n\n\n\n/* å°±è¿™æ ·ï¼Œåœæ­¢ç¼–è¾‘ï¼ç¥æ‚¨ä½¿ç”¨æ„‰å¿«ã€‚ */\n\n/** WordPress ç›®å½•çš„ç»å¯¹è·¯å¾„ã€‚ */\nif ( ! defined( 'ABSPATH' ) ) {\n    define( 'ABSPATH', __DIR__ . '/' );\n}\n\n/** è®¾ç½® WordPress å˜é‡å’ŒåŒ…å«çš„æ–‡ä»¶ã€‚ */\nrequire_once ABSPATH . 'wp-settings.php';\n**************************wp-config.php**************************\n```\n\nåœ¨æµè§ˆå™¨ä¸­è¾“å…¥`http://æœ¬åœ°ip/wordpress`ï¼Œè¿›è¡Œåˆå§‹åŒ–é…ç½®ã€‚é…ç½®å®Œæˆå¹¶ç™»å½•WordPressä¹‹åï¼ŒLAMPéªŒè¯æµ‹è¯•æˆåŠŸã€‚","tags":["PHP","Linux","Mysql","Apache"],"categories":["Linuxè¿ç»´","WebæœåŠ¡æ¶æ„éƒ¨ç½²"]},{"title":"LNMPéƒ¨ç½²","url":"/yyg/776a1cd4/","content":"## åŸºç¡€ç¯å¢ƒ\n\nç³»ç»Ÿç¯å¢ƒï¼šCentOS Stream 9\n\nè½¯ä»¶ç¯å¢ƒï¼šnginx-1.20.1ã€mysql-8.0.36ï¼ˆmariaDBï¼‰ã€php-8.0.30\n\n## éƒ¨ç½²è¿‡ç¨‹\n\n### æ–¹æ¡ˆä¸€ï¼šyumå®‰è£…\n\n#### æ­¥éª¤ä¸€ï¼šé…ç½®å®‰å…¨ç­–ç•¥\n\n```\n# å¼€æ”¾80ç«¯å£\nfirewall-cmd --add-port=80/tcp --permanent\nsudo firewall-cmd --reload && sudo firewall-cmd --list-all\n# å…³é—­SELinux\nsetenforce 0\nsed -i \"s/SELINUX=enforcing/SELINUX=disabled/g\" /etc/selinux/config\n```\n\n#### æ­¥éª¤äºŒï¼šå®‰è£…nginx\n\n```\nyum -y install nginx\n# æŸ¥çœ‹nginxç‰ˆæœ¬\nnginx -v\n```\n\n#### æ­¥éª¤ä¸‰ï¼šå®‰è£…å¹¶é…ç½®mysql\n\nå®‰è£…mysql\n\n```\nyum -y install mysql-server\n#æŸ¥çœ‹mysqlç‰ˆæœ¬\nmysql -V\n# å¯åŠ¨å¹¶è®¾ç½®å¼€æœºè‡ªå¯\nsystemctl start mysqld\nsystemctl enable mysqld\n```\n\né…ç½®mysql\n\nï¼ˆ1ï¼‰æŸ¥çœ‹rootç”¨æˆ·çš„åˆå§‹å¯†ç \n\n```\ngrep 'password' /var/log/mysql/mysqld.log\n```\n\n> 2024-05-08T09:37:31.765242Z 6 [Warning] [MY-010453] [Server] root@localhost is created with an empty password ! Please consider switching off the â€”initialize-insecure option.\n\nï¼ˆ2ï¼‰é…ç½®MySQLçš„å®‰å…¨æ€§\n\n```\nmysql_secure_installation\n```\n\n> Securing the MySQL server deployment.\n>\n> Connecting to MySQL using a blank password.\n>\n> VALIDATE PASSWORD COMPONENT can be used to test passwords\n> and improve security. It checks the strength of password\n> and allows the users to set only those passwords which are\n> secure enough. Would you like to setup VALIDATE PASSWORD component?\n>\n> **è®¾ç½®MySQLçš„æ–°å¯†ç **\n>\n> Press y|Y for Yes, any other key for No: y\n>\n> There are three levels of password validation policy:\n>\n> LOW Length >= 8\n> MEDIUM Length >= 8, numeric, mixed case, and special characters\n> STRONG Length >= 8, numeric, mixed case, special characters and dictionary file\n>\n> **è®¾ç½®çš„å¯†ç å¼ºåº¦**\n>\n> Please enter 0 = LOW, 1 = MEDIUM and 2 = STRONG: 0\n> Please set the password for root here.\n>\n> New password:\n>\n> Re-enter new password:\n>\n> Estimated strength of the password: 50\n> Do you wish to continue with the password provided?(Press y|Y for Yes, any other key for No) : y\n> By default, a MySQL installation has an anonymous user,\n> allowing anyone to log into MySQL without having to have\n> a user account created for them. This is intended only for\n> testing, and to make the installation go a bit smoother.\n> You should remove them before moving into a production\n> environment.\n>\n> **åˆ é™¤åŒ¿åç”¨æˆ·**\n>\n> Remove anonymous users? (Press y|Y for Yes, any other key for No) : y\n> Success.\n>\n> Normally, root should only be allowed to connect from\n> â€˜localhostâ€™. This ensures that someone cannot guess at\n> the root password from the network.\n>\n> **ç¦æ­¢ä½¿ç”¨rootç”¨æˆ·è¿œç¨‹ç™»å½•MySQL**\n>\n> Disallow root login remotely? (Press y|Y for Yes, any other key for No) : y\n> Success.\n>\n> By default, MySQL comes with a database named â€˜testâ€™ that\n> anyone can access. This is also intended only for testing,\n> and should be removed before moving into a production\n> environment.\n>\n> **åˆ é™¤teståº“ä»¥åŠç”¨æˆ·å¯¹teståº“çš„è®¿é—®æƒé™**\n>\n> Remove test database and access to it? (Press y|Y for Yes, any other key for No) : y\n>\n> - Dropping test databaseâ€¦\n>   Success.\n> - Removing privileges on test databaseâ€¦\n>   Success.\n>\n> Reloading the privilege tables will ensure that all changes\n> made so far will take effect immediately.\n>\n> **é‡æ–°åŠ è½½æˆæƒè¡¨**\n>\n> Reload privilege tables now? (Press y|Y for Yes, any other key for No) : y\n> Success.\n>\n> All done!\n\n#### æ­¥éª¤å››ï¼šå®‰è£…php\n\n```\n# ä¸‹è½½phpç»„ä»¶\n yum install -y php php-cli php-fpm php-common php-mysqlnd php-gd php-mbstring\n# æŸ¥çœ‹phpç‰ˆæœ¬\n php -v\n```\n\nä¿®æ”¹nginxé…ç½®æ–‡ä»¶ä»¥å¯ç”¨php\n\n```\n# å¤‡ä»½Nginxé…ç½®æ–‡ä»¶\ncp /etc/nginx/nginx.conf /etc/nginx/nginx.conf.bak\n# åœ¨Nginxé…ç½®æ–‡ä»¶ä¸­ä¿®æ”¹å†…å®¹ï¼Œåœ¨serveréƒ¨åˆ†æ·»åŠ å†…å®¹\nvi /etc/nginx/nginx.conf\n**************************nginx.conf**************************\n    server {\n        listen       80;\n        listen       [::]:80;\n        server_name  _;\n        root         /data; #ç½‘ç«™æ ¹ç›®å½•\n\n        # Load configuration files for the default server block.\n        include /etc/nginx/default.d/*.conf;\n        location / { #æ·»åŠ \n            index index.php index.html index.htm;\n        }\n        location ~ .php$ {\n            root /data; #ç½‘ç«™æ ¹ç›®å½•\n            fastcgi_pass 127.0.0.1:9000; #Nginxé€šè¿‡æœ¬æœºçš„9000ç«¯å£å°†PHPè¯·æ±‚è½¬å‘ç»™PHP-FPMè¿›è¡Œå¤„ç†\n            fastcgi_index index.php;\n            fastcgi_param  SCRIPT_FILENAME  $document_root$fastcgi_script_name;\n            include fastcgi_params; #Nginxè°ƒç”¨fastcgiæ¥å£å¤„ç†PHPè¯·æ±‚\n        }\n        error_page 404 /404.html;\n        location = /404.html {\n        }\n\n        error_page 500 502 503 504 /50x.html;\n        location = /50x.html {\n        }\n    }\n\n**************************nginx.conf**************************\n\n# å¯åŠ¨nginxï¼Œå¹¶è®¾ç½®å¼€æœºè‡ªå¯\nsystemctl start nginx\nsystemctl enable nginx\n```\n\né…ç½®å¹¶éªŒè¯php\n\n```\n# ä¿è¯ nginx è¿›ç¨‹çš„ç®¡ç†ç”¨æˆ·å’Œ PHP æœåŠ¡è¿›ç¨‹çš„ç®¡ç†ç”¨æˆ·ä¿æŒä¸€è‡´\nvi /etc/php-fpm.d/www.conf\nuser = nginx\ngroup = nginx\n# é‡å¯nginx\nsystemctl restart nginx\n\n# åˆ›å»ºç½‘ç«™æ ¹ç›®å½•\nmkdir /data\n# ç¼–å†™æµ‹è¯•phpç•Œé¢\necho \"<?php echo phpinfo(); ?>\" >/data/index.php\n# å¯åŠ¨php-fpmï¼Œå¹¶è®¾ç½®å¼€æœºè‡ªå¯\nsystemctl start php-fpm\nsystemctl enable php-fpm\n```\n\n#### æ­¥éª¤äº”ï¼šè®¿é—®æµ‹è¯•\n\nåœ¨æµè§ˆå™¨ä¸­è¾“å…¥`http://æœ¬æœºip/index.php`è¿›è¡Œè®¿é—®ï¼Œå¦‚ä¸‹å›¾æ‰€ç¤ºï¼Œè¡¨ç¤ºLNMPç¯å¢ƒéƒ¨ç½²æˆåŠŸã€‚\n\n![img](LNMPéƒ¨ç½²/1.png)\n\n### æ–¹æ¡ˆäºŒï¼šè„šæœ¬ä¸€é”®å®‰è£…\n\n```\nyum install -y wget\n# ä¸‹è½½lnmpå®‰è£…è„šæœ¬\nwget https://soft.lnmp.com/lnmp/lnmp2.1beta.tar.gz\n# è§£å‹\ntar -vzxf lnmp2.1beta.tar.gz\ncd lnmp2.1\n# æ‰§è¡Œè„šæœ¬\n./install.sh\n# æŒ‰å¼•å¯¼è¿›è¡Œå®‰è£…å³å¯\n```\n\nåœ¨æµè§ˆå™¨`http://æœ¬æœºip/`è®¿é—®ï¼Œå‡ºç°ä»¥ä¸‹ç•Œé¢ï¼Œå³ä¸ºéƒ¨ç½²æˆåŠŸã€‚\n\n![img](LNMPéƒ¨ç½²/2.png)\n\næ‰“å¼€lnmp2.1/conf/nginx.confæ–‡ä»¶ï¼ŒæŸ¥çœ‹å…¶ç½‘ç«™æ ¹ç›®å½•ä¸º/home/wwwroot/defaultï¼Œ\n\nåœ¨å…¶ç½‘ç«™æ ¹ç›®å½•/home/wwwroot/defaultä¸­# ç¼–å†™æµ‹è¯•phpç•Œé¢ï¼Œåœ¨æµè§ˆå™¨ä¸­è¾“å…¥`http://æœ¬æœºip/index.php`è¿›è¡Œè®¿é—®ï¼Œç»“æœå¦‚æ–¹æ¡ˆä¸€ä¸­çš„ã€Šæ­¥éª¤äº”ã€‹ä¸­çš„å›¾æ‰€ç¤ºï¼Œå³ä¸ºæˆåŠŸã€‚\n\n```\necho \"<?php echo phpinfo(); ?>\" >/data/index.php\n```","tags":["PHP","Linux","Mysql","Nginx"],"categories":["Linuxè¿ç»´","WebæœåŠ¡æ¶æ„éƒ¨ç½²"]},{"title":"Dockeréƒ¨ç½²Matomo","url":"/yyg/a52e3ab6/","content":"## åŸºç¡€ç¯å¢ƒ\n\nç³»ç»Ÿç¯å¢ƒï¼š\n\næ“ä½œç³»ç»Ÿï¼šCentOS Stream 9\n\nè½¯ä»¶ç¯å¢ƒï¼š\n\nDockerã€Docker Compose\n\n## å®‰è£…Docker\n\nï¼ˆ1ï¼‰å®‰è£… yum-utils è½¯ä»¶åŒ…ï¼ˆæä¾› yum-config-manager å®ç”¨ç¨‹åºï¼‰å¹¶è®¾ç½®å­˜å‚¨åº“ã€‚\n\n```\n# å®‰è£… yum-utils è½¯ä»¶åŒ…\nyum install -y yum-utils\n# è®¾ç½®docker-ceå­˜å‚¨åº“\nyum-config-manager --add-repo https://download.docker.com/linux/centos/docker-ce.repo\n```\n\nï¼ˆ2ï¼‰å®‰è£…æœ€æ–°ç‰ˆdockerå’Œdocker composeã€‚\n\n```\n\nyum install -y docker-ce docker-ce-cli containerd.io docker-buildx-plugin docker-compose-plugin\n```\n\nï¼ˆ3ï¼‰ä¿®æ”¹Dockerçš„æ•°æ®ç›®å½•ä¸ºâ€œ/data/dockerDataâ€ï¼Œå¹¶é‡å¯dockeræœåŠ¡ä½¿é…ç½®ç”Ÿæ•ˆã€‚\n\n```\n# åˆ›å»ºDockerå®ˆæŠ¤è¿›ç¨‹é…ç½®æ–‡ä»¶\n# ç¼–è¾‘é…ç½®æ–‡ä»¶/etc/docker/daemon.jsonï¼Œé…ç½®dockeræ•°æ®ç›®å½•\nvi /etc/docker/daemon.json\n**************************daemon.json**************************\n{\n  \"data-root\": \"/data/dockerData\"\n}\n**************************daemon.json**************************\n\n# é‡å¯dockeræœåŠ¡ï¼Œä½¿é…ç½®ç”Ÿæ•ˆ\n[root@Book-ELK-VM-113 data]# systemctl restart docker\n```\n\nï¼ˆ4ï¼‰å¯åŠ¨DockeræœåŠ¡ï¼Œå¹¶è®¾ç½®ä¸ºå¼€æœºè‡ªå¯åŠ¨ã€‚\n\n```\n# å¯åŠ¨DockeræœåŠ¡\nsystemctl start docker\n# è®¾ç½®Dockerä¸ºå¼€æœºè‡ªå¯åŠ¨\nsystemctl enable docker\n# æŸ¥çœ‹DockeræœåŠ¡çŠ¶æ€\nsystemctl status docker\n```\n\n## éƒ¨ç½²å¹¶é…ç½®Matomo\n\n### éƒ¨ç½²Matomo\n\nï¼ˆ1ï¼‰åˆ›å»ºscriptç›®å½•å­˜æ”¾ymlæ–‡ä»¶ï¼Œç¼–æ’éƒ¨ç½²Matomoã€‚\n\n```\nmkdir /data/script\nvi /data/script/matomo.yml\n**************************matomo.yml**************************\nservices:\n  matomo-sql:\n    # ä½¿ç”¨ MySQL æ•°æ®åº“é•œåƒ\n    image: mysql:latest\n    # å®¹å™¨åç§°\n    container_name: matomo-sql\n    # å®¹å™¨é‡å¯ç­–ç•¥ï¼šå¦‚æœå®¹å™¨åœæ­¢ï¼Œæ€»æ˜¯é‡å¯\n    restart: always\n    # é…ç½®ç¯å¢ƒå˜é‡\n    environment:\n      # è®¾ç½®æ•°æ®åº“å\n      - MYSQL_DATABASE=matomo\n      # è®¾ç½®æ•°æ®åº“ç”¨æˆ·å\n      - MYSQL_USER=matomo\n      # è®¾ç½®æ•°æ®åº“ç”¨æˆ·å¯†ç \n      - MYSQL_PASSWORD=matomo\n      # è®¾ç½®æ•°æ®åº“ root ç”¨æˆ·å¯†ç \n      - MYSQL_ROOT_PASSWORD=matomo\n      # è®¾ç½®æ—¶åŒº\n      - TZ=Asia/Shanghai\n    # æš´éœ²çš„ç«¯å£å·æ˜ å°„ï¼Œå°† MySQL çš„ 3306 ç«¯å£æ˜ å°„åˆ°å®¿ä¸»æœº\n    ports:\n      - \"3306:3306\"\n    # å°†å®¿ä¸»æœºçš„ç›®å½•æŒ‚è½½åˆ°å®¹å™¨çš„ MySQL æ•°æ®ç›®å½•\n    volumes:\n      - /data/database/matomo-sql:/var/lib/mysql\n    # ä½¿ç”¨ root ç”¨æˆ·æƒé™è¿è¡Œå®¹å™¨\n    user: \"0\"\n    # ç½‘ç»œé…ç½®\n    networks:\n      # ä½¿ç”¨è‡ªå®šä¹‰ç½‘ç»œ 'net'\n      net:\n        # ä¸ºå®¹å™¨åˆ†é…å›ºå®šçš„ IPv4 åœ°å€\n        ipv4_address: 172.18.0.10\n\n  matomo-app:\n    # ä½¿ç”¨ Matomo åº”ç”¨é•œåƒ\n    image: matomo:latest\n    # å®¹å™¨åç§°\n    container_name: matomo-app\n    # å®¹å™¨é‡å¯ç­–ç•¥ï¼šå¦‚æœå®¹å™¨åœæ­¢ï¼Œæ€»æ˜¯é‡å¯\n    restart: always\n    # é“¾æ¥åˆ° MySQL æ•°æ®åº“æœåŠ¡\n    links:\n      - matomo-sql\n    # å°†å®¿ä¸»æœºçš„ç›®å½•æŒ‚è½½åˆ° Matomo åº”ç”¨ç›®å½•\n    volumes:\n      - /data/matomo:/var/www/html\n    # è®¾ç½®ç¯å¢ƒå˜é‡\n    environment:\n      # è®¾ç½®æ—¶åŒº\n      - TZ=Asia/Shanghai\n      # æŒ‡å®šæ•°æ®åº“ä¸»æœºåä¸º 'matomo-sql'\n      - MATOMO_DATABASE_HOST=matomo-sql\n      # è®¾ç½® PHP å†…å­˜é™åˆ¶\n      - PHP_MEMORY_LIMIT=2048M\n      # æŒ‡å®šæ•°æ®åº“é€‚é…å™¨ä¸º MySQL\n      - MATOMO_DATABASE_ADAPTER=mysql\n      # è®¾ç½®æ•°æ®åº“è¡¨åå‰ç¼€\n      - MATOMO_DATABASE_TABLES_PREFIX=matomo_\n      # æŒ‡å®šæ•°æ®åº“ç”¨æˆ·å\n      - MATOMO_DATABASE_USERNAME=matomo\n      # æŒ‡å®šæ•°æ®åº“ç”¨æˆ·å¯†ç \n      - MATOMO_DATABASE_PASSWORD=matomo\n      # æŒ‡å®šæ•°æ®åº“åç§°\n      - MATOMO_DATABASE_DBNAME=matomo\n    # ä½¿ç”¨ root ç”¨æˆ·æƒé™è¿è¡Œå®¹å™¨\n    user: \"0\"\n    # å®¹å™¨ç«¯å£æ˜ å°„ï¼Œå°† Matomo çš„ 80 ç«¯å£æ˜ å°„åˆ°å®¿ä¸»æœº\n    ports:\n      - \"80:80\"\n    # ç½‘ç»œé…ç½®\n    networks:\n      # ä½¿ç”¨è‡ªå®šä¹‰ç½‘ç»œ 'net'\n      net:\n        # ä¸ºå®¹å™¨åˆ†é…å›ºå®šçš„ IPv4 åœ°å€\n        ipv4_address: 172.18.0.11\n\n# è‡ªå®šä¹‰ç½‘ç»œé…ç½®\nnetworks:\n  # å®šä¹‰è‡ªå®šä¹‰ç½‘ç»œ 'net'\n  net:\n    # ä½¿ç”¨æ¡¥æ¥ç½‘ç»œé©±åŠ¨\n    driver: bridge\n    # IP åœ°å€ç®¡ç†é…ç½®\n    ipam:\n      config:\n        # ä¸ºè‡ªå®šä¹‰ç½‘ç»œè®¾ç½®å­ç½‘\n        - subnet: 172.18.0.0/24\n**************************matomo.yml**************************\n```\n\nï¼ˆ2ï¼‰æ‰§è¡ŒDocker Composeåˆ›å»ºå®¹å™¨ï¼Œå¹¶æŸ¥çœ‹å½“å‰æ­£åœ¨è¿è¡Œçš„ Docker å®¹å™¨ã€‚\n\n```\ndocker compose -f /data/script/matomo.yml up -d\ndocker ps\n```\n\n### é…ç½®Matomo\n\nï¼ˆ1ï¼‰åœ¨æµè§ˆå™¨ä¸­è®¿é—®`http://æœ¬æœºip`ï¼ŒæŒ‰å¼•å¯¼è¿›è¡Œå®‰è£…ã€‚\n\n![img](Dockeréƒ¨ç½²Matomo/1.png)\n\nï¼ˆ2ï¼‰åœ¨å‘å¯¼â€3.æ•°æ®åº“è®¾ç½®â€œç•Œé¢ä¸­æŸ¥çœ‹å¹¶ä¿®æ”¹æ•°æ®åº“é…ç½®ä¿¡æ¯ï¼Œæ­¤å¤„çš„â€œæ•°æ®åº“æœåŠ¡å™¨â€åç§°å¡«å†™çš„æ˜¯æ•°æ®åº“å®¹å™¨åç§°ã€‚\n\n![img](Dockeréƒ¨ç½²Matomo/2.png)\n\nï¼ˆ3ï¼‰åœ¨å‘å¯¼â€5.è¶…çº§ç”¨æˆ·â€œç•Œé¢ä¸­ï¼Œåˆ›å»ºè¶…çº§ç”¨æˆ·çš„ç”¨æˆ·åã€å¯†ç åŠç”µå­é‚®ç®±ã€‚\n\n![img](Dockeréƒ¨ç½²Matomo/3.png)\n\nï¼ˆ4ï¼‰åœ¨å‘å¯¼â€6.è®¾ç½®ç½‘ç«™â€œç•Œé¢ä¸­ï¼Œè¯·è®¾ç½®ä¸€ä¸ªæƒ³ç”¨Matomoè¿½è¸ªã€åˆ†æçš„ç«™ç‚¹ã€‚\n\n![img](Dockeréƒ¨ç½²Matomo/4.png)\n\nï¼ˆ5ï¼‰åœ¨å‘å¯¼â€7.JavaScript è·Ÿè¸ªä»£ç â€œç•Œé¢ä¸­ï¼Œå¤åˆ¶ä»£ç ç‰‡æ®µ,æ·»åŠ åˆ°ç½‘ç«™çš„æ¯ä¸ªé¡µé¢ï¼Œè¿½è¸ªç½‘ç«™çš„æµé‡ã€‚\n\n![img](Dockeréƒ¨ç½²Matomo/5.png)\n\nï¼ˆ6ï¼‰å®‰è£…å®Œæˆåç™»å½•matomoï¼Œåœ¨â€œä»ªè¡¨é¢æ¿â€ç•Œé¢ä¸­ï¼Œé€‰æ‹©ã€INSTALL WITH JAVASRCIPTä»£ç ã€‘ï¼ŒæŸ¥çœ‹è¿½è¸ªä»£ç ã€‚\n\n![img](Dockeréƒ¨ç½²Matomo/6.png)\n\nï¼ˆ7ï¼‰é€‰æ‹©ã€TEST INSTALLATIONã€‘ï¼Œæµ‹è¯•æ˜¯å¦èƒ½å¤Ÿç›‘æ§ç½‘ç«™æµé‡ï¼Œå½“å‡ºç°â€The tracking code is installed successfully! This screen will disappear as soon as some data is tracked for your website.â€œçš„ç»¿è‰²å­—æ ·æ—¶ï¼Œç½‘ç«™æµé‡å¯æ­£å¸¸è¿½è¸ªã€‚\n\n![img](Dockeréƒ¨ç½²Matomo/7.png)\n\nï¼ˆ8ï¼‰é€‰æ‹©èœå•æ ä¸­çš„â€æ‰€æœ‰ç½‘ç«™â€ï¼ŒæŸ¥çœ‹æ‰€æœ‰ç›‘æ§çš„ç½‘ç«™æŠ¥è¡¨åŠæ€»è®¿é—®é‡ã€è®¿é—®è€…ã€æµè§ˆé‡ã€æ´»åŠ¨è€…ã€æ”¶å…¥ç­‰å…ƒç´ ã€‚\n\n![img](Dockeréƒ¨ç½²Matomo/8.png)\n\n### å¯é€‰é…ç½®\n\nï¼ˆ1ï¼‰é€‰æ‹©â€œè®¾ç½®â€å›¾æ ‡ï¼Œé€‰æ‹©â€œä¸ªäººâ€ä¸­â€œè®¾ç½®â€ï¼Œå°†é»˜è®¤åŠ è½½çš„æŠ¥è¡¨æ—¥æœŸæ”¹ä¸ºâ€œä»Šå¤©â€ã€‚\n\nï¼ˆ2ï¼‰é€‰æ‹©â€œè®¾ç½®â€å›¾æ ‡ï¼Œé€‰æ‹©â€œéšç§è®¾ç½®â€ä¸­â€œåŒ¿ååŒ–æ•°æ®â€ï¼Œå–æ¶ˆå‹¾é€‰â€œéšè—è®¿å®¢çš„IPåœ°å€â€ã€‚\n\nï¼ˆ3ï¼‰é€‰æ‹©â€œè®¾ç½®â€å›¾æ ‡ï¼Œé€‰æ‹©â€œç½‘ç«™â€ä¸­â€œè®¾ç½®â€ï¼Œæ–°ç½‘ç«™é»˜è®¤æ—¶åŒºé€‰æ‹©â€œä¸­å›½-ä¸Šæµ·â€ï¼Œæ–°ç½‘ç«™çš„é»˜è®¤è´§å¸é€‰æ‹©â€œäººæ°‘å¸ (Â¥)â€ã€‚\n\nï¼ˆ4ï¼‰é€‰æ‹©â€œè®¾ç½®â€å›¾æ ‡ï¼Œé€‰æ‹©â€œç³»ç»Ÿâ€ä¸­â€œåœ°ç†ä½ç½®â€ï¼Œå°†ä½ç½®ä¿¡æ¯æä¾›å•†ä¿®æ”¹ä¸ºâ€œDBIP / GeolP 2 (Php)â€ã€‚\n\nï¼ˆ5ï¼‰é€‰æ‹©â€œè®¾ç½®â€å›¾æ ‡ï¼Œé€‰æ‹©â€œå¹³å°â€ä¸­â€œå•†åŸâ€ï¼Œå®‰è£…IP2Locationã€LogViewerã€MarketingCampaignsReportingã€Profile Gravataræ’ä»¶ï¼Œå®‰è£…LogVieweræ’ä»¶åï¼Œéœ€è¦åœ¨æœ¬åœ°æ˜ å°„ç›®å½•/data/matomo/config/ä¸­,å¯¹global.ini.phpä¸­çš„[log]æ¨¡å—è¿›è¡Œä¿®æ”¹ã€‚ä¿®æ”¹å®Œæˆåï¼Œé‡å¯appå®¹å™¨ã€‚\n\n```\n[log]\nlog_writers[] = file\nlog_level = INFO\n\n# é‡å¯appå®¹å™¨\ndocker restart matomo-app\n```\n\nï¼ˆ6ï¼‰å¯ç”¨æ’ä»¶TagManager ã€DBStatsã€‚","tags":["Matomo","docker"],"categories":["å®¹å™¨åŒ–","Linuxè¿ç»´","docker","ç½‘ç»œåˆ†æ"]},{"title":"å®ç°Nextcloudç§æœ‰äº‘ç›˜","url":"/yyg/f7b8055d/","content":"## ä»»åŠ¡ç›®æ ‡\n\n1. å®ŒæˆNextcloudç§æœ‰äº‘ç›˜çš„æ­å»º\n\n## éƒ¨ç½²æŒ‡å—\n\n### åŸºç¡€ç¯å¢ƒå‡†å¤‡\n\né…ç½®é˜²ç«å¢™ç­–ç•¥\n\n```shell\nfirewall-cmd --zone=public --add-service=http --permanent\nfirewall-cmd --reload\n```\n\né…ç½®SELinuxç­–ç•¥\n\nè®¾ç½®SELinuxä¸ºpermissiveæˆ–disabledã€‚\n\n```shell\n#ä¿®æ”¹\nsetenforce 0\nsudo sed -i 's/^SELINUX=enforcing/SELINUX=disabled/' /etc/selinux/config\n#æˆ–\nsetenforce 0\nsudo sed -i 's/^SELINUX=enforcing/SELINUX=permissive/' /etc/selinux/config\n```\n\n### å®‰è£…Apache\n\n```shell\nyum -y install httpd\n```\n\n### å®‰è£…PHP\n\n```shell\nyum -y install php\n#å®‰è£…phpæ¨¡å—ä¾èµ–\nyum -y install php-zip php-dom php-xml php-mbstring php-pdo php-gd\n```\n\n### æ·»åŠ Nextcloudç«™ç‚¹é…ç½®æ–‡ä»¶\n\n```shell\nmkdir /var/www/html/nextcloud/\nchmod 777 /var/www/html/nextcloud/\n#æ–°å»ºæ–‡ä»¶\nvi /etc/httpd/conf.d/nextcloud.conf\n<VirtualHost *:80>\n  DocumentRoot /var/www/html/nextcloud/\n  ServerName  your.server.com\n\n  <Directory /var/www/html/nextcloud/>\n    Require all granted\n    AllowOverride All\n    Options FollowSymLinks MultiViews\n\n    <IfModule mod_dav.c>\n      Dav off\n    </IfModule>\n\n  </Directory>\n</VirtualHost>\n```\n\n### ä¸‹è½½Nextcloudå®‰è£…æ–‡ä»¶\n\n```shell\nwget -P /var/www/html/nextcloud/ https://download.nextcloud.com/server/installer/setup-nextcloud.php\n```\n\n### å¯åŠ¨æœåŠ¡\n\n```shell\nsystemctl start httpd\nsystemctl enable httpd\n```\n\n### é€šè¿‡æµè§ˆå™¨è®¿é—®\n\nåœ¨æµè§ˆå™¨ä¸­è¾“å…¥`http://172.20.1.51/setup-nextcloud.php`ï¼ŒæŒ‰å¼•å¯¼è¿›è¡Œè®¾ç½®ã€‚å¦‚ä¸‹å›¾æ‰€ç¤ºã€‚\n\n![img](å®ç°Nextcloudç§æœ‰äº‘ç›˜/2.jpg)\n\nè®¾ç½®ç”¨æˆ·åå’Œå¯†ç ï¼Œå®‰è£…æ•°æ®åº“å¦‚ä¸‹å›¾æ‰€ç¤ºã€‚\n\n![img](å®ç°Nextcloudç§æœ‰äº‘ç›˜/4.png)\n\næˆåŠŸè¿›å…¥å†…å®¹ç•Œé¢ï¼Œéƒ¨ç½²å®Œæˆï¼Œå¦‚ä¸‹å›¾æ‰€ç¤ºã€‚\n\n![img](å®ç°Nextcloudç§æœ‰äº‘ç›˜/3.png)","tags":["ç§æœ‰äº‘ç›˜","Linux","Nextcloud"],"categories":["Linuxè¿ç»´"]},{"title":"DNSæœåŠ¡å™¨æ­å»º","url":"/yyg/37824039/","content":"## æœåŠ¡å™¨ç«¯\n\nï¼ˆ1ï¼‰é€šè¿‡åœ¨çº¿æ–¹å¼å®‰è£…bind9\n\n```\nyum install -y bind bind-utils\n```\n\nï¼ˆ2ï¼‰å¯åŠ¨æœåŠ¡\n\n```\nsystemctl start named\n```\n\nï¼ˆ3ï¼‰æŸ¥çœ‹æœåŠ¡çŠ¶æ€\n\n```\nsystemctl status named\n```\n\nï¼ˆ4ï¼‰é…ç½®æœåŠ¡ä¸ºå¼€æœºè‡ªå¯åŠ¨\n\n```\nsystemctl enable named\n```\n\nï¼ˆ5ï¼‰ä¿®æ”¹namedæœåŠ¡é…ç½®æ–‡ä»¶ï¼Œé…ç½®DNSæ—¥å¿—è·¯å¾„\n\n```shell\nvi /etc/named.conf\n-------------------named.conf-------------------\noptions {\n        // æ¥å—æ¥è‡ªä»»ä½•ç½‘ç»œæ¥å£çš„DNSè¯·æ±‚\n        listen-on port 53 { any; };\n        listen-on-v6 port 53 { ::1; };\n        directory       \"/var/named\";\n        dump-file       \"/var/named/data/cache_dump.db\";\n        statistics-file \"/var/named/data/named_stats.txt\";\n        memstatistics-file \"/var/named/data/named_mem_stats.txt\";\n        secroots-file   \"/var/named/data/named.secroots\";\n        recursing-file  \"/var/named/data/named.recursing\";\n        // å…è®¸è®¿é—®çš„ipèŒƒå›´\n        allow-query     { 10.10.0.0/16; };\n\n# ä¸ºæ’ç‰ˆæ–¹ä¾¿æ­¤å¤„çœç•¥éƒ¨åˆ†æç¤ºä¿¡æ¯\n};\nlogging {\n    //    channel default_debug {\n    //            file \"data/named.run\";\n    //            severity dynamic;\n    //    };\n        \n        channel named_log {\n                // æŒ‡å®šæ—¥å¿—æ–‡ä»¶çš„è·¯å¾„,è®¾ç½®æ—¥å¿—æ–‡ä»¶çš„ç‰ˆæœ¬æ•°é‡é™åˆ¶ä¸º5ä¸ªï¼Œæ¯ä¸ªæ–‡ä»¶çš„æœ€å¤§å¤§å°ä¸º50m\n                file \"/var/log/dns/named.log\" versions 5 size 50m;\n                // æ—¥å¿—è®°å½•çš„æ—¶é—´æ ¼å¼é‡‡ç”¨ISO 8601æ ‡å‡†\n                print-time iso8601;\n                // æ‰“å°æ—¥å¿—æ¡ç›®çš„ç±»åˆ«\n                print-category yes;\n               // æ‰“å°æ—¥å¿—æ¡ç›®çš„ä¸¥é‡æ€§\n                print-severity yes;\n                severity info;\n        };\n        // å®šä¹‰å¤šä¸ªæ—¥å¿—è®°å½•ç±»åˆ«\n        category default   { named_log; };\n        category general   { named_log; };\n        category config   { named_log; };\n        category client   { named_log; };\n        category network   { named_log; };\n        category notify   { named_log; };\n        category queries   { named_log; };\n        category update   { named_log; };\n        category query-errors  { named_log; };\n        category resolver   { named_log; };\n        category xfer-in   { named_log; };\n        category xfer-out   { named_log; };\n        category dnssec   { named_log; };\n};\n# ä¸ºæ’ç‰ˆæ–¹ä¾¿æ­¤å¤„çœç•¥éƒ¨åˆ†æç¤ºä¿¡æ¯\n-------------------named.conf-------------------\n```\n\nï¼ˆ6ï¼‰é…ç½®DNSåŒºåŸŸï¼Œå®ŒæˆDNSæœåŠ¡å™¨çš„æ­å»º\n\n```\nvi /etc/named.rfc1912.zones\n-------------------named.rfc1912.zones-------------------\n// If private ranges should be forwarded, add\n// disable-empty-zone \".\"; into options\n//\n\nzone \"localhost.localdomain\" IN {\n        type master;\n        file \"named.localhost\";\n        allow-update { none; };\n};\n\nzone \"localhost\" IN {\n        type master;\n        file \"named.localhost\";\n        allow-update { none; };\n};\n\nzone \"1.0.0.0.0.0.0.0.0.0.0.0.0.0.0.0.0.0.0.0.0.0.0.0.0.0.0.0.0.0.0.0.ip6.arpa\" IN {\n        type master;\n        file \"named.loopback\";\n        allow-update { none; };\n};\n\nzone \"1.0.0.127.in-addr.arpa\" IN {\n        type master;\n        file \"named.loopback\";\n        allow-update { none; };\n};\n\nzone \"0.in-addr.arpa\" IN {\n        type master;\n        file \"named.empty\";\n        allow-update { none; };\n};\n// è‡ªå®šä¹‰åŸŸååŒºåŸŸå’ŒDNSè®°å½•é›†åˆ\nzone \"elk.com\" IN {\n        type master;\n        file \"/var/named/elk.com.zone\";\n        allow-update { none; };\n};\n-----------------------------------------------\n```\n\nï¼ˆ7ï¼‰åˆ›å»ºâ€elk.comâ€çš„åŒºåŸŸæ•°æ®æ–‡ä»¶ï¼Œå¹¶å®šä¹‰DNSæœåŠ¡å™¨çš„åŸŸåä¸ºâ€œ[dns.elk.com](https://dns.elk.com/)â€å’Œå®¢æˆ·æœºçš„åŸŸåä¸ºâ€œ[test.elk.com](https://test.elk.com/)â€ã€‚\n\n```\n# åˆ›å»º\"elk.com\"çš„åŒºåŸŸæ•°æ®æ–‡ä»¶\nvi /var/named/elk.com.zone\n# å®šä¹‰DNSæœåŠ¡å™¨å’Œå®¢æˆ·æœºçš„åŸŸå\n-------------------named.rfc1912.zones-------------------\n$TTL 1D\n@       IN SOA  dns.elk.com. admin.elk.com. (\n                                        0       ; serial\n                                        1D      ; refresh\n                                        1H      ; retry\n                                        1W      ; expire\n                                        3H )    ; minimum\n@   IN  NS      dns.elk.com.\ndns     IN      A   10.10.2.103\ntest    IN      A   10.10.2.113\n-------------------------------------------------------\n```\n\nï¼ˆ8ï¼‰è®¾ç½®æ—¥å¿—æœåŠ¡æƒé™ï¼Œé…ç½®é˜²ç«å¢™ï¼Œé‡å¯æœåŠ¡ä½¿å¾—é…ç½®ç”Ÿæ•ˆ\n\n```\n# åˆ›å»ºå­˜æ”¾æ—¥å¿—çš„ç›®å½•å¹¶èµ‹æƒ\nmkdir /var/log/dns\nchmod -R 777 /var/log/dns/\n# é…ç½®dnsæœåŠ¡è®¿é—®ç­–ç•¥ï¼Œä½¿å…¶èƒ½å¤Ÿæ­£å¸¸è®¿é—®\nfirewall-cmd --permanent --add-service=dns\n# é‡æ–°åŠ è½½é˜²ç«å¢™ç­–ç•¥\nfirewall-cmd --reload\n# é‡å¯namedæœåŠ¡ï¼Œè®©é…ç½®ç”Ÿæ•ˆ\n systemctl restart named\n```\n\nï¼ˆ9ï¼‰ä¿®æ”¹DNSä¸ºâ€œ10.10.2.103â€ï¼Œå¹¶é‡å¯ç½‘ç»œç”Ÿæ•ˆã€‚\n\n```\n# ä½¿ç”¨nmtuiç®¡ç†ç½‘ç»œè¿æ¥\nnmtui\n```\n\né€‰æ‹©â€œç¼–è¾‘è¿æ¥â€ï¼Œå›è½¦ï¼Œé€‰æ‹©ç½‘å¡â€œens32â€ï¼Œåœ¨â€œç¼–è¾‘è¿æ¥â€ç•Œé¢ä¸­å°†DNSæœåŠ¡å™¨ä¿®æ”¹ä¸ºâ€œ10.10.2.103â€ï¼Œä¿å­˜é€€å‡ºã€‚å¦‚å›¾6-1-1ã€6-1-2æ‰€ç¤ºã€‚\n\n[![img](data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7)](https://marsperl.github.io/yyg/37824039/image-20240422191810676.png)[![img](data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7)](https://marsperl.github.io/yyg/37824039/2.png)\n\nä¿å­˜é€€å‡ºåï¼Œé‡å¯ç½‘ç»œè®©DNSæœåŠ¡å™¨é…ç½®ç”Ÿæ•ˆã€‚\n\n```\nsystemctl restart NetworkManager\n```\n\nï¼ˆ10ï¼‰éªŒè¯DNSæœåŠ¡å™¨æ˜¯å¦é…ç½®æˆåŠŸã€‚\n\n```\nping www.baidu.com\nping dns.elk.com\nping test.elk.com\n```\n\n## å®¢æˆ·æœºç«¯\n\nä¿®æ”¹DNSé…ç½®ä¸ºâ€œ10.10.2.103â€ï¼Œå…·ä½“æ­¥éª¤å‚ç…§ã€Šæ­¥éª¤1ï¼šè™šæ‹Ÿæœºè§„åˆ’ã€‹çš„â€œï¼ˆ9ï¼‰â€ã€‚\n\né‡å¯ç½‘ç»œç½‘ç»œåï¼ŒéªŒè¯DNSé…ç½®æ˜¯å¦ç”Ÿæ•ˆã€‚\n\n```\nping www.baidu.com\nping dns.elk.com\nping test.elk.com\n```","tags":["DNS","Linuxè¿ç»´"],"categories":["Linuxè¿ç»´","ç½‘ç»œæœåŠ¡æ­å»º"]},{"title":"DHCPæœåŠ¡å™¨æ­å»º","url":"/yyg/97ec93b/","content":"## æœåŠ¡å™¨ç«¯\n\nï¼ˆ1ï¼‰é€šè¿‡åœ¨çº¿æ–¹å¼å®‰è£…dhcp-server\n\n```\n[root@dncp-103 ~]# yum -y install dhcp-server\n```\n\nï¼ˆ2ï¼‰ä¿®æ”¹dhcpdæœåŠ¡é…ç½®æ–‡ä»¶ï¼Œå®ŒæˆDHCPæœåŠ¡å™¨çš„æ­å»º\n\n```\n[root@dncp-103 ~]# vi /etc/dhcp/dhcpd.conf\n-------------------dhcpd.conf-------------------\n# DHCP Server Configuration file.\n#   see /usr/share/doc/dhcp-server/dhcpd.conf.example\n#   see dhcpd.conf(5) man page\n#\n# è®¾ç½®åŸŸåä¸º \"elk.com\"\noption domain-name     \"elk.com\";\n\n# è®¾ç½®åŸŸåæœåŠ¡å™¨ä¸º 10.10.2.103\noption domain-name-servers    10.10.2.103;\n\n# Declare DHCP Server\n# å£°æ˜æ­¤ DHCP æœåŠ¡å™¨\nauthoritative;  \n\n# è®¾ç½®é»˜è®¤ç§Ÿçº¦æ—¶é—´ä¸º 600 ç§’\ndefault-lease-time 600;\n# è®¾ç½®æ—¥å¿—è®¾æ–½ä¸º local4\nlog-facility local4;\n# è®¾ç½®æœ€å¤§ç§Ÿçº¦æ—¶é—´ä¸º 7200 ç§’\nmax-lease-time 7200;\n\n# Set Network address, subnet mask and gateway\nsubnet 10.10.2.0 netmask 255.255.255.0 {\n}\n\n# è®¾ç½® IP åœ°å€èŒƒå›´ä¸º 10.10.2.202 åˆ° 10.10.2.205\nsubnet 10.10.2.0 netmask 255.255.255.0 {\n  range 10.10.2.202 10.10.2.205;\n  # è®¾ç½®ç½‘å…³ä¸º 10.10.2.1\n  option routers 10.10.2.1;\n  # è®¾ç½®å­ç½‘æ©ç ä¸º 255.255.255.0\n  option subnet-mask 255.255.255.0;\n  # è®¾ç½®å¹¿æ’­åœ°å€ä¸º 10.10.2.255\n  option broadcast-address 10.10.2.255;\n  # è®¾ç½®é»˜è®¤ç§Ÿçº¦æ—¶é—´ä¸º 600 ç§’\n  default-lease-time 600;\n  # è®¾ç½®æœ€å¤§ç§Ÿçº¦æ—¶é—´ä¸º 7200 ç§’\n  max-lease-time 7200;\n  # Add other DHCP options here\n}\n-------------------dhcpd.conf-------------------\n```\n\nï¼ˆ3ï¼‰åœ¨rsyslog.confä¸­é…ç½®dhcpæ—¥å¿—è·¯å¾„\n\n```\n[root@dncp-103 ~]# vi /etc/rsyslog.conf\n-------------------rsyslog.conf-------------------\n#ä¸ºæ’ç‰ˆæ–¹ä¾¿æ­¤å¤„çœç•¥éƒ¨åˆ†æç¤ºä¿¡æ¯\n# Don't log private authentication messages!\n#å°† local4 è®¾æ–½çš„æ—¥å¿—æ¶ˆæ¯æ’é™¤åœ¨ /var/log/messages æ–‡ä»¶ä¹‹å¤–\n*.info;mail.none;authpriv.none;cron.none;local4.none           /var/log/messages\n# æ¥è‡ª local4 è®¾æ–½çš„æ‰€æœ‰çº§åˆ«çš„æ—¥å¿—æ¶ˆæ¯è®°å½•åˆ° /var/log/dhcp/dhcp.log æ–‡ä»¶ä¸­\nlocal4.* /var/log/dhcp/dhcp.log\n#ä¸ºæ’ç‰ˆæ–¹ä¾¿æ­¤å¤„çœç•¥éƒ¨åˆ†æç¤ºä¿¡æ¯\n-------------------rsyslog.conf-------------------\n```\n\nï¼ˆ4ï¼‰å¯åŠ¨dhcpdæœåŠ¡å¹¶é‡å¯rsyslogæœåŠ¡ï¼Œä½¿å¾—é…ç½®ç”Ÿæ•ˆ\n\n```\n# å¯åŠ¨dhcpdæœåŠ¡\n[root@dncp-103 ~]# systemctl start dhcpd\n# é‡å¯rsyslogæœåŠ¡\n[root@dncp-103 ~]# systemctl restart rsyslog\n```\n\nï¼ˆ5ï¼‰æŸ¥çœ‹dhcpdæœåŠ¡çŠ¶æ€\n\n```\n[root@dncp-103 ~]# systemctl status dhcpd\n```\n\nï¼ˆ6ï¼‰é…ç½®dhcpdæœåŠ¡ä¸ºå¼€æœºè‡ªå¯åŠ¨\n\n```\n[root@dncp-103 ~]# systemctl enable dhcpd\n```\n\nï¼ˆ7ï¼‰é…ç½®é˜²ç«å¢™ï¼Œé‡å¯æœåŠ¡ï¼Œä½¿å¾—é…ç½®ç”Ÿæ•ˆ\n\n```\n# é…ç½®dhcpæœåŠ¡è®¿é—®ç­–ç•¥ï¼Œä½¿å…¶èƒ½å¤Ÿæ­£å¸¸è®¿é—®\n[root@dncp-103 ~]# firewall-cmd --add-service=dhcp --permanent\nsuccess\n# é‡æ–°åŠ è½½é˜²ç«å¢™ç­–ç•¥\n[root@dncp-103 ~]# firewall-cmd --reload\nsuccess\n```\n\n## å®¢æˆ·æœºç«¯\n\nï¼ˆ1ï¼‰æŸ¥çœ‹å®¢æˆ·æœºåŸæœ¬ip\n\n```\n[root@dncp-113 ~]# ip a\n```\n\nï¼ˆ2ï¼‰ä¿®æ”¹å®¢æˆ·æœºipä¸ºåŠ¨æ€ï¼ŒéªŒè¯DHCPæœåŠ¡å™¨æ˜¯å¦èƒ½åŠ¨æ€çš„åˆ†é…ip\n\n```\n# ä¿®æ”¹ç½‘å¡é…ç½®æ–‡ä»¶\n[root@dncp-113 ~]# vi /etc/NetworkManager/system-connections/ens32.nmconnection\n-------------------ens32.nmconnection-------------------\n[connection]\nid=ens32\nuuid=2bb0f492-19e2-37c0-b8fa-1781d3122a83\ntype=ethernet\nautoconnect-priority=-999\ninterface-name=ens32\ntimestamp=1713841073\n\n[ethernet]\n\n[ipv4]\n# æ³¨é‡Šè®¾ç½®é™æ€IPä¿¡æ¯\n#address1=10.10.2.113/24,10.10.2.1\ndns=10.10.2.103;\n# é€šè¿‡ DHCPåŠ¨æ€è·å– IP åœ°å€\nmethod=auto\n\n[ipv6]\naddr-gen-mode=eui64\nmethod=auto\n\n[proxy]\n-------------------ens32.nmconnection-------------------\n```\n\nï¼ˆ3ï¼‰é‡æ–°åŠ è½½ NetworkManager çš„è¿æ¥é…ç½®ï¼ŒæŸ¥çœ‹åˆ†é…çš„åŠ¨æ€ip\n\n```\n# é‡æ–°åŠ è½½ NetworkManager çš„è¿æ¥é…ç½®\n[root@dncp-113 ~]# nmcli c reload\n# è¿æ¥ç½‘ç»œæ¥å£ ens32\n[root@dncp-113 ~]# nmcli d connect ens32\nè®¾å¤‡ \"ens32\" æˆåŠŸä»¥ \"2bb0f492-19e2-37c0-b8fa-1781d3122a83\" æ¿€æ´»ã€‚\n# æŸ¥çœ‹åˆ†é…çš„åŠ¨æ€ip\n[root@dncp-113 ~]# ip a\n```","tags":["DHCP","Linuxè¿ç»´"],"categories":["Linuxè¿ç»´","ç½‘ç»œæœåŠ¡æ­å»º"]},{"title":"NTPæœåŠ¡å™¨æ­å»º","url":"/yyg/29b27760/","content":"## æœåŠ¡å™¨ç«¯\n\nï¼ˆ1ï¼‰é€šè¿‡åœ¨çº¿æ–¹å¼å®‰è£…chrony\n\n```\nyum install -y chrony\n```\n\nï¼ˆ2ï¼‰å¯åŠ¨chronyæœåŠ¡\n\n```\nsystemctl start chronyd\n```\n\nï¼ˆ3ï¼‰æŸ¥çœ‹chronyæœåŠ¡çŠ¶æ€\n\n```\nsystemctl status chronyd\n```\n\nï¼ˆ4ï¼‰é…ç½®chronyæœåŠ¡ä¸ºå¼€æœºè‡ªå¯åŠ¨\n\n```\nsystemctl enable chronyd\n```\n\nï¼ˆ5ï¼‰ä¿®æ”¹chronydæœåŠ¡é…ç½®æ–‡ä»¶ï¼Œå®ŒæˆNTPæœåŠ¡å™¨çš„æ­å»º\n\n```shell\nvi /etc/chrony.conf\n-------------------chrony.conf-------------------\npool 2.centos.pool.ntp.org iburst\nsourcedir /run/chrony-dhcp\n#é…ç½®çš„å¤šä¸ªNTPæœåŠ¡å™¨\nserver ftp.aliyun.com iburst\nserver time1.aliyun.com iburst\nserver time2.aliyun.com iburst\nserver time3.aliyun.com iburst\nserver time4.aliyun.com iburst\nserver time5.aliyun.com iburst\nserver 10.10.2.103 iburst\ndriftfile /var/lib/chrony/drift\nmakestep 1.0 3\nrtcsync\n#å…è®¸è®¿é—®çš„ç½‘æ®µ\nallow 10.10.0.0/16\nkeyfile /etc/chrony.keys\nntsdumpdir /var/lib/chrony\nleapsectz right/UTC\n#æ—¥å¿—å­˜å‚¨è·¯å¾„\nlogdir /var/log/chrony\n#æ—¥å¿—æµ‹é‡ç»Ÿè®¡æŒ‡æ ‡\nlog measurements statistics tracking\n-------------------chrony.conf-------------------\n```\n\nï¼ˆ6ï¼‰é…ç½®é˜²ç«å¢™ï¼Œé‡å¯æœåŠ¡ï¼Œä½¿å¾—é…ç½®ç”Ÿæ•ˆ\n\n```\n# é…ç½®ntpæœåŠ¡è®¿é—®ç­–ç•¥ï¼Œä½¿å…¶èƒ½å¤Ÿæ­£å¸¸è®¿é—®\nfirewall-cmd --permanent --add-service=ntp\n# é‡æ–°åŠ è½½é˜²ç«å¢™ç­–ç•¥\nfirewall-cmd --reload\n# é‡å¯chronydæœåŠ¡\nsystemctl restart chronyd\n```\n\nï¼ˆ7ï¼‰æŸ¥çœ‹è¿æ¥NTPæœåŠ¡çš„å®¢æˆ·æœº\n\n```\nchronyc clients\n```\n\n## å®¢æˆ·æœºç«¯\n\nï¼ˆ1ï¼‰é€šè¿‡åœ¨çº¿æ–¹å¼å®‰è£…chrony\n\n```\nyum install -y chrony\n```\n\nï¼ˆ2ï¼‰é…ç½®è®¿é—®chronyæœåŠ¡å™¨\n\n```\n# ä¿®æ”¹chronyçš„é…ç½®æ–‡ä»¶\nvi /etc/chrony.conf\n-------------------chrony.conf-------------------\n# Use public servers from the pool.ntp.org project.\n# Please consider joining the pool (https://www.pool.ntp.org/join.html).\npool 2.centos.pool.ntp.org iburst\n\n# Use NTP servers from DHCP.\nsourcedir /run/chrony-dhcp\n\n# Record the rate at which the system clock gains/losses time.\ndriftfile /var/lib/chrony/drift\n# é…ç½®ntpæœåŠ¡å™¨åœ°å€\nserver 10.10.2.103 iburst\n#ä¸ºæ’ç‰ˆæ–¹ä¾¿æ­¤å¤„çœç•¥éƒ¨åˆ†æç¤ºä¿¡æ¯\n-----------------------------------------------\n```\n\nï¼ˆ3ï¼‰å¯åŠ¨chronydæœåŠ¡ï¼Œè¿æ¥NTPæœåŠ¡å™¨\n\n```\n# å¯åŠ¨chronyæœåŠ¡\nsystemctl start chronyd\n# æŸ¥çœ‹chronyæœåŠ¡çŠ¶æ€\nsystemctl status chronyd\n# é…ç½®chronyæœåŠ¡ä¸ºå¼€æœºè‡ªå¯åŠ¨\nsystemctl enable chronyd\n```\n\nï¼ˆ4ï¼‰é…ç½®é˜²ç«å¢™ï¼Œä½¿å¾—é…ç½®ç”Ÿæ•ˆ\n\n```\n# é…ç½®ntpæœåŠ¡è®¿é—®ç­–ç•¥ï¼Œä½¿å…¶èƒ½å¤Ÿæ­£å¸¸è®¿é—®\nfirewall-cmd --permanent --add-service=ntp\n# é‡æ–°åŠ è½½é˜²ç«å¢™ç­–ç•¥\nfirewall-cmd --reload\n```\n\nï¼ˆ5ï¼‰éªŒè¯NTPæœåŠ¡å™¨çš„è¿æ¥æƒ…å†µ\n\n```\n# æŸ¥çœ‹æºæœåŠ¡å™¨çŠ¶æ€\n chronyc sourcestats\n# æŸ¥çœ‹è¯¦ç»†åŒæ­¥çŠ¶æ€\nchronyc sources -v\n# è¿½è¸ªåŒæ­¥æƒ…å†µ\nchronyc tracking\n# å¼€å¯ç½‘ç»œæ—¶é—´åŒæ­¥\ntimedatectl set-ntp true\n# æŸ¥çœ‹æ—¶é—´åŒæ­¥çŠ¶æ€\ntimedatectl status\n```\n","tags":["NTP","Linuxè¿ç»´"],"categories":["Linuxè¿ç»´","ç½‘ç»œæœåŠ¡æ­å»º"]},{"title":"å®‰è£…Winlogbeatæ—¥å¿—é‡‡é›†å™¨","url":"/yyg/f547e2a9/","content":"1. Winlogbeatå®‰è£…ç¨‹åºå¯é€šè¿‡å…¶å®˜ç½‘ï¼ˆhttps://www.elastic.co/cn/beats/winlogbeatï¼‰ä¸‹è½½ã€‚\n2. åŒå‡»å¯åŠ¨å®‰è£…ç¨‹åºï¼Œè¿›å…¥å®‰è£…å‘å¯¼åå‹¾é€‰â€œI accept the terms in the License Agreementâ€ï¼Œå•å‡»ã€Installã€‘ï¼Œå¦‚å›¾æ‰€ç¤ºã€‚\n\n![img](å®‰è£…Winlogbeatæ—¥å¿—é‡‡é›†å™¨/4.png)\n\n1. æŒ‰å®‰è£…å‘å¯¼å®‰è£…å®Œæˆåï¼Œå•å‡»ã€Finishã€‘ï¼Œå®Œæˆå®‰è£…å¹¶æ‰“å¼€å®‰è£…ç›®å½•ã€‚å¦‚å›¾æ‰€ç¤ºã€‚\n\n![img](å®‰è£…Winlogbeatæ—¥å¿—é‡‡é›†å™¨/3.png)\n\n![img](å®‰è£…Winlogbeatæ—¥å¿—é‡‡é›†å™¨/2.png)\n\n1. ä»¥ç®¡ç†å‘˜èº«ä»½æ‰“å¼€ PowerShell æç¤ºç¬¦ï¼ˆå³é”®å•å‡» PowerShell å›¾æ ‡ï¼Œç„¶åé€‰æ‹©ä»¥ç®¡ç†å‘˜èº«ä»½è¿è¡Œï¼‰ï¼Œå…è®¸åœ¨æœ¬åœ°ä¸»æœºä¸Šåˆ›å»ºwinlogbeatæœåŠ¡ï¼Œåˆ›å»ºæˆåŠŸåå…è®¸winlogbeatæœåŠ¡å¹¶éªŒè¯ã€‚å¦‚å›¾æ‰€ç¤ºã€‚\n\n   ```\n   PS C:\\Windows\\system32> cd \"C:\\Program Files\\Elastic\\Beats\\8.13.2\\winlogbeat\"\n   # å…è®¸åœ¨æœ¬åœ°è®¡ç®—æœºä¸Šç¼–å†™çš„æœªç­¾åè„šæœ¬è‡ªç”±è¿è¡Œ\n   PS C:\\Program Files\\Elastic\\Beats\\8.13.2\\winlogbeat> set-executionpolicy remotesigned\n   \n   æ‰§è¡Œç­–ç•¥æ›´æ”¹\n   æ‰§è¡Œç­–ç•¥å¯å¸®åŠ©ä½ é˜²æ­¢æ‰§è¡Œä¸ä¿¡ä»»çš„è„šæœ¬ã€‚æ›´æ”¹æ‰§è¡Œç­–ç•¥å¯èƒ½ä¼šäº§ç”Ÿå®‰å…¨é£é™©ï¼Œå¦‚ https:/go.microsoft.com/fwlink/?LinkID=135170\n   ä¸­çš„ about_Execution_Policies å¸®åŠ©ä¸»é¢˜æ‰€è¿°ã€‚æ˜¯å¦è¦æ›´æ”¹æ‰§è¡Œç­–ç•¥?\n   [Y] æ˜¯(Y)  [A] å…¨æ˜¯(A)  [N] å¦(N)  [L] å…¨å¦(L)  [S] æš‚åœ(S)  [?] å¸®åŠ© (é»˜è®¤å€¼ä¸ºâ€œNâ€): y\n   # å…è®¸è„šæœ¬åœ¨ç³»ç»Ÿä¸Šè¿è¡Œ\n   PS C:\\Program Files\\Elastic\\Beats\\8.13.2\\winlogbeat> set-executionpolicy Bypass\n   \n   æ‰§è¡Œç­–ç•¥æ›´æ”¹\n   æ‰§è¡Œç­–ç•¥å¯å¸®åŠ©ä½ é˜²æ­¢æ‰§è¡Œä¸ä¿¡ä»»çš„è„šæœ¬ã€‚æ›´æ”¹æ‰§è¡Œç­–ç•¥å¯èƒ½ä¼šäº§ç”Ÿå®‰å…¨é£é™©ï¼Œå¦‚ https:/go.microsoft.com/fwlink/?LinkID=135170\n   ä¸­çš„ about_Execution_Policies å¸®åŠ©ä¸»é¢˜æ‰€è¿°ã€‚æ˜¯å¦è¦æ›´æ”¹æ‰§è¡Œç­–ç•¥?\n   [Y] æ˜¯(Y)  [A] å…¨æ˜¯(A)  [N] å¦(N)  [L] å…¨å¦(L)  [S] æš‚åœ(S)  [?] å¸®åŠ© (é»˜è®¤å€¼ä¸ºâ€œNâ€): y\n   # åˆ›å»ºwinlogbeatæœåŠ¡\n   PS C:\\Program Files\\Elastic\\Beats\\8.13.2\\winlogbeat> .\\install-service-winlogbeat.ps1\n   [SC] DeleteService æˆåŠŸ\n   \n   Status   Name               DisplayName\n   ------   ----               -----------\n   Stopped  winlogbeat         winlogbeat\n   \n   # å¯åŠ¨winlogbeatæœåŠ¡\n   PS C:\\Program Files\\Elastic\\Beats\\8.13.2\\winlogbeat> Start-Service winlogbeat\n   ```\n\n![img](å®‰è£…Winlogbeatæ—¥å¿—é‡‡é›†å™¨/1.png)","tags":["ELK","æ—¥å¿—åˆ†æ","æ—¥å¿—é‡‡é›†å™¨","Winlogbeat"],"categories":["æ—¥å¿—åˆ†æ","ELK"]},{"title":"dockerçŸ¥è¯†æ¢³ç†","url":"/yyg/5c56de6f/","content":"### å®¹å™¨è®¾ç½®å¼€æœºè‡ªå¯\n\nå®¹å™¨åˆ›å»ºæ—¶æœªæŒ‡å®š --restart=always ,å¯é€šè¿‡update å‘½ä»¤è®¾ç½®\n\n```PowerShell\ndocker update --restart=always å®¹å™¨ID\n```\n\n### å®¹å™¨å…³é—­è‡ªå¯åŠ¨\n\n```Plaintext\ndocker update --restart=no å®¹å™¨ID\n```\n\n### è·å–å®¹å™¨/é•œåƒçš„å…ƒæ•°æ®\n\n```Plain\ndocker inspect id\n```\n\n### å®¹å™¨ç½‘ç»œ\n\nåˆ›å»ºå®¹å™¨ç½‘ç»œ\n\n```Shell\n#docker network create --subnet å­ç½‘èŒƒå›´ --ip-range å­ç½‘å†…å¯ç”¨çš„IPåœ°å€èŒƒå›´ Dockerç½‘ç»œå\ndocker network create --subnet 172.20.0.0/16 --ip-range 172.20.1.102/29 zabbix-net\n```\n\n#### åˆ é™¤åˆ›å»ºçš„å®¹å™¨ç½‘ç»œ\n\n```Shell\n#æŸ¥çœ‹å®¹å™¨ç½‘ç»œ\ndocker network ls\n#åˆ é™¤å®¹å™¨ç½‘ç»œ\ndocker network rm å®¹å™¨id\n```\n\n### æŸ¥çœ‹dockeræ‰€æœ‰å®¹å™¨ip\n\n```PowerShell\n docker inspect --format='{{.Name}} - {{range .NetworkSettings.Networks}}{{.IPAddress}}{{end}}' $(docker ps -aq)\n```\n\n### æŸ¥çœ‹æ‰€æœ‰å®¹å™¨çš„åå­—\n\n```Shell\n#æŸ¥çœ‹æ‰€æœ‰å®¹å™¨åå­—\ndocker ps -a --format {{.Names}}\n```\n\n### dockerç”Ÿæˆé•œåƒï¼ˆæ— ç›®å½•æ˜ å°„ï¼‰\n\n```PowerShell\ndocker commit id/å®¹å™¨å é•œåƒå\n\n# ç”Ÿæˆå¸¦æœ‰æäº¤ä¿¡æ¯ä¸ä½œè€…çš„é•œåƒ\ndocker commit -m \"æäº¤ä¿¡æ¯\" -a \"ä½œè€…\" id/å®¹å™¨å é•œåƒå\n#æŸ¥çœ‹æäº¤ä¿¡æ¯ä¸ä½œè€…\n docker inspect --format 'æäº¤ä¿¡æ¯:{{.Comment}},  ä½œè€…:{{.Author}}' é•œåƒå\n```\n\nå¯¹æœ‰ç›®å½•/æ–‡ä»¶æ˜ å°„çš„å®¹å™¨çš„å¤„ç†\n\né’ˆå¯¹æ˜ å°„äº†å®¿ä¸»æœºçš„æ–‡ä»¶/ç›®å½•çš„å®¹å™¨ï¼Œåœ¨æ‰“åŒ…æˆé•œåƒæ—¶ï¼Œæ˜ å°„æ–‡ä»¶/ç›®å½•å¹¶ä¸ä¼šè¢«æ‰“åŒ…è¿›å»ã€‚\n\né’ˆå¯¹è¿™ç§æƒ…å†µæä¾›ä¸¤ç§è§£å†³æ–¹æ¡ˆï¼š\n\n1.å…ˆç”Ÿæˆé•œåƒæ–‡ä»¶ï¼Œå†ç”¨æ–°ç”Ÿæˆçš„é•œåƒåˆ›å»ºä¸€ä¸ªå®¹å™¨ï¼Œå°†åŸæ¥çš„æ˜ å°„ç›®å½•/æ–‡ä»¶æ‹·è´è¿›å®¹å™¨åå†æ‰“åŒ…ï¼Œæœ€åå°±ä¼šå½¢æˆä¸€ä¸ªå¸¦æœ‰æºç›®å½•é•œåƒæ–‡ä»¶ã€‚\n\n```Shell\ndocker cp è¦æ‹·è´çš„æ–‡ä»¶æˆ–ç›®å½• å®¹å™¨IDæˆ–å®¹å™¨åç§°:è¦æ‹·è´åˆ°çš„å®¹å™¨å†…éƒ¨ä½ç½®\n```\n\n2.å¯¹å¤–æä¾›é•œåƒæ—¶ï¼ŒæŠŠæ˜ å°„æ–‡ä»¶ä¸€èµ·æä¾›å‡ºå»ã€‚å½“è¿è¡Œé•œåƒæ—¶ï¼ŒæŒ‡å®šæ˜ å°„å…³ç³»ã€‚\n\n### å¯¼å‡ºé•œåƒä¸ºå‹ç¼©åŒ…\n\n```Shell\ndocker save -o /home/é•œåƒå.tar é•œåƒå:latest\n```\n\n### å°†é•œåƒå.tarå¯¼å…¥ä¸ºé•œåƒ\n\n```Shell\n# å¯¼å…¥æ–¹æ³•ä¸€\ndocker load --input /home/skj.tar\n# å¯¼å…¥æ–¹æ³•äºŒ\n$ docker load -i /home/skj.tar\n# å¯¼å…¥æ–¹æ³•ä¸‰\n$ docker load < /home/skj.tar\n```\n\n### è¿è¡Œdocker composeæ–‡ä»¶ï¼Œåˆ›å»ºç›¸å…³å®¹å™¨\n\n```PowerShell\ndocker compose -f docker-compose-XXXXXXX.yml up -d\n```\n\nåˆ›å»ºdocker composeæ–‡ä»¶æ—¶ï¼Œè¦ä½¿ç”¨å·²ç»å­˜åœ¨çš„ç½‘ç»œï¼Œä¹¦å†™è„šæœ¬ç½‘ç»œå†…å®¹çš„å‘½ä»¤å¦‚ä¸‹ï¼š\n\n```Shell\nnetworks:\n  ç½‘ç»œåç§°:\n    external: true\n```\n\n### Docker å‘½ä»¤è¡¥å…¨\n\n```Shell\n curl -L https://raw.githubusercontent.com/docker/composcompose > /etc/bash_completion.d/docker-compose\n #é‡æ–°ç™»å½•\n bash\n```\n\n### Docker ä¸€é”®å®‰è£…\n\nDocker é•œåƒæº\n\n```Bash\n  \"registry-mirrors\": [\n    \"https://registry.docker-cn.com\",\n    \"http://hub-mirror.c.163.com\",\n    \"https://dockerhub.azk8s.cn\",\n    \"https://mirror.ccs.tencentyun.com\",\n    \"https://registry.cn-hangzhou.aliyuncs.com\",\n    \"https://docker.mirrors.ustc.edu.cn\",\n    \"https://docker.m.daocloud.io\",\n    \"https://noohub.ru\",\n    \"https://huecker.io\",\n    \"https://dockerhub.timeweb.cloud\"\n  ]\n```\n\n#### æ–¹å¼ä¸€ï¼šcentos\n\n```Shell\n#ä½¿ç”¨å®˜æ–¹è„šæœ¬è‡ªåŠ¨å®‰è£…,é»˜è®¤å®‰è£…æœ€æ–°ç‰ˆ\ncurl -fsSL https://get.docker.com | bash -s docker --mirror Aliyun\n\nsystemctl start docker\nsystemctl enable docker\n\n#è®¾ç½®å­˜å‚¨åº“å®‰è£…\nsudo yum install -y yum-utils\n#å®˜æ–¹æº\nsudo yum-config-manager --add-repo https://download.docker.com/linux/centos/docker-ce.repo\n#é˜¿é‡Œæºï¼ˆæ¨èï¼‰\nyum-config-manager --add-repo http://mirrors.aliyun.com/docker-ce/linux/centos/docker-ce.repo\nsudo yum install -y docker-ce docker-ce-cli containerd.io docker-buildx-plugin docker-compose-plugin\n```\n\n#### æ–¹å¼äºŒï¼šopenEuler 22.03 (LTS-SP2)éç®¡ç†å‘˜\n\n```Shell\n#!/bin/bash\n#############æè¿°#############\n:<<!\nå®‰è£…Docker CEï¼Œè®¾ç½®å¼€æœºè‡ªå¯\nä¿®æ”¹dockerå­˜å‚¨è·¯å¾„\n!\n#############æè¿°#############\necho \"[docker-ce-stable]\nname=Docker CE Stable - $basearch\nbaseurl=https://repo.huaweicloud.com/docker-ce/linux/centos/7/$basearch/stable\nenabled=1\ngpgcheck=1\ngpgkey=https://repo.huaweicloud.com/docker-ce/linux/centos/gpg\n\n[docker-ce-stable-debuginfo]\nname=Docker CE Stable - Debuginfo $basearch\nbaseurl=https://repo.huaweicloud.com/docker-ce/linux/centos/7/debug-$basearch/stable\nenabled=0\ngpgcheck=1\ngpgkey=https://repo.huaweicloud.com/docker-ce/linux/centos/gpg\n\n[docker-ce-stable-source]\nname=Docker CE Stable - Sources\nbaseurl=https://repo.huaweicloud.com/docker-ce/linux/centos/7/source/stable\nenabled=0\ngpgcheck=1\ngpgkey=https://repo.huaweicloud.com/docker-ce/linux/centos/gpg\n\n[docker-ce-test]\nname=Docker CE Test - $basearch\nbaseurl=https://repo.huaweicloud.com/docker-ce/linux/centos/7/$basearch/test\nenabled=0\ngpgcheck=1\ngpgkey=https://repo.huaweicloud.com/docker-ce/linux/centos/gpg\n\n[docker-ce-test-debuginfo]\nname=Docker CE Test - Debuginfo $basearch\nbaseurl=https://repo.huaweicloud.com/docker-ce/linux/centos/7/debug-$basearch/test\nenabled=0\ngpgcheck=1\ngpgkey=https://repo.huaweicloud.com/docker-ce/linux/centos/gpg\n\n[docker-ce-test-source]\nname=Docker CE Test - Sources\nbaseurl=https://repo.huaweicloud.com/docker-ce/linux/centos/7/source/test\nenabled=0\ngpgcheck=1\ngpgkey=https://repo.huaweicloud.com/docker-ce/linux/centos/gpg\n\n[docker-ce-nightly]\nname=Docker CE Nightly - $basearch\nbaseurl=https://repo.huaweicloud.com/docker-ce/linux/centos/7/$basearch/nightly\nenabled=0\ngpgcheck=1\ngpgkey=https://repo.huaweicloud.com/docker-ce/linux/centos/gpg\n\n[docker-ce-nightly-debuginfo]\nname=Docker CE Nightly - Debuginfo $basearch\nbaseurl=https://repo.huaweicloud.com/docker-ce/linux/centos/7/debug-$basearch/nightly\nenabled=0\ngpgcheck=1\ngpgkey=https://repo.huaweicloud.com/docker-ce/linux/centos/gpg\n\n[docker-ce-nightly-source]\nname=Docker CE Nightly - Sources\nbaseurl=https://repo.huaweicloud.com/docker-ce/linux/centos/7/source/nightly\nenabled=0\ngpgcheck=1\ngpgkey=https://repo.huaweicloud.com/docker-ce/linux/centos/gpg\n\" > /etc/yum.repos.d/docker-ce.repo\n\nyum install container-selinux\nyum install -y docker-ce docker-ce-cli containerd.io docker-compose-plugin --nogpgcheck --nobest\n#å¯åŠ¨dockerå¹¶è®¾ç½®å¼€æœºè‡ªå¯\nsystemctl start docker\nsystemctl enable docker\n#æŸ¥çœ‹ç‰ˆæœ¬\ndocker -v\ndocker compose version\necho \"***********************\ndocker å®‰è£…æˆåŠŸ\n***********************\"\n\nmkdir -p /data/dockerData\n#/data/dockerä¸ºå­˜å‚¨æ–°è·¯å¾„\necho '\n{\n  \"data-root\": \"/data/dockerData\"\n}' > /etc/docker/daemon.json\nsystemctl restart docker\necho \"dockerçš„å­˜å‚¨ä½ç½®æ”¹ä¸º/data/dockerData\"\n```\n\n#### æ–¹å¼ä¸‰ï¼šopenEuler 22.03 (LTS-SP2)ç®¡ç†å‘˜\n\n```Shell\n#!/bin/bash\n#############æè¿°#############\n:<<!\nå®‰è£…Docker CEï¼Œè®¾ç½®å¼€æœºè‡ªå¯\nä¿®æ”¹dockerå­˜å‚¨è·¯å¾„\n!\n#############æè¿°#############\n\n#é…ç½®Docker CEçš„yumå­˜å‚¨åº“\necho \"[docker-ce-stable]\nname=Docker CE Stable - \\$basearch\nbaseurl=https://download.docker.com/linux/centos/7/\\$basearch/stable\nenabled=1\ngpgcheck=1\ngpgkey=https://download.docker.com/linux/centos/gpg\n\" > /etc/yum.repos.d/docker-ce.repo\n\nyum install container-selinux\nyum install -y docker-ce docker-ce-cli containerd.io docker-compose-plugin --nogpgcheck --nobest\n#å¯åŠ¨dockerå¹¶è®¾ç½®å¼€æœºè‡ªå¯\nsystemctl start docker\nsystemctl enable docker\n#æŸ¥çœ‹ç‰ˆæœ¬\ndocker -v\ndocker compose version\necho \"***********************\ndocker å®‰è£…æˆåŠŸ\n***********************\"\n\nmkdir -p /data/dockerData\n#/data/dockerä¸ºå­˜å‚¨æ–°è·¯å¾„\necho '\n{\n  \"data-root\": \"/data/dockerData\"\n}' > /etc/docker/daemon.json\nsystemctl restart docker\necho \"dockerçš„å­˜å‚¨ä½ç½®æ”¹ä¸º/data/dockerData\"\n```\n\n#### æ–¹å¼å››ï¼šopenEuler 20.03 (LTS)x86\n\n```Shell\n#å®‰è£…openEuleré•œåƒæº\nwget -O /etc/yum.repos.d/openEulerOS.repo https://repo.huaweicloud.com/repository/conf/openeuler_x86_64.repo\n#å®‰è£…ä¾èµ–è½¯ä»¶æº\nwget -O /etc/yum.repos.d/CentOS-Base.repo https://repo.huaweicloud.com/repository/conf/CentOS-7-reg.repo \n#\nsed -i 's/\\$releasever/7/g' /etc/yum.repos.d/CentOS-Base.repo\nyum clean all\nyum makecache\n```\n\n### dockerå®¹å™¨å‡ºç°æ— æ³•é‡å¯ï¼ŒæŠ¥é”™å†…å®¹å¦‚ä¸‹\n\n> Error response from daemon: Cannot restart container 66dd752e0bd4: id already in use\n\nè§£å†³æ–¹æ³•ï¼š\n\n```Bash\n#æŸ¥çœ‹å®¹å™¨ID\ndocker ps -a\n#æŸ¥çœ‹å®¹å™¨è¿›ç¨‹\nps -aux | grep å®¹å™¨ID\n#æ€æ‰è¿›ç¨‹\nkill -9 å®¹å™¨è¿›ç¨‹\n```\n\nå†æ¬¡å¯åŠ¨ï¼ŒæˆåŠŸï¼\n\n#### æ–¹å¼äº”ï¼šopenEuler 22.03 \n\n```Bash\nyum-config-manager --add-repo http://mirrors.aliyun.com/docker-ce/linux/centos/docker-ce.repo\nsed -i 's/\\$releasever/7/g' /etc/yum.repos.d/docker-ce.repo\n```\n\n### dockerå®¹å™¨å†…å‡ºç°æ— æ³•ä½¿ç”¨å®‰è£…é•œåƒæºçš„é—®é¢˜ï¼Œå¦‚ä¸‹å›¾\n\n![img](dockerçŸ¥è¯†æ¢³ç†/1711208367091-1-1711208371676-4.png)\n\nåœ¨/etc/docker/daemon.jsonæ–‡ä»¶ä¸­é…ç½®DNSå³å¯è§£å†³\n\n```Shell\nvi /etc/docker/daemon.json\n{\n \"dns\": [\"8.8.8.8\", \"114.114.114.114\"]\n }\n```\n\n### æ‹‰å–`gcr.io` , `k8s.gcr.io` , `registry.k8s.io` , `quay.io`, `ghcr.io`å®˜æ–¹é•œåƒè„šæœ¬\n\næ–¹å¼ä¸€ï¼š\n\n> wget https://raw.githubusercontent.com/anjia0532/gcr.io_mirror/master/pull-k8s-image.sh chmod +x pull-k8s-image.sh\n\n```Shell\nvi pull-images.sh\n###########################################3\n#!/bin/sh\n\nk8s_img=$1\nmirror_img=$(echo ${k8s_img}|\n        sed 's/quay\\.io/anjia0532\\/quay/g;s/ghcr\\.io/anjia0532\\/ghcr/g;s/registry\\.k8s\\.io/anjia0532\\/google-containers/g;s/k8s\\.gcr\\.io/anjia0532\\/google-containers/g;s/gcr\\.io/anjia0532/g;s/\\//\\./g;s/ /\\n/g;s/anjia0532\\./anjia0532\\//g' |\n        uniq)\n\nif [ -x \"$(command -v docker)\" ]; then\n  sudo docker pull ${mirror_img}\n  sudo docker tag ${mirror_img} ${k8s_img}\n  exit 0\nfi\n\nif [ -x \"$(command -v ctr)\" ]; then\n  sudo ctr -n k8s.io image pull docker.io/${mirror_img}\n  sudo ctr -n k8s.io image tag docker.io/${mirror_img} ${k8s_img}\n  exit 0\nfi\n\necho \"command not found:docker or ctr\"\n###############################################\nchmod +x pull-images.sh\n#æ‰§è¡Œæ ¼å¼\n./pull-images.sh  é•œåƒå\n```\n\næ–¹å¼äºŒï¼š\n\nhttps://dockerproxy.com/\n\n### dockerçš„ iptables ç­–ç•¥\n\n```Shell\n#æ˜¾ç¤ºDOCKER-USERçš„é“¾ä¸­çš„è§„åˆ™ä¿¡æ¯\niptables -nL DOCKER-USER\n# åœ¨ä¸»æœº10.10.3.117æ‰§è¡Œå¦‚ä¸‹å‘½ä»¤ï¼š(ens192 ä¸ºæœ¬æœºç½‘å¡ï¼Œä»¥å®é™…ä¸ºå‡†)\n#ç¦æ­¢æ‰€æœ‰IPè®¿é—®dockerçš„80ç«¯å£\niptables -I DOCKER-USER -i ens192 -p tcp --dport 80 -j DROP\n#åªå…è®¸10.10.3.122è®¿é—®dockerçš„80ç«¯å£\niptables -I DOCKER-USER -i ens192 -s 10.10.3.122 -p tcp --dport 80 -j ACCEPT\n#åˆ é™¤DOCKER-USERçš„é“¾ä¸­çš„é»˜è®¤è§„åˆ™\niptables -D DOCKER-USER -j RETURN\n#ä¿å­˜DOCKER-USERç­–ç•¥\nservice iptables save\n#è®¾ç½®iptableså¼€æœºè‡ªå¯,ä½¿ç­–ç•¥æ°¸ä¹…ç”Ÿæ•ˆ\nsystemctl enable iptables.service\n#æˆ–è€…\n/etc/rc.d/init.d/iptables save\n```\n\n### å®¹å™¨ä¸­æŸ¥çœ‹ç«¯å£æ–¹æ³•\n\nåœ¨å®¹å™¨ä¸­æ— éœ€ä¸‹è½½å·¥å…·æŸ¥çœ‹ç«¯å£æ˜¯å¦å¼€æ”¾ï¼Œå¦‚æœè¿æ¥æˆåŠŸï¼Œå‘½ä»¤å°†æ— ä»»ä½•è¾“å‡ºè€Œç»“æŸã€‚å¦‚æœè¿æ¥å¤±è´¥ï¼Œå°†ä¼šè¾“å‡ºé”™è¯¯æ¶ˆæ¯ã€‚\n\n```\nprintf \"\" > /dev/tcp/IPåœ°å€/ç«¯å£å·\n```\n\næŸ¥çœ‹å®¹å™¨è‡ªå·±çš„3000ç«¯å£å·æ˜¯å¦å¼€å¯\n\nprintf \"\" > /dev/tcp/localhost/3000\n\næŸ¥çœ‹å…¶ä»–å®¹å™¨ï¼ˆ172.20.101.23ï¼‰çš„5030ç«¯å£å·æ˜¯å¦å¼€å¯\n\nprintf \"\" > /dev/tcp/172.20.101.23/5030\n\n> bash: connect: Connection refused\n>\n> bash: /dev/tcp/172.20.101.23/5030: Connection refused","tags":["æ€»ç»“","è¿ç»´","çŸ¥è¯†æ¢³ç†","Linux","docker"],"categories":["å®¹å™¨åŒ–","docker","æ¢³ç†æ€»ç»“","çŸ¥è¯†æ¢³ç†"]},{"title":"KubernetesçŸ¥è¯†æ¢³ç†","url":"/yyg/f5a7a3df/","content":"\n### Kubernetesé›†ç¾¤YAMLæ–‡ä»¶è¯¦è§£\n\nä½¿ç”¨ kubectl createå‘½ä»¤ç”Ÿæˆyamlæ–‡ä»¶\n\n```\nkubectl create deployment web --image=nginx -o yaml --dry-run\n```\n\nè¾“å‡ºåˆ°ä¸€ä¸ªæ–‡ä»¶ä¸­\n\n```\nkubectl create deployment web --image=nginx -o yaml --dry-run > my.yaml\n```\n\nä½¿ç”¨kubectl getå‘½ä»¤å¯¼å‡ºyamlæ–‡ä»¶\n\n```\nkubectl get deploy nginx -o=yaml --export > nginx.yaml\n```\n\n### å‡çº§ Kubernetes é›†ç¾¤\n\nmasterèŠ‚ç‚¹\n\n```Shell\n#æŸ¥çœ‹kubeadmå‘è¡Œç‰ˆæœ¬\nyum list --showduplicates kubeadm --disableexcludes=kubernetes\n#ä¸‹è½½kubeadmæœ€æ–°ç‰ˆ\nyum install -y kubeadm-1.28.0 --disableexcludes=kubernetes \n#éªŒè¯å‡çº§è®¡åˆ’\nkubeadm upgrade plan\n#æ‹‰å–å›½å†…é•œåƒ\nkubeadm config images pull --image-repository registry.aliyuncs.com/google_containers\n#é€‰æ‹©è¦å‡çº§åˆ°çš„ç›®æ ‡ç‰ˆ\nkubeadm upgrade apply v1.28.0\n#æˆåŠŸæç¤º\n[upgrade/successful] SUCCESS! Your cluster was upgraded to \"v1.28.0\". Enjoy!\n[upgrade/kubelet] Now that your control plane is upgraded, please proceed with upgrading your kubelets if you haven't already done so.\n\n#å‡çº§kubelet å’Œ kubectl\n#ä¸‹è½½kubelet å’Œ kubectlæœ€æ–°ç‰ˆ\nyum install -y kubelet-1.28.0 kubectl-1.28.0 --disableexcludes=kubernetes\n#é‡å¯ kubelet\nsudo systemctl daemon-reload\nsudo systemctl restart kubelet\n\n#æŸ¥çœ‹ç‰ˆæœ¬\n kubeadm version\n kubelet --version\n kubectl version\n```\n\nnodeèŠ‚ç‚¹\n\n```Shell\n#ä¸‹è½½kubeadmæœ€æ–°ç‰ˆ\nyum install -y kubeadm-1.28.0 --disableexcludes=kubernetes\n#å‡çº§æœ¬åœ°çš„ kubelet é…ç½®\nkubeadm upgrade node\n[upgrade] The configuration for this node was successfully updated!\n[upgrade] Now you should go ahead and upgrade the kubelet package using your package manager.\n\n#å‡çº§kubelet å’Œ kubectl\n#ä¸‹è½½kubelet å’Œ kubectlæœ€æ–°ç‰ˆ\nyum install -y kubelet-1.28.0 kubectl-1.28.0 --disableexcludes=kubernetes\n#é‡å¯ kubelet\nsudo systemctl daemon-reload\nsudo systemctl restart kubelet\n\n#æŸ¥çœ‹ç‰ˆæœ¬\n kubeadm version\n kubelet --version\n kubectl version\n```\n\n### å®šæ—¶æ›´æ–°Dashboardç™»å½•token\n\n```Shell\n#!/bin/bash\n#############æè¿°#############\n:<<!\nå®šæ—¶ç”ŸæˆDashboardç™»å½•tokenï¼Œæœ‰æ•ˆæœŸ24å°æ—¶\n!\n#############æè¿°#############\n\ntoken=$(/usr/bin/kubectl -n kubernetes-dashboard create token admin-user)\necho \"\n#######################################################\n$(date)ç”Ÿæˆæ–°çš„Dashboardç™»å½•tokenï¼Œæœ€æ–°tokenå¦‚ä¸‹ï¼š\n#######################################################\n$token\" > /root/dashboard/admin-user.token\n```\n\n### Dashboardé…ç½®ingress-nginxä»£ç†\n\n```Shell\napiVersion: networking.k8s.io/v1\nkind: Ingress\nmetadata:\n  name: k8s-dashboard\n  namespace: kubernetes-dashboard\n  labels:\n    ingress: k8s-dashboard\n  annotations:\n    nginx.ingress.kubernetes.io/rewrite-target: /  #é‡å†™è·¯å¾„\n    nginx.ingress.kubernetes.io/ssl-redirect: \"true\"  #httpè‡ªåŠ¨è½¬https\n    nginx.ingress.kubernetes.io/use-regex: \"true\"\n    nginx.ingress.kubernetes.io/backend-protocol: \"HTTPS\"\nspec:\n  ingressClassName: nginx \n  rules:\n    - host: k8s.yjs.51xueweb.cn\n      http:\n        paths:\n          - path: /\n            pathType: Prefix\n            backend:\n              service:\n                name: kubernetes-dashboard\n                port:\n                  number: 443\n```\n\n### nodeèŠ‚ç‚¹NotReadyé—®é¢˜çš„å¤„ç†\n\n![image-20240323232551958](KubernetesçŸ¥è¯†æ¢³ç†/image-20240323232551958-1711207555524-1.png)\n\né‡æ–°åŠ å…¥nodeå³å¯\n\n```Shell\nkubeadm token create --print-join-command > join-command.txt\ncat join-command.txt\n```\n\n### ingress-nginxæ§åˆ¶å™¨å®‰è£…\n\n```Shell\n#ä¸‹è½½yamlæ–‡ä»¶\nwget https://gitcode.net/mirrors/kubernetes/ingress-nginx/-/blob/master/deploy/static/provider/baremetal/deploy.yaml\n\n#ä¿®æ”¹yamlæ–‡ä»¶ä¸­æ‹‰å–é•œåƒçš„åœ°å€\n#####################ä¿®æ”¹å†…å®¹######################\nregistry.cn-hangzhou.aliyuncs.com/google_containers/kube-webhook-certgen:v20230407\nregistry.cn-hangzhou.aliyuncs.com/google_containers/nginx-ingress-controller:v1.8.1\n#####################ä¿®æ”¹å†…å®¹######################\n#å®‰è£…\nkubectl apply -f deploy.ymal\n#æŸ¥çœ‹çŠ¶æ€\nkubectl get pods -n ingress-nginx\n################çŠ¶æ€##################\nNAME                                       READY   STATUS      RESTARTS   AGE\ningress-nginx-admission-create-2lz4v       0/1     Completed   0          5m46s\ningress-nginx-admission-patch-c6896        0/1     Completed   0          5m46s\ningress-nginx-controller-7575fb546-q29qn   1/1     Running     0          5m46s\n\n#ä¿®æ”¹yamlæ–‡ä»¶\nåœ¨Deploymentç±»ä¸­åŠ å…¥å‰¯æœ¬\n####################ä¿®æ”¹å†…å®¹####################\napiVersion: apps/v1\nkind: Deployment\nmetadata:\n  labels:\n    app.kubernetes.io/component: controller\n    app.kubernetes.io/instance: ingress-nginx\n    app.kubernetes.io/name: ingress-nginx\n    app.kubernetes.io/part-of: ingress-nginx\n    app.kubernetes.io/version: 1.8.1\n  name: ingress-nginx-controller\n  namespace: ingress-nginx\nspec:\n  replicas: 2\n  minReadySeconds: 0\n  revisionHistoryLimit: 10\n  selector:\n    matchLabels:\n      app.kubernetes.io/component: controller\n      app.kubernetes.io/instance: ingress-nginx\n      app.kubernetes.io/name: ingress-nginx\n```\n\n### k8s ä½¿ç”¨ nfs ç½‘ç»œå­˜å‚¨æŒ‚è½½\n\n```Shell\n#åœ¨é›†ç¾¤æ‰€æœ‰èŠ‚ç‚¹å®‰è£…nfs\nyum -y install nfs-utils\n#åˆ›å»º nfs ç›®å½•å¹¶ä¿®æ”¹æƒé™\nmkdir /data\nchmod -R 777  /data\necho \"/data 10.12.10.32(insecure,rw,sync,no_root_squash) 10.12.10.33(insecure,rw,sync,no_root_squash) 10.12.10.34(insecure,rw,sync,no_root_squash) 10.12.10.35(insecure,rw,sync,no_root_squash)\" >> /etc/exports\n#ä½¿é…ç½®ç”Ÿæ•ˆ\nexportfs -r\nexportfs \n#å¯åŠ¨rpcbindã€nfsæœåŠ¡\nsystemctl restart rpcbind && systemctl enable rpcbind\nsystemctl restart nfs-server && systemctl enable nfs-server\n#æŸ¥çœ‹ RPC æœåŠ¡çš„æ³¨å†ŒçŠ¶å†µ\n rpcinfo -p localhost\n #æ”¾è¡Œé˜²ç«å¢™ç«¯å£\n  firewall-cmd --add-port=2049/tcp --permanent\n   firewall-cmd --add-port=2049/udp --permanent\n   firewall-cmd --reload\n   firewall-cmd --list-all \n æµ‹è¯•æ˜¯å¦æ­£å¸¸æä¾› nfs ç›®å½•\n showmount -e åˆ›å»ºç›®å½•çš„ä¸»æœºip\n #å°†10.12.10.31çš„å…±äº«ç›®å½•æŒ‚è½½åˆ°å…¶ä»–ä¸»æœº\n  mount -t nfs 10.12.10.31:/data data\n```\n\nåˆ›å»ºPV\n\n```Shell\napiVersion: v1\nkind: PersistentVolume\nmetadata:\n  name: nfs-pv\n  namespace: nfs-test\n  labels:\n    pv: nfs-pv\nspec:\n  capacity:\n    storage: 5000Mi\n  accessModes:\n    - ReadWriteMany\n  persistentVolumeReclaimPolicy: Retain\n  storageClassName: nfs\n  nfs:\n    server: 10.12.10.31  #åˆ›å»ºç›®å½•çš„ä¸»æœºip\n    path: \"/data\"\n```\n\nåˆ›å»ºpvc\n\n```Shell\napiVersion: v1\nkind: PersistentVolumeClaim\nmetadata:\n  name: nfs-pvc\n  namespace: nfs-test\nspec:\n  accessModes:\n    - ReadWriteMany\n  resources:\n    requests:\n      storage: 5000Mi  #å®¹é‡\n  selector:\n    matchLabels:\n      pv: nfs-pv   #å…³è”pv\n```\n\n###  k8så‘½ä»¤è‡ªåŠ¨è¡¥å…¨\n\n```Shell\nyum -y install bash-completion\nsource /usr/share/bash-completion/bash_completion\necho 'source <(kubectl completion bash)' >>  ~/.bashrc\n```","tags":["æ€»ç»“","è¿ç»´","k8s","çŸ¥è¯†æ¢³ç†","Linux"],"categories":["å®¹å™¨åŒ–","k8s","æ¢³ç†æ€»ç»“"]},{"title":"dockeréƒ¨ç½²zabbix6.4æŒ‡å—","url":"/yyg/6d91d852/","content":"## ä»»åŠ¡ç›®æ ‡\n\n1. åœ¨ä¸»æœºä¸€ä¸Šå®Œæˆdockeréƒ¨ç½²zabbix6.4\n2. åœ¨ä¸»æœºäºŒä¸Šå®‰è£…zabbix-agent2\n3. ä½¿ç”¨ä¸»æœºä¸€ä¸Šçš„zabbixå®¹å™¨ç›‘æ§ä¸»æœºäºŒçš„å®¹å™¨ç­‰ä¸šåŠ¡\n\n## ä»»åŠ¡å¹³å°\n\n1. ç‰©ç†è®¾å¤‡--\n2. æ“ä½œç³»ç»Ÿï¼šCentOS 7\n\n## éƒ¨ç½²æŒ‡å—\n\n### ä»»åŠ¡ ä¸€\n\n1. å®‰è£…dockerï¼ˆæœ€æ–°ç‰ˆï¼‰\n\n```Shell\n#ä¸‹è½½å¹¶å®‰è£…dockeræ–‡ä»¶åŠä¾èµ–\nyum install -y yum-utils\nyum-config-manager --add-repo https://download.docker.com/linux/centos/docker-ce.repo\nyum install -y docker-ce docker-ce-cli containerd.io\n#å¯åŠ¨dockerå¹¶è®¾ç½®å¼€æœºè‡ªå¯\nsystemctl start docker  \nsystemctl enable docker\n#æŸ¥çœ‹ç‰ˆæœ¬\ndocker -v\n```\n\n1. é…ç½®é˜²ç«å¢™æ‰€éœ€çš„å¼€æ”¾ç«¯å£\n\n```Shell\n# æ”¾è¡Œnginxç«¯å£\nfirewall-cmd --zone=public --add-port=80/tcp --permanent\n# æ”¾è¡Œzabbix agentç«¯å£\nfirewall-cmd --zone=public --add-port=10050/tcp --permanent\n# æ”¾è¡Œzabbix serverç«¯å£\nfirewall-cmd --zone=public --add-port=10051/tcp --permanent\n# æ”¾è¡Œzabbix java gatewayç«¯å£\nfirewall-cmd --zone=public --add-port=10052/tcp --permanent\n# æ”¾è¡Œmysqlç«¯å£\nfirewall-cmd --zone=public --add-port=3306/tcp --permanent\n# æ”¾è¡Œsnmptrapsç«¯å£\nfirewall-cmd --zone=public --add-port=162/udp --permanent\n# é‡è½½é˜²ç«å¢™\nfirewall-cmd --reload\n#æŸ¥çœ‹80ç«¯å£æ˜¯å¦å¼€æ”¾\nfirewall-cmd --query-port=80/tcp\n#æŸ¥çœ‹æ‰€æœ‰æ”¾è¡Œçš„ç«¯å£\nfirewall-cmd --zone=public --list-ports\n```\n\n1. æ‹‰å–zabbixæ‰€éœ€é•œåƒæ–‡ä»¶\n\n```Shell\n#æ‹‰å–å®‰è£…zabbixéœ€è¦çš„dockeré•œåƒ\ndocker pull mysql:8.0\ndocker pull zabbix/zabbix-java-gateway:alpine-6.4-latest\ndocker pull zabbix/zabbix-server-mysql:alpine-6.4-latest\ndocker pull zabbix/zabbix-web-nginx-mysql:alpine-6.4-latest\n```\n\n1. åˆ›å»ºä¸“ç”¨äºZabbixç»„ä»¶å®¹å™¨ç½‘ç»œä¸æ‰€éœ€å®¹å™¨\n\n#### æ–¹æ¡ˆä¸€ï¼š\n\n```Shell\n#åˆ›å»ºä¸“ç”¨äºZabbixç»„ä»¶å®¹å™¨çš„ç½‘ç»œ\ndocker network create --subnet 172.20.0.0/16 --ip-range 172.20.240.0/20 zabbix-net\n\n#å¯åŠ¨ç©ºçš„MySQæœåŠ¡å™¨å®ä¾‹\ndocker run --name mysql-server -t \\\n      -e MYSQL_DATABASE=\"zabbix\" \\\n      -e MYSQL_USER=\"zabbix\" \\\n      -e MYSQL_PASSWORD=\"123456\" \\\n      -e MYSQL_ROOT_PASSWORD=\"123456\" \\\n      --network=zabbix-net \\\n      --restart=always \\\n      -d mysql:8.0 \\\n      --character-set-server=UTF8MB4 --collation-server=UTF8MB4_bin \\\n      --authentication_policy=mysql_native_password\n\n#å¯åŠ¨Zabbix Javaç½‘å…³å®ä¾‹      \ndocker run --name zabbix-java-gateway -t \\\n      --network=zabbix-net \\\n      --restart unless-stopped \\\n      -d zabbix/zabbix-java-gateway:alpine-6.4-latest\n\n#å¯åŠ¨ZabbixæœåŠ¡å™¨å®ä¾‹å¹¶å°†å®ä¾‹ä¸åˆ›å»ºçš„MySQLæœåŠ¡å™¨å®ä¾‹é“¾æ¥      \ndocker run --name zabbix-server-mysql -t \\\n      -e DB_SERVER_HOST=\"mysql-server\" \\\n      -e MYSQL_DATABASE=\"zabbix\" \\\n      -e MYSQL_USER=\"zabbix\" \\\n      -e MYSQL_PASSWORD=\"123456\" \\\n      -e MYSQL_ROOT_PASSWORD=\"123456\" \\\n      -e ZBX_JAVAGATEWAY=\"zabbix-java-gateway\" \\\n      --network=zabbix-net \\\n      -p 10051:10051 \\\n      --restart unless-stopped \\\n      -d zabbix/zabbix-server-mysql:alpine-6.4-latest\n\n#å¯åŠ¨Zabbix Webç•Œé¢ï¼Œå¹¶å°†å®ä¾‹ä¸åˆ›å»ºçš„MySQLæœåŠ¡å™¨å’ŒZabbixæœåŠ¡å™¨å®ä¾‹é“¾æ¥\ndocker run --name zabbix-web-nginx-mysql -t \\\n      -e ZBX_SERVER_HOST=\"zabbix-server-mysql\" \\\n      -e DB_SERVER_HOST=\"mysql-server\" \\\n      -e MYSQL_DATABASE=\"zabbix\" \\\n      -e MYSQL_USER=\"zabbix\" \\\n      -e MYSQL_PASSWORD=\"123456\" \\\n      -e MYSQL_ROOT_PASSWORD=\"123456\" \\\n      --network=zabbix-net \\\n      -p 80:8080 \\\n      --restart unless-stopped \\\n      -d zabbix/zabbix-web-nginx-mysql:alpine-6.4-latest\n```\n\n#### æ–¹æ¡ˆäºŒï¼šï¼ˆæ¨èä½¿ç”¨ï¼‰\n\n```Shell\n#å¯åŠ¨ç©ºçš„MySQæœåŠ¡å™¨å®ä¾‹\ndocker run --name mysql-server -t \\\n      -e MYSQL_DATABASE=\"zabbix\" \\\n      -e MYSQL_USER=\"zabbix\" \\\n      -e MYSQL_PASSWORD=\"123456\" \\\n      -e MYSQL_ROOT_PASSWORD=\"123456\" \\\n      --restart=always \\\n      -d mysql:8.0 \\\n      --character-set-server=UTF8MB4 --collation-server=UTF8MB4_bin \\\n      --authentication_policy=mysql_native_password\n\n#å¯åŠ¨Zabbix Javaç½‘å…³å®ä¾‹      \ndocker run --name zabbix-java-gateway -t \\\n      --restart unless-stopped \\\n      -d zabbix/zabbix-java-gateway:alpine-6.4-latest\n\n#å¯åŠ¨ZabbixæœåŠ¡å™¨å®ä¾‹å¹¶å°†å®ä¾‹ä¸åˆ›å»ºçš„MySQLæœåŠ¡å™¨å®ä¾‹é“¾æ¥      \ndocker run --name zabbix-server-mysql -t \\\n      -e DB_SERVER_HOST=\"mysql-server\" \\\n      -e MYSQL_DATABASE=\"zabbix\" \\\n      -e MYSQL_USER=\"zabbix\" \\\n      -e MYSQL_PASSWORD=\"123456\" \\\n      -e MYSQL_ROOT_PASSWORD=\"123456\" \\\n      -e ZBX_JAVAGATEWAY=\"zabbix-java-gateway\" \\\n      --link mysql-server:mysql \\\n      --link zabbix-java-gateway:zabbix-java-gateway \\\n      -p 10051:10051 \\\n      --restart unless-stopped \\\n      -d zabbix/zabbix-server-mysql:alpine-6.4-latest\n\n#å¯åŠ¨Zabbix Webç•Œé¢ï¼Œå¹¶å°†å®ä¾‹ä¸åˆ›å»ºçš„MySQLæœåŠ¡å™¨å’ŒZabbixæœåŠ¡å™¨å®ä¾‹é“¾æ¥\ndocker run --name zabbix-web-nginx-mysql -t \\\n      -e ZBX_SERVER_HOST=\"zabbix-server-mysql\" \\\n      -e DB_SERVER_HOST=\"mysql-server\" \\\n      -e MYSQL_DATABASE=\"zabbix\" \\\n      -e MYSQL_USER=\"zabbix\" \\\n      -e MYSQL_PASSWORD=\"123456\" \\\n      -e MYSQL_ROOT_PASSWORD=\"123456\" \\\n      --link mysql-server:mysql \\\n      --link zabbix-server-mysql:zabbix-server \\\n      -p 80:8080 \\\n      --restart unless-stopped \\\n      -d zabbix/zabbix-web-nginx-mysql:alpine-6.4-latest\n```\n\n1. åœ¨å…¶ä¸­ä¸€å°çš„ä¸»æœºçš„/etc/docker/daemon.jsonæ–‡ä»¶ä¸­ï¼ŒåŠ å…¥å¦‚ä¸‹å†…å®¹ï¼š\n\n```Shell\n#æ‰“å¼€daemon.jsonæ–‡ä»¶\nvi /etc/docker/daemon.json\n\n#æ·»åŠ çš„å†…å®¹\n{\n \"bip\": \"172.16.200.1/24\"\n}\n\n#é‡å¯dockeræœåŠ¡\nsystemctl restart docker \n```\n\n### ä»»åŠ¡äºŒ\n\nåœ¨ä¸»æœºäºŒä¸Šå®‰è£…zabbix-agent2\n\nåœ¨è¦ç›‘æ§çš„ä¸»æœºä¸Šå®‰è£…zabbix agent2\n\næ­¥éª¤1ï¼šZabbix agent2ä¸‹è½½\n\n{% link Zabbix agent2ä¸‹è½½, https://www.zabbix.com/documentation/6.4/manual/installation/install_from_packages %}\n\n```Shell\nrpm -Uvh https://repo.zabbix.com/zabbix/6.4/rhel/7/x86_64/zabbix-release-6.4-1.el7.noarch.rpm\nyum clean all\n```\n\næ­¥éª¤2ï¼šb. ä¸‹è½½Zabbix agent2\n\n```Shell\nyum install zabbix-agent2 zabbix-agent2-plugin-* -y\n```\n\næ­¥éª¤3ï¼šå¯åŠ¨Zabbix agent2\n\nStart Zabbix agent2 process and make it start at system boot.\n\n```Shell\nsystemctl restart zabbix-agent2\nsystemctl enable zabbix-agent2\n```\n\nè¿è¡ŒæˆåŠŸç•Œé¢å¦‚ä¸‹\n\n![img](dockeréƒ¨ç½²zabbix6.4æŒ‡å—/1711208128881-1.png)\n\n![img](dockeréƒ¨ç½²zabbix6.4æŒ‡å—/1711208138487-4-1711208142767-7.png)\n\n### å®‰è£…æŠ¥é”™æ€»ç»“\n\n1. \n\n![img](dockeréƒ¨ç½²zabbix6.4æŒ‡å—/1711208157423-9.png)\n\nè¿›å…¥mysqlå®¹å™¨ï¼Œè¾“å…¥ä»¥ä¸‹å‘½ä»¤.\n\n```Shell\n#è¿›å…¥sqlç•Œé¢\nmysql -u root -p\n#è¾“å…¥è¯¥å‘½ä»¤ï¼Œè§£å†³é—®é¢˜\ncreate database zabbix character set utf8 collate utf8_bin;\nSET GLOBAL log_bin_trust_function_creators = 1;\n```\n\n1. å®‰è£…zabbixå‡ºç°ä¸‹å›¾æƒ…å†µè§£å†³æ–¹æ³•\n\n![img](dockeréƒ¨ç½²zabbix6.4æŒ‡å—/1711208164924-12.png)\n\n{% link æ•…éšœå¤„ç†,https://blog.csdn.net/ly4983/article/details/111029506 %}\n\n### æ‰©å±•-docker-composeéƒ¨ç½²zabbix\n\n```yaml\nservices:\n  zabbix-db-mysql:\n    image: mysql:9.0.1\n    container_name: zabbix-db-mysql\n    restart: always\n    environment:\n      - MYSQL_DATABASE=zabbix\n      - MYSQL_USER=zabbix\n      - MYSQL_PASSWORD=zabbix@123\n      - MYSQL_ROOT_PASSWORD=zabbix@123\n      - TZ=Asia/Shanghai\n    command: [\"--character_set_server=utf8mb4\", \"--collation_server=utf8mb4_bin\"]\n    volumes:\n      - /data/database/zabbix-mysql:/var/lib/mysql\n    user: \"0\"\n    ports:\n      - 3306:3306\n    networks:\n      zabbix:\n        ipv4_address: 172.20.20.10\n\n  zabbix-java-gateway:\n    image: zabbix/zabbix-java-gateway:latest\n    container_name: zabbix-java-gateway\n    restart: always\n    environment:\n      - TZ=Asia/Shanghai\n    user: \"0\"\n    networks:\n      zabbix:\n        ipv4_address: 172.20.20.11\n\n  zabbix-server-mysql:\n    image:  zabbix/zabbix-server-mysql:latest\n    container_name: zabbix-server-mysql\n    restart: always\n    environment:\n      - DB_SERVER_HOST=zabbix-db-mysql\n      - MYSQL_DATABASE=zabbix\n      - MYSQL_USER=zabbix\n      - MYSQL_PASSWORD=zabbix@123\n      - MYSQL_ROOT_PASSWORD=zabbix@123\n      - ZBX_JAVAGATEWAY=zabbix-java-gateway\n      - TZ=Asia/Shanghai\n    user: \"0\"\n    ports:\n      - 10051:10051\n    networks:\n      zabbix:\n        ipv4_address: 172.20.20.12\n\n  zabbix-web-nginx-mysql:\n    image:  zabbix/zabbix-web-nginx-mysql:latest\n    container_name: zabbix-web-nginx-mysql\n    restart: always\n    environment:\n      - ZBX_SERVER_HOST=zabbix-server-mysql\n      - DB_SERVER_HOST=zabbix-db-mysql\n      - MYSQL_DATABASE=zabbix\n      - MYSQL_USER=zabbix\n      - MYSQL_PASSWORD=zabbix@123\n      - MYSQL_ROOT_PASSWORD=zabbix@123\n      - ZBX_JAVAGATEWAY_ENABLE=true\n      - ZBX_JAVAGATEWAYPORT=10052\n      - PHP_TZ=Asia/Shanghai\n    user: \"0\"\n    ports:\n      - 80:8080\n    networks:\n      zabbix:\n        ipv4_address: 172.20.20.13\n\n  zabbix-agent:\n    image: zabbix/zabbix-agent:latest\n    container_name: zabbix-agent\n    restart: always\n    environment:\n      - TZ=Asia/Shanghai\n      - ZBX_SERVER_HOST=172.20.20.12\n      - ZBX_HOSTNAME=Zabbix server\n    user: \"0\"\n    ports:\n      - 10050:10050\n    networks:\n      zabbix:\n        ipv4_address: 172.20.20.14\n\nnetworks:\n zabbix:\n  driver: bridge\n  ipam:\n   config:\n    - subnet: 172.20.20.0/24\n```\n\n","tags":["docker","zabbix"],"categories":["å®¹å™¨åŒ–","Linuxè¿ç»´","docker","ç›‘æ§"]},{"title":"shellè„šæœ¬","url":"/yyg/d0a69eae/","content":"\n## ç§æœ‰é•œåƒä»“åº“ç›¸å…³è„šæœ¬\n\n```Shell\n#ç­¾åç¯å¢ƒå‡†å¤‡\nyum install -y golang\nmkdir -p /data/cosign\ncd /data/cosign\n#x86\nwget https://github.com/sigstore/cosign/releases/download/v2.2.2/cosign-2.2.2-1.x86_64.rpm\nrpm -ivh cosign-2.2.2-1.x86_64.rpm\n#arm\nwget https://github.com/sigstore/cosign/releases/download/v2.2.2/cosign-2.2.2-1.aarch64.rpm\nrpm -ivh cosign-2.2.2-1.aarch64.rpm\n#éªŒè¯å®‰è£…\ncosign version\n#ç”Ÿæˆå¯†é’¥ï¼Œè¿›è¡Œç­¾å\ncosign generate-key-pair\n```\n\næ›´æ”¹æ ‡ç­¾ã€æ¨é€é•œåƒå¹¶å¯¹é•œåƒç­¾åè„šæœ¬\n\n```Shell\nvi hub-docker.sh && chmod +x hub-docker.sh\n#!/bin/bash\n#############æè¿°#############\n:<<!\n1ã€ä¿®æ”¹é•œåƒæ ‡ç­¾\n2ã€æ¨é€é•œåƒåˆ°ç§æœ‰ä»“åº“\n3ã€ç»™å·²æ¨é€çš„é•œåƒç­¾å\n!\n#############æè¿°#############\nexport COSIGN_PASSWORD=ç§æœ‰ä»“åº“ç”¨æˆ·å¯†ç \n\n#ç™»å½•\necho \"ç™»å½•dockerç§æœ‰ä»“åº“ï¼Œè¯·è¾“å…¥å¯†ç ï¼š\"\ndocker login ç§æœ‰ä»“åº“åŸŸå  -u ç”¨æˆ·å\n\n\nread -p \"è¯·è¾“å…¥è¦æ¨é€çš„é¡¹ç›®åº“åç§°:\" pj_name\n#æ¨é€ä»“åº“åœ°å€\nhostname=ç§æœ‰ä»“åº“åŸŸå\n\necho \"\n*************************************************************\nè¾“å…¥è¦æ±‚ï¼šæ¯è¡Œè¡¨ç¤ºä¸€ä¸ªåŸé•œåƒåä¸æ–°é•œåƒåï¼ŒåŸé•œåƒåä¸æ–°é•œåƒåä¹‹é—´ä»¥ç©ºæ ¼åˆ†éš”\nç¤ºä¾‹æ ¼å¼ï¼š\nnginx:latest nginx:1.0\nhttpd:2.5 httpd:1.0.0\nè¯·åˆ†åˆ«è¾“å…¥è¦æ¨é€çš„åŸé•œåƒåä¸æ–°é•œåƒå,\nè¾“å…¥å®Œæˆåå…ˆå›è½¦ã€å†æŒ‰Ctrl+Dç»“æŸï¼š\n*************************************************************\"\n#åŸé•œåƒåæ•°ç»„\nlist_old_images=()\n#æ–°é•œåƒåæ•°ç»„\nlist_new_images=()\n#è¡Œæ•°\nline_number=0\nwhile IFS= read -r line; do\n    # æ‹†åˆ†æ¯è¡Œä¸ºä¸¤ä¸ªå…ƒç´ \n    read -r old_images new_images <<< \"$line\"\n    list_old_images+=(\"$old_images\")\n    list_new_images+=(\"$new_images\")\n    ((line_number++))\ndone\nfor ((line_number_1=0; line_number_1 < line_number; line_number_1++)); do\n   #ä¿®æ”¹é•œåƒæ ‡ç­¾\n   docker tag ${list_old_images[$line_number_1]} $hostname/$pj_name/${list_new_images[$line_number_1]}\n   #æ¨é€åˆ°ç§æœ‰ä»“åº“\n   docker push $hostname/$pj_name/${list_new_images[$line_number_1]}\n   #è¿›è¡Œé•œåƒç­¾å\n   yes | cosign sign  --allow-insecure-registry --key /data/cosign/cosign.key $hostname/$pj_name/${list_new_images[$line_number_1]}\ndone\n#å»é™¤å¯†é’¥å¯†ç \nunset COSIGN_PASSWORD\n#éªŒè¯æŸ¥çœ‹\nenv\n#é€‰æ‹©æ˜¯å¦ç™»å‡ºç§æœ‰ä»“åº“\nread -p \"æ˜¯å¦è¦ç™»å‡ºdockerç§æœ‰ä»“åº“ã€y(Y),n(N)ã€‘:\" choice \nif  [[ $choice  == \"y\" || $choice  == \"Y\" ]];then\n     docker logout hub-docker.tiliatech.net\nelif [[ $choice  == \"n\" || $choice  == \"N\" ]];then\n     echo \"æ³¨æ„ï¼šè¿˜æœªç™»å‡ºdockerç§æœ‰ä»“åº“\"\nelse\n     echo \"è¯·è¾“å…¥æ­£ç¡®çš„é€‰é¡¹ã€y(Y),n(N)ã€‘\"\nfi\necho -e \"**************************\n\\033[35mé•œåƒå·²æ¨é€å®Œæˆ\nå…±$line_numberä¸ª\\033[m\n**************************\"\n```\n\n## ç›®å½•å¤‡ä»½è„šæœ¬\n\n### éœ€æ±‚ä¸€ï¼š\n\n> å†™ä¸€ä¸ªå¤‡ä»½ç›®å½•çš„è„šæœ¬ï¼Œéœ€è¦çš„è€ƒè™‘çš„åŠŸèƒ½æœ‰å“ªäº›ï¼Ÿ\n>\n> 1.  æŒ‡å®šç›®å½•çš„è·¯å¾„ï¼Œä½œä¸ºå˜é‡dirè¿›è¡Œå®šä¹‰\n> 2.  æŒ‡å®šå¤‡ä»½æ–‡ä»¶çš„æ–‡ä»¶åå’Œè·¯å¾„ï¼Œä½œä¸ºå˜é‡filename,file_pathè¿›è¡Œå®šä¹‰ï¼Œä½¿ç”¨æ—¶é—´æˆ³ä½œä¸ºæ ‡è¯†ã€‚æ—¶é—´æˆ³å®ç°å¹´æœˆæ—¥æ—¶åˆ†ç§’æ¯«ç§’            ä¸¾ä¾‹ï¼šfilename-20231216150913678.tar.gz\n> 3. å°†è¾“å…¥çš„å˜é‡dirã€filenameã€file_pathä¿å­˜åˆ°dir_file.txtæ–‡ä»¶ä¸­ï¼ˆä¾¿äºä¹‹åæ‰§è¡Œå®šæ—¶ä»»åŠ¡æ—¶ï¼Œè¯»å–è¦å¤‡ä»½çš„ç›®å½•ï¼‰\n> 4.  å¯¹ç›®å½•è¿›è¡Œæ‰“åŒ…å’Œå‹ç¼©ï¼Œå‹ç¼©ä½¿ç”¨gzipç®—æ³•\n> 5.  å¤‡ä»½å®Œæˆåè¾“å‡ºæ—¥å¿—ï¼Œæ—¥å¿—è·¯å¾„ï¼š/var/log/back.log.0\n> 6.  å¤‡ä»½å®Œæˆååˆ é™¤nå¤©å‰çš„å¤‡ä»½æ–‡ä»¶ï¼Œnä½œä¸ºå˜é‡\n> 7. æ‰§è¡Œå†™å…¥å®šæ—¶ä»»åŠ¡ï¼Œæ¯å¤©å®šæ—¶æ›´æ–°ä¸€æ¬¡ï¼ˆé»˜è®¤2ç‚¹ï¼‰\n\n#### æ–¹æ³•ä¸€ï¼š\n\n```Shell\nvi bak.sh && chmod +x bak.sh\n#!/bin/bash\nconfig_file=\"/home/dir_file.txt\"\n#åˆ¤æ–­å­˜å‚¨å˜é‡çš„txtæ˜¯å¦å­˜åœ¨\nif [ -e $config_file ]; then\n    echo \"/home/dir_file.txtå­˜åœ¨\"\n    source /home/dir_file.txt\n    sudomkdir -p $dir\nfi\nline_number=0\necho \"$dateè¾“å…¥å¤‡ä»½æ–‡ä»¶çš„æ–‡ä»¶åä¸è·¯å¾„\" >> /var/log/back.log.0\nwhile IFS= read -r line; do\n    # æ‹†åˆ†æ¯è¡Œä¸ºä¸¤ä¸ªå…ƒç´ \n    read -r filename file_path <<< \"$line\"\n    list_filename+=(\"$filename\")\n    list_file_path+=(\"$file_path\")\n    ((line_number++))\ndone < /home/file.txt\necho \"$dateå¤‡ä»½æ–‡ä»¶çš„æ–‡ä»¶åä¸è·¯å¾„ä¿å­˜åˆ°/home/file.txt\" >> /var/log/back.log.0\n#å®šä¹‰æ—¶é—´æ ¼å¼\nDAY=$(date +\"%Y%m%d\")\nTIME=$(date +\"%H%M%S%N\")\n# å¤‡ä»½æ–‡ä»¶è®¡æ•°å™¨\nfolder_count=0\nfor ((line_number_1=0; line_number_1 < line_number; line_number_1++)); do\n  sudo tar -zcvf $dir/${list_filename[$line_number_1]}-$DAY$TIME.tar.gz  ${list_file_path[$line_number_1]}  | tee -a  /var/log/back.log.0\n   ((folder_count++))\n  echo \"$date ${list_file_path[$line_number_1]}å·²å®Œæˆå‹ç¼©,\n        å‹ç¼©æ–‡ä»¶çš„å…·ä½“ä½ç½®ä¸º:${list_filename[$line_number_1]}-$DAY$TIME.tar.gz\" >> /var/log/back.log.0\ndone\n#åˆ é™¤nå¤©å‰çš„å½’æ¡£æ–‡ä»¶\ndel_day=$(date -d \"-$n day\" +%Y%m%d)\nsudo rm -f $dir/*-$del_day*.tar.gz\necho  \"$dateåˆ é™¤del_dayçš„å¤‡ä»½æ–‡ä»¶\" >> /var/log/back.log.0\necho -e \"\n***********************\n\\033[35m$del_dayæ–‡ä»¶å·²åˆ é™¤\n$DAY$TIMEæ–‡ä»¶å·²å¤‡ä»½\n$DAY$TIMEå·²å¤‡ä»½æ€»æ•°: $folder_count\\033[m\n***********************\" | tee -a  /var/log/back.log.0\n```\n\nåœ¨/homeç›®å½•ä¸‹åˆ›å»ºä¸¤ä¸ªtxtæ–‡ä»¶ï¼Œåˆ†åˆ«å¦‚ä¸‹ï¼š\n\n```Shell\ntouch /home/file.txt /home/dir_file.txt\n```\n\n/home/file.txt\n\n```Shell\n#è¦å¤‡ä»½æ–‡ä»¶çš„æ–‡ä»¶åä¸è·¯å¾„\nsvn-http /data/svn-http\ntest-svn /data/test-svn\n```\n\n/home/dir_file.txt\n\n```Shell\n#å¤‡ä»½ç›®å½•çš„è·¯å¾„\ndir=/home/bak\n#åˆ é™¤nå¤©å‰çš„å½’æ¡£æ–‡ä»¶\nn=3\n```\n\n#### æ–¹æ³•äºŒï¼š\n\n```Shell\n#!/bin/bash\nconfig_file=\"/home/dir_file.txt\"\n#åˆ¤æ–­å­˜å‚¨å˜é‡çš„txtæ˜¯å¦å­˜åœ¨\nif [ ! -e $config_file ]; then\n    touch /home/dir_file.txt /home/file.txt\n    read -p \"è¯·è¾“å…¥å¤‡ä»½ç›®å½•çš„è·¯å¾„:\" dir\n       echo \"dir=$dir\" > /home/dir_file.txt\n    read -p \"è¯·è¾“å…¥è¦åˆ é™¤å¤‡ä»½æ–‡ä»¶å…·ä½“å¤©æ•°ï¼ˆ1è¡¨ç¤º:1å¤©å‰ï¼‰:\" n\n        echo \"n=$n\" >> /home/dir_file.txt\n    echo \"è¯·åˆ†åˆ«è¾“å…¥è¦å¤‡ä»½æ–‡ä»¶çš„æ–‡ä»¶åä¸è·¯å¾„:\n     *************************************************************\n      è¾“å…¥è¦æ±‚ï¼šæ¯è¡Œè¡¨ç¤ºä¸€ä¸ªå¤‡ä»½æ–‡ä»¶çš„æ–‡ä»¶åä¸è·¯å¾„ï¼Œå¤‡ä»½æ–‡ä»¶çš„æ–‡ä»¶åä¸è·¯å¾„ä¹‹é—´>ä»¥ç©ºæ ¼åˆ†éš”\n      ç¤ºä¾‹æ ¼å¼ï¼š\n          test /data/test\n          docker /data/docker\n\n      è¾“å…¥å®Œæˆåå…ˆå›è½¦ã€å†æŒ‰Ctrl+Dç»“æŸï¼š\n      *************************************************************\"\n      #å¤‡ä»½æ–‡ä»¶çš„æ–‡ä»¶å\n      list_filename=()\n      #è·¯å¾„\n      list_file_path=()\n    cat > /home/file.txt\nelse\n    echo \"/home/dir_file.txtå­˜åœ¨\"\n    source $config_file\n    mkdir -p $dir\nfi\n\nline_number=0\necho \"$dateè¾“å…¥å¤‡ä»½æ–‡ä»¶çš„æ–‡ä»¶åä¸è·¯å¾„\" >> /var/log/back.log.0\nwhile IFS= read -r line; do\n    # æ‹†åˆ†æ¯è¡Œä¸ºä¸¤ä¸ªå…ƒç´ \n    read -r filename file_path <<< \"$line\"\n    list_filename+=(\"$filename\")\n    list_file_path+=(\"$file_path\")\n    ((line_number++))\ndone < /home/file.txt\necho \"$dateå¤‡ä»½æ–‡ä»¶çš„æ–‡ä»¶åä¸è·¯å¾„ä¿å­˜åˆ°/home/file.txt\" >> /var/log/back.log.0\n#å®šä¹‰æ—¶é—´æ ¼å¼\nDAY=$(date +\"%Y%m%d\")\nTIME=$(date +\"%H%M%S%N\")\n# å¤‡ä»½æ–‡ä»¶è®¡æ•°å™¨\nfolder_count=0\nfor ((line_number_1=0; line_number_1 < line_number; line_number_1++)); do\n  tar -zcvf $dir/${list_filename[$line_number_1]}-$DAY$TIME.tar.gz  ${list_file_path[$line_number_1]}  | tee -a  /var/log/back.log.0\n   ((folder_count++))\n  echo \"$date ${list_file_path[$line_number_1]}å·²å®Œæˆå‹ç¼©,\n        å‹ç¼©æ–‡ä»¶çš„å…·ä½“ä½ç½®ä¸º:${list_filename[$line_number_1]}-$DAY$TIME.tar.gz\" >> /var/log/back.log.0\ndone\n#åˆ é™¤nå¤©å‰çš„å½’æ¡£æ–‡ä»¶\ndel_day=$(date -d \"-$n day\" +%Y%m%d)\nrm -f $dir/*-$del_day*.tar.gz\necho  \"$dateåˆ é™¤del_dayçš„å¤‡ä»½æ–‡ä»¶\" >> /var/log/back.log.0\necho -e \"\n***********************\n\\033[35m$del_dayæ–‡ä»¶å·²åˆ é™¤\n$DAY$TIMEæ–‡ä»¶å·²å¤‡ä»½\n$DAY$TIMEå·²å¤‡ä»½æ€»æ•°: $folder_count\\033[m\n***********************\" | tee -a  /var/log/back.log.0\n```\n\n### éœ€æ±‚äºŒï¼š\n\n> ä½¿ç”¨è„šæœ¬è¿›è¡ŒLinux ç›®å½•å¤‡ä»½çš„åŸºæœ¬è¦æ±‚\n>\n> 1. å‘½åè§„èŒƒï¼šæ—¶é—´æˆ³-å•ä½åç§°-backup-IPåœ°å€/32-ä¸šåŠ¡åç§°.tar.gz\n> 2. å¤‡ä»½å‘¨æœŸï¼šæ¯å‘¨ä¸€æ—©ä¸Š1-3ç‚¹ï¼Œä¿ç•™ä¸‰ä¸ªæœ‰æ•ˆå¤‡ä»½\n> 3. å¤‡ä»½å‰æ£€æµ‹ï¼šåŒæ—¶å‡ºç°ä¸‹è¿°æƒ…å†µï¼Œåˆ™è·³è¿‡æ­¤æ¬¡å¤‡ä»½ä»»åŠ¡\n>\n> - du -s å¤‡ä»½ç›®å½•å–å¾—çš„å€¼å’Œä¸Šæ¬¡ç›¸åŒ\n> - ç›®å½•ä¸‹çš„æ–‡ä»¶æœ€åä¸€æ¬¡æ›´æ–°æ—¶é—´ã€å¤‡ä»½æ—¶é—´æ˜¯ä¸Šæ¬¡æ‰§è¡Œæ—¶é—´\n> - ä¸Šæ¬¡å¤‡ä»½æ˜¯æˆåŠŸçš„\n>\n> 1. æ—¥å¿—è®°å½•ï¼šä¸‹è¿°æƒ…å†µè®°å½•æ—¥å¿—ã€æ—¥å¿—æè¿°è¦è§„èŒƒ\n>\n> - å¤‡ä»½å®Œæˆ\n> - å¤‡ä»½å¤±è´¥\n> - å¤‡ä»½ä»»åŠ¡è·³è¿‡\n> - åˆ é™¤å¤‡ä»½æ–‡ä»¶\n> - åˆ é™¤å¤‡ä»½æ–‡ä»¶å¤±è´¥\n>\n> 1. å¤‡ä»½æ•°æ®å­˜æ¡£è¦æ±‚ï¼š\n>\n> - å­˜å‚¨ä¸‰ä¸ªå¤‡ä»½æ–‡ä»¶\n> - å­˜å‚¨çš„å¤‡ä»½æ–‡ä»¶è¦åšå“ˆå¸Œæ ¡éªŒï¼Œæ¢å¤æ—¶è¿›è¡ŒéªŒè¯ï¼Œå“ˆå¸Œæ ¡éªŒå€¼å­˜å¤‡ä»½æ—¥å¿—\n\n```Shell\nvi backup.sh && chmod +x backup.sh\n#!/bin/bash\n#############æè¿°#############\n:<<!\nå¤‡ä»½ç›®å½•è„šæœ¬\næ¯å‘¨ä¸€æ—©ä¸Š1-3ç‚¹æ‰§è¡Œï¼Œä¿ç•™ä¸‰ä¸ªæœ‰æ•ˆå¤‡ä»½\n!\n#############æè¿°#############\n#é…ç½®å­˜å‚¨æ–‡æœ¬\nconfigFile=\"/home/dirFile.txt\"\n#å¤‡ä»½ç›®å½•ä¸è·¯å¾„å­˜å‚¨æ–‡æœ¬\nlistFile=\"/home/file.txt\"\n\n#åˆ¤æ–­å­˜å‚¨å˜é‡çš„txtæ˜¯å¦å­˜åœ¨\nif [ ! -e \"$configFile\" ] || [ ! -e \"$listFile\" ] ; then\n    sudo touch $configFile $listFile\n    read -p \"è¯·è¾“å…¥å­˜æ”¾å¤‡ä»½æ–‡ä»¶çš„è·¯å¾„:\" dir\n    echo \"#å­˜æ”¾å¤‡ä»½æ–‡ä»¶çš„è·¯å¾„\" > $configFile\n    echo \"dir=$dir\" >> $configFile\n    read -p \"è¯·è¾“å…¥å•ä½åç§°:\" unitName\n    echo \"#å•ä½åç§°\" >> $configFile\n    echo \"unitName=$unitName\" >> $configFile\n    read -p \"è¯·è¾“å…¥IPåœ°å€:\" ipAdd\n    echo \"#IPåœ°å€\" >> $configFile\n    echo \"ipAdd=$ipAdd\" >> $configFile\n    read -p \"è¯·è¾“å…¥è¦ä¿ç•™å¤‡ä»½æ–‡ä»¶å‘¨æ•°ï¼ˆ1è¡¨ç¤º:ä¿ç•™è¿‘1å‘¨ï¼‰:\" n\n    echo \"#ä¿ç•™å¤‡ä»½æ–‡ä»¶å‘¨æ•°\" >> $configFile\n    echo \"n=$n\" >> $configFile\n    echo \"è¯·åˆ†åˆ«è¾“å…¥è¦å¤‡ä»½ç›®å½•åä¸è·¯å¾„:\n     *************************************************************\n      è¾“å…¥è¦æ±‚ï¼šæ¯è¡Œè¡¨ç¤ºä¸€ä¸ªå¤‡ä»½ç›®å½•ä¸è·¯å¾„ï¼Œå¤‡ä»½ç›®å½•åä¸è·¯å¾„ä¹‹é—´ä»¥ç©ºæ ¼åˆ†éš”\n      ç¤ºä¾‹æ ¼å¼ï¼š\n          test /data/test\n          docker /data/docker\n\n      è¾“å…¥å®Œæˆåå…ˆå›è½¦ã€å†æŒ‰Ctrl+Dç»“æŸï¼š\n      *************************************************************\"\n      #å¤‡ä»½æ–‡ä»¶çš„æ–‡ä»¶å\n      listFilename=()\n      #è·¯å¾„\n      listFilePath=()\n    cat > $listFile\nelse\n    source \"$configFile\"\nfi\n\n#ç»Ÿè®¡å¤‡ä»½ç›®å½•çš„æ•°é‡\nlineNumber=0\n#åˆ†åˆ«è¯»å–å¤‡ä»½ç›®å½•ä¸è·¯å¾„çš„å˜é‡ï¼Œå¹¶å†™å…¥æ•°ç»„\nwhile IFS= read -r line; do\n    # æ‹†åˆ†æ¯è¡Œä¸ºä¸¤ä¸ªå…ƒç´ \n    read -r filename filePath <<< \"$line\"\n    listFilename+=(\"$filename\")\n    listFilePath+=(\"$filePath\")\n    ((lineNumber++))\ndone < $listFile\n\n#å®šä¹‰æ—¶é—´æ ¼å¼\nDATE=$(date +\"%Y%m%d%H%M%S%N\")\nlogDate=${DATE:0:8}\nlastlogDate=$(date -d \"$logDate 7 days ago\" +\"%Y%m%d\")\n#è¾“å‡ºæ—¥å¿—æ—¶é—´æ ¼å¼\nprintLogDate=$(date +\"%Y-%m-%d %T\")\n#å®šä¹‰æ—¥å¿—è·¯å¾„\nlogDir=\"/var/log/backupDir\"\nlog=\"$logDir/$logDate-backup.log.0\"\nlastLog=\"$logDir/$lastlogDate-backup.log.0\"\n#è®¡æ•°å™¨\nfolderCount=0\n\nif [ ! -d \"$logDir\" ]; then\n    sudo mkdir -p $logDir\n    echo \"$logDirç›®å½•å·²åˆ›å»º\"\nfi\n\nfor ((lineNumber1=0; lineNumber1 < lineNumber; lineNumber1++)); do\n  # è®¡ç®—å¤‡ä»½ç›®å½•çš„å¤§å°\n  echo \"---------------------------------------------------------\" | sudo tee -a  \"$log\"\n  echo \"[$printLogDate] å¤‡ä»½ç›®å½•${listFilePath[$lineNumber1]}çš„å¤§å°å¦‚ä¸‹:\" >> \"$log\"\n  echo \"[$printLogDate] ${listFilePath[$lineNumber1]} = $(du -s \"${listFilePath[$lineNumber1]}\" | awk '{print $1}')\" >> \"$log\"\n  ###########################åˆ¤æ–­æ˜¯å¦ç¬¦åˆè·³è¿‡å¤‡ä»½æ¡ä»¶ï¼š###########################\n  #1ã€å¤‡ä»½ç›®å½•çš„å¤§å°å–å€¼å’Œä¸Šæ¬¡å¤‡ä»½ç›¸åŒ\n  #2ã€ç›®å½•ä¸‹çš„æ–‡ä»¶æœ€åä¸€æ¬¡æ›´æ–°æ—¶é—´æ˜¯ä¸Šæ¬¡æ‰§è¡Œæ—¶é—´ï¼ˆæ–‡ä»¶çš„æœ€æ–°æ—¶é—´å°äºä¸Šæ¬¡å¤‡ä»½çš„æ—¶é—´ï¼‰\n  #3ã€ä¸Šæ¬¡å¤‡ä»½æ˜¯æˆåŠŸçš„\n  ################################################################################\n  #ä¸Šæ¬¡å¤‡ä»½ç›®å½•çš„å¤§å°\n  lastDirSize=$(grep \"${listFilePath[$lineNumber1]} =\" \"$lastLog\" | awk '{print $5}')\n  #å¤‡ä»½å‰è¯»å–çš„å¤‡ä»½ç›®å½•çš„å¤§å°\n  dirSize=$(du -s \"${listFilePath[$lineNumber1]}\" | awk '{print $1}')\n  #ç›®å½•ä¸‹çš„æ–‡ä»¶æœ€åä¸€æ¬¡æ›´æ–°æ—¶é—´\n  lastUpdateTime=$(find \"${listFilePath[$lineNumber1]}\" -type f -printf '%TY%Tm%Td%TH%TM%.2TS %p\\n' | sort -r | head  -n 1 | awk '{print $1}')\n  #ä¸Šæ¬¡å¤‡ä»½çš„æ—¶é—´\n  lastBackupTime=$(grep \"${listFilename[$lineNumber1]}.tar.gz.*Hash\" \"$lastLog\" | head -n 1 | awk '{print substr($3, 1, 14)}')\n  #æ¯”å¯¹ä¸Šæ¬¡å¤‡ä»½æˆåŠŸçš„æ ‡å¿—å­—ç¬¦SUCCESS\n  lastSuccessFlag=$(grep \"backup ${listFilePath[$lineNumber1]}\" \"$lastLog\" | awk '{print $5}')\n  if [  \"$lastDirSize\" = \"$dirSize\"  ]  && [ \"$lastUpdateTime\" -le \"$lastBackupTime\" ]  && [ \"$lastSuccessFlag\" = \"SUCCESS\" ] ; then\n        echo \"[$printLogDate] ${listFilePath[$lineNumber1]}æ— æ•°æ®å˜åŒ–,è·³è¿‡æ­¤æ¬¡å¤‡ä»½ä»»åŠ¡\"  | sudo tee -a \"$log\"\n  else\n        echo \"[$printLogDate] å¼€å§‹å¯¹${listFilePath[$lineNumber1]}ç›®å½•è¿›è¡Œå¤‡ä»½...\"  | tee -a \"$log\"\n        tar -zcvf \"$dir/$DATE-$unitName-backup-$ipAdd-${listFilename[$lineNumber1]}.tar.gz\"  ${listFilePath[$lineNumber1]}\n        backupHash=$(md5sum \"$dir/$DATE-$unitName-backup-$ipAdd-${listFilename[$lineNumber1]}.tar.gz\" | awk '{print $1}')\n        echo \"[$printLogDate] $DATE-$unitName-backup-$ipAdd-${listFilename[$lineNumber1]}.tar.gzå·²ç”Ÿæˆ\" >> \"$log\"\n        echo \"[$printLogDate] $DATE-$unitName-backup-$ipAdd-${listFilename[$lineNumber1]}.tar.gzçš„Hashå€¼ä¸ºï¼š$backupHash\" >> \"$log\"\n        ((folderCount++))\n        echo \"[$printLogDate] å¤‡ä»½ç›®å½•${listFilePath[$lineNumber1]}å·²å®Œæˆå‹ç¼©,å‹ç¼©æ–‡ä»¶çš„å…·ä½“ä½ç½®ä¸º:$dir\" >> \"$log\"\n        echo \"[$printLogDate] backup ${listFilePath[$lineNumber1]} SUCCESS\"  | tee -a  \"$log\"\n  fi\n  #ä¿ç•™æœ€è¿‘næ¬¡å¤‡ä»½\n  if [ -n \"$( find \"$dir\" -maxdepth 1 -type f -name \"*${listFilename[$lineNumber1]}*.tar.gz\")\" ]\n  then\n      #æŒ‰æ—¶é—´é™åºæ’åˆ—\n      files=$(find $dir -name \"*${listFilename[$lineNumber1]}*.tar.gz\" -printf \"%T@\\t%p\\n\" | sort -rn | cut -f 2-)\n      # åˆå§‹åŒ–è®¡æ•°å™¨å’Œæ•°ç»„\n      count=0\n      declare -a filesKeep\n      # éå†æ–‡ä»¶å¹¶ä¿ç•™æœ€è¿‘çš„nä¸ª\n      while IFS= read -r file; do\n          if [ $count -lt $n ]; then\n              filesKeep[$count]=$file\n              count=$((count+1))\n          else\n              rm -f \"$file\"\n              echo \"[$printLogDate] åˆ é™¤æ— éœ€ä¿ç•™çš„å¤‡ä»½æ–‡ä»¶:$file\"  | sudo tee -a  \"$log\"\n          fi\n      done <<< \"$files\"\n  else\n      echo \"[$printLogDate] åˆ é™¤å¤±è´¥ï¼Œæœªæ‰¾åˆ°${listFilename[$lineNumber1]}çš„å¤‡ä»½æ–‡ä»¶\" | sudo tee -a  \"$log\"\n  fi\ndone\n\necho \"---------------------------------------------------------\" | sudo tee -a  \"$log\"\n\necho -e \"\\033[35m[$printLogDate] æ‰€æœ‰ç›®å½•å¤‡ä»½å®Œæˆ,å¤‡ä»½æ€»æ•°: $folderCount\\033[m\n---------------------------------------------------------\" | sudo tee -a  \"$log\"\n\n```\n\n```\n#å†™å…¥å®šæ—¶ä»»åŠ¡\necho '\n0 1 * * 1 root bash /data/script/backup.sh >> /var/log/backup.log\n' > /etc/cron.d/backup.cron\n\ncat /etc/cron.d/backup.cron\n```\n\n### shellè¾“å‡ºæœ‰é¢œè‰²çš„æç¤ºä¿¡æ¯\n\n```Shell\n#ä½¿ç”¨ä»¥ä¸‹ANSIè½¬ä¹‰åºåˆ—æ¥è®¾ç½®ä¸åŒçš„é¢œè‰²å’Œæ ·å¼\n\\033[30m - \\033[37mï¼šè®¾ç½®å‰æ™¯è‰²ä¸ºé»‘è‰²è‡³ç™½è‰²ã€‚\n\\033[40m - \\033[47mï¼šè®¾ç½®èƒŒæ™¯è‰²ä¸ºé»‘è‰²è‡³ç™½è‰²ã€‚\nå¸¸ç”¨çš„ANSIè½¬ä¹‰åºåˆ—ç¤ºä¾‹ï¼š\nè®¾ç½®æ–‡æœ¬é¢œè‰²ï¼š\n\\033[30mï¼šè®¾ç½®æ–‡æœ¬é¢œè‰²ä¸ºé»‘è‰²\n\\033[31mï¼šè®¾ç½®æ–‡æœ¬é¢œè‰²ä¸ºçº¢è‰²\n\\033[32mï¼šè®¾ç½®æ–‡æœ¬é¢œè‰²ä¸ºç»¿è‰²\n\\033[33mï¼šè®¾ç½®æ–‡æœ¬é¢œè‰²ä¸ºé»„è‰²\n\\033[34mï¼šè®¾ç½®æ–‡æœ¬é¢œè‰²ä¸ºè“è‰²\n\\033[35mï¼šè®¾ç½®æ–‡æœ¬é¢œè‰²ä¸ºæ´‹çº¢è‰²\n\\033[36mï¼šè®¾ç½®æ–‡æœ¬é¢œè‰²ä¸ºé’è‰²\n\\033[37mï¼šè®¾ç½®æ–‡æœ¬é¢œè‰²ä¸ºç™½è‰²\nè®¾ç½®èƒŒæ™¯é¢œè‰²ï¼š\n\\033[40mï¼šè®¾ç½®èƒŒæ™¯é¢œè‰²ä¸ºé»‘è‰²\n\\033[41mï¼šè®¾ç½®èƒŒæ™¯é¢œè‰²ä¸ºçº¢è‰²\n\\033[42mï¼šè®¾ç½®èƒŒæ™¯é¢œè‰²ä¸ºç»¿è‰²\n\\033[43mï¼šè®¾ç½®èƒŒæ™¯é¢œè‰²ä¸ºé»„è‰²\n\\033[44mï¼šè®¾ç½®èƒŒæ™¯é¢œè‰²ä¸ºè“è‰²\n\\033[45mï¼šè®¾ç½®èƒŒæ™¯é¢œè‰²ä¸ºæ´‹çº¢è‰²\n\\033[46mï¼šè®¾ç½®èƒŒæ™¯é¢œè‰²ä¸ºé’è‰²\n\\033[47mï¼šè®¾ç½®èƒŒæ™¯é¢œè‰²ä¸ºç™½è‰²\nè®¾ç½®æ–‡æœ¬æ ·å¼ï¼š\n\\033[0mï¼šé‡ç½®æ‰€æœ‰æ ·å¼ï¼ˆä¹Ÿå¯ä»¥å†™ä½œ\\033[mï¼‰\n\\033[1mï¼šè®¾ç½®ç²—ä½“\n\\033[2mï¼šè®¾ç½®æ¨¡ç³Šï¼ˆä¸æ˜¯æ‰€æœ‰ç»ˆç«¯éƒ½æ”¯æŒï¼‰\n\\033[3mï¼šè®¾ç½®æ–œä½“ï¼ˆä¸æ˜¯æ‰€æœ‰ç»ˆç«¯éƒ½æ”¯æŒï¼‰\n\\033[4mï¼šè®¾ç½®ä¸‹åˆ’çº¿\n\\033[5mï¼šè®¾ç½®é—ªçƒï¼ˆä¸æ˜¯æ‰€æœ‰ç»ˆç«¯éƒ½æ”¯æŒï¼‰\n\\033[7mï¼šè®¾ç½®åæ˜¾\n\\033[8mï¼šè®¾ç½®éšè—ï¼ˆä¸æ˜¯æ‰€æœ‰ç»ˆç«¯éƒ½æ”¯æŒï¼‰\n#ç»¿è‰²\necho -e \"\\033[1;32må®‰è£…æˆåŠŸï¼\\033[m\"\nprintf \"\\n\\033[1;32m%s\\033[m\\n\" \"ä»»åŠ¡å·²å®Œæˆ!\"\n#ç´«è‰²\nprintf \"\\033[1;35m%s\\033[m\\n\" \"é”™è¯¯ï¼šæ–‡ä»¶ä¸å­˜åœ¨ã€‚\"\necho -e \"\\033[1;35må®‰è£…å¤±è´¥ï¼\\033[m\"\n```\n\n### shellè„šæœ¬æ˜¾ç¤ºè‡ªå®šä¹‰è¿›åº¦æ¡\n\n```Shell\n# è®¾ç½®æ€»è¿›åº¦æ—¶é—´ï¼Œå•ä½ç§’\ntotal_steps=5\n\necho \"åŠ è½½è¿›åº¦å¦‚ä¸‹:\"\n# æ˜¾ç¤ºè¿›åº¦æ¡å‡½æ•°\nshow_progress() {\n    local current_step=$1\n    local total_steps=$2\n    local progress=$((current_step * 100 / total_steps))\n    local bar_length=50\n    local completed_length=$((progress * bar_length / 100))\n    local remaining_length=$((bar_length - completed_length))\n\n    printf \"[%-${bar_length}s] %d%%\\r\" \\\n        \"$(printf  '*%.0s' $(seq 1 $completed_length))\" \\\n        \"$progress\"\n}\n\n# å¾ªç¯å±•ç¤ºè¿›åº¦æ¡\nfor ((step=1; step<=total_steps; step++)); do\n    show_progress $step $total_steps\n    sleep 1  # æ¨¡æ‹Ÿä»»åŠ¡æ‰§è¡Œæ—¶é—´\ndone\n```\n\n### ç£ç›˜æ°¸ä¹…æŒ‚è½½è„šæœ¬\n\n```Shell\nvi disk.sh && chmod +x disk.sh\n#!/bin/bash\n#############æè¿°#############\n:<<!\nåœ¨æ ¹ç›®å½•åˆ›å»ºdataæ–‡ä»¶å¤¹ï¼Œå°†ç£ç›˜æŒ‚è½½åˆ°/data\n!\n#############æè¿°#############\nmkdir /data\n#æŸ¥çœ‹ç£ç›˜åˆ†åŒºæƒ…å†µï¼Œæ‰¾åˆ°è¦æŒ‚è½½çš„ç£ç›˜åç§°\nfdisk -l\n#åˆ—å‡ºå½“å‰ç³»ç»Ÿä¸­æ‰€æœ‰æŒ‚è½½çš„æ–‡ä»¶ç³»ç»Ÿ\ndf -l\nread -p \"è¯·è¾“å…¥éœ€è¦æ ¼å¼åŒ–çš„ç£ç›˜åç§°ï¼ˆå¦‚ï¼š/dev/sdbï¼‰ï¼š\" disk\n#æ ¼å¼åŒ–ç£ç›˜\nmkfs.ext4 $disk\n#å°†ç£ç›˜æŒ‚è½½åˆ°/data\nmount $disk /data\n#ä¿®æ”¹æ–‡ä»¶$diskï¼Œè®¾ç½®ä¸ºå¼€æœºè‡ªåŠ¨æŒ‚è½½\n#åœ¨æ–‡ä»¶ä¸­æ·»åŠ å¦‚ä¸‹å†…å®¹\necho \"$disk                /data                      ext4    defaults        0 0\" >>/etc/fstab\necho \"***********************\nç£ç›˜æ°¸ä¹…æŒ‚è½½å®Œæˆ\n***********************\"\nlsblk\n```\n\n### å®‰è£…dockerè„šæœ¬ï¼ˆopenEuler 22.03 LTS SP2ï¼‰\n\n```Shell\nvi docker.sh && chmod +x docker.sh\n#!/bin/bash\n#############æè¿°#############\n:<<!\nå®‰è£…Docker CEï¼Œè®¾ç½®å¼€æœºè‡ªå¯\nä¿®æ”¹dockerå­˜å‚¨è·¯å¾„\n!\n#############æè¿°#############\n\n#é…ç½®Docker CEçš„yumå­˜å‚¨åº“\necho \"[docker-ce-stable]\nname=Docker CE Stable - \\$basearch\nbaseurl=https://download.docker.com/linux/centos/7/\\$basearch/stable\nenabled=1\ngpgcheck=1\ngpgkey=https://download.docker.com/linux/centos/gpg\n\" > /etc/yum.repos.d/docker-ce.repo\n\nyum install -y container-selinux\nyum install -y docker-ce docker-ce-cli containerd.io docker-compose-plugin \n#å¯åŠ¨dockerå¹¶è®¾ç½®å¼€æœºè‡ªå¯\nsystemctl start docker\nsystemctl enable docker\n#æŸ¥çœ‹ç‰ˆæœ¬\ndocker -v\ndocker compose version\necho \"***********************\ndocker å®‰è£…æˆåŠŸ\n***********************\"\n\nmkdir -p /data/dockerData  \n#/data/dockerDataä¸ºå­˜å‚¨æ–°è·¯å¾„\necho '\n{\n  \"data-root\": \"/data/dockerData\"\n}' > /etc/docker/daemon.json\nsystemctl restart docker\n#è¡¥å…¨å‘½ä»¤\n curl -L https://raw.githubusercontent.com/docker/composcompose > /etc/bash_completion.d/docker-compose\n #é‡æ–°ç™»å½•\n bash\necho \"dockerçš„å­˜å‚¨ä½ç½®æ”¹ä¸º/data/dockerData\"\n```\n\n### å®‰è£…nginxè„šæœ¬\n\n```Shell\nvi nginx.sh && chmod +x nginx.sh\n#!/bin/bash\n#############æè¿°#############\n:<<!\nå®‰è£…nginxï¼Œå¹¶è®¾ç½®å¼€æœºè‡ªå¯\n!\n#############æè¿°#############\n\n#ä¸‹è½½nginx\n yum install -y nginx\n \n #å¯åŠ¨NginxæœåŠ¡ã€å¼€æœºè‡ªåŠ¨å¯åŠ¨\n systemctl start nginx\n systemctl enable nginx\n \n #å…è®¸ç«¯å£è¿›å‡ºé˜²ç«å¢™\n firewall-cmd --zone=public --add-port=80/tcp --permanent\n firewall-cmd --reload\n firewall-cmd --list-all\n echo \"***********************\n nginxå®‰è£…æˆåŠŸ\n ***********************\"\n```\n\n### æ–°å»ºç›®å½•ã€æ›´æ”¹dockerå­˜å‚¨ä½ç½®è„šæœ¬\n\n```Shell\n#!/bin/bash\n#############æè¿°#############\n:<<!\næ–°å»ºé¡¹ç›®æ‰€éœ€æ–‡ä»¶å¤¹\næ›´æ”¹dockerçš„å­˜å‚¨ä½ç½®\n!\n#############æè¿°#############\nmkdir /data\ncd /data\n#æ–°å»ºcodeæ–‡ä»¶å¤¹å­˜æ”¾æºä»£ç ã€logsæ–‡ä»¶å¤¹å­˜æ”¾æ—¥å¿—ã€scriptæ–‡ä»¶å¤¹å­˜æ”¾è„šæœ¬\nmkdir code  logs  script\n\n#åˆ†åˆ«è¿›å…¥ä¸‰ä¸ªæ–‡ä»¶å¤¹\n#åˆ›å»ºMAPPæ–‡ä»¶å¤¹å­˜æ”¾å¾®åº”ç”¨ç›¸å…³æ–‡ä»¶èµ„æº \n#åˆ›å»ºOSæ–‡ä»¶å¤¹å­˜æ”¾ä¸šåŠ¡ç³»ç»Ÿç›¸å…³æ–‡ä»¶èµ„æº\n\nmkdir code/mapp code/os logs/mapp logs/os script/mapp script/os \necho \"***********************\næ–°å»ºæ‰€éœ€ç›®å½•å®Œæˆ\n***********************\"\n\nmkdir -p /data/dockerData\n#/data/dockerDataä¸ºå­˜å‚¨æ–°è·¯å¾„\necho '\n{\n  \"data-root\": \"/data/dockerData\"\n}' > /etc/docker/daemon.json \nsystemctl restart docker\necho \"dockerçš„å­˜å‚¨ä½ç½®æ”¹ä¸º/data/dockerData\"\n```\n\n### æ‰¹é‡ä»£ç åŒæ­¥è„šæœ¬\n\n```Shell\nvi gitee-sync.sh && chmod +x gitee-sync.sh\n#!/bin/bash\n#############æè¿°#############\n:<<!\nåŒæ­¥æºä»£ç ï¼Œå¹¶ä¸”è®°å½•åŒæ­¥æ—¶é—´å’Œä¿¡æ¯åˆ°æ—¥å¿—æ–‡ä»¶\nå¹¶å®šæ—¶æ¯åˆ†é’Ÿè¿›è¡ŒåŒæ­¥ä»»åŠ¡\n!\n#############æè¿°#############\n# æŒ‡å®šç›®å½•è·¯å¾„\ndirectory=\"/data/code\"\n# å®šä¹‰åŒæ­¥æ—¥å¿—æ–‡ä»¶è·¯å¾„\nlog_file=\"/data/logs/gitee-sync.log\"\n# æ–‡ä»¶å¤¹è®¡æ•°å™¨\nfolder_count=0\n# è‡ªå®šä¹‰æ—¶é—´æ ¼å¼\nGIT_TIME=$(date +\"%Y-%m-%d %T\")\n# éå†ç›®å½•ä¸‹çš„æ–‡ä»¶å¤¹\nfor folder in \"$directory\"/*/; do\n  # è·å–æ–‡ä»¶å¤¹åç§°\n  folder_name=$(basename \"$folder\")\n  # å¢åŠ è®¡æ•°å™¨\n  ((folder_count++))\n\n  cd /data/code/$folder_name\n  #ä»£ç åŒæ­¥\n  git_check_result=`git pull origin master`\n  if  [[ $git_check_result =~ \"Already up to date.\" || $git_check_result =~ \"å·²ç»æ˜¯æœ€æ–°çš„ã€‚\" ]]\n  then\n    echo \"$GIT_TIMEã€Š$folder_nameã€‹skip\" | tee -a $log_file\n  else\n     echo -e \"$GIT_TIME \\033[1;32mã€Š$folder_nameã€‹update\\033[m\"  | tee -a $log_file\n  fi\ndone\n# è®°å½•åŒæ­¥æ—¶é—´å’Œä¿¡æ¯åˆ°æ—¥å¿—æ–‡ä»¶\necho -e \"\n****************************************\n\\033[35m$GIT_TIMEæ‰€æœ‰é¡¹ç›®å®Œæˆä»£ç åŒæ­¥\nå·²åŒæ­¥é¡¹ç›®æ€»æ•°: $folder_count\\033[m\n****************************************\n\" | tee -a $log_file\n```\n\nå†™å…¥å®šæ—¶ä»»åŠ¡\n\n```Shell\necho '\n* * * * * root bash /data/script/gitee-sync.sh >> /var/log/nginx/sync-code.log\n' > /etc/cron.d/gitee-sync.cron\n\ncat /etc/cron.d/gitee-sync.cron\n```\n\n### è‡ªå®šä¹‰å®šæ—¶å…³æœºè„šæœ¬\n\n```Shell\n#!/bin/bash\n##########è„šæœ¬æè¿°##########\n:<<!\næ­¤è„šæœ¬ä¸ºæœåŠ¡å™¨å®šæ—¶å…³æœºè„šæœ¬\nä¸”æ¯å¤©åœ¨å›ºå®šæ—¶é—´å¯è‡ªåŠ¨æ‰§è¡Œ\n!\n##########è„šæœ¬æè¿°##########\necho \"\n(*^_^*)æ¬¢è¿ä½¿ç”¨å®šæ—¶å…³æœºè„šæœ¬(*^_^*)\nè„šæœ¬é»˜è®¤æ‰§è¡Œæ—¶é—´æ˜¯10:00\né»˜è®¤å…³æœºæ—¶é—´æ˜¯22:30\n\"\necho \"è„šæœ¬æ‰§è¡Œæ—¶é—´æ ¼å¼å¦‚ä¸‹:(ç”¨ç©ºæ ¼éš”å¼€)\n1ã€è‹¥è®¾ç½®10:00æ‰§è¡Œï¼Œæ ¼å¼ï¼š10 0\n1ã€è‹¥è®¾ç½®10:08æ‰§è¡Œï¼Œæ ¼å¼ï¼š10 8\n2ã€è‹¥è®¾ç½®11:56æ‰§è¡Œï¼Œæ ¼å¼ï¼š11 56\"\nread -rp \"è¯·è¾“å…¥è„šæœ¬æ‰§è¡Œæ—¶é—´(å›è½¦ä½¿ç”¨é»˜è®¤æ—¶é—´)ï¼š\" execute_hours execute_minutes\necho \"\nå…³æœºæ—¶é—´æ ¼å¼å¦‚ä¸‹:(ç¬¦å·ä¸ºè‹±æ–‡çŠ¶æ€)\nè‹¥è®¾ç½®å…³æœºæ—¶é—´ä¸º10:00ï¼Œæ ¼å¼ï¼š10:00\"\nread -p \"è¯·è¾“å…¥å…³æœºæ—¶é—´(å›è½¦ä½¿ç”¨é»˜è®¤æ—¶é—´)ï¼š\" shutdown_time\necho \"\nå®šæ—¶å…³æœºè„šæœ¬å·²æ‰§è¡Œ\n\"\nif [ -z \"$execute_hours\" ] || [ -z \"$execute_hours\" ]; then\n  echo \"ä½¿ç”¨è„šæœ¬é»˜è®¤æ‰§è¡Œæ—¶é—´ï¼Œå³10:00\"\n  # å°†å½“å‰çš„ crontab å¯¼å‡ºåˆ° mycron æ–‡ä»¶ä¸­\n  crontab -l > mycron\n  # åœ¨ mycron æ–‡ä»¶ä¸­æ·»åŠ ä¸€è¡Œæ–°çš„å®šæ—¶ä»»åŠ¡\n  echo \"0 10 * * * /bin/bash /home/automatic-shutdown.sh\" > mycron\n  # å°†ä¿®æ”¹åçš„ mycron æ–‡ä»¶å¯¼å…¥åˆ° crontab ä¸­\n  crontab mycron\n  # åˆ é™¤ä¸´æ—¶çš„ mycron æ–‡ä»¶\n  rm -f mycron\nelse\n  crontab -l > mycron\n  echo \"$execute_minutes $execute_hours * * * /bin/bash /home/automatic-shutdown.sh\" > mycron\n  crontab mycron\n  rm -f mycron\nfi\n\nif [ -z \"$shutdown_time\" ]; then\n  echo \"ä½¿ç”¨é»˜è®¤å…³æœºæ—¶é—´ï¼Œå³22:30\n  \"\n  /sbin/shutdown -h 22:30\nelse\n  /sbin/shutdown -h $shutdown_time\nfi\n\nif [ -z \"$execute_hours\" ] || [ -z \"$execute_hours\" ] || [ -z \"$shutdown_time\" ]; then\necho \"\n#############################\nè„šæœ¬ä¼šåœ¨æ¯å¤©10:00è‡ªåŠ¨æ‰§è¡Œ\næœåŠ¡å™¨ä¼šåœ¨æ¯å¤©22:30è‡ªåŠ¨å…³æœº\n#############################\n\"\nelse\necho \"\n#############################\nè„šæœ¬ä¼šåœ¨æ¯å¤©$execute_hours:$execute_minutesè‡ªåŠ¨æ‰§è¡Œ\næœåŠ¡å™¨ä¼šåœ¨æ¯å¤©$shutdown_timeè‡ªåŠ¨å…³æœº\n#############################\n\"\nfi\n```\n\n### æ‹‰å–`gcr.io` , `k8s.gcr.io` , `registry.k8s.io` , `quay.io`, `ghcr.io`å®˜æ–¹é•œåƒè„šæœ¬\n\n> wget https://raw.githubusercontent.com/anjia0532/gcr.io_mirror/master/pull-k8s-image.sh chmod +x pull-k8s-image.sh\n\n```Shell\nvi pull-images.sh\n###########################################3\n#!/bin/sh\n\nk8s_img=$1\nmirror_img=$(echo ${k8s_img}|\n        sed 's/quay\\.io/anjia0532\\/quay/g;s/ghcr\\.io/anjia0532\\/ghcr/g;s/registry\\.k8s\\.io/anjia0532\\/google-containers/g;s/k8s\\.gcr\\.io/anjia0532\\/google-containers/g;s/gcr\\.io/anjia0532/g;s/\\//\\./g;s/ /\\n/g;s/anjia0532\\./anjia0532\\//g' |\n        uniq)\n\nif [ -x \"$(command -v docker)\" ]; then\n  sudo docker pull ${mirror_img}\n  sudo docker tag ${mirror_img} ${k8s_img}\n  exit 0\nfi\n\nif [ -x \"$(command -v ctr)\" ]; then\n  sudo ctr -n k8s.io image pull docker.io/${mirror_img}\n  sudo ctr -n k8s.io image tag docker.io/${mirror_img} ${k8s_img}\n  exit 0\nfi\n\necho \"command not found:docker or ctr\"\n###############################################\nchmod +x pull-images.sh\n#æ‰§è¡Œæ ¼å¼\n./pull-images.sh  é•œåƒå\n```\n","tags":["æ€»ç»“","è„šæœ¬","è¿ç»´","Linux","shell"],"categories":["Linuxè¿ç»´","è„šæœ¬"]},{"title":"dockeré•œåƒä»“åº“æ­å»º(Harbor)","url":"/yyg/c3b2f9c5/","content":"\n## ä»»åŠ¡ç›®æ ‡\n\n1. å®Œæˆdockeré•œåƒä»“åº“çš„æ­å»º\n\n## ä»»åŠ¡å¹³å°\n\n1. ç‰©ç†è®¾å¤‡--\n2. æ“ä½œç³»ç»Ÿï¼šopenEuler 22.03 LTS SP2\n\n## éƒ¨ç½²æŒ‡å—\n\n### ä»»åŠ¡ä¸€ï¼šç¯å¢ƒéœ€æ±‚\n\n1. ç¡¬ä»¶é…ç½®\n\nä¸‹å›¾åˆ—å‡ºäº†éƒ¨ç½² Harbor çš„æœ€ä½ç¡¬ä»¶é…ç½®å’Œæ¨èçš„ç¡¬ä»¶é…ç½®ã€‚\n\n![image-20240323215852040](dockeré•œåƒä»“åº“æ­å»º-Harbor/image-20240323215852040.png)\n\n1. ç½‘ç»œç«¯å£\n\nHarbor è¦æ±‚åœ¨ç›®æ ‡ä¸»æœºä¸Šæ‰“å¼€ä»¥ä¸‹ç«¯å£\n\n| ç«¯å£ | åè®®  | å¤‡æ³¨                                            |\n| ---- | ----- | ----------------------------------------------- |\n| 443  | HTTPS | Harbor é—¨æˆ·å’Œæ ¸å¿ƒ API æ¥å—æ­¤ç«¯å£ä¸Šçš„ HTTPS è¯·æ±‚ |\n| 4443 | HTTPS | è¿æ¥åˆ°é€‚ç”¨äº Harbor çš„ Docker å†…å®¹ä¿¡ä»»æœåŠ¡      |\n| 80   | HTTP  | Harbor é—¨æˆ·å’Œæ ¸å¿ƒ API æ¥å—æ­¤ç«¯å£ä¸Šçš„ HTTP è¯·æ±‚  |\n\n### ä»»åŠ¡äºŒï¼šåŸºç¡€ç¯å¢ƒå‡†å¤‡\n\n### ä»»åŠ¡ä¸‰ï¼šéƒ¨ç½²\n\n1. #### ä¸‹è½½Harbor\n\n```Shell\nwget https://github.com/goharbor/harbor/releases/download/v2.9.1/harbor-offline-installer-v2.9.1.tgz\n#è§£å‹\ntar -vzxf harbor-offline-installer-v2.9.1.tgz\n```\n\n1. #### å®‰è£…httpsè¯ä¹¦\n\n   1. #####  ç®€å•ç‰ˆ\n\n   ```Shell\n   #åˆ›å»ºè¯ä¹¦ç›®å½•ï¼Œå¹¶èµ‹äºˆæƒé™\n   mkdir -p /data/cert/\n   chmod  -R 777 /data/cert/\n   cd /data/cert\n   #åˆ›å»ºç§é’¥\n   openssl genrsa -des3 -out harbor.key 2048\n   #ç”Ÿæˆcaè¯ä¹¦ï¼Œipä¸ºæœ¬æœºip\n   openssl req -sha512 -new \\\n        -subj \"/C=CN/ST=hennan/L=zhengzhou/O=qishi/OU=qishi/CN=images.store.net.crt\" \\\n        -key harbor.key \\\n        -out harbor.csr\n    #å¤‡ä»½è¯ä¹¦\n    cp harbor.key  harbor.key.org\n    #è½¬åŒ–ä¸ºä¸å¸¦å¯†ç çš„ç§é’¥\n    openssl rsa -in harbor.key.org -out harbor.key\n    #ä½¿ç”¨è¯ä¹¦è¿›è¡Œç­¾å\n     openssl x509 -req -days 100000  -in harbor.csr -signkey harbor.key -out harbor.crt\n   ```\n\n   1. #####  å®˜æ–¹ç‰ˆ\n\n      ```Shell\n      #åˆ›å»ºå­˜æ”¾ç›®å½•\n      mkdir -p /data/harbor-ca\n      cd /data/harbor-ca\n      ```\n\n      - ç”Ÿæˆè¯ä¹¦é¢å‘æœºæ„è¯ä¹¦\n\n      1. ç”Ÿæˆ CA è¯ä¹¦ç§é’¥\n\n      ```Shell\n      openssl genrsa -out ca.key 4096\n      ```\n\n      1. ç”Ÿæˆ CA è¯ä¹¦\n\n      ```Shell\n      #CNåçš„å†…å®¹ä¸ºipæˆ–è€…åŸŸå\n      openssl req -x509 -new -nodes -sha512 -days 3650 \\\n       -subj \"/C=CN/ST=henan/L=zhengzhou/O=qishi/OU=qishi/CN=hub-docker.xxx.net\" \\\n       -key ca.key \\\n       -out ca.crt\n      ```\n\n      - ç”ŸæˆæœåŠ¡å™¨è¯ä¹¦\n\n      1. ç”Ÿæˆç§é’¥\n\n      ```Shell\n      #åŸŸåæˆ–ipå‘½å\n      openssl genrsa -out hub-docker.xxx.net.key 4096\n      ```\n\n      1. ç”Ÿæˆè¯ä¹¦ç­¾åè¯·æ±‚ ï¼ˆCSRï¼‰\n\n      ```Shell\n      openssl req -sha512 -new \\\n          -subj \"/C=CN/ST=henan/L=zhengzhou/O=qishi/OU=qishi/CN=hub-docker.xxx.net\" \\\n          -key hub-docker.xxx.net.key \\\n          -out hub-docker.xxx.net.csr\n      ```\n\n      1. ç”Ÿæˆ x509 v3 æ‰©å±•æ–‡ä»¶\n\n      ```Shell\n      cat > v3.ext <<-EOF\n      authorityKeyIdentifier=keyid,issuer\n      basicConstraints=CA:FALSE\n      keyUsage = digitalSignature, nonRepudiation, keyEncipherment, dataEncipherment\n      extendedKeyUsage = serverAuth\n      subjectAltName = @alt_names\n      \n      [alt_names]\n      DNS.1=hub-docker.xxx.net\n      DNS.2=hub-docker.xxx\n      DNS.3=hub-docker\n      EOF\n      ```\n\n      1. ä½¿ç”¨v3.extç”Ÿæˆè¯ä¹¦\n\n      ```Shell\n      openssl x509 -req -sha512 -days 3650 \\\n          -extfile v3.ext \\\n          -CA ca.crt -CAkey ca.key -CAcreateserial \\\n          -in hub-docker.xxx.net.csr \\\n          -out hub-docker.xxx.net.crt\n      ```\n\n      - å‘ Harbor å’Œ Docker æä¾›è¯ä¹¦\n        - å°†æœåŠ¡å™¨è¯ä¹¦å’Œå¯†é’¥å¤åˆ¶åˆ°å­˜æ”¾ harborä½¿ç”¨è¯ä¹¦çš„ç›®å½•\n      \n         ```shell\n         #åˆ›å»ºå­˜æ”¾harborä½¿ç”¨è¯ä¹¦çš„ç›®å½•\n         mkdir -p /data/cert/\n         #æ‹·è´è¯ä¹¦\n          cp hub-docker.xxx.net.crt /data/cert/\n          cp hub-docker.xxx.net.key /data/cert/\n          ```\n        \n        - è½¬æ¢è¯ä¹¦ï¼Œä¾›dockerä½¿ç”¨\n        \n          ```shell\n             openssl x509 -inform PEM -in hub-docker.xxx.net.crt -out hub-docker.xxx.net.cert\n             #åˆ›å»ºå­˜æ”¾dockerä½¿ç”¨è¯ä¹¦ç›®å½•ï¼Œå‘½åæ–¹å¼ä¸ºip:ç«¯å£ï¼Œæˆ–è€…åŸŸå\n             mkdir -p /etc/docker/certs.d/hub-docker.xxx.net/\n             #æ‹·è´è¯ä¹¦\n             cp hub-docker.xxx.net.cert /etc/docker/certs.d/hub-docker.xxx.net/\n             cp hub-docker.xxx.net.key /etc/docker/certs.d/hub-docker.xxx.net/\n             cp ca.crt /etc/docker/certs.d/hub-docker.xxx.net/\n             #é‡å¯docker\n             systemctl restart docker\n          ```\n        \n          \n        \n\n\n1. #### å®‰è£…Harbor\n\nä¿®æ”¹é…ç½®æ–‡ä»¶\n\n```Shell\ncp harbor.yml.tmpl harbor.yml\nvi harbor.yml\n#################################\nhostname: hub-docker.xxx.net   #ä¿®æ”¹ä¸ºæœ¬æœºip,æˆ–è€…è‡ªå®šä¹‰åŸŸå\nhttp:\n   port: 80 #ç«¯å£å¯è‡ªå®šä¹‰\nhttps:   \n   port: 443 #ç«¯å£å¯è‡ªå®šä¹‰\ncertificate: /data/harbor/harbor-ca/hub-docker.xxx.net.crt #è¯ä¹¦è·¯å¾„\nprivate_key: /data/harbor/harbor-ca/hub-docker.xxx.net.key #ç§é’¥è·¯å¾„\nharbor_admin_password: Harbor12345 #ç™»å½•å¯†ç \ndata_volume: /data/harbor-data #æ•°æ®å­˜å‚¨ç›®å½•\n#################################\n```\n\næ‰§è¡Œå®‰è£…\n\n```Shell\n./install.sh  --with-trivy\n```\n\næµè§ˆå™¨è¾“å…¥ipåŠ ç«¯å£è®¿é—®(æ·»åŠ hostsåï¼ŒåŸŸåè®¿é—®)\n\n![image-20240323220017893](dockeré•œåƒä»“åº“æ­å»º-Harbor/image-20240323220017893.png)\n\n### ä»»åŠ¡å››ï¼šè®¾ç½®docker login ç™»å½•å‡­è¯åŠ å¯†ï¼ˆè¦æ‹‰å–é•œåƒçš„ä¸»æœºï¼‰\n\n1. å®‰è£…pass\n\n```Shell\n #åŸºç¡€ç¯å¢ƒ\n yum install -y make\n#è·å–passæºç \nwget https://git.zx2c4.com/password-store/snapshot/password-store-1.7.4.tar.xz\n#è§£å‹åˆ°/usr/local/ç›®å½•\ntar Jxf password-store-1.7.4.tar.xz -C /usr/local/\n#æ‰§è¡Œå®‰è£…\ncd /usr/local/password-store-1.7.4\nmake install\n#éªŒè¯\n pass version\n```\n\n1. å®‰è£…docker-credential-helpers\n\n```Shell\n#å®‰è£…goåŸºç¡€ç¯å¢ƒ\nyum -y install golang-1.17.3\n#è·å–docker-credential-helpersæºç \nwget https://github.com/docker/docker-credential-helpers/archive/refs/tags/v0.8.0.tar.gz\ntar -xf v0.8.0.tar.gz\n mv docker-credential-helpers-0.8.0 docker-credential-helpers\n cd docker-credential-helpers/\n #ä½¿ç”¨passæ–¹å¼å®‰è£…\n make pass\n cp bin/build/docker-credential-pass /usr/bin/\n chmod +x /usr/bin/docker-credential-pass\n```\n\n1. ä¿®æ”¹å¯†ç é…ç½®æ–‡ä»¶\n\n```Shell\n#ç”Ÿæˆå¯†é’¥å¯¹\n gpg --full-generate-key\n #æŸ¥çœ‹å¯†é’¥\n gpg --list-keys\n ##################################################\n /root/.gnupg/pubring.kbx\n------------------------\npub   rsa3072 2023-11-30 [SC] [æœ‰æ•ˆè‡³ï¼š2025-11-29]\n      56CCF64EC289B13B1C0F14CCF2BB16136358AEA4\nuid             [ ç»å¯¹ ] qishi <qishi@qq.com>\nsub   rsa3072 2023-11-30 [E] [æœ‰æ•ˆè‡³ï¼š2025-11-29]\n##################################################\n #åˆå§‹åŒ–\n pass init 56CCF64EC289B13B1C0F14CCF2BB16136358AEA4\n \n #ç™»å½•dockerä»“åº“ï¼ŒæŸ¥çœ‹ç™»å½•å‡­è¯æ˜¯å¦åŠ å¯†\n docker login hub-docker.xxx.net\n cat /root/.docker/config.json\n #######################################\n {\n        \"auths\": {\n                \"hub-docker.xxx.net\": {}\n        },\n        \"credsStore\": \"pass\"\n}\n #######################################\n \n  #åˆ›å»ºå¯†ç æœ¬ä¿å­˜æ–‡ä»¶ç›®å½•\n  pass insert docker-credential-helpers/docker-pass-initialized-check\n #æŸ¥çœ‹å¯†ç æœ¬åˆ—è¡¨\n  docker-credential-pass list\n  #éªŒè¯å¯†ç æœ¬\n  yum install tree -y\n  pass\n  #ä»¥å®é™…è·¯å¾„ä¸ºå‡†\n  pass show docker-credential-helpers/aW1hZ2VzLnN0b3JlLm5ldA==/admin\n```\n\n### ä»»åŠ¡äº”ï¼šä¸Šä¼ ä¸‹è½½é•œåƒï¼ˆè¦æ‹‰å–é•œåƒçš„ä¸»æœºï¼‰\n\nåœ¨éœ€è¦æ‹‰å–å’Œä¸Šä¼ é•œåƒçš„ä¸»æœºä¸Šï¼Œä¿®æ”¹daemon.jsonæ–‡ä»¶ï¼Œå†é‡å¯docker\n\n```Shell\nvi /etc/docker/daemon.json\n{\n  \"insecure-registries\": [\"hub-docker.xxx.net\"] #ipæˆ–è€…åŸŸå\n}\n\nsystemctl restart docker\n```\n\næ‹‰å–å’Œä¸Šä¼ é•œåƒ\n\n```Shell\n#æ‹‰å–nginxé•œåƒåšæµ‹è¯•\ndocker pull nginx\n#é‡æ–°æ‰“ä¸Šæ ‡ç­¾ï¼Œå…¶ä¸­testä¸ºharborä¸­å­˜åœ¨çš„é¡¹ç›®\ndocker tag nginx:latest 172.20.1.55/test/nginx-test:1.0\ndocker tag nginx:latest hub-docker.xxx.net/test/nginx-test:1.0\n#ç™»å½•ä»“åº“ï¼Œè¾“å…¥ç”¨æˆ·åå’Œå¯†ç \ndocker login 172.20.1.55\ndocker login hub-docker.xxx.net\nsystemctl restart docker\n#å°†é•œåƒæ¨é€åˆ°ä»“åº“\ndocker push 172.20.1.55/test/nginx-test:1.0\ndocker push hub-docker.xxx.net/test/nginx-test:1.0\n#æ‹‰å–é•œåƒ\ndocker pull 172.20.1.55/test/nginx-test:1.0\ndocker pull hub-docker.xxx.net/test/nginx-test:1.0\n```\n\n### ä»»åŠ¡å…­ï¼šcosignç­¾åé•œåƒï¼ˆè¦æ‹‰å–é•œåƒçš„ä¸»æœºï¼‰\n\n```Shell\nmkdir -p /data/cosign\n#ä¸‹è½½ï¼Œå®‰è£…cosign\nwget https://github.com/sigstore/cosign/releases/download/v2.2.2/cosign-2.2.2-1.x86_64.rpm\nrpm -ivh cosign-2.2.2-1.x86_64.rpm\n#arm\nwget https://github.com/sigstore/cosign/releases/download/v2.2.2/cosign-2.2.2-1.aarch64.rpm\nrpm -ivh cosign-2.2.2-1.aarch64.rpm\n#éªŒè¯å®‰è£…\ncosign version\n#ç”Ÿæˆå¯†é’¥\ncosign generate-key-pair\n#å¯¹é•œåƒè¿›è¡ŒåŠ å¯†ç­¾å\ncosign sign  --allow-insecure-registry --key /data/cosign/cosign.key images.store.net/test/test-nginx:1.0.0\n\n#è§£å¯†éªŒè¯\ncosign  verify  --allow-insecure-registry --key /data/cosign/cosign.pub images.store.net/test/test-nginx:1.0.0\n```\n","tags":["Harbor","docker","å®¹å™¨é•œåƒä»“åº“"],"categories":["å®¹å™¨åŒ–","Linuxè¿ç»´","docker","å®¹å™¨ç®¡ç†"]},{"title":"é«˜å¯ç”¨k8sé›†ç¾¤éƒ¨ç½²æŒ‡å—","url":"/yyg/612a796b/","content":"## ä»»åŠ¡ç›®æ ‡\n\n1. å®Œæˆé«˜å¯ç”¨k8sé›†ç¾¤å®‰è£…éƒ¨ç½²\n\n## ä»»åŠ¡å¹³å°\n\n1. ç‰©ç†è®¾å¤‡--\n2. æ“ä½œç³»ç»Ÿï¼šopenEuler 22.03 LTS SP2\n\n## éƒ¨ç½²æŒ‡å—\n\né›†ç¾¤æ‹“æ‰‘å›¾\n\n![image-20240323222414360](é«˜å¯ç”¨k8sé›†ç¾¤éƒ¨ç½²æŒ‡å—/image-20240323222414360.png)\n\n### ä»»åŠ¡ä¸€ï¼šé…ç½®å‡†å¤‡\n\n1. é‡å‘½åhostname\n\n```Shell\n# å°†10.10.3.121çš„ä¸»æœºåæ”¹ä¸ºfuture-k8s-node0\nhostnamectl set-hostname future-k8s-node0 && bash\n# å°†10.10.3.122çš„ä¸»æœºåæ”¹ä¸ºfuture-k8s-node1\nhostnamectl set-hostname future-k8s-node1 && bash\n# å°†10.10.3.123çš„ä¸»æœºåæ”¹ä¸ºfuture-k8s-node2\nhostnamectl set-hostname future-k8s-node2 && bash\n# å°†10.10.3.124çš„ä¸»æœºåæ”¹ä¸ºfuture-k8s-node3\nhostnamectl set-hostname future-k8s-node3 && bash\n```\n\n1. å®‰è£…å‰çš„é…ç½®ä¿®æ”¹\n\n```Shell\n# å…³é—­é˜²ç«å¢™\nsystemctl stop firewalld\nsystemctl disable firewalld\nfirewall-cmd --state\n \n# selinuxæ°¸ä¹…å…³é—­\nsetenforce 0\n sed -i 's/^SELINUX=enforcing$/SELINUX=permissive/' /etc/selinux/config\ncat /etc/selinux/config\n\n# swapæ°¸ä¹…å…³é—­\nswapoff --all\nswapoff -a\nsed -ri 's/.*swap.*/#&/' /etc/fstab\ncat /etc/fstab\n\n# æ·»åŠ hosts\ncat >> /etc/hosts << EOF\n10.10.3.121 future-k8s-node0\n10.10.3.122 future-k8s-node1\n10.10.3.123 future-k8s-node2\n10.10.3.124 future-k8s-node3\n10.10.3.125 future-k8s-vip\nEOF\n#æŸ¥çœ‹\ncat /etc/hosts\n\n\n# æ·»åŠ ç½‘æ¡¥è¿‡æ»¤åŠå†…æ ¸è½¬å‘é…ç½®æ–‡ä»¶\ncat > /etc/sysctl.d/k8s.conf << EOF\n net.bridge.bridge-nf-call-ip6tables = 1\n net.bridge.bridge-nf-call-iptables = 1\n net.ipv4.ip_forward = 1\nEOF\n# æŸ¥çœ‹\ncat /etc/sysctl.d/k8s.conf\n# åŠ è½½br_netfilteræ¨¡å—\nmodprobe br_netfilter\n# æŸ¥çœ‹æ˜¯å¦åŠ è½½\nlsmod | grep br_netfilter\n# åŠ è½½ç½‘æ¡¥è¿‡æ»¤åŠå†…æ ¸è½¬å‘é…ç½®æ–‡ä»¶\nsysctl -p /etc/sysctl.d/k8s.conf\n\n#åŒæ­¥æ—¶é—´\nyum install ntp -y\nsystemctl start ntpd\nsystemctl enable ntpd\nyum install chrony  -y\nsystemctl start chrony\nsystemctl enable chronyd\n#ä¿®æ”¹é…ç½®ï¼Œæ·»åŠ å†…å®¹\necho \"\nserver 10.10.3.70 iburst\nallow 10.10.3.0/24\n\" >> /etc/chrony.conf\ntimedatectl set-ntp true\nsystemctl restart chronyd\ntimedatectl status\ndate\n```\n\n1. å®‰è£…ipsetåŠipvsadm\n\n```Shell\n # å®‰è£…ipsetåŠipvsadm\n yum -y install ipset ipvsadm\n é…ç½®ipvsadmæ¨¡å—åŠ è½½æ–¹å¼\n # æ·»åŠ éœ€è¦åŠ è½½çš„æ¨¡å—\necho ' #!/bin/bash\n modprobe -- ip_vs\n modprobe -- ip_vs_rr\n modprobe -- ip_vs_wrr\n modprobe -- ip_vs_sh\n modprobe -- nf_conntrack\n' > /etc/sysconfig/modules/ipvs.modules\n#æŸ¥çœ‹\ncat /etc/sysconfig/modules/ipvs.modules\n # æˆæƒã€è¿è¡Œã€æ£€æŸ¥æ˜¯å¦åŠ è½½\nchmod 755 /etc/sysconfig/modules/ipvs.modules \nbash /etc/sysconfig/modules/ipvs.modules \nlsmod | grep -e ip_vs -e nf_conntrack\n\n#é‡å¯\nreboot\n```\n\né…ç½®å‡†å¤‡å®Œæˆåï¼Œæ‰€æœ‰èŠ‚ç‚¹éƒ½éœ€é‡å¯\n\n### ä»»åŠ¡äºŒï¼šå®‰è£…docker\n\n1. é…ç½®Docker CEçš„yumå­˜å‚¨åº“ã€‚æ‰“å¼€`docker-ce.repo`çš„æ–‡ä»¶ï¼Œå¹¶å°†ä»¥ä¸‹å†…å®¹å¤åˆ¶åˆ°æ–‡ä»¶ä¸­ï¼š\n\n```Shell\necho '\n[docker-ce-stable]\nname=Docker CE Stable - $basearch\nbaseurl=https://download.docker.com/linux/centos/7/$basearch/stable\nenabled=1\ngpgcheck=1\ngpgkey=https://download.docker.com/linux/centos/gpg ' > /etc/yum.repos.d/docker-ce.repo\n```\n\nä¿å­˜å¹¶é€€å‡ºæ–‡ä»¶ã€‚\n\n1. å®‰è£…Docker CEã€‚è¿è¡Œä»¥ä¸‹å‘½ä»¤æ¥å®‰è£…Docker CEï¼š\n\n```Shell\n yum -y install docker-ce docker-ce-cli  containerd.io\n#å¯åŠ¨dockerå¹¶è®¾ç½®å¼€æœºè‡ªå¯\nsystemctl start docker  \nsystemctl enable docker\n#æŸ¥çœ‹ç‰ˆæœ¬\ndocker -v\ndocker compose version\n```\n\n1. Dockeré…ç½®ä¿®æ”¹ï¼Œè®¾ç½®cgroupé©±åŠ¨ï¼Œä½¿ç”¨systemdï¼Œé…ç½®ä¿®æ”¹ä¸ºå¦‚ä¸‹ã€‚\n\n```Shell\n#å°†é…ç½®å†™å…¥daemon.jsonæ–‡ä»¶\necho '{\n  \"exec-opts\": [\"native.cgroupdriver=systemd\"],\n  \"data-root\": \"/data/docker\"\n} ' > /etc/docker/daemon.json\n#æŸ¥çœ‹\ncat /etc/docker/daemon.json\nsystemctl daemon-reload\nsystemctl restart docker\ndocker info\n```\n\n1. åˆ›å»ºæ‰€éœ€ç›®å½•\n\n```Shell\nmkdir  cri-dockerd   calico dashboard  docker  metrics-server  script  ingress-nginx\n```\n\n### ä»»åŠ¡ä¸‰ï¼šå®‰è£…cri-dockerd ï¼ˆk8s 1.24åŠä»¥ä¸Šç‰ˆæœ¬ï¼‰\n\n```Shell\ncd /data/cri-dockerd\n# ä¸‹è½½cri-dockerdå®‰è£…åŒ…\nwget https://github.com/Mirantis/cri-dockerd/releases/download/v0.3.4/cri-dockerd-0.3.4-3.el8.x86_64.rpm\n# å®‰è£…cri-dockerd\nrpm -ivh cri-dockerd-0.3.4-3.el8.x86_64.rpm\ndocker pull registry.aliyuncs.com/google_containers/pause:3.9\n# ä¿®æ”¹é•œåƒåœ°å€ä¸ºå›½å†…ï¼Œå¦åˆ™kubeletæ‹‰å–ä¸äº†é•œåƒå¯¼è‡´å¯åŠ¨å¤±è´¥\nsed -i.bak 's|ExecStart=.*$|ExecStart=/usr/bin/cri-dockerd --container-runtime-endpoint fd:// --pod-infra-container-image=registry.aliyuncs.com/google_containers/pause:3.9|g' /usr/lib/systemd/system/cri-docker.service\ncat /usr/lib/systemd/system/cri-docker.service\n# å¯åŠ¨cri-dockerd\nsystemctl daemon-reload \nsystemctl start cri-docker.service\nsystemctl enable cri-docker.service\n```\n\n### ä»»åŠ¡å››ï¼šå®‰è£…é«˜å¯ç”¨ç»„ä»¶\n\néƒ¨ç½²é«˜å¯ç”¨é›†ç¾¤éœ€è¦å®‰è£…**keepalivedå’Œhaproxyï¼Œå®ç°****master****èŠ‚ç‚¹é«˜å¯ç”¨ï¼Œ****åœ¨å„masterèŠ‚ç‚¹æ“ä½œ**\n\n1. å®‰è£…keepalivedä¸haproxy\n\n```Shell\nyum install keepalived haproxy -y\n```\n\n1. å¤‡ä»½keepalivedä¸haproxyé…ç½®æ–‡ä»¶\n\n```Shell\ncp /etc/keepalived/keepalived.conf /etc/keepalived/keepalived.conf.bak\ncp /etc/haproxy/haproxy.cfg /etc/haproxy/haproxy.cfg.bak\n```\n\n1. ä¿®æ”¹å„masterèŠ‚ç‚¹çš„`/etc/keepalived/keepalived.conf`æ–‡ä»¶\n   1. future-k8s-node0\n   2. ```Shell\n      echo '\n      global_defs {\n         router_id k8s\n      }\n      \n      vrrp_script check_haproxy {\n          script \"killall -0 haproxy\"\n          interval 3\n          weight -2\n          fall 10\n          rise 2\n      }\n      \n      vrrp_instance VI_1 {\n          state MASTER  #ä¸»èŠ‚ç‚¹ åˆ™ä¸ºMASTER ,å…¶ä»–åˆ™ä¸º BACKUP\n          interface ens192  #ç½‘å¡åç§°\n          virtual_router_id 51\n          priority 250   #ä¼˜å…ˆçº§\n          nopreempt   #è®¾ç½®éæŠ¢å æ¨¡å¼\n          advert_int 1\n          authentication {\n              auth_type PASS\n              auth_pass ceb1b3ec013d66163d6ab\n          }\n          virtual_ipaddress {\n              10.10.3.125/24   #è™šæ‹Ÿip\n          }\n          track_script {\n              check_haproxy\n          }\n      }    \n      ' > /etc/keepalived/keepalived.conf\n      ```\n\n   3. future-k8s-node1\n   4. ```Shell\n      echo '\n      global_defs {\n         router_id k8s\n      }\n      \n      vrrp_script check_haproxy {\n          script \"killall -0 haproxy\"\n          interval 3\n          weight -2\n          fall 10\n          rise 2\n      }\n      \n      vrrp_instance VI_1 {\n          state BACKUP  #ä¸»èŠ‚ç‚¹ åˆ™ä¸ºMASTER ,å…¶ä»–åˆ™ä¸º BACKUP\n          interface ens192  #ç½‘å¡åç§°\n          virtual_router_id 51\n          priority 200   #ä¼˜å…ˆçº§\n          nopreempt   #è®¾ç½®éæŠ¢å æ¨¡å¼\n          advert_int 1\n          authentication {\n              auth_type PASS\n              auth_pass ceb1b3ec013d66163d6ab\n          }\n          virtual_ipaddress {\n              10.10.3.125/24   #è™šæ‹Ÿip\n          }\n          track_script {\n              check_haproxy\n          }\n      }    \n      ' > /etc/keepalived/keepalived.conf\n      ```\n\n   5. future-k8s-node2\n   6. ```Shell\n      echo '\n      global_defs {\n         router_id k8s\n      }\n      \n      vrrp_script check_haproxy {\n          script \"killall -0 haproxy\"\n          interval 3\n          weight -2\n          fall 10\n          rise 2\n      }\n      \n      vrrp_instance VI_1 {\n          state BACKUP  #ä¸»èŠ‚ç‚¹ åˆ™ä¸ºMASTER ,å…¶ä»–åˆ™ä¸º BACKUP\n          interface ens192  #ç½‘å¡åç§°\n          virtual_router_id 51\n          priority 150   #ä¼˜å…ˆçº§\n          nopreempt   #è®¾ç½®éæŠ¢å æ¨¡å¼\n          advert_int 1\n          authentication {\n              auth_type PASS\n              auth_pass ceb1b3ec013d66163d6ab\n          }\n          virtual_ipaddress {\n              10.10.3.125/24   #è™šæ‹Ÿip\n          }\n          track_script {\n              check_haproxy\n          }\n      }    \n      ' > /etc/keepalived/keepalived.conf\n      ```\n2. ä¿®æ”¹å„masterèŠ‚ç‚¹çš„`/etc/haproxy/haproxy.cfg`æ–‡ä»¶ï¼Œï¼ˆä¸‰ä¸ªmasterèŠ‚ç‚¹çš„é…ç½®æ–‡ä»¶ç›¸åŒï¼‰\n\n```Shell\necho \"\n#---------------------------------------------------------------------\n# Global settings\n#---------------------------------------------------------------------\nglobal\n    # to have these messages end up in /var/log/haproxy.log you will\n    # need to:\n    # 1) configure syslog to accept network log events.  This is done\n    #    by adding the '-r' option to the SYSLOGD_OPTIONS in\n    #    /etc/sysconfig/syslog\n    # 2) configure local2 events to go to the /var/log/haproxy.log\n    #   file. A line like the following can be added to\n    #   /etc/sysconfig/syslog\n    #\n    #    local2.*                       /var/log/haproxy.log\n    #\n    log         127.0.0.1 local2\n\n    chroot      /var/lib/haproxy\n    pidfile     /var/run/haproxy.pid\n    maxconn     4000\n    user        haproxy\n    group       haproxy\n    daemon\n\n    # turn on stats unix socket\n    stats socket /var/lib/haproxy/stats\n#---------------------------------------------------------------------\n# common defaults that all the 'listen' and 'backend' sections will\n# use if not designated in their block\n#---------------------------------------------------------------------\ndefaults\n    mode                    http\n    log                     global\n    option                  httplog\n    option                  dontlognull\n    option http-server-close\n    option forwardfor       except 127.0.0.0/8\n    option                  redispatch\n    retries                 3\n    timeout http-request    10s\n    timeout queue           1m\n    timeout connect         10s\n    timeout client          1m\n    timeout server          1m\n    timeout http-keep-alive 10s\n    timeout check           10s\n    maxconn                 3000\n#---------------------------------------------------------------------\n# kubernetes apiserver frontend which proxys to the backends\n#---------------------------------------------------------------------\nfrontend kubernetes-apiserver\n    mode                 tcp\n    bind                 *:16443 #é«˜å¯ç”¨ç›‘æ§ç«¯å£ï¼Œåˆå§‹åŒ–k8sé›†ç¾¤æ—¶ä¼šç”¨\n    option               tcplog\n    default_backend      kubernetes-apiserver\n#---------------------------------------------------------------------\n# round robin balancing between the various backends\n#---------------------------------------------------------------------\nbackend kubernetes-apiserver\n    mode        tcp\n    balance     roundrobin\n    server      future-k8s-node0   10.10.3.121:6443 check\n    server      future-k8s-node1   10.10.3.122:6443 check\n    server      future-k8s-node2   10.10.3.123:6443 check\n\n#---------------------------------------------------------------------\n# collection haproxy statistics message\n#---------------------------------------------------------------------\nlisten stats\n    bind                 *:1080\n    stats auth           admin:awesomePassword\n    stats refresh        5s\n    stats realm          HAProxy\\ Statistics\n    stats uri            /admin?stats\n\n\" > /etc/haproxy/haproxy.cfg\n```\n\n1. å¯åŠ¨ï¼ˆå„masterèŠ‚ç‚¹æŒ‰é¡ºåºå¯åŠ¨ï¼‰\n\n```Shell\n#å¯åŠ¨keepalived  \nsystemctl enable keepalived  && systemctl start keepalived  \n#å¯åŠ¨haproxy \nsystemctl enable haproxy && systemctl start haproxy\nsystemctl status keepalived\nsystemctl status haproxy\n```\n\n1. åœ¨future-k8s-node0æŸ¥çœ‹ç»‘å®šçš„vipåœ°å€  \n\n> ip add 1: lo: <LOOPBACK,UP,LOWER_UP> mtu 65536 qdisc noqueue state UNKNOWN group default qlen 1000    link/loopback 00:00:00:00:00:00 brd 00:00:00:00:00:00    inet 127.0.0.1/8 scope host lo       valid_lft forever preferred_lft forever    inet6 ::1/128 scope host       valid_lft forever preferred_lft forever 2: ens192: <BROADCAST,MULTICAST,UP,LOWER_UP> mtu 1500 qdisc mq state UP group default qlen 1000    link/ether 00:50:56:9a:eb:48 brd ff:ff:ff:ff:ff:ff    inet 10.10.3.121/24 brd 10.10.3.255 scope global noprefixroute ens192       valid_lft forever preferred_lft forever    inet 10.10.3.125/24 scope global ens192       valid_lft forever preferred_lft forever    inet6 fe80::250:56ff:fe9a:eb48/64 scope link noprefixroute       valid_lft forever preferred_lft forever\n\n### ä»»åŠ¡äº”ï¼šéƒ¨ç½²k8sé›†ç¾¤\n\n1. #### æ·»åŠ yumè½¯ä»¶æº\n\n```Shell\ncat > /etc/yum.repos.d/kubernetes.repo << EOF\n[kubernetes]\nname=Kubernetes\nbaseurl=https://mirrors.aliyun.com/kubernetes/yum/repos/kubernetes-el7-x86_64\nenabled=1\ngpgcheck=0\nrepo_gpgcheck=0\ngpgkey=https://mirrors.aliyun.com/kubernetes/yum/doc/yum-key.gpg https://mirrors.aliyun.com/kubernetes/yum/doc/rpm-package-key.gpg\nEOF\n```\n\n1. #### å®‰è£…kubeadmï¼Œkubeletå’Œkubectl\n\n```Shell\n# å®‰è£…kubeletã€kubeadmã€kubectl\nyum install -y kubelet-1.27.0 kubeadm-1.27.0 kubectl-1.27.0 --disableexcludes=kubernetes\n\n#å°†cgroupæ”¹ä¸ºsystemd\necho 'KUBELET_EXTRA_ARGS=\"--cgroup-driver=systemd\"' > /etc/sysconfig/kubelet\n# æŸ¥çœ‹\ncat /etc/sysconfig/kubelet\n# è®¾ç½®å¼€æœºå¯åŠ¨\nsystemctl start kubelet.service\nsystemctl enable kubelet.service\nsystemctl status kubelet.service\n\n#æŸ¥çœ‹ç‰ˆæœ¬\n kubeadm version\n kubelet --version\n kubectl version \n```\n\n1. #### åˆå§‹åŒ–k8sé›†ç¾¤ï¼ˆfuture-k8s-node0èŠ‚ç‚¹ï¼‰\n\n   #####  æ–¹å¼ä¸€ï¼šä½¿ç”¨é…ç½®æ–‡ä»¶åˆå§‹åŒ–\n\n   > 1. å¯¼å‡ºé»˜è®¤é…ç½®æ–‡ä»¶ (å¯é€‰)\n   >\n   > æš‚æ—¶æ— æ³•åœ¨é£ä¹¦æ–‡æ¡£å¤–å±•ç¤ºæ­¤å†…å®¹\n\n   1. é…ç½®æ–‡ä»¶\n\n   ```Shell\n   echo '\n   apiVersion: kubeadm.k8s.io/v1beta3\n   kind: InitConfiguration\n   localAPIEndpoint:\n     advertiseAddress: 10.10.3.125  #è™šæ‹Ÿip\n     bindPort: 6443\n   nodeRegistration:\n     criSocket: unix:///var/run/cri-dockerd.sock\n   ---\n   apiServer:\n     certSANs:    #masterèŠ‚ç‚¹ä¸å¯¹åº”ä¸»æœºå\n       - future-k8s-node0\n       - future-k8s-node1\n       - future-k8s-node2\n       - future-k8s-vip\n       - 10.10.3.121\n       - 10.10.3.122\n       - 10.10.3.123\n       - 10.10.3.125\n       - 127.0.0.1\n     timeoutForControlPlane: 4m0s\n   apiVersion: kubeadm.k8s.io/v1beta3\n   certificatesDir: /etc/kubernetes/pki\n   clusterName: kubernetes\n   controlPlaneEndpoint: \"future-k8s-vip:16443\" #è™šæ‹ŸipåŠé«˜å¯ç”¨é…ç½®çš„ç«¯å£å·\n   controllerManager: {}\n   dns: {}\n   etcd:\n     local:\n       dataDir: /var/lib/etcd\n   imageRepository: registry.aliyuncs.com/google_containers\n   kind: ClusterConfiguration\n   kubernetesVersion: 1.28.0\n   networking:\n     dnsDomain: cluster.local\n     podSubnet: 10.244.0.0/16\n     serviceSubnet: 10.96.0.0/12\n   scheduler: {}\n   ' > /data/script/kubeadm-config.yaml\n   ```\n\n   1. é›†ç¾¤åˆå§‹åŒ–\n\n   ```Shell\n   kubeadm init --config kubeadm-config.yaml --upload-certs\n   \n   mkdir -p $HOME/.kube\n   sudo cp -i /etc/kubernetes/admin.conf $HOME/.kube/config\n   sudo chown $(id -u):$(id -g) $HOME/.kube/config\n   ```\n\n   #####  æ–¹å¼äºŒï¼šä½¿ç”¨å‘½ä»¤åˆå§‹åŒ–\n\n   1. éƒ¨ç½²masterèŠ‚ç‚¹ï¼Œåœ¨10.10.3.121æ‰§è¡Œï¼Œåˆå§‹åŒ–masterèŠ‚ç‚¹\n\n   ```Shell\n   kubeadm init \\\n     --apiserver-advertise-address=10.10.3.121 \\\n     --image-repository registry.aliyuncs.com/google_containers \\\n     --kubernetes-version v1.27.0 \\\n     --control-plane-endpoint=future-k8s-vip:16443 \\  #è™šæ‹Ÿipï¼ˆæœªå®šï¼‰\n     --control-plane-endpoint=future-k8s-vip \\  #è™šæ‹Ÿipï¼ˆæœªå®šï¼‰\n     --service-cidr=10.96.0.0/12 \\\n     --pod-network-cidr=10.244.0.0/16 \\\n     --cri-socket=unix:///var/run/cri-dockerd.sock \\\n     --ignore-preflight-errors=all \n     \n     \n   mkdir -p $HOME/.kube\n   sudo cp -i /etc/kubernetes/admin.conf $HOME/.kube/config\n   sudo chown $(id -u):$(id -g) $HOME/.kube/config\n   ```\n\n   1. é…ç½®sshå…å¯†ç \n\n   ```Shell\n   #åœ¨10.10.3.121ä¸Šç”Ÿæˆå…¬é’¥ï¼Œå¤åˆ¶åˆ°å…¶ä»–masterèŠ‚ç‚¹ä¸Š\n   ssh-keygen -t rsa\n   ssh-copy-id 10.10.3.122\n   ssh-copy-id 10.10.3.123\n   ```\n\n   1. å°†10.10.3.121ä¸Šçš„è¯ä¹¦æ‹·è´åˆ°å…¶ä»–masterèŠ‚ç‚¹\n\n   ```Shell\n   #åœ¨å…¶ä»–masterèŠ‚ç‚¹åˆ›å»ºè¯ä¹¦å­˜æ”¾ç›®å½•\n   cd /root && mkdir -p /etc/kubernetes/pki/etcd &&mkdir -p ~/.kube/\n   \n   #å°†future-k8s-node0çš„è¯ä¹¦å¤åˆ¶åˆ°future-k8s-node1\n   scp /etc/kubernetes/pki/ca.crt 10.10.3.122:/etc/kubernetes/pki/ \n   scp /etc/kubernetes/pki/ca.key 10.10.3.122:/etc/kubernetes/pki/ \n   scp /etc/kubernetes/pki/sa.key 10.10.3.122:/etc/kubernetes/pki/\n   scp /etc/kubernetes/pki/sa.pub 10.10.3.122:/etc/kubernetes/pki/ \n   scp /etc/kubernetes/pki/front-proxy-ca.crt 10.10.3.122:/etc/kubernetes/pki/ \n   scp /etc/kubernetes/pki/front-proxy-ca.key 10.10.3.122:/etc/kubernetes/pki/ \n   scp /etc/kubernetes/pki/etcd/ca.crt 10.10.3.122:/etc/kubernetes/pki/etcd/\n   scp /etc/kubernetes/pki/etcd/ca.key 10.10.3.122:/etc/kubernetes/pki/etcd/\n   \n   #å°†future-k8s-node0çš„è¯ä¹¦å¤åˆ¶åˆ°future-k8s-node1\n   scp /etc/kubernetes/pki/ca.crt 10.10.3.123:/etc/kubernetes/pki/ \n   scp /etc/kubernetes/pki/ca.key 10.10.3.123:/etc/kubernetes/pki/ \n   scp /etc/kubernetes/pki/sa.key 10.10.3.123:/etc/kubernetes/pki/\n   scp /etc/kubernetes/pki/sa.pub 10.10.3.123:/etc/kubernetes/pki/ \n   scp /etc/kubernetes/pki/front-proxy-ca.crt 10.10.3.123:/etc/kubernetes/pki/ \n   scp /etc/kubernetes/pki/front-proxy-ca.key 10.10.3.123:/etc/kubernetes/pki/ \n   scp /etc/kubernetes/pki/etcd/ca.crt 10.10.3.123:/etc/kubernetes/pki/etcd/\n   scp /etc/kubernetes/pki/etcd/ca.key 10.10.3.123:/etc/kubernetes/pki/etcd/\n   ```\n\n1. #### åˆå§‹åŒ–å…¶ä»–masterèŠ‚ç‚¹\n\n```Shell\n kubeadm join future-k8s-vip:16443 --token ysl0xr.knx79yu06cldwiy1         --discovery-token-ca-cert-hash sha256:5dd8de94e08a560c7c2424dde0719a9f4e6ac4e5e5fe538ebbab0cbc5866b000         --control-plane  --cri-socket=unix:///var/run/cri-dockerd.sock\nmkdir -p $HOME/.kube\nsudo cp -i /etc/kubernetes/admin.conf $HOME/.kube/config\nsudo chown $(id -u):$(id -g) $HOME/.kube/config\n```\n\n1. #### åˆå§‹åŒ–nodeèŠ‚ç‚¹\n\n```Shell\n kubeadm join 10.10.3.121:6443 --token pzyo37.oaaqt1nrw3u7ijuj   --discovery-token-ca-cert-hash sha256:b8067f74af04b63399af1de28644223178e5d63e8258c25d465e78aca515e887 --cri-socket=unix:///var/run/cri-dockerd.sock\n```\n\n1. #### è®¾ç½®masterèŠ‚ç‚¹å…è®¸è°ƒåº¦POD ï¼ˆå¯é€‰ï¼‰\n\né»˜è®¤é…ç½®ä¸‹Kubernetesä¸ä¼šå°†Podè°ƒåº¦åˆ°MasterèŠ‚ç‚¹ã€‚å¦‚æœå¸Œæœ›å°†k8s-masterä¹Ÿå½“ä½œNodeä½¿ç”¨ï¼Œéœ€å»é™¤æ±¡ç‚¹ï¼Œå¼€å¯è°ƒåº¦ã€‚\n\n```Shell\n#æŸ¥çœ‹é»˜è®¤é…ç½®çš„æ±¡ç‚¹\nkubectl describe node future-k8s-node2 |grep Taints\n```\n\n> Taints:             node-role.kubernetes.io/control-plane:NoSchedule\n\n```Shell\n#å»é™¤æ±¡ç‚¹\nkubectl taint nodes future-k8s-node2 node-role.kubernetes.io/control-plane-\n```\n\næ·»åŠ wokeræ ‡è®°\n\n```Shell\n#æ·»åŠ workeræ ‡è®°\nkubectl label nodes future-k8s-node2 node-role.kubernetes.io/worker=\n#åˆ é™¤workeræ ‡è®°\nkubectl label nodes future-k8s-node2 node-role.kubernetes.io/worker-\n```\n\n### ä»»åŠ¡å…­ï¼šå®‰è£…ç½‘ç»œæ’ä»¶(master)\n\nå®‰è£…calico\n\n```Shell\nmkdir /data/calico\ncd  /data/calico\nwget https://docs.tigera.io/archive/v3.25/manifests/calico.yaml\n#ä¿®æ”¹calico.yamlæ‰¾åˆ°CALICO_IPV4POOL_CIDR\nvi calico.yaml\n##############ä¿®æ”¹å†…å®¹###################\n value: \"10.244.0.0/16\"\n ##############ä¿®æ”¹å†…å®¹###################\n #åœ¨masterèŠ‚ç‚¹ä¸Šå®‰è£…calico\n kubectl apply -f calico.yaml\n```\n\næŸ¥çœ‹èŠ‚ç‚¹çŠ¶æ€\n\n```Shell\n# æŸ¥çœ‹æ‰€æœ‰çš„èŠ‚ç‚¹\nkubectl get nodes\nkubectl get nodes -o wide\n#æŸ¥çœ‹é›†ç¾¤å¥åº·æƒ…å†µ\n kubectl get cs\n```\n\n### ä»»åŠ¡ä¸ƒï¼šå®‰è£…nginxè¿›è¡Œæµ‹è¯•\n\n```Shell\n# åˆ›å»ºNginxç¨‹åº\nkubectl create deployment nginx --image=nginx\n# å¼€æ”¾80ç«¯å£\nkubectl expose deployment nginx --port=80 --type=NodePort\n# æŸ¥çœ‹podçŠ¶æ€\nkubectl get pod\n#æŸ¥çœ‹serviceçŠ¶æ€\nkubectl get service\n##########################################################################\nNAME         TYPE        CLUSTER-IP      EXTERNAL-IP   PORT(S)        AGE\nkubernetes   ClusterIP   10.96.0.1       <none>        443/TCP        5d1h\nnginx        NodePort    10.98.221.224   <none>        80:32743/TCP   23s\n##########################################################################\n# è®¿é—®ç½‘é¡µæµ‹è¯•(ç«¯å£å·ä»¥æŸ¥çœ‹serviceçŠ¶æ€å¾—åˆ°çš„ä¸ºå‡†)\nhttp://10.10.3.121:32743/\n```\n\n### ä»»åŠ¡å…«ï¼šå®‰è£…**Dashboardç•Œé¢**\n\n1. ä¸‹è½½yamlæ–‡ä»¶\n\n```Shell\n#åˆ›å»ºå­˜æ”¾ç›®å½•\nmkdir dashboard\ncd dashboard/\n#2.7\nwget https://raw.githubusercontent.com/kubernetes/dashboard/v2.7.0/aio/deploy/recommended.yaml\n```\n\n1. ä¿®æ”¹yamlæ–‡ä»¶\n\n```Shell\nvi recommended.yaml\n#å°†å‰¯æœ¬è®¾ç½®ä¸º2\n#################ä¿®æ”¹å†…å®¹#######################\nkind: Service\napiVersion: v1\nmetadata:\n  labels:\n    k8s-app: kubernetes-dashboard\n  name: kubernetes-dashboard\n  namespace: kubernetes-dashboard\nspec:\n  ports:\n    - port: 443\n      targetPort: 8443\n      nodePort: 32009   #æ·»åŠ è¿™ä¸€è¡Œï¼Œæ³¨æ„ç¼©è¿›å¯¹é½\n  selector:\n    k8s-app: kubernetes-dashboard\n  type: NodePort          #æ·»åŠ è¿™ä¸€è¡Œï¼Œæ³¨æ„ç¼©è¿›å¯¹é½\n  #################ä¿®æ”¹å†…å®¹#######################\n```\n\n1. åº”ç”¨å®‰è£…ï¼ŒæŸ¥çœ‹podå’Œsvc\n\n```Shell\n#å®‰è£…\nkubectl apply -f recommended.yaml\n#æŸ¥çœ‹podå’Œsvc\nkubectl get pod,svc -o wide -n kubernetes-dashboard\n#########################################################\nNAME                                             READY   STATUS              RESTARTS   AGE   IP       NODE    NOMINATED NODE   READINESS GATES\npod/dashboard-metrics-scraper-5cb4f4bb9c-mg569   0/1     ContainerCreating   0          9s    <none>   node1   <none>           <none>\npod/kubernetes-dashboard-6967859bff-2968p        0/1     ContainerCreating   0          9s    <none>   node1   <none>           <none>\n\nNAME                                TYPE        CLUSTER-IP       EXTERNAL-IP   PORT(S)         AGE   SELECTOR\nservice/dashboard-metrics-scraper   ClusterIP   10.100.129.191   <none>        8000/TCP        9s    k8s-app=dashboard-metrics-scraper\nservice/kubernetes-dashboard        NodePort    10.106.130.53    <none>        443:31283/TCP   9s    k8s-app=kubernetes-dashboard\n########################################################\n```\n\nä½¿ç”¨æ‰€æŸ¥çœ‹çš„svcï¼Œæ‰€æä¾›çš„ç«¯å£è®¿é—®**Dashboard**\n\n1. åˆ›å»ºdashboardæœåŠ¡è´¦æˆ·\n\n```Shell\n#åˆ›å»ºä¸€ä¸ªadmin-userçš„æœåŠ¡è´¦æˆ·å¹¶ä¸é›†ç¾¤ç»‘å®š\nvi dashboard-adminuser.yaml\n##################å†…å®¹####################\napiVersion: v1\nkind: ServiceAccount\nmetadata:\n  name: admin-user\n  namespace: kubernetes-dashboard\n\n---\n\napiVersion: rbac.authorization.k8s.io/v1\nkind: ClusterRoleBinding\nmetadata:\n  name: admin-user\nroleRef:\n  apiGroup: rbac.authorization.k8s.io\n  kind: ClusterRole\n  name: cluster-admin\nsubjects:\n- kind: ServiceAccount\n  name: admin-user\n  namespace: kubernetes-dashboard\n  \n---\n# åˆ›å»ºå¯†é’¥ï¼Œè·å–æœåŠ¡å¸æˆ·çš„é•¿æœŸæŒæœ‰è€…ä»¤ç‰Œ\napiVersion: v1\nkind: Secret\nmetadata:\n  name: admin-user\n  namespace: kubernetes-dashboard\n  annotations:\n    kubernetes.io/service-account.name: \"admin-user\"\ntype: kubernetes.io/service-account-token\n  ##################å†…å®¹####################\n \n  #æ‰§è¡Œç”Ÿæ•ˆ\n  kubectl apply -f dashboard-adminuser.yaml\n```\n\n1. ç™»å½•æ–¹å¼\n\næ–¹æ¡ˆä¸€ï¼šè·å–é•¿æœŸå¯ç”¨token\n\n```Shell\n#å°†å…¶ä¿å­˜åœ¨/data/dashboard/çš„admin-user.tokenæ–‡ä»¶ä¸­\ncd /data/dashboard/\nkubectl get secret admin-user -n kubernetes-dashboard -o jsonpath={\".data.token\"} | base64 -d > admin-user.token \n```\n\nè·å–é•¿æœŸå¯ç”¨tokenè„šæœ¬\n\n```Shell\n#!/bin/bash\n#ä½œè€…ï¼šäº‘\n#############æè¿°#############\n:<<!\nè·å–é•¿æœŸå¯ç”¨tokenè„šæœ¬\nå°†tokenå­˜æ”¾åœ¨admin-user.tokenæ–‡ä»¶ä¸­\n!\n#############æè¿°#############\nkubectl get secret admin-user -n kubernetes-dashboard -o jsonpath={\".data.token\"} | base64 -d > admin-user.token\n\necho -e \"\\033[1;32måˆ›å»ºtokenæˆåŠŸï¼Œè¯·åœ¨admin-user.tokenæ–‡ä»¶ä¸­æŸ¥çœ‹\\033[m\"\n```\n\næ–¹æ¡ˆäºŒï¼šä½¿ç”¨ä½¿ç”¨ Kubeconfig æ–‡ä»¶ç™»å½•\n\n```Shell\n #å®šä¹‰ token å˜é‡\n DASH_TOCKEN=$(kubectl get secret admin-user -n kubernetes-dashboard -o jsonpath={\".data.token\"} | base64 -d)\n #è®¾ç½® kubeconfig é›†ç¾¤æ¡ç›®\n kubectl config set-cluster kubernetes --server=10.10.3.121:6433 --kubeconfig=/root/dashbord-admin.conf\n #è®¾ç½® kubeconfig ç”¨æˆ·æ¡ç›®\n kubectl config set-credentials admin-user --token=$DASH_TOCKEN --kubeconfig=/root/dashbord-admin.conf\n #è®¾ç½® kubeconfig ä¸Šä¸‹æ–‡æ¡ç›®\n kubectl config set-context admin-user@kubernetes --cluster=kubernetes --user=admin-user --kubeconfig=/root/dashbord-admin.conf\n #è®¾ç½® kubeconfig å½“å‰ä¸Šä¸‹æ–‡\n kubectl config use-context admin-user@kubernetes  --kubeconfig=/root/dashbord-admin.conf\n```\n\nå°†ç”Ÿæˆçš„dashbord-admin.confæ–‡ä»¶æ”¾åˆ°æœ¬åœ°ä¸»æœºä¸Šï¼Œç™»å½•æ—¶é€‰æ‹©`Kubeconfig`é€‰é¡¹ï¼Œé€‰æ‹© kubeconfig æ–‡ä»¶ç™»å½•\n\n### ä»»åŠ¡ä¹ï¼šå®‰è£…metrics-server\n\nä¸‹è½½éƒ¨ç½²æ–‡ä»¶\n\n```Shell\nwget https://github.com/kubernetes-sigs/metrics-server/releases/latest/download/components.yaml -O metrics-server-components.yaml\n```\n\nä¿®æ”¹yamlæ–‡ä»¶ä¸­çš„Deploymentå†…å®¹\n\n```Shell\n---\napiVersion: apps/v1\nkind: Deployment\nmetadata:\n  labels:\n    k8s-app: metrics-server\n  name: metrics-server\n  namespace: kube-system\nspec:\n  selector:\n    matchLabels:\n      k8s-app: metrics-server\n  strategy:\n    rollingUpdate:\n      maxUnavailable: 0\n  template:\n    metadata:\n      labels:\n        k8s-app: metrics-server\n    spec:\n      containers:\n      - args:\n        - --cert-dir=/tmp\n        - --secure-port=4443\n        - --kubelet-preferred-address-types=InternalIP,ExternalIP,Hostname\n        - --kubelet-use-node-status-port\n        - --metric-resolution=15s\n        - --kubelet-insecure-tls  #æ·»åŠ \n        image: registry.cn-hangzhou.aliyuncs.com/google_containers/metrics-server:v0.6.4 #ä¿®æ”¹\n        imagePullPolicy: IfNotPresent\n\n#å®‰è£…\nkubectl apply -f metrics-server-components.yaml\n```\n\næŸ¥çœ‹metrics-serverçš„podçŠ¶æ€\n\n```Shell\nkubectl get pods --all-namespaces | grep metrics\n```\n\nç­‰å¾…ä¸€äº›æ—¶é—´ï¼ŒæŸ¥çœ‹æŸ¥çœ‹å„ç±»ç›‘æ§å›¾åƒå·²æˆåŠŸæ˜¾ç¤ºã€‚\n\n![image-20240323222536472](é«˜å¯ç”¨k8sé›†ç¾¤éƒ¨ç½²æŒ‡å—/image-20240323222536472-1711203940377-3.png)\n\n### ä»»åŠ¡åï¼škubectlå‘½ä»¤è‡ªåŠ¨è¡¥å…¨\n\n```Shell\nyum -y install bash-completion\nsource /usr/share/bash-completion/bash_completion\necho 'source <(kubectl completion bash)' >>  ~/.bashrc\nbash\n```\n\n### ä»»åŠ¡åä¸€ï¼šingress-nginxæ§åˆ¶å™¨å®‰è£…\n\n```Shell\n#ä¸‹è½½yamlæ–‡ä»¶\nwget https://raw.githubusercontent.com/kubernetes/ingress-nginx/controller-v1.0.0/deploy/static/provider/baremetal/deploy.yaml\n#ä¿®æ”¹yamlæ–‡ä»¶ä¸­æ‹‰å–é•œåƒçš„åœ°å€\n#####################ä¿®æ”¹å†…å®¹######################\nwilldockerhub/ingress-nginx-controller:v1.0.0\nhzde0128/kube-webhook-certgen:v1.0\n#####################ä¿®æ”¹å†…å®¹######################\n#ä¿®æ”¹Deploymentä¿®æ”¹æˆDaemonSet\n#ä¿®æ”¹ç½‘ç»œæ¨¡å¼ä¸ºhost network\n#####################ä¿®æ”¹å†…å®¹######################\ntemplate:\n  spec:\n    hostNetwork: true\n    dnsPolicy: ClusterFirstWithHostNet\n    tolerations:  #ä½¿ç”¨äº²å’Œæ€§é…ç½®å¯åœ¨æ‰€æœ‰èŠ‚ç‚¹éƒ¨ç½²\n      - key: node-role.kubernetes.io/control-plane\n        operator: Exists\n        effect: NoSchedule\n     nodeSelector:\n          kubernetes.io/os: linux\n          custem/ingress-controller-ready: 'true'\n      containers:\n        - name: controller\n#####################ä¿®æ”¹å†…å®¹######################\n#ä¸ºå·¥ä½œèŠ‚ç‚¹è®¾ç½®æ ‡ç­¾ï¼ˆå¿…éœ€ï¼‰\nkubectl label nodes future-k8s-node0 custem/ingress-controller-ready=true\nkubectl label nodes future-k8s-node1 custem/ingress-controller-ready=true\nkubectl label nodes future-k8s-node2 custem/ingress-controller-ready=true\nkubectl label nodes future-k8s-node3 custem/ingress-controller-ready=true\n\n#å®‰è£…\nkubectl apply -f deploy.yaml\n\n#æŸ¥çœ‹çŠ¶æ€\nkubectl get pods -n ingress-nginx\n################çŠ¶æ€##################\nNAME                                       READY   STATUS      RESTARTS   AGE\ningress-nginx-admission-create-2lz4v       0/1     Completed   0          5m46s\ningress-nginx-admission-patch-c6896        0/1     Completed   0          5m46s\ningress-nginx-controller-7575fb546-q29qn   1/1     Running     0          5m46s\n```\n\n### ä»»åŠ¡åäºŒï¼šé…ç½®**Dashboardä»£ç†**\n\n```Shell\necho '\napiVersion: networking.k8s.io/v1\nkind: Ingress\nmetadata:\n  name: k8s-dashboard\n  namespace: kubernetes-dashboard\n  labels:\n    ingress: k8s-dashboard\n  annotations:\n    nginx.ingress.kubernetes.io/rewrite-target: /  #é‡å†™è·¯å¾„\n    nginx.ingress.kubernetes.io/force-ssl-redirect: \"true\"  #httpè‡ªåŠ¨è½¬https\n    nginx.ingress.kubernetes.io/use-regex: \"true\"\n    nginx.ingress.kubernetes.io/backend-protocol: \"HTTPS\"\n\nspec:\n  ingressClassName: nginx \n  rules:\n    - host: k8s.yjs.51xueweb.cn\n      http:\n        paths:\n          - path: /\n            pathType: Prefix\n            backend:\n              service:\n                name: kubernetes-dashboard\n                port:\n                  number: 443\n' > /data/dashboard/dashboard-ingress.yaml\n```","tags":["k8s","é«˜å¯ç”¨","k8sé›†ç¾¤","docker","Kubeadm"],"categories":["å®¹å™¨åŒ–","k8s"]},{"title":"cephé›†ç¾¤éƒ¨ç½²æŒ‡å—","url":"/yyg/3fc2a251/","content":"## ä»»åŠ¡ç›®æ ‡\n\n1. å®Œæˆcephé›†ç¾¤éƒ¨ç½²\n\n## ä»»åŠ¡å¹³å°\n\n1. ç‰©ç†è®¾å¤‡--\n2. æ“ä½œç³»ç»Ÿï¼šopenEuler 22.03 LTS SP2\n\n## éƒ¨ç½²æŒ‡å—\n\n### ä»»åŠ¡ä¸€ï¼šé…ç½®å‡†å¤‡\n\n1. é‡å‘½åhostname\n\n```Shell\n# å°†10.10.3.117çš„ä¸»æœºåæ”¹ä¸ºfuture-ceph-node0\nhostnamectl set-hostname future-ceph-node0 && bash\n# å°†10.10.3.118çš„ä¸»æœºåæ”¹ä¸ºfuture-ceph-node1\nhostnamectl set-hostname future-ceph-node1 && bash\n# å°†10.10.3.119çš„ä¸»æœºåæ”¹ä¸ºfuture-ceph-node2\nhostnamectl set-hostname future-ceph-node2 && bash\n# å°†10.10.3.120çš„ä¸»æœºåæ”¹ä¸ºfuture-ceph-node3\nhostnamectl set-hostname future-ceph-node3 && bash\n```\n\n1. å®‰è£…å‰çš„é…ç½®ä¿®æ”¹\n\n```Shell\n# å…³é—­é˜²ç«å¢™\nsystemctl stop firewalld\nsystemctl disable firewalld\nfirewall-cmd --state\n \n# selinuxæ°¸ä¹…å…³é—­\nsetenforce 0\n sed -i 's/^SELINUX=enforcing$/SELINUX=permissive/' /etc/selinux/config\ncat /etc/selinux/config\n\n\n# æ·»åŠ hosts\ncat >> /etc/hosts << EOF\n10.10.3.117 future-ceph-node0\n10.10.3.118 future-ceph-node1\n10.10.3.119 future-ceph-node2\n10.10.3.120 future-ceph-node3\nEOF\n#æŸ¥çœ‹\ncat /etc/hosts\n\n\n#åŒæ­¥æ—¶é—´\nyum install ntp -y\nsystemctl start ntpd\nsystemctl enable ntpd\nyum install chrony  -y\nsystemctl start chronyd\nsystemctl enable chronyd\n#ä¿®æ”¹é…ç½®ï¼Œæ·»åŠ å†…å®¹\necho \"\nserver 10.10.3.70 iburst\nallow 10.10.3.0/24\n\" >> /etc/chrony.conf\ntimedatectl set-ntp true\nsystemctl restart chronyd\ntimedatectl status\ndate\n\næ·»åŠ èŠ‚ç‚¹SSHäº’ç›¸é€šä¿¡\nssh-keygen -t rsa\nssh-copy-id 10.10.3.118\nssh-copy-id 10.10.3.119\nssh-copy-id 10.10.3.120\n```\n\n### ä»»åŠ¡äºŒï¼šéƒ¨ç½²Cephä½œä¸ºåˆ†å¸ƒå¼å­˜å‚¨\n\né…ç½®ä¸‹è½½æº\n\n```Shell\necho \"[ceph]\nname=ceph\nbaseurl=http://mirrors.aliyun.com/ceph/rpm-mimic/el7/x86_64/\ngpgcheck=0\npriority=1\n\n[ceph-noarch]\nname=cephnoarch\nbaseurl=https://mirrors.aliyun.com/ceph/rpm-mimic/el7/noarch/\ngpgcheck=0\npriority=1\n\n[ceph-source]\nname=Ceph source packages\nbaseurl=http://mirrors.aliyun.com/ceph/rpm-mimic/el7/SRPMS/\nenabled=0\ngpgcheck=1\ntype=rpm-md\ngpgkey=https://mirrors.aliyun.com/ceph/keys/release.asc\npriority=1\n\" >/etc/yum.repos.d/ceph.repo\n```\n\nä¸‹è½½python2\n\n1. å®‰è£…[zlib](https://so.csdn.net/so/search?q=zlib&spm=1001.2101.3001.7020)åº“ï¼Œä¸ç„¶å®‰è£…pipæ—¶ä¼šæŠ¥é”™ï¼ˆè¿˜è¦é‡æ–°ç¼–è¯‘pythonï¼‰\n\n```Plain\n yum -y install zlib*\n```\n\n1. å®‰è£… GCC åŒ…ï¼Œå¦‚æœæ²¡æœ‰å®‰è£… GCCï¼Œè¯·ä½¿ç”¨ä»¥ä¸‹å‘½ä»¤è¿›è¡Œå®‰è£…\n\n```Shell\nyum -y install gcc openssl-devel bzip2-devel\n```\n\n1. ä¸‹è½½Python-2.7.18\n\n```Plain\n cd /usr/src\n yum -y install wget\n wget https://www.python.org/ftp/python/2.7.18/Python-2.7.18.tgz\n tar xzf Python-2.7.18.tgz\n```\n\n1. åœ¨ç¼–è¯‘ä¹‹å‰è¿˜éœ€è¦åœ¨å®‰è£…æºæ–‡ä»¶ä¸­ä¿®æ”¹Modules/Setup.distæ–‡ä»¶ï¼Œå°†æ³¨é‡Šå»æ‰\n\n```Shell\n#zlib zlibmodule.c -I$(prefix)/include -L$(exec_prefix)/lib -lz\n```\n\n1.  ç¼–è¯‘Python-2.7.18ï¼ˆ`make altinstall`ç”¨äºé˜²æ­¢æ›¿æ¢é»˜è®¤çš„ python äºŒè¿›åˆ¶æ–‡ä»¶ /usr/bin/pythonï¼‰\n\n```Shell\ncd /usr/src/Python-2.7.18\n./configure --enable-optimizations\nyum install -y make\nmake altinstall\n```\n\nä¸è¦è¦†ç›–æˆ–é“¾æ¥åŸå§‹çš„ Python äºŒè¿›åˆ¶æ–‡ä»¶ï¼Œè¿™å¯èƒ½ä¼šæŸåç³»ç»Ÿ\n\n1. è®¾ç½®ç¯å¢ƒå˜é‡\n\n```Shell\nvi /etc/profile\nexport PYTHON_HOME=/usr/local/\nPATH=$PATH:$PYTHON_HOME/bin\nsource /etc/profile\n```\n\n1. ä¸‹è½½å®‰è£…pipçš„è„šæœ¬\n\n```Shell\ncurl \"https://bootstrap.pypa.io/pip/2.7/get-pip.py\" -o \"get-pip.py\"\n```\n\n1. è¿è¡Œä¸‹è½½å®‰è£…è„šæœ¬\n\n```Shell\npython2.7 get-pip.py \n```\n\nä¸‹è½½ceph\n\n```Shell\n#future-ceph-node0ä¸‹è½½\npip2 install ceph-deploy\nyum install -y ceph ceph-radosgw\n#å…¶ä»–èŠ‚ç‚¹ä¸‹è½½\nyum install -y ceph ceph-radosgw\n#æ£€æŸ¥å®‰è£…åŒ…æ˜¯å¦å®Œæ•´\nrpm -qa |egrep -i \"ceph|rados|rbd\"\n```\n\n#### éƒ¨ç½²cephé›†ç¾¤\n\n##### ç®¡ç†èŠ‚ç‚¹\n\n###### éƒ¨ç½²Monitor\n\n1. åˆ›å»ºé…ç½®æ–‡ä»¶ç›®å½•ï¼Œå¹¶åˆ›å»ºé…ç½®æ–‡ä»¶\n\n```Properties\nmkdir /etc/ceph/\ntouch /etc/ceph/ceph.conf\n```\n\n1. ä¸ºé›†ç¾¤ç”Ÿæˆä¸€ä¸ªFSDIï¼š\n\n```Ruby\nuuidgen\n38ac0084-40b7-4c93-b561-a16d6a6478c5\n```\n\n1. é›†ç¾¤åˆ›å»ºä¸€ä¸ªé’¥åŒ™ä¸²ï¼Œä¸ºMonitor æœåŠ¡åˆ›å»ºä¸€ä¸ªå¯†é’¥ï¼š\n\n```Ruby\nceph-authtool --create-keyring /tmp/ceph.mon.keyring --gen-key -n mon. --cap mon 'allow *'\n```\n\n1. åˆ›å»ºä¸€ä¸ªç®¡ç†å‘˜é’¥åŒ™ä¸²ï¼Œç”Ÿæˆä¸€ä¸ªclient.adminç”¨æˆ·ï¼Œå¹¶å°†æ­¤ç”¨æˆ·æ·»åŠ åˆ°é’¥åŒ™ä¸²ä¸­ï¼š\n\n```Go\nceph-authtool --create-keyring /etc/ceph/ceph.client.admin.keyring --gen-key -n client.admin --cap mon 'allow *' --cap osd 'allow *' --cap mds 'allow *' --cap mgr 'allow *'\n```\n\n1. åˆ›å»ºbootstrap-osdé’¥åŒ™ä¸²ï¼Œå°†client.bootstrap-osd ç”¨æˆ·æ·»åŠ åˆ°æ­¤é’¥åŒ™ä¸²ä¸­ï¼š\n\n```TypeScript\nceph-authtool --create-keyring /var/lib/ceph/bootstrap-osd/ceph.keyring --gen-key -n client.bootstrap-osd --cap mon 'profile bootstrap-osd'\n```\n\n1. å°†ç”Ÿæˆçš„keyåŠ å…¥ceph.mon.keyring.\n\n```TypeScript\nceph-authtool /tmp/ceph.mon.keyring --import-keyring /etc/ceph/ceph.client.admin.keyring\n\nceph-authtool /tmp/ceph.mon.keyring --import-keyring /var/lib/ceph/bootstrap-osd/ceph.keyring\n```\n\n1. ä½¿ç”¨ä¸»æœºåå’ŒIPåœ°å€ä»¥åŠFSIDç”Ÿæˆmonitor map:\n\n```YAML\nmonmaptool --create --add future-ceph-node0 10.10.3.117 --fsid 79fd2206-39ca-4ec4-9cd2-96e065c6361e /tmp/monmap\n```\n\n1. åˆ›å»ºmonçš„ç›®å½•,ä½¿ç”¨ `é›†ç¾¤åç§°-ä¸»æœºå`çš„å½¢å¼ï¼š\n\n```Shell\n mkdir  /var/lib/ceph/mon/ceph-future-ceph-node0\n```\n\n1. å¡«å…¥ç¬¬ä¸€ä¸ªmonå®ˆæŠ¤è¿›ç¨‹çš„ä¿¡æ¯:\n\n```TOML\nceph-mon --mkfs -i future-ceph-node0 --monmap /tmp/monmap --keyring /tmp/ceph.mon.keyring\n```\n\n1. é…ç½®/etc/ceph/ceph.confæ–‡ä»¶ï¼š\n\n```Shell\ncat /etc/ceph/ceph.conf\n################################################\n[global]\nfsid = 79fd2206-39ca-4ec4-9cd2-96e065c6361e     # ç”Ÿæˆçš„FSID\nmon initial members =future-ceph-node0\nmon host = 10.10.3.117\npublic network = 10.10.3.0/24\nauth cluster required = cephx\nauth service required = cephx\nauth client required = cephx\nosd journal size = 1024\nosd pool default size = 3\nosd pool default min size = 2\nosd pool default pg num = 333\nosd pool default pgp num = 333\nosd crush chooseleaf type = 1\n\n################################################\n```\n\n1. ç”±äºæˆ‘ä»¬ä½¿ç”¨ä½¿ç”¨rootæ“ä½œçš„ï¼Œéœ€è¦è®¾ç½®æƒé™ä¸ºcephï¼ˆä¹Ÿå¯ä»¥ä¿®æ”¹systemdçš„å¯åŠ¨æ–‡ä»¶ï¼Œå°†cephç”¨æˆ·æ”¹ä¸ºrootï¼‰ï¼Œå¹¶å¯åŠ¨Monitor\n\n```Shell\nchown  -R ceph:ceph /var/lib/ceph\nsystemctl start ceph-mon@future-ceph-node0.service\nsystemctl enable ceph-mon@future-ceph-node0.service\n```\n\n1. ç¡®è®¤æœåŠ¡å·²ç»æ­£å¸¸å¯åŠ¨ï¼š\n\n```Shell\nceph -s\nyum install -y net-tools\nnetstat -lntp|grep ceph-mon\n```\n\n###### éƒ¨ç½²Manager\n\nå½“æˆ‘ä»¬é…ç½®å¥½ceph-monæœåŠ¡ä¹‹åï¼Œå°±éœ€è¦é…ç½®ceph-mgræœåŠ¡ã€‚\n\n1. ç”Ÿæˆä¸€ä¸ªè®¤è¯å¯†é’¥(ceph-mgrä¸ºè‡ªå®šä¹‰çš„åç§°)ï¼š\n\n```Shell\n#10.10.3.117\nceph auth get-or-create mgr.ceph-mgr mon 'allow profile mgr' osd 'allow *' mds 'allow *'\n[mgr.ceph-mgr]\n        key = AQBMNTZl5adxEhAAk6Jk/CKNWUyNb2DoKXUPvQ==\n        \n#10.10.3.118\nceph auth get-or-create mgr.ceph-mgr1 mon 'allow profile mgr' osd 'allow *' mds 'allow *'\n[mgr.ceph-mgr1]\n        key = AQDbRTZlgjXWBBAAGew4Xta+t9vgIWPCWC8EVg==\n```\n\n1. åˆ›å»ºå­˜æ”¾æ­¤å¯†é’¥çš„æ–‡ä»¶çš„ç›®å½•\n\n```Shell\n#10.10.3.117\nsudo -u ceph mkdir /var/lib/ceph/mgr/ceph-ceph-mgr\n#å°†äº§ç”Ÿçš„å¯†é’¥æ–‡ä»¶å­˜å…¥æ­¤ç›®å½•ä¸‹ï¼Œå¹¶å‘½åä¸ºkeyring\nvi /var/lib/ceph/mgr/ceph-ceph-mgr/keyring \n[mgr.ceph-mgr]\n        key = AQBMNTZl5adxEhAAk6Jk/CKNWUyNb2DoKXUPvQ==\n        \n#10.10.3.118\nsudo -u ceph mkdir /var/lib/ceph/mgr/ceph-ceph-mgr1\n#å°†äº§ç”Ÿçš„å¯†é’¥æ–‡ä»¶å­˜å…¥æ­¤ç›®å½•ä¸‹ï¼Œå¹¶å‘½åä¸ºkeyring\nvi /var/lib/ceph/mgr/ceph-ceph-mgr1/keyring \n[mgr.ceph-mgr1]\n        key = AQDbRTZlgjXWBBAAGew4Xta+t9vgIWPCWC8EVg==\n```\n\n1. å¯åŠ¨ceph-mgræœåŠ¡\n\n```Shell\nceph-mgr -i ceph-mgr\nceph-mgr -i ceph-mgr1\nsystemctl enable ceph-mgr@future-ceph-node0\nsystemctl enable ceph-mgr@future-ceph-node1\n#æ£€æŸ¥æœåŠ¡æ˜¯å¦å¯åŠ¨ï¼ŒæŸ¥çœ‹cephçŠ¶æ€\nceph -s\n#æŸ¥çœ‹å½“å‰mgrä¸­å¯ç”¨çš„æ¨¡å—\nceph mgr module ls\n```\n\n###### åˆ›å»ºOSD\n\n```Shell\nceph-volume lvm create --data /dev/sdb\n#æŸ¥çœ‹å½“å‰çš„lvmé€»è¾‘å·\nceph-volume lvm list\n#æŸ¥çœ‹cephçŠ¶æ€\nceph -s\n```\n\n###### å®‰è£…é…ç½®Ceph-dashboard\n\n1. å¼€å¯dashboardåŠŸèƒ½\n\n```Shell\nceph mgr module enable dashboard\n```\n\n1. åˆ›å»ºè¯ä¹¦\n\n```Shell\nceph dashboard create-self-signed-cert\n```\n\n1. é…ç½®webç™»å½•çš„ç”¨æˆ·åå’Œå¯†ç \n\n```Shell\n #åˆ›å»º/etc/ceph/dashboard.keyï¼Œå¹¶å°†å¯†ç å†™å…¥\n echo \"å¯†ç \" >/etc/ceph/dashboard.key\n ceph dashboard ac-user-create k8s administrator -i /etc/ceph/dashboard.key\n```\n\n1. ä¿®æ”¹dashboardé»˜è®¤ç«¯å£(å¯é€‰)\n\né…ç½®ç«¯å£ï¼Œé»˜è®¤ç«¯å£æ˜¯8443ï¼Œä¿®æ”¹ä¸º18443ï¼Œä¿®æ”¹åéœ€é‡å¯mgrï¼Œä¿®æ”¹ç«¯å£æ‰ç”Ÿæ•ˆã€‚\n\n```Shell\nceph config set mgr mgr/dashboard/server_port 18443\nsystemctl restart ceph-mgr.target\n```\n\n1. æŸ¥çœ‹å‘å¸ƒæœåŠ¡åœ°å€å¹¶ç™»å½•\n\n```Shell\nceph mgr services\n```\n\n> {\n>\n> â€‹    \"dashboard\": \"https://future-ceph-node0:8443/\"\n>\n> }\n>\n> ![image-20240323222001957](cephé›†ç¾¤éƒ¨ç½²æŒ‡å—/image-20240323222001957-1711203607034-1.png)\n\n##### nodeèŠ‚ç‚¹\n\n###### æ‰©å±•Monitor\n\n1. ä¿®æ”¹masterèŠ‚ç‚¹ä¸Šçš„é…ç½®\n\n```Shell\nvi /etc/ceph/ceph.conf\n[global]\nfsid = 79fd2206-39ca-4ec4-9cd2-96e065c6361e     # ç”Ÿæˆçš„FSID\nmon initial members =future-ceph-node0,future-ceph-node1,future-ceph-node2,future-ceph-node3            # ä¸»æœºå\nmon host = 10.10.3.117,10.10.3.118,10.10.3.119,10.10.3.120                       # å¯¹åº”çš„IP\npublic network = 10.10.3.0/24\nauth cluster required = cephx\nauth service required = cephx\nauth client required = cephx\nosd journal size = 1024\nosd pool default size = 3\nosd pool default min size = 2\nosd pool default pg num = 333\nosd pool default pgp num = 333\nosd crush chooseleaf type = 1\n[mon]\nmon allow pool delete = true\n\n[mds.future-ceph-node0]\nhost = future-ceph-node0\n```\n\n1. å°†é…ç½®å’Œå¯†é’¥æ–‡ä»¶åˆ†å‘åˆ°å…¶å®ƒçš„èŠ‚ç‚¹ä¸Šï¼ˆmasterèŠ‚ç‚¹ï¼‰\n\n```Shell\n#ç”Ÿæˆå…¬é’¥ï¼Œå¤åˆ¶åˆ°nodeèŠ‚ç‚¹ä¸»æœºä¸Š\nssh-keygen -t rsa\nssh-copy-id 10.10.3.118\nssh-copy-id 10.10.3.119\nssh-copy-id 10.10.3.120\n#å¤åˆ¶è®¤è¯å¯†é’¥\nscp /etc/ceph/*  10.10.3.118:/etc/ceph/\nscp /etc/ceph/*  10.10.3.119:/etc/ceph/\nscp /etc/ceph/*  10.10.3.120:/etc/ceph/\n```\n\n1. åœ¨nodeèŠ‚ç‚¹åˆ›å»ºcephç›¸å…³ç›®å½•ï¼Œå¹¶æ·»åŠ æƒé™ï¼š\n\n```Shell\nmkdir -p  /var/lib/ceph/{bootstrap-mds,bootstrap-mgr,bootstrap-osd,bootstrap-rbd,bootstrap-rgw,mds,mgr,mon,osd}\nchown  -R ceph:ceph /var/lib/ceph\n\nsudo -u ceph mkdir /var/lib/ceph/mon/ceph-future-ceph-node1\nsudo -u ceph mkdir /var/lib/ceph/mon/ceph-future-ceph-node2\nsudo -u ceph mkdir /var/lib/ceph/mon/ceph-future-ceph-node3\n```\n\n1. ä¿®æ”¹nodeèŠ‚ç‚¹çš„é…ç½®æ–‡ä»¶,ä»¥node1ä¸ºä¾‹ï¼ˆå…¶ä»–èŠ‚ç‚¹ç›¸ä¼¼ï¼‰\n\n```Shell\n[global]\nfsid = 79fd2206-39ca-4ec4-9cd2-96e065c6361e     # ç”Ÿæˆçš„FSID\nmon initial members =future-ceph-node0,future-ceph-node1,future-ceph-node2,future-ceph-node3            # ä¸»æœºå\nmon host = 10.10.3.117,10.10.3.118,10.10.3.119,10.10.3.120                       # å¯¹åº”çš„IP\npublic network = 10.10.3.0/24\nauth cluster required = cephx\nauth service required = cephx\nauth client required = cephx\nosd journal size = 1024\nosd pool default size = 3\nosd pool default min size = 2\nosd pool default pg num = 333\nosd pool default pgp num = 333\nosd crush chooseleaf type = 1\n[mon]\nmon allow pool delete = true\n\n[mon.future-ceph-node1]\nmon_addr = 10.10.3.118:6789\nhost = future-ceph-node1\n```\n\n1. è·å–é›†ç¾¤ä¸­çš„å¯†é’¥å’Œmap,ä»¥node1ä¸ºä¾‹ï¼ˆå…¶ä»–èŠ‚ç‚¹ç›¸ä¼¼ï¼‰\n\n```Properties\nceph auth get mon. -o /tmp/monkeyring\nceph mon getmap -o /tmp/monmap\n```\n\n1. ä½¿ç”¨å·²æœ‰çš„å¯†é’¥å’Œmapæ·»åŠ ä¸€ä¸ªæ–°çš„Monitor,æŒ‡å®šä¸»æœºå,ä»¥node1ä¸ºä¾‹ï¼ˆå…¶ä»–èŠ‚ç‚¹ç›¸ä¼¼ï¼‰\n\n```Perl\nsudo -u ceph ceph-mon --mkfs -i future-ceph-node1 --monmap /tmp/monmap --keyring /tmp/monkeyring\n```\n\n1. å¯åŠ¨æœåŠ¡,ä»¥node1ä¸ºä¾‹ï¼ˆå…¶ä»–èŠ‚ç‚¹ç›¸ä¼¼ï¼‰\n\n```Nginx\nsystemctl start ceph-mon@future-ceph-node1\nsystemctl enable ceph-mon@future-ceph-node1\n#æŸ¥çœ‹monçŠ¶æ€\nceph -s\nceph mon stat\n```\n\n###### æ·»åŠ OSD\n\nä»å·²ç»å­˜åœ¨çš„osdçš„masterèŠ‚ç‚¹ä¸Šæ‹·è´åˆå§‹åŒ–çš„å¯†é’¥æ–‡ä»¶\n\n```Shell\nscp -p  /var/lib/ceph/bootstrap-osd/ceph.keyring  10.10.3.118:/var/lib/ceph/bootstrap-osd/\nscp -p  /var/lib/ceph/bootstrap-osd/ceph.keyring  10.10.3.119:/var/lib/ceph/bootstrap-osd/\nscp -p  /var/lib/ceph/bootstrap-osd/ceph.keyring  10.10.3.120:/var/lib/ceph/bootstrap-osd/\n```\n\nåœ¨nodeèŠ‚ç‚¹æ·»åŠ osd\n\n```Shell\nceph-volume lvm create --data /dev/sdb\n\nsystemctl restart ceph-osd@future-ceph-node1\nsystemctl enable ceph-osd@future-ceph-node1\n#æŸ¥çœ‹çŠ¶æ€\nceph -s\n```\n\n#### æ·»åŠ Mds\n\n```Shell\n#åˆ›å»ºç›®å½•\nsudo -u ceph mkdir -p /var/lib/ceph/mds/ceph-future-ceph-node0\n#åˆ›å»ºå¯†é’¥\nceph-authtool --create-keyring /var/lib/ceph/mds/ceph-future-ceph-node0/keyring --gen-key -n mds.future-ceph-node0\n#å¯¼å…¥å¯†é’¥ï¼Œå¹¶è®¾ç½®caps\nceph auth add mds.future-ceph-node0 osd \"allow rwx\" mds \"allow\" mon \"allow profile mds\" -i /var/lib/ceph/mds/ceph-future-ceph-node0/keyring\n#æ‰‹åŠ¨å¯åŠ¨æœåŠ¡\nceph-mds --cluster ceph -i future-ceph-node0 -m future-ceph-node0:6789\n chown -R ceph:ceph /var/lib/ceph/mds/\n systemctl start ceph-mds@future-ceph-node0\n systemctl enable ceph-mds@future-ceph-node0\n #æ£€æŸ¥æœåŠ¡æ˜¯å¦å¯åŠ¨\n ps -ef|grep ceph-mds\n #æ£€æŸ¥ceph é›†ç¾¤çŠ¶æ€\n ceph -s\n```\n\n#### åˆ›å»ºCephFS\n\nåˆ›å»ºpools\n\n```Shell\n#å­˜å‚¨æ•°æ®\nceph osd pool create cephfs_data 64\n#å­˜å‚¨å…ƒæ•°æ®\nceph osd pool create cephfs_metadata 64\n#å¯ç”¨cephfsæ–‡ä»¶ç³»ç»Ÿ\nceph fs new cephfs cephfs_metadata cephfs_data\n#æŸ¥çœ‹æ–‡ä»¶ç³»ç»ŸçŠ¶æ€\nceph fs ls\nceph mds stat\n```\n\n1. æŒ‚è½½cephfs\n\nå†…æ ¸é©±åŠ¨æŒ‚è½½\n\n```Shell\n#å®‰è£…ä¾èµ–\nyum install -y ceph-common\n#åˆ›å»ºæŒ‚è½½ç‚¹\nmkdir /data\n#è·å–å­˜å‚¨å¯†é’¥ï¼ˆç®¡ç†èŠ‚ç‚¹ï¼‰\ncat /etc/ceph/ceph.client.admin.keyring\n#å°†117ä¸­çš„/data æŒ‚è½½åˆ°å…¶ä»–ä¸»æœºçš„/data\n mount -t ceph 10.10.3.117:6789:/ /data -o name=admin,secret=AQBLfS9l612IGhAAOF1iJqT6+rHJPCxqQegqCA==\n \n #å¸è½½\numount /data  \n```\n\nç”¨æˆ·æ§ä»¶æŒ‚è½½\n\n```Shell\nyum install ceph-fuse -y\n#æŒ‚è½½åˆ°å…¶ä»–ä¸»æœº\nceph-fuse -m  10.10.3.117:6789 /data\n#æŸ¥çœ‹æŒ‚è½½é…ç½®\ndf -h |grep code\n\n#å¸è½½\nfusermount -u /mnt/cephfs\n```\n\n### åˆ›å»ºrbdæ± \n\n```Shell\n#åˆ›å»ºrbdæ± \nceph osd pool create rbd-k8s 64 64\n#å¯ç”¨ \nceph osd pool application enable rbd-k8s rbd\n#åˆå§‹åŒ–\nrbd pool init rbd-k8s\n#æŸ¥çœ‹\nceph osd lspools\n#æŸ¥çœ‹æ˜ åƒ\n rbd ls rbd-k8s\n #æŸ¥çœ‹æ˜ åƒä¿¡æ¯\n rbd info --pool rbd-k8s --image mars-c09bb992-963e-43dd-8e5c-e3a1d723b1c8 \n#æ˜ å°„é•œåƒ\n rbd map  --pool rbd-k8s --image mars-c09bb992-963e-43dd-8e5c-e3a1d723b1c8\n #æ ¼å¼åŒ–\n mkfs.ext4 /dev/rbd0\n #æŒ‚è½½åˆ°æœ¬åœ°\n  mount /dev/rbd0 /data/code\n  #æŸ¥çœ‹\n  lsblk\n  #å–æ¶ˆæŒ‚è½½\n   umount /dev/rbd0\n   #å–æ¶ˆæ˜ å°„\n   rbd unmap /dev/rbd0\n   \n```","tags":["ceph","å…±äº«å­˜å‚¨","cephé›†ç¾¤"],"categories":["å­˜å‚¨ç³»ç»Ÿ","ceph"]},{"title":"Kubeadmæ–¹å¼æ­å»ºK8Sé›†ç¾¤","url":"/yyg/12690776/","content":"### ç¯å¢ƒå‡†å¤‡\n\nåœ¨è™šæ‹Ÿæœºé‡Œå®‰è£…ä¸‰å°centos 7.xæ“ä½œç³»ç»Ÿ\n\né…ç½®ç³»ç»Ÿåç§°å’Œipåœ°å€(åŒä¸€ç½‘æ®µ)å¦‚ï¼š\n\n| è§’è‰²   | IP             |\n| ------ | -------------- |\n| master | 192.168.66.100 |\n| node1  | 192.168.66.101 |\n| node2  | 192.168.66.102 |\n\nä¸‰å°æœºå™¨éƒ½è¦æ‰§è¡Œçš„å‘½ä»¤:ï¼ˆä½¿ç”¨xshellæ‰§è¡Œå‘½ä»¤æ›´æ–¹ä¾¿ï¼‰\n\n```\n# å…³é—­é˜²ç«å¢™\nsystemctl stop firewalld\nsystemctl disable firewalld\n\n# selinuxæ°¸ä¹…å…³é—­\nsed -i 's/enforcing/disabled/' /etc/selinux/config\n\n# swapæ°¸ä¹…å…³é—­\nsed -ri 's/.*swap.*/#&/' /etc/fstab\n\n# æ·»åŠ hosts\ncat >> /etc/hosts << EOF\n192.168.66.100 master\n192.168.66.101 node1\n192.168.66.102 node2\nEOF\n\n# å°†æ¡¥æ¥çš„IPv4æµé‡ä¼ é€’åˆ°iptablesçš„é“¾\ncat > /etc/sysctl.d/k8s.conf << EOF\nnet.bridge.bridge-nf-call-ip6tables = 1\nnet.bridge.bridge-nf-call-iptables = 1\nEOF\n\n# ç”Ÿæ•ˆ\nsysctl --system  \n\n# æ—¶é—´åŒæ­¥\nyum install ntpdate -y\nntpdate time.windows.com\n```\n\n![image-20230516173905682](Kubeadmæ–¹å¼æ­å»ºK8Sé›†ç¾¤/image-20230516173905682.png)\n\n### å®‰è£…Dockerï¼ˆä¸‰å°æœºå™¨éƒ½éœ€è¦å®‰è£…ï¼‰\n\né…ç½®Dockerçš„é˜¿é‡Œyumæº\n\n```\ncat >/etc/yum.repos.d/docker.repo<<EOF\n[docker-ce-edge]\nname=Docker CE Edge - \\$basearch\nbaseurl=https://mirrors.aliyun.com/docker-ce/linux/centos/7/\\$basearch/edge\nenabled=1\ngpgcheck=1\ngpgkey=https://mirrors.aliyun.com/docker-ce/linux/centos/gpg\nEOF\n```\n\nä»¥yumæ–¹å¼å®‰è£…docker\n\n```\n# yumå®‰è£…\nyum -y install docker-ce\n\n# æŸ¥çœ‹dockerç‰ˆæœ¬\ndocker --version  \n\n# å¯åŠ¨docker\nsystemctl enable docker\nsystemctl start docker\n```\n\n![image-20230516180634916](Kubeadmæ–¹å¼æ­å»ºK8Sé›†ç¾¤/image-20230516180634916.png)\n\né…ç½®dockerçš„é•œåƒæº\n\n```\ncat >> /etc/docker/daemon.json << EOF\n{\n  \"registry-mirrors\": [\"https://b9pmyelo.mirror.aliyuncs.com\"]\n}\nEOF\n```\n\né‡å¯docker\n\n```\nsystemctl restart docker\n```\n\n###  æ·»åŠ kubernetesè½¯ä»¶æº\n\né…ç½®yumçš„k8sè½¯ä»¶æº\n\n```\ncat > /etc/yum.repos.d/kubernetes.repo << EOF\n[kubernetes]\nname=Kubernetes\nbaseurl=https://mirrors.aliyun.com/kubernetes/yum/repos/kubernetes-el7-x86_64\nenabled=1\ngpgcheck=0\nrepo_gpgcheck=0\ngpgkey=https://mirrors.aliyun.com/kubernetes/yum/doc/yum-key.gpg https://mirrors.aliyun.com/kubernetes/yum/doc/rpm-package-key.gpg\nEOF\n```\n\n### å®‰è£…kubeadmï¼Œkubeletå’Œkubectl\n\nç”±äºç‰ˆæœ¬æ›´æ–°é¢‘ç¹ï¼Œè¿™é‡ŒæŒ‡å®šç‰ˆæœ¬å·éƒ¨ç½²ï¼š\n\n```\n# å®‰è£…kubeletã€kubeadmã€kubectlï¼ŒåŒæ—¶æŒ‡å®šç‰ˆæœ¬\nyum install -y kubelet-1.18.0 kubeadm-1.18.0 kubectl-1.18.0\n# è®¾ç½®å¼€æœºå¯åŠ¨\nsystemctl enable kubelet\n```\n\n### éƒ¨ç½²masterèŠ‚ç‚¹\n\nåœ¨masterèŠ‚ç‚¹æ‰§è¡Œ(æ­¤å¤„çš„192.168.66.100ä¸ºå°ç¼–masteræœºå™¨çš„ipï¼Œéœ€æ›´æ¢)\n\n```\nkubeadm init --apiserver-advertise-address=192.168.66.100 --image-repository registry.aliyuncs.com/google_containers --kubernetes-version v1.18.0 --service-cidr=10.96.0.0/12  --pod-network-cidr=10.244.0.0/16\n```\n\n![image-20230516181339201](Kubeadmæ–¹å¼æ­å»ºK8Sé›†ç¾¤/image-20230516181339201.png)\n\nç­‰å¾…å…¶å‡ºç°æˆåŠŸæç¤º\n\n![image-20230516181608215](Kubeadmæ–¹å¼æ­å»ºK8Sé›†ç¾¤/image-20230516181608215.png)\n\nç„¶åæŒ‰æç¤ºåœ¨masterèŠ‚ç‚¹ä¸Šè¾“å…¥æç¤ºå‘½ä»¤\n\n```\nmkdir -p $HOME/.kube\nsudo cp -i /etc/kubernetes/admin.conf $HOME/.kube/config\nsudo chown $(id -u):$(id -g) $HOME/.kube/config\n```\n\n![image-20230516181720076](Kubeadmæ–¹å¼æ­å»ºK8Sé›†ç¾¤/image-20230516181720076.png)\n\næŒ‰ç…§masterç”Ÿæˆçš„ä»£ç å‘é›†ç¾¤æ·»åŠ æ–°èŠ‚ç‚¹(node1å’Œnode2ä¸Šçš„æ“ä½œ)\n\nåœ¨node1å’Œnode2ä¸Šæ‰§è¡Œåœ¨masterä¸Šäº§ç”Ÿçš„kubeadm joinå‘½ä»¤ï¼šï¼ˆæ ¹æ®å®é™…è€Œå®šï¼Œä¸‹é¢çš„æ˜¯å°ç¼–æœºå™¨ä¸Šçš„ï¼Œä»…ä¾›å‚è€ƒï¼‰\n\n![image-20230516182024786](Kubeadmæ–¹å¼æ­å»ºK8Sé›†ç¾¤/image-20230516182024786.png)\n\n```\nkubeadm join 192.168.66.100:6443 --token 7fqt6v.729wvdcjmgivns7y \\\n    --discovery-token-ca-cert-hash sha256:ef79029853fa3c5454cbfc5273a636c843db0ab96e4592467b8a1490b6b6d3c6 \n```\n\næˆ‘ä»¬å°±å¯ä»¥å»MasterèŠ‚ç‚¹ æ‰§è¡Œä¸‹é¢å‘½ä»¤æŸ¥çœ‹æƒ…å†µ\n\n```\nkubectl get node\n```\n\n![image-20230516183426649](Kubeadmæ–¹å¼æ­å»ºK8Sé›†ç¾¤/image-20230516183426649.png)\n\n###  éƒ¨ç½²CNIç½‘ç»œæ’ä»¶\n\nä¸Šé¢çš„çŠ¶æ€è¿˜æ˜¯NotReadyï¼Œä¸‹é¢æˆ‘ä»¬éœ€è¦ç½‘ç»œæ’ä»¶ï¼Œæ¥è¿›è¡Œè”ç½‘è®¿é—®\n\n```\n# æ·»åŠ \nkubectl apply -f https://raw.githubusercontent.com/coreos/flannel/master/Documentation/kube-flannel.yml\n```\n\n![image-20230516183609956](Kubeadmæ–¹å¼æ­å»ºK8Sé›†ç¾¤/image-20230516183609956.png)\n\n```\n# æŸ¥çœ‹çŠ¶æ€ \nkubectl get pods -n kube-system\n```\n\n![image-20230516183655302](Kubeadmæ–¹å¼æ­å»ºK8Sé›†ç¾¤/image-20230516183655302.png)\n\næ­¤æ—¶è¿˜æœ‰æœªå¤„äºrunningçŠ¶æ€çš„podï¼Œå†ç­‰äº›æ—¶é—´ï¼Œå†æŸ¥çœ‹çŠ¶æ€ï¼Œå…¨éƒ¨å˜ä¸ºrunningçŠ¶æ€æ—¶ï¼Œæ‰§è¡Œä¸‹é¢å‘½ä»¤æŸ¥çœ‹:\n\n```\nkubectl get node\n```\n\n![image-20230516184424536](Kubeadmæ–¹å¼æ­å»ºK8Sé›†ç¾¤/image-20230516184424536.png)\n\nè¿è¡Œå®Œæˆåï¼Œæ­¤æ—¶å¯ä»¥å‘ç°ï¼Œå·²ç»å˜æˆäº†ReadyçŠ¶æ€ã€‚è‹¥è¿˜å­˜åœ¨NotReadyçŠ¶æ€çš„èŠ‚ç‚¹ï¼Œå†ç­‰äº›æ—¶é—´ï¼Œç„¶åæ‰§è¡Œ`kubectl get pods -n kube-system`å‘½ä»¤ï¼Œè‹¥çŠ¶æ€ä¸ºrunningï¼Œå†æ‰§è¡Œ`kubectl get node`æŸ¥çœ‹å³å¯\n\n###  æµ‹è¯•kubernetesé›†ç¾¤\n\nåœ¨Kubernetesé›†ç¾¤ä¸­åˆ›å»ºä¸€ä¸ªpodï¼ŒéªŒè¯æ˜¯å¦æ­£å¸¸è¿è¡Œï¼š\n\n```\n# ä¸‹è½½nginx \nkubectl create deployment nginx --image=nginx\n# æŸ¥çœ‹çŠ¶æ€\nkubectl get pod\n```\n\nå‡ºç°RunningçŠ¶æ€æ—¶ï¼Œè¡¨ç¤ºå·²ç»æˆåŠŸè¿è¡Œäº†\n\n![image-20230516185059052](Kubeadmæ–¹å¼æ­å»ºK8Sé›†ç¾¤/image-20230516185059052.png)\n\nä¸‹é¢æˆ‘ä»¬å°±éœ€è¦å°†ç«¯å£æš´éœ²å‡ºå»ï¼Œè®©å…¶å®ƒå¤–ç•Œèƒ½å¤Ÿè®¿é—®\n\n```\n# æš´éœ²ç«¯å£\nkubectl expose deployment nginx --port=80 --type=NodePort\n# æŸ¥çœ‹ä¸€ä¸‹å¯¹å¤–çš„ç«¯å£\nkubectl get pod,svc\n```\n\nèƒ½å¤Ÿçœ‹åˆ°ï¼Œæˆ‘ä»¬å·²ç»æˆåŠŸæš´éœ²äº† 80ç«¯å£ åˆ° 30374ä¸Š\n\n![image-20230516185150167](Kubeadmæ–¹å¼æ­å»ºK8Sé›†ç¾¤/image-20230516185150167.png)\n\nåœ¨æµè§ˆå™¨ä¸Šï¼Œè®¿é—®å¦‚ä¸‹åœ°å€(ä»»ä¸€ä¸€ä¸ªèŠ‚ç‚¹çš„ipåŠ ä¸Šé¢æ˜¾ç¤ºçš„ç«¯å£)\n\n```\nhttp://192.168.66.102:30374/\n```\n\nå‘ç°æˆ‘ä»¬çš„nginxå·²ç»æˆåŠŸå¯åŠ¨äº†\n\n![image-20201113204056851](Kubeadmæ–¹å¼æ­å»ºK8Sé›†ç¾¤/image-20201113204056851.png)","tags":["k8s","k8sé›†ç¾¤","docker","Kubeadm"],"categories":["å®¹å™¨åŒ–","k8s"]},{"title":"k8sé›†ç¾¤å¯¹æ¥cephé›†ç¾¤éƒ¨ç½²æŒ‡å—","url":"/yyg/57e2a956/","content":"## ä»»åŠ¡ç›®æ ‡\n\n1. å®Œæˆk8sé›†ç¾¤å¯¹æ¥cephé›†ç¾¤\n\n## ä»»åŠ¡å¹³å°\n\n1. ç‰©ç†è®¾å¤‡--\n2. æ“ä½œç³»ç»Ÿï¼šopenEuler 22.03 LTS SP2\n\n## éƒ¨ç½²æŒ‡å—\n\né‡‡ç”¨åŠ¨æ€æŒ‚è½½ceph RBDå­˜å‚¨\n\n### ä»»åŠ¡ä¸€ï¼šå®‰è£…cephå®¢æˆ·ç«¯ï¼ˆceph-commonï¼‰\n\nåœ¨k8sé›†ç¾¤çš„æ¯ä¸ªèŠ‚ç‚¹å®‰è£…ceph-common\n\n```Shell\nyum install ceph-common -y\n```\n\n### ä»»åŠ¡äºŒï¼šåŒæ­¥cpehé›†ç¾¤é…ç½®æ–‡ä»¶\n\nå°† ceph é›†ç¾¤çš„ /etc/ceph/{ceph.conf,ceph.client.admin.keyring} æ–‡ä»¶åŒæ­¥åˆ° k8s æ‰€æœ‰èŠ‚ç‚¹ä¸Š\n\n```Shell\n#é…ç½®sshå…å¯†\nssh-keygen -t rsa\nssh-copy-id 10.10.3.121\nssh-copy-id 10.10.3.122\nssh-copy-id 10.10.3.123\nssh-copy-id 10.10.3.124\n\n#æ‹·è´æ–‡ä»¶\nscp -r /etc/ceph/{ceph.conf,ceph.client.admin.keyring} 10.10.3.121:/etc/ceph\nscp -r /etc/ceph/{ceph.conf,ceph.client.admin.keyring} 10.10.3.122:/etc/ceph\nscp -r /etc/ceph/{ceph.conf,ceph.client.admin.keyring} 10.10.3.123:/etc/ceph\nscp -r /etc/ceph/{ceph.conf,ceph.client.admin.keyring} 10.10.3.124:/etc/ceph\n```\n\n### ä»»åŠ¡ä¸‰ï¼šéƒ¨ç½²ceph-csiï¼ˆä½¿ç”¨rbdï¼‰\n\n1. ä¸‹è½½ceph-csiç»„ä»¶\n\n```Shell\n#ä¸‹è½½æ–‡ä»¶\nwget https://github.com/ceph/ceph-csi/archive/refs/tags/v3.9.0.tar.gz\n#è§£å‹\nmv v3.9.0.tar.gz ceph-csi-v3.9.0.tar.gz\ntar -xzf ceph-csi-v3.9.0.tar.gz\n#è¿›å…¥ç›®å½•\ncd  ceph-csi-3.9.0/deploy/rbd/kubernetes\nmkdir /data/cephfs/csi\n#æ‹·è¿›csiä¸­ï¼Œå…±6å…­ä¸ªæ–‡ä»¶\ncp * /data/cephfs\n```\n\n1. æ‹‰å–csiç»„ä»¶æ‰€éœ€é•œåƒ\n\n```Shell\n#æŸ¥çœ‹æ‰€éœ€é•œåƒ\ngrep image csi-rbdplugin-provisioner.yaml\ngrep image csi-rbdplugin.yaml\n```\n\nåœ¨æ‰€æœ‰k8sèŠ‚ç‚¹ä¸Šæ‹‰å–æ‰€éœ€çš„é•œåƒ\n\n```Shell\n./pull-images.sh registry.k8s.io/sig-storage/csi-provisioner:v3.5.0\n./pull-images.sh registry.k8s.io/sig-storage/csi-resizer:v1.8.0\n./pull-images.sh registry.k8s.io/sig-storage/csi-snapshotter:v6.2.2\ndocker pull quay.io/cephcsi/cephcsi:v3.9.0\n./pull-images.sh registry.k8s.io/sig-storage/csi-attacher:v4.3.0\n./pull-images.sh registry.k8s.io/sig-storage/csi-node-driver-registrar:v2.8.0\n```\n\n1. åˆ›å»ºå‘½åç©ºé—´`cephfs`\n\n```Shell\necho '\napiVersion: v1\nkind: Namespace\nmetadata:\n  labels:\n    kubernetes.io/metadata.name: cephfs\n  name: cephfs\n  ' > ceph-namespace.yaml\n  \n #æ‰§è¡Œ\n  kubectl apply -f ceph-namespace.yaml \n```\n\n1. åˆ›å»ºè¿æ¥ ceph é›†ç¾¤çš„ç§˜é’¥æ–‡ä»¶csi-rbd-secret.yaml\n\n```Shell\necho '\napiVersion: v1\nkind: Secret\nmetadata:\n  name: csi-rbd-secret\n  namespace: cephfs\nstringData:\n  adminID: admin  #ç®¡ç†å‘˜åç§°\n  adminKey: AQCNNDZlPKI5KxAA/3gXnOmhHgyLU2qPzTaZ3A==   #cephé›†ç¾¤å¯†é’¥\n  userID: admin   #ç”¨æˆ·åç§° \n  userKey: AQCNNDZlPKI5KxAA/3gXnOmhHgyLU2qPzTaZ3A==  #cephé›†ç¾¤å¯†é’¥\n  ' > csi-rbd-secret.yaml\n  \n   #æ‰§è¡Œ\n    kubectl apply -f csi-rbd-secret.yaml\n```\n\n1. åˆ›å»ºceph-config-map.yaml\n\n```Shell\necho '\napiVersion: v1\nkind: ConfigMap\ndata:\n  ceph.conf: |\n     [global]\n     fsid = 79fd2206-39ca-4ec4-9cd2-96e065c6361e     # ç”Ÿæˆçš„FSID\n     mon initial members =future-ceph-node0,future-ceph-node1,future-ceph-node2,future-ceph-node3            # ä¸»æœºå\n     mon host = 10.10.3.117,10.10.3.118,10.10.3.119,10.10.3.120                       # å¯¹åº”çš„IP\n     public network = 10.10.3.0/24\n     auth cluster required = cephx\n     auth service required = cephx\n     auth client required = cephx\n     osd journal size = 1024\n     osd pool default size = 3\n     osd pool default min size = 2\n     osd pool default pg num = 333\n     osd pool default pgp num = 333\n     osd crush chooseleaf type = 1\n     [mon]\n     mon allow pool delete = true\n\n     [mds.future-ceph-node0]\n     host = future-ceph-node0\n  keyring: |\nmetadata:\n  name: ceph-config\n  namespace: cephfs\n' > ceph-config-map.yaml\n\n #æ‰§è¡Œ\n kubectl apply -f ceph-config-map.yaml  \n```\n\n1. ä¿®æ”¹csi-config-map.yamlï¼Œé…ç½®è¿æ¥ ceph é›†ç¾¤çš„ä¿¡æ¯\n\n```Shell\necho '\napiVersion: v1\nkind: ConfigMap\nmetadata:\n  name: ceph-csi-config\n  namespace: cephfs\n  labels:\n    addonmanager.kubernetes.io/mode: Reconcile\ndata:\n  config.json: |-\n    [{\"clusterID\":\"79fd2206-39ca-4ec4-9cd2-96e065c6361e\",\"monitors\":[\"10.10.3.117:6789\",\"10.10.3.118:6789\",\"10.10.3.119:6789\",\"10.10.3.120:6789\"]}]\n' > csi-config-map.yaml\n```\n\n1. ä¿®æ”¹csiç»„ä»¶é…ç½®æ–‡ä»¶\n\n   1. æ‹·è´è¿›`/data/cephfs/csi`ç›®å½•ä¸­çš„æ‰€æœ‰yamlæ–‡ä»¶ä¸­çš„å‘½åç©ºé—´ç”±`default`æ”¹ä¸º`cephfs`\n\n    ```Shell\n      cd /data/cephfs/csi\n      sed -i \"s/namespace: default/namespace: cephfs/g\" $(grep -rl \"namespace: default\" ./)\n      sed -i '/^kind: ServiceAccount/a\\  namespace: cephfs' $(grep -rl \"^kind: ServiceAccount\" ./)\n    ```\n\n   å°†`csi-rbdplugin-provisioner.yaml` å’Œ `csi-rbdplugin.yaml` ä¸­çš„ kms éƒ¨åˆ†é…ç½®æ³¨é‡Šæ‰\n\n    >    \\# - name: KMS_CONFIGMAP_NAME\n      >\n      > â€‹            \\#   value: encryptionConfig\n      >\n      > \n      >\n      > \\#- name: ceph-csi-encryption-kms-config\n      >\n      > â€‹        \\#  configMap:\n      >\n      > â€‹        \\#    name: ceph-csi-encryption-kms-config\n      >\n      > \n\n```Shell\n #æ‰§è¡Œï¼Œå®‰è£…csiç»„ä»¶\n kubectl apply -f csi-config-map.yaml\n kubectl apply -f csi-nodeplugin-rbac.yaml\n kubectl apply -f csidriver.yaml\n kubectl apply -f csi-provisioner-rbac.yaml\n kubectl apply -f csi-rbdplugin-provisioner.yaml\n kubectl apply -f csi-rbdplugin.yaml\n```\n\n### ä»»åŠ¡å››ï¼šåˆ›å»ºstorageclass\n\n```Shell\necho '\napiVersion: storage.k8s.io/v1\nkind: StorageClass\nmetadata:\n  annotations:\n    k8s.kuboard.cn/storageType: cephfs_provisioner\n  name: csi-rbd-sc\nprovisioner: rbd.csi.ceph.com\nparameters:\n # fsName: cephfs #cephé›†ç¾¤cephfsæ–‡ä»¶ç³»ç»Ÿåç§°\n  clusterID: 79fd2206-39ca-4ec4-9cd2-96e065c6361e #cephé›†ç¾¤çš„fsid \n  pool: rbd-k8s #cephä¸­åˆ›å»ºçš„å­˜å‚¨æ± \n  imageFeatures: layering\n  csi.storage.k8s.io/provisioner-secret-name: csi-rbd-secret\n  csi.storage.k8s.io/provisioner-secret-namespace: cephfs\n  csi.storage.k8s.io/controller-expand-secret-name: csi-rbd-secret\n  csi.storage.k8s.io/controller-expand-secret-namespace: cephfs\n  csi.storage.k8s.io/node-stage-secret-name: csi-rbd-secret\n  csi.storage.k8s.io/node-stage-secret-namespace: cephfs\n  csi.storage.k8s.io/fstype: xfs\nreclaimPolicy: Delete\nvolumeBindingMode: Immediate\n#allowVolumeExpansion: true\n#mountOptions:\n # - discard\n ' > storageclass.yaml\n \n #æ‰§è¡Œ\n  kubectl apply -f storageclass.yaml\n```\n\n### ä»»åŠ¡äº”ï¼šåˆ›å»ºPVC\n\n```Shell\necho '\napiVersion: v1\nkind: PersistentVolumeClaim\nmetadata:\n  name: rbd-pvc #PVCçš„åç§°\n  namespace: cephfs\nspec:\n  accessModes:\n    - ReadWriteOnce\n  resources:\n    requests:\n      storage: 1Gi  #è®¾ç½®å®¹é‡\n  storageClassName: csi-rbd-sc\n  ' > pvc.yaml\n  \n#æ‰§è¡Œ\n kubectl apply -f pvc.yaml\n#æŸ¥çœ‹PVCæ˜¯å¦åˆ›å»ºæˆåŠŸ\nkubectl get pvc -n cephfs\n#æŸ¥çœ‹PVæ˜¯å¦åˆ›å»ºæˆåŠŸ\nkubectl get pv -n cephfs\n\n#æŸ¥çœ‹cephé›†ç¾¤ä¸­çš„cephfs_dataå­˜å‚¨æ± ä¸­æ˜¯å¦åˆ›å»ºäº†image\n rbd ls -p cephfs_data\n```\n\n### ä»»åŠ¡å…­ï¼šåˆ›å»ºpodï¼Œè¿›è¡Œæµ‹è¯•éªŒè¯\n\n```Shell\necho '\napiVersion: v1\nkind: Pod\nmetadata:\n  name: csi-rbd-demo-pod\n  namespace: cephfs\nspec:\n  containers:\n    - name: web-server\n      image: nginx:latest\n      volumeMounts:\n        - name: mypvc\n          mountPath: /var/lib/www/html\n  volumes:\n    - name: mypvc\n      persistentVolumeClaim:\n        claimName: rbd-pvc  #å¯¹åº”çš„PVCåç§°\n        readOnly: false\n' > pod.yaml\n\n#æ‰§è¡Œ\n kubectl apply -f pod.yaml\n #è¿›å…¥å®¹å™¨æŸ¥çœ‹æŒ‚è½½ä¿¡æ¯\n kubectl exec -it csi-rbd-demo-pod bash\n lsblk -l|grep rbd\n```","tags":["k8s","å®¹å™¨äº‘","ceph","å…±äº«å­˜å‚¨","cephé›†ç¾¤","docker","k8så¯¹æ¥ceph"],"categories":["å®¹å™¨åŒ–","å­˜å‚¨ç³»ç»Ÿ","k8s","ceph"]},{"title":"ä½¿ç”¨cephadmæ–¹å¼éƒ¨ç½²cephé›†ç¾¤","url":"/yyg/89bdf9b5/","content":"## ä»»åŠ¡ç›®æ ‡\n\n1. å®Œæˆä½¿ç”¨cephadmæ–¹å¼éƒ¨ç½²cephé›†ç¾¤\n\n## ä»»åŠ¡å¹³å°\n\n1. ç‰©ç†è®¾å¤‡--\n2. æ“ä½œç³»ç»Ÿï¼šopenEuler 22.03 LTS SP2\n\n## éƒ¨ç½²æŒ‡å—\n\n### ä»»åŠ¡ä¸€ï¼šé…ç½®å‡†å¤‡\n\n1. é‡å‘½åhostname\n\n```Shell\n# å°†10.10.3.117çš„ä¸»æœºåæ”¹ä¸ºfuture-ceph-node0\nhostnamectl set-hostname future-ceph-node0 && bash\n# å°†10.10.3.118çš„ä¸»æœºåæ”¹ä¸ºfuture-ceph-node1\nhostnamectl set-hostname future-ceph-node1 && bash\n# å°†10.10.3.119çš„ä¸»æœºåæ”¹ä¸ºfuture-ceph-node2\nhostnamectl set-hostname future-ceph-node2 && bash\n# å°†10.10.3.120çš„ä¸»æœºåæ”¹ä¸ºfuture-ceph-node3\nhostnamectl set-hostname future-ceph-node3 && bash\n```\n\n1. å®‰è£…å‰çš„é…ç½®ä¿®æ”¹\n\n```Shell\n# å…³é—­é˜²ç«å¢™\nsystemctl stop firewalld\nsystemctl disable firewalld\nfirewall-cmd --state\n \n# selinuxæ°¸ä¹…å…³é—­\nsetenforce 0\n sed -i 's/^SELINUX=enforcing$/SELINUX=permissive/' /etc/selinux/config\ncat /etc/selinux/config\n\n\n# æ·»åŠ hosts\ncat >> /etc/hosts << EOF\n10.10.3.117 future-ceph-node0\n10.10.3.118 future-ceph-node1\n10.10.3.119 future-ceph-node2\n10.10.3.120 future-ceph-node3\nEOF\n#æŸ¥çœ‹\ncat /etc/hosts\n\n\n#åŒæ­¥æ—¶é—´\nyum install ntp -y\nsystemctl start ntpd\nsystemctl enable ntpd\nyum install chrony  -y\nsystemctl start chronyd\nsystemctl enable chronyd\n#ä¿®æ”¹é…ç½®ï¼Œæ·»åŠ å†…å®¹\necho \"\nserver 10.10.3.70 iburst\nallow 10.10.3.0/24\n\" >> /etc/chrony.conf\ntimedatectl set-ntp true\nsystemctl restart chronyd\ntimedatectl status\ndate\n```\n\n1. æ·»åŠ SSHå…å¯†é€šä¿¡\n\n```Shell\nssh-keygen -t rsa\nssh-copy-id 10.10.3.118\nssh-copy-id 10.10.3.119\nssh-copy-id 10.10.3.120\n```\n\n### ä»»åŠ¡äºŒï¼šå®‰è£…docker\n\n1. é…ç½®Docker CEçš„yumå­˜å‚¨åº“ã€‚æ‰“å¼€`docker-ce.repo`çš„æ–‡ä»¶ï¼Œå¹¶å°†ä»¥ä¸‹å†…å®¹å¤åˆ¶åˆ°æ–‡ä»¶ä¸­ï¼š\n\n```Shell\necho '\n[docker-ce-stable]\nname=Docker CE Stable - $basearch\nbaseurl=https://download.docker.com/linux/centos/7/$basearch/stable\nenabled=1\ngpgcheck=1\ngpgkey=https://download.docker.com/linux/centos/gpg ' > /etc/yum.repos.d/docker-ce.repo\n```\n\nä¿å­˜å¹¶é€€å‡ºæ–‡ä»¶ã€‚\n\n1. å®‰è£…Docker CEã€‚è¿è¡Œä»¥ä¸‹å‘½ä»¤æ¥å®‰è£…Docker CEï¼š\n\n```Shell\n yum -y install docker-ce docker-ce-cli  containerd.io\n#å¯åŠ¨dockerå¹¶è®¾ç½®å¼€æœºè‡ªå¯\nsystemctl start docker  \nsystemctl enable docker\n#æŸ¥çœ‹ç‰ˆæœ¬\ndocker -v\ndocker compose version\n```\n\n1. Dockeré…ç½®ä¿®æ”¹å­˜å‚¨è·¯å¾„ï¼Œé…ç½®ä¿®æ”¹ä¸ºå¦‚ä¸‹ã€‚\n\n```Shell\n#å°†é…ç½®å†™å…¥daemon.jsonæ–‡ä»¶\necho '{\n  \"data-root\": \"/data/docker\"\n} ' > /etc/docker/daemon.json\n#æŸ¥çœ‹\ncat /etc/docker/daemon.json\nsystemctl daemon-reload\nsystemctl restart docker\ndocker info\n```\n\n### ä»»åŠ¡ä¸‰ï¼šä½¿ç”¨cephadmå»ºè®¾é›†ç¾¤\n\n1. #### å®‰è£…cephè½¯ä»¶\n\nåœ¨æ‰€æœ‰ä¸»æœºä¸Šå®‰è£…cephè½¯ä»¶\n\n```Shell\nyum install -y cephadm ceph-common\n#æŸ¥çœ‹ç‰ˆæœ¬\nceph -v\n```\n\n1. #### å¯ç”¨adminèŠ‚ç‚¹\n\nåœ¨10.10.3.117ä¸Šå¯ç”¨é›†ç¾¤\n\n```Shell\ncephadm bootstrap --mon-ip 10.10.3.117\n```\n\nè®¿é—®dashboardä¿®æ”¹é»˜è®¤å¯†ç \n\n> Fetching dashboard port number...\n>\n> Ceph Dashboard is now available at:\n>\n> \n>\n> â€‹             URL: https://future-ceph-node0:8443/\n>\n> â€‹            User: admin\n>\n> â€‹        Password: p4csdavtmr\n>\n> \n>\n> Enabling client.admin keyring and conf on hosts with \"admin\" label\n>\n> You can access the Ceph CLI with:\n>\n> \n>\n> â€‹        sudo /usr/sbin/cephadm shell --fsid 5f344e64-85e4-11ee-9181-0050569a1378 -c /etc/ceph/ceph.conf -k /etc/ceph/ceph.client.admin.keyring\n\n1. #### æ·»åŠ èŠ‚ç‚¹\n\n```Shell\n#å¯ç”¨cephå‘½ä»¤\ncephadm shell\n#æ·»åŠ cephçš„å…å¯†è®¿é—®\nceph cephadm get-pub-key > ~/ceph.pub\nssh-copy-id -f -i ~/ceph.pub root@future-ceph-node1\nssh-copy-id -f -i ~/ceph.pub root@future-ceph-node2\nssh-copy-id -f -i ~/ceph.pub root@future-ceph-node3\n#æ·»åŠ cephèŠ‚ç‚¹\nceph orch host add future-ceph-node1 10.10.3.118\nceph orch host add future-ceph-node2 10.10.3.119\nceph orch host add future-ceph-node3 10.10.3.120\n#æŸ¥çœ‹èŠ‚ç‚¹\nceph orch host ls\n#æ·»åŠ _adminæ ‡ç­¾å…è®¸è¯¥èŠ‚ç‚¹è¿è¡Œcephç›¸å…³å‘½ä»¤\nceph orch host label add future-ceph-node1  _admin\nceph orch host label add future-ceph-node2  _admin\nceph orch host label add future-ceph-node3  _admin\n\n#å°†é…ç½®æ–‡ä»¶æ‹·è´åˆ°å…¶ä»–èŠ‚ç‚¹\nscp /etc/ceph/ceph.conf future-ceph-node1:/etc/ceph/\nscp /etc/ceph/ceph.conf future-ceph-node2:/etc/ceph/\nscp /etc/ceph/ceph.conf future-ceph-node3:/etc/ceph/\nscp /etc/ceph/ceph.client.admin.keyring future-ceph-node1:/etc/ceph/\nscp /etc/ceph/ceph.client.admin.keyring future-ceph-node2:/etc/ceph/\nscp /etc/ceph/ceph.client.admin.keyring future-ceph-node3:/etc/ceph/\n```\n\n1. #### è®¾ç½®monèŠ‚ç‚¹ï¼ˆç›‘æ§ï¼‰\n\n```Shell\nceph orch apply mon --placement=\"4 future-ceph-node0 future-ceph-node1 future-ceph-node2 future-ceph-node3\"\n#æŸ¥çœ‹monçš„è¯¦ç»†ä¿¡æ¯\nceph mon dump\n```\n\n1. #### è®¾ç½®mgrèŠ‚ç‚¹ï¼ˆç®¡ç†ï¼‰\n\n```Shell\n ceph orch apply mgr --placement=\"2 future-ceph-node0 future-ceph-node1 \"\n #æŸ¥çœ‹è¯¦æƒ…\n  ceph orch ls\n  #æ‰“ä¸Šæ ‡ç­¾\n  ceph orch host label add future-ceph-node0 master\n  ceph orch host label add future-ceph-node1 master\n```\n\n1. #### æ·»åŠ osdï¼ˆå­˜å‚¨æ•°æ®ï¼‰\n\n```Shell\n#æŸ¥çœ‹è¦æŒ‚è½½çš„ç£ç›˜\nlsblk\n#æ‰€æœ‰èŠ‚ç‚¹\nceph orch daemon add osd future-ceph-node0:/dev/sdb\nceph orch daemon add osd future-ceph-node1:/dev/sdb\nceph orch daemon add osd future-ceph-node2:/dev/sdb\nceph orch daemon add osd future-ceph-node3:/dev/sdb\n```\n\n1. #### åˆ›å»ºmdsï¼ˆå…ƒæ•°æ®ï¼‰\n\n```Shell\n#åˆ›å»ºcephfsæ–‡ä»¶ç³»ç»Ÿ\nceph osd pool create cephfs_data\nceph osd pool create cephfs_metadata\nceph fs new cephfs cephfs_metadata cephfs_data\n#è®¾ç½®mdsç»„ä»¶\n ceph orch apply mds cephfs --placement=\"4 future-ceph-node0 future-ceph-node1 future-ceph-node2 future-ceph-node3\"\n #æŸ¥çœ‹mdsçŠ¶æ€\n ceph orch ps --daemon-type mds\n```\n\n1. #### é…ç½®rgwï¼ˆå¯¹è±¡ç½‘å…³ï¼‰\n\n```Shell\n#åˆ›å»ºåä¸ºmyorgçš„realm\nradosgw-admin realm create --rgw-realm=myorg \n#åˆ›å»ºåä¸ºdefaultçš„åŒºåŸŸç»„(è®¾ç½®ä¸ºä¸»åŒºåŸŸç»„)\nradosgw-admin zonegroup create --rgw-zonegroup=default --master\n#åˆ›å»ºåä¸ºcn-east-1çš„åŒºåŸŸï¼ˆè®¾ç½®ä¸ºä¸»åŒºåŸŸï¼‰\n radosgw-admin zone create --rgw-zonegroup=default --rgw-zone=cn-east-1 --master\n #ä¸ºrealmä¸åŒºåŸŸé…ç½®radosgw\n ceph orch apply rgw myorg cn-east-1 --placement=\"4 future-ceph-node0 future-ceph-node1 future-ceph-node2 future-ceph-node3\"\n #éªŒè¯\n ceph orch ps --daemon-type rgw\n ceph -s\n```\n\n1. #### è®¿é—®æµ‹è¯•\n\n```Shell\n#ceph-Dashboard\nhttps://10.10.3.117:8443\n#Prometheus\nhttp://10.10.3.117:9095/\n#Grafana\nhttps://10.10.3.117:3000/\n```","tags":["ceph","å…±äº«å­˜å‚¨","cephé›†ç¾¤","cephadm"],"categories":["å­˜å‚¨ç³»ç»Ÿ","ceph"]},{"title":"é«˜å¯ç”¨å®¹å™¨äº‘å»ºè®¾ï¼ˆk8sé›†ç¾¤+cephé›†ç¾¤ï¼‰","url":"/yyg/57e2a956/","content":"# ä»»åŠ¡ç›®æ ‡\n\n1. å®Œæˆé«˜å¯ç”¨k8sé›†ç¾¤å®‰è£…éƒ¨ç½²\n\n# ä»»åŠ¡å¹³å°\n\n1. ç‰©ç†è®¾å¤‡--\n2. æ“ä½œç³»ç»Ÿï¼šopenEuler 22.03 LTS SP2\n\n# éƒ¨ç½²æŒ‡å—\n\né›†ç¾¤æ‹“æ‰‘å›¾\n\n![image-20240323222825713](é«˜å¯ç”¨å®¹å™¨äº‘å»ºè®¾/image-20240323222825713-1711204108611-3.png)\n\n## ä¸€ï¼šéƒ¨ç½²cephé›†ç¾¤\n\n### ä»»åŠ¡ä¸€ï¼šé…ç½®å‡†å¤‡\n\n1. é‡å‘½åhostname\n\n```Shell\n# å°†10.10.1.80çš„ä¸»æœºåæ”¹ä¸ºfuture-k8s-master0\nhostnamectl set-hostname future-k8s-master0 && bash\n# å°†10.10.1.81çš„ä¸»æœºåæ”¹ä¸ºfuture-k8s-master1\nhostnamectl set-hostname future-k8s-master1 && bash\n# å°†10.10.1.82çš„ä¸»æœºåæ”¹ä¸ºfuture-k8s-master2\nhostnamectl set-hostname future-k8s-master2 && bash\n# å°†10.10.1.16çš„ä¸»æœºåæ”¹ä¸ºk8s-ceph-node0\nhostnamectl set-hostname k8s-ceph-node0 && bash\n# å°†10.10.1.17çš„ä¸»æœºåæ”¹ä¸ºk8s-ceph-node1\nhostnamectl set-hostname k8s-ceph-node1 && bash\n# å°†10.10.1.18çš„ä¸»æœºåæ”¹ä¸ºk8s-ceph-node2\nhostnamectl set-hostname k8s-ceph-node2 && bash\n# å°†10.10.1.15çš„ä¸»æœºåæ”¹ä¸ºk8s-ceph-node2\nhostnamectl set-hostname k8s-ceph-node3 && bash\n```\n\n1. å®‰è£…å‰çš„é…ç½®ä¿®æ”¹\n\n```Shell\n# å…³é—­é˜²ç«å¢™\nsystemctl stop firewalld\nsystemctl disable firewalld\nfirewall-cmd --state\n \n# selinuxæ°¸ä¹…å…³é—­\nsetenforce 0\n sed -i 's/^SELINUX=enforcing$/SELINUX=permissive/' /etc/selinux/config\ncat /etc/selinux/config\n\n# swapæ°¸ä¹…å…³é—­\nswapoff --all\nswapoff -a\nsed -ri 's/.*swap.*/#&/' /etc/fstab\ncat /etc/fstab\n\n# æ·»åŠ hosts\ncat >> /etc/hosts << EOF\n10.10.1.80 future-k8s-master0\n10.10.1.81 future-k8s-master1\n10.10.1.82 future-k8s-master2\n10.10.1.16 k8s-ceph-node0\n10.10.1.17 k8s-ceph-node1\n10.10.1.18 k8s-ceph-node2\n10.10.1.15 k8s-ceph-node3\n10.10.1.83 future-k8s-vip\nEOF\n#æŸ¥çœ‹\ncat /etc/hosts\n\n\n# æ·»åŠ ç½‘æ¡¥è¿‡æ»¤åŠå†…æ ¸è½¬å‘é…ç½®æ–‡ä»¶\ncat > /etc/sysctl.d/k8s.conf << EOF\n net.bridge.bridge-nf-call-ip6tables = 1\n net.bridge.bridge-nf-call-iptables = 1\n net.ipv4.ip_forward = 1\nEOF\n# æŸ¥çœ‹\ncat /etc/sysctl.d/k8s.conf\n# åŠ è½½br_netfilteræ¨¡å—\nmodprobe br_netfilter\n# æŸ¥çœ‹æ˜¯å¦åŠ è½½\nlsmod | grep br_netfilter\n# åŠ è½½ç½‘æ¡¥è¿‡æ»¤åŠå†…æ ¸è½¬å‘é…ç½®æ–‡ä»¶\nsysctl -p /etc/sysctl.d/k8s.conf\n\n#åŒæ­¥æ—¶é—´\nyum install ntp -y\nsystemctl start ntpd\nsystemctl enable ntpd\nyum install chrony  -y\nsystemctl start chronyd\nsystemctl enable chronyd\n#ä¿®æ”¹é…ç½®ï¼Œæ·»åŠ å†…å®¹\necho \"\nserver 10.10.3.70 iburst\nallow 10.10.3.0/24\nallow 10.10.1.0/24\n\" >> /etc/chrony.conf\ntimedatectl set-ntp true\nsystemctl restart chronyd\ntimedatectl status\ndate\n```\n\n1. å®‰è£…ipsetåŠipvsadm\n\n```Shell\n # å®‰è£…ipsetåŠipvsadm\n yum -y install ipset ipvsadm\n é…ç½®ipvsadmæ¨¡å—åŠ è½½æ–¹å¼\n # æ·»åŠ éœ€è¦åŠ è½½çš„æ¨¡å—\necho ' #!/bin/bash\n modprobe -- ip_vs\n modprobe -- ip_vs_rr\n modprobe -- ip_vs_wrr\n modprobe -- ip_vs_sh\n modprobe -- nf_conntrack\n' > /etc/sysconfig/modules/ipvs.modules\n#æŸ¥çœ‹\ncat /etc/sysconfig/modules/ipvs.modules\n # æˆæƒã€è¿è¡Œã€æ£€æŸ¥æ˜¯å¦åŠ è½½\nchmod 755 /etc/sysconfig/modules/ipvs.modules \nbash /etc/sysconfig/modules/ipvs.modules \nlsmod | grep -e ip_vs -e nf_conntrack\n\n#é‡å¯\nreboot\n```\n\né…ç½®å‡†å¤‡å®Œæˆåï¼Œæ‰€æœ‰èŠ‚ç‚¹éƒ½éœ€é‡å¯\n\n### ä»»åŠ¡äºŒï¼šé…ç½®pythonç¯å¢ƒ\n\nä¸‹è½½python2\n\n1. å®‰è£…[zlib](https://so.csdn.net/so/search?q=zlib&spm=1001.2101.3001.7020)åº“ï¼Œä¸ç„¶å®‰è£…pipæ—¶ä¼šæŠ¥é”™ï¼ˆè¿˜è¦é‡æ–°ç¼–è¯‘pythonï¼‰\n\n```Plain\n yum -y install zlib*\n```\n\n1. å®‰è£… GCC åŒ…ï¼Œå¦‚æœæ²¡æœ‰å®‰è£… GCCï¼Œè¯·ä½¿ç”¨ä»¥ä¸‹å‘½ä»¤è¿›è¡Œå®‰è£…\n\n```Shell\nyum -y install gcc openssl-devel bzip2-devel\n```\n\n1. ä¸‹è½½Python-2.7.18\n\n```Plain\n cd /usr/src\n yum -y install wget tar\n wget https://www.python.org/ftp/python/2.7.18/Python-2.7.18.tgz\n tar xzf Python-2.7.18.tgz\n```\n\n1. åœ¨ç¼–è¯‘ä¹‹å‰è¿˜éœ€è¦åœ¨å®‰è£…æºæ–‡ä»¶ä¸­ä¿®æ”¹Modules/Setup.distæ–‡ä»¶ï¼Œå°†æ³¨é‡Šå»æ‰\n\n```Shell\nsed -i 's/#zlib zlibmodule.c -I$(prefix)/zlib zlibmodule.c -I$(prefix)/'  Python-2.7.18/Modules/Setup.dist\n```\n\n1.  ç¼–è¯‘Python-2.7.18ï¼ˆ`make altinstall`ç”¨äºé˜²æ­¢æ›¿æ¢é»˜è®¤çš„ python äºŒè¿›åˆ¶æ–‡ä»¶ /usr/bin/pythonï¼‰\n\n```Shell\ncd /usr/src/Python-2.7.18\n./configure --enable-optimizations\nyum install -y make\nmake altinstall\n```\n\nä¸è¦è¦†ç›–æˆ–é“¾æ¥åŸå§‹çš„ Python äºŒè¿›åˆ¶æ–‡ä»¶ï¼Œè¿™å¯èƒ½ä¼šæŸåç³»ç»Ÿ\n\n1. è®¾ç½®ç¯å¢ƒå˜é‡\n\n```Shell\necho \"\nexport PYTHON_HOME=/usr/local/\nPATH=\\$PATH:\\$PYTHON_HOME/bin\n\" >> /etc/profile\ncat /etc/profile\nsource /etc/profile\n```\n\n1. æ–¹æ³•ä¸€ï¼š\n\n```Shell\ncurl \"https://bootstrap.pypa.io/pip/2.7/get-pip.py\" -o \"get-pip.py\"\npython2.7 get-pip.py \n```\n\nä¸‹è½½ceph\n\n```Shell\n#k8s-ceph-node0ä¸‹è½½\n#æ–¹æ³•ä¸€ï¼šä½¿ç”¨pipä¸‹è½½\npip2 install ceph-deploy\nyum install -y ceph ceph-radosgw\n#å…¶ä»–èŠ‚ç‚¹ä¸‹è½½\nyum install -y ceph ceph-radosgw\n#æ£€æŸ¥å®‰è£…åŒ…æ˜¯å¦å®Œæ•´\nrpm -qa |egrep -i \"ceph|rados|rbd\"\n```\n\n### ä»»åŠ¡ä¸‰ï¼šéƒ¨ç½²cephé›†ç¾¤\n\n1. #### adminèŠ‚ç‚¹\n\n1. ##### éƒ¨ç½²Monitor\n\n1. åˆ›å»ºé…ç½®æ–‡ä»¶ç›®å½•ï¼Œå¹¶åˆ›å»ºé…ç½®æ–‡ä»¶\n\n```Properties\nmkdir /etc/ceph/\ntouch /etc/ceph/ceph.conf\n```\n\n1. ä¸ºé›†ç¾¤ç”Ÿæˆä¸€ä¸ªFSDIï¼š\n\n```Ruby\nuuidgen\n30912204-0c26-413f-8e00-6d55c9c0af03\n```\n\n1. é›†ç¾¤åˆ›å»ºä¸€ä¸ªé’¥åŒ™ä¸²ï¼Œä¸ºMonitor æœåŠ¡åˆ›å»ºä¸€ä¸ªå¯†é’¥ï¼š\n\n```Ruby\nceph-authtool --create-keyring /tmp/ceph.mon.keyring --gen-key -n mon. --cap mon 'allow *'\n```\n\n1. åˆ›å»ºä¸€ä¸ªç®¡ç†å‘˜é’¥åŒ™ä¸²ï¼Œç”Ÿæˆä¸€ä¸ªclient.adminç”¨æˆ·ï¼Œå¹¶å°†æ­¤ç”¨æˆ·æ·»åŠ åˆ°é’¥åŒ™ä¸²ä¸­ï¼š\n\n```Go\nceph-authtool --create-keyring /etc/ceph/ceph.client.admin.keyring --gen-key -n client.admin --cap mon 'allow *' --cap osd 'allow *' --cap mds 'allow *' --cap mgr 'allow *'\n```\n\n1. åˆ›å»ºbootstrap-osdé’¥åŒ™ä¸²ï¼Œå°†client.bootstrap-osd ç”¨æˆ·æ·»åŠ åˆ°æ­¤é’¥åŒ™ä¸²ä¸­ï¼š\n\n```TypeScript\nceph-authtool --create-keyring /var/lib/ceph/bootstrap-osd/ceph.keyring --gen-key -n client.bootstrap-osd --cap mon 'profile bootstrap-osd'\n```\n\n1. å°†ç”Ÿæˆçš„keyåŠ å…¥ceph.mon.keyring.\n\n```TypeScript\nceph-authtool /tmp/ceph.mon.keyring --import-keyring /etc/ceph/ceph.client.admin.keyring\n\nceph-authtool /tmp/ceph.mon.keyring --import-keyring /var/lib/ceph/bootstrap-osd/ceph.keyring\n```\n\n1. ä½¿ç”¨ä¸»æœºåå’ŒIPåœ°å€ä»¥åŠFSIDç”Ÿæˆmonitor map:\n\n```YAML\nmonmaptool --create --add k8s-ceph-node0 10.10.1.16 --fsid 30912204-0c26-413f-8e00-6d55c9c0af03 /tmp/monmap\n```\n\n1. åˆ›å»ºmonçš„ç›®å½•,ä½¿ç”¨ `é›†ç¾¤åç§°-ä¸»æœºå`çš„å½¢å¼ï¼š\n\n```Shell\n mkdir  /var/lib/ceph/mon/ceph-k8s-ceph-node0\n```\n\n1. å¡«å…¥ç¬¬ä¸€ä¸ªmonå®ˆæŠ¤è¿›ç¨‹çš„ä¿¡æ¯:\n\n```TOML\nceph-mon --mkfs -i k8s-ceph-node0 --monmap /tmp/monmap --keyring /tmp/ceph.mon.keyring\n```\n\n1. é…ç½®/etc/ceph/ceph.confæ–‡ä»¶ï¼š\n\n```Shell\ncat /etc/ceph/ceph.conf\n################################################\n[global]\nfsid = 30912204-0c26-413f-8e00-6d55c9c0af03     # ç”Ÿæˆçš„FSID\nmon initial members =k8s-ceph-node0\nmon host = 10.10.1.16\npublic network = 10.10.1.0/24\nauth cluster required = cephx\nauth service required = cephx\nauth client required = cephx\nosd journal size = 1024\nosd pool default size = 3\nosd pool default min size = 2\nosd pool default pg num = 333\nosd pool default pgp num = 333\nosd crush chooseleaf type = 1\n\n################################################\n```\n\n1. ç”±äºæˆ‘ä»¬ä½¿ç”¨ä½¿ç”¨rootæ“ä½œçš„ï¼Œéœ€è¦è®¾ç½®æƒé™ä¸ºcephï¼ˆä¹Ÿå¯ä»¥ä¿®æ”¹systemdçš„å¯åŠ¨æ–‡ä»¶ï¼Œå°†cephç”¨æˆ·æ”¹ä¸ºrootï¼‰ï¼Œå¹¶å¯åŠ¨Monitor\n\n```Shell\nchown  -R ceph:ceph /var/lib/ceph\nsystemctl start ceph-mon@k8s-ceph-node0.service\nsystemctl enable ceph-mon@k8s-ceph-node0.service\n```\n\n1. ç¡®è®¤æœåŠ¡å·²ç»æ­£å¸¸å¯åŠ¨ï¼š\n\n```Shell\nceph -s\nyum install -y net-tools\nnetstat -lntp|grep ceph-mon\n```\n\n1. ##### éƒ¨ç½²Manager\n\nå½“æˆ‘ä»¬é…ç½®å¥½ceph-monæœåŠ¡ä¹‹åï¼Œå°±éœ€è¦é…ç½®ceph-mgræœåŠ¡ã€‚\n\n1. ç”Ÿæˆä¸€ä¸ªè®¤è¯å¯†é’¥(ceph-mgrä¸ºè‡ªå®šä¹‰çš„åç§°)ï¼š\n\n```Shell\n#10.10.1.16\nceph auth get-or-create mgr.ceph-mgr mon 'allow profile mgr' osd 'allow *' mds 'allow *'\n[mgr.ceph-mgr]\n        key = AQANDD9lfWg2LBAAHY0mprdbuKFBPJDkE7/I5Q==\n        \n#10.10.1.17\nceph auth get-or-create mgr.ceph-mgr1 mon 'allow profile mgr' osd 'allow *' mds 'allow *'\n[mgr.ceph-mgr1]\n        key = AQDbRTZlgjXWBBAAGew4Xta+t9vgIWPCWC8EVg==\n```\n\n1. åˆ›å»ºå­˜æ”¾æ­¤å¯†é’¥çš„æ–‡ä»¶çš„ç›®å½•\n\n```Shell\n#10.10.1.16\nsudo -u ceph mkdir /var/lib/ceph/mgr/ceph-ceph-mgr\n#å°†äº§ç”Ÿçš„å¯†é’¥æ–‡ä»¶å­˜å…¥æ­¤ç›®å½•ä¸‹ï¼Œå¹¶å‘½åä¸ºkeyring\nvi /var/lib/ceph/mgr/ceph-ceph-mgr/keyring \n[mgr.ceph-mgr]\n        key = AQANDD9lfWg2LBAAHY0mprdbuKFBPJDkE7/I5Q==\n        \n#10.10.1.17\nsudo -u ceph mkdir /var/lib/ceph/mgr/ceph-ceph-mgr1\n#å°†äº§ç”Ÿçš„å¯†é’¥æ–‡ä»¶å­˜å…¥æ­¤ç›®å½•ä¸‹ï¼Œå¹¶å‘½åä¸ºkeyring\nvi /var/lib/ceph/mgr/ceph-ceph-mgr1/keyring \n[mgr.ceph-mgr1]\n        key = AQDbRTZlgjXWBBAAGew4Xta+t9vgIWPCWC8EVg==\n```\n\n1. å¯åŠ¨ceph-mgræœåŠ¡\n\n```Shell\nceph-mgr -i ceph-mgr\nceph-mgr -i ceph-mgr1\nsystemctl enable ceph-mgr@k8s-ceph-node0\nsystemctl enable ceph-mgr@k8s-ceph-node1\n#æ£€æŸ¥æœåŠ¡æ˜¯å¦å¯åŠ¨ï¼ŒæŸ¥çœ‹cephçŠ¶æ€\nceph -s\n#æŸ¥çœ‹å½“å‰mgrä¸­å¯ç”¨çš„æ¨¡å—\nceph mgr module ls\n```\n\n1. ##### åˆ›å»ºOSD\n\n```Shell\nceph-volume lvm create --data /dev/sda8\n#æŸ¥çœ‹å½“å‰çš„lvmé€»è¾‘å·\nceph-volume lvm list\n#æŸ¥çœ‹cephçŠ¶æ€\nceph -s\n```\n\n1. ##### å®‰è£…é…ç½®Ceph-dashboard\n\n1. å¼€å¯dashboardåŠŸèƒ½\n\n```Shell\nceph mgr module enable dashboard\n```\n\n1. åˆ›å»ºè¯ä¹¦\n\n```Shell\nceph dashboard create-self-signed-cert\n```\n\n1. é…ç½®webç™»å½•çš„ç”¨æˆ·åå’Œå¯†ç \n\n```Shell\n #åˆ›å»º/etc/ceph/dashboard.keyï¼Œå¹¶å°†å¯†ç å†™å…¥\n echo \"qishi#09319\" >/etc/ceph/dashboard.key\n ceph dashboard ac-user-create k8s administrator -i /etc/ceph/dashboard.key\n```\n\n1. ä¿®æ”¹dashboardé»˜è®¤ç«¯å£(å¯é€‰)\n\né…ç½®ç«¯å£ï¼Œé»˜è®¤ç«¯å£æ˜¯8443ï¼Œä¿®æ”¹ä¸º18443ï¼Œä¿®æ”¹åéœ€é‡å¯mgrï¼Œä¿®æ”¹ç«¯å£æ‰ç”Ÿæ•ˆã€‚\n\n```Shell\nceph config set mgr mgr/dashboard/server_port 18443\nsystemctl restart ceph-mgr.target\n```\n\n1. æŸ¥çœ‹å‘å¸ƒæœåŠ¡åœ°å€å¹¶ç™»å½•\n\n```Shell\nceph mgr services\n```\n\n> {\n>\n> â€‹    \"dashboard\": \"https://k8s-ceph-node0:8443/\"\n>\n> }\n\n![image-20240323222910679](é«˜å¯ç”¨å®¹å™¨äº‘å»ºè®¾/image-20240323222910679-1711204151978-5.png)\n\n1. #### nodeèŠ‚ç‚¹\n\n1. ##### æ‰©å±•Monitor\n\n1. ä¿®æ”¹masterèŠ‚ç‚¹ä¸Šçš„é…ç½®\n\n```Shell\nvi /etc/ceph/ceph.conf\n[global]\nfsid = 30912204-0c26-413f-8e00-6d55c9c0af03     # ç”Ÿæˆçš„FSID\nmon initial members =k8s-ceph-node0,k8s-ceph-node1,k8s-ceph-node2,k8s-ceph-node3            # ä¸»æœºå\nmon host = 10.10.1.16,10.10.1.17,10.10.1.18,10.10.1.15                       # å¯¹åº”çš„IP\npublic network = 10.10.1.0/24\nauth cluster required = cephx\nauth service required = cephx\nauth client required = cephx\nosd journal size = 1024\nosd pool default size = 3\nosd pool default min size = 2\nosd pool default pg num = 333\nosd pool default pgp num = 333\nosd crush chooseleaf type = 1\n[mon]\nmon allow pool delete = true\n\n[mds.k8s-ceph-node0]\nhost = k8s-ceph-node0\n```\n\n1. å°†é…ç½®å’Œå¯†é’¥æ–‡ä»¶åˆ†å‘åˆ°å…¶å®ƒçš„èŠ‚ç‚¹ä¸Šï¼ˆmasterèŠ‚ç‚¹ï¼‰\n\n```Shell\n#ç”Ÿæˆå…¬é’¥ï¼Œå¤åˆ¶åˆ°nodeèŠ‚ç‚¹ä¸»æœºä¸Š\nssh-keygen -t rsa\nssh-copy-id 10.10.1.17\nssh-copy-id 10.10.1.18\nssh-copy-id 10.10.1.15\n#å¤åˆ¶è®¤è¯å¯†é’¥\nscp /etc/ceph/*  10.10.1.17:/etc/ceph/\nscp /etc/ceph/*  10.10.1.18:/etc/ceph/\nscp /etc/ceph/*  10.10.1.15:/etc/ceph/\n```\n\n1. åœ¨nodeèŠ‚ç‚¹åˆ›å»ºcephç›¸å…³ç›®å½•ï¼Œå¹¶æ·»åŠ æƒé™ï¼š\n\n```Shell\nmkdir -p  /var/lib/ceph/{bootstrap-mds,bootstrap-mgr,bootstrap-osd,bootstrap-rbd,bootstrap-rgw,mds,mgr,mon,osd}\nchown  -R ceph:ceph /var/lib/ceph\n\nsudo -u ceph mkdir /var/lib/ceph/mon/ceph-k8s-ceph-node1\nsudo -u ceph mkdir /var/lib/ceph/mon/ceph-k8s-ceph-node2\n```\n\n1. ä¿®æ”¹nodeèŠ‚ç‚¹çš„é…ç½®æ–‡ä»¶,ä»¥node1ä¸ºä¾‹ï¼ˆå…¶ä»–èŠ‚ç‚¹ç›¸ä¼¼ï¼‰\n\n```Shell\n[global]\nfsid = 30912204-0c26-413f-8e00-6d55c9c0af03     # ç”Ÿæˆçš„FSID\nmon initial members =k8s-ceph-node0,k8s-ceph-node1,k8s-ceph-node2,k8s-ceph-node3           # ä¸»æœºå\nmon host = 10.10.1.16,10.10.1.17,10.10.1.18,10.10.1.15                       # å¯¹åº”çš„IP\npublic network = 10.10.1.0/24\nauth cluster required = cephx\nauth service required = cephx\nauth client required = cephx\nosd journal size = 1024\nosd pool default size = 3\nosd pool default min size = 2\nosd pool default pg num = 333\nosd pool default pgp num = 333\nosd crush chooseleaf type = 1\n[mon]\nmon allow pool delete = true\n\n[mon.k8s-ceph-node1]\nmon_addr = 10.10.1.17:6789\nhost = k8s-ceph-node1\n```\n\n1. è·å–é›†ç¾¤ä¸­çš„å¯†é’¥å’Œmap,ä»¥node1ä¸ºä¾‹ï¼ˆå…¶ä»–èŠ‚ç‚¹ç›¸ä¼¼ï¼‰\n\n```Properties\nceph auth get mon. -o /tmp/monkeyring\nceph mon getmap -o /tmp/monmap\n```\n\n1. ä½¿ç”¨å·²æœ‰çš„å¯†é’¥å’Œmapæ·»åŠ ä¸€ä¸ªæ–°çš„Monitor,æŒ‡å®šä¸»æœºå,ä»¥node1ä¸ºä¾‹ï¼ˆå…¶ä»–èŠ‚ç‚¹ç›¸ä¼¼ï¼‰\n\n```Perl\nsudo -u ceph ceph-mon --mkfs -i k8s-ceph-node1 --monmap /tmp/monmap --keyring /tmp/monkeyring\n```\n\n1. å¯åŠ¨æœåŠ¡,ä»¥node1ä¸ºä¾‹ï¼ˆå…¶ä»–èŠ‚ç‚¹ç›¸ä¼¼ï¼‰\n\n```Nginx\nsystemctl start ceph-mon@k8s-ceph-node1\nsystemctl enable ceph-mon@k8s-ceph-node1\n#æŸ¥çœ‹monçŠ¶æ€\nceph -s\nceph mon stat\n```\n\n1. ##### æ·»åŠ OSD\n\nä»å·²ç»å­˜åœ¨çš„osdçš„masterèŠ‚ç‚¹ä¸Šæ‹·è´åˆå§‹åŒ–çš„å¯†é’¥æ–‡ä»¶\n\n```Shell\nscp -p  /var/lib/ceph/bootstrap-osd/ceph.keyring  10.10.1.17:/var/lib/ceph/bootstrap-osd/\nscp -p  /var/lib/ceph/bootstrap-osd/ceph.keyring  10.10.1.18:/var/lib/ceph/bootstrap-osd/\nscp -p  /var/lib/ceph/bootstrap-osd/ceph.keyring  10.10.1.15:/var/lib/ceph/bootstrap-osd/\n```\n\nåœ¨nodeèŠ‚ç‚¹æ·»åŠ osd\n\n```Shell\nceph-volume lvm create --data /dev/sdb\n\nsystemctl enable ceph-osd@k8s-ceph-node1\n#æŸ¥çœ‹çŠ¶æ€\nceph -s\n```\n\n1. #### æ·»åŠ Mdsï¼ˆä»¥node0ä¸ºä¾‹ï¼‰\n\n```Shell\n#åˆ›å»ºç›®å½•\nsudo -u ceph mkdir -p /var/lib/ceph/mds/ceph-k8s-ceph-node0\n#åˆ›å»ºå¯†é’¥\nceph-authtool --create-keyring /var/lib/ceph/mds/ceph-k8s-ceph-node0/keyring --gen-key -n mds.k8s-ceph-node0\n#å¯¼å…¥å¯†é’¥ï¼Œå¹¶è®¾ç½®caps\nceph auth add mds.k8s-ceph-node0 osd \"allow rwx\" mds \"allow\" mon \"allow profile mds\" -i /var/lib/ceph/mds/ceph-k8s-ceph-node0/keyring\n#æ‰‹åŠ¨å¯åŠ¨æœåŠ¡\nceph-mds --cluster ceph -i k8s-ceph-node0 -m k8s-ceph-node0:6789\n chown -R ceph:ceph /var/lib/ceph/mds/\n systemctl start ceph-mds@k8s-ceph-node0\n systemctl enable ceph-mds@k8s-ceph-node0\n #æ£€æŸ¥æœåŠ¡æ˜¯å¦å¯åŠ¨\n ps -ef|grep ceph-mds\n #æ£€æŸ¥ceph é›†ç¾¤çŠ¶æ€\n ceph -s\n```\n\n1. #### åˆ›å»ºCephFS\n\nåˆ›å»ºpools\n\n```Shell\n#å­˜å‚¨æ•°æ®\nceph osd pool create cephfs_data 64\n#å­˜å‚¨å…ƒæ•°æ®\nceph osd pool create cephfs_metadata 64\n#å¯ç”¨cephfsæ–‡ä»¶ç³»ç»Ÿ\nceph fs new cephfs cephfs_metadata cephfs_data\n#æŸ¥çœ‹æ–‡ä»¶ç³»ç»ŸçŠ¶æ€\nceph fs ls\nceph mds stat\n```\n\n1. #### åˆ›å»ºrbdæ± \n\n```Shell\n#åˆ›å»ºrbdæ± \nceph osd pool create rbd-k8s 64 64\n#å¯ç”¨ \nceph osd pool application enable rbd-k8s rbd\n#åˆå§‹åŒ–\nrbd pool init rbd-k8s\n#æŸ¥çœ‹\nceph osd lspools\n```\n\n## äºŒï¼šéƒ¨ç½²é«˜å¯ç”¨k8sé›†ç¾¤\n\n### ä»»åŠ¡ä¸€ï¼šé…ç½®å‡†å¤‡ï¼ˆä¸cephé›†ç¾¤ä¸€æ ·ï¼‰\n\n### ä»»åŠ¡äºŒï¼šå®‰è£…docker\n\n1. é…ç½®Docker CEçš„yumå­˜å‚¨åº“ã€‚æ‰“å¼€`docker-ce.repo`çš„æ–‡ä»¶ï¼Œå¹¶å°†ä»¥ä¸‹å†…å®¹å¤åˆ¶åˆ°æ–‡ä»¶ä¸­ï¼š\n\n```Shell\necho '\n[docker-ce-stable]\nname=Docker CE Stable - $basearch\nbaseurl=https://download.docker.com/linux/centos/7/$basearch/stable\nenabled=1\ngpgcheck=1\ngpgkey=https://download.docker.com/linux/centos/gpg ' > /etc/yum.repos.d/docker-ce.repo\n```\n\nä¿å­˜å¹¶é€€å‡ºæ–‡ä»¶ã€‚\n\n1. å®‰è£…Docker CEã€‚è¿è¡Œä»¥ä¸‹å‘½ä»¤æ¥å®‰è£…Docker CEï¼š\n\n```Shell\n yum -y install docker-ce docker-ce-cli  containerd.io\n#å¯åŠ¨dockerå¹¶è®¾ç½®å¼€æœºè‡ªå¯\nsystemctl start docker  \nsystemctl enable docker\n#æŸ¥çœ‹ç‰ˆæœ¬\ndocker -v\ndocker compose version\n```\n\n1. Dockeré…ç½®ä¿®æ”¹ï¼Œè®¾ç½®cgroupé©±åŠ¨ï¼Œä½¿ç”¨systemdï¼Œé…ç½®ä¿®æ”¹ä¸ºå¦‚ä¸‹ã€‚\n\n```Shell\n#å°†é…ç½®å†™å…¥daemon.jsonæ–‡ä»¶\necho '{\n  \"exec-opts\": [\"native.cgroupdriver=systemd\"],\n  \"data-root\": \"/data/docker\"\n} ' > /etc/docker/daemon.json\n#æŸ¥çœ‹\ncat /etc/docker/daemon.json\nsystemctl daemon-reload\nsystemctl restart docker\ndocker info\n```\n\n1. åˆ›å»ºæ‰€éœ€ç›®å½•\n\n```Shell\ncd /data\nmkdir  cri-dockerd calico    dashboard   metrics-server  script  ingress-nginx\n```\n\n### ä»»åŠ¡ä¸‰ï¼šå®‰è£…cri-dockerd ï¼ˆk8s 1.24åŠä»¥ä¸Šç‰ˆæœ¬ï¼‰\n\n```Shell\ncd /data/cri-dockerd\n# ä¸‹è½½cri-dockerdå®‰è£…åŒ…\nwget https://github.com/Mirantis/cri-dockerd/releases/download/v0.3.4/cri-dockerd-0.3.4-3.el8.x86_64.rpm\n# å®‰è£…cri-dockerd\nrpm -ivh cri-dockerd-0.3.4-3.el8.x86_64.rpm\ndocker pull registry.aliyuncs.com/google_containers/pause:3.9\n# ä¿®æ”¹é•œåƒåœ°å€ä¸ºå›½å†…ï¼Œå¦åˆ™kubeletæ‹‰å–ä¸äº†é•œåƒå¯¼è‡´å¯åŠ¨å¤±è´¥\nsed -i.bak 's|ExecStart=.*$|ExecStart=/usr/bin/cri-dockerd --container-runtime-endpoint fd:// --pod-infra-container-image=registry.aliyuncs.com/google_containers/pause:3.9|g' /usr/lib/systemd/system/cri-docker.service\ncat /usr/lib/systemd/system/cri-docker.service\n# å¯åŠ¨cri-dockerd\nsystemctl daemon-reload \nsystemctl start cri-docker.service\nsystemctl enable cri-docker.service\n```\n\n### ä»»åŠ¡å››ï¼šå®‰è£…é«˜å¯ç”¨ç»„ä»¶\n\néƒ¨ç½²é«˜å¯ç”¨é›†ç¾¤éœ€è¦å®‰è£…**keepalivedå’Œhaproxyï¼Œå®ç°****master****èŠ‚ç‚¹é«˜å¯ç”¨ï¼Œ****åœ¨å„masterèŠ‚ç‚¹æ“ä½œ**\n\n1. å®‰è£…keepalivedä¸haproxy\n\n```Shell\nyum install keepalived haproxy -y\n```\n\n1. å¤‡ä»½keepalivedä¸haproxyé…ç½®æ–‡ä»¶\n\n```Shell\ncp /etc/keepalived/keepalived.conf /etc/keepalived/keepalived.conf.bak\ncp /etc/haproxy/haproxy.cfg /etc/haproxy/haproxy.cfg.bak\n```\n\n1. ä¿®æ”¹å„masterèŠ‚ç‚¹çš„`/etc/keepalived/keepalived.conf`æ–‡ä»¶\n   1. future-k8s-master0\n   2. ```Shell\n      echo '\n      global_defs {\n         router_id k8s\n      }\n      \n      vrrp_script check_haproxy {\n          script \"killall -0 haproxy\"\n          interval 3\n          weight -2\n          fall 10\n          rise 2\n      }\n      \n      vrrp_instance VI_1 {\n          state MASTER  #ä¸»èŠ‚ç‚¹ åˆ™ä¸ºMASTER ,å…¶ä»–åˆ™ä¸º BACKUP\n          interface ens192  #ç½‘å¡åç§°\n          virtual_router_id 51\n          priority 250   #ä¼˜å…ˆçº§\n          nopreempt   #è®¾ç½®éæŠ¢å æ¨¡å¼\n          advert_int 1\n          authentication {\n              auth_type PASS\n              auth_pass ceb1b3ec013d66163d6ab\n          }\n          virtual_ipaddress {\n              10.10.1.83/24   #è™šæ‹Ÿip\n          }\n          track_script {\n              check_haproxy\n          }\n      }    \n      ' > /etc/keepalived/keepalived.conf\n      cat /etc/keepalived/keepalived.conf\n      ```\n\n   3. future-k8s-master1\n   4. ```Shell\n      echo '\n      global_defs {\n         router_id k8s\n      }\n      \n      vrrp_script check_haproxy {\n          script \"killall -0 haproxy\"\n          interval 3\n          weight -2\n          fall 10\n          rise 2\n      }\n      \n      vrrp_instance VI_1 {\n          state BACKUP  #ä¸»èŠ‚ç‚¹ åˆ™ä¸ºMASTER ,å…¶ä»–åˆ™ä¸º BACKUP\n          interface ens192  #ç½‘å¡åç§°\n          virtual_router_id 51\n          priority 200   #ä¼˜å…ˆçº§\n          nopreempt   #è®¾ç½®éæŠ¢å æ¨¡å¼\n          advert_int 1\n          authentication {\n              auth_type PASS\n              auth_pass ceb1b3ec013d66163d6ab\n          }\n          virtual_ipaddress {\n              10.10.1.83/24   #è™šæ‹Ÿip\n          }\n          track_script {\n              check_haproxy\n          }\n      }    \n      ' > /etc/keepalived/keepalived.conf\n      cat  /etc/keepalived/keepalived.conf\n      ```\n\n   5. future-k8s-master2\n   6. ```Shell\n      echo '\n      global_defs {\n         router_id k8s\n      }\n      \n      vrrp_script check_haproxy {\n          script \"killall -0 haproxy\"\n          interval 3\n          weight -2\n          fall 10\n          rise 2\n      }\n      \n      vrrp_instance VI_1 {\n          state BACKUP  #ä¸»èŠ‚ç‚¹ åˆ™ä¸ºMASTER ,å…¶ä»–åˆ™ä¸º BACKUP\n          interface ens192  #ç½‘å¡åç§°\n          virtual_router_id 51\n          priority 150   #ä¼˜å…ˆçº§\n          nopreempt   #è®¾ç½®éæŠ¢å æ¨¡å¼\n          advert_int 1\n          authentication {\n              auth_type PASS\n              auth_pass ceb1b3ec013d66163d6ab\n          }\n          virtual_ipaddress {\n              10.10.1.83/24   #è™šæ‹Ÿip\n          }\n          track_script {\n              check_haproxy\n          }\n      }    \n      ' > /etc/keepalived/keepalived.conf\n      cat  /etc/keepalived/keepalived.conf\n      ```\n2. ä¿®æ”¹å„masterèŠ‚ç‚¹çš„`/etc/haproxy/haproxy.cfg`æ–‡ä»¶ï¼Œï¼ˆä¸‰ä¸ªmasterèŠ‚ç‚¹çš„é…ç½®æ–‡ä»¶ç›¸åŒï¼‰\n\n```Shell\necho \"\n#---------------------------------------------------------------------\n# Global settings\n#---------------------------------------------------------------------\nglobal\n    # to have these messages end up in /var/log/haproxy.log you will\n    # need to:\n    # 1) configure syslog to accept network log events.  This is done\n    #    by adding the '-r' option to the SYSLOGD_OPTIONS in\n    #    /etc/sysconfig/syslog\n    # 2) configure local2 events to go to the /var/log/haproxy.log\n    #   file. A line like the following can be added to\n    #   /etc/sysconfig/syslog\n    #\n    #    local2.*                       /var/log/haproxy.log\n    #\n    log         127.0.0.1 local2\n\n    chroot      /var/lib/haproxy\n    pidfile     /var/run/haproxy.pid\n    maxconn     4000\n    user        haproxy\n    group       haproxy\n    daemon\n\n    # turn on stats unix socket\n    stats socket /var/lib/haproxy/stats\n#---------------------------------------------------------------------\n# common defaults that all the 'listen' and 'backend' sections will\n# use if not designated in their block\n#---------------------------------------------------------------------\ndefaults\n    mode                    http\n    log                     global\n    option                  httplog\n    option                  dontlognull\n    option http-server-close\n    option forwardfor       except 127.0.0.0/8\n    option                  redispatch\n    retries                 3\n    timeout http-request    10s\n    timeout queue           1m\n    timeout connect         10s\n    timeout client          1m\n    timeout server          1m\n    timeout http-keep-alive 10s\n    timeout check           10s\n    maxconn                 3000\n#---------------------------------------------------------------------\n# kubernetes apiserver frontend which proxys to the backends\n#---------------------------------------------------------------------\nfrontend kubernetes-apiserver\n    mode                 tcp\n    bind                 *:16443 #é«˜å¯ç”¨ç›‘æ§ç«¯å£ï¼Œåˆå§‹åŒ–k8sé›†ç¾¤æ—¶ä¼šç”¨\n    option               tcplog\n    default_backend      kubernetes-apiserver\n#---------------------------------------------------------------------\n# round robin balancing between the various backends\n#---------------------------------------------------------------------\nbackend kubernetes-apiserver\n    mode        tcp\n    balance     roundrobin\n    server      future-k8s-master0   10.10.1.80:6443 check\n    server      future-k8s-master1   10.10.1.81:6443 check\n    server      future-k8s-master2   10.10.1.82:6443 check\n\n#---------------------------------------------------------------------\n# collection haproxy statistics message\n#---------------------------------------------------------------------\nlisten stats\n    bind                 *:1080\n    stats auth           admin:awesomePassword\n    stats refresh        5s\n    stats realm          HAProxy\\ Statistics\n    stats uri            /admin?stats\n\n\" > /etc/haproxy/haproxy.cfg\n\ncat /etc/haproxy/haproxy.cfg\n```\n\n1. å¯åŠ¨ï¼ˆå„masterèŠ‚ç‚¹æŒ‰é¡ºåºå¯åŠ¨ï¼‰\n\n```Shell\n#å¯åŠ¨keepalived  \nsystemctl enable keepalived  && systemctl start keepalived  \n#å¯åŠ¨haproxy \nsystemctl enable haproxy && systemctl start haproxy\nsystemctl status keepalived\nsystemctl status haproxy\n```\n\n1. åœ¨future-k8s-master0æŸ¥çœ‹ç»‘å®šçš„vipåœ°å€  \n\n> ip add 1: lo: <LOOPBACK,UP,LOWER_UP> mtu 65536 qdisc noqueue state UNKNOWN group default qlen 1000    link/loopback 00:00:00:00:00:00 brd 00:00:00:00:00:00    inet 127.0.0.1/8 scope host lo       valid_lft forever preferred_lft forever    inet6 ::1/128 scope host       valid_lft forever preferred_lft forever 2: ens192: <BROADCAST,MULTICAST,UP,LOWER_UP> mtu 1500 qdisc mq state UP group default qlen 1000    link/ether 00:50:56:9a:eb:48 brd ff:ff:ff:ff:ff:ff    inet 10.10.1.80/24 brd 10.10.3.255 scope global noprefixroute ens192       valid_lft forever preferred_lft forever    inet 10.10.1.83/24 scope global ens192       valid_lft forever preferred_lft forever    inet6 fe80::250:56ff:fe9a:eb48/64 scope link noprefixroute       valid_lft forever preferred_lft forever\n\n### ä»»åŠ¡äº”ï¼šéƒ¨ç½²k8sé›†ç¾¤\n\n1. #### æ·»åŠ yumè½¯ä»¶æº\n\n```Shell\ncat > /etc/yum.repos.d/kubernetes.repo << EOF\n[kubernetes]\nname=Kubernetes\nbaseurl=https://mirrors.aliyun.com/kubernetes/yum/repos/kubernetes-el7-x86_64\nenabled=1\ngpgcheck=0\nrepo_gpgcheck=0\ngpgkey=https://mirrors.aliyun.com/kubernetes/yum/doc/yum-key.gpg https://mirrors.aliyun.com/kubernetes/yum/doc/rpm-package-key.gpg\nEOF\n```\n\n1. #### å®‰è£…kubeadmï¼Œkubeletå’Œkubectl\n\n```Shell\n# å®‰è£…kubeletã€kubeadmã€kubectl\nyum install -y kubelet-1.28.0 kubeadm-1.28.0 kubectl-1.28.0 --disableexcludes=kubernetes\n\n#å°†cgroupæ”¹ä¸ºsystemd\necho 'KUBELET_EXTRA_ARGS=\"--cgroup-driver=systemd\"' > /etc/sysconfig/kubelet\n# æŸ¥çœ‹\ncat /etc/sysconfig/kubelet\n# è®¾ç½®å¼€æœºå¯åŠ¨\nsystemctl start kubelet.service\nsystemctl enable kubelet.service\n\n#æŸ¥çœ‹ç‰ˆæœ¬\n kubeadm version\n kubelet --version\n kubectl version \n```\n\n1. #### åˆå§‹åŒ–k8sé›†ç¾¤ï¼ˆfuture-k8s-master0èŠ‚ç‚¹ï¼‰\n\n   #####  æ–¹å¼ä¸€ï¼šä½¿ç”¨é…ç½®æ–‡ä»¶åˆå§‹åŒ–\n\n   > 1. å¯¼å‡ºé»˜è®¤é…ç½®æ–‡ä»¶ (å¯é€‰)\n   >\n   > ```Shell\n   > kubeadm config print init-defaults > kubeadm-config.yaml\n   > ```\n\n   1. é…ç½®æ–‡ä»¶\n\n   ```Shell\n   echo '\n   apiVersion: kubeadm.k8s.io/v1beta3\n   kind: InitConfiguration\n   localAPIEndpoint:\n     advertiseAddress: 10.10.1.83  #è™šæ‹Ÿip\n     bindPort: 6443\n   nodeRegistration:\n     criSocket: unix:///var/run/cri-dockerd.sock\n   ---\n   apiServer:\n     certSANs:    #masterèŠ‚ç‚¹ä¸å¯¹åº”ä¸»æœºå\n       - future-k8s-master0\n       - future-k8s-master1\n       - future-k8s-master2\n       - future-k8s-vip\n       - 10.10.1.80\n       - 10.10.1.81\n       - 10.10.1.82\n       - 10.10.1.83\n       - 127.0.0.1\n     timeoutForControlPlane: 4m0s\n   apiVersion: kubeadm.k8s.io/v1beta3\n   certificatesDir: /etc/kubernetes/pki\n   clusterName: kubernetes\n   controlPlaneEndpoint: \"future-k8s-vip:16443\" #è™šæ‹ŸipåŠé«˜å¯ç”¨é…ç½®çš„ç«¯å£å·\n   controllerManager: {}\n   dns: {}\n   etcd:\n     local:\n       dataDir: /var/lib/etcd\n   imageRepository: registry.aliyuncs.com/google_containers\n   kind: ClusterConfiguration\n   kubernetesVersion: 1.28.0\n   networking:\n     dnsDomain: cluster.local\n     podSubnet: 10.244.0.0/16\n     serviceSubnet: 10.96.0.0/12\n   scheduler: {}\n   ' > /data/script/kubeadm-config.yaml\n   cat /data/script/kubeadm-config.yaml\n   ```\n\n   1. é›†ç¾¤åˆå§‹åŒ–\n\n   ```Shell\n   kubeadm init --config kubeadm-config.yaml --upload-certs\n   \n   mkdir -p $HOME/.kube\n   sudo cp -i /etc/kubernetes/admin.conf $HOME/.kube/config\n   sudo chown $(id -u):$(id -g) $HOME/.kube/config\n   ```\n\n   #####  æ–¹å¼äºŒï¼šä½¿ç”¨å‘½ä»¤åˆå§‹åŒ–\n\n   1. éƒ¨ç½²masterèŠ‚ç‚¹ï¼Œåœ¨10.10.1.80æ‰§è¡Œï¼Œåˆå§‹åŒ–masterèŠ‚ç‚¹\n\n   ```Shell\n   kubeadm init \\\n     --apiserver-advertise-address=10.10.1.80 \\\n     --image-repository registry.aliyuncs.com/google_containers \\\n     --kubernetes-version v1.28.0 \\\n     --control-plane-endpoint=future-k8s-vip:16443 \\  #è™šæ‹Ÿipï¼ˆæœªå®šï¼‰\n     --control-plane-endpoint=future-k8s-vip \\  #è™šæ‹Ÿipï¼ˆæœªå®šï¼‰\n     --service-cidr=10.96.0.0/12 \\\n     --pod-network-cidr=10.244.0.0/16 \\\n     --cri-socket=unix:///var/run/cri-dockerd.sock \\\n     --ignore-preflight-errors=all \n     \n     \n   mkdir -p $HOME/.kube\n   sudo cp -i /etc/kubernetes/admin.conf $HOME/.kube/config\n   sudo chown $(id -u):$(id -g) $HOME/.kube/config\n   ```\n\n   1. é…ç½®sshå…å¯†ç \n\n   ```Shell\n   #åœ¨10.10.1.80ä¸Šç”Ÿæˆå…¬é’¥ï¼Œå¤åˆ¶åˆ°å…¶ä»–masterèŠ‚ç‚¹ä¸Š\n   ssh-keygen -t rsa\n   ssh-copy-id 10.10.1.81\n   ssh-copy-id 10.10.1.82\n   ```\n\n   1. å°†10.10.1.80ä¸Šçš„è¯ä¹¦æ‹·è´åˆ°å…¶ä»–masterèŠ‚ç‚¹\n\n   ```Shell\n   #åœ¨å…¶ä»–masterèŠ‚ç‚¹åˆ›å»ºè¯ä¹¦å­˜æ”¾ç›®å½•\n   cd /root && mkdir -p /etc/kubernetes/pki/etcd &&mkdir -p ~/.kube/\n   \n   #å°†future-k8s-master0çš„è¯ä¹¦å¤åˆ¶åˆ°future-k8s-master1\n   scp /etc/kubernetes/pki/ca.crt 10.10.1.81:/etc/kubernetes/pki/ \n   scp /etc/kubernetes/pki/ca.key 10.10.1.81:/etc/kubernetes/pki/ \n   scp /etc/kubernetes/pki/sa.key 10.10.1.81:/etc/kubernetes/pki/\n   scp /etc/kubernetes/pki/sa.pub 10.10.1.81:/etc/kubernetes/pki/ \n   scp /etc/kubernetes/pki/front-proxy-ca.crt 10.10.1.81:/etc/kubernetes/pki/ \n   scp /etc/kubernetes/pki/front-proxy-ca.key 10.10.1.81:/etc/kubernetes/pki/ \n   scp /etc/kubernetes/pki/etcd/ca.crt 10.10.1.81:/etc/kubernetes/pki/etcd/\n   scp /etc/kubernetes/pki/etcd/ca.key 10.10.1.81:/etc/kubernetes/pki/etcd/\n   \n   #å°†future-k8s-master0çš„è¯ä¹¦å¤åˆ¶åˆ°future-k8s-master2\n   scp /etc/kubernetes/pki/ca.crt 10.10.1.82:/etc/kubernetes/pki/ \n   scp /etc/kubernetes/pki/ca.key 10.10.1.82:/etc/kubernetes/pki/ \n   scp /etc/kubernetes/pki/sa.key 10.10.1.82:/etc/kubernetes/pki/\n   scp /etc/kubernetes/pki/sa.pub 10.10.1.82:/etc/kubernetes/pki/ \n   scp /etc/kubernetes/pki/front-proxy-ca.crt 10.10.1.82:/etc/kubernetes/pki/ \n   scp /etc/kubernetes/pki/front-proxy-ca.key 10.10.1.82:/etc/kubernetes/pki/ \n   scp /etc/kubernetes/pki/etcd/ca.crt 10.10.1.82:/etc/kubernetes/pki/etcd/\n   scp /etc/kubernetes/pki/etcd/ca.key 10.10.1.82:/etc/kubernetes/pki/etcd/\n   ```\n\n1. #### åˆå§‹åŒ–å…¶ä»–masterèŠ‚ç‚¹\n\n```Shell\n kubeadm join future-k8s-vip:16443 --token yjphdh.guefcomqw3am4ask \\\n        --discovery-token-ca-cert-hash sha256:ed44c7deada0ea0fe5a54212ab4e5aa6fc34672ffe2a2c87a31ba73306e75c21 \\\n        --control-plane --certificate-key 4929b83577eafcd5933fc0b6506cb6d82e7bc481751e442888c4c2b32b5d0c9c  --cri-socket=unix:///var/run/cri-dockerd.sock\nmkdir -p $HOME/.kube\nsudo cp -i /etc/kubernetes/admin.conf $HOME/.kube/config\nsudo chown $(id -u):$(id -g) $HOME/.kube/config\n```\n\n1. #### åˆå§‹åŒ–nodeèŠ‚ç‚¹\n\n```Shell\nkubeadm join future-k8s-vip:16443 --token yjphdh.guefcomqw3am4ask \\\n        --discovery-token-ca-cert-hash sha256:ed44c7deada0ea0fe5a54212ab4e5aa6fc34672ffe2a2c87a31ba73306e75c21 --cri-socket=unix:///var/run/cri-dockerd.sock\n```\n\n1. #### è®¾ç½®masterèŠ‚ç‚¹å…è®¸è°ƒåº¦POD ï¼ˆå¯é€‰ï¼‰\n\né»˜è®¤é…ç½®ä¸‹Kubernetesä¸ä¼šå°†Podè°ƒåº¦åˆ°MasterèŠ‚ç‚¹ã€‚å¦‚æœå¸Œæœ›å°†k8s-masterä¹Ÿå½“ä½œNodeä½¿ç”¨ï¼Œéœ€å»é™¤æ±¡ç‚¹ï¼Œå¼€å¯è°ƒåº¦ã€‚\n\n```Shell\n#æŸ¥çœ‹é»˜è®¤é…ç½®çš„æ±¡ç‚¹\nkubectl describe node future-k8s-master2 |grep Taints\n```\n\n> Taints:             node-role.kubernetes.io/control-plane:NoSchedule\n\n```Shell\n#å»é™¤æ±¡ç‚¹\nkubectl taint nodes future-k8s-master2 node-role.kubernetes.io/control-plane-\n```\n\næ·»åŠ wokeræ ‡è®°\n\n```Shell\n#æ·»åŠ workeræ ‡è®°\nkubectl label nodes future-k8s-master2 node-role.kubernetes.io/worker=\n#åˆ é™¤workeræ ‡è®°\nkubectl label nodes future-k8s-master2 node-role.kubernetes.io/worker-\n```\n\n### ä»»åŠ¡å…­ï¼šå®‰è£…ç½‘ç»œæ’ä»¶(master)\n\nå®‰è£…calico\n\n```Shell\nmkdir /data/calico\nwget https://docs.tigera.io/archive/v3.25/manifests/calico.yaml\n#ä¿®æ”¹calico.yamlæ‰¾åˆ°CALICO_IPV4POOL_CIDR\nvi calico.yaml\n##############ä¿®æ”¹å†…å®¹###################\n value: \"10.244.0.0/16\"\n ##############ä¿®æ”¹å†…å®¹###################\n #åœ¨masterèŠ‚ç‚¹ä¸Šå®‰è£…calico\n kubectl apply -f calico.yaml\n```\n\næŸ¥çœ‹èŠ‚ç‚¹çŠ¶æ€\n\n```Shell\n# æŸ¥çœ‹æ‰€æœ‰çš„èŠ‚ç‚¹\nkubectl get nodes\nkubectl get nodes -o wide\n#æŸ¥çœ‹é›†ç¾¤å¥åº·æƒ…å†µ\n kubectl get cs\n```\n\n### ä»»åŠ¡ä¸ƒï¼šå®‰è£…nginxè¿›è¡Œæµ‹è¯•\n\n```Shell\n# åˆ›å»ºNginxç¨‹åº\nkubectl create deployment nginx --image=nginx\n# å¼€æ”¾80ç«¯å£\nkubectl expose deployment nginx --port=80 --type=NodePort\n# æŸ¥çœ‹podçŠ¶æ€\nkubectl get pod\n#æŸ¥çœ‹serviceçŠ¶æ€\nkubectl get service\n##########################################################################\nNAME         TYPE        CLUSTER-IP      EXTERNAL-IP   PORT(S)        AGE\nkubernetes   ClusterIP   10.96.0.1       <none>        443/TCP        5d1h\nnginx        NodePort    10.98.221.224   <none>        80:32743/TCP   23s\n##########################################################################\n# è®¿é—®ç½‘é¡µæµ‹è¯•(ç«¯å£å·ä»¥æŸ¥çœ‹serviceçŠ¶æ€å¾—åˆ°çš„ä¸ºå‡†)\nhttp://10.10.1.80:32743/\n```\n\n### ä»»åŠ¡å…«ï¼šå®‰è£…**Dashboardç•Œé¢**\n\n1. ä¸‹è½½yamlæ–‡ä»¶\n\n```Shell\n#åˆ›å»ºå­˜æ”¾ç›®å½•\nmkdir dashboard\ncd dashboard/\n#2.7\nwget https://raw.githubusercontent.com/kubernetes/dashboard/v2.7.0/aio/deploy/recommended.yaml\n```\n\n1. ä¿®æ”¹yamlæ–‡ä»¶\n\n```Shell\nvi recommended.yaml\n#å°†å‰¯æœ¬è®¾ç½®ä¸º2\n#################ä¿®æ”¹å†…å®¹#######################\nkind: Service\napiVersion: v1\nmetadata:\n  labels:\n    k8s-app: kubernetes-dashboard\n  name: kubernetes-dashboard\n  namespace: kubernetes-dashboard\nspec:\n  ports:\n    - port: 443\n      targetPort: 8443\n      nodePort: 32009   #æ·»åŠ è¿™ä¸€è¡Œï¼Œæ³¨æ„ç¼©è¿›å¯¹é½\n  selector:\n    k8s-app: kubernetes-dashboard\n  type: NodePort          #æ·»åŠ è¿™ä¸€è¡Œï¼Œæ³¨æ„ç¼©è¿›å¯¹é½\n  #################ä¿®æ”¹å†…å®¹#######################\n```\n\n1. åº”ç”¨å®‰è£…ï¼ŒæŸ¥çœ‹podå’Œsvc\n\n```Shell\n#å®‰è£…\nkubectl apply -f recommended.yaml\n#æŸ¥çœ‹podå’Œsvc\nkubectl get pod,svc -o wide -n kubernetes-dashboard\n#########################################################\nNAME                                             READY   STATUS              RESTARTS   AGE   IP       NODE    NOMINATED NODE   READINESS GATES\npod/dashboard-metrics-scraper-5cb4f4bb9c-mg569   0/1     ContainerCreating   0          9s    <none>   node1   <none>           <none>\npod/kubernetes-dashboard-6967859bff-2968p        0/1     ContainerCreating   0          9s    <none>   node1   <none>           <none>\n\nNAME                                TYPE        CLUSTER-IP       EXTERNAL-IP   PORT(S)         AGE   SELECTOR\nservice/dashboard-metrics-scraper   ClusterIP   10.100.129.191   <none>        8000/TCP        9s    k8s-app=dashboard-metrics-scraper\nservice/kubernetes-dashboard        NodePort    10.106.130.53    <none>        443:31283/TCP   9s    k8s-app=kubernetes-dashboard\n########################################################\n```\n\nä½¿ç”¨æ‰€æŸ¥çœ‹çš„svcï¼Œæ‰€æä¾›çš„ç«¯å£è®¿é—®**Dashboard**\n\n1. åˆ›å»ºdashboardæœåŠ¡è´¦æˆ·\n\n```Shell\n#åˆ›å»ºä¸€ä¸ªadmin-userçš„æœåŠ¡è´¦æˆ·å¹¶ä¸é›†ç¾¤ç»‘å®š\nvi dashboard-adminuser.yaml\n##################å†…å®¹####################\napiVersion: v1\nkind: ServiceAccount\nmetadata:\n  name: admin-user\n  namespace: kubernetes-dashboard\n\n---\n\napiVersion: rbac.authorization.k8s.io/v1\nkind: ClusterRoleBinding\nmetadata:\n  name: admin-user\nroleRef:\n  apiGroup: rbac.authorization.k8s.io\n  kind: ClusterRole\n  name: cluster-admin\nsubjects:\n- kind: ServiceAccount\n  name: admin-user\n  namespace: kubernetes-dashboard\n  \n---\n# åˆ›å»ºå¯†é’¥ï¼Œè·å–æœåŠ¡å¸æˆ·çš„é•¿æœŸæŒæœ‰è€…ä»¤ç‰Œ\napiVersion: v1\nkind: Secret\nmetadata:\n  name: admin-user\n  namespace: kubernetes-dashboard\n  annotations:\n    kubernetes.io/service-account.name: \"admin-user\"\ntype: kubernetes.io/service-account-token\n  ##################å†…å®¹####################\n \n  #æ‰§è¡Œç”Ÿæ•ˆ\n  kubectl apply -f dashboard-adminuser.yaml\n```\n\n1. ç™»å½•æ–¹å¼\n\næ–¹æ¡ˆä¸€ï¼šè·å–é•¿æœŸå¯ç”¨token\n\n```Shell\n#å°†å…¶ä¿å­˜åœ¨/data/dashboard/çš„admin-user.tokenæ–‡ä»¶ä¸­\ncd /data/dashboard/\nkubectl get secret admin-user -n kubernetes-dashboard -o jsonpath={\".data.token\"} | base64 -d > admin-user.token \n```\n\nè·å–é•¿æœŸå¯ç”¨tokenè„šæœ¬\n\n```Shell\n#!/bin/bash\n#ä½œè€…ï¼šäº‘\n#############æè¿°#############\n:<<!\nè·å–é•¿æœŸå¯ç”¨tokenè„šæœ¬\nå°†tokenå­˜æ”¾åœ¨admin-user.tokenæ–‡ä»¶ä¸­\n!\n#############æè¿°#############\nkubectl get secret admin-user -n kubernetes-dashboard -o jsonpath={\".data.token\"} | base64 -d > admin-user.token\n\necho -e \"\\033[1;32måˆ›å»ºtokenæˆåŠŸï¼Œè¯·åœ¨admin-user.tokenæ–‡ä»¶ä¸­æŸ¥çœ‹\\033[m\"\n```\n\næ–¹æ¡ˆäºŒï¼šä½¿ç”¨ä½¿ç”¨ Kubeconfig æ–‡ä»¶ç™»å½•\n\n```Shell\n #å®šä¹‰ token å˜é‡\n DASH_TOCKEN=$(kubectl get secret admin-user -n kubernetes-dashboard -o jsonpath={\".data.token\"} | base64 -d)\n #è®¾ç½® kubeconfig é›†ç¾¤æ¡ç›®\n kubectl config set-cluster kubernetes --server=10.10.1.80:6433 --kubeconfig=/root/dashbord-admin.conf\n #è®¾ç½® kubeconfig ç”¨æˆ·æ¡ç›®\n kubectl config set-credentials admin-user --token=$DASH_TOCKEN --kubeconfig=/root/dashbord-admin.conf\n #è®¾ç½® kubeconfig ä¸Šä¸‹æ–‡æ¡ç›®\n kubectl config set-context admin-user@kubernetes --cluster=kubernetes --user=admin-user --kubeconfig=/root/dashbord-admin.conf\n #è®¾ç½® kubeconfig å½“å‰ä¸Šä¸‹æ–‡\n kubectl config use-context admin-user@kubernetes  --kubeconfig=/root/dashbord-admin.conf\n```\n\nå°†ç”Ÿæˆçš„dashbord-admin.confæ–‡ä»¶æ”¾åˆ°æœ¬åœ°ä¸»æœºä¸Šï¼Œç™»å½•æ—¶é€‰æ‹©`Kubeconfig`é€‰é¡¹ï¼Œé€‰æ‹© kubeconfig æ–‡ä»¶ç™»å½•\n\n### ä»»åŠ¡ä¹ï¼šå®‰è£…metrics-server\n\nä¸‹è½½éƒ¨ç½²æ–‡ä»¶\n\n```Shell\nwget https://github.com/kubernetes-sigs/metrics-server/releases/latest/download/components.yaml -O metrics-server-components.yaml\n```\n\nä¿®æ”¹yamlæ–‡ä»¶ä¸­çš„Deploymentå†…å®¹\n\n```Shell\n---\napiVersion: apps/v1\nkind: Deployment\nmetadata:\n  labels:\n    k8s-app: metrics-server\n  name: metrics-server\n  namespace: kube-system\nspec:\n  selector:\n    matchLabels:\n      k8s-app: metrics-server\n  strategy:\n    rollingUpdate:\n      maxUnavailable: 0\n  template:\n    metadata:\n      labels:\n        k8s-app: metrics-server\n    spec:\n      containers:\n      - args:\n        - --cert-dir=/tmp\n        - --secure-port=4443\n        - --kubelet-preferred-address-types=InternalIP,ExternalIP,Hostname\n        - --kubelet-use-node-status-port\n        - --metric-resolution=15s\n        - --kubelet-insecure-tls  #æ·»åŠ \n        image: registry.cn-hangzhou.aliyuncs.com/google_containers/metrics-server:v0.6.4 #ä¿®æ”¹\n        imagePullPolicy: IfNotPresent\n\n#å®‰è£…\nkubectl apply -f metrics-server-components.yaml\n```\n\næŸ¥çœ‹metrics-serverçš„podçŠ¶æ€\n\n```Shell\nkubectl get pods --all-namespaces | grep metrics\n```\n\nç­‰å¾…ä¸€äº›æ—¶é—´ï¼ŒæŸ¥çœ‹æŸ¥çœ‹å„ç±»ç›‘æ§å›¾åƒå·²æˆåŠŸæ˜¾ç¤ºã€‚\n\n![image-20240323222707075](é«˜å¯ç”¨å®¹å™¨äº‘å»ºè®¾/image-20240323222707075-1711204031457-1.png)\n\n### ä»»åŠ¡åï¼škubectlå‘½ä»¤è‡ªåŠ¨è¡¥å…¨\n\n```Shell\nyum -y install bash-completion\nsource /usr/share/bash-completion/bash_completion\necho 'source <(kubectl completion bash)' >>  ~/.bashrc\nbash\n```\n\n### ä»»åŠ¡åä¸€ï¼šingress-nginxæ§åˆ¶å™¨å®‰è£…\n\n```Shell\n#ä¸‹è½½yamlæ–‡ä»¶\nwget https://raw.githubusercontent.com/kubernetes/ingress-nginx/controller-v1.0.0/deploy/static/provider/baremetal/deploy.yaml\n#ä¿®æ”¹yamlæ–‡ä»¶ä¸­æ‹‰å–é•œåƒçš„åœ°å€\n#####################ä¿®æ”¹å†…å®¹######################\nwilldockerhub/ingress-nginx-controller:v1.0.0\nhzde0128/kube-webhook-certgen:v1.0\n#####################ä¿®æ”¹å†…å®¹######################\n#ä¿®æ”¹Deploymentä¿®æ”¹æˆDaemonSet\n#ä¿®æ”¹ç½‘ç»œæ¨¡å¼ä¸ºhost network\n#####################ä¿®æ”¹å†…å®¹######################\ntemplate:\n  spec:\n    hostNetwork: true\n    dnsPolicy: ClusterFirstWithHostNet\n    tolerations:  #ä½¿ç”¨äº²å’Œæ€§é…ç½®å¯åœ¨æ‰€æœ‰èŠ‚ç‚¹éƒ¨ç½²\n      - key: node-role.kubernetes.io/control-plane\n        operator: Exists\n        effect: NoSchedule\n     nodeSelector:\n          kubernetes.io/os: linux\n          custem/ingress-controller-ready: 'true'\n      containers:\n        - name: controller\n#####################ä¿®æ”¹å†…å®¹######################\n#ä¸ºå·¥ä½œèŠ‚ç‚¹è®¾ç½®æ ‡ç­¾ï¼ˆå¿…éœ€ï¼‰\nkubectl label nodes future-k8s-master0 custem/ingress-controller-ready=true\nkubectl label nodes future-k8s-master1 custem/ingress-controller-ready=true\nkubectl label nodes future-k8s-master2 custem/ingress-controller-ready=true\nkubectl label nodes future-k8s-node3 custem/ingress-controller-ready=true\n\n#å®‰è£…\nkubectl apply -f deploy.yaml\n\n#æŸ¥çœ‹çŠ¶æ€\nkubectl get pods -n ingress-nginx\n################çŠ¶æ€##################\nNAME                                       READY   STATUS      RESTARTS   AGE\ningress-nginx-admission-create-2lz4v       0/1     Completed   0          5m46s\ningress-nginx-admission-patch-c6896        0/1     Completed   0          5m46s\ningress-nginx-controller-7575fb546-q29qn   1/1     Running     0          5m46s\n```\n\n### ä»»åŠ¡åäºŒï¼šé…ç½®**Dashboardä»£ç†**\n\n```Shell\necho '\napiVersion: networking.k8s.io/v1\nkind: Ingress\nmetadata:\n  name: k8s-dashboard\n  namespace: kubernetes-dashboard\n  labels:\n    ingress: k8s-dashboard\n  annotations:\n    nginx.ingress.kubernetes.io/rewrite-target: /  #é‡å†™è·¯å¾„\n    nginx.ingress.kubernetes.io/force-ssl-redirect: \"true\"   #httpè‡ªåŠ¨è½¬https\n    nginx.ingress.kubernetes.io/use-regex: \"true\"\n    nginx.ingress.kubernetes.io/backend-protocol: \"HTTPS\"\nspec:\n  ingressClassName: nginx \n  rules:\n    - host: k8s.yjs.51xueweb.cn\n      http:\n        paths:\n          - path: /\n            pathType: Prefix\n            backend:\n              service:\n                name: kubernetes-dashboard\n                port:\n                  number: 443\n' > /data/dashboard/dashboard-ingress.yaml\n```\n\n## ä¸‰ï¼šå¯¹æ¥k8sé›†ç¾¤ä¸cephé›†ç¾¤\n\n### ä»»åŠ¡ä¸€ï¼šå®‰è£…cephå®¢æˆ·ç«¯ï¼ˆceph-commonï¼‰\n\nåœ¨k8sé›†ç¾¤çš„æ¯ä¸ªèŠ‚ç‚¹å®‰è£…ceph-common\n\n```Shell\nyum install ceph-common -y\n```\n\n### ä»»åŠ¡äºŒï¼šåŒæ­¥cpehé›†ç¾¤é…ç½®æ–‡ä»¶\n\nå°† ceph é›†ç¾¤çš„ /etc/ceph/{ceph.conf,ceph.client.admin.keyring} æ–‡ä»¶åŒæ­¥åˆ° k8s æ‰€æœ‰èŠ‚ç‚¹ä¸Š\n\n```Shell\n#é…ç½®sshå…å¯†\nssh-keygen -t rsa\nssh-copy-id 10.10.1.80\nssh-copy-id 10.10.1.81\nssh-copy-id 10.10.1.82\n\n#æ‹·è´æ–‡ä»¶\nscp -r /etc/ceph/{ceph.conf,ceph.client.admin.keyring} 10.10.1.80:/etc/ceph\nscp -r /etc/ceph/{ceph.conf,ceph.client.admin.keyring} 10.10.1.81:/etc/ceph\nscp -r /etc/ceph/{ceph.conf,ceph.client.admin.keyring} 10.10.1.82:/etc/ceph\n```\n\n### ä»»åŠ¡ä¸‰ï¼šéƒ¨ç½²ceph-csiï¼ˆä½¿ç”¨rbdï¼‰\n\n1. ä¸‹è½½ceph-csiç»„ä»¶(k8sä¸­çš„ä¸€ä¸ªmasterèŠ‚ç‚¹)\n\n```Shell\n#ä¸‹è½½æ–‡ä»¶\nwget https://github.com/ceph/ceph-csi/archive/refs/tags/v3.9.0.tar.gz\n#è§£å‹\nmv v3.9.0.tar.gz ceph-csi-v3.9.0.tar.gz\ntar -xzf ceph-csi-v3.9.0.tar.gz\n#è¿›å…¥ç›®å½•\ncd  ceph-csi-3.9.0/deploy/rbd/kubernetes\nmkdir /data/cephfs/csi\n#æ‹·è¿›csiä¸­ï¼Œå…±6å…­ä¸ªæ–‡ä»¶\ncp * /data/cephfs/csi\n```\n\n1. æ‹‰å–csiç»„ä»¶æ‰€éœ€é•œåƒ\n\n```Shell\n#æŸ¥çœ‹æ‰€éœ€é•œåƒ\ngrep image csi-rbdplugin-provisioner.yaml\ngrep image csi-rbdplugin.yaml\n```\n\nåœ¨æ‰€æœ‰k8sèŠ‚ç‚¹ä¸Šæ‹‰å–æ‰€éœ€çš„é•œåƒ\n\n```Shell\ncd /data/script\n./pull-images.sh registry.k8s.io/sig-storage/csi-provisioner:v3.5.0\n./pull-images.sh registry.k8s.io/sig-storage/csi-resizer:v1.8.0\n./pull-images.sh registry.k8s.io/sig-storage/csi-snapshotter:v6.2.2\ndocker pull  quay.io/cephcsi/cephcsi:v3.9.0\n./pull-images.sh registry.k8s.io/sig-storage/csi-attacher:v4.3.0\n./pull-images.sh registry.k8s.io/sig-storage/csi-node-driver-registrar:v2.8.0\n```\n\n1. åˆ›å»ºå‘½åç©ºé—´`cephfs`\n\n```Shell\necho '\napiVersion: v1\nkind: Namespace\nmetadata:\n  labels:\n    kubernetes.io/metadata.name: cephfs\n  name: cephfs\n  ' > ceph-namespace.yaml\n  \n #æ‰§è¡Œ\n  kubectl apply -f ceph-namespace.yaml \n```\n\n1. åˆ›å»ºè¿æ¥ ceph é›†ç¾¤çš„ç§˜é’¥æ–‡ä»¶csi-rbd-secret.yaml\n\n```Shell\necho '\napiVersion: v1\nkind: Secret\nmetadata:\n  name: csi-rbd-secret\n  namespace: cephfs\nstringData:\n  adminID: admin \n  adminKey: AQANDD9lfWg2LBAAHY0mprdbuKFBPJDkE7/I5Q==\n  userID: admin  \n  userKey: AQANDD9lfWg2LBAAHY0mprdbuKFBPJDkE7/I5Q==\n  ' > csi-rbd-secret.yaml\n  \n   #æ‰§è¡Œ\n    kubectl apply -f csi-rbd-secret.yaml\n```\n\n1. åˆ›å»ºceph-config-map.yaml \n\n```Shell\necho '\napiVersion: v1\nkind: ConfigMap\ndata:\n  ceph.conf: |\n     [global]\n     fsid = 30912204-0c26-413f-8e00-6d55c9c0af03     # ç”Ÿæˆçš„FSID\n     mon initial members =k8s-ceph-node0,k8s-ceph-node1,k8s-ceph-node2            # ä¸»æœºå\n     mon host = 10.10.1.16,10.10.1.17,10.10.1.18                       # å¯¹åº”çš„IP\n     public network = 10.10.1.0/24\n     auth cluster required = cephx\n     auth service required = cephx\n     auth client required = cephx\n     osd journal size = 1024\n     osd pool default size = 3\n     osd pool default min size = 2\n     osd pool default pg num = 333\n     osd pool default pgp num = 333\n     osd crush chooseleaf type = 1\n     [mon]\n     mon allow pool delete = true\n\n     [mds.k8s-ceph-node0]    \n     host = k8s-ceph-node0\n  keyring: |\nmetadata:\n  name: ceph-config\n  namespace: cephfs\n' > ceph-config-map.yaml\n\n #æ‰§è¡Œ\n kubectl apply -f ceph-config-map.yaml  \n```\n\n1. ä¿®æ”¹csi-config-map.yamlï¼Œé…ç½®è¿æ¥ ceph é›†ç¾¤çš„ä¿¡æ¯\n\n```Shell\necho '\napiVersion: v1\nkind: ConfigMap\nmetadata:\n  name: ceph-csi-config\n  namespace: cephfs\n  labels:\n    addonmanager.kubernetes.io/mode: Reconcile\ndata:\n  config.json: |-\n    [{\"clusterID\":\"30912204-0c26-413f-8e00-6d55c9c0af03\",\"monitors\":[\"10.10.1.16:6789\",\"10.10.1.17:6789\",\"10.10.1.18:6789\"]}]\n' > csi-config-map.yaml\n```\n\n1. ä¿®æ”¹csiç»„ä»¶é…ç½®æ–‡ä»¶\n\n   1. æ‹·è´è¿›`/data/cephfs/csi`ç›®å½•ä¸­çš„æ‰€æœ‰yamlæ–‡ä»¶ä¸­çš„å‘½åç©ºé—´ç”±`default`æ”¹ä¸º`cephfs`\n\n   2. ```Shell\n      cd /data/cephfs/csi\n      sed -i \"s/namespace: default/namespace: cephfs/g\" $(grep -rl \"namespace: default\" ./)\n      sed -i -e \"/^kind: ServiceAccount/{N;N;a\\  namespace: cephfs}\" $(egrep -rl \"^kind: ServiceAccount\" ./)\n      ```\n\n   3. å°†`csi-rbdplugin-provisioner.yaml` å’Œ `csi-rbdplugin.yaml` ä¸­çš„ kms éƒ¨åˆ†é…ç½®æ³¨é‡Šæ‰\n\n   4. >    \\# - name: KMS_CONFIGMAP_NAME\n      >\n      > â€‹            \\#   value: encryptionConfig\n      >\n      > \n      >\n      > \\#- name: ceph-csi-encryption-kms-config\n      >\n      > â€‹        \\#  configMap:\n      >\n      > â€‹        \\#    name: ceph-csi-encryption-kms-config\n      >\n      > \n\n```Shell\n #æ‰§è¡Œï¼Œå®‰è£…csiç»„ä»¶\n kubectl apply -f csi-config-map.yaml\n kubectl apply -f csi-nodeplugin-rbac.yaml\n kubectl apply -f csidriver.yaml\n kubectl apply -f csi-provisioner-rbac.yaml\n kubectl apply -f csi-rbdplugin-provisioner.yaml\n kubectl apply -f csi-rbdplugin.yaml\n```\n\n### ä»»åŠ¡å››ï¼šåˆ›å»ºstorageclass\n\n```Shell\necho '\napiVersion: storage.k8s.io/v1\nkind: StorageClass\nmetadata:\n  annotations:\n    k8s.kuboard.cn/storageType: cephfs_provisioner\n  name: csi-rbd-sc\nprovisioner: rbd.csi.ceph.com\nparameters:\n  # fsName: cephfs  ï¼ˆcephfsæ–¹å¼ä½¿ç”¨ï¼‰\n  clusterID: 30912204-0c26-413f-8e00-6d55c9c0af03 \n  pool: rbd-k8s \n  imageFeatures: layering\n  csi.storage.k8s.io/provisioner-secret-name: csi-rbd-secret\n  csi.storage.k8s.io/provisioner-secret-namespace: cephfs\n  csi.storage.k8s.io/controller-expand-secret-name: csi-rbd-secret\n  csi.storage.k8s.io/controller-expand-secret-namespace: cephfs\n  csi.storage.k8s.io/node-stage-secret-name: csi-rbd-secret\n  csi.storage.k8s.io/node-stage-secret-namespace: cephfs\n  csi.storage.k8s.io/fstype: xfs\nreclaimPolicy: Delete\nvolumeBindingMode: Immediate\nallowVolumeExpansion: true\nmountOptions:\n  - discard\n ' > storageclass.yaml\n \n #æ‰§è¡Œ\n  kubectl apply -f storageclass.yaml\n```\n\n### ä»»åŠ¡äº”ï¼šåˆ›å»ºPVC\n\n```Shell\necho '\napiVersion: v1\nkind: PersistentVolumeClaim\nmetadata:\n  name: rbd-pvc \n  namespace: cephfs\nspec:\n  accessModes:\n    - ReadWriteOnce\n  resources:\n    requests:\n      storage: 1Gi \n  storageClassName: csi-rbd-sc\n  ' > pvc.yaml\n  \n#æ‰§è¡Œ\n kubectl apply -f pvc.yaml\n#æŸ¥çœ‹PVCæ˜¯å¦åˆ›å»ºæˆåŠŸ\nkubectl get pvc -n cephfs\n#æŸ¥çœ‹PVæ˜¯å¦åˆ›å»ºæˆåŠŸ\nkubectl get pv -n cephfs\n\n#æŸ¥çœ‹cephé›†ç¾¤ä¸­çš„cephfs_dataå­˜å‚¨æ± ä¸­æ˜¯å¦åˆ›å»ºäº†image\n rbd ls -p rbd-k8s\n```\n\n### ä»»åŠ¡å…­ï¼šåˆ›å»ºpodï¼Œè¿›è¡Œæµ‹è¯•éªŒè¯\n\n```Shell\necho '\napiVersion: v1\nkind: Pod\nmetadata:\n  name: csi-rbd-demo-pod\n  namespace: cephfs\nspec:\n  containers:\n    - name: web-server\n      image: nginx:latest\n      volumeMounts:\n        - name: mypvc\n          mountPath: /var/lib/www/html\n  volumes:\n    - name: mypvc\n      persistentVolumeClaim:\n        claimName: rbd-pvc \n        readOnly: false\n' > pod.yaml\n\n#æ‰§è¡Œ\n kubectl apply -f pod.yaml\n #è¿›å…¥å®¹å™¨æŸ¥çœ‹æŒ‚è½½ä¿¡æ¯\nkubectl exec -it csi-rbd-demo-pod -n cephfs -- bash\n lsblk -l|grep rbd\n```\n\n","tags":["k8s","å®¹å™¨äº‘","ceph","å…±äº«å­˜å‚¨","cephé›†ç¾¤","docker"],"categories":["å®¹å™¨åŒ–","å­˜å‚¨ç³»ç»Ÿ","k8s","ceph"]},{"title":"dockeråŸºç¡€çŸ¥è¯†","url":"/yyg/7b36b89c/","content":"\n`docker search é•œåƒ` #æœç´¢è¦ä¸‹è½½çš„é•œåƒ\n\n`docker pull é•œåƒ` #å°†é•œåƒæ‹‰åˆ°æœ¬åœ°\n\n`docker images` #æŸ¥çœ‹å·²æ‹‰å–åˆ°æœ¬åœ°çš„é•œåƒ\n\n`docker rmi é•œåƒåæˆ–ID` #åˆ é™¤é•œåƒ\n\n`docker rm å®¹å™¨ID` #åˆ é™¤å·²åœæ­¢å®¹å™¨\n\n> `docker rm -f å®¹å™¨ID` #å¼ºåˆ¶åˆ é™¤å®¹å™¨\n\nä¸€æ¬¡æ€§åˆ é™¤å¤šä¸ªå®¹å™¨\n\n> `docker rm -f $(docker ps -a -q)`\n>\n> `docker ps -a -q |xargs docker rm`\n\nåˆ é™¤è™šæ‚¬é•œåƒ\n\n> `docker image ls -f dangling=true` #æ˜¾ç¤ºæ‰€æœ‰çš„è™šæ‚¬é•œåƒ\n>\n> `docker image prune` #åˆ é™¤è™šæ‚¬é•œåƒ\n\n`docker ps` #æŸ¥çœ‹æ­£åœ¨è¿è¡Œçš„å®¹å™¨\n\n> `docker ps -a` #åˆ—å‡ºæ‰€æœ‰æ­£åœ¨è¿è¡Œå’Œæ›¾è¿è¡Œè¿‡çš„å®¹å™¨\n>\n> `docker ps -l` #æ˜¾ç¤ºæœ€è¿‘åˆ›å»ºçš„å®¹å™¨\n>\n> `docker ps -n` #æ˜¾ç¤ºæœ€è¿‘åˆ›å»ºçš„nä¸ªå®¹å™¨\n>\n> `docker ps -q` #åªæ˜¾ç¤ºå®¹å™¨ç¼–å·\n\n`docker stop  å®¹å™¨åæˆ–ID` #ç»“æŸå®¹å™¨è¿è¡Œ\n\n`docker kill  å®¹å™¨åæˆ–ID` #å¼ºåˆ¶åœæ­¢å®¹å™¨è¿è¡Œ\n\n`docker start å®¹å™¨åæˆ–ID` #å¯åŠ¨å·²åœæ­¢çš„å®¹å™¨\n\n`docker restart å®¹å™¨åæˆ–ID` #é‡å¯å®¹å™¨\n\n`docker run -it é•œåƒåæˆ–ID` #å¯åŠ¨é•œåƒ(-itæŒ‡äº¤äº’å¼å¯åŠ¨)\n\n> `docker run -d å®¹å™¨åæˆ–ID` #å®¹å™¨åå°è¿è¡Œ\n>\n> `docker run -it -p ç«¯å£å·:ç«¯å£å· å®¹å™¨åæˆ–ID` #ä»¥ç‰¹å®šç«¯å£å·è¿è¡Œå®¹å™¨\n>\n> `docker run -it -P å®¹å™¨åæˆ–ID` #éšæœºåˆ†é…ç«¯å£å·è¿è¡Œå®¹å™¨\n>\n> å¯åŠ¨é•œåƒåï¼ŒæŒ‰ä¸‹`ctrl+p+q`ï¼Œå®¹å™¨åå°è¿è¡Œ \n\né‡æ–°è¿›å…¥åå°è¿è¡Œçš„å®¹å™¨\n\n> `docker exec -it  å®¹å™¨ID` #åœ¨å®¹å™¨ä¸­æ‰“å¼€æ–°çš„ç»ˆç«¯ï¼Œå¹¶ä¸”å¯ä»¥å¯åŠ¨æ–°çš„è¿›ç¨‹ï¼Œç”¨exité€€å‡ºï¼Œä¸ä¼šå¯¼è‡´å®¹å™¨çš„åœæ­¢ã€‚(æ¨èä½¿ç”¨)\n>\n> `docker attach å®¹å™¨ID`  #ç›´æ¥è¿›å…¥å®¹å™¨å¯åŠ¨å‘½ä»¤çš„ç»ˆç«¯ï¼Œä¸ä¼šå¯åŠ¨æ–°çš„è¿›ç¨‹ï¼Œç”¨exité€€å‡ºï¼Œä¼šå¯¼è‡´å®¹å™¨çš„åœæ­¢ã€‚\n\n`docker inspect å®¹å™¨ID`#æ˜¾ç¤ºå®¹å™¨å†…çš„è¯¦ç»†ä¿¡æ¯\n\n`docker logs  å®¹å™¨ID` #æŸ¥çœ‹å®¹å™¨æ—¥å¿—\n\n`docker top  å®¹å™¨ID` æŸ¥çœ‹å®¹å™¨å†…è¿›ç¨‹\n\n`docker cp  å®¹å™¨ID:å®¹å™¨å†…è·¯å¾„ ç›®çš„ä¸»æœºè·¯å¾„` #å°†æ–‡ä»¶ä»å®¹å™¨æ‹·è´åˆ°ä¸»æœº\n\nå®¹å™¨çš„å¯¼å…¥å¯¼å‡º\n\n> `docker export  å®¹å™¨ID >æ–‡ä»¶å.tar` #å°†å®¹å™¨åŠå†…å®¹å¯¼å‡ºä¸ºtaråŒ…\n>\n> `cat æ–‡ä»¶å.tar | docker import -é•œåƒç”¨æˆ·/é•œåƒå:é•œåƒç‰ˆæœ¬å·` #ä»taråŒ…ä¸­åˆ›å»ºä¸€ä¸ªæ–°æ–‡ä»¶ç³»ç»Ÿå†å¯¼å…¥é•œåƒ\n\n`docker run -it --privileged=true -v /å®¿ä¸»æœºç›®å½•:/å®¹å™¨å†…ç›®å½• é•œåƒå`#å®¿ä¸»æœºä¸å®¹å™¨ä¹‹é—´æ˜ å°„æ·»åŠ å®¹å™¨å·\n\n`docker run -it --privileged=true -v /å®¿ä¸»æœºç›®å½•:/å®¹å™¨å†…ç›®å½•:rw é•œåƒå`#å®¿ä¸»æœºä¸å®¹å™¨ä¹‹é—´æ˜ å°„æ·»åŠ å®¹å™¨å·,å®¹å™¨å†…æ–‡ä»¶å¯è¯»å¯å†™\n\n`docker run -it --privileged=true -v /å®¿ä¸»æœºç›®å½•:/å®¹å™¨å†…ç›®å½•:ro é•œåƒå`#å®¿ä¸»æœºä¸å®¹å™¨ä¹‹é—´æ˜ å°„æ·»åŠ å®¹å™¨å·,å®¹å™¨å†…æ–‡ä»¶åªå¯è¯»\n\n`docker run -it --privileged=true -volumes-from çˆ¶ç±» -name å®¹å™¨2åç§° é•œåƒå` #å®¹å™¨2ç»§æ‰¿å®¹å™¨1çš„å·è§„åˆ™\n\n![image-20240323215245387](dockeråŸºç¡€çŸ¥è¯†/image-20240323215245387.png)","tags":["docker","dockeråŸºç¡€"],"categories":["å®¹å™¨åŒ–","docker","æ¢³ç†æ€»ç»“"]},{"title":"dockerå®‰è£…mysql","url":"/yyg/25ae9841/","content":"> `docker pull mysql` #æ‹‰å–mysqlé•œåƒ(æœ€æ–°ç‰ˆ)\n\nè‹¥å®‰è£…ç‰¹å®šç‰ˆæœ¬å¦‚6.0ï¼Œåˆ™å‘½ä»¤å¦‚ä¸‹ï¼š\n\n`docker pull mysql:6.0`\n\nè¿è¡Œmysqlï¼Œå¹¶åˆ†é…3306ç«¯å£ï¼Œè¯¥å‘½ä»¤å¦‚ä¸‹ï¼š(**æ³¨ï¼šä¸‹é¢çš„æ˜¯ä¸€æ¡å‘½ä»¤**)\n\næ­¤å‘½ä»¤ä¸­çš„`jiamian`ä¸ºå°ç¼–çš„liunxç³»ç»Ÿçš„ç”¨æˆ·åï¼Œç”¨æ—¶éœ€æ›¿æ¢ä¸ºè‡ªå·±çš„ç”¨æˆ·å\n\n`MYSQL_ROOT_PASSWORD`åå¡«çš„æ˜¯mysqlçš„å¯†ç ï¼Œå¯è‡ªè¡Œæ›¿æ¢\n\n`--name`åå¡«çš„mysql-1æ˜¯è¿è¡Œçš„mysqlå®¹å™¨çš„åç§°ï¼Œä¹Ÿå¯è‡ªè¡Œæ›¿æ¢\n\n> docker run -d -p 3306:3306 --privileged=true -v /jiamian/mysql/log:/var/log/mysql\n>\n> -v /jiamian/mysql/data:/var/lib/mysql -v /jiamian/mysql/conf:/etc/mysql/conf.d \n>\n> -e MYSQL_ROOT_PASSWORD=123456 --name mysql-1 mysql\n\næ­¤å‘½ä»¤ä¹Ÿå¯è§£å†³åœ¨åˆ é™¤mysqlå®¹å™¨åï¼Œè€Œå‡ºç°çš„æ•°æ®åº“æ•°æ®ä¸¢å¤±çš„é—®é¢˜ã€‚è‹¥è¦æ‰¾å›æ•°æ®ï¼Œåˆ™åªéœ€é‡æ–°è¿è¡Œå‘½ä»¤å³å¯ã€‚\n\n![image-20230410201124021](dockerå®‰è£…mysql/image-20230410201124021.png)\n\nè¿è¡Œ`docker ps`å‘½ä»¤ï¼Œå¯æŸ¥çœ‹åˆ°mysqlæ­£åœ¨è¿è¡Œ\n\n![image-20230410201052873](dockerå®‰è£…mysql/image-20230410201052873.png)\n\n## è§£å†³mysqlæ’å…¥ä¸­æ–‡ä¹±ç çš„æƒ…å†µ\n\nç„¶åè¾“å…¥å‘½ä»¤`cd /jiamian/mysql/conf`ã€‚è¿›å…¥è¯¥ç›®å½•åï¼Œè¾“å…¥å‘½ä»¤`vim my.cnf`ï¼Œæ–°å»ºmy.cnfæ–‡ä»¶ï¼Œ\n\nå¹¶è¾“å…¥ä»¥ä¸‹ä»£ç \n\n> [client]\n> default_character_set=utf8\n> [mysqld]\n> collation_server = utf8_general_ci\n> character_set_server = utf8\n\nä¿å­˜é€€å‡ºåï¼Œè¾“å…¥ `docker restart mysql-1`ï¼Œé‡å¯mysqlã€‚\n\nå†è¾“å…¥`docker exec -it mysql-1 /bin/bash`è¿›å…¥mysqlç¯å¢ƒï¼Œæ­¤æ—¶æ±‰å­—å¯æ­£å¸¸æ˜¾ç¤º\n\n![image-20230410202120798](dockerå®‰è£…mysql/image-20230410202120798.png)\n\n\n\n","tags":["mysql","docker"],"categories":["å®¹å™¨åŒ–","docker"]},{"title":"docker å®‰è£… redis","url":"/yyg/6fffbcc4/","content":"é¦–å…ˆè¾“å…¥å‘½ä»¤`docker pull redis` ï¼Œå°†æœ€æ–°ç‰ˆrediså®‰è£…åˆ°æœ¬åœ°\n\nè¾“å…¥ä»¥ä¸‹å‘½ä»¤,åå°å¯åŠ¨redis(æ³¨ï¼š**è¯¥å‘½ä»¤æ˜¯ä¸€æ¡å‘½ä»¤**)\n\nå…¶ä¸­`--name`åé¢çš„æ˜¯rediså®¹å™¨çš„åç§°ï¼Œå¯è‡ªè¡Œæ›´æ”¹\n\n> docker run -p 6379:6379 --name mars1 --privileged=true\n>\n>  -v /app/redis/redis.conf:/etc/redis/redis.conf \n>\n> -v /app/redis/data:/data \n>\n> -d redis:latest redis-server /etc/redis/redis.conf\n\næ­¤å‘½ä»¤ä¹Ÿå¯è§£å†³åœ¨åˆ é™¤rediså®¹å™¨åï¼Œè€Œå‡ºç°çš„æ•°æ®ä¸¢å¤±çš„é—®é¢˜ã€‚è‹¥è¦æ‰¾å›æ•°æ®ï¼Œåˆ™åªéœ€é‡æ–°è¿è¡Œå‘½ä»¤å³å¯ã€‚\n\n![image-20230411164804210](docker å®‰è£… redis/image-20230411164804210.png)\n\nè¿è¡Œ`docker ps`å‘½ä»¤ï¼Œå¯æŸ¥çœ‹åˆ°redisæ­£åœ¨è¿è¡Œ\n\n![image-20230411163752381](docker å®‰è£… redis/image-20230411163752381.png)\n\nç„¶åæ‰§è¡Œ`docker exec -it mars1 /bin/bash`å‘½ä»¤ï¼ŒredisæˆåŠŸè¿è¡Œ\n\n![image-20230411180817939](docker å®‰è£… redis/image-20230411180817939-1711202816360-2.png)","tags":["redis","docker"],"categories":["å®¹å™¨åŒ–","docker"]},{"title":"Docker Swarmé›†ç¾¤éƒ¨ç½²","url":"/yyg/71468332/","content":"**ä»»åŠ¡å¹³å°**\n\n3å°è™šæ‹Ÿæœºï¼Œä¸€å°ä½œä¸ºmanager èŠ‚ç‚¹ï¼Œå¦ä¸¤å°ä½œä¸ºworkèŠ‚ç‚¹ã€‚\n\n**éƒ¨ç½²æŒ‡å—**\n\n[TOC]\n\n### å®‰è£…docker\n\n```shell\n#ä¸‹è½½å¹¶å®‰è£…dockeræ–‡ä»¶åŠä¾èµ–\nyum install -y yum-utils\nyum-config-manager --add-repo https://download.docker.com/linux/centos/docker-ce.repo\nyum install -y docker-ce docker-ce-cli containerd.io\n#å¯åŠ¨dockerå¹¶è®¾ç½®å¼€æœºè‡ªå¯\nsystemctl start docker  \nsystemctl enable docker\n#æŸ¥çœ‹ç‰ˆæœ¬\ndocker -v\n```\n\n### é…ç½®é˜²ç«å¢™å¼€æ”¾ç«¯å£\n\nTCPåè®®ç«¯å£ 2377 ï¼šé›†ç¾¤ç®¡ç†ç«¯å£\nTCPåè®®ç«¯å£ 7946 ï¼šèŠ‚ç‚¹ä¹‹é—´é€šè®¯ç«¯å£ï¼ˆä¸å¼€æ”¾åˆ™ä¼šè´Ÿè½½å‡è¡¡å¤±æ•ˆï¼‰\nUDPåè®®ç«¯å£ 4789 ï¼šoverlayç½‘ç»œé€šè®¯ç«¯å£\n\n```shell\nfirewall-cmd --zone=public --add-port=2377/tcp --permanent\nfirewall-cmd --zone=public --add-port=7946/tcp --permanent\nfirewall-cmd --zone=public --add-port=7946/udp --permanent\nfirewall-cmd --zone=public --add-port=4789/tcp --permanent\n#é‡è½½é˜²ç«å¢™\nfirewall-cmd --reload\n#æŸ¥çœ‹80ç«¯å£æ˜¯å¦å¼€æ”¾\nfirewall-cmd --query-port=80/tcp\n#æŸ¥çœ‹æ‰€æœ‰æ”¾è¡Œçš„ç«¯å£\nfirewall-cmd --zone=public --list-ports\n```\n\n### åœ¨ manager èŠ‚ç‚¹åˆ›å»º Swarm é›†ç¾¤\n\n```Shell\ndocker swarm init --advertise-addr=æœ¬æœºip:2377 --listen-addr=æœ¬æœºip:2377\n```\n\n> Swarm initialized: current node (608u180nsa654xbxdthdhl0f6) is now a manager.\n>\n> To add a worker to this swarm, run the following command:\n>\n> â€‹    `docker swarm join --token SWMTKN-1-13dv43qm3tdux7243z3c0najcetizjpgly1urd4uchtcooxe87-4eh15dbayxttxipm34s5tod6t 172.20.1.51:2377`\n>\n> To add a manager to this swarm, run 'docker swarm join-token manager' and follow the instructions.\n\nå°†æ‰§è¡Œåäº§ç”Ÿçš„å‘½ä»¤ï¼ˆå¦‚ä¸Šæ ‡çº¢çš„ï¼‰ï¼Œåˆ†åˆ«åŠ å…¥åˆ°å…¶ä»–ä¸»æœºä¸­ï¼Œæ‰§è¡Œåäº§ç”Ÿå¦‚ä¸‹ç»“æœã€‚å³ä¸ºæˆåŠŸåŠ å…¥ã€‚\n\næˆ–è€…æ‰§è¡Œä¸‹é¢å‘½ä»¤äº§ç”Ÿä»¤ç‰Œï¼Œå¹¶ä¸”æ˜¯å®šæœŸè½®æ¢è®¡åˆ’ï¼ˆæ¨èï¼‰\n\n```Shell\ndocker swarm join-token  --rotate worker\n```\n\n> This node joined a swarm as a worker.\n\nï¼ˆæ‰©å±•ï¼‰åŠ å…¥ç®¡ç†èŠ‚ç‚¹çš„å‘½ä»¤\n\n```Shell\ndocker swarm join-token --rotate manager\n```\n\nåœ¨managerèŠ‚ç‚¹ä¸Šè¾“å…¥`docker node ls` å¯æŸ¥çœ‹æ‰€æœ‰èŠ‚ç‚¹ã€‚\n\n![image-20240323221029238](Docker Swarmé›†ç¾¤éƒ¨ç½²/image-20240323221029238-1711203035847-1.png)\n\n### åˆ›å»ºç”¨äºswarmæœåŠ¡çš„è‡ªå®šä¹‰çš„overlayç½‘ç»œ\n\n```Shell\n#æ–¹å¼ä¸€\n#--attachableé€‰é¡¹è¡¨ç¤ºè¯¥ç½‘ç»œæ˜¯å¯é™„åŠ çš„ï¼Œå³å…¶ä»–å®¹å™¨å¯ä»¥è¿æ¥åˆ°è¯¥ç½‘ç»œ  \ndocker network create -d overlay --attachable my-overlay\n\n#æ–¹å¼äºŒ\n# --subnet:å­ç½‘ --gateway:ç½‘å…³\ndocker network create --driver overlay --subnet 10.0.9.0/24 --gateway 10.0.9.99 my-overlay\n  \n #æŸ¥çœ‹dockerç½‘ç»œ\n docker network ls\n```\n\n### æµ‹è¯•è·¨ä¸»æœºå®¹å™¨é€šä¿¡\n\n1. åœ¨ä¸‰å°ä¸»æœºä¸Šå„éƒ¨ç½²ä¸€ä¸ªå®¹å™¨ï¼Œè¿›è¡Œç›¸äº’pingï¼Œç»“æœå¦‚ä¸‹å›¾ã€‚\n\n```Shell\n#ä¸»æœºä¸€\ndocker run -it --name master --net=my-overlay ubuntu:latest\n#ä¸»æœºäºŒ\ndocker run -it --name node1 --net=my-overlay ubuntu:latest\n#ä¸»æœºä¸‰\ndocker run -it --name node2 --net=my-overlay ubuntu:latest\n```\n\n2. å®‰è£…æµ‹è¯•å·¥å…·\n\n```Shell\napt-get update\n#å®‰è£…pingå·¥å…·\napt-get install inetutils-ping -y\n#å®‰è£…ipæŸ¥çœ‹å·¥å…·\napt-get install net-tools -y\n```\n\n![image-20240323221151231](Docker Swarmé›†ç¾¤éƒ¨ç½²/image-20240323221151231-1711203113839-3.png)\n","tags":["docker","docker Swarm"],"categories":["å®¹å™¨åŒ–","docker"]},{"title":"å®ç°Docker å®¹å™¨è·¨ä¸»æœºé€šè®¯","url":"/yyg/60ed202a/","content":"\n[TOC]\n\n### æ–¹æ¡ˆä¸€ï¼šdocker swarmé›†ç¾¤\n\nhttps://blog.csdn.net/AMCUL/article/details/132913280\n\n### æ–¹æ¡ˆäºŒï¼šç›´æ¥è·¯ç”±æ³•\n\nåœ¨éƒ¨ç½²æŒ‡å—ä¸­æåˆ°çš„æ–¹æ³•çš„å®ç°åˆ†å›ºå®šç½‘æ®µã€è·¯ç”±æŒä¹…åŒ–ã€IPè½¬å‘ä¸‰éƒ¨åˆ†ç»„æˆã€‚\n\n#### æ–¹æ³•1ï¼š\n\n##### ä¿®æ”¹å¹¶å›ºå®šdocker0çš„é»˜è®¤ç½‘æ®µ\n\n1. ä¿®æ”¹docker0ç½‘æ®µipï¼Œåœ¨ä¸»æœºçš„/etc/docker/daemon.jsonæ–‡ä»¶ä¸­ï¼ŒåŠ å…¥å¦‚ä¸‹å†…å®¹ï¼š\n\n```Shell\n#æ‰“å¼€daemon.jsonæ–‡ä»¶\nvi /etc/docker/daemon.json\n\n#ä¸»æœºä¸€ä¸­æ·»åŠ çš„å†…å®¹\n#172.16.200.1 ä¸ºä¸»æœºä¸€çš„dockerç½‘æ®µip\n{\n \"bip\": \"172.16.200.1/24\"\n}\n\n#ä¸»æœºäºŒä¸­æ·»åŠ çš„å†…å®¹\n#172.16.210.1 ä¸ºä¸»æœºäºŒçš„dockerç½‘æ®µip\n{\n \"bip\": \"172.16.210.1/24\"\n}\n\n#é‡å¯dockeræœåŠ¡\nsystemctl restart docker \n```\n\n1.  æ·»åŠ è·¯ç”±è§„åˆ™ï¼Œä¸»æœºé—´äº’ç›¸æ·»åŠ \n\n```Shell\n#ä¸»æœº1ä¸Šæ·»åŠ è·¯ç”±è§„åˆ™ï¼ˆæ·»åŠ ä¸»æœº2çš„ipå’Œç½‘æ®µï¼‰\nip route add 172.16.210.0/24 via 172.20.1.52\n\n#ä¸»æœº2ä¸Šæ·»åŠ è·¯ç”±è§„åˆ™ï¼ˆæ·»åŠ ä¸»æœº1çš„ipå’Œç½‘æ®µï¼‰\nip route add 172.16.200.0/24 via 172.20.1.51\n\n#æ–¹å¼ä¸€ï¼š\n#å¼€å¯è·¯ç”±è½¬å‘\niptables -P FORWARD ACCEPT\n\n#æ–¹å¼äºŒï¼š\n#é…ç½®iptablesè§„åˆ™ï¼ˆæœ¬æœºçš„ç½‘æ®µï¼‰\n#ä¸»æœºä¸€\niptables -t nat -F POSTROUTING\niptables -t nat -A POSTROUTING -s 172.16.200.0/24 ! -d 172.16.0.0/16 -j MASQUERADE\n\n#ä¸»æœºäºŒ\niptables -t nat -F POSTROUTING\niptables -t nat -A POSTROUTING -s 172.16.210.0/24 ! -d 172.16.0.0/16 -j MASQUERADE\n```\n\n1. å¯åŠ¨å®¹å™¨å¹¶æµ‹è¯•\n\n```Shell\n# ä¸»æœº1ä¸Šå¯åŠ¨ubuntuå®¹å™¨\ndocker run -it --name node1 ubuntu:latest /bin/bash\n\n# ä¸»æœº2ä¸Šå¯åŠ¨ubuntuå®¹å™¨\ndocker run -it --name node2 ubuntu:latest /bin/bash\n\n#å®‰è£…æµ‹è¯•å·¥å…·\napt-get update\n#å®‰è£…pingå·¥å…·\napt-get install inetutils-ping -y\n#å®‰è£…ipæŸ¥çœ‹å·¥å…·\napt-get install net-tools -y\n```\n\n##### è·¯ç”±æŒä¹…åŒ–ï¼ˆé˜²æ­¢ä¸»æœºé‡å¯è·¯ç”±ä¸¢å¤±ï¼‰\n\n###### æ³•ä¸€ï¼šï¼ˆæ¨èï¼‰\n\nåœ¨`/etc/sysconfig/network-scripts/`ç›®å½•ä¸‹åˆ›å»ºåä¸º`route-enp0s3`(enp0s3ä¸ºä¸»æœºç½‘å¡çš„åå­—ï¼Œä»¥å®é™…ä¸ºå‡†)çš„æ–‡ä»¶ \n\næ¨èæ­¤æ–¹æ³•ï¼Œæ³¨æ„åˆ›å»ºæ—¶`route-`åè·Ÿçš„æ˜¯æœ¬æœºä¸»æœºçš„ç½‘å¡å\n\n```Shell\nvi /etc/sysconfig/network-scripts/route-enp0s3\n\n#åœ¨æ­¤æ–‡ä»¶æ·»åŠ å¦‚ä¸‹æ ¼å¼çš„å†…å®¹\n#ä¸»æœºä¸€ä¸­æ·»åŠ \n172.16.230.0/24 via 172.20.1.52\n#ä¸»æœºäºŒä¸­æ·»åŠ \n172.16.220.0/24 via 172.20.1.51\n\n#é‡å¯ç½‘ç»œéªŒè¯\nservice network restart\n\n\n#æŸ¥çœ‹è·¯ç”±è¡¨ä¸­æ˜¯å¦æœ‰åˆšæ‰æ·»åŠ çš„è·¯ç”±\nip route show | column -t\n```\n\n###### æ³•äºŒï¼š\n\nåœ¨`/etc/sysconfig/static-routes` æ–‡ä»¶é‡Œæ·»åŠ å¦‚ä¸‹å†…å®¹ (æ²¡æœ‰static-routeséœ€æ‰‹åŠ¨å»ºç«‹)\n\n```Shell\n#ä¸»æœºä¸€ä¸­æ·»åŠ \nany net 172.16.230.0/24 via 172.20.1.52\n#ä¸»æœºäºŒä¸­æ·»åŠ \nany net 172.16.220.0/24 via 172.20.1.51\n\n#é‡å¯ç½‘ç»œæœåŠ¡\nsystemctl restart network\n\n#æŸ¥çœ‹è·¯ç”±è¡¨ä¸­æ˜¯å¦æœ‰åˆšæ‰æ·»åŠ çš„è·¯ç”±\nip route show | column -t\n```\n\n##### å¼€å¯IPè½¬å‘\n\n```Shell\n#æ°¸ä¹…å¼€å¯\nvi /etc/sysctl.conf\n#ä¿®æ”¹\nnet.ipv4.ip_forward=1\n```\n\n#### æ–¹æ³•2ï¼šï¼ˆé€‚ç”¨äºä½¿ç”¨å›ºå®šipçš„å®¹å™¨ï¼‰\n\n##### åˆ›å»ºdockerç½‘ç»œ\n\n1. dockeræ¡¥æ¥ç±»å‹ç½‘ç»œåˆ›å»º\n\nåˆ†åˆ«å¯¹ä¸¤å°æœåŠ¡å™¨ä¸­çš„dockeråˆ›å»ºåå­—ä¸ºtestçš„ç½‘ç»œï¼ŒæŒ‡å®šå­ç½‘èŒƒå›´ä¸º 172.16.220.0/24 ã€172.16.230.0/24\n\n```Shell\n#ä¸»æœºä¸€\ndocker network create test --driver bridge --ipam-driver default --subnet 172.16.220.0/24\n\n#ä¸»æœºäºŒ\ndocker network create test --driver bridge --ipam-driver default --subnet 172.16.230.0/24\n#æŸ¥çœ‹ç½‘ç»œ\ndocker network ls\n```\n\n1. è®¾ç½®é™æ€è·¯ç”±\n\n```Shell\n#ä¸»æœº1ä¸Šæ·»åŠ è·¯ç”±è§„åˆ™ï¼ˆæ·»åŠ ä¸»æœº2çš„ipå’Œç½‘æ®µï¼‰\nip route add 172.16.230.0/24 via 172.20.1.52\n\n#ä¸»æœº2ä¸Šæ·»åŠ è·¯ç”±è§„åˆ™ï¼ˆæ·»åŠ ä¸»æœº1çš„ipå’Œç½‘æ®µï¼‰\nip route add 172.16.220.0/24 via 172.20.1.51\n\n#å¼€å¯è·¯ç”±è½¬å‘\niptables -P FORWARD ACCEPT\n```\n\n1. å¯åŠ¨å®¹å™¨å¹¶æµ‹è¯•\n\n```Shell\n# ä¸»æœº1ä¸Šå¯åŠ¨ubuntuå®¹å™¨(åŠ ä¸Šåˆ›å»ºçš„æ¡¥æ¥ç½‘ç»œ)\ndocker run -it --name node1 --net=test ubuntu:latest /bin/bash\n\n# ä¸»æœº2ä¸Šå¯åŠ¨ubuntuå®¹å™¨(åŠ ä¸Šåˆ›å»ºçš„æ¡¥æ¥ç½‘ç»œ)\ndocker run -it --name node2 --net=test ubuntu:latest /bin/bash\n\n#å®‰è£…æµ‹è¯•å·¥å…·\napt-get update\n#å®‰è£…pingå·¥å…·\napt-get install inetutils-ping -y\n#å®‰è£…ipæŸ¥çœ‹å·¥å…·\napt-get install net-tools -y\n```\n\n##### è·¯ç”±æŒä¹…åŒ–ï¼ˆé˜²æ­¢ä¸»æœºé‡å¯è·¯ç”±ä¸¢å¤±ï¼‰\n\nä½¿ç”¨**nmtuiå›¾å½¢åŒ–ç•Œé¢æ·»åŠ **\n\n```Shell\n #ä¸‹è½½nmtui\n yum install net-tools -y\n #æ˜¾ç¤ºnmtuiå›¾å½¢åŒ–ç•Œé¢\n nmtui\n```\n\nåœ¨ä¸»æœºä¸€ç½‘å¡ä¸­é…ç½®ä¸»æœºäºŒçš„dockerç½‘ç»œçš„ipæ®µå’Œipï¼Œåœ¨ä¸»æœºäºŒç½‘å¡ä¸­é…ç½®ä¸»æœºä¸€çš„dockerç½‘ç»œçš„ipæ®µå’Œip\n\n```Shell\n#ä¸»æœºä¸€ä¸­æ·»åŠ \n172.16.230.0/24  172.20.1.52\n#ä¸»æœºäºŒä¸­æ·»åŠ \n172.16.220.0/24  172.20.1.51\n```\n\né…ç½®å®Œæˆä¼šåœ¨/etc/sysconfig/network-scriptsæ–‡ä»¶å¤¹ä¸‹çœ‹åˆ°\n\n![image-20240323221412716](å®ç°Docker å®¹å™¨è·¨ä¸»æœºé€šè®¯/image-20240323221412716-1711203257505-1.png)\n\n![image-20240323221442754](å®ç°Docker å®¹å™¨è·¨ä¸»æœºé€šè®¯/image-20240323221442754-1711203286475-3.png)\n\nå¯åŠ¨å¯¹åº”ä¸»æœºçš„æ–°åˆ›å»ºçš„ç½‘å¡ï¼ˆç½‘ç»œé‡å¯æˆ–ç³»ç»Ÿé‡å¯åä¼šå¤±æ•ˆï¼‰\n\n```Shell\n#ä¸»æœºä¸€\nnmcli c up br-aed92de88760\n#ä¸»æœºäºŒ\nnmcli c up br-0ab3914edle2\n```\n\nè¦ä½¿æ–°ç½‘å¡ä¿æŒå¯åŠ¨åˆ™éœ€å°†å¯¹åº”æ–°åˆ›å»ºçš„ç½‘å¡æ–‡ä»¶ä¸­çš„`ONBOOT=no`æ”¹ä¸º`ONBOOT=yes`\n\n```Shell\n#ä¸»æœºä¸€\nvi ifcfg-br-aed92de88760\n#ONBOOT=noæ”¹ä¸ºONBOOT=yes\nONBOOT=yes\n#ä¸»æœºäºŒ\nvi ifcfg-br-0ab3914edle2\n#ONBOOT=noæ”¹ä¸ºONBOOT=yes\nONBOOT=yes\n\n#é‡å¯ç½‘ç»œæœåŠ¡\nsystemctl restart network\n```\n\n![image-20240323221537519](å®ç°Docker å®¹å™¨è·¨ä¸»æœºé€šè®¯/image-20240323221537519-1711203339288-5.png)\n\n##### å¼€å¯IPè½¬å‘\n\n```Shell\n#æ°¸ä¹…å¼€å¯\nvi /etc/sysctl.conf\n#ä¿®æ”¹\nnet.ipv4.ip_forward=1\n```\n\næ­¤æ—¶å®¹å™¨ä¸å—ç½‘ç»œé‡å¯å½±å“ï¼Œå¯å®ç°è·¨ä¸»æœºé€šè®¯ã€‚\n\nä½†ç³»ç»Ÿé‡å¯åï¼Œæ‰€åˆ›å»ºçš„dockerç½‘ç»œå’Œå®¹å™¨å‡å¤±æ•ˆã€‚\n\néœ€è¦é‡æ–°åˆ›å»ºdockerç½‘ç»œå’Œå®¹å™¨ï¼Œæ­¤ådockerç½‘ç»œå’Œå®¹å™¨å‡ä¸å—ç³»ç»Ÿé‡å¯å’Œç½‘ç»œé‡å¯çš„å½±å“ï¼ŒæˆåŠŸå®ç°dockerå®¹å™¨çš„è·¨ä¸»æœºé€šè®¯ã€‚\n\n![image-20240323221547069](å®ç°Docker å®¹å™¨è·¨ä¸»æœºé€šè®¯/image-20240323221547069-1711203348713-7.png)","tags":["å®¹å™¨é€šä¿¡","docker"],"categories":["å®¹å™¨åŒ–","docker","æ¢³ç†æ€»ç»“"]}]