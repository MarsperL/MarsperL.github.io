<!DOCTYPE html><html lang="zh-CN" data-theme="dark"><head><script>(()=>{const e=navigator.serviceWorker;e?e.register("/sw.js").then(async e=>{console.log("SWPP 注册成功");try{await e.periodicSync.register("update",{minInterval:864e5})}catch(e){console.log("Periodic Sync 注册失败",e)}}).catch(e=>console.error("SWPP 注册失败",e)):console.warn("当前浏览器不支持 SW")})()</script><meta charset="UTF-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="viewport" content="width=device-width,initial-scale=1,viewport-fit=cover"><title>Jenkins知识梳理 | 云野阁</title><meta name="author" content="云野阁"><meta name="copyright" content="云野阁"><meta name="format-detection" content="telephone=no"><meta name="theme-color" content="#0d0d0d"><meta name="description" content="🔜什么是Jenkins？🔚                               Jenkins是一款基于Java开发的开源 CI&amp;CD 软件，用于自动化各种任务，包括构建、测试和部署软件。Jenkins提供多种安装方式，提供超过1000个插件来满足任何项目的需要。Jenkins的特征：开源的Java语言开发持续集成工具，支持持续集成，持续部署。易于安装部署配置：可通过yum安"><meta property="og:type" content="article"><meta property="og:title" content="Jenkins知识梳理"><meta property="og:url" content="https://yyg.js.cool/yyg/f0979e05/index.html"><meta property="og:site_name" content="云野阁"><meta property="og:description" content="🔜什么是Jenkins？🔚                               Jenkins是一款基于Java开发的开源 CI&amp;CD 软件，用于自动化各种任务，包括构建、测试和部署软件。Jenkins提供多种安装方式，提供超过1000个插件来满足任何项目的需要。Jenkins的特征：开源的Java语言开发持续集成工具，支持持续集成，持续部署。易于安装部署配置：可通过yum安"><meta property="og:locale" content="zh_CN"><meta property="og:image" content="https://picapi.pai.al/api/scenery.php"><meta property="article:published_time" content="2025-05-17T10:47:41.000Z"><meta property="article:modified_time" content="2025-05-17T10:49:27.000Z"><meta property="article:author" content="云野阁"><meta property="article:tag" content="知识梳理"><meta property="article:tag" content="CI&#x2F;CD"><meta property="article:tag" content="自动化运维"><meta property="article:tag" content="GitLab"><meta property="article:tag" content="Jenkins"><meta property="article:tag" content="Linux运维"><meta property="article:tag" content="SonarQube"><meta name="twitter:card" content="summary"><meta name="twitter:image" content="https://picapi.pai.al/api/scenery.php"><script type="application/ld+json">{
  "@context": "https://schema.org",
  "@type": "BlogPosting",
  "headline": "Jenkins知识梳理",
  "url": "https://yyg.js.cool/yyg/f0979e05/",
  "image": "https://picapi.pai.al/api/scenery.php",
  "datePublished": "2025-05-17T10:47:41.000Z",
  "dateModified": "2025-05-17T10:49:27.000Z",
  "author": [
    {
      "@type": "Person",
      "name": "云野阁",
      "url": "https://yyg.js.cool/"
    }
  ]
}</script><link rel="shortcut icon" href="/img/icon.png"><link rel="canonical" href="https://yyg.js.cool/yyg/f0979e05/index.html"><link rel="preconnect" href="//cdn.jsdelivr.net"><link rel="preconnect" href="//busuanzi.ibruce.info"><link rel="manifest" href="/manifest.json"><link rel="apple-touch-icon" sizes="180x180" href="/img/icon.png"><link rel="icon" type="image/png" sizes="32x32" href="/img/pwa/favicon-32x32.png"><link rel="icon" type="image/png" sizes="16x16" href="/img/pwa/favicon-16x16.png"><link rel="mask-icon" href="/img/pwa/icon.svg" color="#5bbad5"><link rel="stylesheet" href="/css/index.css?v=5.5.1"><link rel="stylesheet" href="https://s4.zstatic.net/npm/@fortawesome/fontawesome-free@6.7.2/css/all.min.css"><link rel="stylesheet" href="https://s4.zstatic.net/ajax/libs/fancyapps-ui/5.0.36/fancybox/fancybox.min.css" media="print" onload='this.media="all"'><script>(()=>{const e={set:(e,t,o)=>{if(!o)return;const a=Date.now()+864e5*o;localStorage.setItem(e,JSON.stringify({value:t,expiry:a}))},get:e=>{const t=localStorage.getItem(e);if(!t)return;const{value:o,expiry:a}=JSON.parse(t);if(!(Date.now()>a))return o;localStorage.removeItem(e)}};window.btf={saveToLocal:e,getScript:(e,t={})=>new Promise((o,a)=>{const n=document.createElement("script");n.src=e,n.async=!0,Object.entries(t).forEach(([e,t])=>n.setAttribute(e,t)),n.onload=n.onreadystatechange=()=>{n.readyState&&!/loaded|complete/.test(n.readyState)||o()},n.onerror=a,document.head.appendChild(n)}),getCSS:(e,t)=>new Promise((o,a)=>{const n=document.createElement("link");n.rel="stylesheet",n.href=e,t&&(n.id=t),n.onload=n.onreadystatechange=()=>{n.readyState&&!/loaded|complete/.test(n.readyState)||o()},n.onerror=a,document.head.appendChild(n)}),addGlobalFn:(e,t,o=!1,a=window)=>{if(e.startsWith("pjax"))return;const n=a.globalFn||{};n[e]=n[e]||{},n[e][o||Object.keys(n[e]).length]=t,a.globalFn=n}};const t=()=>{document.documentElement.setAttribute("data-theme","dark"),null!==document.querySelector('meta[name="theme-color"]')&&document.querySelector('meta[name="theme-color"]').setAttribute("content","#0d0d0d")},o=()=>{document.documentElement.setAttribute("data-theme","light"),null!==document.querySelector('meta[name="theme-color"]')&&document.querySelector('meta[name="theme-color"]').setAttribute("content","#ffffff")};btf.activateDarkMode=t,btf.activateLightMode=o;const a=e.get("theme");"dark"===a?t():"light"===a&&o();const n=e.get("aside-status");void 0!==n&&document.documentElement.classList.toggle("hide-aside","hide"===n);/iPad|iPhone|iPod|Macintosh/.test(navigator.userAgent)&&document.documentElement.classList.add("apple")})()</script><script>const GLOBAL_CONFIG={root:"/",algolia:void 0,localSearch:{path:"/search.json",preload:!1,top_n_per_article:1,unescape:!1,pagination:{enable:!0,hitsPerPage:8},languages:{hits_empty:"未找到符合您查询的内容：${query}",hits_stats:"共找到 ${hits} 篇文章"}},translate:void 0,highlight:{plugin:"highlight.js",highlightCopy:!0,highlightLang:!0,highlightHeightLimit:200,highlightFullpage:!1,highlightMacStyle:!0},copy:{success:"复制成功",error:"复制失败",noSupport:"浏览器不支持"},relativeDate:{homepage:!1,post:!1},runtime:"天",dateSuffix:{just:"刚刚",min:"分钟前",hour:"小时前",day:"天前",month:"个月前"},copyright:void 0,lightbox:"fancybox",Snackbar:void 0,infinitegrid:{js:"https://s4.zstatic.net/ajax/libs/egjs-infinitegrid/4.12.0/infinitegrid.min.js",buttonText:"加载更多"},isPhotoFigcaption:!1,islazyloadPlugin:!0,isAnchor:!1,percent:{toc:!0,rightside:!0},autoDarkmode:!1}</script><script id="config-diff">var GLOBAL_CONFIG_SITE={title:"Jenkins知识梳理",isHighlightShrink:!1,isToc:!0,pageType:"post"}</script><link rel="stylesheet" href="/css/parts.css"><link rel="stylesheet" href="/css/link.css"><script src="https://npm.elemecdn.com/echarts@5.4.3/dist/echarts.min.js"></script><script defer src="https://s4.zstatic.net/ajax/libs/sweetalert2/11.16.1/sweetalert2.all.js"></script><script defer src="/js/lunar.js"></script><script defer src="/js/day.js"></script><script defer src="/sw-dom.js"></script><link rel="stylesheet" href="https://npm.elemecdn.com/hexo-butterfly-swiper/lib/swiper.min.css" media="print" onload='this.media="all"'><link rel="stylesheet" href="https://npm.elemecdn.com/hexo-butterfly-swiper/lib/swiperstyle.css" media="print" onload='this.media="all"'><link rel="stylesheet" href="https://npm.elemecdn.com/hexo-butterfly-tag-plugins-plus@latest/lib/assets/font-awesome-animation.min.css" media="defer" onload='this.media="all"'><link rel="stylesheet" href="https://npm.elemecdn.com/hexo-butterfly-tag-plugins-plus@latest/lib/tag_plugins.css" media="defer" onload='this.media="all"'><script src="https://npm.elemecdn.com/hexo-butterfly-tag-plugins-plus@latest/lib/assets/carousel-touch.js"></script><meta name="generator" content="Hexo 7.3.0"><link rel="alternate" href="/rss2.xml" title="云野阁" type="application/rss+xml"></head><body><div id="sidebar"><div id="menu-mask"></div><div id="sidebar-menus"><div class="avatar-img text-center"><img src="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="/img/icon.png" onerror='this.onerror=null,this.src="/img/friend_404.gif"' alt="avatar"></div><div class="site-data text-center"><a href="/archives/"><div class="headline">文章</div><div class="length-num">62</div></a><a href="/tags/"><div class="headline">标签</div><div class="length-num">109</div></a><a href="/categories/"><div class="headline">分类</div><div class="length-num">37</div></a></div><div class="menus_items"><div class="menus_item"><a class="site-page" href="/"><i class="fa-fw fas fa-home"></i> <span>首页</span></a></div><div class="menus_item"><a class="site-page" href="/docs/"><i class="fa-fw fa-solid fa-book-bookmark"></i> <span>教程手册</span></a></div><div class="menus_item"><span class="site-page group"><i class="fa-fw fa-solid fa-blog"></i> <span>博文</span><i class="fas fa-chevron-down"></i></span><ul class="menus_item_child"><li><a class="site-page child" href="/archives/"><i class="fa-fw fas fa-archive"></i> <span>归档</span></a></li><li><a class="site-page child" href="/tags/"><i class="fa-fw fas fa-tags"></i> <span>标签</span></a></li><li><a class="site-page child" href="/categories/"><i class="fa-fw fas fa-folder-open"></i> <span>分类</span></a></li><li><a class="site-page child" href="javascript:randomPost();"><i class="fa-fw fa-solid fa-shuffle"></i> <span>随机一篇</span></a></li></ul></div><div class="menus_item"><span class="site-page group"><i class="fa-fw fa-brands fa-get-pocket"></i> <span>蓝口袋</span><i class="fas fa-chevron-down"></i></span><ul class="menus_item_child"><li><a class="site-page child" href="/pintree/"><i class="fa-fw fa fa-search-plus"></i> <span>导航</span></a></li><li><a class="site-page child" href="/sand/"><i class="fa-fw fa fa-cube"></i> <span>繁沙</span></a></li><li><a class="site-page child" href="/trip/"><i class="fa-fw fa-solid fa-earth-asia"></i> <span>星游记</span></a></li><li><a class="site-page child" href="/share/"><i class="fa-fw fa-solid fa-star"></i> <span>书•影•音</span></a></li><li><a class="site-page child" href="/focusclock/"><i class="fa-fw fas fa-clock"></i> <span>专注时钟</span></a></li></ul></div><div class="menus_item"><span class="site-page group"><i class="fa-fw fas fa-comments"></i> <span>聊天室</span><i class="fas fa-chevron-down"></i></span><ul class="menus_item_child"><li><a class="site-page child" href="/shuoshuo/"><i class="fa-fw fas fa-comment-dots"></i> <span>说说</span></a></li><li><a class="site-page child" href="/messageboard/"><i class="fa-fw fa fa-paper-plane"></i> <span>心语亭</span></a></li></ul></div><div class="menus_item"><span class="site-page group"><i class="fa-fw fas fa-book-open"></i> <span>文界</span><i class="fas fa-chevron-down"></i></span><ul class="menus_item_child"><li><a class="site-page child" href="/yygrss/"><i class="fa-fw fa-solid fa-square-rss"></i> <span>瀚文集</span></a></li><li><a class="site-page child" href="/fcircle/"><i class="fa-fw fa-solid fa-comment-nodes"></i> <span>友文说</span></a></li></ul></div><div class="menus_item"><span class="site-page group"><i class="fa-fw fa-solid fa-circle-user"></i> <span>更多</span><i class="fas fa-chevron-down"></i></span><ul class="menus_item_child"><li><a class="site-page child" href="/link/"><i class="fa-fw fas fa-link"></i> <span>友链</span></a></li><li><a class="site-page child" href="/about/"><i class="fa-fw fas fa-heart"></i> <span>关于</span></a></li></ul></div></div></div></div><div class="post" id="body-wrap"><header class="post-bg" id="page-header" style="background-image:url(https://picapi.pai.al/api/scenery.php)"><nav id="nav"><span id="blog-info"><a class="nav-site-title" href="/"><img class="site-icon" src="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://gcore.jsdelivr.net/gh/MarsperL/MarsperL.github.io@2.1/img/icon.png" alt="Logo"><span class="site-name">云野阁</span></a><a class="nav-page-title" href="/"><span class="site-name">Jenkins知识梳理</span><span class="site-name"><i class="fa-solid fa-circle-arrow-left"></i> <span>返回首页</span></span></a></span><div id="menus"><div id="search-button"><span class="site-page social-icon search"><i class="fas fa-search fa-fw"></i> <span>搜索</span></span></div><div class="menus_items"><div class="menus_item"><a class="site-page" href="/"><i class="fa-fw fas fa-home"></i> <span>首页</span></a></div><div class="menus_item"><a class="site-page" href="/docs/"><i class="fa-fw fa-solid fa-book-bookmark"></i> <span>教程手册</span></a></div><div class="menus_item"><span class="site-page group"><i class="fa-fw fa-solid fa-blog"></i> <span>博文</span><i class="fas fa-chevron-down"></i></span><ul class="menus_item_child"><li><a class="site-page child" href="/archives/"><i class="fa-fw fas fa-archive"></i> <span>归档</span></a></li><li><a class="site-page child" href="/tags/"><i class="fa-fw fas fa-tags"></i> <span>标签</span></a></li><li><a class="site-page child" href="/categories/"><i class="fa-fw fas fa-folder-open"></i> <span>分类</span></a></li><li><a class="site-page child" href="javascript:randomPost();"><i class="fa-fw fa-solid fa-shuffle"></i> <span>随机一篇</span></a></li></ul></div><div class="menus_item"><span class="site-page group"><i class="fa-fw fa-brands fa-get-pocket"></i> <span>蓝口袋</span><i class="fas fa-chevron-down"></i></span><ul class="menus_item_child"><li><a class="site-page child" href="/pintree/"><i class="fa-fw fa fa-search-plus"></i> <span>导航</span></a></li><li><a class="site-page child" href="/sand/"><i class="fa-fw fa fa-cube"></i> <span>繁沙</span></a></li><li><a class="site-page child" href="/trip/"><i class="fa-fw fa-solid fa-earth-asia"></i> <span>星游记</span></a></li><li><a class="site-page child" href="/share/"><i class="fa-fw fa-solid fa-star"></i> <span>书•影•音</span></a></li><li><a class="site-page child" href="/focusclock/"><i class="fa-fw fas fa-clock"></i> <span>专注时钟</span></a></li></ul></div><div class="menus_item"><span class="site-page group"><i class="fa-fw fas fa-comments"></i> <span>聊天室</span><i class="fas fa-chevron-down"></i></span><ul class="menus_item_child"><li><a class="site-page child" href="/shuoshuo/"><i class="fa-fw fas fa-comment-dots"></i> <span>说说</span></a></li><li><a class="site-page child" href="/messageboard/"><i class="fa-fw fa fa-paper-plane"></i> <span>心语亭</span></a></li></ul></div><div class="menus_item"><span class="site-page group"><i class="fa-fw fas fa-book-open"></i> <span>文界</span><i class="fas fa-chevron-down"></i></span><ul class="menus_item_child"><li><a class="site-page child" href="/yygrss/"><i class="fa-fw fa-solid fa-square-rss"></i> <span>瀚文集</span></a></li><li><a class="site-page child" href="/fcircle/"><i class="fa-fw fa-solid fa-comment-nodes"></i> <span>友文说</span></a></li></ul></div><div class="menus_item"><span class="site-page group"><i class="fa-fw fa-solid fa-circle-user"></i> <span>更多</span><i class="fas fa-chevron-down"></i></span><ul class="menus_item_child"><li><a class="site-page child" href="/link/"><i class="fa-fw fas fa-link"></i> <span>友链</span></a></li><li><a class="site-page child" href="/about/"><i class="fa-fw fas fa-heart"></i> <span>关于</span></a></li></ul></div></div><div id="toggle-menu"><span class="site-page"><i class="fas fa-bars fa-fw"></i></span></div></div></nav><div id="post-info"><h1 class="post-title">Jenkins知识梳理</h1><div id="post-meta"><div class="meta-firstline"><span class="post-meta-date"><i class="far fa-calendar-alt fa-fw post-meta-icon"></i><span class="post-meta-label">发表于</span><time class="post-meta-date-created" datetime="2025-05-17T10:47:41.000Z" title="发表于 2025-05-17 18:47:41">2025-05-17</time><span class="post-meta-separator">|</span><i class="fas fa-history fa-fw post-meta-icon"></i><span class="post-meta-label">更新于</span><time class="post-meta-date-updated" datetime="2025-05-17T10:49:27.000Z" title="更新于 2025-05-17 18:49:27">2025-05-17</time></span><span class="post-meta-categories"><span class="post-meta-separator">|</span><i class="fas fa-inbox fa-fw post-meta-icon"></i><a class="post-meta-categories" href="/categories/%E6%A2%B3%E7%90%86%E6%80%BB%E7%BB%93/">梳理总结</a><i class="fas fa-angle-right post-meta-separator"></i><i class="fas fa-inbox fa-fw post-meta-icon"></i><a class="post-meta-categories" href="/categories/%E6%A2%B3%E7%90%86%E6%80%BB%E7%BB%93/%E7%9F%A5%E8%AF%86%E6%A2%B3%E7%90%86/">知识梳理</a><i class="fas fa-angle-right post-meta-separator"></i><i class="fas fa-inbox fa-fw post-meta-icon"></i><a class="post-meta-categories" href="/categories/%E8%87%AA%E5%8A%A8%E5%8C%96%E8%BF%90%E7%BB%B4/">自动化运维</a><i class="fas fa-angle-right post-meta-separator"></i><i class="fas fa-inbox fa-fw post-meta-icon"></i><a class="post-meta-categories" href="/categories/%E8%87%AA%E5%8A%A8%E5%8C%96%E8%BF%90%E7%BB%B4/Jenkins/">Jenkins</a><i class="fas fa-angle-right post-meta-separator"></i><i class="fas fa-inbox fa-fw post-meta-icon"></i><a class="post-meta-categories" href="/categories/%E8%87%AA%E5%8A%A8%E5%8C%96%E8%BF%90%E7%BB%B4/GitLab/">GitLab</a><i class="fas fa-angle-right post-meta-separator"></i><i class="fas fa-inbox fa-fw post-meta-icon"></i><a class="post-meta-categories" href="/categories/%E8%87%AA%E5%8A%A8%E5%8C%96%E8%BF%90%E7%BB%B4/SonarQube/">SonarQube</a></span></div><div class="meta-secondline"><span class="post-meta-separator">|</span><span class="post-meta-wordcount"><i class="far fa-file-word fa-fw post-meta-icon"></i><span class="post-meta-label">总字数:</span><span class="word-count">9k</span><span class="post-meta-separator">|</span><i class="far fa-clock fa-fw post-meta-icon"></i><span class="post-meta-label">阅读时长:</span><span>39分钟</span></span><span class="post-meta-separator">|</span><span class="post-meta-pv-cv" data-flag-title=""><i class="far fa-eye fa-fw post-meta-icon"></i><span class="post-meta-label">浏览量:</span><span id="busuanzi_value_page_pv"><i class="fa-solid fa-spinner fa-spin"></i></span></span></div></div></div><section class="main-hero-waves-area waves-area"><svg class="waves-svg" xmlns="http://www.w3.org/2000/svg" xlink="http://www.w3.org/1999/xlink" viewBox="0 24 150 28" preserveAspectRatio="none" shape-rendering="auto"><defs><path id="gentle-wave" d="M-160 44c30 0 58-18 88-18s58 18 88 18 58-18 88-18 58 18 88 18v44h-352Z"></path></defs><g class="parallax"><use href="#gentle-wave" x="48" y="0"></use><use href="#gentle-wave" x="48" y="3"></use><use href="#gentle-wave" x="48" y="5"></use><use href="#gentle-wave" x="48" y="7"></use></g></svg></section></header><main class="layout" id="content-inner"><div id="post"><article class="container post-content" id="article-container"><details class="folding-tag" cyan><summary>🔜什么是Jenkins？🔚</summary><div class="content"><p>Jenkins是一款基于Java开发的开源 CI&amp;CD 软件，用于自动化各种任务，包括构建、测试和部署软件。Jenkins提供多种安装方式，提供超过1000个插件来满足任何项目的需要。</p><p>Jenkins的特征：</p><ul><li>开源的Java语言开发持续集成工具，支持持续集成，持续部署。</li><li>易于安装部署配置：可通过yum安装，或下载war包以及通过docker容器等快速实现安装部署，可方便web界面配置管理。</li><li>消息通知及测试报告：集成RSS/E-mail通过RSS发布构建结果或当构建完成时通过e-mail通知，生成JUnit/TestNG测试报告。</li><li>分布式构建：支持制Jenkins能够让多台计算机一起构建/测试。</li><li>文件识别：Jenkins能够跟踪哪次构建生成哪些jar,哪次构建使用哪个版本的jar等。</li><li>丰富的插件支持：支持扩展插件，你可以开发适合自己团队使用的工具，如git,svn,maven,docker等。</li></ul></div></details><blockquote><p>本文通过GitLab+Jenkins+Tomcat，构建CI/CD流程。</p></blockquote><h2 id="主机规划"><a href="#主机规划" class="headerlink" title="主机规划"></a>主机规划</h2><div class="table-container"><table><thead><tr><th>主机名</th><th>ip</th><th>所需软件</th><th>用途</th></tr></thead><tbody><tr><td>121</td><td>192.168.1.121</td><td>GitLab-12.4.2</td><td>代码托管</td></tr><tr><td>124</td><td>192.168.1.124</td><td>Jenkins、JDK-21、Maven-3.9.9、<br>Git、SonarQube</td><td>Jenkins持续集成</td></tr><tr><td>125</td><td>192.168.1.125</td><td>JDK-1.8、Tomcat-8.5</td><td>发布测试</td></tr></tbody></table></div><blockquote><p>服务器操作系统为centos7.9</p></blockquote><h2 id="部署步骤"><a href="#部署步骤" class="headerlink" title="部署步骤"></a>部署步骤</h2><h3 id="部署GitLab"><a href="#部署GitLab" class="headerlink" title="部署GitLab"></a>部署GitLab</h3><h4 id="安装GitLab"><a href="#安装GitLab" class="headerlink" title="安装GitLab"></a>安装GitLab</h4><p>安装依赖</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">yum -y install policycoreutils-python policycoreutils postfix</span><br></pre></td></tr></table></figure><p>下载并安装gitlab</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta prompt_">#</span><span class="language-bash">下载gitlab安装包</span></span><br><span class="line">curl -O  http://mirrors.tuna.tsinghua.edu.cn/gitlab-ce/yum/el7/gitlab-ce-12.4.2-ce.0.el7.x86_64.rpm</span><br><span class="line"><span class="meta prompt_">#</span><span class="language-bash">安装gitlab</span></span><br><span class="line">rpm -i gitlab-ce-12.4.2-ce.0.el7.x86_64.rpm</span><br></pre></td></tr></table></figure><p>修改gitlab默认访问端口</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">vi /etc/gitlab/gitlab.rb</span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_">#</span><span class="language-bash">将默认端口80修改为82</span></span><br><span class="line">external_url &quot;http://192.168.1.121:82&quot;</span><br><span class="line">nginx[&#x27;listen_port&#x27;] = 82</span><br></pre></td></tr></table></figure><p>重载配置，启动gitlab</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">gitlab-ctl reconfigure</span><br><span class="line">gitlab-ctl restart</span><br></pre></td></tr></table></figure><p>配置防火墙策略</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">firewall-cmd --add-port=82/tcp --permanent</span><br><span class="line">firewall-cmd --reload</span><br><span class="line">firewall-cmd --list-all</span><br></pre></td></tr></table></figure><blockquote><p>在浏览器中输入<a target="_blank" rel="noopener" href="http://192.168.1.121:82/,修改root用户密码，并用root用户登录gitlab">http://192.168.1.121:82/,修改root用户密码，并用root用户登录gitlab</a></p></blockquote><h4 id="管理GitLab"><a href="#管理GitLab" class="headerlink" title="管理GitLab"></a>管理GitLab</h4><p>（1）创建组</p><p>使用管理员root创建组，一个组里面可以有多个项目分支，可以将开发添加到组里面进行设置权限，不同的组就是公司不同的开发项目或者服务模块，不同的组添加不同的开发即可实现对开发设置权限的管理。</p><p>（2）创建项目</p><p>（3）创建用户</p><p>在管理中心-概览-用户中，创建一个新用户<code>test1</code>，并设置密码，将用户加入刚创建的项目中。</p><blockquote><p>Gitlab用户在组里面有5种不同权限：</p><ul><li>Guest：可以创建issue、发表评论，不能读写版本库</li><li>Reporter：可以克隆代码，不能提交，QA、PM可以赋予这个权限</li><li>Developer：可以克隆代码、开发、提交、push,普通开发可以赋予这个权限</li><li>Maintainer：可以创建项目、添加tag、保护分支、添加项目成员、编辑项目，核心开发可以赋予这个权限</li><li>Owner：可以设置项目访问权限Visibility Level、删除项目、迁移项目、管理组成员，卉发组组长可以赋予这个权限</li></ul></blockquote><h4 id="上传项目代码"><a href="#上传项目代码" class="headerlink" title="上传项目代码"></a>上传项目代码</h4><blockquote><p>使用idea创建java项目，并上传至gitlab仓库</p><p>本文中使用的java项目代码，源自b站up主，’’涣沷a靑惷’’，原文链接为： <a target="_blank" rel="noopener" href="https://www.yuque.com/huanfqc/jenkins/jenkins。">https://www.yuque.com/huanfqc/jenkins/jenkins。</a></p><p>java代码地址为： <a target="_blank" rel="noopener" href="https://share.feijipan.com/s/qdEO7czl">https://share.feijipan.com/s/qdEO7czl</a></p></blockquote><p>将项目导入idea中，并配置gitlab相关设置，推送代码，具体步骤参考上面提到的原文链接。</p><h3 id="部署Jenkins"><a href="#部署Jenkins" class="headerlink" title="部署Jenkins"></a>部署Jenkins</h3><blockquote><p>安装jenkins-2.19*版本时，无法正常安装中文插件。本文使用的jdk为jdk-21、jenkins为2.492.3，且均为rpm方式安装</p></blockquote><p>（1）安装jdk</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">yum install -y wget &amp;&amp; wget https://download.oracle.com/java/21/latest/jdk-21_linux-x64_bin.rpm</span><br><span class="line">rpm -ivh jdk-21_linux-x64_bin.rpm</span><br><span class="line"><span class="meta prompt_">#</span><span class="language-bash">查看版本</span></span><br><span class="line">java -version</span><br></pre></td></tr></table></figure><p>（2）安装Jenkins</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta prompt_">#</span><span class="language-bash">下载jenkins</span></span><br><span class="line">curl -O https://mirrors.tuna.tsinghua.edu.cn/jenkins/redhat-stable/jenkins-2.492.3-1.1.noarch.rpm</span><br><span class="line"><span class="meta prompt_">#</span><span class="language-bash">安装</span></span><br><span class="line">rpm -ivh jenkins-2.492.3-1.1.noarch.rpm</span><br></pre></td></tr></table></figure><p>（3）修改jenkins的配置文件</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">vi /etc/sysconfig/jenkins</span><br><span class="line"><span class="meta prompt_">#</span><span class="language-bash">修改默认用户为root</span></span><br><span class="line">JENKINS_USER=&quot;root&quot;</span><br><span class="line"><span class="meta prompt_">#</span><span class="language-bash">修改默认端口为8888</span></span><br><span class="line">JENKINS_PORT=8888</span><br></pre></td></tr></table></figure><p>（4）配置防火墙策略，并启动jenkins</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">firewall-cmd --add-port=8888/tcp --permanent</span><br><span class="line">firewall-cmd --reload</span><br><span class="line">firewall-cmd --list-all</span><br><span class="line"><span class="meta prompt_">#</span><span class="language-bash">启动jenkins</span></span><br><span class="line">systemctl daemon-reload</span><br><span class="line">systemctl start jenkins</span><br><span class="line">systemctl enable jenkins</span><br></pre></td></tr></table></figure><p>（5）查看jenkins的admin初始化密码</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">cat /var/lib/jenkins/secrets/initialAdminPassword</span><br></pre></td></tr></table></figure><p>（6）在浏览器中输入<a target="_blank" rel="noopener" href="http://192.168.1.124:8888/访问，输入admin初始化密码。">http://192.168.1.124:8888/访问，输入admin初始化密码。</a></p><p>（7）点击<code>选择插件来安装</code>，选择<code>无</code>，跳过安装插件，为之后重新配置下载插件的国内源做准备。</p><img src="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="/yyg/f0979e05/1.png" title="img"><p>（8）按引导完成jenkins的安装。</p><h4 id="配置国内插件源"><a href="#配置国内插件源" class="headerlink" title="配置国内插件源"></a>配置国内插件源</h4><p>（1）选择左侧边栏中的Jenkins -Manage Jenkins-Manage Plugins，选择Available，等待插件相关文件的加载。</p><p>（2）进入插件的目录，将地址修改为国内源</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">cd /var/lib/jenkins/updates &amp;&amp; ll</span><br><span class="line">sed -i &#x27;s|http://updates.jenkins-ci.org/download|https://mirrors.tuna.tsinghua.edu.cn/jenkins|g&#x27; default.json</span><br><span class="line">sed -i &#x27;s|http://www.google.com|https://www.baidu.com|g&#x27; default.json</span><br></pre></td></tr></table></figure><p>（3）访问jenkins，选择左侧边栏中的Jenkins -Manage Jenkins-Manage Plugins，选择Advanced，把Update Site改为<code>https://mirrors.tuna.tsinghua.edu.cn/jenkins/updates/update-center.json</code>（或者<code>https://mirrors.huaweicloud.com/jenkins/updates/update-center.json</code>），保存，在浏览器中输入<code>http://192.168.1.124:8888/restart</code>，点击并重启jenkins。</p><h4 id="设置中文"><a href="#设置中文" class="headerlink" title="设置中文"></a>设置中文</h4><p>安装中文插件，选择左侧边栏中的Jenkins -Manage Jenkins-Manage Plugins，选择Advanced，搜索<code>chinese</code>，勾选插件，并点击下载并重启。</p><h4 id="管理用户权限"><a href="#管理用户权限" class="headerlink" title="管理用户权限"></a>管理用户权限</h4><p>安装<code>Role-based Authorization Strategy</code>插件，管理用户权限。安装完成后，（新版jenkins）选择Manage Jenkins-Security，授权策略选择Role-Based Strategy。选择Manage Jenkins-Manage and Assign Roles，进行角色的创建和分配管理。</p><h4 id="凭证管理"><a href="#凭证管理" class="headerlink" title="凭证管理"></a>凭证管理</h4><p>（1）安装<code>Credentials Binding</code>插件，进行凭证管理。</p><p>凭证类型：</p><ul><li>Username with password：用户名和密码</li><li>SSH Username with private key：使用ssH用户和密钥</li><li>Secret file：需要保密的文本文件，使用时Jenkins会将文件复制到一个临时目录中，再将文件路径设置到一个变量中，等构建结束后，所复制的Secret file就会被删除。</li><li>Secret text：需要保存的一个加密的文本串，如钉钉机器人或Github的api token</li><li>Certificate：通过上传证书文件的方式</li></ul><blockquote><p>常用的凭证类型有：Username with password(用户密码)和SSH Username with private key(SSH密钥)</p></blockquote><p>（2）安装<code>git</code>插件，并在服务器上下载git。</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">yum -y install git</span><br></pre></td></tr></table></figure><h5 id="密码凭证"><a href="#密码凭证" class="headerlink" title="密码凭证"></a>密码凭证</h5><p>（1）创建jenkins项目和密码凭证。选择Manage Jenkins-Credentials，点击<code>全局</code>-<code>Add Credentials</code>，添加gitlab用户test1的用户名和密码，创建凭证。</p><img src="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="/yyg/f0979e05/2.png" title="img"><p>（2）创建一个新任务<code>test01</code>，点击配置，设置源码管理为Git，填写gitlab的项目仓库地址（http开头），选择test1的凭证，保存即可。</p><p>（3）进入test01，点击Build Now，等待任务构建完成后，点击控制台输出查看详细信息。</p><img src="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="/yyg/f0979e05/3.png" title="img"> <img src="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="/yyg/f0979e05/4.png" title="img"><h5 id="SSH密钥凭证"><a href="#SSH密钥凭证" class="headerlink" title="SSH密钥凭证"></a>SSH密钥凭证</h5><p>（1）在jenkins服务器中创建SSH密钥。</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">ssh-keygen -t rsa</span><br><span class="line"><span class="meta prompt_">#</span><span class="language-bash">查看公钥内容</span></span><br><span class="line">cat ~/.ssh/id_rsa.pub</span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">测试 SSH 连接</span></span><br><span class="line">ssh -T git@192.168.1.121</span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">查看是否有gitlab主机，确保有该主机，否则使用ssh凭证时会报错</span></span><br><span class="line">cat ~/.ssh/known_hosts</span><br></pre></td></tr></table></figure><p>（2）使用管理员账户登录Gitlab，选择<code>设置</code>-<code>SSH密钥</code>，填入SSH公钥内容，并保存。</p><p>（3）在服务器中使用命令<code>cat ~/.ssh/id_rsa</code>，查看私钥内容。在jenkins中创建SSH密钥凭证，输入用户名root和SSH私钥内容，保存即可。</p><img src="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="/yyg/f0979e05/5.png" title="img"><p>（4）创建一个新任务<code>test02</code>，点击配置，设置源码管理为Git，填写gitlab的项目仓库地址（git开头），选择SSH凭证，保存即可。</p><p>（5）进入test02，点击Build Now，等待任务构建完成后，点击控制台输出查看详细信息。</p><img src="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="/yyg/f0979e05/6.png" title="img"><h3 id="安装Maven"><a href="#安装Maven" class="headerlink" title="安装Maven"></a>安装Maven</h3><p>（1）下载安装Maven</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">curl -O https://mirrors.tuna.tsinghua.edu.cn/apache/maven/maven-3/3.9.9/binaries/apache-maven-3.9.9-bin.tar.gz</span><br><span class="line"><span class="meta prompt_">#</span><span class="language-bash">创建存储目录</span></span><br><span class="line">mkdir -p /opt/maven</span><br><span class="line">tar -vxzf apache-maven-3.9.9-bin.tar.gz -C /opt/maven/</span><br><span class="line"><span class="meta prompt_">#</span><span class="language-bash">配置环境变量，使环境生效</span></span><br><span class="line">echo &quot;</span><br><span class="line">export MAVEN_HOME=/opt/maven/apache-maven-3.9.9</span><br><span class="line">export PATH=\$PATH:\$MAVEN_HOME/bin&quot; &gt;&gt; /etc/profile</span><br><span class="line">source /etc/profile</span><br><span class="line"><span class="meta prompt_">#</span><span class="language-bash">查看maven版本</span></span><br><span class="line">mvn -v</span><br></pre></td></tr></table></figure><p>（2）配置jenkins与maven关联</p><p>在Manage Jenkins-Tools中配置<code>JDK安装</code>和<code>Maven安装</code>，配置其对应安装路径。</p><img src="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="/yyg/f0979e05/8.png" title="img"><p>在Manage Jenkins-System-全局属性中，新增3个<code>Environment variables</code>。</p><img src="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="/yyg/f0979e05/7.png" title="img"><p>（3）修改Maven的本地仓库位置</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta prompt_">#</span><span class="language-bash">创建本地仓库</span></span><br><span class="line">mkdir -p /data/jenkins/repo</span><br><span class="line"><span class="meta prompt_">#</span><span class="language-bash">修改Maven的配置文件</span></span><br><span class="line">vi /opt/maven/apache-maven-3.9.9/conf/settings.xml</span><br><span class="line"><span class="meta prompt_">#</span><span class="language-bash">将&lt;localRepository&gt;/path/to/local/repo&lt;/localRepository&gt;修改为</span></span><br><span class="line">  &lt;localRepository&gt;/data/jenkins/repo&lt;/localRepository&gt;</span><br><span class="line"><span class="meta prompt_">  </span></span><br><span class="line"><span class="meta prompt_">#</span><span class="language-bash">在&lt;<span class="built_in">id</span>&gt;maven-default-http-blocker&lt;/id&gt;所在的镜像后添加阿里云镜像源</span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">   &lt;mirror&gt;</span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">     &lt;<span class="built_in">id</span>&gt;maven-default-http-blocker&lt;/id&gt;</span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">     &lt;mirrorOf&gt;external:http:*&lt;/mirrorOf&gt;</span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">     &lt;name&gt;Pseudo repository to mirror external repositories initially using HTTP.&lt;/name&gt;</span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">     &lt;url&gt;http://0.0.0.0/&lt;/url&gt;</span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">     &lt;blocked&gt;<span class="literal">true</span>&lt;/blocked&gt;</span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">   &lt;/mirror&gt;</span></span><br><span class="line">    &lt;mirror&gt;</span><br><span class="line">      &lt;id&gt;alimaven&lt;/id&gt;</span><br><span class="line">      &lt;name&gt;aliyun maven&lt;/name&gt;</span><br><span class="line">      &lt;url&gt;http://maven.aliyun.com/nexus/content/groups/public&lt;/url&gt;</span><br><span class="line">      &lt;mirrorOf&gt;central&lt;/mirrorOf&gt;</span><br><span class="line">    &lt;/mirror&gt;</span><br><span class="line"></span><br></pre></td></tr></table></figure><p>（4）测试Maven配置</p><p>在jenkins中选择任务<code>test02</code>，选择配置-Environment-Build Steps，选择Execute shell中输入命令<code>mvn clean package</code>,保存后，点击Build Now，等待任务构建完成后，点击控制台输出查看详细信息。</p><img src="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="/yyg/f0979e05/9.png" title="img"> <img src="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="/yyg/f0979e05/10.png" title="img"><p>此时服务器上的test02任务目录中会新增一个<code>target</code>目录。</p><blockquote><p>[root@124 workspace]# ls<br>test01 test01@tmp test02 test02@tmp<br>[root@124 workspace]# cd test01<br>[root@124 test01]# ls<br>pom.xml src<br>[root@124 test01]# cd ..<br>[root@124 workspace]# ls<br>test01 test01@tmp test02 test02@tmp<br>[root@124 workspace]# cd test02<br>[root@124 test02]# ls<br>pom.xml src <strong>target</strong><br>[root@124 test02]# pwd<br>/var/lib/jenkins/workspace/test02<br>[root@124 test02]#</p></blockquote><h3 id="安装Tomcat"><a href="#安装Tomcat" class="headerlink" title="安装Tomcat"></a>安装Tomcat</h3><p>下载jdk-1.8和tomcat-9</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">yum install -y java-1.8.0-openjdk*</span><br><span class="line">curl -O https://mirrors.huaweicloud.com/apache/tomcat/tomcat-9/v9.0.104/bin/apache-tomcat-9.0.104.tar.gz</span><br><span class="line"><span class="meta prompt_">#</span><span class="language-bash">创建存储目录</span></span><br><span class="line">mkdir -p /opt/tomcat/</span><br><span class="line"><span class="meta prompt_">#</span><span class="language-bash">解压</span></span><br><span class="line">tar -zxvf apache-tomcat-9.0.104.tar.gz -C /opt/tomcat/</span><br><span class="line"><span class="meta prompt_">#</span><span class="language-bash">启动tomcat</span></span><br><span class="line">/opt/tomcat/apache-tomcat-9.0.104/bin/startup.sh</span><br></pre></td></tr></table></figure><p>配置防火墙策略</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">firewall-cmd --add-port=8080/tcp --permanent</span><br><span class="line">firewall-cmd --reload</span><br><span class="line">firewall-cmd --list-all</span><br></pre></td></tr></table></figure><p>在浏览器中访问<code>http://192.168.1.125:8080/</code>。</p><img src="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="/yyg/f0979e05/11.png" title="img"><p>配置tomcat的用户角色</p><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">vi  /opt/tomcat/apache-tomcat-9.0.104/conf/tomcat-users.xml</span><br><span class="line"></span><br><span class="line"><span class="comment">&lt;!--在tomcat-users标签下添加以下内容 --&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;<span class="name">role</span> <span class="attr">rolename</span>=<span class="string">&quot;tomcat&quot;</span>/&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">role</span> <span class="attr">rolename</span>=<span class="string">&quot;role1&quot;</span>/&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">role</span> <span class="attr">rolename</span>=<span class="string">&quot;manager-script&quot;</span>/&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">role</span> <span class="attr">rolename</span>=<span class="string">&quot;manager-gui&quot;</span>/&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">role</span> <span class="attr">rolename</span>=<span class="string">&quot;manager-status&quot;</span>/&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">role</span> <span class="attr">rolename</span>=<span class="string">&quot;admin-gui&quot;</span>/&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">role</span> <span class="attr">rolename</span>=<span class="string">&quot;admin-script&quot;</span>/&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">user</span> <span class="attr">username</span>=<span class="string">&quot;tomcat&quot;</span> <span class="attr">password</span>=<span class="string">&quot;tomcat&quot;</span> <span class="attr">roles</span>=<span class="string">&quot;manager-gui,manager-script,tomcat,admin-gui,admin-script&quot;</span>/&gt;</span></span><br><span class="line"></span><br></pre></td></tr></table></figure><p>配置tomcat的远程访问地址范围</p><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">vi /opt/tomcat/apache-tomcat-9.0.104/webapps/manager/META-INF/context.xml</span><br><span class="line"><span class="comment">&lt;!-- 将以下内容注释--&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">Valve</span> <span class="attr">className</span>=<span class="string">&quot;org.apache.catalina.valves.RemoteAddrValve&quot;</span></span></span><br><span class="line"><span class="tag">         <span class="attr">allow</span>=<span class="string">&quot;127\.\d+\.\d+\.\d+|::1|0:0:0:0:0:0:0:1&quot;</span> /&gt;</span></span><br><span class="line"></span><br></pre></td></tr></table></figure><p>重启tomcat，输入用户名和密码进行访问。</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta prompt_">#</span><span class="language-bash">停止运行</span></span><br><span class="line">/opt/tomcat/apache-tomcat-9.0.104/bin/shutdown.sh</span><br><span class="line"><span class="meta prompt_">#</span><span class="language-bash">启动</span></span><br><span class="line">/opt/tomcat/apache-tomcat-9.0.104/bin/startup.sh</span><br></pre></td></tr></table></figure><h3 id="Jenkins构建项目"><a href="#Jenkins构建项目" class="headerlink" title="Jenkins构建项目"></a>Jenkins构建项目</h3><p>Jenkins中自动构建项目的类型有很多，常用的有以下三种：</p><ul><li>自由风格软件项目(FreeStyle Project)</li><li>Maven项目(Maven Project)</li><li>流水线项目(Pipeline Project)</li></ul><blockquote><p>本文构建项目时使用的war包，源自b站up主，’’涣沷a靑惷’’，原文链接为： <a target="_blank" rel="noopener" href="https://www.yuque.com/huanfqc/jenkins/jenkins。">https://www.yuque.com/huanfqc/jenkins/jenkins。</a></p><p>war包项目代码地址为：<a target="_blank" rel="noopener" href="https://share.feijipan.com/s/BWEO9Jad，war包构建具体过程见原文。">https://share.feijipan.com/s/BWEO9Jad，war包构建具体过程见原文。</a></p></blockquote><h4 id="Jenkins构建自由风格项目"><a href="#Jenkins构建自由风格项目" class="headerlink" title="Jenkins构建自由风格项目"></a>Jenkins构建自由风格项目</h4><p>（1）安装 <code>Deploy to container</code> 插件</p><p>（2）新建项目freestyle_demo，配置并拉取gitlab中test_war代码，该过程除包含步骤《部署Jenkins》的过程外，还需进行构建后操作，具体如下图。</p><img src="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="/yyg/f0979e05/12.png" title="img"><p>（3）配置保存后，，点击Build Now，等待任务构建完成后，访问tomcat，可以看到<code>/websocketChat-1.0-SNAPSHOT</code>虚拟目录已出现。</p><img src="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="/yyg/f0979e05/13.png" title="img"><h4 id="Jenkins构建Maven项目"><a href="#Jenkins构建Maven项目" class="headerlink" title="Jenkins构建Maven项目"></a>Jenkins构建Maven项目</h4><p>（1）安装<code>Maven Integration</code>插件</p><p>（2）新建项目maven-demo，配置并拉取gitlab中test_war代码，该过程除包含步骤《Jenkins构建自由风格项目》的过程外，还需要在Build时进行修改，具体如下图。</p><img src="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="/yyg/f0979e05/14.png" title="img"><blockquote><p>构建时出现报错可将之前配置的阿里云镜像地址改为https</p></blockquote><p>（3）配置保存后，点击Build Now，等待任务构建完成后，访问tomcat，可以看到<code>/websocketChat-1.0-SNAPSHOT</code>虚拟目录已出现。</p><h4 id="Jenkins构建Pipeline流水线项目"><a href="#Jenkins构建Pipeline流水线项目" class="headerlink" title="Jenkins构建Pipeline流水线项目"></a>Jenkins构建Pipeline流水线项目</h4><p>Pipeline,简单来说，就是一套运行在Jenkins上的工作流框架，将原来独立运行于单个或者多个节点的任务连接起来，实现单个任务难以完成的复杂流程编排和可视化的工作。</p><p>如何创建Jenkins Pipeline呢？</p><ul><li><p>Pipeline脚本是由Groovy语言实现的。</p></li><li><p>Pipeline支持两种语法：Declarative(声明式)和Scripted Pipeline(脚本式)语法。</p></li><li><p>Pipeline也有两种创建方法：可以直接在Jenkins的Web Ul界面中输入脚本；也可以通过创建一个Jenkinsfile脚本文件放入项目源码库中（一般我们都推荐在Jenkins中直接从源代码控制(SCM)中直接载入Jenkinsfile Pipeline这种方法)。</p></li></ul><h5 id="在Jenkins的Web-Ul中创建Pipeline脚本发布项目"><a href="#在Jenkins的Web-Ul中创建Pipeline脚本发布项目" class="headerlink" title="在Jenkins的Web Ul中创建Pipeline脚本发布项目"></a>在Jenkins的Web Ul中创建Pipeline脚本发布项目</h5><p>（1）安装Pipeline插件</p><p>（2）新建任务Pipeline-demo，使用声明式语法，在Jenkins的Web Ul里创建Pipeline脚本；实现从代码拉取、编译构建、到发布项目。</p><p>在Pipeline-demo的配置界面，选择构建触发器-流水线，选择一个脚本模板Hello Word。</p><img src="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="/yyg/f0979e05/15.png" title="img"><p>点击<code>流水线语法</code>，在片段生成器中选择<code>checkout：Check out from version control</code>，按引导填写项目地址和凭证，生成流水线脚本，将拉取代码脚本粘贴到修改后的模板中。</p><p>在片段生成器中选择<code>sh：Shell Script</code>，填写编译命令，生成流水线脚本，将脚本粘贴到修改后的模板中。</p><p>在片段生成器中选择<code>deploy：Deploy war/ear to a container</code>，按引导填写，生成流水线脚本，将脚本粘贴到修改后的模板中。</p><figure class="highlight groovy"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line">pipeline &#123;</span><br><span class="line">    agent any</span><br><span class="line"></span><br><span class="line">    stages &#123;</span><br><span class="line">        stage(<span class="string">&#x27;拉取代码&#x27;</span>) &#123;</span><br><span class="line">            steps &#123;</span><br><span class="line">                checkout scmGit(<span class="attr">branches:</span> [[<span class="attr">name:</span> <span class="string">&#x27;*/master&#x27;</span>]], <span class="attr">extensions:</span> [], <span class="attr">userRemoteConfigs:</span> [[<span class="attr">credentialsId:</span> <span class="string">&#x27;fbf87557-40b6-468a-91c5-2cfa1b2e33e8&#x27;</span>, <span class="attr">url:</span> <span class="string">&#x27;http://192.168.1.121:82/test/test_war_demo.git&#x27;</span>]])</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">        stage(<span class="string">&#x27;编译构建&#x27;</span>) &#123;</span><br><span class="line">            steps &#123;</span><br><span class="line">                sh <span class="string">&#x27;mvn clean package&#x27;</span></span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">        stage(<span class="string">&#x27;发布项目&#x27;</span>) &#123;</span><br><span class="line">            steps &#123;</span><br><span class="line">                deploy <span class="attr">adapters:</span> [tomcat9(<span class="attr">credentialsId:</span> <span class="string">&#x27;4d9b76aa-078c-462b-81f1-33fe1d9c971c&#x27;</span>, <span class="attr">path:</span> <span class="string">&#x27;&#x27;</span>, <span class="attr">url:</span> <span class="string">&#x27;http://192.168.1.125:8080/&#x27;</span>)], <span class="attr">contextPath:</span> <span class="literal">null</span>, <span class="attr">war:</span> <span class="string">&#x27;target/*.war&#x27;</span></span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure><p>（3）配置保存后，点击Build Now，等待任务构建完成后，访问tomcat，可以看到<code>/websocketChat-1.0-SNAPSHOT</code>虚拟目录已出现。</p><h5 id="使用Jenkinsfile脚本发布项目"><a href="#使用Jenkinsfile脚本发布项目" class="headerlink" title="使用Jenkinsfile脚本发布项目"></a>使用Jenkinsfile脚本发布项目</h5><p>（1）在idea中的项目目录下，选择New-File，创建Jenkinsfile文件，将Pipeline脚本内容粘贴进去，随代码一起发布到项目仓库中。</p><img src="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="/yyg/f0979e05/16.png" title="img"> <img src="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="/yyg/f0979e05/17.png" title="img"><p>（2）在任务Pipeline-demo的配置界面，选择构建触发器-流水线，定义内容选择<code>Pipeline script from SCM</code>-<code>GIt</code>，填写项目地址和凭证，脚本路径填写<code>Jenkinsfile</code>。</p><img src="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="/yyg/f0979e05/18.png" title="img"><p>（3）配置保存后，点击Build Now，等待任务构建完成后，访问tomcat，可以看到<code>/websocketChat-1.0-SNAPSHOT</code>虚拟目录已出现。</p><h4 id="常用构建触发器"><a href="#常用构建触发器" class="headerlink" title="常用构建触发器"></a>常用构建触发器</h4><p>Jenkins内置4种构建触发器：</p><ul><li><p>触发远程构建</p></li><li><p>其他工程构建后触发(Build after other projects are build)</p></li><li><p>定时构建(Build periodically)</p><blockquote><p>定时字符串从左往右分别为：分 时 日 月 周</p><p>定时表达式的例子：</p><p>每30分钟构建一次：H代表形参</p><p>H/30<em></em><em></em></p><p>每2个小时构建一次：</p><p>H H/2<em></em> *</p><p>每天的8点，12点，22点，一天构建3次：（多个时间点中间用逗号隔开）</p><p>0 8,12,22<em></em> *</p></blockquote></li><li><p>轮询SCM(Poll SCM)</p></li></ul><blockquote><p>轮询SCM,是指定时扫描本地代码仓库的代码是否有变更，如果代码有变更就触发项目构建。</p></blockquote><p>（1）触发远程构建</p><p>在任务Pipeline-demo的配置界面，选择<code>构建触发器</code>-<code>触发远程构建 (例如,使用脚本)</code>，自定义身份验证令牌为<code>test</code>，保存配置。在浏览器中访问：</p><blockquote><p>jenkins地址/job/Pipeline-demo/build?token=<code>TOKEN_NAME</code></p></blockquote><p><a target="_blank" rel="noopener" href="http://192.168.1.124:8888/job/Pipeline-demo/build?token=test">http://192.168.1.124:8888/job/Pipeline-demo/build?token=test</a> ，返回查看任务状态已经开始构建。</p><p>（2）其他工程构建后触发(Build after other projects are build)</p><p>当需要多个任务先后执行时可用。比如若希望执行<code>freestyle_demo</code>任务后，再执行<code>Pipeline-demo</code>，在任务Pipeline-demo的配置界面，选择<code>构建触发器</code>-<code>Build after other projects are built</code>，中输入<code>freestyle_demo</code>，选择<code>只有构建稳定时触发</code>，保存配置。freestyle_demo任务构建完成后，freestyle_demo开始进行构建。</p><p>（3）定时构建(Build periodically)</p><p>在任务Pipeline-demo的配置界面，选择<code>构建触发器</code>-<code>Build periodically</code>，设置<code>*/1 * * * *</code>（一分钟一次），保存配置，freestyle_demo任务会每分钟构建一次。</p><p>（4）轮询SCM(Poll SCM)</p><p>轮询SCM也要设置时间周期，不过与定时构建不同的是，如果在时间周期内代码仓库未发生变化，任务构建就不会进行。比如：在任务Pipeline-demo的配置界面，选择<code>构建触发器</code>-<code>Poll SCM</code>，设置<code>*/1 * * * *</code>（一分钟一次），保存配置。如果在之后的一分钟内代码变更，Pipeline-demo任务会进行构建，反之，直到代码变更后的那一分钟周期内进行构建。</p><h4 id="Git-hook构建触发器（常用）"><a href="#Git-hook构建触发器（常用）" class="headerlink" title="Git hook构建触发器（常用）"></a>Git hook构建触发器（常用）</h4><blockquote><p>当GitLab出现代码变更时，会提交构建请求到Jenkins，Jenkins收到请求后，触发构建。</p></blockquote><p>（1）安装GitLab插件和GitLab Hook插件（新版本自带GitLab Hook插件）</p><p>（2）在Jenkins的任务Pipeline-demo的配置界面，选择<code>构建触发器</code>-<code>Build when a change is pushed to GitLab. GitLab webhook URL: http://192.168.1.124:8888/project/Pipeline-demo</code>，会出现以下表格中的选项，默认选择即可。</p><div class="table-container"><table><thead><tr><th><strong>事件类型</strong></th><th><strong>触发条件</strong></th></tr></thead><tbody><tr><td><strong>Push Events</strong></td><td>代码推送到分支或标签，包括新分支创建。</td></tr><tr><td><strong>Push on Branch Delete</strong></td><td>分支被删除时。</td></tr><tr><td><strong>Opened Merge Request</strong></td><td>创建新的合并请求时触发。</td></tr><tr><td><strong>New Commits in MR</strong></td><td>向已存在的MR推送新提交时触发（更新MR）。</td></tr><tr><td><strong>Accepted (Merged) MR</strong></td><td>合并请求被合并到目标分支（如<code>main</code>）时触发。</td></tr><tr><td><strong>Closed MR</strong></td><td>合并请求被关闭（未合并）时触发。</td></tr></tbody></table></div><p>（3）在Jenkins中选择Manage Jenkins-System-GitLab中，取消勾选<code>Enable authentication for &#39;/project&#39; end-point</code>，保存设置。</p><p>（4）在GitLab的管理员账户中选择管理中心-设置-网络-外发请求中勾选<code>Allow requests to the local network from web hooks and services</code> ，保存配置。</p><p>（5）在GitLab的项目仓库中选择设置-集成，输入webhook URL，选择默认配置，保存。在生成的Webhook右侧，选择Test-Push events，显示<code>Hook executed successfully: HTTP 200</code>，即为成功。</p><h4 id="参数化构建"><a href="#参数化构建" class="headerlink" title="参数化构建"></a>参数化构建</h4><p>（1）在源码中创建分支v1，并修改Jenkinsfile脚本中的分支名称，提交代码到gitlab。</p><blockquote><p>修改前： checkout scmGit(branches: [[name: ‘*/master’]]</p><p>修改后：checkout scmGit(branches: [[name: ‘*/${branch}’]]</p></blockquote><p>（2）在Jenkins的任务Pipeline-demo的配置界面，选择<code>This project is parameterized</code>-<code>String Parameter</code>，具体设置如下图。</p><img src="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="/yyg/f0979e05/19.png" title="img"><p>（3）保存设置，在任务Pipeline-demo界面选择<code>Build with Parameters</code>，输入分支的名称，点击Build，进行构建。</p><h4 id="配置邮件服务器"><a href="#配置邮件服务器" class="headerlink" title="配置邮件服务器"></a>配置邮件服务器</h4><p>（1）安装Email Extension TemplateVersion插件</p><p>（2）选择Manage Jenkins-Credentials，点击<code>全局</code>-<code>Add Credentials</code>，创建邮件服务器的密码凭证，账户为邮箱地址，密码为获取的邮箱授权码。</p><p>（3）选择<code>System</code>，在<code>Jenkins Location``-系统管理员邮件地址</code>出输入注册邮箱，在<code>Extended E-mail Notification</code>处，输入注册邮箱和端口，点击<code>高级</code>，选择密码凭证，勾选<code>Use SSL</code>，在<code>Default user e-mail suffix</code>中邮箱后缀，<code>Default Content Type</code>选择<code>HTML (text/html)</code>，<code>Default Recipients</code>输入注册邮箱，在邮件通知部分输入SMTP服务器和用户默认邮件后缀，点击高级完善信息，勾选<code>通过发送测试邮件测试配置</code>测试邮件服务器。</p><p>（4）构建邮件服务器模板</p><p>在项目根目录下创建email.html模板</p><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;!DOCTYPE <span class="keyword">html</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">html</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">head</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">meta</span> <span class="attr">charset</span>=<span class="string">&quot;UTF-8&quot;</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">title</span>&gt;</span>$&#123;ENV, var=&quot;JOB_NAME&quot;&#125;-第$&#123;BUILD_NUMBER&#125;次构建日志<span class="tag">&lt;/<span class="name">title</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;/<span class="name">head</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;<span class="name">body</span> <span class="attr">leftmargin</span>=<span class="string">&quot;8&quot;</span> <span class="attr">marginwidth</span>=<span class="string">&quot;0&quot;</span> <span class="attr">topmargin</span>=<span class="string">&quot;8&quot;</span> <span class="attr">marginheight</span>=<span class="string">&quot;4&quot;</span></span></span><br><span class="line"><span class="tag">      <span class="attr">offset</span>=<span class="string">&quot;0&quot;</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">table</span> <span class="attr">width</span>=<span class="string">&quot;95%&quot;</span> <span class="attr">cellpadding</span>=<span class="string">&quot;0&quot;</span> <span class="attr">cellspacing</span>=<span class="string">&quot;0&quot;</span></span></span><br><span class="line"><span class="tag">       <span class="attr">style</span>=<span class="string">&quot;font-size: 11pt; font-family: Tahoma, Arial, Helvetica, sans-serif&quot;</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">tr</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">td</span>&gt;</span>(本邮件是程序自动下发的，请勿回复！)<span class="tag">&lt;/<span class="name">td</span>&gt;</span></span><br><span class="line"></span><br><span class="line">    <span class="tag">&lt;/<span class="name">tr</span>&gt;</span></span><br><span class="line"></span><br><span class="line">    <span class="tag">&lt;<span class="name">tr</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">td</span>&gt;</span><span class="tag">&lt;<span class="name">h2</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">font</span> <span class="attr">color</span>=<span class="string">&quot;#0000FF&quot;</span>&gt;</span>构建结果 - $&#123;BUILD_STATUS&#125;<span class="tag">&lt;/<span class="name">font</span>&gt;</span></span><br><span class="line"></span><br><span class="line">            <span class="tag">&lt;/<span class="name">h2</span>&gt;</span><span class="tag">&lt;/<span class="name">td</span>&gt;</span></span><br><span class="line"></span><br><span class="line">    <span class="tag">&lt;/<span class="name">tr</span>&gt;</span></span><br><span class="line"></span><br><span class="line">    <span class="tag">&lt;<span class="name">tr</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">td</span>&gt;</span><span class="tag">&lt;<span class="name">br</span> /&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">b</span>&gt;</span><span class="tag">&lt;<span class="name">font</span> <span class="attr">color</span>=<span class="string">&quot;#0B610B&quot;</span>&gt;</span>构建信息<span class="tag">&lt;/<span class="name">font</span>&gt;</span><span class="tag">&lt;/<span class="name">b</span>&gt;</span></span><br><span class="line"></span><br><span class="line">            <span class="tag">&lt;<span class="name">hr</span> <span class="attr">size</span>=<span class="string">&quot;2&quot;</span> <span class="attr">width</span>=<span class="string">&quot;100%&quot;</span> <span class="attr">align</span>=<span class="string">&quot;center&quot;</span> /&gt;</span><span class="tag">&lt;/<span class="name">td</span>&gt;</span></span><br><span class="line"></span><br><span class="line">    <span class="tag">&lt;/<span class="name">tr</span>&gt;</span></span><br><span class="line"></span><br><span class="line">    <span class="tag">&lt;<span class="name">tr</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">td</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">ul</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">li</span>&gt;</span>项目名称<span class="symbol">&amp;nbsp;</span>：<span class="symbol">&amp;nbsp;</span>$&#123;PROJECT_NAME&#125;<span class="tag">&lt;/<span class="name">li</span>&gt;</span></span><br><span class="line"></span><br><span class="line">                <span class="tag">&lt;<span class="name">li</span>&gt;</span>构建编号<span class="symbol">&amp;nbsp;</span>：<span class="symbol">&amp;nbsp;</span>第$&#123;BUILD_NUMBER&#125;次构建<span class="tag">&lt;/<span class="name">li</span>&gt;</span></span><br><span class="line"></span><br><span class="line">                <span class="tag">&lt;<span class="name">li</span>&gt;</span>触发原因：<span class="symbol">&amp;nbsp;</span>$&#123;CAUSE&#125;<span class="tag">&lt;/<span class="name">li</span>&gt;</span></span><br><span class="line"></span><br><span class="line">                <span class="tag">&lt;<span class="name">li</span>&gt;</span>构建日志：<span class="symbol">&amp;nbsp;</span><span class="tag">&lt;<span class="name">a</span> <span class="attr">href</span>=<span class="string">&quot;$&#123;BUILD_URL&#125;console&quot;</span>&gt;</span>$&#123;BUILD_URL&#125;console<span class="tag">&lt;/<span class="name">a</span>&gt;</span><span class="tag">&lt;/<span class="name">li</span>&gt;</span></span><br><span class="line"></span><br><span class="line">                <span class="tag">&lt;<span class="name">li</span>&gt;</span>构建<span class="symbol">&amp;nbsp;</span><span class="symbol">&amp;nbsp;</span>Url<span class="symbol">&amp;nbsp;</span>：<span class="symbol">&amp;nbsp;</span><span class="tag">&lt;<span class="name">a</span> <span class="attr">href</span>=<span class="string">&quot;$&#123;BUILD_URL&#125;&quot;</span>&gt;</span>$&#123;BUILD_URL&#125;<span class="tag">&lt;/<span class="name">a</span>&gt;</span><span class="tag">&lt;/<span class="name">li</span>&gt;</span></span><br><span class="line"></span><br><span class="line">                <span class="tag">&lt;<span class="name">li</span>&gt;</span>工作目录<span class="symbol">&amp;nbsp;</span>：<span class="symbol">&amp;nbsp;</span><span class="tag">&lt;<span class="name">a</span> <span class="attr">href</span>=<span class="string">&quot;$&#123;PROJECT_URL&#125;ws&quot;</span>&gt;</span>$&#123;PROJECT_URL&#125;ws<span class="tag">&lt;/<span class="name">a</span>&gt;</span><span class="tag">&lt;/<span class="name">li</span>&gt;</span></span><br><span class="line"></span><br><span class="line">                <span class="tag">&lt;<span class="name">li</span>&gt;</span>项目<span class="symbol">&amp;nbsp;</span><span class="symbol">&amp;nbsp;</span>Url<span class="symbol">&amp;nbsp;</span>：<span class="symbol">&amp;nbsp;</span><span class="tag">&lt;<span class="name">a</span> <span class="attr">href</span>=<span class="string">&quot;$&#123;PROJECT_URL&#125;&quot;</span>&gt;</span>$&#123;PROJECT_URL&#125;<span class="tag">&lt;/<span class="name">a</span>&gt;</span><span class="tag">&lt;/<span class="name">li</span>&gt;</span></span><br><span class="line"></span><br><span class="line">            <span class="tag">&lt;/<span class="name">ul</span>&gt;</span></span><br><span class="line"></span><br><span class="line">        <span class="tag">&lt;/<span class="name">td</span>&gt;</span></span><br><span class="line"></span><br><span class="line">    <span class="tag">&lt;/<span class="name">tr</span>&gt;</span></span><br><span class="line"></span><br><span class="line">    <span class="tag">&lt;<span class="name">tr</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">td</span>&gt;</span><span class="tag">&lt;<span class="name">b</span>&gt;</span><span class="tag">&lt;<span class="name">font</span> <span class="attr">color</span>=<span class="string">&quot;#0B610B&quot;</span>&gt;</span>Changes Since Last</span><br><span class="line">                    Successful Build:<span class="tag">&lt;/<span class="name">font</span>&gt;</span><span class="tag">&lt;/<span class="name">b</span>&gt;</span></span><br><span class="line"></span><br><span class="line">            <span class="tag">&lt;<span class="name">hr</span> <span class="attr">size</span>=<span class="string">&quot;2&quot;</span> <span class="attr">width</span>=<span class="string">&quot;100%&quot;</span> <span class="attr">align</span>=<span class="string">&quot;center&quot;</span> /&gt;</span><span class="tag">&lt;/<span class="name">td</span>&gt;</span></span><br><span class="line"></span><br><span class="line">    <span class="tag">&lt;/<span class="name">tr</span>&gt;</span></span><br><span class="line"></span><br><span class="line">    <span class="tag">&lt;<span class="name">tr</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">td</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">ul</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">li</span>&gt;</span>历史变更记录 : <span class="tag">&lt;<span class="name">a</span> <span class="attr">href</span>=<span class="string">&quot;$&#123;PROJECT_URL&#125;changes&quot;</span>&gt;</span>$&#123;PROJECT_URL&#125;changes<span class="tag">&lt;/<span class="name">a</span>&gt;</span><span class="tag">&lt;/<span class="name">li</span>&gt;</span></span><br><span class="line"></span><br><span class="line">            <span class="tag">&lt;/<span class="name">ul</span>&gt;</span> $&#123;CHANGES_SINCE_LAST_SUCCESS,reverse=true, format=&quot;Changes for Build #%n:<span class="tag">&lt;<span class="name">br</span> /&gt;</span>%c<span class="tag">&lt;<span class="name">br</span> /&gt;</span>&quot;,showPaths=true,changesFormat=&quot;<span class="tag">&lt;<span class="name">pre</span>&gt;</span>[%a]<span class="tag">&lt;<span class="name">br</span> /&gt;</span>%m<span class="tag">&lt;/<span class="name">pre</span>&gt;</span>&quot;,pathFormat=&quot;<span class="symbol">&amp;nbsp;</span><span class="symbol">&amp;nbsp;</span><span class="symbol">&amp;nbsp;</span><span class="symbol">&amp;nbsp;</span>%p&quot;&#125;</span><br><span class="line">        <span class="tag">&lt;/<span class="name">td</span>&gt;</span></span><br><span class="line"></span><br><span class="line">    <span class="tag">&lt;/<span class="name">tr</span>&gt;</span></span><br><span class="line"></span><br><span class="line">    <span class="tag">&lt;<span class="name">tr</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">td</span>&gt;</span><span class="tag">&lt;<span class="name">b</span>&gt;</span>Failed Test Results<span class="tag">&lt;/<span class="name">b</span>&gt;</span></span><br><span class="line"></span><br><span class="line">            <span class="tag">&lt;<span class="name">hr</span> <span class="attr">size</span>=<span class="string">&quot;2&quot;</span> <span class="attr">width</span>=<span class="string">&quot;100%&quot;</span> <span class="attr">align</span>=<span class="string">&quot;center&quot;</span> /&gt;</span><span class="tag">&lt;/<span class="name">td</span>&gt;</span></span><br><span class="line"></span><br><span class="line">    <span class="tag">&lt;/<span class="name">tr</span>&gt;</span></span><br><span class="line"></span><br><span class="line">    <span class="tag">&lt;<span class="name">tr</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">td</span>&gt;</span><span class="tag">&lt;<span class="name">pre</span></span></span><br><span class="line"><span class="tag">                    <span class="attr">style</span>=<span class="string">&quot;font-size: 11pt; font-family: Tahoma, Arial, Helvetica, sans-serif&quot;</span>&gt;</span>$FAILED_TESTS<span class="tag">&lt;/<span class="name">pre</span>&gt;</span></span><br><span class="line"></span><br><span class="line">            <span class="tag">&lt;<span class="name">br</span> /&gt;</span><span class="tag">&lt;/<span class="name">td</span>&gt;</span></span><br><span class="line"></span><br><span class="line">    <span class="tag">&lt;/<span class="name">tr</span>&gt;</span></span><br><span class="line"></span><br><span class="line">    <span class="tag">&lt;<span class="name">tr</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">td</span>&gt;</span><span class="tag">&lt;<span class="name">b</span>&gt;</span><span class="tag">&lt;<span class="name">font</span> <span class="attr">color</span>=<span class="string">&quot;#0B610B&quot;</span>&gt;</span>构建日志 (最后 100行):<span class="tag">&lt;/<span class="name">font</span>&gt;</span><span class="tag">&lt;/<span class="name">b</span>&gt;</span></span><br><span class="line"></span><br><span class="line">            <span class="tag">&lt;<span class="name">hr</span> <span class="attr">size</span>=<span class="string">&quot;2&quot;</span> <span class="attr">width</span>=<span class="string">&quot;100%&quot;</span> <span class="attr">align</span>=<span class="string">&quot;center&quot;</span> /&gt;</span><span class="tag">&lt;/<span class="name">td</span>&gt;</span></span><br><span class="line"></span><br><span class="line">    <span class="tag">&lt;/<span class="name">tr</span>&gt;</span></span><br><span class="line"></span><br><span class="line">    <span class="tag">&lt;<span class="name">tr</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">td</span>&gt;</span><span class="tag">&lt;<span class="name">textarea</span> <span class="attr">cols</span>=<span class="string">&quot;80&quot;</span> <span class="attr">rows</span>=<span class="string">&quot;30&quot;</span> <span class="attr">readonly</span>=<span class="string">&quot;readonly&quot;</span></span></span><br><span class="line"><span class="tag">                      <span class="attr">style</span>=<span class="string">&quot;font-family: Courier New&quot;</span>&gt;</span>$&#123;BUILD_LOG, maxLines=100&#125;<span class="tag">&lt;/<span class="name">textarea</span>&gt;</span></span><br><span class="line"></span><br><span class="line">        <span class="tag">&lt;/<span class="name">td</span>&gt;</span></span><br><span class="line"></span><br><span class="line">    <span class="tag">&lt;/<span class="name">tr</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;/<span class="name">table</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;/<span class="name">body</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;/<span class="name">html</span>&gt;</span></span><br></pre></td></tr></table></figure><p>（5）修改Jenkinsfile文件，添加与stages同级的post部分，添加构建后发送邮件</p><figure class="highlight groovy"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br></pre></td><td class="code"><pre><span class="line">pipeline &#123;</span><br><span class="line">    agent any</span><br><span class="line"></span><br><span class="line">    stages &#123;</span><br><span class="line">        stage(<span class="string">&#x27;拉取代码&#x27;</span>) &#123;</span><br><span class="line">            steps &#123;</span><br><span class="line">                checkout scmGit(<span class="attr">branches:</span> [[<span class="attr">name:</span> <span class="string">&#x27;*/master&#x27;</span>]], <span class="attr">extensions:</span> [], <span class="attr">userRemoteConfigs:</span> [[<span class="attr">credentialsId:</span> <span class="string">&#x27;fbf87557-40b6-468a-91c5-2cfa1b2e33e8&#x27;</span>, <span class="attr">url:</span> <span class="string">&#x27;http://192.168.1.121:82/test/test_war_demo.git&#x27;</span>]])</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">        stage(<span class="string">&#x27;编译构建&#x27;</span>) &#123;</span><br><span class="line">            steps &#123;</span><br><span class="line">                sh <span class="string">&#x27;mvn clean package&#x27;</span></span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">        stage(<span class="string">&#x27;发布项目&#x27;</span>) &#123;</span><br><span class="line">            steps &#123;</span><br><span class="line">                deploy <span class="attr">adapters:</span> [tomcat9(<span class="attr">credentialsId:</span> <span class="string">&#x27;4d9b76aa-078c-462b-81f1-33fe1d9c971c&#x27;</span>, <span class="attr">path:</span> <span class="string">&#x27;&#x27;</span>, <span class="attr">url:</span> <span class="string">&#x27;http://192.168.1.125:8080/&#x27;</span>)], <span class="attr">contextPath:</span> <span class="literal">null</span>, <span class="attr">war:</span> <span class="string">&#x27;target/*.war&#x27;</span></span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    post &#123;</span><br><span class="line">        always &#123;</span><br><span class="line">            emailext(</span><br><span class="line">                <span class="symbol">subject:</span> <span class="string">&#x27;构建通知：$&#123;PROJECT_NAME&#125; - Build # $&#123;BUILD_NUMBER&#125; - $&#123;BUILD_STATUS&#125;!&#x27;</span>,</span><br><span class="line">                <span class="symbol">body:</span> <span class="string">&#x27;$&#123;FILE,path=&quot;email.html&quot;&#125;&#x27;</span>,</span><br><span class="line">                <span class="symbol">to:</span> <span class="string">&#x27;邮箱地址1,邮箱地址2&#x27;</span></span><br><span class="line">            )</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure><h3 id="安装SonarQube"><a href="#安装SonarQube" class="headerlink" title="安装SonarQube"></a>安装SonarQube</h3><p>Jenkins集成SonarQube进行代码审查。</p><blockquote><p>SonarQube7.9开始不再支持mysql，SonarQube7.8安装支持mysql &gt;=5.6 &amp;&amp; &lt;8.0</p></blockquote><p>（1）安装SonarQube前需要安装mysql数据库</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta prompt_">#</span><span class="language-bash">配置mysql5.7的yum源</span></span><br><span class="line">vi /etc/yum.repos.d/mysql-community.repo</span><br><span class="line"></span><br><span class="line">[mysql-connectors-community]</span><br><span class="line">name=MySQL Connectors Community</span><br><span class="line">baseurl=https://mirrors.tuna.tsinghua.edu.cn/mysql/yum/mysql-connectors-community-el7-$basearch/</span><br><span class="line">enabled=1</span><br><span class="line">gpgcheck=1</span><br><span class="line">gpgkey=https://repo.mysql.com/RPM-GPG-KEY-mysql-2022</span><br><span class="line"></span><br><span class="line">[mysql-tools-community]</span><br><span class="line">name=MySQL Tools Community</span><br><span class="line">baseurl=https://mirrors.tuna.tsinghua.edu.cn/mysql/yum/mysql-tools-community-el7-$basearch/</span><br><span class="line">enabled=1</span><br><span class="line">gpgcheck=1</span><br><span class="line">gpgkey=https://repo.mysql.com/RPM-GPG-KEY-mysql-2022</span><br><span class="line"></span><br><span class="line">[mysql-5.7-community]</span><br><span class="line">name=MySQL 5.7 Community Server</span><br><span class="line">baseurl=https://mirrors.tuna.tsinghua.edu.cn/mysql/yum/mysql-5.7-community-el7-$basearch/</span><br><span class="line">enabled=1</span><br><span class="line">gpgcheck=1</span><br><span class="line">gpgkey=https://repo.mysql.com/RPM-GPG-KEY-mysql-2022</span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_">#</span><span class="language-bash">安装mysql</span></span><br><span class="line">yum -y install mysql-server</span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">查看版本</span></span><br><span class="line">mysql -V</span><br><span class="line">systemctl start mysqld</span><br><span class="line">systemctl enable mysqld</span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">查看MySQL的初始密码</span></span><br><span class="line">grep &quot;password&quot; /var/log/mysqld.log</span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">MySQL的安全性配置</span></span><br><span class="line">mysql_secure_installation</span><br><span class="line"><span class="meta prompt_">#</span><span class="language-bash">按引导配置完后，登录并创建数据库</span></span><br><span class="line">mysql -uroot -p</span><br><span class="line">create database sonar;</span><br><span class="line"><span class="meta prompt_">#</span><span class="language-bash">查看数据库</span></span><br><span class="line">show databases;</span><br></pre></td></tr></table></figure><p>（2）安装SonarQube</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta prompt_">#</span><span class="language-bash">配置系统相关参数</span></span><br><span class="line">echo &quot;vm.max_map_count=524288</span><br><span class="line">fs.file-max=131072&quot; &gt;&gt; /etc/sysctl.conf</span><br><span class="line">sysctl -p</span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_">#</span><span class="language-bash">下载依赖工具</span></span><br><span class="line">yum install -y unzip</span><br><span class="line">wget https://binaries.sonarsource.com/Distribution/sonarqube/sonarqube-7.8.zip</span><br><span class="line">mkdir -p /opt/sonar</span><br><span class="line">unzip -q sonarqube-7.8.zip -d /opt/sonar</span><br><span class="line"><span class="meta prompt_">#</span><span class="language-bash">创建用户</span></span><br><span class="line">useradd sonar</span><br><span class="line">passwd sonar</span><br><span class="line"><span class="meta prompt_">#</span><span class="language-bash">修改sonarqube文件权限</span></span><br><span class="line">chown -R sonar:sonar /opt/sonar/sonarqube-7.8</span><br></pre></td></tr></table></figure><p>（3）修改<code>conf</code>目录下的<code>sonar.properties</code>配置文件</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">sonar.jdbc.username=root</span><br><span class="line">sonar.jdbc.password=数据库密码</span><br><span class="line">sonar.jdbc.url=jdbc:mysql://localhost:3306/sonar?useUnicode=true&amp;characterEncoding=utf8&amp;rewriteBatchedStatements=true&amp;useConfigs=maxPerformance&amp;useSSL=false</span><br></pre></td></tr></table></figure><p>（4）修改<code>conf</code>目录下<code>wrapper.conf</code>的jdk-1.8的路径</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">wrapper.java.command=/usr/lib/jvm/java-1.8.0-openjdk-1.8.0.412.b08-1.el7_9.x86_64/bin/java</span><br></pre></td></tr></table></figure><p>（5）进入<code>bin/linux-x86-64/</code>目录，使用sonar用户启动sonarqube</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">su sonar</span><br><span class="line">./sonar.sh start</span><br><span class="line"><span class="meta prompt_">#</span><span class="language-bash">查看启动日志</span></span><br><span class="line">tail ../../logs/sonar.log</span><br></pre></td></tr></table></figure><blockquote><p>使用默认账户登录，账号密码都是admin</p></blockquote><p>（6）登录sonarqube后，选择 <code>Administration</code> - <code>Security</code>- <code>Global Permissions</code>，为admin勾选 <code>Administer System</code><strong>、</strong><code>Administer</code><strong>、</strong><code>Execute Analysis</code>、<code>Create</code> 权限。单击右上角头像下拉框，选择 <code>My Account</code> - <code>Security</code>，随意填写token名称，完成 Token 的创建。</p><h4 id="配置Jenkins与sonarqube集成"><a href="#配置Jenkins与sonarqube集成" class="headerlink" title="配置Jenkins与sonarqube集成"></a><strong>配置Jenkins与sonarqube集成</strong></h4><p>（1）在Jenkins上安装<code>SonarQube Scanner</code>插件，安装完成后，选择<code>Manage Jenkins</code> -<code>Tools</code>-<code>SonarQube Scanner 安装</code>，点击<code>新增SonarQube Scanner</code> ，输入名称，版本选择<code>SonarQube Scanner 4.2.0.1873</code>，点击保存。</p><blockquote><p><strong>SonarQube 7.8</strong> 对应 <strong>Sonar-Scanner 4.2</strong></p><p><strong>SonarQube 8.9 LTS</strong> 对应 <strong>Sonar-Scanner 4.6</strong></p></blockquote><p>（2）在Jenkins中配置SonarQube的token凭证。选择类型为<code>Secret text</code>，输入token，点击创建。</p><p>（3）在Jenkins中选择System-SonarQube installations，点击<code>Add SonarQube</code>，输入SonarQube的地址、选择创建的token凭证，保存集成SonarQube。</p><h4 id="非流水线任务添加SonarQube代码审查"><a href="#非流水线任务添加SonarQube代码审查" class="headerlink" title="非流水线任务添加SonarQube代码审查"></a><strong>非流水线任务添加SonarQube代码审查</strong></h4><p>在freestyle_demo任务中选择配置-Build Steps，点击增加构建步骤，选择<code>Execute SonarQube Scanner</code>，选择JDK，输入分析内容，保存配置后，点击Build Now，等待任务构建完成。在SonarQube里查看代码分析结果。</p><figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">sonar.projectKey=websocketChat</span><br><span class="line">sonar.projectName=websocketChat</span><br><span class="line">sonar.projectVersion=<span class="number">1.0</span></span><br><span class="line">sonar.sources=.</span><br><span class="line">sonar.java.binaries=./target/classes</span><br><span class="line">sonar.exclusions=**/test<span class="comment">/**,**/</span>target<span class="comment">/**</span></span><br><span class="line"><span class="comment">sonar.java.source=1.8</span></span><br><span class="line"><span class="comment">sonar.java.target=1.8</span></span><br><span class="line"><span class="comment">sonar.sourceEncoding=UTF-8</span></span><br></pre></td></tr></table></figure><img src="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="/yyg/f0979e05/20.png" title="img"> <img src="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="/yyg/f0979e05/21.png" title="img"><h4 id="流水线任务添加SonarQube代码审查"><a href="#流水线任务添加SonarQube代码审查" class="headerlink" title="流水线任务添加SonarQube代码审查"></a><strong>流水线任务添加SonarQube代码审查</strong></h4><p>（1）在项目根目录下，创建sonar-project.properties，写入以下内容。</p><figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">sonar.projectKey=Pipeline-demo</span><br><span class="line">sonar.projectName=Pipeline-demo</span><br><span class="line">sonar.projectVersion=<span class="number">1.0</span></span><br><span class="line">sonar.sources=.</span><br><span class="line">sonar.java.binaries=./target/classes</span><br><span class="line">sonar.exclusions=**/test<span class="comment">/**,**/</span>target<span class="comment">/**</span></span><br><span class="line"><span class="comment">sonar.java.source=1.8</span></span><br><span class="line"><span class="comment">sonar.java.target=1.8</span></span><br><span class="line"><span class="comment">sonar.sourceEncoding=UTF-8</span></span><br></pre></td></tr></table></figure><p>（2）在Jenkinsfile的stages前，引入在Jenkins中安装的SonarQube Scanner作为预置环境变量，之后在拉取代码步骤后，添加审查代码的步骤。</p><figure class="highlight groovy"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br></pre></td><td class="code"><pre><span class="line">pipeline &#123;</span><br><span class="line">    agent any</span><br><span class="line">     environment &#123;</span><br><span class="line">         <span class="comment">//引入在Jenkins中安装的SonarQube Scanner</span></span><br><span class="line">        scannerHome = tool <span class="string">&#x27;sonar-scanner-jenkins&#x27;</span></span><br><span class="line">            &#125;</span><br><span class="line">    stages &#123;</span><br><span class="line">        stage(<span class="string">&#x27;拉取代码&#x27;</span>) &#123;</span><br><span class="line">            steps &#123;</span><br><span class="line">                checkout scmGit(<span class="attr">branches:</span> [[<span class="attr">name:</span> <span class="string">&#x27;*/master&#x27;</span>]], <span class="attr">extensions:</span> [], <span class="attr">userRemoteConfigs:</span> [[<span class="attr">credentialsId:</span> <span class="string">&#x27;fbf87557-40b6-468a-91c5-2cfa1b2e33e8&#x27;</span>, <span class="attr">url:</span> <span class="string">&#x27;http://192.168.1.121:82/test/test_war_demo.git&#x27;</span>]])</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">        stage(<span class="string">&#x27;审查代码&#x27;</span>) &#123;</span><br><span class="line">            steps &#123; </span><br><span class="line">                    <span class="comment">//引入在Jenkins中配置的SonarQube服务器设置</span></span><br><span class="line">                withSonarQubeEnv(<span class="string">&#x27;SonarQube-jenkins&#x27;</span>) &#123;</span><br><span class="line">                    sh <span class="string">&#x27;$&#123;scannerHome&#125;/bin/sonar-scanner&#x27;</span></span><br><span class="line">                    &#125;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">        stage(<span class="string">&#x27;编译构建&#x27;</span>) &#123;</span><br><span class="line">            steps &#123;</span><br><span class="line">                sh <span class="string">&#x27;mvn clean package&#x27;</span></span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">        stage(<span class="string">&#x27;发布项目&#x27;</span>) &#123;</span><br><span class="line">            steps &#123;</span><br><span class="line">                deploy <span class="attr">adapters:</span> [tomcat9(<span class="attr">credentialsId:</span> <span class="string">&#x27;4d9b76aa-078c-462b-81f1-33fe1d9c971c&#x27;</span>, <span class="attr">path:</span> <span class="string">&#x27;&#x27;</span>, <span class="attr">url:</span> <span class="string">&#x27;http://192.168.1.125:8080/&#x27;</span>)], <span class="attr">contextPath:</span> <span class="literal">null</span>, <span class="attr">war:</span> <span class="string">&#x27;target/*.war&#x27;</span></span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    post &#123;</span><br><span class="line">        always &#123;</span><br><span class="line">            emailext(</span><br><span class="line">                <span class="symbol">subject:</span> <span class="string">&#x27;构建通知：$&#123;PROJECT_NAME&#125; - Build # $&#123;BUILD_NUMBER&#125; - $&#123;BUILD_STATUS&#125;!&#x27;</span>,</span><br><span class="line">                <span class="symbol">body:</span> <span class="string">&#x27;$&#123;FILE,path=&quot;email.html&quot;&#125;&#x27;</span>,</span><br><span class="line">                <span class="symbol">to:</span> <span class="string">&#x27;邮箱地址&#x27;</span></span><br><span class="line">            )</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>（3）代码完成变更后，在流水线任务执行完成，在SonarQube里查看代码分析结果。</p><img src="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="/yyg/f0979e05/22.png" title="img"><h2 id="应用案例"><a href="#应用案例" class="headerlink" title="应用案例"></a>应用案例</h2><blockquote><p>该应用案例参考来源于b站up主，’’涣沷a靑惷’’，原文链接为： <a target="_blank" rel="noopener" href="https://www.yuque.com/huanfqc/jenkins/jenkins。">https://www.yuque.com/huanfqc/jenkins/jenkins。</a></p></blockquote><p>使用Jenkins+GitLab+Docker+SonarQube，在192.168.1.125上部署若依的springboot前后端分离项目。</p><h3 id="环境准备"><a href="#环境准备" class="headerlink" title="环境准备"></a>环境准备</h3><p>设置Jenkins服务器免密登录192.168.1.125</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">ssh-copy-id -i /root/.ssh/id_rsa.pub root@192.168.1.125</span><br></pre></td></tr></table></figure><h4 id="安装docker"><a href="#安装docker" class="headerlink" title="安装docker"></a>安装docker</h4><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">bash &lt;(curl -sSL https://linuxmirrors.cn/docker.sh)</span><br><span class="line"><span class="meta prompt_">#</span><span class="language-bash">修改镜像源和默认配置文件路径</span></span><br><span class="line">vi /etc/docker/daemon.json</span><br><span class="line">&#123;</span><br><span class="line">  &quot;data-root&quot;: &quot;/data/dockerData&quot;,</span><br><span class="line">  &quot;registry-mirrors&quot;: [</span><br><span class="line">        &quot;https://docker.1ms.run&quot;,</span><br><span class="line">        &quot;https://docker.xuanyuan.me&quot;</span><br><span class="line">    ]</span><br><span class="line">&#125;</span><br><span class="line"><span class="meta prompt_">#</span><span class="language-bash">启动docker</span></span><br><span class="line">systemctl start docker</span><br><span class="line">systemctl enable docker</span><br></pre></td></tr></table></figure><h4 id="获取并修改源码配置"><a href="#获取并修改源码配置" class="headerlink" title="获取并修改源码配置"></a>获取并修改源码配置</h4><p>（1）拉取若依项目源码到本地，并将ruoyi-ui目录与RuoYi-Vue项目放置在同一级</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">git clone https://gitee.com/y_project/RuoYi-Vue.git</span><br></pre></td></tr></table></figure><img src="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="/yyg/f0979e05/23.png" title="img"><p>（2）修改<code>ruoyi-ui</code>目录中的<code>vue.config.js</code>文件，将<code>localhost</code>修改为部署主机的ip，即192.168.1.125。</p><figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">#修改前</span><br><span class="line">const baseUrl = &#x27;http<span class="punctuation">:</span><span class="comment">//localhost:8080&#x27; // 后端接口</span></span><br><span class="line">#修改后</span><br><span class="line">const baseUrl = &#x27;http<span class="punctuation">:</span><span class="comment">//192.168.1.125:8080&#x27; // 后端接口</span></span><br></pre></td></tr></table></figure><p>（3）修改<code>RuoYi-Vue\ruoyi-admin\src\main\resources\application.yml</code>文件，将redis配置的ip改为192.168.1.125。</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"># redis 配置</span><br><span class="line">redis:</span><br><span class="line">  # 地址</span><br><span class="line">  host: 192.168.1.125</span><br></pre></td></tr></table></figure><p>（4）修改<code>RuoYi-Vue\ruoyi-admin\src\main\resources\application-druid.yml</code>文件，将mysql的链接地址改为192.168.1.125。</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"># 主库数据源</span><br><span class="line">           master:</span><br><span class="line">               url: jdbc:mysql://192.168.1.125:3306/ry-vue?useUnicode=true&amp;characterEncoding=utf8&amp;zeroDateTimeBehavior=convertToNull&amp;useSSL=true&amp;serverTimezone=GMT%2B8</span><br><span class="line">             </span><br></pre></td></tr></table></figure><p>（5）在ruoyi-ui目录下，创建sonar-project.properties，写入以下内容，添加SonarQube代码审查</p><figure class="highlight groovy"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">sonar.projectKey=ruoyi-ui</span><br><span class="line">sonar.projectName=ruoyi-ui</span><br><span class="line">sonar.projectVersion=<span class="number">1.0</span></span><br><span class="line">sonar.sources=.</span><br><span class="line">sonar.sourceEncoding=UTF<span class="number">-8</span></span><br></pre></td></tr></table></figure><p>（6）在ruoyi-ui目录下创建前端项目的Jenkinsfile文件</p><figure class="highlight groovy"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br></pre></td><td class="code"><pre><span class="line">pipeline &#123;</span><br><span class="line">    agent any</span><br><span class="line">     environment &#123;</span><br><span class="line">         <span class="comment">//引入在Jenkins中安装的SonarQube Scanner</span></span><br><span class="line">        scannerHome = tool <span class="string">&#x27;sonar-scanner-jenkins&#x27;</span></span><br><span class="line">            &#125;</span><br><span class="line">    stages &#123;</span><br><span class="line">        stage(<span class="string">&#x27;拉取代码&#x27;</span>) &#123;</span><br><span class="line">            steps &#123;</span><br><span class="line">                checkout scmGit(<span class="attr">branches:</span> [[<span class="attr">name:</span> <span class="string">&#x27;*/master&#x27;</span>]], <span class="attr">extensions:</span> [], <span class="attr">userRemoteConfigs:</span> [[<span class="attr">credentialsId:</span> <span class="string">&#x27;fbf87557-40b6-468a-91c5-2cfa1b2e33e8&#x27;</span>, <span class="attr">url:</span> <span class="string">&#x27;http://192.168.1.121:82/test/ruoyi-ui.git&#x27;</span>]])</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">        stage(<span class="string">&#x27;审查代码&#x27;</span>) &#123;</span><br><span class="line">            steps &#123; </span><br><span class="line">                    <span class="comment">//引入在Jenkins中配置的SonarQube服务器设置</span></span><br><span class="line">                withSonarQubeEnv(<span class="string">&#x27;SonarQube-jenkins&#x27;</span>) &#123;</span><br><span class="line">                    sh <span class="string">&#x27;$&#123;scannerHome&#125;/bin/sonar-scanner&#x27;</span></span><br><span class="line">                    &#125;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">               stage(<span class="string">&#x27;打包，部署网站&#x27;</span>) &#123;</span><br><span class="line">		  steps &#123;</span><br><span class="line">		    script &#123;</span><br><span class="line">			    nodejs(<span class="attr">nodeJSInstallationName:</span> <span class="string">&#x27;nodejs14&#x27;</span>) &#123;</span><br><span class="line">                              sh <span class="string">&#x27;&#x27;&#x27;</span></span><br><span class="line"><span class="string">                npm install</span></span><br><span class="line"><span class="string">                # 构建生产环境</span></span><br><span class="line"><span class="string">                npm run build:prod</span></span><br><span class="line"><span class="string">            &#x27;&#x27;&#x27;</span></span><br><span class="line">               &#125;</span><br><span class="line">			    <span class="comment">// 将构建产物部署到 Nginx 容器挂载的目录</span></span><br><span class="line">          sh <span class="string">&#x27;&#x27;&#x27;</span></span><br><span class="line"><span class="string">            </span></span><br><span class="line"><span class="string">            # 将整个 dist 目录复制到挂载目录</span></span><br><span class="line"><span class="string">            scp -r dist 192.168.1.125:/data/ruoyi/nginx/html/</span></span><br><span class="line"><span class="string">            ssh 192.168.1.125 docker restart nginx</span></span><br><span class="line"><span class="string">        &#x27;&#x27;&#x27;</span></span><br><span class="line">			   </span><br><span class="line">			&#125;</span><br><span class="line">		  &#125;</span><br><span class="line">       </span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure><p>7）在RuoYi-Vue目录下，创建sonar-project.properties，写入以下内容，添加SonarQube代码审查</p><figure class="highlight groovy"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">sonar.projectKey=ruoyi-api</span><br><span class="line">sonar.projectName=ruoyi-api</span><br><span class="line">sonar.projectVersion=<span class="number">1.0</span></span><br><span class="line">sonar.sources=.</span><br><span class="line">sonar.java.binaries=.<span class="regexp">/ruoyi-admin/</span>target/classes</span><br><span class="line">sonar.exclusions=**<span class="regexp">/test/</span>**,**<span class="regexp">/target/</span>**</span><br><span class="line">sonar.java.source=<span class="number">1.8</span></span><br><span class="line">sonar.java.target=<span class="number">1.8</span></span><br><span class="line">sonar.sourceEncoding=UTF<span class="number">-8</span></span><br></pre></td></tr></table></figure><p>（8）在RuoYi-Vue目录下创建后端项目的Jenkinsfile文件</p><figure class="highlight groovy"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br></pre></td><td class="code"><pre><span class="line">pipeline &#123;</span><br><span class="line">    agent any</span><br><span class="line">    environment &#123;</span><br><span class="line">         <span class="comment">//引入在Jenkins中安装的SonarQube Scanner</span></span><br><span class="line">        scannerHome = tool <span class="string">&#x27;sonar-scanner-jenkins&#x27;</span></span><br><span class="line">            &#125;</span><br><span class="line">    stages &#123;</span><br><span class="line">        stage(<span class="string">&#x27;拉取代码&#x27;</span>) &#123;</span><br><span class="line">            steps &#123;</span><br><span class="line">                checkout scmGit(<span class="attr">branches:</span> [[<span class="attr">name:</span> <span class="string">&#x27;*/master&#x27;</span>]], <span class="attr">extensions:</span> [], <span class="attr">userRemoteConfigs:</span> [[<span class="attr">credentialsId:</span> <span class="string">&#x27;fbf87557-40b6-468a-91c5-2cfa1b2e33e8&#x27;</span>, <span class="attr">url:</span> <span class="string">&#x27;http://192.168.1.121:82/test/ruoyi-api.git&#x27;</span>]])</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">        stage(<span class="string">&#x27;编译构建&#x27;</span>) &#123;</span><br><span class="line">            steps &#123;</span><br><span class="line">                sh <span class="string">&#x27;mvn clean package&#x27;</span></span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">        stage(<span class="string">&#x27;审查代码&#x27;</span>) &#123;</span><br><span class="line">            steps &#123; </span><br><span class="line">                    <span class="comment">//引入在Jenkins中配置的SonarQube服务器设置</span></span><br><span class="line">                withSonarQubeEnv(<span class="string">&#x27;SonarQube-jenkins&#x27;</span>) &#123;</span><br><span class="line">                    sh <span class="string">&#x27;$&#123;scannerHome&#125;/bin/sonar-scanner&#x27;</span></span><br><span class="line">                    &#125;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">        stage(<span class="string">&#x27;发布项目&#x27;</span>) &#123;</span><br><span class="line">            steps &#123;</span><br><span class="line">                script &#123;</span><br><span class="line">                    sh <span class="string">&#x27;&#x27;&#x27;</span></span><br><span class="line"><span class="string">                       ssh 192.168.1.125  &quot;mkdir -p /data/ruoyi-api&quot;</span></span><br><span class="line"><span class="string">                        scp ruoyi-admin/target/*.jar  192.168.1.125:/data/ruoyi-api/ruoyi.jar</span></span><br><span class="line"><span class="string">                    &#x27;&#x27;&#x27;</span></span><br><span class="line">                    <span class="comment">// 创建Dockerfile</span></span><br><span class="line">                    sh <span class="string">&#x27;&#x27;&#x27;</span></span><br><span class="line"><span class="string">                             ssh 192.168.1.125 &#x27;cat &gt; /data/ruoyi-api/Dockerfile &lt;&lt;-EOF</span></span><br><span class="line"><span class="string">	FROM openjdk:8</span></span><br><span class="line"><span class="string">	MAINTAINER xie</span></span><br><span class="line"><span class="string">	VOLUME /tmp</span></span><br><span class="line"><span class="string">	ADD ruoyi.jar ruoyi.jar</span></span><br><span class="line"><span class="string">	ENTRYPOINT [&quot;java&quot;,&quot;-jar&quot;,&quot;/ruoyi.jar&quot;]</span></span><br><span class="line"><span class="string">	EXPOSE 8080</span></span><br><span class="line"><span class="string">	EOF&#x27;</span></span><br><span class="line"><span class="string">                    &#x27;&#x27;&#x27;</span></span><br><span class="line"></span><br><span class="line">                    <span class="comment">// 构建镜像</span></span><br><span class="line">                    sh <span class="string">&#x27;&#x27;&#x27;</span></span><br><span class="line"><span class="string">                        ssh 192.168.1.125 &quot;docker build -t ruoyi:1.0 /data/ruoyi-api&quot;</span></span><br><span class="line"><span class="string">                    &#x27;&#x27;&#x27;</span></span><br><span class="line"></span><br><span class="line">                    <span class="comment">// 停止并删除现有的容器</span></span><br><span class="line">                    sh <span class="string">&#x27;&#x27;&#x27;</span></span><br><span class="line"><span class="string">                        EXISTING_CONTAINER=$(ssh 192.168.1.125 &quot;docker ps -a -q -f name=ruoyi&quot;)</span></span><br><span class="line"><span class="string">                        if [ -n &quot;$EXISTING_CONTAINER&quot; ]; then</span></span><br><span class="line"><span class="string">                            echo &quot;容器 &#x27;ruoyi&#x27; 已存在，停止并删除旧容器...&quot;</span></span><br><span class="line"><span class="string">                           ssh 192.168.1.125 &quot;docker rm -f $EXISTING_CONTAINER&quot;</span></span><br><span class="line"><span class="string">                        fi</span></span><br><span class="line"><span class="string">                    &#x27;&#x27;&#x27;</span></span><br><span class="line"></span><br><span class="line">                    <span class="comment">// 运行新的容器</span></span><br><span class="line">                    sh <span class="string">&#x27;&#x27;&#x27;</span></span><br><span class="line"><span class="string">                       ssh 192.168.1.125 &quot;docker run -d --name ruoyi -p 8080:8080 ruoyi:1.0&quot;</span></span><br><span class="line"><span class="string">                    &#x27;&#x27;&#x27;</span></span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h4 id="部署项目所需容器"><a href="#部署项目所需容器" class="headerlink" title="部署项目所需容器"></a>部署项目所需容器</h4><p>该项目中要用到nginx、mysql和redis，需提前部署好容器。对应容器版本为nginx:1.18.0、mysql:8.0.19、redis:6.0.8</p><p>（1）创建所需目录</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">mkdir -p /data/ruoyi</span><br><span class="line">mkdir -p /data/ruoyi/nginx/conf</span><br><span class="line">mkdir -p /data/ruoyi/mysql/db</span><br></pre></td></tr></table></figure><p>（2）创建nginx临时容器，修改配置文件</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">docker run --rm -v /data/ruoyi/nginx/conf:/backup nginx:1.18.0 \</span><br><span class="line">  sh -c &quot;cp -r /etc/nginx/. /backup&quot;</span><br></pre></td></tr></table></figure><p>修改<code>/data/ruoyi/nginx/conf/conf.d</code>中的default.conf文件</p><figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br></pre></td><td class="code"><pre><span class="line"><span class="string">server</span> &#123;</span><br><span class="line">    <span class="string">listen</span> <span class="number">80</span><span class="string">;</span></span><br><span class="line"></span><br><span class="line">    <span class="string">proxy_set_header</span> <span class="string">Host</span> <span class="string">$http_host;</span></span><br><span class="line">    <span class="string">proxy_set_header</span> <span class="string">X-Real-IP</span> <span class="string">$remote_addr;</span></span><br><span class="line">    <span class="string">proxy_set_header</span> <span class="string">X-Forwarded-For</span> <span class="string">$proxy_add_x_forwarded_for;</span></span><br><span class="line">    <span class="string">proxy_set_header</span> <span class="string">REMOTE-HOST</span> <span class="string">$remote_addr;</span></span><br><span class="line"></span><br><span class="line">    <span class="string">server_name</span> <span class="string">localhost;</span></span><br><span class="line"></span><br><span class="line">    <span class="string">location</span> <span class="string">/</span> &#123;</span><br><span class="line">        <span class="string">root</span> <span class="string">/usr/share/nginx/html/dist;</span></span><br><span class="line">        <span class="string">index</span> <span class="string">index.html</span> <span class="string">index.htm;</span></span><br><span class="line">        <span class="string">try_files</span> <span class="string">$uri</span> <span class="string">/index.html;</span></span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="string">location</span> <span class="string">/prod-api/</span> &#123;</span><br><span class="line">        <span class="string">proxy_set_header</span> <span class="string">Host</span> <span class="string">$http_host;</span></span><br><span class="line">        <span class="string">proxy_set_header</span> <span class="string">X-Real-IP</span> <span class="string">$remote_addr;</span></span><br><span class="line">        <span class="string">proxy_set_header</span> <span class="string">REMOTE-HOST</span> <span class="string">$remote_addr;</span></span><br><span class="line">        <span class="string">proxy_set_header</span> <span class="string">X-Forwarded-For</span> <span class="string">$proxy_add_x_forwarded_for;</span></span><br><span class="line">        <span class="string">proxy_pass</span> <span class="string">http://192.168.1.125:8080/;</span>   <span class="comment">#注意修改ip</span></span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="string">if</span> <span class="string">($request_uri</span> <span class="string">~</span> <span class="string">&quot;/actuator&quot;</span><span class="string">)</span> &#123;</span><br><span class="line">        <span class="string">return</span> <span class="number">403</span><span class="string">;</span></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure><p>（3）将<code>RuoYi-Vue\sql</code>中的sql文件，拷贝到192.168.1.125主机的<code>/data/ruoyi/mysql/db</code>目录</p><p>（4）撰写yml，使用docker compose编排部署容器</p><figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#撰写yml文件</span></span><br><span class="line"><span class="string">vi</span> <span class="string">ruoyi.yml</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="attr">services:</span></span><br><span class="line">  <span class="attr">nginx:</span></span><br><span class="line">    <span class="attr">image:</span> <span class="string">nginx:1.18.0</span></span><br><span class="line">    <span class="attr">container_name:</span> <span class="string">nginx</span></span><br><span class="line">    <span class="attr">restart:</span> <span class="string">always</span></span><br><span class="line">    <span class="attr">volumes:</span></span><br><span class="line">      <span class="bullet">-</span> <span class="string">/data/ruoyi/nginx/conf:/etc/nginx</span></span><br><span class="line">      <span class="bullet">-</span> <span class="string">/data/ruoyi/nginx/logs:/var/log/nginx</span></span><br><span class="line">      <span class="bullet">-</span> <span class="string">/data/ruoyi/nginx/html:/usr/share/nginx/html</span></span><br><span class="line">    <span class="attr">environment:</span></span><br><span class="line">      <span class="attr">TZ:</span> <span class="string">&quot;Asia/Shanghai&quot;</span></span><br><span class="line">    <span class="attr">ports:</span></span><br><span class="line">      <span class="bullet">-</span> <span class="string">&quot;80:80&quot;</span></span><br><span class="line">    <span class="attr">networks:</span></span><br><span class="line">      <span class="attr">ruoyi:</span></span><br><span class="line">        <span class="attr">ipv4_address:</span> <span class="number">172.20</span><span class="number">.112</span><span class="number">.11</span></span><br><span class="line">  <span class="attr">mysql:</span></span><br><span class="line">    <span class="attr">container_name:</span> <span class="string">mysql</span></span><br><span class="line">    <span class="attr">image:</span> <span class="string">mysql:8.0.19</span></span><br><span class="line">    <span class="attr">restart:</span> <span class="string">always</span></span><br><span class="line">    <span class="attr">environment:</span></span><br><span class="line">      <span class="attr">MYSQL_ROOT_PASSWORD:</span> <span class="string">&quot;password&quot;</span></span><br><span class="line">      <span class="attr">MYSQL_ALLOW_EMPTY_PASSWORD:</span> <span class="string">&quot;no&quot;</span></span><br><span class="line">      <span class="attr">MYSQL_DATABASE:</span> <span class="string">&quot;ry-vue&quot;</span></span><br><span class="line">      <span class="attr">TZ:</span> <span class="string">&quot;Asia/Shanghai&quot;</span></span><br><span class="line">    <span class="attr">ports:</span></span><br><span class="line">      <span class="bullet">-</span> <span class="string">&quot;3306:3306&quot;</span></span><br><span class="line">    <span class="attr">volumes:</span></span><br><span class="line">      <span class="bullet">-</span> <span class="string">/data/ruoyi/mysql/db:/var/lib/mysql</span></span><br><span class="line">      <span class="bullet">-</span> <span class="string">/data/ruoyi/mysql/conf:/etc/my.cnf</span></span><br><span class="line">      <span class="bullet">-</span> <span class="string">/data/ruoyi/mysql/init:/docker-entrypoint-initdb.d</span></span><br><span class="line">    <span class="attr">command:</span> <span class="string">--default-authentication-plugin=mysql_native_password</span></span><br><span class="line">    <span class="attr">networks:</span></span><br><span class="line">      <span class="attr">ruoyi:</span></span><br><span class="line">        <span class="attr">ipv4_address:</span> <span class="number">172.20</span><span class="number">.112</span><span class="number">.12</span></span><br><span class="line">  <span class="attr">redis:</span></span><br><span class="line">    <span class="attr">container_name:</span> <span class="string">redis</span></span><br><span class="line">    <span class="attr">image:</span> <span class="string">redis:6.0.8</span></span><br><span class="line">    <span class="attr">restart:</span> <span class="string">always</span></span><br><span class="line">    <span class="attr">environment:</span></span><br><span class="line">      <span class="attr">TZ:</span> <span class="string">&quot;Asia/Shanghai&quot;</span></span><br><span class="line">    <span class="attr">ports:</span></span><br><span class="line">      <span class="bullet">-</span> <span class="string">&quot;6379:6379&quot;</span></span><br><span class="line">    <span class="attr">volumes:</span></span><br><span class="line">      <span class="bullet">-</span> <span class="string">/data/ruoyi/redis/conf:/etc/redis/redis.conf</span></span><br><span class="line">      <span class="bullet">-</span> <span class="string">/data/ruoyi/redis/data:/data</span></span><br><span class="line">    <span class="attr">command:</span> <span class="string">redis-server</span> <span class="string">/etc/redis/redis.conf</span></span><br><span class="line">    <span class="attr">networks:</span></span><br><span class="line">      <span class="attr">ruoyi:</span></span><br><span class="line">        <span class="attr">ipv4_address:</span> <span class="number">172.20</span><span class="number">.112</span><span class="number">.13</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="attr">networks:</span></span><br><span class="line"> <span class="attr">ruoyi:</span></span><br><span class="line">  <span class="attr">driver:</span> <span class="string">bridge</span></span><br><span class="line">  <span class="attr">ipam:</span></span><br><span class="line">   <span class="attr">config:</span></span><br><span class="line">    <span class="bullet">-</span> <span class="attr">subnet:</span> <span class="number">172.20</span><span class="number">.112</span><span class="number">.0</span><span class="string">/24</span></span><br></pre></td></tr></table></figure><p>（5）执行命令创建容器</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">docker compose -f ruoyi.yml up -d</span><br><span class="line"><span class="meta prompt_">#</span><span class="language-bash">查看容器运行状态</span></span><br><span class="line">docker ps</span><br><span class="line"><span class="meta prompt_">#</span><span class="language-bash">导入数据库</span></span><br><span class="line">docker exec -it mysql bash</span><br><span class="line">mysql -u root -ppassword ry-vue &lt; /var/lib/mysql/ry_20250417.sql</span><br><span class="line">mysql -u root -ppassword ry-vue &lt; /var/lib/mysql/quartz.sql</span><br></pre></td></tr></table></figure><h4 id="上传代码到GitLab"><a href="#上传代码到GitLab" class="headerlink" title="上传代码到GitLab"></a>上传代码到GitLab</h4><p>（1）创建ruoyi-ui和ruoyi-api两个仓库分别存放前端和后端代码</p><p>（2）在ruoyi-ui目录下，打开cmd，输入命令上传代码</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">git init</span><br><span class="line">git remote add origin http://192.168.1.121:82/test/ruoyi-ui.git</span><br><span class="line"><span class="meta prompt_">#</span><span class="language-bash">添加该目录下的git权限配置</span></span><br><span class="line">git config  user.name &quot;test1&quot;</span><br><span class="line">git config  user.email &quot;test1@gitlab&quot;</span><br><span class="line"><span class="meta prompt_">#</span><span class="language-bash">继续上传</span></span><br><span class="line">git add .</span><br><span class="line">git commit -m &quot;ruoyi-ui&quot;</span><br><span class="line">git push -u origin master</span><br></pre></td></tr></table></figure><p>（3）在<code>RuoYi-Vue</code>目录下，打开cmd，输入命令上传代码</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">git init</span><br><span class="line">git remote add origin http://192.168.1.121:82/test/ruoyi-api.git</span><br><span class="line"><span class="meta prompt_">#</span><span class="language-bash">添加该目录下的git权限配置</span></span><br><span class="line">git config  user.name &quot;test1&quot;</span><br><span class="line">git config  user.email &quot;test1@gitlab&quot;</span><br><span class="line"><span class="meta prompt_">#</span><span class="language-bash">继续上传</span></span><br><span class="line">git add .</span><br><span class="line">git commit -m &quot;ruoyi-api&quot;</span><br><span class="line">git push -u origin master</span><br></pre></td></tr></table></figure><h4 id="配置Jenkins流水线"><a href="#配置Jenkins流水线" class="headerlink" title="配置Jenkins流水线"></a>配置Jenkins流水线</h4><p>（1）安装nodejs和NodeJS插件</p><p>在jenkins服务器上安装nodejs</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line">wget https://nodejs.org/dist/latest-fermium/node-v14.21.3-linux-x64.tar.gz</span><br><span class="line">tar -vxzf node-v14.21.3-linux-x64.tar.gz  -C /opt</span><br><span class="line">mv /opt/node-v14.21.3-linux-x64 /opt/nodejs</span><br><span class="line"><span class="meta prompt_">#</span><span class="language-bash">配置环境变量</span></span><br><span class="line">echo &quot;</span><br><span class="line">export NODE_HOME=/opt/nodejs</span><br><span class="line">export PATH=$NODE_HOME/bin:$PATH&quot; &gt;&gt; /etc/profile</span><br><span class="line"><span class="meta prompt_">#</span><span class="language-bash">变量生效</span></span><br><span class="line"> source /etc/profile</span><br><span class="line"><span class="meta prompt_">#</span><span class="language-bash">查看版版本</span></span><br><span class="line">node -v</span><br><span class="line">npm -v</span><br><span class="line"><span class="meta prompt_">#</span><span class="language-bash">配置镜像源</span></span><br><span class="line">npm config set registry https://registry.npmmirror.com</span><br><span class="line">npm config set sass_binary_site=https://npm.taobao.org/mirrors/node-sass</span><br></pre></td></tr></table></figure><p>（2）配置NodeJS设置</p><p>在<code>Manage Jenkins</code> -<code>Tools</code>-NodeJS 安装中，点击<code>新增NodeJS</code>，填写nodejs的名称为<code>nodejs14</code>,输入在服务器安装的nodejs路径<code>/opt/nodejs</code>，保存应用。</p><p>（3）创建<code>ruoyi-ui</code>流水线任务，在流水线-定义中选择<code>Pipeline script from SCM</code>，SCM选择<code>Git</code>，填写ruoyi-ui的git仓库地址和登录凭证，其他选项保持默认，保存应用。</p><p>（4）点击<code>Build Now</code>，等待任务执行完成。在浏览器中访问<code>http://192.168.1.125/</code>，查看前端部署情况。</p><img src="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="/yyg/f0979e05/24.png" title="img"><p>（5）创建<code>ruoyi-api</code>流水线任务，在流水线-定义中选择<code>Pipeline script from SCM</code>，SCM选择<code>Git</code>，填写ruoyi-api的git仓库地址和登录凭证，其他选项保持默认，保存应用。</p><p>（6）点击<code>Build Now</code>，等待任务执行完成。在浏览器中访问<code>http://192.168.1.125/</code>，可正常登录，即为成功。</p><img src="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="/yyg/f0979e05/25.png" title="img"><p>（7）访问sonarQube，分别查看前后端代码的具体质量审查情况。</p><img src="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="/yyg/f0979e05/26.png" title="img"><blockquote><p>本篇知识来源于B站视频BV1pF411Y7tq</p></blockquote></article><div class="post-copyright"><div class="post-copyright__author"><span class="post-copyright-meta"><i class="fas fa-circle-user fa-fw"></i>文章作者:</span> <span class="post-copyright-info"><a href="https://yyg.js.cool/">云野阁</a></span></div><div class="post-copyright__type"><span class="post-copyright-meta"><i class="fas fa-square-arrow-up-right fa-fw"></i>文章链接:</span> <span class="post-copyright-info"><a href="https://yyg.js.cool/yyg/f0979e05/">https://yyg.js.cool/yyg/f0979e05/</a></span></div><div class="post-copyright__notice"><span class="post-copyright-meta"><i class="fas fa-circle-exclamation fa-fw"></i>版权声明:</span> <span class="post-copyright-info">本博客所有文章除特别声明外，均采用 <a href="https://creativecommons.org/licenses/by-nc-sa/4.0/" target="_blank">CC BY-NC-SA 4.0</a> 许可协议。转载请注明来源 <a href="https://yyg.js.cool" target="_blank">云野阁</a>！</span></div></div><div class="tag_share"><div class="post-meta__tag-list"><a class="post-meta__tags" href="/tags/%E7%9F%A5%E8%AF%86%E6%A2%B3%E7%90%86/">知识梳理</a><a class="post-meta__tags" href="/tags/CI-CD/">CI/CD</a><a class="post-meta__tags" href="/tags/%E8%87%AA%E5%8A%A8%E5%8C%96%E8%BF%90%E7%BB%B4/">自动化运维</a><a class="post-meta__tags" href="/tags/GitLab/">GitLab</a><a class="post-meta__tags" href="/tags/Jenkins/">Jenkins</a><a class="post-meta__tags" href="/tags/Linux%E8%BF%90%E7%BB%B4/">Linux运维</a><a class="post-meta__tags" href="/tags/SonarQube/">SonarQube</a></div><div class="post-share"><div class="social-share" data-image="https://picapi.pai.al/api/scenery.php" data-sites="facebook,x,wechat,weibo,qq"></div><link rel="stylesheet" href="https://s4.zstatic.net/ajax/libs/butterfly-extsrc/1.1.4/sharejs/dist/css/share.min.css" media="print" onload='this.media="all"'><script src="https://s4.zstatic.net/ajax/libs/butterfly-extsrc/1.1.4/sharejs/dist/js/social-share.min.js" defer></script></div></div><nav class="pagination-post" id="pagination"><a class="pagination-related" href="/yyg/10ac2e4/" title="Ansible最新版安装"><img class="cover" src="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://api.vvhan.com/api/wallpaper/views" onerror='onerror=null,src="/img/404.jpg"' alt="cover of previous post"><div class="info"><div class="info-1"><div class="info-item-1">上一篇</div><div class="info-item-2">Ansible最新版安装</div></div><div class="info-2"><div class="info-item-1">pip方式安装基础环境准备（1）安装软件依赖 1yum install -y zlib zlib-dev zlib-devel sqlite-devel openssl-devel bzip2-devel libffi libff...</div></div></div></a><a class="pagination-related" href="/yyg/dc35290c/" title="Kubernetes知识梳理-核心组件"><img class="cover" src="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://tu.ltyuanfang.cn/api/fengjing.php" onerror='onerror=null,src="/img/404.jpg"' alt="cover of next post"><div class="info text-right"><div class="info-1"><div class="info-item-1">下一篇</div><div class="info-item-2">Kubernetes知识梳理-核心组件</div></div><div class="info-2"><div class="info-item-1">pod在kubernetes中基本所有资源的一级属性都是一样的，主要包含5部分： apiVersion &lt;string&gt; 版本，由kubernetes内部定义，版本号必须可以用kubectl api-versions查询...</div></div></div></a></nav><div class="relatedPosts"><div class="headline"><i class="fas fa-thumbs-up fa-fw"></i><span>相关推荐</span></div><div class="relatedPosts-list"><a class="pagination-related" href="/yyg/e80721f/" title="Ansible知识梳理"><img class="cover" src="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://imgapi.cn/api.php?fl=fengjing&gs=images" alt="cover"><div class="info text-center"><div class="info-1"><div class="info-item-1"><i class="far fa-calendar-alt fa-fw"></i> 2025-03-31</div><div class="info-item-2">Ansible知识梳理</div></div><div class="info-2"><div class="info-item-1">🔜什么是Ansible？🔚 Ansible 是一款 IT 自动化工具。主要应用场景有配置系统、软件部署、持续发布及不停服平滑滚动更新的高级任务编排。Ansible 提供...</div></div></div></a><a class="pagination-related" href="/yyg/10ac2e4/" title="Ansible最新版安装"><img class="cover" src="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://api.vvhan.com/api/wallpaper/views" alt="cover"><div class="info text-center"><div class="info-1"><div class="info-item-1"><i class="far fa-calendar-alt fa-fw"></i> 2025-04-12</div><div class="info-item-2">Ansible最新版安装</div></div><div class="info-2"><div class="info-item-1">pip方式安装基础环境准备（1）安装软件依赖 1yum install -y zlib zlib-dev zlib-devel sqlite-devel openssl-devel bzip2-devel libffi libff...</div></div></div></a><a class="pagination-related no-desc" href="/yyg/5c56de6f/" title="docker知识梳理"><img class="cover" src="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://api.jiangyuhui.top/aliyun/randomCover" alt="cover"><div class="info text-center"><div class="info-1"><div class="info-item-1"><i class="far fa-calendar-alt fa-fw"></i> 2024-03-24</div><div class="info-item-2">docker知识梳理</div></div></div></a><a class="pagination-related" href="/yyg/986299a9/" title="k8s知识梳理--进阶"><img class="cover" src="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://api.jiangyuhui.top/aliyun/randomCover" alt="cover"><div class="info text-center"><div class="info-1"><div class="info-item-1"><i class="far fa-calendar-alt fa-fw"></i> 2025-08-22</div><div class="info-item-2">k8s知识梳理--进阶</div></div><div class="info-2"><div class="info-item-1">网络Kubernetes-网络模型原则 在不使用网络地址转换(NAT)的情况下，集群中的Pod能够与任意其他Pod进行通信 在不使用网络地址转换(NAT)的情况下，在集群节点上运行的程序能与同一节点上的任何Pod进行通信 每个Pod都...</div></div></div></a><a class="pagination-related no-desc" href="/yyg/f5a7a3df/" title="Kubernetes知识梳理"><img class="cover" src="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://picapi.pai.al/api/scenery.php" alt="cover"><div class="info text-center"><div class="info-1"><div class="info-item-1"><i class="far fa-calendar-alt fa-fw"></i> 2024-03-24</div><div class="info-item-2">Kubernetes知识梳理</div></div></div></a><a class="pagination-related" href="/yyg/3b57c0c6/" title="docker容器日志配置管理"><img class="cover" src="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://picapi.pai.al/api/scenery.php" alt="cover"><div class="info text-center"><div class="info-1"><div class="info-item-1"><i class="far fa-calendar-alt fa-fw"></i> 2024-08-07</div><div class="info-item-2">docker容器日志配置管理</div></div><div class="info-2"><div class="info-item-1">运行的项目容器突然就停了，查看容器日志发现磁盘空间不足，导致容器没法运行了。 Error response from daemon: Cannot restart container docker-p: mkdir /home/do...</div></div></div></a></div></div><hr class="custom-hr"><div id="post-comment"><div class="comment-head"><div class="comment-headline"><i class="fas fa-comments fa-fw"></i> <span>评论</span></div><div class="comment-switch"><span class="first-comment">Giscus</span><span id="switch-btn"></span><span class="second-comment">Utterances</span></div></div><div class="comment-wrap"><div><div id="giscus-wrap"></div></div><div><div id="utterances-wrap"></div></div></div></div></div><div class="aside-content" id="aside-content"><div class="card-widget card-info text-center"><div class="avatar-img"><img src="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="/img/icon.png" onerror='this.onerror=null,this.src="/img/friend_404.gif"' alt="avatar"></div><div class="author-info-name">云野阁</div><div class="author-info-description">闲云野鹤，八方逍遥</div><div class="site-data"><a href="/archives/"><div class="headline">文章</div><div class="length-num">62</div></a><a href="/tags/"><div class="headline">标签</div><div class="length-num">109</div></a><a href="/categories/"><div class="headline">分类</div><div class="length-num">37</div></a></div><div class="card-info-social-icons"><a class="social-icon" href="https://github.com/MarsperL" target="_blank" title="Github"><i class="fab fa-github" style="color:#24292e"></i></a><a class="social-icon" href="mailto:eXlnbGlAZm94bWFpbC5jb20=" target="_blank" title="Email"><i class="fas fa-envelope" style="color:#4a7dbe"></i></a><a class="social-icon" href="/rss2.xml" target="_blank"><i class="fas fa-rss"></i></a></div></div><div class="sticky_layout"><div class="card-widget" id="card-toc"><div class="item-headline"><i class="fas fa-stream"></i><span>目录</span><span class="toc-percentage"></span></div><div class="toc-content"><ol class="toc"><li class="toc-item toc-level-2"><a class="toc-link" href="#%E4%B8%BB%E6%9C%BA%E8%A7%84%E5%88%92"><span class="toc-number">1.</span> <span class="toc-text">主机规划</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E9%83%A8%E7%BD%B2%E6%AD%A5%E9%AA%A4"><span class="toc-number">2.</span> <span class="toc-text">部署步骤</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E9%83%A8%E7%BD%B2GitLab"><span class="toc-number">2.1.</span> <span class="toc-text">部署GitLab</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#%E5%AE%89%E8%A3%85GitLab"><span class="toc-number">2.1.1.</span> <span class="toc-text">安装GitLab</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E7%AE%A1%E7%90%86GitLab"><span class="toc-number">2.1.2.</span> <span class="toc-text">管理GitLab</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E4%B8%8A%E4%BC%A0%E9%A1%B9%E7%9B%AE%E4%BB%A3%E7%A0%81"><span class="toc-number">2.1.3.</span> <span class="toc-text">上传项目代码</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E9%83%A8%E7%BD%B2Jenkins"><span class="toc-number">2.2.</span> <span class="toc-text">部署Jenkins</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#%E9%85%8D%E7%BD%AE%E5%9B%BD%E5%86%85%E6%8F%92%E4%BB%B6%E6%BA%90"><span class="toc-number">2.2.1.</span> <span class="toc-text">配置国内插件源</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E8%AE%BE%E7%BD%AE%E4%B8%AD%E6%96%87"><span class="toc-number">2.2.2.</span> <span class="toc-text">设置中文</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E7%AE%A1%E7%90%86%E7%94%A8%E6%88%B7%E6%9D%83%E9%99%90"><span class="toc-number">2.2.3.</span> <span class="toc-text">管理用户权限</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E5%87%AD%E8%AF%81%E7%AE%A1%E7%90%86"><span class="toc-number">2.2.4.</span> <span class="toc-text">凭证管理</span></a><ol class="toc-child"><li class="toc-item toc-level-5"><a class="toc-link" href="#%E5%AF%86%E7%A0%81%E5%87%AD%E8%AF%81"><span class="toc-number">2.2.4.1.</span> <span class="toc-text">密码凭证</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#SSH%E5%AF%86%E9%92%A5%E5%87%AD%E8%AF%81"><span class="toc-number">2.2.4.2.</span> <span class="toc-text">SSH密钥凭证</span></a></li></ol></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%AE%89%E8%A3%85Maven"><span class="toc-number">2.3.</span> <span class="toc-text">安装Maven</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%AE%89%E8%A3%85Tomcat"><span class="toc-number">2.4.</span> <span class="toc-text">安装Tomcat</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#Jenkins%E6%9E%84%E5%BB%BA%E9%A1%B9%E7%9B%AE"><span class="toc-number">2.5.</span> <span class="toc-text">Jenkins构建项目</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#Jenkins%E6%9E%84%E5%BB%BA%E8%87%AA%E7%94%B1%E9%A3%8E%E6%A0%BC%E9%A1%B9%E7%9B%AE"><span class="toc-number">2.5.1.</span> <span class="toc-text">Jenkins构建自由风格项目</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#Jenkins%E6%9E%84%E5%BB%BAMaven%E9%A1%B9%E7%9B%AE"><span class="toc-number">2.5.2.</span> <span class="toc-text">Jenkins构建Maven项目</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#Jenkins%E6%9E%84%E5%BB%BAPipeline%E6%B5%81%E6%B0%B4%E7%BA%BF%E9%A1%B9%E7%9B%AE"><span class="toc-number">2.5.3.</span> <span class="toc-text">Jenkins构建Pipeline流水线项目</span></a><ol class="toc-child"><li class="toc-item toc-level-5"><a class="toc-link" href="#%E5%9C%A8Jenkins%E7%9A%84Web-Ul%E4%B8%AD%E5%88%9B%E5%BB%BAPipeline%E8%84%9A%E6%9C%AC%E5%8F%91%E5%B8%83%E9%A1%B9%E7%9B%AE"><span class="toc-number">2.5.3.1.</span> <span class="toc-text">在Jenkins的Web Ul中创建Pipeline脚本发布项目</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#%E4%BD%BF%E7%94%A8Jenkinsfile%E8%84%9A%E6%9C%AC%E5%8F%91%E5%B8%83%E9%A1%B9%E7%9B%AE"><span class="toc-number">2.5.3.2.</span> <span class="toc-text">使用Jenkinsfile脚本发布项目</span></a></li></ol></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E5%B8%B8%E7%94%A8%E6%9E%84%E5%BB%BA%E8%A7%A6%E5%8F%91%E5%99%A8"><span class="toc-number">2.5.4.</span> <span class="toc-text">常用构建触发器</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#Git-hook%E6%9E%84%E5%BB%BA%E8%A7%A6%E5%8F%91%E5%99%A8%EF%BC%88%E5%B8%B8%E7%94%A8%EF%BC%89"><span class="toc-number">2.5.5.</span> <span class="toc-text">Git hook构建触发器（常用）</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E5%8F%82%E6%95%B0%E5%8C%96%E6%9E%84%E5%BB%BA"><span class="toc-number">2.5.6.</span> <span class="toc-text">参数化构建</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E9%85%8D%E7%BD%AE%E9%82%AE%E4%BB%B6%E6%9C%8D%E5%8A%A1%E5%99%A8"><span class="toc-number">2.5.7.</span> <span class="toc-text">配置邮件服务器</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%AE%89%E8%A3%85SonarQube"><span class="toc-number">2.6.</span> <span class="toc-text">安装SonarQube</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#%E9%85%8D%E7%BD%AEJenkins%E4%B8%8Esonarqube%E9%9B%86%E6%88%90"><span class="toc-number">2.6.1.</span> <span class="toc-text">配置Jenkins与sonarqube集成</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E9%9D%9E%E6%B5%81%E6%B0%B4%E7%BA%BF%E4%BB%BB%E5%8A%A1%E6%B7%BB%E5%8A%A0SonarQube%E4%BB%A3%E7%A0%81%E5%AE%A1%E6%9F%A5"><span class="toc-number">2.6.2.</span> <span class="toc-text">非流水线任务添加SonarQube代码审查</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E6%B5%81%E6%B0%B4%E7%BA%BF%E4%BB%BB%E5%8A%A1%E6%B7%BB%E5%8A%A0SonarQube%E4%BB%A3%E7%A0%81%E5%AE%A1%E6%9F%A5"><span class="toc-number">2.6.3.</span> <span class="toc-text">流水线任务添加SonarQube代码审查</span></a></li></ol></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E5%BA%94%E7%94%A8%E6%A1%88%E4%BE%8B"><span class="toc-number">3.</span> <span class="toc-text">应用案例</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E7%8E%AF%E5%A2%83%E5%87%86%E5%A4%87"><span class="toc-number">3.1.</span> <span class="toc-text">环境准备</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#%E5%AE%89%E8%A3%85docker"><span class="toc-number">3.1.1.</span> <span class="toc-text">安装docker</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E8%8E%B7%E5%8F%96%E5%B9%B6%E4%BF%AE%E6%94%B9%E6%BA%90%E7%A0%81%E9%85%8D%E7%BD%AE"><span class="toc-number">3.1.2.</span> <span class="toc-text">获取并修改源码配置</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E9%83%A8%E7%BD%B2%E9%A1%B9%E7%9B%AE%E6%89%80%E9%9C%80%E5%AE%B9%E5%99%A8"><span class="toc-number">3.1.3.</span> <span class="toc-text">部署项目所需容器</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E4%B8%8A%E4%BC%A0%E4%BB%A3%E7%A0%81%E5%88%B0GitLab"><span class="toc-number">3.1.4.</span> <span class="toc-text">上传代码到GitLab</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E9%85%8D%E7%BD%AEJenkins%E6%B5%81%E6%B0%B4%E7%BA%BF"><span class="toc-number">3.1.5.</span> <span class="toc-text">配置Jenkins流水线</span></a></li></ol></li></ol></li></ol></div></div><div class="card-widget card-recent-post"><div class="item-headline"><i class="fas fa-history"></i><span>最新文章</span></div><div class="aside-list"><div class="aside-list-item"><a class="thumbnail" href="/yyg/2eca17c7/" title="Gitalk自动创建评论Issues"><img src="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://tu.ltyuanfang.cn/api/fengjing.php" onerror='this.onerror=null,this.src="/img/404.jpg"' alt="Gitalk自动创建评论Issues"></a><div class="content"><a class="title" href="/yyg/2eca17c7/" title="Gitalk自动创建评论Issues">Gitalk自动创建评论Issues</a><time datetime="2025-10-08T14:06:07.000Z" title="发表于 2025-10-08 22:06:07">2025-10-08</time></div></div><div class="aside-list-item"><a class="thumbnail" href="/yyg/986299a9/" title="k8s知识梳理--进阶"><img src="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://api.jiangyuhui.top/aliyun/randomCover" onerror='this.onerror=null,this.src="/img/404.jpg"' alt="k8s知识梳理--进阶"></a><div class="content"><a class="title" href="/yyg/986299a9/" title="k8s知识梳理--进阶">k8s知识梳理--进阶</a><time datetime="2025-08-22T10:17:22.000Z" title="发表于 2025-08-22 18:17:22">2025-08-22</time></div></div><div class="aside-list-item"><a class="thumbnail" href="/yyg/4789a872/" title="私有化部署DeepSeek"><img src="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://picapi.pai.al/api/scenery.php" onerror='this.onerror=null,this.src="/img/404.jpg"' alt="私有化部署DeepSeek"></a><div class="content"><a class="title" href="/yyg/4789a872/" title="私有化部署DeepSeek">私有化部署DeepSeek</a><time datetime="2025-08-16T09:12:50.000Z" title="发表于 2025-08-16 17:12:50">2025-08-16</time></div></div><div class="aside-list-item"><a class="thumbnail" href="/yyg/37098f8c/" title="使用GitHub Actions实现Hexo博客的自动化发布"><img src="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="/img/icon.png" onerror='this.onerror=null,this.src="/img/404.jpg"' alt="使用GitHub Actions实现Hexo博客的自动化发布"></a><div class="content"><a class="title" href="/yyg/37098f8c/" title="使用GitHub Actions实现Hexo博客的自动化发布">使用GitHub Actions实现Hexo博客的自动化发布</a><time datetime="2025-07-06T13:43:23.000Z" title="发表于 2025-07-06 21:43:23">2025-07-06</time></div></div><div class="aside-list-item"><a class="thumbnail" href="/yyg/9e02bef8/" title="观影感受--雄狮少年2"><img src="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="/img/img01.png" onerror='this.onerror=null,this.src="/img/404.jpg"' alt="观影感受--雄狮少年2"></a><div class="content"><a class="title" href="/yyg/9e02bef8/" title="观影感受--雄狮少年2">观影感受--雄狮少年2</a><time datetime="2025-06-04T03:35:51.000Z" title="发表于 2025-06-04 11:35:51">2025-06-04</time></div></div></div></div></div></div></main><footer id="footer"><div class="footer-other"><div class="footer-copyright"><span class="copyright">&copy;&nbsp;2024 - 2025 By 云野阁</span></div><div class="footer_custom_text"><div id="runtime"></div>世界上只有一种真正的英雄主义，那就是看清生活的真相之后，依然热爱生活</div></div></footer></div><div id="rightside"><div id="rightside-config-hide"><button id="readmode" type="button" title="阅读模式"><i class="fas fa-book-open"></i></button><button id="darkmode" type="button" title="日间和夜间模式切换"><i class="fas fa-adjust"></i></button><button id="hide-aside-btn" type="button" title="单栏和双栏切换"><i class="fas fa-arrows-alt-h"></i></button></div><div id="rightside-config-show"><button id="rightside-config" type="button" title="设置"><i class="fas fa-cog fa-spin"></i></button><button class="close" id="mobile-toc-button" type="button" title="目录"><i class="fas fa-list-ul"></i></button><a id="to_comment" href="#post-comment" title="前往评论"><i class="fas fa-comments"></i></a><button id="go-up" type="button" title="回到顶部"><span class="scroll-percent"></span><i class="fas fa-arrow-up"></i></button><button id="go-down" type="button" title="直达底部" onclick="btf.scrollToDest(document.body.scrollHeight,500)"><i class="fas fa-arrow-down"></i></button></div></div><div><script src="/js/utils.js?v=5.5.1"></script><script src="/js/main.js?v=5.5.1"></script><script src="https://s4.zstatic.net/ajax/libs/fancyapps-ui/5.0.36/fancybox/fancybox.umd.min.js"></script><script src="https://cdn.jsdelivr.net/npm/instant.page@5.2.0/instantpage.min.js" type="module"></script><script src="https://s4.zstatic.net/ajax/libs/vanilla-lazyload/19.1.3/lazyload.iife.min.js"></script><div class="js-pjax"><script>(()=>{const e=()=>{(()=>{const e=document.querySelectorAll("pre > code.mermaid");0!==e.length&&e.forEach(e=>{const t=document.createElement("pre");t.className="mermaid-src",t.hidden=!0,t.textContent=e.textContent;const n=document.createElement("div");n.className="mermaid-wrap",n.appendChild(t),e.parentNode.replaceWith(n)})})();const e=document.querySelectorAll("#article-container .mermaid-wrap");if(0===e.length)return;const t=()=>(e=>{window.loadMermaid=!0;const t="dark"===document.documentElement.getAttribute("data-theme")?"dark":"default";e.forEach((e,n)=>{const d=e.firstElementChild,a=`mermaid-${n}`,r=`%%{init:{ 'theme':'${t}'}}%%\n`+d.textContent,m=mermaid.render(a,r),o=e=>{d.insertAdjacentHTML("afterend",e)};"string"==typeof m?o(m):m.then(({svg:e})=>o(e))})})(e);btf.addGlobalFn("themeChange",t,"mermaid"),window.loadMermaid?t():btf.getScript("https://cdn.jsdelivr.net/npm/mermaid@11.12.0/dist/mermaid.min.js").then(t)};btf.addGlobalFn("encrypt",e,"mermaid"),window.pjax?e():document.addEventListener("DOMContentLoaded",e)})()</script><script>(()=>{const t="shuoshuo"===GLOBAL_CONFIG_SITE.pageType,e={"data-lang":"zh-CN","data-input-position":"bottom"},a=t=>"dark"===t?"noborder_dark":"noborder_light",s=(s=document,o)=>{const n=t?{"data-mapping":"specific","data-term":o}:{"data-mapping":e&&e["data-mapping"]||"pathname"},i=(t=>{const e=document.createElement("script");return Object.entries(t).forEach(([t,a])=>{e.setAttribute(t,a)}),e})({src:"https://giscus.app/client.js","data-repo":"MarsperL/MarsperL.github.io","data-repo-id":"R_kgDOHV6bsQ","data-category-id":"DIC_kwDOHV6bsc4Cd54m","data-theme":a(document.documentElement.getAttribute("data-theme")),"data-reactions-enabled":"1",crossorigin:"anonymous",async:!0,...e,...n});s.querySelector("#giscus-wrap").appendChild(i),t&&(window.shuoshuoComment.destroyGiscus=()=>{s.children.length&&(s.innerHTML="",s.classList.add("no-comment"))})};btf.addGlobalFn("themeChange",t=>{const e=document.querySelector("#giscus-wrap iframe");if(e){const s={giscus:{setConfig:{theme:a(t)}}};e.contentWindow.postMessage(s,"https://giscus.app")}},"giscus"),t?window.shuoshuoComment={loadComment:s}:s()})()</script><script>(()=>{const e="shuoshuo"===GLOBAL_CONFIG_SITE.pageType,t={label:"Utterances"},n=e=>"dark"===e?"dark-blue":"github-light",s=(s=document,r)=>{e&&(window.shuoshuoComment.destroyUtterances=()=>{s.children.length&&(s.innerHTML="",s.classList.add("no-comment"))});const o={src:"https://utteranc.es/client.js",repo:"MarsperL/yygyws",theme:n(document.documentElement.getAttribute("data-theme")),crossorigin:"anonymous",async:!0,...t,"issue-term":e?r:t&&t["issue-term"]||"title"},c=document.createElement("script");Object.entries(o).forEach(([e,t])=>c.setAttribute(e,t)),s.querySelector("#utterances-wrap").appendChild(c)};btf.addGlobalFn("themeChange",e=>{const t=document.querySelector("#utterances-wrap iframe");if(t){const s={type:"set-theme",theme:n(e)};t.contentWindow.postMessage(s,"https://utteranc.es")}},"utterances"),e?window.loadOtherComment=s:s()})()</script></div><script src="/js/parts.js"></script><script src="/js/background.js"></script><script async data-pjax src="//busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js"></script><div id="local-search"><div class="search-dialog"><nav class="search-nav"><span class="search-dialog-title">搜索</span><i class="fas fa-spinner fa-pulse" id="loading-status" hidden></i><button class="search-close-button"><i class="fas fa-times"></i></button></nav><div class="text-center" id="loading-database"><i class="fas fa-spinner fa-pulse"></i> <span>数据加载中</span></div><div class="local-search-input"><input placeholder="搜索文章" type="text"></div><hr><div id="local-search-results"></div><div class="ais-Pagination" id="local-search-pagination" style="display:none"><ul class="ais-Pagination-list"></ul></div><div id="local-search-stats"></div></div><div id="search-mask"></div><script src="/js/search/local-search.js?v=5.5.1"></script></div></div><script data-pjax>function butterfly_swiper_injector_config(){var a=document.getElementById("recent-posts");console.log("已挂载butterfly_swiper"),a.insertAdjacentHTML("afterbegin",'<div class="recent-post-item" style="height: auto;width: 100%"><div class="blog-slider swiper-container-fade swiper-container-horizontal" id="swiper_container"><div class="blog-slider__wrp swiper-wrapper" style="transition-duration: 0ms;"><div class="blog-slider__item swiper-slide" style="width: 750px; opacity: 1; transform: translate3d(0px, 0px, 0px); transition-duration: 0ms;"><a class="blog-slider__img" href="yyg/e102aa73/" alt=""><img width="48" height="48" src="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://api.vvhan.com/api/wallpaper/views" alt="" onerror="this.src=https://unpkg.zhimg.com/akilar-candyassets/image/loading.gif; this.onerror = null;"/></a><div class="blog-slider__content"><span class="blog-slider__code">2024-07-15</span><a class="blog-slider__title" href="yyg/e102aa73/" alt="">Hexo-Butterfly美化教程-[1]基础环境</a><div class="blog-slider__text">点击查看置顶文章啦~~~</div><a class="blog-slider__button" href="yyg/e102aa73/" alt="">详情   </a></div></div><div class="blog-slider__item swiper-slide" style="width: 750px; opacity: 1; transform: translate3d(0px, 0px, 0px); transition-duration: 0ms;"><a class="blog-slider__img" href="yyg/80ffa402/" alt=""><img width="48" height="48" src="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://random-img.pupper.cn/api" alt="" onerror="this.src=https://unpkg.zhimg.com/akilar-candyassets/image/loading.gif; this.onerror = null;"/></a><div class="blog-slider__content"><span class="blog-slider__code">2025-03-10</span><a class="blog-slider__title" href="yyg/80ffa402/" alt="">Hexo-Butterfly美化教程-[2]Butterfly主题安装</a><div class="blog-slider__text">点击查看置顶文章啦~~~</div><a class="blog-slider__button" href="yyg/80ffa402/" alt="">详情   </a></div></div><div class="blog-slider__item swiper-slide" style="width: 750px; opacity: 1; transform: translate3d(0px, 0px, 0px); transition-duration: 0ms;"><a class="blog-slider__img" href="yyg/b2261cee/" alt=""><img width="48" height="48" src="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://api.jiangyuhui.top/aliyun/randomCover" alt="" onerror="this.src=https://unpkg.zhimg.com/akilar-candyassets/image/loading.gif; this.onerror = null;"/></a><div class="blog-slider__content"><span class="blog-slider__code">2025-05-19</span><a class="blog-slider__title" href="yyg/b2261cee/" alt="">Hexo-Butterfly美化教程-[3]建主要页面</a><div class="blog-slider__text">点击查看置顶文章啦~~~</div><a class="blog-slider__button" href="yyg/b2261cee/" alt="">详情   </a></div></div><div class="blog-slider__item swiper-slide" style="width: 750px; opacity: 1; transform: translate3d(0px, 0px, 0px); transition-duration: 0ms;"><a class="blog-slider__img" href="yyg/8a5ee3aa/" alt=""><img width="48" height="48" src="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://imgapi.cn/api.php?fl=fengjing&amp;gs=images" alt="" onerror="this.src=https://unpkg.zhimg.com/akilar-candyassets/image/loading.gif; this.onerror = null;"/></a><div class="blog-slider__content"><span class="blog-slider__code">2025-05-19</span><a class="blog-slider__title" href="yyg/8a5ee3aa/" alt="">Hexo-Butterfly美化教程-[4]修改配置文件</a><div class="blog-slider__text">点击查看置顶文章啦~~~</div><a class="blog-slider__button" href="yyg/8a5ee3aa/" alt="">详情   </a></div></div><div class="blog-slider__item swiper-slide" style="width: 750px; opacity: 1; transform: translate3d(0px, 0px, 0px); transition-duration: 0ms;"><a class="blog-slider__img" href="yyg/23010111/" alt=""><img width="48" height="48" src="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://api.vvhan.com/api/wallpaper/views" alt="" onerror="this.src=https://unpkg.zhimg.com/akilar-candyassets/image/loading.gif; this.onerror = null;"/></a><div class="blog-slider__content"><span class="blog-slider__code">2025-05-19</span><a class="blog-slider__title" href="yyg/23010111/" alt="">Hexo-Butterfly美化教程-[5]安装常用插件</a><div class="blog-slider__text">点击查看置顶文章啦~~~</div><a class="blog-slider__button" href="yyg/23010111/" alt="">详情   </a></div></div><div class="blog-slider__item swiper-slide" style="width: 750px; opacity: 1; transform: translate3d(0px, 0px, 0px); transition-duration: 0ms;"><a class="blog-slider__img" href="yyg/5986cad/" alt=""><img width="48" height="48" src="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://api.jiangyuhui.top/aliyun/randomCover" alt="" onerror="this.src=https://unpkg.zhimg.com/akilar-candyassets/image/loading.gif; this.onerror = null;"/></a><div class="blog-slider__content"><span class="blog-slider__code">2025-05-21</span><a class="blog-slider__title" href="yyg/5986cad/" alt="">Hexo-Butterfly美化教程-[6]开启博客评论</a><div class="blog-slider__text">点击查看置顶文章啦~~~</div><a class="blog-slider__button" href="yyg/5986cad/" alt="">详情   </a></div></div><div class="blog-slider__item swiper-slide" style="width: 750px; opacity: 1; transform: translate3d(0px, 0px, 0px); transition-duration: 0ms;"><a class="blog-slider__img" href="yyg/5baeb6c6/" alt=""><img width="48" height="48" src="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://random-img.pupper.cn/api" alt="" onerror="this.src=https://unpkg.zhimg.com/akilar-candyassets/image/loading.gif; this.onerror = null;"/></a><div class="blog-slider__content"><span class="blog-slider__code">2025-05-20</span><a class="blog-slider__title" href="yyg/5baeb6c6/" alt="">Hexo-Butterfly美化教程-[7]功能魔改(源码方式)</a><div class="blog-slider__text">点击查看置顶文章啦~~~</div><a class="blog-slider__button" href="yyg/5baeb6c6/" alt="">详情   </a></div></div><div class="blog-slider__item swiper-slide" style="width: 750px; opacity: 1; transform: translate3d(0px, 0px, 0px); transition-duration: 0ms;"><a class="blog-slider__img" href="yyg/5f747cff/" alt=""><img width="48" height="48" src="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://t.alcy.cc/fj" alt="" onerror="this.src=https://unpkg.zhimg.com/akilar-candyassets/image/loading.gif; this.onerror = null;"/></a><div class="blog-slider__content"><span class="blog-slider__code">2025-05-23</span><a class="blog-slider__title" href="yyg/5f747cff/" alt="">Hexo-Butterfly美化教程-[8]随鼠标变幻的动态粒子线条背景</a><div class="blog-slider__text">点击查看置顶文章啦~~~</div><a class="blog-slider__button" href="yyg/5f747cff/" alt="">详情   </a></div></div><div class="blog-slider__item swiper-slide" style="width: 750px; opacity: 1; transform: translate3d(0px, 0px, 0px); transition-duration: 0ms;"><a class="blog-slider__img" href="yyg/ca46b09/" alt=""><img width="48" height="48" src="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="/img/icon.png" alt="" onerror="this.src=https://unpkg.zhimg.com/akilar-candyassets/image/loading.gif; this.onerror = null;"/></a><div class="blog-slider__content"><span class="blog-slider__code">2024-08-07</span><a class="blog-slider__title" href="yyg/ca46b09/" alt="">Hexo-Butterfly美化教程-[9]繁沙</a><div class="blog-slider__text">点击查看置顶文章啦~~~</div><a class="blog-slider__button" href="yyg/ca46b09/" alt="">详情   </a></div></div><div class="blog-slider__item swiper-slide" style="width: 750px; opacity: 1; transform: translate3d(0px, 0px, 0px); transition-duration: 0ms;"><a class="blog-slider__img" href="yyg/5ea27f40/" alt=""><img width="48" height="48" src="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://imgapi.cn/api.php?fl=fengjing&amp;gs=images" alt="" onerror="this.src=https://unpkg.zhimg.com/akilar-candyassets/image/loading.gif; this.onerror = null;"/></a><div class="blog-slider__content"><span class="blog-slider__code">2024-08-26</span><a class="blog-slider__title" href="yyg/5ea27f40/" alt="">在Github上使用OsmosFeed搭建在线RSS阅读器（无需服务器）</a><div class="blog-slider__text">点击查看置顶文章啦~~~</div><a class="blog-slider__button" href="yyg/5ea27f40/" alt="">详情   </a></div></div><div class="blog-slider__item swiper-slide" style="width: 750px; opacity: 1; transform: translate3d(0px, 0px, 0px); transition-duration: 0ms;"><a class="blog-slider__img" href="yyg/37098f8c/" alt=""><img width="48" height="48" src="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="/img/icon.png" alt="" onerror="this.src=https://unpkg.zhimg.com/akilar-candyassets/image/loading.gif; this.onerror = null;"/></a><div class="blog-slider__content"><span class="blog-slider__code">2025-07-06</span><a class="blog-slider__title" href="yyg/37098f8c/" alt="">使用GitHub Actions实现Hexo博客的自动化发布</a><div class="blog-slider__text">点击查看置顶文章啦~~~</div><a class="blog-slider__button" href="yyg/37098f8c/" alt="">详情   </a></div></div></div><div class="blog-slider__pagination swiper-pagination-clickable swiper-pagination-bullets"></div></div></div>')}for(var elist="undefined".split(","),cpage=location.pathname,epage="all",flag=0,i=0;i<elist.length;i++)cpage.includes(elist[i])&&flag++;("all"===epage&&0==flag||epage===cpage)&&butterfly_swiper_injector_config()</script><script defer src="https://npm.elemecdn.com/hexo-butterfly-swiper/lib/swiper.min.js"></script><script defer data-pjax src="https://npm.elemecdn.com/hexo-butterfly-swiper/lib/swiper_init.js"></script><script async src="//at.alicdn.com/t/font_2032782_8d5kxvn09md.js"></script></body></html>