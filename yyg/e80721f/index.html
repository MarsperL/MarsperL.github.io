<!DOCTYPE html><html lang="zh-CN" data-theme="dark"><head><script>(()=>{const e=navigator.serviceWorker;e?e.register("/sw.js").then(async e=>{console.log("SWPP 注册成功");try{await e.periodicSync.register("update",{minInterval:864e5})}catch(e){console.log("Periodic Sync 注册失败",e)}}).catch(e=>console.error("SWPP 注册失败",e)):console.warn("当前浏览器不支持 SW")})()</script><meta charset="UTF-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="viewport" content="width=device-width,initial-scale=1,viewport-fit=cover"><title>Ansible知识梳理 | 云野阁</title><meta name="author" content="云野阁"><meta name="copyright" content="云野阁"><meta name="format-detection" content="telephone=no"><meta name="theme-color" content="#0d0d0d"><meta name="description" content="🔜什么是Ansible？🔚                               Ansible 是一款 IT 自动化工具。主要应用场景有配置系统、软件部署、持续发布及不停服平滑滚动更新的高级任务编排。Ansible 提供开源自动化，可降低复杂性并在任何地方运行。使用 Ansible 可以自动执行几乎任何任务。                             架构 Ansibl"><meta property="og:type" content="article"><meta property="og:title" content="Ansible知识梳理"><meta property="og:url" content="https://yyg.js.cool/yyg/e80721f/index.html"><meta property="og:site_name" content="云野阁"><meta property="og:description" content="🔜什么是Ansible？🔚                               Ansible 是一款 IT 自动化工具。主要应用场景有配置系统、软件部署、持续发布及不停服平滑滚动更新的高级任务编排。Ansible 提供开源自动化，可降低复杂性并在任何地方运行。使用 Ansible 可以自动执行几乎任何任务。                             架构 Ansibl"><meta property="og:locale" content="zh_CN"><meta property="og:image" content="https://t.alcy.cc/fj"><meta property="article:published_time" content="2025-03-31T11:45:26.000Z"><meta property="article:modified_time" content="2025-05-17T10:37:38.000Z"><meta property="article:author" content="云野阁"><meta property="article:tag" content="知识梳理"><meta property="article:tag" content="CI&#x2F;CD"><meta property="article:tag" content="自动化运维"><meta property="article:tag" content="Ansible"><meta property="article:tag" content="Linux运维"><meta name="twitter:card" content="summary"><meta name="twitter:image" content="https://t.alcy.cc/fj"><script type="application/ld+json">{
  "@context": "https://schema.org",
  "@type": "BlogPosting",
  "headline": "Ansible知识梳理",
  "url": "https://yyg.js.cool/yyg/e80721f/",
  "image": "https://t.alcy.cc/fj",
  "datePublished": "2025-03-31T11:45:26.000Z",
  "dateModified": "2025-05-17T10:37:38.000Z",
  "author": [
    {
      "@type": "Person",
      "name": "云野阁",
      "url": "https://yyg.js.cool/"
    }
  ]
}</script><link rel="shortcut icon" href="/img/icon.png"><link rel="canonical" href="https://yyg.js.cool/yyg/e80721f/index.html"><link rel="preconnect" href="//cdn.jsdelivr.net"><link rel="preconnect" href="//busuanzi.ibruce.info"><link rel="manifest" href="/manifest.json"><link rel="apple-touch-icon" sizes="180x180" href="/img/icon.png"><link rel="icon" type="image/png" sizes="32x32" href="/img/pwa/favicon-32x32.png"><link rel="icon" type="image/png" sizes="16x16" href="/img/pwa/favicon-16x16.png"><link rel="mask-icon" href="/img/pwa/icon.svg" color="#5bbad5"><link rel="stylesheet" href="/css/index.css?v=5.5.1"><link rel="stylesheet" href="https://s4.zstatic.net/npm/@fortawesome/fontawesome-free@6.7.2/css/all.min.css"><link rel="stylesheet" href="https://s4.zstatic.net/ajax/libs/fancyapps-ui/5.0.36/fancybox/fancybox.min.css" media="print" onload='this.media="all"'><script>(()=>{const e={set:(e,t,o)=>{if(!o)return;const a=Date.now()+864e5*o;localStorage.setItem(e,JSON.stringify({value:t,expiry:a}))},get:e=>{const t=localStorage.getItem(e);if(!t)return;const{value:o,expiry:a}=JSON.parse(t);if(!(Date.now()>a))return o;localStorage.removeItem(e)}};window.btf={saveToLocal:e,getScript:(e,t={})=>new Promise((o,a)=>{const n=document.createElement("script");n.src=e,n.async=!0,Object.entries(t).forEach(([e,t])=>n.setAttribute(e,t)),n.onload=n.onreadystatechange=()=>{n.readyState&&!/loaded|complete/.test(n.readyState)||o()},n.onerror=a,document.head.appendChild(n)}),getCSS:(e,t)=>new Promise((o,a)=>{const n=document.createElement("link");n.rel="stylesheet",n.href=e,t&&(n.id=t),n.onload=n.onreadystatechange=()=>{n.readyState&&!/loaded|complete/.test(n.readyState)||o()},n.onerror=a,document.head.appendChild(n)}),addGlobalFn:(e,t,o=!1,a=window)=>{if(e.startsWith("pjax"))return;const n=a.globalFn||{};n[e]=n[e]||{},n[e][o||Object.keys(n[e]).length]=t,a.globalFn=n}};const t=()=>{document.documentElement.setAttribute("data-theme","dark"),null!==document.querySelector('meta[name="theme-color"]')&&document.querySelector('meta[name="theme-color"]').setAttribute("content","#0d0d0d")},o=()=>{document.documentElement.setAttribute("data-theme","light"),null!==document.querySelector('meta[name="theme-color"]')&&document.querySelector('meta[name="theme-color"]').setAttribute("content","#ffffff")};btf.activateDarkMode=t,btf.activateLightMode=o;const a=e.get("theme");"dark"===a?t():"light"===a&&o();const n=e.get("aside-status");void 0!==n&&document.documentElement.classList.toggle("hide-aside","hide"===n);/iPad|iPhone|iPod|Macintosh/.test(navigator.userAgent)&&document.documentElement.classList.add("apple")})()</script><script>const GLOBAL_CONFIG={root:"/",algolia:void 0,localSearch:{path:"/search.json",preload:!1,top_n_per_article:1,unescape:!1,pagination:{enable:!0,hitsPerPage:8},languages:{hits_empty:"未找到符合您查询的内容：${query}",hits_stats:"共找到 ${hits} 篇文章"}},translate:void 0,highlight:{plugin:"highlight.js",highlightCopy:!0,highlightLang:!0,highlightHeightLimit:200,highlightFullpage:!1,highlightMacStyle:!0},copy:{success:"复制成功",error:"复制失败",noSupport:"浏览器不支持"},relativeDate:{homepage:!1,post:!1},runtime:"天",dateSuffix:{just:"刚刚",min:"分钟前",hour:"小时前",day:"天前",month:"个月前"},copyright:void 0,lightbox:"fancybox",Snackbar:void 0,infinitegrid:{js:"https://s4.zstatic.net/ajax/libs/egjs-infinitegrid/4.12.0/infinitegrid.min.js",buttonText:"加载更多"},isPhotoFigcaption:!1,islazyloadPlugin:!0,isAnchor:!1,percent:{toc:!0,rightside:!0},autoDarkmode:!1}</script><script id="config-diff">var GLOBAL_CONFIG_SITE={title:"Ansible知识梳理",isHighlightShrink:!1,isToc:!0,pageType:"post"}</script><link rel="stylesheet" href="/css/parts.css"><link rel="stylesheet" href="/css/link.css"><script src="https://npm.elemecdn.com/echarts@5.4.3/dist/echarts.min.js"></script><script defer src="https://s4.zstatic.net/ajax/libs/sweetalert2/11.16.1/sweetalert2.all.js"></script><script defer src="/js/lunar.js"></script><script defer src="/js/day.js"></script><script defer src="/sw-dom.js"></script><link rel="stylesheet" href="https://npm.elemecdn.com/hexo-butterfly-swiper/lib/swiper.min.css" media="print" onload='this.media="all"'><link rel="stylesheet" href="https://npm.elemecdn.com/hexo-butterfly-swiper/lib/swiperstyle.css" media="print" onload='this.media="all"'><link rel="stylesheet" href="https://npm.elemecdn.com/hexo-butterfly-tag-plugins-plus@latest/lib/assets/font-awesome-animation.min.css" media="defer" onload='this.media="all"'><link rel="stylesheet" href="https://npm.elemecdn.com/hexo-butterfly-tag-plugins-plus@latest/lib/tag_plugins.css" media="defer" onload='this.media="all"'><script src="https://npm.elemecdn.com/hexo-butterfly-tag-plugins-plus@latest/lib/assets/carousel-touch.js"></script><meta name="generator" content="Hexo 7.3.0"><link rel="alternate" href="/rss2.xml" title="云野阁" type="application/rss+xml"></head><body><div id="sidebar"><div id="menu-mask"></div><div id="sidebar-menus"><div class="avatar-img text-center"><img src="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="/img/icon.png" onerror='this.onerror=null,this.src="/img/friend_404.gif"' alt="avatar"></div><div class="site-data text-center"><a href="/archives/"><div class="headline">文章</div><div class="length-num">62</div></a><a href="/tags/"><div class="headline">标签</div><div class="length-num">109</div></a><a href="/categories/"><div class="headline">分类</div><div class="length-num">37</div></a></div><div class="menus_items"><div class="menus_item"><a class="site-page" href="/"><i class="fa-fw fas fa-home"></i> <span>首页</span></a></div><div class="menus_item"><a class="site-page" href="/docs/"><i class="fa-fw fa-solid fa-book-bookmark"></i> <span>教程手册</span></a></div><div class="menus_item"><span class="site-page group"><i class="fa-fw fa-solid fa-blog"></i> <span>博文</span><i class="fas fa-chevron-down"></i></span><ul class="menus_item_child"><li><a class="site-page child" href="/archives/"><i class="fa-fw fas fa-archive"></i> <span>归档</span></a></li><li><a class="site-page child" href="/tags/"><i class="fa-fw fas fa-tags"></i> <span>标签</span></a></li><li><a class="site-page child" href="/categories/"><i class="fa-fw fas fa-folder-open"></i> <span>分类</span></a></li><li><a class="site-page child" href="javascript:randomPost();"><i class="fa-fw fa-solid fa-shuffle"></i> <span>随机一篇</span></a></li></ul></div><div class="menus_item"><span class="site-page group"><i class="fa-fw fa-brands fa-get-pocket"></i> <span>蓝口袋</span><i class="fas fa-chevron-down"></i></span><ul class="menus_item_child"><li><a class="site-page child" href="/pintree/"><i class="fa-fw fa fa-search-plus"></i> <span>导航</span></a></li><li><a class="site-page child" href="/sand/"><i class="fa-fw fa fa-cube"></i> <span>繁沙</span></a></li><li><a class="site-page child" href="/trip/"><i class="fa-fw fa-solid fa-earth-asia"></i> <span>星游记</span></a></li><li><a class="site-page child" href="/share/"><i class="fa-fw fa-solid fa-star"></i> <span>书•影•音</span></a></li><li><a class="site-page child" href="/focusclock/"><i class="fa-fw fas fa-clock"></i> <span>专注时钟</span></a></li></ul></div><div class="menus_item"><span class="site-page group"><i class="fa-fw fas fa-comments"></i> <span>聊天室</span><i class="fas fa-chevron-down"></i></span><ul class="menus_item_child"><li><a class="site-page child" href="/shuoshuo/"><i class="fa-fw fas fa-comment-dots"></i> <span>说说</span></a></li><li><a class="site-page child" href="/messageboard/"><i class="fa-fw fa fa-paper-plane"></i> <span>心语亭</span></a></li></ul></div><div class="menus_item"><span class="site-page group"><i class="fa-fw fas fa-book-open"></i> <span>文界</span><i class="fas fa-chevron-down"></i></span><ul class="menus_item_child"><li><a class="site-page child" href="/yygrss/"><i class="fa-fw fa-solid fa-square-rss"></i> <span>瀚文集</span></a></li><li><a class="site-page child" href="/fcircle/"><i class="fa-fw fa-solid fa-comment-nodes"></i> <span>友文说</span></a></li></ul></div><div class="menus_item"><span class="site-page group"><i class="fa-fw fa-solid fa-circle-user"></i> <span>更多</span><i class="fas fa-chevron-down"></i></span><ul class="menus_item_child"><li><a class="site-page child" href="/link/"><i class="fa-fw fas fa-link"></i> <span>友链</span></a></li><li><a class="site-page child" href="/about/"><i class="fa-fw fas fa-heart"></i> <span>关于</span></a></li></ul></div></div></div></div><div class="post" id="body-wrap"><header class="post-bg" id="page-header" style="background-image:url(https://t.alcy.cc/fj)"><nav id="nav"><span id="blog-info"><a class="nav-site-title" href="/"><img class="site-icon" src="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://gcore.jsdelivr.net/gh/MarsperL/MarsperL.github.io@2.1/img/icon.png" alt="Logo"><span class="site-name">云野阁</span></a><a class="nav-page-title" href="/"><span class="site-name">Ansible知识梳理</span><span class="site-name"><i class="fa-solid fa-circle-arrow-left"></i> <span>返回首页</span></span></a></span><div id="menus"><div id="search-button"><span class="site-page social-icon search"><i class="fas fa-search fa-fw"></i> <span>搜索</span></span></div><div class="menus_items"><div class="menus_item"><a class="site-page" href="/"><i class="fa-fw fas fa-home"></i> <span>首页</span></a></div><div class="menus_item"><a class="site-page" href="/docs/"><i class="fa-fw fa-solid fa-book-bookmark"></i> <span>教程手册</span></a></div><div class="menus_item"><span class="site-page group"><i class="fa-fw fa-solid fa-blog"></i> <span>博文</span><i class="fas fa-chevron-down"></i></span><ul class="menus_item_child"><li><a class="site-page child" href="/archives/"><i class="fa-fw fas fa-archive"></i> <span>归档</span></a></li><li><a class="site-page child" href="/tags/"><i class="fa-fw fas fa-tags"></i> <span>标签</span></a></li><li><a class="site-page child" href="/categories/"><i class="fa-fw fas fa-folder-open"></i> <span>分类</span></a></li><li><a class="site-page child" href="javascript:randomPost();"><i class="fa-fw fa-solid fa-shuffle"></i> <span>随机一篇</span></a></li></ul></div><div class="menus_item"><span class="site-page group"><i class="fa-fw fa-brands fa-get-pocket"></i> <span>蓝口袋</span><i class="fas fa-chevron-down"></i></span><ul class="menus_item_child"><li><a class="site-page child" href="/pintree/"><i class="fa-fw fa fa-search-plus"></i> <span>导航</span></a></li><li><a class="site-page child" href="/sand/"><i class="fa-fw fa fa-cube"></i> <span>繁沙</span></a></li><li><a class="site-page child" href="/trip/"><i class="fa-fw fa-solid fa-earth-asia"></i> <span>星游记</span></a></li><li><a class="site-page child" href="/share/"><i class="fa-fw fa-solid fa-star"></i> <span>书•影•音</span></a></li><li><a class="site-page child" href="/focusclock/"><i class="fa-fw fas fa-clock"></i> <span>专注时钟</span></a></li></ul></div><div class="menus_item"><span class="site-page group"><i class="fa-fw fas fa-comments"></i> <span>聊天室</span><i class="fas fa-chevron-down"></i></span><ul class="menus_item_child"><li><a class="site-page child" href="/shuoshuo/"><i class="fa-fw fas fa-comment-dots"></i> <span>说说</span></a></li><li><a class="site-page child" href="/messageboard/"><i class="fa-fw fa fa-paper-plane"></i> <span>心语亭</span></a></li></ul></div><div class="menus_item"><span class="site-page group"><i class="fa-fw fas fa-book-open"></i> <span>文界</span><i class="fas fa-chevron-down"></i></span><ul class="menus_item_child"><li><a class="site-page child" href="/yygrss/"><i class="fa-fw fa-solid fa-square-rss"></i> <span>瀚文集</span></a></li><li><a class="site-page child" href="/fcircle/"><i class="fa-fw fa-solid fa-comment-nodes"></i> <span>友文说</span></a></li></ul></div><div class="menus_item"><span class="site-page group"><i class="fa-fw fa-solid fa-circle-user"></i> <span>更多</span><i class="fas fa-chevron-down"></i></span><ul class="menus_item_child"><li><a class="site-page child" href="/link/"><i class="fa-fw fas fa-link"></i> <span>友链</span></a></li><li><a class="site-page child" href="/about/"><i class="fa-fw fas fa-heart"></i> <span>关于</span></a></li></ul></div></div><div id="toggle-menu"><span class="site-page"><i class="fas fa-bars fa-fw"></i></span></div></div></nav><div id="post-info"><h1 class="post-title">Ansible知识梳理</h1><div id="post-meta"><div class="meta-firstline"><span class="post-meta-date"><i class="far fa-calendar-alt fa-fw post-meta-icon"></i><span class="post-meta-label">发表于</span><time class="post-meta-date-created" datetime="2025-03-31T11:45:26.000Z" title="发表于 2025-03-31 19:45:26">2025-03-31</time><span class="post-meta-separator">|</span><i class="fas fa-history fa-fw post-meta-icon"></i><span class="post-meta-label">更新于</span><time class="post-meta-date-updated" datetime="2025-05-17T10:37:38.000Z" title="更新于 2025-05-17 18:37:38">2025-05-17</time></span><span class="post-meta-categories"><span class="post-meta-separator">|</span><i class="fas fa-inbox fa-fw post-meta-icon"></i><a class="post-meta-categories" href="/categories/%E6%A2%B3%E7%90%86%E6%80%BB%E7%BB%93/">梳理总结</a><i class="fas fa-angle-right post-meta-separator"></i><i class="fas fa-inbox fa-fw post-meta-icon"></i><a class="post-meta-categories" href="/categories/%E6%A2%B3%E7%90%86%E6%80%BB%E7%BB%93/%E7%9F%A5%E8%AF%86%E6%A2%B3%E7%90%86/">知识梳理</a><i class="fas fa-angle-right post-meta-separator"></i><i class="fas fa-inbox fa-fw post-meta-icon"></i><a class="post-meta-categories" href="/categories/%E8%87%AA%E5%8A%A8%E5%8C%96%E8%BF%90%E7%BB%B4/">自动化运维</a><i class="fas fa-angle-right post-meta-separator"></i><i class="fas fa-inbox fa-fw post-meta-icon"></i><a class="post-meta-categories" href="/categories/%E8%87%AA%E5%8A%A8%E5%8C%96%E8%BF%90%E7%BB%B4/Ansible/">Ansible</a></span></div><div class="meta-secondline"><span class="post-meta-separator">|</span><span class="post-meta-wordcount"><i class="far fa-file-word fa-fw post-meta-icon"></i><span class="post-meta-label">总字数:</span><span class="word-count">7.3k</span><span class="post-meta-separator">|</span><i class="far fa-clock fa-fw post-meta-icon"></i><span class="post-meta-label">阅读时长:</span><span>31分钟</span></span><span class="post-meta-separator">|</span><span class="post-meta-pv-cv" data-flag-title=""><i class="far fa-eye fa-fw post-meta-icon"></i><span class="post-meta-label">浏览量:</span><span id="busuanzi_value_page_pv"><i class="fa-solid fa-spinner fa-spin"></i></span></span></div></div></div><section class="main-hero-waves-area waves-area"><svg class="waves-svg" xmlns="http://www.w3.org/2000/svg" xlink="http://www.w3.org/1999/xlink" viewBox="0 24 150 28" preserveAspectRatio="none" shape-rendering="auto"><defs><path id="gentle-wave" d="M-160 44c30 0 58-18 88-18s58 18 88 18 58-18 88-18 58 18 88 18v44h-352Z"></path></defs><g class="parallax"><use href="#gentle-wave" x="48" y="0"></use><use href="#gentle-wave" x="48" y="3"></use><use href="#gentle-wave" x="48" y="5"></use><use href="#gentle-wave" x="48" y="7"></use></g></svg></section></header><main class="layout" id="content-inner"><div id="post"><article class="container post-content" id="article-container"><details class="folding-tag" cyan><summary>🔜什么是Ansible？🔚</summary><div class="content"><p>Ansible 是一款 IT 自动化工具。主要应用场景有配置系统、软件部署、持续发布及不停服平滑滚动更新的高级任务编排。</p><p>Ansible 提供开源自动化，可降低复杂性并在任何地方运行。使用 Ansible 可以自动执行几乎任何任务。</p></div></details><h2 id="架构"><a href="#架构" class="headerlink" title="架构"></a>架构</h2><blockquote><p><code>Ansible</code>：Ansible核心程序。<br><code>HostInventory</code>：记录由Ansible管理的主机信息，包括端口、密码、ip等。<br><code>Playbooks</code>：“剧本”YAML格式文件，多个任务定义在一个文件中，定义主机需要调用哪些模块来完成的功能。<br><code>CoreModules</code>：<strong>核心模块</strong>，主要操作是通过调用核心模块来完成管理任务。<br><code>CustomModules</code>：自定义模块，完成核心模块无法完成的功能，支持多种语言。<br><code>ConnectionPlugins</code>：连接插件，Ansible和Host通信使用</p></blockquote><img src="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="/yyg/e80721f/1.png" title="image-20250331194718453"><h2 id="Ansible重要概念"><a href="#Ansible重要概念" class="headerlink" title="Ansible重要概念"></a>Ansible重要概念</h2><h3 id="控制节点"><a href="#控制节点" class="headerlink" title="控制节点"></a>控制节点</h3><p>控制节点是运行 Ansible Ansible CLI 工具 的机器。它负责与受控节点（被管理节点）进行通信，发出命令并执行任务。</p><h3 id="受控节点（被管理节点）"><a href="#受控节点（被管理节点）" class="headerlink" title="受控节点（被管理节点）"></a>受控节点（被管理节点）</h3><p>也称为“主机”，这些是用 Ansible 管理的目标设备。Ansible控制节点会在这些机器上执行任务。受控节点不需要安装任何代理。</p><h3 id="库存-Inventory"><a href="#库存-Inventory" class="headerlink" title="库存 (Inventory)"></a>库存 (Inventory)</h3><p>包含要管理的目标主机或节点的清单。它是 Ansible 用来定义目标主机信息的配置文件，支持静态或动态的主机清单。它还用于分配组，这既允许在剧集中选择节点，也允许批量分配变量。</p><h3 id="剧本（Playbook）"><a href="#剧本（Playbook）" class="headerlink" title="剧本（Playbook）"></a>剧本（Playbook）</h3><p>Playbook 是 Ansible 配置管理的核心部分，是一组用于自动化执行任务的 YAML 文件。Playbook 可以执行多个步骤（例如安装软件、启动服务等），并定义执行顺序、任务等。</p><h3 id="模块-Modules"><a href="#模块-Modules" class="headerlink" title="模块 (Modules)"></a>模块 (Modules)</h3><p>模块是 Ansible 中执行实际任务的单元。它们是高度可复用的代码块，负责执行特定的操作（如安装软件包、配置文件等）。</p><h3 id="角色-Roles"><a href="#角色-Roles" class="headerlink" title="角色 (Roles)"></a>角色 (Roles)</h3><p>角色是 Playbook 的一种组织方式，用于把多个任务、文件、模板、变量等组织成一个完整的功能模块。角色帮助将复杂的配置拆分成可复用的组件。可在剧集内部使用的可重用 Ansible 内容。</p><h3 id="任务-Tasks"><a href="#任务-Tasks" class="headerlink" title="任务 (Tasks)"></a>任务 (Tasks)</h3><p>任务是 Playbook 中定义的具体操作。每个任务通常会调用一个 Ansible 模块来执行特定的操作。是ad-hoc 更适合临时执行命令的执行场景。</p><h3 id="插件"><a href="#插件" class="headerlink" title="插件"></a>插件</h3><p>扩展 Ansible 核心功能的代码片段。插件可以控制您如何连接到被管理节点（连接插件）、操作数据（过滤器插件），甚至控制在控制台中显示的内容（回调插件）。</p><h3 id="集合"><a href="#集合" class="headerlink" title="集合"></a>集合</h3><p>Ansible 内容的分发格式，可以包含剧本、角色、模块和插件。</p><h2 id="Ansible任务执行模式"><a href="#Ansible任务执行模式" class="headerlink" title="Ansible任务执行模式"></a>Ansible任务执行模式</h2><p>Ansible 系统由控制主机对被管节点的操作方式可分为两类，即<code>ad-hoc</code>和<code>playbook</code>：</p><ul><li>ad-hoc模式(点对点模式)<br>　　使用单个模块，支持批量执行单条命令。ad-hoc 命令是一种可以快速输入的命令，而且不需要保存起来的命令。</li><li>playbook模式(剧本模式)<br>　　是Ansible主要管理方式，也是Ansible功能强大的关键所在。<strong>playbook通过多个task集合完成一类功能</strong>。可以简单地把playbook理解为通过组合多条ad-hoc操作的配置文件。</li></ul><h2 id="Ansible安装（centos-7）"><a href="#Ansible安装（centos-7）" class="headerlink" title="Ansible安装（centos 7）"></a>Ansible安装（centos 7）</h2><p>修改系统镜像源为阿里云镜像源</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">cd /etc/yum.repos.d</span><br><span class="line">mv CentOS-Base.repo CentOS-Base.repo.bak</span><br><span class="line">curl -o /etc/yum.repos.d/CentOS-Base.repo http://mirrors.aliyun.com/repo/Centos-7.repo</span><br></pre></td></tr></table></figure><h3 id="方式一：使用yum安装"><a href="#方式一：使用yum安装" class="headerlink" title="方式一：使用yum安装"></a>方式一：使用yum安装</h3><p>安装<code>epel-release</code>包与<code>Ansible</code></p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">yum install epel-release -y</span><br><span class="line">yum install ansible -y</span><br><span class="line"><span class="meta prompt_">#</span><span class="language-bash">查看版本</span></span><br><span class="line"> ansible --version</span><br></pre></td></tr></table></figure><h3 id="方式二：使用pip安装"><a href="#方式二：使用pip安装" class="headerlink" title="方式二：使用pip安装"></a>方式二：使用pip安装</h3><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">yum install python3 python3-devel python3-pip -y</span><br><span class="line">python3 -m pip install ansible</span><br><span class="line"><span class="meta prompt_">#</span><span class="language-bash">查看版本</span></span><br><span class="line"> ansible --version</span><br></pre></td></tr></table></figure><h2 id="Ansible-配置文件"><a href="#Ansible-配置文件" class="headerlink" title="Ansible 配置文件"></a>Ansible 配置文件</h2><p>配置文件读取的优先级顺序如下：</p><ol><li>检查环境变量<code>ANSIBLE_CONFIG</code>指向的路径文件(export ANSIBLE_CONFIG=xxxx)；</li><li>检查当前项目目录下的ansible.cfg配置文件；</li><li><code>~/.ansible.cfg</code>，检查当前目录下的ansible.cfg配置文件；</li><li><code>/etc/ansible/ansible.cfg</code>检查etc目录的配置文件。</li></ol><h2 id="Ansible免密登录"><a href="#Ansible免密登录" class="headerlink" title="Ansible免密登录"></a>Ansible免密登录</h2><h3 id="root用户"><a href="#root用户" class="headerlink" title="root用户"></a>root用户</h3><p>控制节点设置ssh免密登录，并将密钥传至受控节点上。</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">ssh-keygen -t dsa -f ~/.ssh/id_dsa -P &quot;&quot;</span><br><span class="line">ssh-copy-id -i ~/.ssh/id_dsa.pub root@受控主机ip</span><br></pre></td></tr></table></figure><h3 id="普通用户"><a href="#普通用户" class="headerlink" title="普通用户"></a>普通用户</h3><p>控制节点和被控节点都要有普通用户，此处以<code>test</code>用户为例。</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta prompt_">#</span><span class="language-bash">添加<span class="built_in">test</span>用户，并设置密码</span></span><br><span class="line">useradd test</span><br><span class="line">passwd test</span><br></pre></td></tr></table></figure><p>在控制节点设置ssh免密登录，并将密钥传至受控节点。</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">ssh-keygen -t dsa -f ~/.ssh/id_dsa -P &quot;&quot;</span><br><span class="line">ssh-copy-id -i ~/.ssh/id_dsa.pub test@受控主机ip</span><br></pre></td></tr></table></figure><p>修改所有主机的<code>test</code>用户的sudo权限。</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">visudo</span><br><span class="line">test    ALL=(ALL)       NOPASSWD: ALL</span><br></pre></td></tr></table></figure><p>修改控制节点的配置文件<code>/etc/ansible/ansible.cfg</code>，设置普通用户权限提升。</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">vi /etc/ansible/ansible.cfg</span><br><span class="line"><span class="meta prompt_">#</span><span class="language-bash">将以下内容注释取消</span></span><br><span class="line">[privilege_escalation]</span><br><span class="line">become=True   #启用权限提升</span><br><span class="line">become_method=sudo  #通过 sudo 提升到 root 用户的权限</span><br><span class="line">become_user=root  #作为 root 用户执行任务</span><br><span class="line">become_ask_pass=False  #禁用密码提示</span><br></pre></td></tr></table></figure><h2 id="Ansible-Ad-Hoc与常用模块"><a href="#Ansible-Ad-Hoc与常用模块" class="headerlink" title="Ansible Ad-Hoc与常用模块"></a>Ansible Ad-Hoc与常用模块</h2><h3 id="Ad-Hoc"><a href="#Ad-Hoc" class="headerlink" title="Ad-Hoc"></a>Ad-Hoc</h3><p>ad-hoc即为命令行模式，执行完即结束。</p><p><strong>命令语法结构：</strong></p><p><code>ansible &#39;groups&#39; -m command -a &#39;df -h&#39;</code>,其含义如下图：</p><img src="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="/yyg/e80721f/2.png" title="image-20250407162815663"><p><strong>执行过程：</strong></p><ol><li>加载配置文件，默认<code>/etc/ansible/ansible.cfg</code>;</li><li>查找对应的主机配置文件，找到要执行的主机或者组：</li><li>加载对应的模块文件，如<code>command</code>;</li><li>通过<code>ansible</code>将模块或命令生成对应的临时<code>py</code>文件，并将该文件传输至远程服务器对应执行用户<code>$HOME/.ansible/tmp/ansible-tmp-number/XXX.PY</code>;</li><li>远程主机执行该文件；</li><li>执行并返回结果；</li><li>删除临时<code>py</code>文件，<code>sleep 0</code>退出；</li></ol><p><strong>执行状态：</strong></p><p>使用ad-hoc执行一次远程命令，注意观察返回结果的颜色：</p><ul><li>绿色：代表受控节点没有被修改</li><li>黄色：代表受控节点发现变更</li><li>红色：代表出现了故障，注意查看提示</li></ul><h3 id="常用模块"><a href="#常用模块" class="headerlink" title="常用模块"></a>常用模块</h3><h4 id="command模块"><a href="#command模块" class="headerlink" title="command模块"></a>command模块</h4><p><strong>基本格式和常用参数</strong></p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">ansible &#x27;组/IP&#x27; -m command -a &#x27;[参数] 命令&#x27;</span><br></pre></td></tr></table></figure><div class="table-container"><table><thead><tr><th style="text-align:left">参数</th><th style="text-align:left">选项</th><th style="text-align:left">含义</th></tr></thead><tbody><tr><td style="text-align:left">chdir</td><td style="text-align:left">chdir /opt</td><td style="text-align:left">执行ansible时，切换到指定目录</td></tr><tr><td style="text-align:left">creates</td><td style="text-align:left">creates /data/file</td><td style="text-align:left">如果文件存在，则跳过执行</td></tr><tr><td style="text-align:left">removes</td><td style="text-align:left">removes /data/file</td><td style="text-align:left">如果文件存在，则执行</td></tr></tbody></table></div><blockquote><p>[root@121 ~]# ansible webservers -m command -a ‘ls /root’</p><p>192.168.1.122 | CHANGED | rc=0 &gt;&gt;<br>anaconda-ks.cfg<br>test.txt<br>192.168.1.121 | CHANGED | rc=0 &gt;&gt;<br>anaconda-ks.cfg<br>test</p><p>[root@121 ~]# ansible webservers -m <strong>command</strong> -a ‘<strong>creates</strong>=/root/test.txt hostname’<br>192.168.1.122 | SUCCESS | rc=0 &gt;&gt;<br>skipped, since /root/test.txt exists<br>192.168.1.121 | CHANGED | rc=0 &gt;&gt;<br>121<br>[root@121 ~]# ansible webservers -m <strong>command</strong> -a ‘<strong>removes</strong>=/root/test.txt hostname’<br>192.168.1.122 | CHANGED | rc=0 &gt;&gt;<br>122<br>192.168.1.121 | SUCCESS | rc=0 &gt;&gt;<br>skipped, since /root/test.txt does not exist<br>[root@121 ~]#</p></blockquote><p><mark>shell模块支持管道符，command模块不支持</mark></p><h4 id="shell模块"><a href="#shell模块" class="headerlink" title="shell模块"></a>shell模块</h4><p><strong>基本格式和常用参数</strong></p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">ansible &#x27;组/IP/all&#x27; -m shell -a &#x27;[参数] 命令&#x27;</span><br></pre></td></tr></table></figure><blockquote><p>ansible webservers -m shell -a ‘ps aux | grep sshd’</p></blockquote><h4 id="yum-apt-模块"><a href="#yum-apt-模块" class="headerlink" title="yum/apt 模块"></a>yum/apt 模块</h4><div class="table-container"><table><thead><tr><th>常用参数</th><th>功能</th></tr></thead><tbody><tr><td>name</td><td>需要安装的服务名</td></tr><tr><td>state=present(缺省值)/absent</td><td>状态，abasent表示卸载服务</td></tr></tbody></table></div><blockquote><h1 id="安装服务"><a href="#安装服务" class="headerlink" title="安装服务"></a>安装服务</h1><p>ansible webservers -m yum -a ‘name=httpd’</p><h1 id="卸载服务"><a href="#卸载服务" class="headerlink" title="卸载服务"></a>卸载服务</h1><p>ansible webservers -m yum -a ‘name=httpd state=absent’</p></blockquote><h4 id="copy模块"><a href="#copy模块" class="headerlink" title="copy模块"></a>copy模块</h4><p><strong>基本格式和常用参数</strong></p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">ansible &lt; &gt; -m copy -a &#x27;src=   dest=   [owner= ] [mode=]   &#x27;</span><br></pre></td></tr></table></figure><div class="table-container"><table><thead><tr><th>常用参数</th><th>功能</th><th>注意事项</th></tr></thead><tbody><tr><td>src</td><td>指定源文件的路径（支持目录或文件）</td><td>若源为目录，目标也需为目录</td></tr><tr><td>dest</td><td>指定目标文件的位置（必须为绝对路径）</td><td>1. 若源为目录，目标需为目录2. 目标文件已存在时会覆盖原内容</td></tr><tr><td>mode</td><td>设置目标文件的权限</td><td></td></tr><tr><td>owner</td><td>设置目标文件的属主</td><td></td></tr><tr><td>group</td><td>设置目标文件的属组</td><td></td></tr><tr><td>content</td><td>直接指定目标文件的内容</td><td>不可与 <code>src</code> 参数同时使用</td></tr></tbody></table></div><blockquote><p>ansible dbservers -m copy -a ‘src=/etc/fstab dest=/opt/fstab.bak owner=root mode=640’<br>ansible dbservers -a ‘ls -l /opt’<br>ansible dbservers -a ‘cat /opt/fstab.bak’</p></blockquote><h4 id="systemd-模块"><a href="#systemd-模块" class="headerlink" title="systemd 模块"></a>systemd 模块</h4><div class="table-container"><table><thead><tr><th>常用参数</th><th>功能</th></tr></thead><tbody><tr><td>name</td><td>指定需要控制的服务名称</td></tr><tr><td>state</td><td>指定服务状态，可选值：<code>stopped</code>、<code>started</code>、<code>reloaded</code>、<code>restarted</code>、<code>status</code></td></tr><tr><td>enabled</td><td>设置服务是否开机启动，<code>yes</code> 为启动，<code>no</code> 为不启动</td></tr><tr><td>daemon_reload</td><td>设为 <code>yes</code> 时重启 systemd 服务，使 unit 文件生效</td></tr></tbody></table></div><blockquote><p>ansible webservers -m systemd -a ‘name=firewalld state=started enabled=yes’</p></blockquote><h4 id="file模块"><a href="#file模块" class="headerlink" title="file模块"></a>file模块</h4><p><strong>基本格式和常用参数</strong></p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">ansible &lt; &gt; -m file -a &#x27;&#x27;</span><br></pre></td></tr></table></figure><div class="table-container"><table><thead><tr><th style="text-align:left">常用参数</th><th>功能</th><th>备注</th></tr></thead><tbody><tr><td style="text-align:left">path</td><td>指定远程服务器的路径</td><td>也可写成 <code>dest</code> 或 <code>name</code></td></tr><tr><td style="text-align:left">state</td><td>定义操作类型：- <code>directory</code>：创建目录- <code>touch</code>：创建文件- <code>link</code>：创建软链接- <code>hard</code>：创建硬链接- <code>absent</code>：删除目录/文件/链接</td><td></td></tr><tr><td style="text-align:left">mode</td><td>设置文件/目录权限</td><td>默认值：- 文件 <code>644</code>- 目录 <code>755</code></td></tr><tr><td style="text-align:left">owner</td><td>设置属主</td><td>默认 <code>root</code></td></tr><tr><td style="text-align:left">group</td><td>设置属组</td><td>默认 <code>root</code></td></tr><tr><td style="text-align:left">recurse</td><td>递归修改</td><td>yes或no</td></tr><tr><td style="text-align:left">src</td><td>目标主机上的源文件（与 <code>copy</code> 模块不同）</td></tr></tbody></table></div><blockquote><h1 id="创建-data目录，授权test属组"><a href="#创建-data目录，授权test属组" class="headerlink" title="创建/data目录，授权test属组"></a>创建/data目录，授权test属组</h1><p>ansible webservers -m file -a ‘owner=test group=test mode=644 path=/data state=directory recurse=yes ‘</p></blockquote><h4 id="group模块"><a href="#group模块" class="headerlink" title="group模块"></a>group模块</h4><p><strong>基本格式和常用参数</strong></p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">ansible &lt;组/IP/all&gt; -m group -a &#x27; &#x27;</span><br></pre></td></tr></table></figure><div class="table-container"><table><thead><tr><th><strong>参数</strong></th><th><strong>功能</strong></th><th><strong>可选值/说明</strong></th></tr></thead><tbody><tr><td>name</td><td>指定用户名（必选参数）</td><td></td></tr><tr><td>state</td><td>控制账号的创建或删除</td><td><code>present</code>：创建账号<code>absent</code>：删除账号</td></tr><tr><td>system</td><td>指定是否为系统账号</td><td><code>yes</code>：系统账号<code>no</code>：普通账号</td></tr><tr><td>gid</td><td>指定组ID（修改用户所属组）</td><td>数值格式（如 <code>1001</code>）</td></tr></tbody></table></div><blockquote><p>ansible webservers -m group -a ‘name=www gid=666 state=present ‘</p></blockquote><h4 id="user模块"><a href="#user模块" class="headerlink" title="user模块"></a>user模块</h4><p><strong>基本格式和常用参数</strong></p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">ansible &lt;组/IP/all&gt; -m user -a &#x27; &#x27;</span><br></pre></td></tr></table></figure><div class="table-container"><table><thead><tr><th><strong>参数</strong></th><th><strong>功能</strong></th><th><strong>可选值/说明</strong></th></tr></thead><tbody><tr><td><code>name</code></td><td>指定用户名（必选）</td><td></td></tr><tr><td><code>state</code></td><td>控制账号的创建或删除</td><td><code>present</code>：创建<code>absent</code>：删除</td></tr><tr><td><code>system</code></td><td>指定是否为系统账号</td><td><code>yes</code>：系统账号（如 <code>mysql</code>）<code>no</code>：普通账号</td></tr><tr><td><code>uid</code></td><td>指定用户UID</td><td>数值（如 <code>1001</code>），需唯一</td></tr><tr><td><code>group</code></td><td>指定用户基本组</td><td>组名或GID（需提前存在）</td></tr><tr><td><code>groups</code></td><td>指定用户所属附加组</td><td>组名列表（如 <code>groups=wheel,admin</code>）</td></tr><tr><td><code>shell</code></td><td>设置用户默认shell</td><td>路径（如 <code>/bin/bash</code>）</td></tr><tr><td><code>create_home</code></td><td>是否创建家目录</td><td><code>yes</code>：自动创建<code>no</code>：不创建（默认行为可能依赖系统）</td></tr><tr><td><code>password</code></td><td>设置用户密码</td><td><strong>建议使用加密后的字符串</strong>（如 <code>password=&quot;$6$加密字符串&quot;</code>）</td></tr><tr><td><code>remove</code></td><td>删除用户时是否同时删除家目录（需<code>state=absent</code>）</td><td><code>yes</code>：删除家目录<code>no</code>：保留</td></tr></tbody></table></div><p>1、 创建www用户，指定uid666,基本组www</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">ansible webservers -m user -a &#x27;name=www uid=666 group=www shell=/sbin/nologin create home=no&#x27;</span><br></pre></td></tr></table></figure><p>2、 创建db用户，基本组是root,附加组，adm,sys</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">ansible webservers -m user -a &#x27;name=db group=root groups=adm,sys append=yes shell=/bin/bash create_home=yes&#x27;</span><br></pre></td></tr></table></figure><p>3、 创建一个ddd用户，密码123，需要正常登录系统</p><p>（1）密码加密</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">ansible localhost -m debug -a &quot;msg=&#123;&#123; &#x27;123&#x27; | password_hash(&#x27;sha512&#x27;, &#x27;salt123&#x27;) &#125;&#125;&quot;</span><br></pre></td></tr></table></figure><div class="table-container"><table><thead><tr><th>参数</th><th>作用</th><th>注意事项</th></tr></thead><tbody><tr><td><code>sha512</code></td><td>指定哈希算法（推荐）</td><td>支持 <code>sha256</code>/<code>md5</code> 等，但 <code>sha512</code> 更安全 2</td></tr><tr><td><code>salt123</code></td><td>自定义盐值</td><td>盐值需为字母/数字，含 <code>-</code> 或 <code>_</code> 会导致哈希失败（返回 <code>*0</code>） 5</td></tr><tr><td><code>password_hash</code> 过滤器</td><td>将明文密码转为加密字符串</td><td>需通过 <code>&#123;&#123; &#125;&#125;</code> 调用且与变量用 `</td></tr></tbody></table></div><blockquote><p>localhost | SUCCESS =&gt; {<br>“msg”: “<strong>$6$salt123$c806NQq6Oqk29MjZdmHxTw7sK3BB1K498o7sZC47UiwQmjx5NJyi5ZhWWGngXf3UfyELHQ1wRJ//oW/Y94azv0</strong>“<br>}</p></blockquote><p>（2）撰写创建命令，完成创建</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">ansible webservers -m user -a &quot;name=ddd password=第一步获取的加密密码 shell=/bin/bash create_home=yes&quot;</span><br></pre></td></tr></table></figure><p>4、 创建一个dev用户，并为其生成对应的秘钥</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">ansible webservers -m user -a &#x27;name=dev generate_ssh_key=yes ssh_key_bits=2048 ssh_key_file=.ssh/id_rsa&#x27;</span><br></pre></td></tr></table></figure><h4 id="mount-模块"><a href="#mount-模块" class="headerlink" title="mount 模块"></a>mount 模块</h4><div class="table-container"><table><thead><tr><th>常用参数</th><th>功能</th></tr></thead><tbody><tr><td>src</td><td>指定要挂载的设备或分区路径。</td></tr><tr><td>path</td><td>指定要挂载到的目标路径。</td></tr><tr><td>fstype</td><td>指定要挂载的文件系统类型。</td></tr><tr><td>state</td><td>指定挂载状态，可选值为 <code>mounted</code>、（临时挂载）<code>present</code>（永久挂载）、<code>unmounted</code> （临时卸载）或 <code>absent</code>（卸载）。</td></tr><tr><td>opts</td><td>指定挂载选项，例如挂载选项或参数。</td></tr></tbody></table></div><blockquote><h1 id="将192-168-1-121上的-nfs目录挂载到192-168-1-122的-nfs目录"><a href="#将192-168-1-121上的-nfs目录挂载到192-168-1-122的-nfs目录" class="headerlink" title="将192.168.1.121上的/nfs目录挂载到192.168.1.122的/nfs目录"></a>将192.168.1.121上的/nfs目录挂载到192.168.1.122的/nfs目录</h1><p>ansible 192.168.1.122 -m mount -a ‘src=192.168.1.121:/nfs path=/nfs fstype=nfs opts=defaults state=present ‘</p></blockquote><h4 id="cron模块"><a href="#cron模块" class="headerlink" title="cron模块"></a>cron模块</h4><p><strong>基本格式和常用参数</strong></p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">ansible &lt;组/IP/all&gt; -m cron -a &#x27; &#x27;</span><br></pre></td></tr></table></figure><div class="table-container"><table><thead><tr><th>常用参数</th><th>功能</th></tr></thead><tbody><tr><td>minute/hour/day/month/weekday</td><td>分/时/日/月/周</td></tr><tr><td>job</td><td>任务计划要执行的命令</td></tr><tr><td>name</td><td>任务计划的名称</td></tr><tr><td>user</td><td>指定计划任务属于哪个用户，默认是root用户</td></tr><tr><td>state</td><td>present表示添加（可以省略），absent表示移除。</td></tr></tbody></table></div><blockquote><h1 id="添加一个每天19点执行-data-test-sh脚本的定时任务，任务名为script-test。"><a href="#添加一个每天19点执行-data-test-sh脚本的定时任务，任务名为script-test。" class="headerlink" title="添加一个每天19点执行/data/test.sh脚本的定时任务，任务名为script-test。"></a>添加一个每天19点执行/data/test.sh脚本的定时任务，任务名为script-test。</h1><p>ansible webservers -m cron -a ‘name=”script-test” hour=19 minute=00 job=”/bin/bash /data/test.sh” ‘</p><h1 id="注释该定时任务"><a href="#注释该定时任务" class="headerlink" title="注释该定时任务"></a>注释该定时任务</h1><p>ansible webservers -m cron -a ‘name=”script-test” hour=19 minute=00 job=”/bin/bash /data/test.sh” disabled=yes ‘</p><h1 id="删除该定时任务"><a href="#删除该定时任务" class="headerlink" title="删除该定时任务"></a>删除该定时任务</h1><p>ansible webservers -m cron -a ‘name=”script-test” hour=19 minute=00 job=”/bin/bash /data/test.sh” state=absent ‘</p></blockquote><h4 id="archive-模块"><a href="#archive-模块" class="headerlink" title="archive 模块"></a>archive 模块</h4><div class="table-container"><table><thead><tr><th>常用参数</th><th>功能</th></tr></thead><tbody><tr><td>path</td><td>指定要打包的源目录或文件的路径。</td></tr><tr><td>dest</td><td>指定打包文件的输出路径。</td></tr><tr><td>format</td><td>指定打包文件的格式，可以是 zip、tar、gz 或 bzip2。默认为 tar 格式。</td></tr><tr><td>remove</td><td>指定是否在打包文件之后，删除源目录或文件。可选值为 yes 或 no。默认为 no，即不删除源目录或文件。</td></tr></tbody></table></div><h4 id="unarchive-模块"><a href="#unarchive-模块" class="headerlink" title="unarchive 模块"></a>unarchive 模块</h4><div class="table-container"><table><thead><tr><th>常用参数</th><th>功能</th></tr></thead><tbody><tr><td><strong>copy</strong></td><td>指定是否将打包文件复制到远程节点以进行解压缩。</td></tr><tr><td><strong>remote_src</strong></td><td>(已弃用) 改用 <code>copy</code> 参数。</td></tr><tr><td><strong>src</strong></td><td>指定要解压缩的打包文件路径，可以是本地路径或远程路径。</td></tr><tr><td><strong>dest</strong></td><td>指定要将文件解压缩到的目标目录。</td></tr><tr><td><strong>creates</strong></td><td>指定一个文件路径，如果该文件已经存在，则不进行解压缩操作。</td></tr><tr><td><strong>remote_tmp</strong></td><td>用于指定远程节点上的临时目录。默认为 <code>/tmp</code>。</td></tr></tbody></table></div><blockquote><p>1、 将控制端的压缩包，解压到被控端：</p><p>ansible webservers -m unarchive -a ‘src=./test.tar.gz dest=/mnt’<br>2、 将被控端的压缩包解压到被控端：</p><p>ansible webservers -m unarchive -a ‘src=/tmp/config_vpn_new.zip dest=/mnt remote_src=yes’</p></blockquote><h4 id="lineinfile模块"><a href="#lineinfile模块" class="headerlink" title="lineinfile模块"></a>lineinfile模块</h4><p>含义：替换|追加|删除</p><div class="table-container"><table><thead><tr><th>参数</th><th>选项</th><th>含义</th></tr></thead><tbody><tr><td>path</td><td>无</td><td>指定要操作的目标文件路径</td></tr><tr><td>regexp</td><td>无</td><td>使用正则表达式匹配文件中的行</td></tr><tr><td>line</td><td>无</td><td>指定要修改或插入的新文本内容</td></tr><tr><td>insertafter</td><td>无</td><td>将文本插入到「正则匹配行」之后</td></tr><tr><td>insertbefore</td><td>无</td><td>将文本插入到「正则匹配行」之前</td></tr><tr><td>state</td><td>absent / present (默认)</td><td><code>absent</code>删除匹配行，<code>present</code>确保文本存在</td></tr><tr><td>backrefs</td><td>yes / no</td><td><code>yes</code>启用正则后向引用，<code>no</code>未匹配时不操作文件</td></tr><tr><td>backup</td><td>无</td><td>修改前是否创建备份文件（布尔值）</td></tr><tr><td>create</td><td>无</td><td>当目标文件不存在时是否创建新文件（布尔值）</td></tr></tbody></table></div><blockquote><p>1、替换httpd.conf文件中，Listen为Listen8080;</p><p>ansible webservers -m lineinfile -a ‘path=/etc/httpd/conf/httpd.conf regexp=”^Listen” line=”Listen 8080”‘</p><p>2、 给主机增加一个网关：</p><p>ansible webservers -m lineinfile -a ‘path=/etc/sysconfig/network-scripts/ifcfg-eth1 line=”GATEWAY=172.16.1.200”‘<br>3、 删除主机的网关：</p><p>ansible webservers -m lineinfile -a ‘path=/etc/sysconfig/network-scripts/ifcfg-ethl regexp=”^GATEWAY” state=absent’</p></blockquote><h2 id="Ansible-Playbook"><a href="#Ansible-Playbook" class="headerlink" title="Ansible Playbook"></a>Ansible Playbook</h2><p>playbook是一个由yml语法编写的文本文件，它由<code>play</code>和<code>task</code>两部分组成。<br><code>play</code>：主要定义要操作主机或者主机组。</p><p><code>task</code>：主要定义对主机或主机组具体执行的任务，可以是一个任务，也可以是多个任务(模块)。</p><p>playbook是由一个或多个play组成，一个play可以包含多个task任务。</p><p>可以理解为：使用多个不同的模块来共同完成一件事情。</p><h3 id="Playbook书写格式"><a href="#Playbook书写格式" class="headerlink" title="Playbook书写格式"></a>Playbook书写格式</h3><p>playbook是由yml语法书写，结构清晰，可读性强。</p><div class="table-container"><table><thead><tr><th>语法</th><th>描述</th></tr></thead><tbody><tr><td>缩进</td><td><strong>YAML</strong> 使用固定的缩进风格表示层级结构，每个缩进由<mark>两个空格</mark>组成，不能使用 <strong>tabs</strong></td></tr><tr><td>冒号</td><td>以冒号结尾的除外，其他所有冒号后面必须有空格</td></tr><tr><td>短横线</td><td>表示列表项，使用一个短横杠加一个空格。多个项使用同样的缩进级别作为同一列表</td></tr></tbody></table></div><h3 id="Playbook应用实例："><a href="#Playbook应用实例：" class="headerlink" title="Playbook应用实例："></a>Playbook应用实例：</h3><h4 id="安装nignx"><a href="#安装nignx" class="headerlink" title="安装nignx"></a>安装nignx</h4><p>（1）撰写playbook文件</p><figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="string">vi</span> <span class="string">nginx.yml</span></span><br><span class="line"></span><br><span class="line"><span class="bullet">-</span> <span class="attr">hosts:</span> <span class="string">webservers</span></span><br><span class="line">  <span class="attr">tasks:</span></span><br><span class="line">    <span class="bullet">-</span> <span class="attr">name:</span> <span class="string">安装nignx</span></span><br><span class="line">      <span class="attr">yum:</span></span><br><span class="line">        <span class="attr">name:</span> <span class="string">nginx</span></span><br><span class="line">        <span class="attr">state:</span> <span class="string">present</span></span><br><span class="line">    <span class="bullet">-</span> <span class="attr">name:</span> <span class="string">启动nignx</span></span><br><span class="line">      <span class="attr">systemd:</span></span><br><span class="line">        <span class="attr">name:</span> <span class="string">nginx</span></span><br><span class="line">        <span class="attr">state:</span> <span class="string">started</span></span><br><span class="line">        <span class="attr">enabled:</span> <span class="literal">yes</span></span><br></pre></td></tr></table></figure><p>（2）检查文件是否有语法错误</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">ansible-playbook --syntax nginx.yml</span><br><span class="line">或</span><br><span class="line">ansible-playbook --syntax-check nginx.yml</span><br></pre></td></tr></table></figure><blockquote><p>[root@121 data]# ansible-playbook —syntax nginx.yml</p><p>playbook: nginx.yml</p></blockquote><p>（3）进行模拟执行</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">ansible-playbook -C nginx.yml</span><br></pre></td></tr></table></figure><blockquote><p>[root@121 data]# ansible-playbook -C nginx.yml</p><p>PLAY [webservers] <strong><strong><strong><strong><strong><strong><strong><strong><strong><strong><strong><strong><strong><strong><strong>**</strong></strong></strong></strong></strong></strong></strong></strong></strong></strong></strong></strong></strong></strong></strong></p><p>TASK [Gathering Facts] <strong><strong><strong><strong><strong><strong><strong><strong><strong><strong><strong><strong><strong><strong>*</strong></strong></strong></strong></strong></strong></strong></strong></strong></strong></strong></strong></strong></strong><br>ok: [192.168.1.122]<br>ok: [192.168.1.121]</p><p>TASK [安装nignx] <strong><strong><strong><strong><strong><strong><strong><strong><strong><strong><strong><strong><strong><strong><strong><strong>*</strong></strong></strong></strong></strong></strong></strong></strong></strong></strong></strong></strong></strong></strong></strong></strong><br>changed: [192.168.1.122]<br>changed: [192.168.1.121]</p><p>TASK [启动nignx] <strong><strong><strong><strong><strong><strong><strong><strong><strong><strong><strong><strong><strong><strong><strong><strong>*</strong></strong></strong></strong></strong></strong></strong></strong></strong></strong></strong></strong></strong></strong></strong></strong><br>changed: [192.168.1.121]<br>changed: [192.168.1.122]</p><p>PLAY RECAP <strong><strong><strong><strong><strong><strong><strong><strong><strong><strong><strong><strong><strong><strong><strong><strong><strong>*</strong></strong></strong></strong></strong></strong></strong></strong></strong></strong></strong></strong></strong></strong></strong></strong></strong><br>192.168.1.121 : ok=3 changed=2 unreachable=0 failed=0 skipped=0 rescued=0 ignored=0<br>192.168.1.122 : ok=3 changed=2 unreachable=0 failed=0 skipped=0 rescued=0 ignored=0</p></blockquote><p>（4）实际执行</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">ansible-playbook nginx.yml</span><br></pre></td></tr></table></figure><blockquote><p>[root@121 data]# ansible-playbook nginx.yml</p><p>PLAY [webservers] <strong><strong><strong><strong><strong><strong><strong><strong><strong><strong><strong><strong><strong><strong><strong>**</strong></strong></strong></strong></strong></strong></strong></strong></strong></strong></strong></strong></strong></strong></strong></p><p>TASK [Gathering Facts] <strong><strong><strong><strong><strong><strong><strong><strong><strong><strong><strong><strong><strong><strong>*</strong></strong></strong></strong></strong></strong></strong></strong></strong></strong></strong></strong></strong></strong><br>ok: [192.168.1.122]<br>ok: [192.168.1.121]</p><p>TASK [安装nignx] <strong><strong><strong><strong><strong><strong><strong><strong><strong><strong><strong><strong><strong><strong><strong><em>*</em></strong></strong></strong></strong></strong></strong></strong></strong></strong></strong></strong></strong></strong></strong></strong> **<br>changed: [192.168.1.121]<br>changed: [192.168.1.122]</p><p>TASK [启动nignx] <strong><strong><strong><strong><strong><strong><strong><strong><strong><strong><strong><strong><strong><strong><strong><strong>*</strong></strong></strong></strong></strong></strong></strong></strong></strong></strong></strong></strong></strong></strong></strong></strong><br>changed: [192.168.1.122]<br>changed: [192.168.1.121]</p><p>PLAY RECAP <strong><strong><strong><strong><strong><strong><strong><strong><strong><strong><strong><strong><strong><strong><strong><strong><strong>*</strong></strong></strong></strong></strong></strong></strong></strong></strong></strong></strong></strong></strong></strong></strong></strong></strong><br>192.168.1.121 : ok=3 changed=2 unreachable=0 failed=0 skipped=0 rescued=0 ignored=0<br>192.168.1.122 : ok=3 changed=2 unreachable=0 failed=0 skipped=0 rescued=0 ignored=0</p></blockquote><h4 id="安装NFS服务"><a href="#安装NFS服务" class="headerlink" title="安装NFS服务"></a>安装NFS服务</h4><p>任务顺序：</p><ul><li>下载nfs程序</li><li>挂载nfs配置文件（设置触发器，修改配置文件后，使配置重启生效）</li><li>初始化设置nfs（设置用户、组、授权）</li><li>启动nfs</li></ul><blockquote><p>设置的触发器是handles，在第二步中添加notify信息，当配置文件修改时，handles获取notify中的信息，重启nfs服务，使得配置重新生效</p></blockquote><p>文件准备：</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta prompt_">#</span><span class="language-bash">创建目录存放该项目</span></span><br><span class="line">mkdir nfs</span><br><span class="line"><span class="meta prompt_">#</span><span class="language-bash">创建nfs配置文件，将以下内容写入</span></span><br><span class="line">vi exports.j2</span><br><span class="line"></span><br><span class="line">/ansible_test 192.168.1.0/24(rw,all_squash,anonuid=7777,anongid=7777)</span><br><span class="line"></span><br></pre></td></tr></table></figure><blockquote><p>将ansible的配置文件<code>ansible.cfg</code>和<code>hosts</code>，提前放置在该项目目录下</p></blockquote><p>创建nfs剧本</p><figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br></pre></td><td class="code"><pre><span class="line"><span class="string">vi</span> <span class="string">nfs.yml</span></span><br><span class="line"></span><br><span class="line"><span class="bullet">-</span> <span class="attr">hosts:</span> <span class="string">webservers</span></span><br><span class="line">  <span class="attr">tasks:</span></span><br><span class="line">    <span class="bullet">-</span> <span class="attr">name:</span> <span class="string">download</span> <span class="string">nfs</span></span><br><span class="line">      <span class="attr">yum:</span></span><br><span class="line">        <span class="attr">name:</span> <span class="string">nfs-utils</span></span><br><span class="line">        <span class="attr">state:</span> <span class="string">present</span></span><br><span class="line">    <span class="bullet">-</span> <span class="attr">name:</span> <span class="string">configure</span> <span class="string">nfs</span></span><br><span class="line">      <span class="attr">copy:</span></span><br><span class="line">        <span class="attr">src:</span> <span class="string">./exports.j2</span></span><br><span class="line">        <span class="attr">dest:</span> <span class="string">/etc/exports</span></span><br><span class="line">      <span class="attr">notify:</span> <span class="string">restart</span> <span class="string">nfs</span>  <span class="comment">#触发信息</span></span><br><span class="line">    <span class="bullet">-</span> <span class="attr">name:</span> <span class="string">init</span> <span class="string">group</span></span><br><span class="line">      <span class="attr">group:</span></span><br><span class="line">        <span class="attr">name:</span> <span class="string">bbb</span></span><br><span class="line">        <span class="attr">gid:</span> <span class="number">7777</span></span><br><span class="line">    <span class="bullet">-</span> <span class="attr">name:</span> <span class="string">init</span> <span class="string">user</span></span><br><span class="line">      <span class="attr">user:</span></span><br><span class="line">        <span class="attr">name:</span> <span class="string">bbb</span></span><br><span class="line">        <span class="attr">uid:</span> <span class="number">7777</span></span><br><span class="line">        <span class="attr">group:</span> <span class="string">bbb</span></span><br><span class="line">        <span class="attr">shell:</span> <span class="string">/sbin/nologin</span></span><br><span class="line">        <span class="attr">create_home:</span> <span class="literal">no</span></span><br><span class="line">    <span class="bullet">-</span> <span class="attr">name:</span> <span class="string">init</span> <span class="string">directory</span></span><br><span class="line">      <span class="attr">file:</span></span><br><span class="line">        <span class="attr">path:</span> <span class="string">/ansible_test</span></span><br><span class="line">        <span class="attr">state:</span> <span class="string">directory</span></span><br><span class="line">        <span class="attr">owner:</span> <span class="string">bbb</span></span><br><span class="line">        <span class="attr">group:</span> <span class="string">bbb</span></span><br><span class="line">        <span class="attr">mode:</span> <span class="string">&quot;0755&quot;</span></span><br><span class="line">    <span class="bullet">-</span> <span class="attr">name:</span> <span class="string">start</span> <span class="string">nfs</span></span><br><span class="line">      <span class="attr">systemd:</span></span><br><span class="line">        <span class="attr">name:</span> <span class="string">nfs</span></span><br><span class="line">        <span class="attr">state:</span> <span class="string">started</span></span><br><span class="line">        <span class="attr">enabled:</span> <span class="literal">yes</span></span><br><span class="line">  <span class="attr">handlers:</span>  <span class="comment">#触发器</span></span><br><span class="line">    <span class="bullet">-</span> <span class="attr">name:</span> <span class="string">restart</span> <span class="string">nfs</span></span><br><span class="line">      <span class="attr">systemd:</span></span><br><span class="line">        <span class="attr">name:</span> <span class="string">nfs</span></span><br><span class="line">        <span class="attr">state:</span> <span class="string">restarted</span></span><br><span class="line"></span><br></pre></td></tr></table></figure><p>执行并验证</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">ansible-playbook --syntax-check nfs.yml</span><br><span class="line">ansible-playbook -C nfs.yml</span><br><span class="line">ansible-playbook nfs.yml</span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_">#</span><span class="language-bash">查看nfs服务</span></span><br><span class="line">showmount -e 192.168.1.121</span><br><span class="line">showmount -e 192.168.1.122</span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_">#</span><span class="language-bash">挂载测试</span></span><br><span class="line">mount -t nfs 192.168.1.121:/ansible_test /data/test</span><br><span class="line">mount -t nfs 192.168.1.122:/ansible_test /data/test1</span><br></pre></td></tr></table></figure><blockquote><p>[root@121 ~]# df -h<br>文件系统 容量 已用 可用 已用% 挂载点<br>devtmpfs 898M 0 898M 0% /dev<br>tmpfs 910M 0 910M 0% /dev/shm<br>tmpfs 910M 9.7M 901M 2% /run<br>tmpfs 910M 0 910M 0% /sys/fs/cgroup<br>/dev/mapper/centos-root 17G 1.7G 16G 10% /<br>/dev/sda1 1014M 153M 862M 16% /boot<br>tmpfs 182M 0 182M 0% /run/user/0<br>192.168.1.121:/ansible_test 17G 1.7G 16G 10% /data/test<br>192.168.1.122:/ansible_test 17G 2.2G 15G 13% /data/test1</p></blockquote><h4 id="安装rsync服务"><a href="#安装rsync服务" class="headerlink" title="安装rsync服务"></a>安装rsync服务</h4><h5 id="rsync服务端："><a href="#rsync服务端：" class="headerlink" title="rsync服务端："></a>rsync服务端：</h5><p>任务顺序：</p><ul><li>下载rsync程序</li><li>挂载rsync配置文件（设置触发器，修改配置文件后，使配置重启生效）</li><li>初始化设置rsync（设置用户、组、授权）</li><li>创建虚拟用户和密码</li><li>启动rsync</li></ul><blockquote><p>设置的触发器是handles，当配置文件或虚拟用户密码修改时，handles获取notify中的信息，重启rsync服务，使得配置重新生效</p></blockquote><p>文件准备：</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta prompt_">#</span><span class="language-bash">创建目录存放该项目</span></span><br><span class="line">mkdir rsync</span><br><span class="line"><span class="meta prompt_">#</span><span class="language-bash">复制rsync配置文件rsyncd.conf并修改（可先手动下载rsync，拷贝配置文件后再卸载，也可直接使用以下内容）</span></span><br><span class="line"></span><br><span class="line">uid = ansible_www</span><br><span class="line">gid = ansible_www</span><br><span class="line">port = 873</span><br><span class="line">fake super = yes</span><br><span class="line">use chroot = yes</span><br><span class="line">max connections = 4</span><br><span class="line">timeout = 900</span><br><span class="line">read only = false</span><br><span class="line">list = false</span><br><span class="line">auth users = rsync_backup</span><br><span class="line">secrets file = /etc/rsync.passwd</span><br><span class="line">log file = /var/log/rsyncd.log</span><br><span class="line">[backup]</span><br><span class="line">path = /backup</span><br></pre></td></tr></table></figure><blockquote><p>将ansible的配置文件<code>ansible.cfg</code>和<code>hosts</code>，提前放置在该项目目录下</p></blockquote><p>创建rsync剧本</p><figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br></pre></td><td class="code"><pre><span class="line"><span class="string">vi</span> <span class="string">rsync.yml</span></span><br><span class="line"></span><br><span class="line"><span class="bullet">-</span> <span class="attr">hosts:</span> <span class="string">webservers</span></span><br><span class="line">  <span class="attr">tasks:</span></span><br><span class="line">    <span class="bullet">-</span> <span class="attr">name:</span> <span class="string">download</span> <span class="string">rsync</span></span><br><span class="line">      <span class="attr">yum:</span></span><br><span class="line">        <span class="attr">name:</span> <span class="string">rsync</span></span><br><span class="line">        <span class="attr">state:</span> <span class="string">present</span></span><br><span class="line">    <span class="bullet">-</span> <span class="attr">name:</span> <span class="string">configure</span> <span class="string">rsync</span></span><br><span class="line">      <span class="attr">copy:</span></span><br><span class="line">        <span class="attr">src:</span> <span class="string">./rsyncd.conf</span></span><br><span class="line">        <span class="attr">dest:</span> <span class="string">/etc/rsyncd.conf</span></span><br><span class="line">        <span class="attr">owner:</span> <span class="string">root</span></span><br><span class="line">        <span class="attr">group:</span> <span class="string">root</span></span><br><span class="line">        <span class="attr">mode:</span> <span class="string">&quot;0644&quot;</span></span><br><span class="line">      <span class="attr">notify:</span> <span class="string">restart</span> <span class="string">rsync</span></span><br><span class="line">    <span class="bullet">-</span> <span class="attr">name:</span> <span class="string">init</span> <span class="string">group</span></span><br><span class="line">      <span class="attr">group:</span></span><br><span class="line">        <span class="attr">name:</span> <span class="string">ansible_www</span></span><br><span class="line">        <span class="attr">gid:</span> <span class="number">8888</span></span><br><span class="line">    <span class="bullet">-</span> <span class="attr">name:</span> <span class="string">init</span> <span class="string">user</span></span><br><span class="line">      <span class="attr">user:</span></span><br><span class="line">        <span class="attr">name:</span> <span class="string">ansible_www</span></span><br><span class="line">        <span class="attr">uid:</span> <span class="number">8888</span></span><br><span class="line">        <span class="attr">group:</span> <span class="string">ansible_www</span></span><br><span class="line">        <span class="attr">shell:</span> <span class="string">/sbin/nologin</span></span><br><span class="line">        <span class="attr">create_home:</span> <span class="literal">no</span></span><br><span class="line">    <span class="bullet">-</span> <span class="attr">name:</span> <span class="string">init</span> <span class="string">directory</span></span><br><span class="line">      <span class="attr">file:</span></span><br><span class="line">        <span class="attr">path:</span> <span class="string">/backup</span></span><br><span class="line">        <span class="attr">state:</span> <span class="string">directory</span></span><br><span class="line">        <span class="attr">owner:</span> <span class="string">ansible_www</span></span><br><span class="line">        <span class="attr">group:</span> <span class="string">ansible_www</span></span><br><span class="line">        <span class="attr">mode:</span> <span class="string">&quot;0755&quot;</span></span><br><span class="line">        <span class="attr">recurse:</span> <span class="literal">yes</span></span><br><span class="line">    <span class="bullet">-</span> <span class="attr">name:</span> <span class="string">init</span> <span class="string">rsync</span> <span class="string">user</span> <span class="string">passwd</span></span><br><span class="line">      <span class="attr">copy:</span></span><br><span class="line">        <span class="attr">content:</span> <span class="string">&quot;rsync_backup:123456&quot;</span></span><br><span class="line">        <span class="attr">dest:</span> <span class="string">/etc/rsync.passwd</span></span><br><span class="line">        <span class="attr">owner:</span> <span class="string">root</span></span><br><span class="line">        <span class="attr">group:</span> <span class="string">root</span></span><br><span class="line">        <span class="attr">mode:</span> <span class="number">0600</span></span><br><span class="line">      <span class="attr">notify:</span> <span class="string">restart</span> <span class="string">rsync</span></span><br><span class="line">    <span class="bullet">-</span> <span class="attr">name:</span> <span class="string">start</span> <span class="string">rsync</span></span><br><span class="line">      <span class="attr">systemd:</span></span><br><span class="line">        <span class="attr">name:</span> <span class="string">rsyncd</span></span><br><span class="line">        <span class="attr">state:</span> <span class="string">started</span></span><br><span class="line">        <span class="attr">enabled:</span> <span class="literal">yes</span></span><br><span class="line">  <span class="attr">handlers:</span></span><br><span class="line">    <span class="bullet">-</span> <span class="attr">name:</span> <span class="string">restart</span> <span class="string">rsync</span></span><br><span class="line">      <span class="attr">systemd:</span></span><br><span class="line">        <span class="attr">name:</span> <span class="string">rsyncd</span></span><br><span class="line">        <span class="attr">state:</span> <span class="string">restarted</span></span><br></pre></td></tr></table></figure><p>执行并验证</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">ansible-playbook --syntax-check rsync.yml </span><br><span class="line">ansible-playbook -C rsync.yml </span><br><span class="line">ansible-playbook rsync.yml  </span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_">#</span><span class="language-bash">验证</span></span><br><span class="line">rsync -avz host_group rsync_backup@192.168.1.122::backup</span><br></pre></td></tr></table></figure><h5 id="rsync客户端："><a href="#rsync客户端：" class="headerlink" title="rsync客户端："></a>rsync客户端：</h5><p>任务顺序：</p><ul><li>将脚本推送至被控端指定路径下</li><li>配置定时任务</li></ul><p>创建rsync-client剧本</p><figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line"><span class="string">vi</span> <span class="string">rsync-client.yml</span></span><br><span class="line"></span><br><span class="line"><span class="bullet">-</span> <span class="attr">hosts:</span> <span class="string">localhost</span></span><br><span class="line">  <span class="attr">tasks:</span></span><br><span class="line">    <span class="bullet">-</span> <span class="attr">name:</span> <span class="string">create</span> <span class="string">scripts</span> <span class="string">path</span></span><br><span class="line">      <span class="attr">file:</span></span><br><span class="line">        <span class="attr">path:</span> <span class="string">/scripts</span></span><br><span class="line">        <span class="attr">owner:</span> <span class="string">root</span></span><br><span class="line">        <span class="attr">group:</span> <span class="string">root</span></span><br><span class="line">        <span class="attr">state:</span> <span class="string">directory</span></span><br><span class="line">        <span class="attr">mode:</span> <span class="number">0755</span></span><br><span class="line">    <span class="bullet">-</span> <span class="attr">name:</span> <span class="string">push</span> <span class="string">scripts</span></span><br><span class="line">      <span class="attr">copy:</span></span><br><span class="line">        <span class="attr">src:</span> <span class="string">test.sh</span></span><br><span class="line">        <span class="attr">dest:</span> <span class="string">/scripts/test.sh</span></span><br><span class="line">        <span class="attr">owner:</span> <span class="string">root</span></span><br><span class="line">        <span class="attr">group:</span> <span class="string">root</span></span><br><span class="line">        <span class="attr">mode:</span> <span class="number">0755</span></span><br><span class="line">    <span class="bullet">-</span> <span class="attr">name:</span> <span class="string">contable</span> <span class="string">job</span></span><br><span class="line">      <span class="attr">cron:</span></span><br><span class="line">        <span class="attr">name:</span> <span class="string">&quot;push backup data&quot;</span></span><br><span class="line">        <span class="attr">minute:</span> <span class="string">&quot;*/1&quot;</span></span><br><span class="line">        <span class="attr">job:</span> <span class="string">&quot;/bin/bash /scripts/test.sh &amp;&gt;/dev/null&quot;</span></span><br><span class="line"></span><br></pre></td></tr></table></figure><p>创建test.sh以供测试</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta prompt_">#</span><span class="language-bash">!/bin/bash</span></span><br><span class="line">RSYNC_PASSWORD=&quot;123456&quot;  rsync -avz /backup/ rsync_backup@192.168.1.122::backup</span><br></pre></td></tr></table></figure><p>查看是否有定时任务</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">crontab -l</span><br></pre></td></tr></table></figure><blockquote><h1 id="Ansible-push-backup-data"><a href="#Ansible-push-backup-data" class="headerlink" title="Ansible: push backup data"></a>Ansible: push backup data</h1><p><em>/1</em><em></em> * /bin/bash /scripts/test.sh &amp;&gt;/dev/null</p></blockquote><h4 id="使用Ansible部署多节点phpmyadmin"><a href="#使用Ansible部署多节点phpmyadmin" class="headerlink" title="使用Ansible部署多节点phpmyadmin"></a>使用Ansible部署多节点phpmyadmin</h4><h5 id="项目需求"><a href="#项目需求" class="headerlink" title="项目需求"></a>项目需求</h5><ul><li>使用LNMP部署phpmyadmin</li><li>nginx（Haproxy）作为负载均衡</li><li>Redis实现会话保持</li></ul><h5 id="主机规划"><a href="#主机规划" class="headerlink" title="主机规划"></a>主机规划</h5><div class="table-container"><table><thead><tr><th>主机名</th><th>ip</th><th>用途</th></tr></thead><tbody><tr><td>121</td><td>192.168.1.121</td><td>Ansible控制节点、nignx+PHP</td></tr><tr><td>122</td><td>192.168.1.122</td><td>Ansible受控节点、nignx+PHP</td></tr><tr><td>123</td><td>192.168.1.123</td><td>Ansible受控节点、nignx（Haproxy）</td></tr><tr><td>124</td><td>192.168.1.124</td><td>Ansible受控节点、nignx（Haproxy）</td></tr><tr><td>125</td><td>192.168.1.125</td><td>Ansible受控节点、Redis</td></tr></tbody></table></div><h5 id="部署步骤"><a href="#部署步骤" class="headerlink" title="部署步骤"></a>部署步骤</h5><h6 id="环境准备"><a href="#环境准备" class="headerlink" title="环境准备"></a>环境准备</h6><blockquote><p>121节点上要准备好Ansible，并设置以上5台机器免密登录，具体参照上方的配置过程。</p></blockquote><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta prompt_">#</span><span class="language-bash">创建存放项目文件目录</span></span><br><span class="line">mkdir /data/phpmyadmin</span><br><span class="line"><span class="meta prompt_">#</span><span class="language-bash">将ansible的配置文件`ansible.cfg`和`hosts`，复制到该phpmyadmin目录下，并修改配置</span></span><br><span class="line">cp /etc/ansible/ansible.cfg /data/phpmyadmin/ansible.cfg</span><br><span class="line"><span class="meta prompt_">#</span><span class="language-bash">修改配置文件中的路径，并取消注释</span></span><br><span class="line">inventory      = /data/phpmyadmin/host_group</span><br><span class="line"></span><br><span class="line">cp /etc/ansible/hosts /data/phpmyadmin/host_group</span><br><span class="line"><span class="meta prompt_">#</span><span class="language-bash">修改主机组</span></span><br><span class="line">[webservers]</span><br><span class="line">192.168.1.121</span><br><span class="line">192.168.1.122</span><br><span class="line"></span><br><span class="line">[dbservers]</span><br><span class="line">192.168.1.125</span><br><span class="line"></span><br><span class="line">[lbservers]</span><br><span class="line">192.168.1.123</span><br><span class="line">192.168.1.124</span><br></pre></td></tr></table></figure><p>确认配置文件的读取路径是否为当前项目下的<code>/data/phpmyadmin/ansible.cfg</code></p><blockquote><p>[root@121 phpmyadmin]# ansible —version<br>ansible 2.9.27<br>config file = <strong>/data/phpmyadmin/ansible.cfg</strong><br>configured module search path = [u’/root/.ansible/plugins/modules’, u’/usr/share/ansible/plugins/modules’]<br>ansible python module location = /usr/lib/python2.7/site-packages/ansible<br>executable location = /usr/bin/ansible<br>python version = 2.7.5 (default, Jun 28 2022, 15:30:04) [GCC 4.8.5 20150623 (Red Hat 4.8.5-44)]</p></blockquote><p>验证主机是否都可ping通</p><blockquote><p>[root@121 phpmyadmin]# ansible all -m ping<br>192.168.1.122 | SUCCESS =&gt; {<br>“ansible_facts”: {<br>“discovered_interpreter_python”: “/usr/bin/python”<br>},<br>“changed”: false,<br>“ping”: “pong”<br>}<br>192.168.1.124 | SUCCESS =&gt; {<br>“ansible_facts”: {<br>“discovered_interpreter_python”: “/usr/bin/python”<br>},<br>“changed”: false,<br>“ping”: “pong”<br>}<br>192.168.1.123 | SUCCESS =&gt; {<br>“ansible_facts”: {<br>“discovered_interpreter_python”: “/usr/bin/python”<br>},<br>“changed”: false,<br>“ping”: “pong”<br>}<br>192.168.1.125 | SUCCESS =&gt; {<br>“ansible_facts”: {<br>“discovered_interpreter_python”: “/usr/bin/python”<br>},<br>“changed”: false,<br>“ping”: “pong”<br>}<br>192.168.1.121 | SUCCESS =&gt; {<br>“ansible_facts”: {<br>“discovered_interpreter_python”: “/usr/bin/python”<br>},<br>“changed”: false,<br>“ping”: “pong”<br>}</p></blockquote><h6 id="安装Redis"><a href="#安装Redis" class="headerlink" title="安装Redis"></a>安装Redis</h6><p>任务顺序：</p><ul><li>下载redis程序</li><li>挂载redis配置文件（设置触发器，修改配置文件后，使配置重启生效）</li><li>启动redis</li></ul><blockquote><p>设置触发器handles，重启redis服务</p></blockquote><p>（1）将redis的配置文件<code>redis.conf</code>，拷贝至<code>/data/phpmyadmin/files</code>目录下</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">mkdir /data/phpmyadmin/files</span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">若无redis.conf文件可先在控制节点上使用命令yum -y install redis下载后再拷贝</span></span><br><span class="line">cp /etc/redis.conf /data/phpmyadmin/files</span><br><span class="line"><span class="meta prompt_">#</span><span class="language-bash">修改配置文件,将要安装redis的主机ip加入</span></span><br><span class="line">bind 127.0.0.1 192.168.1.125</span><br></pre></td></tr></table></figure><p>（2）</p><figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><span class="line"><span class="string">vi</span> <span class="string">redis.yml</span></span><br><span class="line"></span><br><span class="line"><span class="bullet">-</span> <span class="attr">hosts:</span> <span class="string">dbservers</span></span><br><span class="line">  <span class="attr">tasks:</span></span><br><span class="line">    <span class="bullet">-</span> <span class="attr">name:</span> <span class="string">download</span> <span class="string">redis</span></span><br><span class="line">      <span class="attr">yum:</span></span><br><span class="line">        <span class="attr">name:</span> <span class="string">redis</span></span><br><span class="line">        <span class="attr">state:</span> <span class="string">present</span></span><br><span class="line">    <span class="bullet">-</span> <span class="attr">name:</span> <span class="string">configure</span> <span class="string">redis</span></span><br><span class="line">      <span class="attr">copy:</span></span><br><span class="line">        <span class="attr">src:</span> <span class="string">./files/redis.conf</span></span><br><span class="line">        <span class="attr">dest:</span> <span class="string">/etc/redis.conf</span></span><br><span class="line">        <span class="attr">owner:</span> <span class="string">redis</span></span><br><span class="line">        <span class="attr">group:</span> <span class="string">root</span></span><br><span class="line">        <span class="attr">mode:</span> <span class="number">0640</span></span><br><span class="line">      <span class="attr">notify:</span> <span class="string">restart</span> <span class="string">redis</span></span><br><span class="line">    <span class="bullet">-</span> <span class="attr">name:</span> <span class="string">start</span> <span class="string">redis</span></span><br><span class="line">      <span class="attr">systemd:</span></span><br><span class="line">        <span class="attr">name:</span> <span class="string">redis</span></span><br><span class="line">        <span class="attr">state:</span> <span class="string">started</span></span><br><span class="line">        <span class="attr">enabled:</span> <span class="literal">yes</span></span><br><span class="line">  <span class="attr">handlers:</span></span><br><span class="line">    <span class="bullet">-</span> <span class="attr">name:</span> <span class="string">restart</span> <span class="string">redis</span></span><br><span class="line">      <span class="attr">systemd:</span></span><br><span class="line">        <span class="attr">name:</span> <span class="string">redis</span></span><br><span class="line">        <span class="attr">state:</span> <span class="string">restarted</span></span><br><span class="line"></span><br></pre></td></tr></table></figure><p>（3）安装并测试</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">ansible-playbook --syntax-check redis.yml</span><br><span class="line">ansible-playbook -C redis.yml</span><br><span class="line">ansible-playbook redis.yml</span><br><span class="line"><span class="meta prompt_">#</span><span class="language-bash">测试，之前控制节点121安装了redis，可直接在121上测试</span></span><br><span class="line"><span class="meta prompt_">#</span><span class="language-bash">注意防火墙端口</span></span><br><span class="line">redis-cli -h 192.168.1.125</span><br></pre></td></tr></table></figure><blockquote><p>[root@121 phpmyadmin]# redis-cli -h 192.168.1.125<br>192.168.1.125:6379&gt;</p></blockquote><h6 id="安装Mariadb"><a href="#安装Mariadb" class="headerlink" title="安装Mariadb"></a>安装Mariadb</h6><p>在192.168.1.125上安装Mariadb</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">yum -y install mariadb-server</span><br><span class="line">systemctl start mariadb</span><br><span class="line">systemctl enable mariadb</span><br><span class="line"><span class="meta prompt_">#</span><span class="language-bash">设置root用户密码</span></span><br><span class="line">mysqladmin -uroot password &#x27;123456&#x27;</span><br><span class="line"><span class="meta prompt_">#</span><span class="language-bash">登录创建用户</span></span><br><span class="line">mysql -uroot -p123456</span><br><span class="line"><span class="meta prompt_">#</span><span class="language-bash">创建数据库</span></span><br><span class="line">create database php_db;</span><br><span class="line"><span class="meta prompt_">#</span><span class="language-bash">创建数据库用户</span></span><br><span class="line">grant all on php_db.* to php_user@&#x27;%&#x27; identified by &#x27;123456&#x27;;</span><br></pre></td></tr></table></figure><h6 id="安装nginx、PHP"><a href="#安装nginx、PHP" class="headerlink" title="安装nginx、PHP"></a>安装nginx、PHP</h6><p>任务顺序：</p><ul><li>下载nginx、PHP程序</li><li>挂载nginx、PHP配置文件（设置触发器，修改配置文件后，使配置重启生效）</li><li>初始化设置nginx（设置用户、组、授权）</li><li>启动nginx、PHP</li></ul><blockquote><p>设置触发器handles，重启nginx、PHP服务</p></blockquote><p>（1）设置php7下载源，在121，122上执行</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">rpm -Uvh https://mirror.webtatic.com/yum/el7/epel-release.rpm</span><br><span class="line">rpm -Uvh https://mirror.webtatic.com/yum/el7/webtatic-release.rpm</span><br></pre></td></tr></table></figure><p>（2）将nginx、php的配置文件，拷贝至<code>/data/phpmyadmin/files</code>目录下，并修改配置</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta prompt_">#</span><span class="language-bash">nginx配置文件</span></span><br><span class="line">cp /etc/nginx/nginx.conf /data/phpmyadmin/files</span><br><span class="line"><span class="meta prompt_">#</span><span class="language-bash">php配置文件</span></span><br><span class="line">cp /etc/php.ini /data/phpmyadmin/files</span><br><span class="line">cp /etc/php-fpm.d/www.conf /data/phpmyadmin/files</span><br></pre></td></tr></table></figure><p>修改nginx配置文件，将用户修改为<code>www</code>。</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">vi nginx.conf</span><br><span class="line">user www;</span><br></pre></td></tr></table></figure><p>在<code>/data/phpmyadmin/files</code>目录下，新增<code>phpmyadmin</code>的nginx代理文件</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre></td><td class="code"><pre><span class="line">vi phpmyadmin.conf</span><br><span class="line"></span><br><span class="line">server &#123;</span><br><span class="line">    listen 80;</span><br><span class="line">    server_name ansible.phpmyadmin.local;</span><br><span class="line"></span><br><span class="line">    # 确保此路径与phpMyAdmin实际路径完全一致</span><br><span class="line">    root /code/phpmyadmin;</span><br><span class="line">    index index.php;</span><br><span class="line"></span><br><span class="line">    location / &#123;</span><br><span class="line">        try_files $uri $uri/ /index.php$is_args$args;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    location ~ \.php$ &#123;</span><br><span class="line">        # 绝对路径必须完整正确</span><br><span class="line">        fastcgi_param SCRIPT_FILENAME $document_root$fastcgi_script_name;</span><br><span class="line">        fastcgi_pass 127.0.0.1:9000;</span><br><span class="line">        fastcgi_index index.php;</span><br><span class="line">        include fastcgi_params;</span><br><span class="line"></span><br><span class="line">        # 添加关键参数</span><br><span class="line">        fastcgi_split_path_info ^(.+\.php)(/.+)$;</span><br><span class="line">        fastcgi_intercept_errors on;</span><br><span class="line">        fastcgi_param PATH_INFO $fastcgi_path_info;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure><p>修改php配置文件<code>php.ini</code>，设置redis连接。</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">vi php.ini</span><br><span class="line">[Session]</span><br><span class="line"></span><br><span class="line">session.save_handler = redis</span><br><span class="line">session.save_path = &quot;tcp://192.168.1.125:6379?weight=1&amp;timeout=2.5&quot;</span><br></pre></td></tr></table></figure><p>修改php配置文件<code>www.conf</code>，设置用户和组，并注释部分设置。</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">vi www.conf</span><br><span class="line"></span><br><span class="line">[www]</span><br><span class="line">user = www</span><br><span class="line">group = www</span><br><span class="line"></span><br><span class="line">;php_value[session.save_handler] = files</span><br><span class="line">;php_value[session.save_path]    = /var/lib/php/session</span><br><span class="line"></span><br></pre></td></tr></table></figure><p>（3）下载phpmyadmin</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta prompt_">#</span><span class="language-bash">phpmyadmin程序下载到/data/phpmyadmin/files目录下</span></span><br><span class="line">curl -O https://files.phpmyadmin.net/phpMyAdmin/5.2.2/phpMyAdmin-5.2.2-all-languages.zip</span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_">#</span><span class="language-bash">解压程序</span></span><br><span class="line">unzip phpMyAdmin-5.2.2-all-languages.zip</span><br><span class="line"><span class="meta prompt_">#</span><span class="language-bash">复制并修改配置文件，连接mariadb数据库</span></span><br><span class="line">cp phpMyAdmin-5.2.2-all-languages/config.sample.inc.php config.inc.php</span><br><span class="line"><span class="meta prompt_">#</span><span class="language-bash">修改localhost为192.168.1.125</span></span><br><span class="line"><span class="meta prompt_">$</span><span class="language-bash">cfg[<span class="string">&#x27;Servers&#x27;</span>][<span class="variable">$i</span>][<span class="string">&#x27;host&#x27;</span>] = <span class="string">&#x27;192.168.1.125&#x27;</span>;</span></span><br></pre></td></tr></table></figure><p>（4）创建nignx-php剧本</p><figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br></pre></td><td class="code"><pre><span class="line"><span class="string">vi</span> <span class="string">nginx-php.yml</span></span><br><span class="line"></span><br><span class="line"><span class="bullet">-</span> <span class="attr">hosts:</span> <span class="string">webservers</span></span><br><span class="line">  <span class="attr">tasks:</span></span><br><span class="line">    <span class="bullet">-</span> <span class="attr">name:</span> <span class="string">download</span> <span class="string">nginx</span></span><br><span class="line">      <span class="attr">yum:</span></span><br><span class="line">        <span class="attr">name:</span> <span class="string">nginx</span></span><br><span class="line">        <span class="attr">state:</span> <span class="string">present</span></span><br><span class="line">    <span class="bullet">-</span> <span class="attr">name:</span> <span class="string">download</span> <span class="string">php</span></span><br><span class="line">      <span class="attr">yum:</span></span><br><span class="line">        <span class="attr">name:</span> <span class="string">&quot;<span class="template-variable">&#123;&#123; packages &#125;&#125;</span>&quot;</span></span><br><span class="line">      <span class="attr">vars:</span></span><br><span class="line">        <span class="attr">packages:</span></span><br><span class="line">        <span class="bullet">-</span> <span class="string">php72w</span></span><br><span class="line">        <span class="bullet">-</span> <span class="string">php72w-cli</span></span><br><span class="line">        <span class="bullet">-</span> <span class="string">php72w-common</span></span><br><span class="line">        <span class="bullet">-</span> <span class="string">php72w-devel</span></span><br><span class="line">        <span class="bullet">-</span> <span class="string">php72w-embedded</span></span><br><span class="line">        <span class="bullet">-</span> <span class="string">php72w-fpm</span></span><br><span class="line">        <span class="bullet">-</span> <span class="string">php72w-gd</span></span><br><span class="line">        <span class="bullet">-</span> <span class="string">php72w-mbstring</span></span><br><span class="line">        <span class="bullet">-</span> <span class="string">php72w-mysqlnd</span></span><br><span class="line">        <span class="bullet">-</span> <span class="string">php72w-opcache</span></span><br><span class="line">        <span class="bullet">-</span> <span class="string">php72w-pdo</span></span><br><span class="line">        <span class="bullet">-</span> <span class="string">php72w-xml</span></span><br><span class="line">        <span class="bullet">-</span> <span class="string">php72w-ldap</span></span><br><span class="line">        <span class="bullet">-</span> <span class="string">php72w-pecl-redis</span></span><br><span class="line"></span><br><span class="line">    <span class="bullet">-</span> <span class="attr">name:</span> <span class="string">configure</span> <span class="string">nginx</span></span><br><span class="line">      <span class="attr">copy:</span></span><br><span class="line">        <span class="attr">src:</span> <span class="string">./files/nginx.conf</span></span><br><span class="line">        <span class="attr">dest:</span> <span class="string">/etc/nginx/nginx.conf</span></span><br><span class="line">        <span class="attr">owner:</span> <span class="string">root</span></span><br><span class="line">        <span class="attr">group:</span> <span class="string">root</span></span><br><span class="line">        <span class="attr">mode:</span> <span class="number">0644</span></span><br><span class="line">      <span class="attr">notify:</span> <span class="string">restart</span> <span class="string">nginx</span></span><br><span class="line">    <span class="bullet">-</span> <span class="attr">name:</span> <span class="string">init</span> <span class="string">group</span> <span class="string">www</span></span><br><span class="line">      <span class="attr">group:</span></span><br><span class="line">        <span class="attr">name:</span> <span class="string">www</span></span><br><span class="line">        <span class="attr">gid:</span> <span class="number">666</span></span><br><span class="line">    <span class="bullet">-</span> <span class="attr">name:</span> <span class="string">init</span> <span class="string">user</span> <span class="string">www</span></span><br><span class="line">      <span class="attr">user:</span></span><br><span class="line">        <span class="attr">name:</span> <span class="string">www</span></span><br><span class="line">        <span class="attr">uid:</span> <span class="number">666</span></span><br><span class="line">        <span class="attr">group:</span> <span class="string">www</span></span><br><span class="line">        <span class="attr">shell:</span> <span class="string">/sbin/nologin</span></span><br><span class="line">        <span class="attr">create_home:</span> <span class="literal">no</span></span><br><span class="line">    <span class="bullet">-</span> <span class="attr">name:</span> <span class="string">start</span> <span class="string">nginx</span></span><br><span class="line">      <span class="attr">systemd:</span></span><br><span class="line">        <span class="attr">name:</span> <span class="string">nginx</span></span><br><span class="line">        <span class="attr">state:</span> <span class="string">started</span>        </span><br><span class="line">        <span class="attr">enabled:</span> <span class="literal">yes</span></span><br><span class="line"></span><br><span class="line">    <span class="bullet">-</span> <span class="attr">name:</span> <span class="string">configure</span> <span class="string">php.ini</span></span><br><span class="line">      <span class="attr">copy:</span></span><br><span class="line">        <span class="attr">src:</span> <span class="string">./files/php.ini</span></span><br><span class="line">        <span class="attr">dest:</span> <span class="string">/etc/php.ini</span></span><br><span class="line">        <span class="attr">owner:</span> <span class="string">root</span></span><br><span class="line">        <span class="attr">group:</span> <span class="string">root</span></span><br><span class="line">        <span class="attr">mode:</span> <span class="number">0644</span></span><br><span class="line">      <span class="attr">notify:</span> <span class="string">restart</span> <span class="string">php</span>    </span><br><span class="line">    <span class="bullet">-</span> <span class="attr">name:</span> <span class="string">configure</span> <span class="string">www.conf</span></span><br><span class="line">      <span class="attr">copy:</span></span><br><span class="line">        <span class="attr">src:</span> <span class="string">./files/www.conf</span></span><br><span class="line">        <span class="attr">dest:</span> <span class="string">/etc/php-fpm.d/www.conf</span></span><br><span class="line">        <span class="attr">owner:</span> <span class="string">root</span></span><br><span class="line">        <span class="attr">group:</span> <span class="string">root</span></span><br><span class="line">        <span class="attr">mode:</span> <span class="number">0644</span></span><br><span class="line">      <span class="attr">notify:</span> <span class="string">restart</span> <span class="string">php</span>        </span><br><span class="line">    <span class="bullet">-</span> <span class="attr">name:</span> <span class="string">start</span> <span class="string">php</span></span><br><span class="line">      <span class="attr">systemd:</span></span><br><span class="line">        <span class="attr">name:</span> <span class="string">php-fpm</span></span><br><span class="line">        <span class="attr">state:</span> <span class="string">started</span>        </span><br><span class="line">        <span class="attr">enabled:</span> <span class="literal">yes</span></span><br><span class="line">        </span><br><span class="line">    <span class="bullet">-</span> <span class="attr">name:</span> <span class="string">copy</span> <span class="string">nginx</span> <span class="string">conf</span> </span><br><span class="line">      <span class="attr">copy:</span></span><br><span class="line">        <span class="attr">src:</span> <span class="string">./files/phpmyadmin.conf</span></span><br><span class="line">        <span class="attr">dest:</span> <span class="string">/etc/nginx/conf.d/phpmyadmin.conf</span></span><br><span class="line">      <span class="attr">notify:</span> <span class="string">restart</span> <span class="string">nginx</span>      </span><br><span class="line">    <span class="bullet">-</span> <span class="attr">name:</span> <span class="string">create</span> <span class="string">code</span> <span class="string">directory</span></span><br><span class="line">      <span class="attr">file:</span></span><br><span class="line">        <span class="attr">path:</span> <span class="string">/code</span></span><br><span class="line">        <span class="attr">state:</span> <span class="string">directory</span></span><br><span class="line">        <span class="attr">owner:</span> <span class="string">www</span></span><br><span class="line">        <span class="attr">group:</span> <span class="string">www</span></span><br><span class="line">        <span class="attr">mode:</span> <span class="string">&quot;0755&quot;</span></span><br><span class="line">        <span class="attr">recurse:</span> <span class="literal">yes</span>    </span><br><span class="line">    <span class="bullet">-</span> <span class="attr">name:</span> <span class="string">unarchive</span> <span class="string">phpmyadmin</span>   <span class="comment">#解压phpmyadmin</span></span><br><span class="line">      <span class="attr">unarchive:</span> </span><br><span class="line">        <span class="attr">src:</span> <span class="string">./files/phpMyAdmin-5.2.2-all-languages.zip</span></span><br><span class="line">        <span class="attr">dest:</span> <span class="string">/code/</span></span><br><span class="line">        <span class="attr">owner:</span> <span class="string">www</span></span><br><span class="line">        <span class="attr">group:</span> <span class="string">www</span></span><br><span class="line">        <span class="attr">creates:</span> <span class="string">/code/phpMyAdmin-5.2.2-all-languages/config.inc.php</span>        </span><br><span class="line">    <span class="bullet">-</span> <span class="attr">name:</span> <span class="string">create</span> <span class="string">link</span>  <span class="comment">#创建软连接</span></span><br><span class="line">      <span class="attr">file:</span> </span><br><span class="line">        <span class="attr">src:</span> <span class="string">/code/phpMyAdmin-5.2.2-all-languages/</span></span><br><span class="line">        <span class="attr">dest:</span> <span class="string">/code/phpmyadmin</span> </span><br><span class="line">        <span class="attr">state:</span> <span class="string">link</span></span><br><span class="line">    <span class="bullet">-</span> <span class="attr">name:</span> <span class="string">change</span> <span class="string">phpmyadmin</span> <span class="string">configure</span> </span><br><span class="line">      <span class="attr">copy:</span></span><br><span class="line">        <span class="attr">src:</span> <span class="string">./files/config.inc.php</span></span><br><span class="line">        <span class="attr">dest:</span> <span class="string">/code/phpMyAdmin-5.2.2-all-languages/config.inc.php</span>  </span><br><span class="line">          </span><br><span class="line">        </span><br><span class="line">  <span class="attr">handlers:</span> </span><br><span class="line">    <span class="bullet">-</span> <span class="attr">name:</span> <span class="string">restart</span> <span class="string">nginx</span></span><br><span class="line">      <span class="attr">systemd:</span></span><br><span class="line">        <span class="attr">name:</span> <span class="string">nginx</span></span><br><span class="line">        <span class="attr">state:</span> <span class="string">restarted</span></span><br><span class="line">    <span class="bullet">-</span> <span class="attr">name:</span> <span class="string">restart</span> <span class="string">php</span></span><br><span class="line">      <span class="attr">systemd:</span></span><br><span class="line">        <span class="attr">name:</span> <span class="string">php-fpm</span></span><br><span class="line">        <span class="attr">state:</span> <span class="string">restarted</span></span><br><span class="line"></span><br></pre></td></tr></table></figure><p>（5）安装并测试</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">ansible-playbook --syntax-check nginx-php.yml</span><br><span class="line">ansible-playbook -C nginx-php.yml</span><br><span class="line">ansible-playbook nginx-php.yml</span><br></pre></td></tr></table></figure><p>（6）在本机电脑<code>C:\Windows\System32\drivers\etc\hosts</code>配置hosts</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta prompt_">#</span><span class="language-bash">分别配置121，122的hosts进行访问测试</span></span><br><span class="line">192.168.1.121 ansible.phpmyadmin.local</span><br><span class="line">192.168.1.122 ansible.phpmyadmin.local</span><br></pre></td></tr></table></figure><p>（7）浏览器访问<code>ansible.phpmyadmin.local</code>，用户密码是安装Mariadb数据库时，创建的用户<code>php_user</code>及其密码<code>123456</code>。</p><img src="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="/yyg/e80721f/3.png" title="image-20250411224722322"> <img src="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="/yyg/e80721f/4.png" title="image-20250411224810891"><h6 id="负载均衡方式一：nginx"><a href="#负载均衡方式一：nginx" class="headerlink" title="负载均衡方式一：nginx"></a>负载均衡方式一：nginx</h6><p>（1）复制nginx的配置文件<code>nginx.conf</code>，至<code>/data/phpmyadmin/files</code>目录下并命名为<code>nginx.conf.lb</code></p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">cp /etc/nginx.conf /data/phpmyadmin/files/nginx.conf.lb</span><br></pre></td></tr></table></figure><p>（2）在<code>/data/phpmyadmin/files</code>目录下创建配置文件<code>proxy.conf</code>，用作负载均衡</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line">vi proxy.conf</span><br><span class="line"></span><br><span class="line">upstream ansible &#123;</span><br><span class="line">    server 192.168.1.121;</span><br><span class="line">    server 192.168.1.122;</span><br><span class="line">&#125;</span><br><span class="line">server &#123;</span><br><span class="line">    listen 80;</span><br><span class="line">    server_name ansible.phpmyadmin.local;</span><br><span class="line">    location / &#123;</span><br><span class="line">        proxy_pass http://ansible;</span><br><span class="line">        proxy_set_header Host $http_host;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure><p>（3）创建lb-nginx剧本</p><figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre></td><td class="code"><pre><span class="line"><span class="string">vi</span> <span class="string">lb-nginx.yml</span></span><br><span class="line"></span><br><span class="line"><span class="bullet">-</span> <span class="attr">hosts:</span> <span class="string">lbservers</span></span><br><span class="line">  <span class="attr">tasks:</span></span><br><span class="line">    <span class="bullet">-</span> <span class="attr">name:</span> <span class="string">download</span> <span class="string">nginx</span></span><br><span class="line">      <span class="attr">yum:</span></span><br><span class="line">        <span class="attr">name:</span> <span class="string">nginx</span></span><br><span class="line">        <span class="attr">state:</span> <span class="string">present</span></span><br><span class="line">    <span class="bullet">-</span> <span class="attr">name:</span> <span class="string">configure</span> <span class="string">nginx</span></span><br><span class="line">      <span class="attr">copy:</span></span><br><span class="line">        <span class="attr">src:</span> <span class="string">./files/nginx.conf.lb</span></span><br><span class="line">        <span class="attr">dest:</span> <span class="string">/etc/nginx/nginx.conf</span></span><br><span class="line">      <span class="attr">notify:</span> <span class="string">restart</span> <span class="string">nginx</span></span><br><span class="line">    <span class="bullet">-</span> <span class="attr">name:</span> <span class="string">copy</span> <span class="string">nginx</span> <span class="string">conf</span></span><br><span class="line">      <span class="attr">copy:</span></span><br><span class="line">        <span class="attr">src:</span> <span class="string">./files/proxy.conf</span></span><br><span class="line">        <span class="attr">dest:</span> <span class="string">/etc/nginx/conf.d/proxy.conf</span></span><br><span class="line">      <span class="attr">notify:</span> <span class="string">restart</span> <span class="string">nginx</span></span><br><span class="line">    <span class="bullet">-</span> <span class="attr">name:</span> <span class="string">start</span> <span class="string">nginx</span></span><br><span class="line">      <span class="attr">systemd:</span></span><br><span class="line">        <span class="attr">name:</span> <span class="string">nginx</span></span><br><span class="line">        <span class="attr">state:</span> <span class="string">started</span></span><br><span class="line">        <span class="attr">enabled:</span> <span class="literal">yes</span></span><br><span class="line">  <span class="attr">handlers:</span></span><br><span class="line">    <span class="bullet">-</span> <span class="attr">name:</span> <span class="string">restart</span> <span class="string">nginx</span></span><br><span class="line">      <span class="attr">systemd:</span></span><br><span class="line">        <span class="attr">name:</span> <span class="string">nginx</span></span><br><span class="line">        <span class="attr">state:</span> <span class="string">restarted</span></span><br></pre></td></tr></table></figure><p>（4）安装并测试</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">ansible-playbook --syntax-check lb-nginx.yml</span><br><span class="line">ansible-playbook -C lb-nginx.yml</span><br><span class="line">ansible-playbook lb-nginx.yml</span><br></pre></td></tr></table></figure><p>（5）在本机电脑<code>C:\Windows\System32\drivers\etc\hosts</code>配置hosts</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">192.168.1.123 ansible.phpmyadmin.local</span><br><span class="line">192.168.1.124 ansible.phpmyadmin.local</span><br></pre></td></tr></table></figure><p>（6）浏览器访问<code>ansible.phpmyadmin.local</code>,并观察<code>数据库服务器</code>-<code>用户</code>，刷新查看用户是否为121与122切换显示。</p><h6 id="负载均衡方式二：haproxy"><a href="#负载均衡方式二：haproxy" class="headerlink" title="负载均衡方式二：haproxy"></a>负载均衡方式二：haproxy</h6><p>（1）设置haproxy下载源</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">rpm -Uvh https://repo.ius.io/ius-release-el7.rpm</span><br></pre></td></tr></table></figure><p>（2）将<code>/etc/haproxy/haproxy.cfg</code>，至<code>/data/phpmyadmin/files</code>目录下</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">cp /etc/haproxy/haproxy.cfg /data/phpmyadmin/files</span><br></pre></td></tr></table></figure><blockquote><p>可先在任意一台服务器安装haproxy，获取/etc/haproxy/haproxy.cfg文件</p></blockquote><p>（3）修改<code>haproxy.cfg</code>配置文件，新增以下内容。</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">frontend web</span><br><span class="line">                bind *:8080</span><br><span class="line">                mode http</span><br><span class="line">                acl ansible_domain hdr_reg(host) -i ansible.phpmyadmin.local</span><br><span class="line">                use_backend ansible_cluster if ansible_domain</span><br><span class="line">backend ansible_cluster</span><br><span class="line">                balance roundrobin</span><br><span class="line">                option httpchk HEAD / HTTP/1.1\r\nHost:\ ansible.phpmyadmin.local</span><br><span class="line">                server server1 192.168.1.121:80 check port 80 inter 3s rise 2 fall 3</span><br><span class="line">                server server2 192.168.1.122:80 check port 80 inter 3s rise 2 fall 3</span><br><span class="line"></span><br></pre></td></tr></table></figure><p>（4）创建lb-haproxy剧本</p><figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><span class="line"><span class="string">vi</span> <span class="string">lb-haproxy.yml</span></span><br><span class="line"></span><br><span class="line"><span class="bullet">-</span> <span class="attr">hosts:</span> <span class="string">lbservers</span></span><br><span class="line">  <span class="attr">tasks:</span></span><br><span class="line">    <span class="bullet">-</span> <span class="attr">name:</span> <span class="string">download</span> <span class="string">haproxy</span></span><br><span class="line">      <span class="attr">yum:</span></span><br><span class="line">        <span class="attr">name:</span> <span class="string">haproxy22</span></span><br><span class="line">        <span class="attr">state:</span> <span class="string">present</span></span><br><span class="line">    <span class="bullet">-</span> <span class="attr">name:</span> <span class="string">configure</span> <span class="string">haproxy</span></span><br><span class="line">      <span class="attr">copy:</span></span><br><span class="line">        <span class="attr">src:</span> <span class="string">./files/haproxy.cfg</span></span><br><span class="line">        <span class="attr">dest:</span> <span class="string">/etc/haproxy/haproxy.cfg</span></span><br><span class="line">        <span class="attr">owner:</span> <span class="string">root</span></span><br><span class="line">        <span class="attr">group:</span> <span class="string">root</span></span><br><span class="line">        <span class="attr">mode:</span> <span class="number">0644</span></span><br><span class="line">      <span class="attr">notify:</span> <span class="string">restart</span> <span class="string">haproxy</span>  </span><br><span class="line">    <span class="bullet">-</span> <span class="attr">name:</span> <span class="string">start</span> <span class="string">haproxy</span></span><br><span class="line">      <span class="attr">systemd:</span></span><br><span class="line">        <span class="attr">name:</span> <span class="string">haproxy</span></span><br><span class="line">        <span class="attr">state:</span> <span class="string">started</span>        </span><br><span class="line">        <span class="attr">enabled:</span> <span class="literal">yes</span></span><br><span class="line">  <span class="attr">handlers:</span> </span><br><span class="line">    <span class="bullet">-</span> <span class="attr">name:</span> <span class="string">restart</span> <span class="string">haproxy</span></span><br><span class="line">      <span class="attr">systemd:</span></span><br><span class="line">        <span class="attr">name:</span> <span class="string">haproxy</span></span><br><span class="line">        <span class="attr">state:</span> <span class="string">restarted</span></span><br></pre></td></tr></table></figure><p>（5）安装并测试</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">ansible-playbook --syntax-check lb-haproxy.yml</span><br><span class="line">ansible-playbook -C lb-haproxy.yml</span><br><span class="line">ansible-playbook lb-haproxy.yml</span><br></pre></td></tr></table></figure><p>（5）在本机电脑<code>C:\Windows\System32\drivers\etc\hosts</code>配置hosts</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">192.168.1.123 ansible.phpmyadmin.local</span><br><span class="line">192.168.1.124 ansible.phpmyadmin.local</span><br></pre></td></tr></table></figure><p>（6）浏览器访问<code>ansible.phpmyadmin.local:8080</code>,并观察<code>数据库服务器</code>-<code>用户</code>，刷新查看用户是否为121与122切换显示。</p><blockquote><p>本篇知识来源于B站视频BV11JZcYwEDd</p></blockquote></article><div class="post-copyright"><div class="post-copyright__author"><span class="post-copyright-meta"><i class="fas fa-circle-user fa-fw"></i>文章作者:</span> <span class="post-copyright-info"><a href="https://yyg.js.cool/">云野阁</a></span></div><div class="post-copyright__type"><span class="post-copyright-meta"><i class="fas fa-square-arrow-up-right fa-fw"></i>文章链接:</span> <span class="post-copyright-info"><a href="https://yyg.js.cool/yyg/e80721f/">https://yyg.js.cool/yyg/e80721f/</a></span></div><div class="post-copyright__notice"><span class="post-copyright-meta"><i class="fas fa-circle-exclamation fa-fw"></i>版权声明:</span> <span class="post-copyright-info">本博客所有文章除特别声明外，均采用 <a href="https://creativecommons.org/licenses/by-nc-sa/4.0/" target="_blank">CC BY-NC-SA 4.0</a> 许可协议。转载请注明来源 <a href="https://yyg.js.cool" target="_blank">云野阁</a>！</span></div></div><div class="tag_share"><div class="post-meta__tag-list"><a class="post-meta__tags" href="/tags/%E7%9F%A5%E8%AF%86%E6%A2%B3%E7%90%86/">知识梳理</a><a class="post-meta__tags" href="/tags/CI-CD/">CI/CD</a><a class="post-meta__tags" href="/tags/%E8%87%AA%E5%8A%A8%E5%8C%96%E8%BF%90%E7%BB%B4/">自动化运维</a><a class="post-meta__tags" href="/tags/Ansible/">Ansible</a><a class="post-meta__tags" href="/tags/Linux%E8%BF%90%E7%BB%B4/">Linux运维</a></div><div class="post-share"><div class="social-share" data-image="https://t.alcy.cc/fj" data-sites="facebook,x,wechat,weibo,qq"></div><link rel="stylesheet" href="https://s4.zstatic.net/ajax/libs/butterfly-extsrc/1.1.4/sharejs/dist/css/share.min.css" media="print" onload='this.media="all"'><script src="https://s4.zstatic.net/ajax/libs/butterfly-extsrc/1.1.4/sharejs/dist/js/social-share.min.js" defer></script></div></div><nav class="pagination-post" id="pagination"><a class="pagination-related" href="/yyg/80ffa402/" title="Hexo-Butterfly美化教程-[2]Butterfly主题安装"><img class="cover" src="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="/img/icon.png" onerror='onerror=null,src="/img/404.jpg"' alt="cover of previous post"><div class="info"><div class="info-1"><div class="info-item-1">上一篇</div><div class="info-item-2">Hexo-Butterfly美化教程-[2]Butterfly主题安装</div></div><div class="info-2"><div class="info-item-1">拉取主题代码1git clone -b master https://github.com/jerryc127/hexo-theme-butterfly.git themes/butterfly 配置主题应用将blog根目录下的_co...</div></div></div></a><a class="pagination-related" href="/yyg/10ac2e4/" title="Ansible最新版安装"><img class="cover" src="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://random-img.pupper.cn/api" onerror='onerror=null,src="/img/404.jpg"' alt="cover of next post"><div class="info text-right"><div class="info-1"><div class="info-item-1">下一篇</div><div class="info-item-2">Ansible最新版安装</div></div><div class="info-2"><div class="info-item-1">pip方式安装基础环境准备（1）安装软件依赖 1yum install -y zlib zlib-dev zlib-devel sqlite-devel openssl-devel bzip2-devel libffi libff...</div></div></div></a></nav><div class="relatedPosts"><div class="headline"><i class="fas fa-thumbs-up fa-fw"></i><span>相关推荐</span></div><div class="relatedPosts-list"><a class="pagination-related" href="/yyg/f0979e05/" title="Jenkins知识梳理"><img class="cover" src="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://api.jiangyuhui.top/aliyun/randomCover" alt="cover"><div class="info text-center"><div class="info-1"><div class="info-item-1"><i class="far fa-calendar-alt fa-fw"></i> 2025-05-17</div><div class="info-item-2">Jenkins知识梳理</div></div><div class="info-2"><div class="info-item-1">🔜什么是Jenkins？🔚 Jenkins是一款基于Java开发的开源 CI&amp;CD 软件，用于自动化各种任务，包括构建、测试和部署软件。Jenkins提供多种安...</div></div></div></a><a class="pagination-related" href="/yyg/10ac2e4/" title="Ansible最新版安装"><img class="cover" src="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://random-img.pupper.cn/api" alt="cover"><div class="info text-center"><div class="info-1"><div class="info-item-1"><i class="far fa-calendar-alt fa-fw"></i> 2025-04-12</div><div class="info-item-2">Ansible最新版安装</div></div><div class="info-2"><div class="info-item-1">pip方式安装基础环境准备（1）安装软件依赖 1yum install -y zlib zlib-dev zlib-devel sqlite-devel openssl-devel bzip2-devel libffi libff...</div></div></div></a><a class="pagination-related no-desc" href="/yyg/5c56de6f/" title="docker知识梳理"><img class="cover" src="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://api.vvhan.com/api/wallpaper/views" alt="cover"><div class="info text-center"><div class="info-1"><div class="info-item-1"><i class="far fa-calendar-alt fa-fw"></i> 2024-03-24</div><div class="info-item-2">docker知识梳理</div></div></div></a><a class="pagination-related" href="/yyg/986299a9/" title="k8s知识梳理--进阶"><img class="cover" src="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://api.vvhan.com/api/wallpaper/views" alt="cover"><div class="info text-center"><div class="info-1"><div class="info-item-1"><i class="far fa-calendar-alt fa-fw"></i> 2025-08-22</div><div class="info-item-2">k8s知识梳理--进阶</div></div><div class="info-2"><div class="info-item-1">网络Kubernetes-网络模型原则 在不使用网络地址转换(NAT)的情况下，集群中的Pod能够与任意其他Pod进行通信 在不使用网络地址转换(NAT)的情况下，在集群节点上运行的程序能与同一节点上的任何Pod进行通信 每个Pod都...</div></div></div></a><a class="pagination-related no-desc" href="/yyg/f5a7a3df/" title="Kubernetes知识梳理"><img class="cover" src="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://random-img.pupper.cn/api" alt="cover"><div class="info text-center"><div class="info-1"><div class="info-item-1"><i class="far fa-calendar-alt fa-fw"></i> 2024-03-24</div><div class="info-item-2">Kubernetes知识梳理</div></div></div></a><a class="pagination-related" href="/yyg/3b57c0c6/" title="docker容器日志配置管理"><img class="cover" src="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://imgapi.cn/api.php?fl=fengjing&gs=images" alt="cover"><div class="info text-center"><div class="info-1"><div class="info-item-1"><i class="far fa-calendar-alt fa-fw"></i> 2024-08-07</div><div class="info-item-2">docker容器日志配置管理</div></div><div class="info-2"><div class="info-item-1">运行的项目容器突然就停了，查看容器日志发现磁盘空间不足，导致容器没法运行了。 Error response from daemon: Cannot restart container docker-p: mkdir /home/do...</div></div></div></a></div></div><hr class="custom-hr"><div id="post-comment"><div class="comment-head"><div class="comment-headline"><i class="fas fa-comments fa-fw"></i> <span>评论</span></div><div class="comment-switch"><span class="first-comment">Giscus</span><span id="switch-btn"></span><span class="second-comment">Utterances</span></div></div><div class="comment-wrap"><div><div id="giscus-wrap"></div></div><div><div id="utterances-wrap"></div></div></div></div></div><div class="aside-content" id="aside-content"><div class="card-widget card-info text-center"><div class="avatar-img"><img src="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="/img/icon.png" onerror='this.onerror=null,this.src="/img/friend_404.gif"' alt="avatar"></div><div class="author-info-name">云野阁</div><div class="author-info-description">闲云野鹤，八方逍遥</div><div class="site-data"><a href="/archives/"><div class="headline">文章</div><div class="length-num">62</div></a><a href="/tags/"><div class="headline">标签</div><div class="length-num">109</div></a><a href="/categories/"><div class="headline">分类</div><div class="length-num">37</div></a></div><div class="card-info-social-icons"><a class="social-icon" href="https://github.com/MarsperL" target="_blank" title="Github"><i class="fab fa-github" style="color:#24292e"></i></a><a class="social-icon" href="mailto:eXlnbGlAZm94bWFpbC5jb20=" target="_blank" title="Email"><i class="fas fa-envelope" style="color:#4a7dbe"></i></a><a class="social-icon" href="/rss2.xml" target="_blank"><i class="fas fa-rss"></i></a></div></div><div class="sticky_layout"><div class="card-widget" id="card-toc"><div class="item-headline"><i class="fas fa-stream"></i><span>目录</span><span class="toc-percentage"></span></div><div class="toc-content"><ol class="toc"><li class="toc-item toc-level-2"><a class="toc-link" href="#%E6%9E%B6%E6%9E%84"><span class="toc-number">1.</span> <span class="toc-text">架构</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#Ansible%E9%87%8D%E8%A6%81%E6%A6%82%E5%BF%B5"><span class="toc-number">2.</span> <span class="toc-text">Ansible重要概念</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E6%8E%A7%E5%88%B6%E8%8A%82%E7%82%B9"><span class="toc-number">2.1.</span> <span class="toc-text">控制节点</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%8F%97%E6%8E%A7%E8%8A%82%E7%82%B9%EF%BC%88%E8%A2%AB%E7%AE%A1%E7%90%86%E8%8A%82%E7%82%B9%EF%BC%89"><span class="toc-number">2.2.</span> <span class="toc-text">受控节点（被管理节点）</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%BA%93%E5%AD%98-Inventory"><span class="toc-number">2.3.</span> <span class="toc-text">库存 (Inventory)</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%89%A7%E6%9C%AC%EF%BC%88Playbook%EF%BC%89"><span class="toc-number">2.4.</span> <span class="toc-text">剧本（Playbook）</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E6%A8%A1%E5%9D%97-Modules"><span class="toc-number">2.5.</span> <span class="toc-text">模块 (Modules)</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E8%A7%92%E8%89%B2-Roles"><span class="toc-number">2.6.</span> <span class="toc-text">角色 (Roles)</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E4%BB%BB%E5%8A%A1-Tasks"><span class="toc-number">2.7.</span> <span class="toc-text">任务 (Tasks)</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E6%8F%92%E4%BB%B6"><span class="toc-number">2.8.</span> <span class="toc-text">插件</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E9%9B%86%E5%90%88"><span class="toc-number">2.9.</span> <span class="toc-text">集合</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#Ansible%E4%BB%BB%E5%8A%A1%E6%89%A7%E8%A1%8C%E6%A8%A1%E5%BC%8F"><span class="toc-number">3.</span> <span class="toc-text">Ansible任务执行模式</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#Ansible%E5%AE%89%E8%A3%85%EF%BC%88centos-7%EF%BC%89"><span class="toc-number">4.</span> <span class="toc-text">Ansible安装（centos 7）</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E6%96%B9%E5%BC%8F%E4%B8%80%EF%BC%9A%E4%BD%BF%E7%94%A8yum%E5%AE%89%E8%A3%85"><span class="toc-number">4.1.</span> <span class="toc-text">方式一：使用yum安装</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E6%96%B9%E5%BC%8F%E4%BA%8C%EF%BC%9A%E4%BD%BF%E7%94%A8pip%E5%AE%89%E8%A3%85"><span class="toc-number">4.2.</span> <span class="toc-text">方式二：使用pip安装</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#Ansible-%E9%85%8D%E7%BD%AE%E6%96%87%E4%BB%B6"><span class="toc-number">5.</span> <span class="toc-text">Ansible 配置文件</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#Ansible%E5%85%8D%E5%AF%86%E7%99%BB%E5%BD%95"><span class="toc-number">6.</span> <span class="toc-text">Ansible免密登录</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#root%E7%94%A8%E6%88%B7"><span class="toc-number">6.1.</span> <span class="toc-text">root用户</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E6%99%AE%E9%80%9A%E7%94%A8%E6%88%B7"><span class="toc-number">6.2.</span> <span class="toc-text">普通用户</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#Ansible-Ad-Hoc%E4%B8%8E%E5%B8%B8%E7%94%A8%E6%A8%A1%E5%9D%97"><span class="toc-number">7.</span> <span class="toc-text">Ansible Ad-Hoc与常用模块</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#Ad-Hoc"><span class="toc-number">7.1.</span> <span class="toc-text">Ad-Hoc</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%B8%B8%E7%94%A8%E6%A8%A1%E5%9D%97"><span class="toc-number">7.2.</span> <span class="toc-text">常用模块</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#command%E6%A8%A1%E5%9D%97"><span class="toc-number">7.2.1.</span> <span class="toc-text">command模块</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#shell%E6%A8%A1%E5%9D%97"><span class="toc-number">7.2.2.</span> <span class="toc-text">shell模块</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#yum-apt-%E6%A8%A1%E5%9D%97"><span class="toc-number">7.2.3.</span> <span class="toc-text">yum&#x2F;apt 模块</span></a></li></ol></li></ol></li></ol><li class="toc-item toc-level-1"><a class="toc-link" href="#%E5%AE%89%E8%A3%85%E6%9C%8D%E5%8A%A1"><span class="toc-number"></span> <span class="toc-text">安装服务</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#%E5%8D%B8%E8%BD%BD%E6%9C%8D%E5%8A%A1"><span class="toc-number"></span> <span class="toc-text">卸载服务</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#copy%E6%A8%A1%E5%9D%97"><span class="toc-number">0.0.1.</span> <span class="toc-text">copy模块</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#systemd-%E6%A8%A1%E5%9D%97"><span class="toc-number">0.0.2.</span> <span class="toc-text">systemd 模块</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#file%E6%A8%A1%E5%9D%97"><span class="toc-number">0.0.3.</span> <span class="toc-text">file模块</span></a></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#%E5%88%9B%E5%BB%BA-data%E7%9B%AE%E5%BD%95%EF%BC%8C%E6%8E%88%E6%9D%83test%E5%B1%9E%E7%BB%84"><span class="toc-number"></span> <span class="toc-text">创建&#x2F;data目录，授权test属组</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#group%E6%A8%A1%E5%9D%97"><span class="toc-number">0.0.1.</span> <span class="toc-text">group模块</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#user%E6%A8%A1%E5%9D%97"><span class="toc-number">0.0.2.</span> <span class="toc-text">user模块</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#mount-%E6%A8%A1%E5%9D%97"><span class="toc-number">0.0.3.</span> <span class="toc-text">mount 模块</span></a></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#%E5%B0%86192-168-1-121%E4%B8%8A%E7%9A%84-nfs%E7%9B%AE%E5%BD%95%E6%8C%82%E8%BD%BD%E5%88%B0192-168-1-122%E7%9A%84-nfs%E7%9B%AE%E5%BD%95"><span class="toc-number"></span> <span class="toc-text">将192.168.1.121上的&#x2F;nfs目录挂载到192.168.1.122的&#x2F;nfs目录</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#cron%E6%A8%A1%E5%9D%97"><span class="toc-number">0.0.1.</span> <span class="toc-text">cron模块</span></a></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#%E6%B7%BB%E5%8A%A0%E4%B8%80%E4%B8%AA%E6%AF%8F%E5%A4%A919%E7%82%B9%E6%89%A7%E8%A1%8C-data-test-sh%E8%84%9A%E6%9C%AC%E7%9A%84%E5%AE%9A%E6%97%B6%E4%BB%BB%E5%8A%A1%EF%BC%8C%E4%BB%BB%E5%8A%A1%E5%90%8D%E4%B8%BAscript-test%E3%80%82"><span class="toc-number"></span> <span class="toc-text">添加一个每天19点执行&#x2F;data&#x2F;test.sh脚本的定时任务，任务名为script-test。</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#%E6%B3%A8%E9%87%8A%E8%AF%A5%E5%AE%9A%E6%97%B6%E4%BB%BB%E5%8A%A1"><span class="toc-number"></span> <span class="toc-text">注释该定时任务</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#%E5%88%A0%E9%99%A4%E8%AF%A5%E5%AE%9A%E6%97%B6%E4%BB%BB%E5%8A%A1"><span class="toc-number"></span> <span class="toc-text">删除该定时任务</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#archive-%E6%A8%A1%E5%9D%97"><span class="toc-number">0.0.1.</span> <span class="toc-text">archive 模块</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#unarchive-%E6%A8%A1%E5%9D%97"><span class="toc-number">0.0.2.</span> <span class="toc-text">unarchive 模块</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#lineinfile%E6%A8%A1%E5%9D%97"><span class="toc-number">0.0.3.</span> <span class="toc-text">lineinfile模块</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#Ansible-Playbook"><span class="toc-number">1.</span> <span class="toc-text">Ansible Playbook</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#Playbook%E4%B9%A6%E5%86%99%E6%A0%BC%E5%BC%8F"><span class="toc-number">1.1.</span> <span class="toc-text">Playbook书写格式</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#Playbook%E5%BA%94%E7%94%A8%E5%AE%9E%E4%BE%8B%EF%BC%9A"><span class="toc-number">1.2.</span> <span class="toc-text">Playbook应用实例：</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#%E5%AE%89%E8%A3%85nignx"><span class="toc-number">1.2.1.</span> <span class="toc-text">安装nignx</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E5%AE%89%E8%A3%85NFS%E6%9C%8D%E5%8A%A1"><span class="toc-number">1.2.2.</span> <span class="toc-text">安装NFS服务</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E5%AE%89%E8%A3%85rsync%E6%9C%8D%E5%8A%A1"><span class="toc-number">1.2.3.</span> <span class="toc-text">安装rsync服务</span></a><ol class="toc-child"><li class="toc-item toc-level-5"><a class="toc-link" href="#rsync%E6%9C%8D%E5%8A%A1%E7%AB%AF%EF%BC%9A"><span class="toc-number">1.2.3.1.</span> <span class="toc-text">rsync服务端：</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#rsync%E5%AE%A2%E6%88%B7%E7%AB%AF%EF%BC%9A"><span class="toc-number">1.2.3.2.</span> <span class="toc-text">rsync客户端：</span></a></li></ol></li></ol></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#Ansible-push-backup-data"><span class="toc-number"></span> <span class="toc-text">Ansible: push backup data</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#%E4%BD%BF%E7%94%A8Ansible%E9%83%A8%E7%BD%B2%E5%A4%9A%E8%8A%82%E7%82%B9phpmyadmin"><span class="toc-number">0.0.1.</span> <span class="toc-text">使用Ansible部署多节点phpmyadmin</span></a><ol class="toc-child"><li class="toc-item toc-level-5"><a class="toc-link" href="#%E9%A1%B9%E7%9B%AE%E9%9C%80%E6%B1%82"><span class="toc-number">0.0.1.1.</span> <span class="toc-text">项目需求</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#%E4%B8%BB%E6%9C%BA%E8%A7%84%E5%88%92"><span class="toc-number">0.0.1.2.</span> <span class="toc-text">主机规划</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#%E9%83%A8%E7%BD%B2%E6%AD%A5%E9%AA%A4"><span class="toc-number">0.0.1.3.</span> <span class="toc-text">部署步骤</span></a><ol class="toc-child"><li class="toc-item toc-level-6"><a class="toc-link" href="#%E7%8E%AF%E5%A2%83%E5%87%86%E5%A4%87"><span class="toc-number">0.0.1.3.1.</span> <span class="toc-text">环境准备</span></a></li><li class="toc-item toc-level-6"><a class="toc-link" href="#%E5%AE%89%E8%A3%85Redis"><span class="toc-number">0.0.1.3.2.</span> <span class="toc-text">安装Redis</span></a></li><li class="toc-item toc-level-6"><a class="toc-link" href="#%E5%AE%89%E8%A3%85Mariadb"><span class="toc-number">0.0.1.3.3.</span> <span class="toc-text">安装Mariadb</span></a></li><li class="toc-item toc-level-6"><a class="toc-link" href="#%E5%AE%89%E8%A3%85nginx%E3%80%81PHP"><span class="toc-number">0.0.1.3.4.</span> <span class="toc-text">安装nginx、PHP</span></a></li><li class="toc-item toc-level-6"><a class="toc-link" href="#%E8%B4%9F%E8%BD%BD%E5%9D%87%E8%A1%A1%E6%96%B9%E5%BC%8F%E4%B8%80%EF%BC%9Anginx"><span class="toc-number">0.0.1.3.5.</span> <span class="toc-text">负载均衡方式一：nginx</span></a></li><li class="toc-item toc-level-6"><a class="toc-link" href="#%E8%B4%9F%E8%BD%BD%E5%9D%87%E8%A1%A1%E6%96%B9%E5%BC%8F%E4%BA%8C%EF%BC%9Ahaproxy"><span class="toc-number">0.0.1.3.6.</span> <span class="toc-text">负载均衡方式二：haproxy</span></a></li></ol></li></ol></li></ol></li></div></div><div class="card-widget card-recent-post"><div class="item-headline"><i class="fas fa-history"></i><span>最新文章</span></div><div class="aside-list"><div class="aside-list-item"><a class="thumbnail" href="/yyg/2eca17c7/" title="Gitalk自动创建评论Issues"><img src="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://random-img.pupper.cn/api" onerror='this.onerror=null,this.src="/img/404.jpg"' alt="Gitalk自动创建评论Issues"></a><div class="content"><a class="title" href="/yyg/2eca17c7/" title="Gitalk自动创建评论Issues">Gitalk自动创建评论Issues</a><time datetime="2025-10-08T14:06:07.000Z" title="发表于 2025-10-08 22:06:07">2025-10-08</time></div></div><div class="aside-list-item"><a class="thumbnail" href="/yyg/986299a9/" title="k8s知识梳理--进阶"><img src="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://api.vvhan.com/api/wallpaper/views" onerror='this.onerror=null,this.src="/img/404.jpg"' alt="k8s知识梳理--进阶"></a><div class="content"><a class="title" href="/yyg/986299a9/" title="k8s知识梳理--进阶">k8s知识梳理--进阶</a><time datetime="2025-08-22T10:17:22.000Z" title="发表于 2025-08-22 18:17:22">2025-08-22</time></div></div><div class="aside-list-item"><a class="thumbnail" href="/yyg/4789a872/" title="私有化部署DeepSeek"><img src="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://t.alcy.cc/fj" onerror='this.onerror=null,this.src="/img/404.jpg"' alt="私有化部署DeepSeek"></a><div class="content"><a class="title" href="/yyg/4789a872/" title="私有化部署DeepSeek">私有化部署DeepSeek</a><time datetime="2025-08-16T09:12:50.000Z" title="发表于 2025-08-16 17:12:50">2025-08-16</time></div></div><div class="aside-list-item"><a class="thumbnail" href="/yyg/37098f8c/" title="使用GitHub Actions实现Hexo博客的自动化发布"><img src="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://tu.ltyuanfang.cn/api/fengjing.php" onerror='this.onerror=null,this.src="/img/404.jpg"' alt="使用GitHub Actions实现Hexo博客的自动化发布"></a><div class="content"><a class="title" href="/yyg/37098f8c/" title="使用GitHub Actions实现Hexo博客的自动化发布">使用GitHub Actions实现Hexo博客的自动化发布</a><time datetime="2025-07-06T13:43:23.000Z" title="发表于 2025-07-06 21:43:23">2025-07-06</time></div></div><div class="aside-list-item"><a class="thumbnail" href="/yyg/9e02bef8/" title="观影感受--雄狮少年2"><img src="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="/img/img01.png" onerror='this.onerror=null,this.src="/img/404.jpg"' alt="观影感受--雄狮少年2"></a><div class="content"><a class="title" href="/yyg/9e02bef8/" title="观影感受--雄狮少年2">观影感受--雄狮少年2</a><time datetime="2025-06-04T03:35:51.000Z" title="发表于 2025-06-04 11:35:51">2025-06-04</time></div></div></div></div></div></div></main><footer id="footer"><div class="footer-other"><div class="footer-copyright"><span class="copyright">&copy;&nbsp;2024 - 2025 By 云野阁</span></div><div class="footer_custom_text"><div id="runtime"></div>世界上只有一种真正的英雄主义，那就是看清生活的真相之后，依然热爱生活</div></div></footer></div><div id="rightside"><div id="rightside-config-hide"><button id="readmode" type="button" title="阅读模式"><i class="fas fa-book-open"></i></button><button id="darkmode" type="button" title="日间和夜间模式切换"><i class="fas fa-adjust"></i></button><button id="hide-aside-btn" type="button" title="单栏和双栏切换"><i class="fas fa-arrows-alt-h"></i></button><button id="refresh-cache" type="button" title="刷新缓存" onclick="refreshCache()"><i class="fas fa-refresh fa-spin"></i></button></div><div id="rightside-config-show"><button id="rightside-config" type="button" title="设置"><i class="fas fa-cog fa-spin"></i></button><button class="close" id="mobile-toc-button" type="button" title="目录"><i class="fas fa-list-ul"></i></button><a id="to_comment" href="#post-comment" title="前往评论"><i class="fas fa-comments"></i></a><button id="go-up" type="button" title="回到顶部"><span class="scroll-percent"></span><i class="fas fa-arrow-up"></i></button><button id="go-down" type="button" title="直达底部" onclick="btf.scrollToDest(document.body.scrollHeight,500)"><i class="fas fa-arrow-down"></i></button></div></div><div><script src="/js/utils.js?v=5.5.1"></script><script src="/js/main.js?v=5.5.1"></script><script src="https://s4.zstatic.net/ajax/libs/fancyapps-ui/5.0.36/fancybox/fancybox.umd.min.js"></script><script src="https://cdn.jsdelivr.net/npm/instant.page@5.2.0/instantpage.min.js" type="module"></script><script src="https://s4.zstatic.net/ajax/libs/vanilla-lazyload/19.1.3/lazyload.iife.min.js"></script><div class="js-pjax"><script>(()=>{const e=()=>{(()=>{const e=document.querySelectorAll("pre > code.mermaid");0!==e.length&&e.forEach(e=>{const t=document.createElement("pre");t.className="mermaid-src",t.hidden=!0,t.textContent=e.textContent;const n=document.createElement("div");n.className="mermaid-wrap",n.appendChild(t),e.parentNode.replaceWith(n)})})();const e=document.querySelectorAll("#article-container .mermaid-wrap");if(0===e.length)return;const t=()=>(e=>{window.loadMermaid=!0;const t="dark"===document.documentElement.getAttribute("data-theme")?"dark":"default";e.forEach((e,n)=>{const d=e.firstElementChild,a=`mermaid-${n}`,r=`%%{init:{ 'theme':'${t}'}}%%\n`+d.textContent,m=mermaid.render(a,r),o=e=>{d.insertAdjacentHTML("afterend",e)};"string"==typeof m?o(m):m.then(({svg:e})=>o(e))})})(e);btf.addGlobalFn("themeChange",t,"mermaid"),window.loadMermaid?t():btf.getScript("https://cdn.jsdelivr.net/npm/mermaid@11.12.0/dist/mermaid.min.js").then(t)};btf.addGlobalFn("encrypt",e,"mermaid"),window.pjax?e():document.addEventListener("DOMContentLoaded",e)})()</script><script>(()=>{const t="shuoshuo"===GLOBAL_CONFIG_SITE.pageType,e={"data-lang":"zh-CN","data-input-position":"top","data-loading":"lazy"},a=t=>"dark"===t?"noborder_dark":"noborder_light",s=(s=document,o)=>{const n=t?{"data-mapping":"specific","data-term":o}:{"data-mapping":e&&e["data-mapping"]||"pathname"},d=(t=>{const e=document.createElement("script");return Object.entries(t).forEach(([t,a])=>{e.setAttribute(t,a)}),e})({src:"https://giscus.app/client.js","data-repo":"MarsperL/MarsperL.github.io","data-repo-id":"R_kgDOHV6bsQ","data-category-id":"DIC_kwDOHV6bsc4Cd54m","data-theme":a(document.documentElement.getAttribute("data-theme")),"data-reactions-enabled":"1",crossorigin:"anonymous",async:!0,...e,...n});s.querySelector("#giscus-wrap").appendChild(d),t&&(window.shuoshuoComment.destroyGiscus=()=>{s.children.length&&(s.innerHTML="",s.classList.add("no-comment"))})};btf.addGlobalFn("themeChange",t=>{const e=document.querySelector("#giscus-wrap iframe");if(e){const s={giscus:{setConfig:{theme:a(t)}}};e.contentWindow.postMessage(s,"https://giscus.app")}},"giscus"),t?window.shuoshuoComment={loadComment:s}:s()})()</script><script>(()=>{const e="shuoshuo"===GLOBAL_CONFIG_SITE.pageType,t={label:"Utterances"},n=e=>"dark"===e?"dark-blue":"github-light",s=(s=document,r)=>{e&&(window.shuoshuoComment.destroyUtterances=()=>{s.children.length&&(s.innerHTML="",s.classList.add("no-comment"))});const o={src:"https://utteranc.es/client.js",repo:"MarsperL/yygyws",theme:n(document.documentElement.getAttribute("data-theme")),crossorigin:"anonymous",async:!0,...t,"issue-term":e?r:t&&t["issue-term"]||"title"},c=document.createElement("script");Object.entries(o).forEach(([e,t])=>c.setAttribute(e,t)),s.querySelector("#utterances-wrap").appendChild(c)};btf.addGlobalFn("themeChange",e=>{const t=document.querySelector("#utterances-wrap iframe");if(t){const s={type:"set-theme",theme:n(e)};t.contentWindow.postMessage(s,"https://utteranc.es")}},"utterances"),e?window.loadOtherComment=s:s()})()</script></div><script src="/js/parts.js"></script><script async src="/js/refresh.js"></script><script src="/js/background.js"></script><script async data-pjax src="//busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js"></script><div id="local-search"><div class="search-dialog"><nav class="search-nav"><span class="search-dialog-title">搜索</span><i class="fas fa-spinner fa-pulse" id="loading-status" hidden></i><button class="search-close-button"><i class="fas fa-times"></i></button></nav><div class="text-center" id="loading-database"><i class="fas fa-spinner fa-pulse"></i> <span>数据加载中</span></div><div class="local-search-input"><input placeholder="搜索文章" type="text"></div><hr><div id="local-search-results"></div><div class="ais-Pagination" id="local-search-pagination" style="display:none"><ul class="ais-Pagination-list"></ul></div><div id="local-search-stats"></div></div><div id="search-mask"></div><script src="/js/search/local-search.js?v=5.5.1"></script></div></div><script data-pjax>function butterfly_swiper_injector_config(){var a=document.getElementById("recent-posts");console.log("已挂载butterfly_swiper"),a.insertAdjacentHTML("afterbegin",'<div class="recent-post-item" style="height: auto;width: 100%"><div class="blog-slider swiper-container-fade swiper-container-horizontal" id="swiper_container"><div class="blog-slider__wrp swiper-wrapper" style="transition-duration: 0ms;"><div class="blog-slider__item swiper-slide" style="width: 750px; opacity: 1; transform: translate3d(0px, 0px, 0px); transition-duration: 0ms;"><a class="blog-slider__img" href="yyg/e102aa73/" alt=""><img width="48" height="48" src="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://imgapi.cn/api.php?fl=fengjing&amp;gs=images" alt="" onerror="this.src=https://unpkg.zhimg.com/akilar-candyassets/image/loading.gif; this.onerror = null;"/></a><div class="blog-slider__content"><span class="blog-slider__code">2024-07-15</span><a class="blog-slider__title" href="yyg/e102aa73/" alt="">Hexo-Butterfly美化教程-[1]基础环境</a><div class="blog-slider__text">点击查看置顶文章啦~~~</div><a class="blog-slider__button" href="yyg/e102aa73/" alt="">详情   </a></div></div><div class="blog-slider__item swiper-slide" style="width: 750px; opacity: 1; transform: translate3d(0px, 0px, 0px); transition-duration: 0ms;"><a class="blog-slider__img" href="yyg/80ffa402/" alt=""><img width="48" height="48" src="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="/img/icon.png" alt="" onerror="this.src=https://unpkg.zhimg.com/akilar-candyassets/image/loading.gif; this.onerror = null;"/></a><div class="blog-slider__content"><span class="blog-slider__code">2025-03-10</span><a class="blog-slider__title" href="yyg/80ffa402/" alt="">Hexo-Butterfly美化教程-[2]Butterfly主题安装</a><div class="blog-slider__text">点击查看置顶文章啦~~~</div><a class="blog-slider__button" href="yyg/80ffa402/" alt="">详情   </a></div></div><div class="blog-slider__item swiper-slide" style="width: 750px; opacity: 1; transform: translate3d(0px, 0px, 0px); transition-duration: 0ms;"><a class="blog-slider__img" href="yyg/b2261cee/" alt=""><img width="48" height="48" src="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://picapi.pai.al/api/scenery.php" alt="" onerror="this.src=https://unpkg.zhimg.com/akilar-candyassets/image/loading.gif; this.onerror = null;"/></a><div class="blog-slider__content"><span class="blog-slider__code">2025-05-19</span><a class="blog-slider__title" href="yyg/b2261cee/" alt="">Hexo-Butterfly美化教程-[3]建主要页面</a><div class="blog-slider__text">点击查看置顶文章啦~~~</div><a class="blog-slider__button" href="yyg/b2261cee/" alt="">详情   </a></div></div><div class="blog-slider__item swiper-slide" style="width: 750px; opacity: 1; transform: translate3d(0px, 0px, 0px); transition-duration: 0ms;"><a class="blog-slider__img" href="yyg/8a5ee3aa/" alt=""><img width="48" height="48" src="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://api.vvhan.com/api/wallpaper/views" alt="" onerror="this.src=https://unpkg.zhimg.com/akilar-candyassets/image/loading.gif; this.onerror = null;"/></a><div class="blog-slider__content"><span class="blog-slider__code">2025-05-19</span><a class="blog-slider__title" href="yyg/8a5ee3aa/" alt="">Hexo-Butterfly美化教程-[4]修改配置文件</a><div class="blog-slider__text">点击查看置顶文章啦~~~</div><a class="blog-slider__button" href="yyg/8a5ee3aa/" alt="">详情   </a></div></div><div class="blog-slider__item swiper-slide" style="width: 750px; opacity: 1; transform: translate3d(0px, 0px, 0px); transition-duration: 0ms;"><a class="blog-slider__img" href="yyg/23010111/" alt=""><img width="48" height="48" src="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://t.alcy.cc/fj" alt="" onerror="this.src=https://unpkg.zhimg.com/akilar-candyassets/image/loading.gif; this.onerror = null;"/></a><div class="blog-slider__content"><span class="blog-slider__code">2025-05-19</span><a class="blog-slider__title" href="yyg/23010111/" alt="">Hexo-Butterfly美化教程-[5]安装常用插件</a><div class="blog-slider__text">点击查看置顶文章啦~~~</div><a class="blog-slider__button" href="yyg/23010111/" alt="">详情   </a></div></div><div class="blog-slider__item swiper-slide" style="width: 750px; opacity: 1; transform: translate3d(0px, 0px, 0px); transition-duration: 0ms;"><a class="blog-slider__img" href="yyg/5986cad/" alt=""><img width="48" height="48" src="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="/img/icon.png" alt="" onerror="this.src=https://unpkg.zhimg.com/akilar-candyassets/image/loading.gif; this.onerror = null;"/></a><div class="blog-slider__content"><span class="blog-slider__code">2025-05-21</span><a class="blog-slider__title" href="yyg/5986cad/" alt="">Hexo-Butterfly美化教程-[6]开启博客评论</a><div class="blog-slider__text">点击查看置顶文章啦~~~</div><a class="blog-slider__button" href="yyg/5986cad/" alt="">详情   </a></div></div><div class="blog-slider__item swiper-slide" style="width: 750px; opacity: 1; transform: translate3d(0px, 0px, 0px); transition-duration: 0ms;"><a class="blog-slider__img" href="yyg/5baeb6c6/" alt=""><img width="48" height="48" src="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://imgapi.cn/api.php?fl=fengjing&amp;gs=images" alt="" onerror="this.src=https://unpkg.zhimg.com/akilar-candyassets/image/loading.gif; this.onerror = null;"/></a><div class="blog-slider__content"><span class="blog-slider__code">2025-05-20</span><a class="blog-slider__title" href="yyg/5baeb6c6/" alt="">Hexo-Butterfly美化教程-[7]功能魔改(源码方式)</a><div class="blog-slider__text">点击查看置顶文章啦~~~</div><a class="blog-slider__button" href="yyg/5baeb6c6/" alt="">详情   </a></div></div><div class="blog-slider__item swiper-slide" style="width: 750px; opacity: 1; transform: translate3d(0px, 0px, 0px); transition-duration: 0ms;"><a class="blog-slider__img" href="yyg/5f747cff/" alt=""><img width="48" height="48" src="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://api.jiangyuhui.top/aliyun/randomCover" alt="" onerror="this.src=https://unpkg.zhimg.com/akilar-candyassets/image/loading.gif; this.onerror = null;"/></a><div class="blog-slider__content"><span class="blog-slider__code">2025-05-23</span><a class="blog-slider__title" href="yyg/5f747cff/" alt="">Hexo-Butterfly美化教程-[8]随鼠标变幻的动态粒子线条背景</a><div class="blog-slider__text">点击查看置顶文章啦~~~</div><a class="blog-slider__button" href="yyg/5f747cff/" alt="">详情   </a></div></div><div class="blog-slider__item swiper-slide" style="width: 750px; opacity: 1; transform: translate3d(0px, 0px, 0px); transition-duration: 0ms;"><a class="blog-slider__img" href="yyg/ca46b09/" alt=""><img width="48" height="48" src="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://t.alcy.cc/fj" alt="" onerror="this.src=https://unpkg.zhimg.com/akilar-candyassets/image/loading.gif; this.onerror = null;"/></a><div class="blog-slider__content"><span class="blog-slider__code">2024-08-07</span><a class="blog-slider__title" href="yyg/ca46b09/" alt="">Hexo-Butterfly美化教程-[9]繁沙</a><div class="blog-slider__text">点击查看置顶文章啦~~~</div><a class="blog-slider__button" href="yyg/ca46b09/" alt="">详情   </a></div></div><div class="blog-slider__item swiper-slide" style="width: 750px; opacity: 1; transform: translate3d(0px, 0px, 0px); transition-duration: 0ms;"><a class="blog-slider__img" href="yyg/5ea27f40/" alt=""><img width="48" height="48" src="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://api.jiangyuhui.top/aliyun/randomCover" alt="" onerror="this.src=https://unpkg.zhimg.com/akilar-candyassets/image/loading.gif; this.onerror = null;"/></a><div class="blog-slider__content"><span class="blog-slider__code">2024-08-26</span><a class="blog-slider__title" href="yyg/5ea27f40/" alt="">在Github上使用OsmosFeed搭建在线RSS阅读器（无需服务器）</a><div class="blog-slider__text">点击查看置顶文章啦~~~</div><a class="blog-slider__button" href="yyg/5ea27f40/" alt="">详情   </a></div></div><div class="blog-slider__item swiper-slide" style="width: 750px; opacity: 1; transform: translate3d(0px, 0px, 0px); transition-duration: 0ms;"><a class="blog-slider__img" href="yyg/37098f8c/" alt=""><img width="48" height="48" src="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://tu.ltyuanfang.cn/api/fengjing.php" alt="" onerror="this.src=https://unpkg.zhimg.com/akilar-candyassets/image/loading.gif; this.onerror = null;"/></a><div class="blog-slider__content"><span class="blog-slider__code">2025-07-06</span><a class="blog-slider__title" href="yyg/37098f8c/" alt="">使用GitHub Actions实现Hexo博客的自动化发布</a><div class="blog-slider__text">点击查看置顶文章啦~~~</div><a class="blog-slider__button" href="yyg/37098f8c/" alt="">详情   </a></div></div></div><div class="blog-slider__pagination swiper-pagination-clickable swiper-pagination-bullets"></div></div></div>')}for(var elist="undefined".split(","),cpage=location.pathname,epage="all",flag=0,i=0;i<elist.length;i++)cpage.includes(elist[i])&&flag++;("all"===epage&&0==flag||epage===cpage)&&butterfly_swiper_injector_config()</script><script defer src="https://npm.elemecdn.com/hexo-butterfly-swiper/lib/swiper.min.js"></script><script defer data-pjax src="https://npm.elemecdn.com/hexo-butterfly-swiper/lib/swiper_init.js"></script><script async src="//at.alicdn.com/t/font_2032782_8d5kxvn09md.js"></script></body></html>