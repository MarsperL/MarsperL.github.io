<!DOCTYPE html><html lang="zh-CN" data-theme="dark"><head><script>(()=>{const e=navigator.serviceWorker;e?e.register("/sw.js").then(async e=>{console.log("SWPP æ³¨å†ŒæˆåŠŸ");try{await e.periodicSync.register("update",{minInterval:864e5})}catch(e){console.log("Periodic Sync æ³¨å†Œå¤±è´¥",e)}}).catch(e=>console.error("SWPP æ³¨å†Œå¤±è´¥",e)):console.warn("å½“å‰æµè§ˆå™¨ä¸æ”¯æŒ SW")})()</script><meta charset="UTF-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="viewport" content="width=device-width,initial-scale=1,viewport-fit=cover"><title>AnsibleçŸ¥è¯†æ¢³ç† | äº‘é‡é˜</title><meta name="author" content="äº‘é‡é˜"><meta name="copyright" content="äº‘é‡é˜"><meta name="format-detection" content="telephone=no"><meta name="theme-color" content="#0d0d0d"><meta name="description" content="ğŸ”œä»€ä¹ˆæ˜¯Ansibleï¼ŸğŸ”š                               Ansible æ˜¯ä¸€æ¬¾ IT è‡ªåŠ¨åŒ–å·¥å…·ã€‚ä¸»è¦åº”ç”¨åœºæ™¯æœ‰é…ç½®ç³»ç»Ÿã€è½¯ä»¶éƒ¨ç½²ã€æŒç»­å‘å¸ƒåŠä¸åœæœå¹³æ»‘æ»šåŠ¨æ›´æ–°çš„é«˜çº§ä»»åŠ¡ç¼–æ’ã€‚Ansible æä¾›å¼€æºè‡ªåŠ¨åŒ–ï¼Œå¯é™ä½å¤æ‚æ€§å¹¶åœ¨ä»»ä½•åœ°æ–¹è¿è¡Œã€‚ä½¿ç”¨ Ansible å¯ä»¥è‡ªåŠ¨æ‰§è¡Œå‡ ä¹ä»»ä½•ä»»åŠ¡ã€‚                             æ¶æ„ Ansibl"><meta property="og:type" content="article"><meta property="og:title" content="AnsibleçŸ¥è¯†æ¢³ç†"><meta property="og:url" content="https://yyg.js.cool/yyg/e80721f/index.html"><meta property="og:site_name" content="äº‘é‡é˜"><meta property="og:description" content="ğŸ”œä»€ä¹ˆæ˜¯Ansibleï¼ŸğŸ”š                               Ansible æ˜¯ä¸€æ¬¾ IT è‡ªåŠ¨åŒ–å·¥å…·ã€‚ä¸»è¦åº”ç”¨åœºæ™¯æœ‰é…ç½®ç³»ç»Ÿã€è½¯ä»¶éƒ¨ç½²ã€æŒç»­å‘å¸ƒåŠä¸åœæœå¹³æ»‘æ»šåŠ¨æ›´æ–°çš„é«˜çº§ä»»åŠ¡ç¼–æ’ã€‚Ansible æä¾›å¼€æºè‡ªåŠ¨åŒ–ï¼Œå¯é™ä½å¤æ‚æ€§å¹¶åœ¨ä»»ä½•åœ°æ–¹è¿è¡Œã€‚ä½¿ç”¨ Ansible å¯ä»¥è‡ªåŠ¨æ‰§è¡Œå‡ ä¹ä»»ä½•ä»»åŠ¡ã€‚                             æ¶æ„ Ansibl"><meta property="og:locale" content="zh_CN"><meta property="og:image" content="https://t.alcy.cc/fj"><meta property="article:published_time" content="2025-03-31T11:45:26.000Z"><meta property="article:modified_time" content="2025-05-17T10:37:38.000Z"><meta property="article:author" content="äº‘é‡é˜"><meta property="article:tag" content="çŸ¥è¯†æ¢³ç†"><meta property="article:tag" content="CI&#x2F;CD"><meta property="article:tag" content="è‡ªåŠ¨åŒ–è¿ç»´"><meta property="article:tag" content="Ansible"><meta property="article:tag" content="Linuxè¿ç»´"><meta name="twitter:card" content="summary"><meta name="twitter:image" content="https://t.alcy.cc/fj"><script type="application/ld+json">{
  "@context": "https://schema.org",
  "@type": "BlogPosting",
  "headline": "AnsibleçŸ¥è¯†æ¢³ç†",
  "url": "https://yyg.js.cool/yyg/e80721f/",
  "image": "https://t.alcy.cc/fj",
  "datePublished": "2025-03-31T11:45:26.000Z",
  "dateModified": "2025-05-17T10:37:38.000Z",
  "author": [
    {
      "@type": "Person",
      "name": "äº‘é‡é˜",
      "url": "https://yyg.js.cool/"
    }
  ]
}</script><link rel="shortcut icon" href="/img/icon.png"><link rel="canonical" href="https://yyg.js.cool/yyg/e80721f/index.html"><link rel="preconnect" href="//cdn.jsdelivr.net"><link rel="preconnect" href="//busuanzi.ibruce.info"><link rel="manifest" href="/manifest.json"><link rel="apple-touch-icon" sizes="180x180" href="/img/icon.png"><link rel="icon" type="image/png" sizes="32x32" href="/img/pwa/favicon-32x32.png"><link rel="icon" type="image/png" sizes="16x16" href="/img/pwa/favicon-16x16.png"><link rel="mask-icon" href="/img/pwa/icon.svg" color="#5bbad5"><link rel="stylesheet" href="/css/index.css?v=5.5.1"><link rel="stylesheet" href="https://s4.zstatic.net/npm/@fortawesome/fontawesome-free@6.7.2/css/all.min.css"><link rel="stylesheet" href="https://s4.zstatic.net/ajax/libs/fancyapps-ui/5.0.36/fancybox/fancybox.min.css" media="print" onload='this.media="all"'><script>(()=>{const e={set:(e,t,o)=>{if(!o)return;const a=Date.now()+864e5*o;localStorage.setItem(e,JSON.stringify({value:t,expiry:a}))},get:e=>{const t=localStorage.getItem(e);if(!t)return;const{value:o,expiry:a}=JSON.parse(t);if(!(Date.now()>a))return o;localStorage.removeItem(e)}};window.btf={saveToLocal:e,getScript:(e,t={})=>new Promise((o,a)=>{const n=document.createElement("script");n.src=e,n.async=!0,Object.entries(t).forEach(([e,t])=>n.setAttribute(e,t)),n.onload=n.onreadystatechange=()=>{n.readyState&&!/loaded|complete/.test(n.readyState)||o()},n.onerror=a,document.head.appendChild(n)}),getCSS:(e,t)=>new Promise((o,a)=>{const n=document.createElement("link");n.rel="stylesheet",n.href=e,t&&(n.id=t),n.onload=n.onreadystatechange=()=>{n.readyState&&!/loaded|complete/.test(n.readyState)||o()},n.onerror=a,document.head.appendChild(n)}),addGlobalFn:(e,t,o=!1,a=window)=>{if(e.startsWith("pjax"))return;const n=a.globalFn||{};n[e]=n[e]||{},n[e][o||Object.keys(n[e]).length]=t,a.globalFn=n}};const t=()=>{document.documentElement.setAttribute("data-theme","dark"),null!==document.querySelector('meta[name="theme-color"]')&&document.querySelector('meta[name="theme-color"]').setAttribute("content","#0d0d0d")},o=()=>{document.documentElement.setAttribute("data-theme","light"),null!==document.querySelector('meta[name="theme-color"]')&&document.querySelector('meta[name="theme-color"]').setAttribute("content","#ffffff")};btf.activateDarkMode=t,btf.activateLightMode=o;const a=e.get("theme");"dark"===a?t():"light"===a&&o();const n=e.get("aside-status");void 0!==n&&document.documentElement.classList.toggle("hide-aside","hide"===n);/iPad|iPhone|iPod|Macintosh/.test(navigator.userAgent)&&document.documentElement.classList.add("apple")})()</script><script>const GLOBAL_CONFIG={root:"/",algolia:void 0,localSearch:{path:"/search.json",preload:!1,top_n_per_article:1,unescape:!1,pagination:{enable:!0,hitsPerPage:8},languages:{hits_empty:"æœªæ‰¾åˆ°ç¬¦åˆæ‚¨æŸ¥è¯¢çš„å†…å®¹ï¼š${query}",hits_stats:"å…±æ‰¾åˆ° ${hits} ç¯‡æ–‡ç« "}},translate:void 0,highlight:{plugin:"highlight.js",highlightCopy:!0,highlightLang:!0,highlightHeightLimit:200,highlightFullpage:!1,highlightMacStyle:!0},copy:{success:"å¤åˆ¶æˆåŠŸ",error:"å¤åˆ¶å¤±è´¥",noSupport:"æµè§ˆå™¨ä¸æ”¯æŒ"},relativeDate:{homepage:!1,post:!1},runtime:"å¤©",dateSuffix:{just:"åˆšåˆš",min:"åˆ†é’Ÿå‰",hour:"å°æ—¶å‰",day:"å¤©å‰",month:"ä¸ªæœˆå‰"},copyright:void 0,lightbox:"fancybox",Snackbar:void 0,infinitegrid:{js:"https://s4.zstatic.net/ajax/libs/egjs-infinitegrid/4.12.0/infinitegrid.min.js",buttonText:"åŠ è½½æ›´å¤š"},isPhotoFigcaption:!1,islazyloadPlugin:!0,isAnchor:!1,percent:{toc:!0,rightside:!0},autoDarkmode:!1}</script><script id="config-diff">var GLOBAL_CONFIG_SITE={title:"AnsibleçŸ¥è¯†æ¢³ç†",isHighlightShrink:!1,isToc:!0,pageType:"post"}</script><link rel="stylesheet" href="/css/parts.css"><link rel="stylesheet" href="/css/link.css"><script src="https://npm.elemecdn.com/echarts@5.4.3/dist/echarts.min.js"></script><script defer src="https://s4.zstatic.net/ajax/libs/sweetalert2/11.16.1/sweetalert2.all.js"></script><script defer src="/js/lunar.js"></script><script defer src="/js/day.js"></script><script defer src="/sw-dom.js"></script><link rel="stylesheet" href="https://npm.elemecdn.com/hexo-butterfly-swiper/lib/swiper.min.css" media="print" onload='this.media="all"'><link rel="stylesheet" href="https://npm.elemecdn.com/hexo-butterfly-swiper/lib/swiperstyle.css" media="print" onload='this.media="all"'><link rel="stylesheet" href="https://npm.elemecdn.com/hexo-butterfly-tag-plugins-plus@latest/lib/assets/font-awesome-animation.min.css" media="defer" onload='this.media="all"'><link rel="stylesheet" href="https://npm.elemecdn.com/hexo-butterfly-tag-plugins-plus@latest/lib/tag_plugins.css" media="defer" onload='this.media="all"'><script src="https://npm.elemecdn.com/hexo-butterfly-tag-plugins-plus@latest/lib/assets/carousel-touch.js"></script><meta name="generator" content="Hexo 7.3.0"><link rel="alternate" href="/rss2.xml" title="äº‘é‡é˜" type="application/rss+xml"></head><body><div id="sidebar"><div id="menu-mask"></div><div id="sidebar-menus"><div class="avatar-img text-center"><img src="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="/img/icon.png" onerror='this.onerror=null,this.src="/img/friend_404.gif"' alt="avatar"></div><div class="site-data text-center"><a href="/archives/"><div class="headline">æ–‡ç« </div><div class="length-num">62</div></a><a href="/tags/"><div class="headline">æ ‡ç­¾</div><div class="length-num">109</div></a><a href="/categories/"><div class="headline">åˆ†ç±»</div><div class="length-num">37</div></a></div><div class="menus_items"><div class="menus_item"><a class="site-page" href="/"><i class="fa-fw fas fa-home"></i> <span>é¦–é¡µ</span></a></div><div class="menus_item"><a class="site-page" href="/docs/"><i class="fa-fw fa-solid fa-book-bookmark"></i> <span>æ•™ç¨‹æ‰‹å†Œ</span></a></div><div class="menus_item"><span class="site-page group"><i class="fa-fw fa-solid fa-blog"></i> <span>åšæ–‡</span><i class="fas fa-chevron-down"></i></span><ul class="menus_item_child"><li><a class="site-page child" href="/archives/"><i class="fa-fw fas fa-archive"></i> <span>å½’æ¡£</span></a></li><li><a class="site-page child" href="/tags/"><i class="fa-fw fas fa-tags"></i> <span>æ ‡ç­¾</span></a></li><li><a class="site-page child" href="/categories/"><i class="fa-fw fas fa-folder-open"></i> <span>åˆ†ç±»</span></a></li><li><a class="site-page child" href="javascript:randomPost();"><i class="fa-fw fa-solid fa-shuffle"></i> <span>éšæœºä¸€ç¯‡</span></a></li></ul></div><div class="menus_item"><span class="site-page group"><i class="fa-fw fa-brands fa-get-pocket"></i> <span>è“å£è¢‹</span><i class="fas fa-chevron-down"></i></span><ul class="menus_item_child"><li><a class="site-page child" href="/pintree/"><i class="fa-fw fa fa-search-plus"></i> <span>å¯¼èˆª</span></a></li><li><a class="site-page child" href="/sand/"><i class="fa-fw fa fa-cube"></i> <span>ç¹æ²™</span></a></li><li><a class="site-page child" href="/trip/"><i class="fa-fw fa-solid fa-earth-asia"></i> <span>æ˜Ÿæ¸¸è®°</span></a></li><li><a class="site-page child" href="/share/"><i class="fa-fw fa-solid fa-star"></i> <span>ä¹¦â€¢å½±â€¢éŸ³</span></a></li><li><a class="site-page child" href="/focusclock/"><i class="fa-fw fas fa-clock"></i> <span>ä¸“æ³¨æ—¶é’Ÿ</span></a></li></ul></div><div class="menus_item"><span class="site-page group"><i class="fa-fw fas fa-comments"></i> <span>èŠå¤©å®¤</span><i class="fas fa-chevron-down"></i></span><ul class="menus_item_child"><li><a class="site-page child" href="/shuoshuo/"><i class="fa-fw fas fa-comment-dots"></i> <span>è¯´è¯´</span></a></li><li><a class="site-page child" href="/messageboard/"><i class="fa-fw fa fa-paper-plane"></i> <span>å¿ƒè¯­äº­</span></a></li></ul></div><div class="menus_item"><span class="site-page group"><i class="fa-fw fas fa-book-open"></i> <span>æ–‡ç•Œ</span><i class="fas fa-chevron-down"></i></span><ul class="menus_item_child"><li><a class="site-page child" href="/yygrss/"><i class="fa-fw fa-solid fa-square-rss"></i> <span>ç€šæ–‡é›†</span></a></li><li><a class="site-page child" href="/fcircle/"><i class="fa-fw fa-solid fa-comment-nodes"></i> <span>å‹æ–‡è¯´</span></a></li></ul></div><div class="menus_item"><span class="site-page group"><i class="fa-fw fa-solid fa-circle-user"></i> <span>æ›´å¤š</span><i class="fas fa-chevron-down"></i></span><ul class="menus_item_child"><li><a class="site-page child" href="/link/"><i class="fa-fw fas fa-link"></i> <span>å‹é“¾</span></a></li><li><a class="site-page child" href="/about/"><i class="fa-fw fas fa-heart"></i> <span>å…³äº</span></a></li></ul></div></div></div></div><div class="post" id="body-wrap"><header class="post-bg" id="page-header" style="background-image:url(https://t.alcy.cc/fj)"><nav id="nav"><span id="blog-info"><a class="nav-site-title" href="/"><img class="site-icon" src="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://gcore.jsdelivr.net/gh/MarsperL/MarsperL.github.io@2.1/img/icon.png" alt="Logo"><span class="site-name">äº‘é‡é˜</span></a><a class="nav-page-title" href="/"><span class="site-name">AnsibleçŸ¥è¯†æ¢³ç†</span><span class="site-name"><i class="fa-solid fa-circle-arrow-left"></i> <span>è¿”å›é¦–é¡µ</span></span></a></span><div id="menus"><div id="search-button"><span class="site-page social-icon search"><i class="fas fa-search fa-fw"></i> <span>æœç´¢</span></span></div><div class="menus_items"><div class="menus_item"><a class="site-page" href="/"><i class="fa-fw fas fa-home"></i> <span>é¦–é¡µ</span></a></div><div class="menus_item"><a class="site-page" href="/docs/"><i class="fa-fw fa-solid fa-book-bookmark"></i> <span>æ•™ç¨‹æ‰‹å†Œ</span></a></div><div class="menus_item"><span class="site-page group"><i class="fa-fw fa-solid fa-blog"></i> <span>åšæ–‡</span><i class="fas fa-chevron-down"></i></span><ul class="menus_item_child"><li><a class="site-page child" href="/archives/"><i class="fa-fw fas fa-archive"></i> <span>å½’æ¡£</span></a></li><li><a class="site-page child" href="/tags/"><i class="fa-fw fas fa-tags"></i> <span>æ ‡ç­¾</span></a></li><li><a class="site-page child" href="/categories/"><i class="fa-fw fas fa-folder-open"></i> <span>åˆ†ç±»</span></a></li><li><a class="site-page child" href="javascript:randomPost();"><i class="fa-fw fa-solid fa-shuffle"></i> <span>éšæœºä¸€ç¯‡</span></a></li></ul></div><div class="menus_item"><span class="site-page group"><i class="fa-fw fa-brands fa-get-pocket"></i> <span>è“å£è¢‹</span><i class="fas fa-chevron-down"></i></span><ul class="menus_item_child"><li><a class="site-page child" href="/pintree/"><i class="fa-fw fa fa-search-plus"></i> <span>å¯¼èˆª</span></a></li><li><a class="site-page child" href="/sand/"><i class="fa-fw fa fa-cube"></i> <span>ç¹æ²™</span></a></li><li><a class="site-page child" href="/trip/"><i class="fa-fw fa-solid fa-earth-asia"></i> <span>æ˜Ÿæ¸¸è®°</span></a></li><li><a class="site-page child" href="/share/"><i class="fa-fw fa-solid fa-star"></i> <span>ä¹¦â€¢å½±â€¢éŸ³</span></a></li><li><a class="site-page child" href="/focusclock/"><i class="fa-fw fas fa-clock"></i> <span>ä¸“æ³¨æ—¶é’Ÿ</span></a></li></ul></div><div class="menus_item"><span class="site-page group"><i class="fa-fw fas fa-comments"></i> <span>èŠå¤©å®¤</span><i class="fas fa-chevron-down"></i></span><ul class="menus_item_child"><li><a class="site-page child" href="/shuoshuo/"><i class="fa-fw fas fa-comment-dots"></i> <span>è¯´è¯´</span></a></li><li><a class="site-page child" href="/messageboard/"><i class="fa-fw fa fa-paper-plane"></i> <span>å¿ƒè¯­äº­</span></a></li></ul></div><div class="menus_item"><span class="site-page group"><i class="fa-fw fas fa-book-open"></i> <span>æ–‡ç•Œ</span><i class="fas fa-chevron-down"></i></span><ul class="menus_item_child"><li><a class="site-page child" href="/yygrss/"><i class="fa-fw fa-solid fa-square-rss"></i> <span>ç€šæ–‡é›†</span></a></li><li><a class="site-page child" href="/fcircle/"><i class="fa-fw fa-solid fa-comment-nodes"></i> <span>å‹æ–‡è¯´</span></a></li></ul></div><div class="menus_item"><span class="site-page group"><i class="fa-fw fa-solid fa-circle-user"></i> <span>æ›´å¤š</span><i class="fas fa-chevron-down"></i></span><ul class="menus_item_child"><li><a class="site-page child" href="/link/"><i class="fa-fw fas fa-link"></i> <span>å‹é“¾</span></a></li><li><a class="site-page child" href="/about/"><i class="fa-fw fas fa-heart"></i> <span>å…³äº</span></a></li></ul></div></div><div id="toggle-menu"><span class="site-page"><i class="fas fa-bars fa-fw"></i></span></div></div></nav><div id="post-info"><h1 class="post-title">AnsibleçŸ¥è¯†æ¢³ç†</h1><div id="post-meta"><div class="meta-firstline"><span class="post-meta-date"><i class="far fa-calendar-alt fa-fw post-meta-icon"></i><span class="post-meta-label">å‘è¡¨äº</span><time class="post-meta-date-created" datetime="2025-03-31T11:45:26.000Z" title="å‘è¡¨äº 2025-03-31 19:45:26">2025-03-31</time><span class="post-meta-separator">|</span><i class="fas fa-history fa-fw post-meta-icon"></i><span class="post-meta-label">æ›´æ–°äº</span><time class="post-meta-date-updated" datetime="2025-05-17T10:37:38.000Z" title="æ›´æ–°äº 2025-05-17 18:37:38">2025-05-17</time></span><span class="post-meta-categories"><span class="post-meta-separator">|</span><i class="fas fa-inbox fa-fw post-meta-icon"></i><a class="post-meta-categories" href="/categories/%E6%A2%B3%E7%90%86%E6%80%BB%E7%BB%93/">æ¢³ç†æ€»ç»“</a><i class="fas fa-angle-right post-meta-separator"></i><i class="fas fa-inbox fa-fw post-meta-icon"></i><a class="post-meta-categories" href="/categories/%E6%A2%B3%E7%90%86%E6%80%BB%E7%BB%93/%E7%9F%A5%E8%AF%86%E6%A2%B3%E7%90%86/">çŸ¥è¯†æ¢³ç†</a><i class="fas fa-angle-right post-meta-separator"></i><i class="fas fa-inbox fa-fw post-meta-icon"></i><a class="post-meta-categories" href="/categories/%E8%87%AA%E5%8A%A8%E5%8C%96%E8%BF%90%E7%BB%B4/">è‡ªåŠ¨åŒ–è¿ç»´</a><i class="fas fa-angle-right post-meta-separator"></i><i class="fas fa-inbox fa-fw post-meta-icon"></i><a class="post-meta-categories" href="/categories/%E8%87%AA%E5%8A%A8%E5%8C%96%E8%BF%90%E7%BB%B4/Ansible/">Ansible</a></span></div><div class="meta-secondline"><span class="post-meta-separator">|</span><span class="post-meta-wordcount"><i class="far fa-file-word fa-fw post-meta-icon"></i><span class="post-meta-label">æ€»å­—æ•°:</span><span class="word-count">7.3k</span><span class="post-meta-separator">|</span><i class="far fa-clock fa-fw post-meta-icon"></i><span class="post-meta-label">é˜…è¯»æ—¶é•¿:</span><span>31åˆ†é’Ÿ</span></span><span class="post-meta-separator">|</span><span class="post-meta-pv-cv" data-flag-title=""><i class="far fa-eye fa-fw post-meta-icon"></i><span class="post-meta-label">æµè§ˆé‡:</span><span id="busuanzi_value_page_pv"><i class="fa-solid fa-spinner fa-spin"></i></span></span></div></div></div><section class="main-hero-waves-area waves-area"><svg class="waves-svg" xmlns="http://www.w3.org/2000/svg" xlink="http://www.w3.org/1999/xlink" viewBox="0 24 150 28" preserveAspectRatio="none" shape-rendering="auto"><defs><path id="gentle-wave" d="M-160 44c30 0 58-18 88-18s58 18 88 18 58-18 88-18 58 18 88 18v44h-352Z"></path></defs><g class="parallax"><use href="#gentle-wave" x="48" y="0"></use><use href="#gentle-wave" x="48" y="3"></use><use href="#gentle-wave" x="48" y="5"></use><use href="#gentle-wave" x="48" y="7"></use></g></svg></section></header><main class="layout" id="content-inner"><div id="post"><article class="container post-content" id="article-container"><details class="folding-tag" cyan><summary>ğŸ”œä»€ä¹ˆæ˜¯Ansibleï¼ŸğŸ”š</summary><div class="content"><p>Ansible æ˜¯ä¸€æ¬¾ IT è‡ªåŠ¨åŒ–å·¥å…·ã€‚ä¸»è¦åº”ç”¨åœºæ™¯æœ‰é…ç½®ç³»ç»Ÿã€è½¯ä»¶éƒ¨ç½²ã€æŒç»­å‘å¸ƒåŠä¸åœæœå¹³æ»‘æ»šåŠ¨æ›´æ–°çš„é«˜çº§ä»»åŠ¡ç¼–æ’ã€‚</p><p>Ansible æä¾›å¼€æºè‡ªåŠ¨åŒ–ï¼Œå¯é™ä½å¤æ‚æ€§å¹¶åœ¨ä»»ä½•åœ°æ–¹è¿è¡Œã€‚ä½¿ç”¨ Ansible å¯ä»¥è‡ªåŠ¨æ‰§è¡Œå‡ ä¹ä»»ä½•ä»»åŠ¡ã€‚</p></div></details><h2 id="æ¶æ„"><a href="#æ¶æ„" class="headerlink" title="æ¶æ„"></a>æ¶æ„</h2><blockquote><p><code>Ansible</code>ï¼šAnsibleæ ¸å¿ƒç¨‹åºã€‚<br><code>HostInventory</code>ï¼šè®°å½•ç”±Ansibleç®¡ç†çš„ä¸»æœºä¿¡æ¯ï¼ŒåŒ…æ‹¬ç«¯å£ã€å¯†ç ã€ipç­‰ã€‚<br><code>Playbooks</code>ï¼šâ€œå‰§æœ¬â€YAMLæ ¼å¼æ–‡ä»¶ï¼Œå¤šä¸ªä»»åŠ¡å®šä¹‰åœ¨ä¸€ä¸ªæ–‡ä»¶ä¸­ï¼Œå®šä¹‰ä¸»æœºéœ€è¦è°ƒç”¨å“ªäº›æ¨¡å—æ¥å®Œæˆçš„åŠŸèƒ½ã€‚<br><code>CoreModules</code>ï¼š<strong>æ ¸å¿ƒæ¨¡å—</strong>ï¼Œä¸»è¦æ“ä½œæ˜¯é€šè¿‡è°ƒç”¨æ ¸å¿ƒæ¨¡å—æ¥å®Œæˆç®¡ç†ä»»åŠ¡ã€‚<br><code>CustomModules</code>ï¼šè‡ªå®šä¹‰æ¨¡å—ï¼Œå®Œæˆæ ¸å¿ƒæ¨¡å—æ— æ³•å®Œæˆçš„åŠŸèƒ½ï¼Œæ”¯æŒå¤šç§è¯­è¨€ã€‚<br><code>ConnectionPlugins</code>ï¼šè¿æ¥æ’ä»¶ï¼ŒAnsibleå’ŒHosté€šä¿¡ä½¿ç”¨</p></blockquote><img src="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="/yyg/e80721f/1.png" title="image-20250331194718453"><h2 id="Ansibleé‡è¦æ¦‚å¿µ"><a href="#Ansibleé‡è¦æ¦‚å¿µ" class="headerlink" title="Ansibleé‡è¦æ¦‚å¿µ"></a>Ansibleé‡è¦æ¦‚å¿µ</h2><h3 id="æ§åˆ¶èŠ‚ç‚¹"><a href="#æ§åˆ¶èŠ‚ç‚¹" class="headerlink" title="æ§åˆ¶èŠ‚ç‚¹"></a>æ§åˆ¶èŠ‚ç‚¹</h3><p>æ§åˆ¶èŠ‚ç‚¹æ˜¯è¿è¡Œ Ansible Ansible CLI å·¥å…· çš„æœºå™¨ã€‚å®ƒè´Ÿè´£ä¸å—æ§èŠ‚ç‚¹ï¼ˆè¢«ç®¡ç†èŠ‚ç‚¹ï¼‰è¿›è¡Œé€šä¿¡ï¼Œå‘å‡ºå‘½ä»¤å¹¶æ‰§è¡Œä»»åŠ¡ã€‚</p><h3 id="å—æ§èŠ‚ç‚¹ï¼ˆè¢«ç®¡ç†èŠ‚ç‚¹ï¼‰"><a href="#å—æ§èŠ‚ç‚¹ï¼ˆè¢«ç®¡ç†èŠ‚ç‚¹ï¼‰" class="headerlink" title="å—æ§èŠ‚ç‚¹ï¼ˆè¢«ç®¡ç†èŠ‚ç‚¹ï¼‰"></a>å—æ§èŠ‚ç‚¹ï¼ˆè¢«ç®¡ç†èŠ‚ç‚¹ï¼‰</h3><p>ä¹Ÿç§°ä¸ºâ€œä¸»æœºâ€ï¼Œè¿™äº›æ˜¯ç”¨ Ansible ç®¡ç†çš„ç›®æ ‡è®¾å¤‡ã€‚Ansibleæ§åˆ¶èŠ‚ç‚¹ä¼šåœ¨è¿™äº›æœºå™¨ä¸Šæ‰§è¡Œä»»åŠ¡ã€‚å—æ§èŠ‚ç‚¹ä¸éœ€è¦å®‰è£…ä»»ä½•ä»£ç†ã€‚</p><h3 id="åº“å­˜-Inventory"><a href="#åº“å­˜-Inventory" class="headerlink" title="åº“å­˜ (Inventory)"></a>åº“å­˜ (Inventory)</h3><p>åŒ…å«è¦ç®¡ç†çš„ç›®æ ‡ä¸»æœºæˆ–èŠ‚ç‚¹çš„æ¸…å•ã€‚å®ƒæ˜¯ Ansible ç”¨æ¥å®šä¹‰ç›®æ ‡ä¸»æœºä¿¡æ¯çš„é…ç½®æ–‡ä»¶ï¼Œæ”¯æŒé™æ€æˆ–åŠ¨æ€çš„ä¸»æœºæ¸…å•ã€‚å®ƒè¿˜ç”¨äºåˆ†é…ç»„ï¼Œè¿™æ—¢å…è®¸åœ¨å‰§é›†ä¸­é€‰æ‹©èŠ‚ç‚¹ï¼Œä¹Ÿå…è®¸æ‰¹é‡åˆ†é…å˜é‡ã€‚</p><h3 id="å‰§æœ¬ï¼ˆPlaybookï¼‰"><a href="#å‰§æœ¬ï¼ˆPlaybookï¼‰" class="headerlink" title="å‰§æœ¬ï¼ˆPlaybookï¼‰"></a>å‰§æœ¬ï¼ˆPlaybookï¼‰</h3><p>Playbook æ˜¯ Ansible é…ç½®ç®¡ç†çš„æ ¸å¿ƒéƒ¨åˆ†ï¼Œæ˜¯ä¸€ç»„ç”¨äºè‡ªåŠ¨åŒ–æ‰§è¡Œä»»åŠ¡çš„ YAML æ–‡ä»¶ã€‚Playbook å¯ä»¥æ‰§è¡Œå¤šä¸ªæ­¥éª¤ï¼ˆä¾‹å¦‚å®‰è£…è½¯ä»¶ã€å¯åŠ¨æœåŠ¡ç­‰ï¼‰ï¼Œå¹¶å®šä¹‰æ‰§è¡Œé¡ºåºã€ä»»åŠ¡ç­‰ã€‚</p><h3 id="æ¨¡å—-Modules"><a href="#æ¨¡å—-Modules" class="headerlink" title="æ¨¡å— (Modules)"></a>æ¨¡å— (Modules)</h3><p>æ¨¡å—æ˜¯ Ansible ä¸­æ‰§è¡Œå®é™…ä»»åŠ¡çš„å•å…ƒã€‚å®ƒä»¬æ˜¯é«˜åº¦å¯å¤ç”¨çš„ä»£ç å—ï¼Œè´Ÿè´£æ‰§è¡Œç‰¹å®šçš„æ“ä½œï¼ˆå¦‚å®‰è£…è½¯ä»¶åŒ…ã€é…ç½®æ–‡ä»¶ç­‰ï¼‰ã€‚</p><h3 id="è§’è‰²-Roles"><a href="#è§’è‰²-Roles" class="headerlink" title="è§’è‰² (Roles)"></a>è§’è‰² (Roles)</h3><p>è§’è‰²æ˜¯ Playbook çš„ä¸€ç§ç»„ç»‡æ–¹å¼ï¼Œç”¨äºæŠŠå¤šä¸ªä»»åŠ¡ã€æ–‡ä»¶ã€æ¨¡æ¿ã€å˜é‡ç­‰ç»„ç»‡æˆä¸€ä¸ªå®Œæ•´çš„åŠŸèƒ½æ¨¡å—ã€‚è§’è‰²å¸®åŠ©å°†å¤æ‚çš„é…ç½®æ‹†åˆ†æˆå¯å¤ç”¨çš„ç»„ä»¶ã€‚å¯åœ¨å‰§é›†å†…éƒ¨ä½¿ç”¨çš„å¯é‡ç”¨ Ansible å†…å®¹ã€‚</p><h3 id="ä»»åŠ¡-Tasks"><a href="#ä»»åŠ¡-Tasks" class="headerlink" title="ä»»åŠ¡ (Tasks)"></a>ä»»åŠ¡ (Tasks)</h3><p>ä»»åŠ¡æ˜¯ Playbook ä¸­å®šä¹‰çš„å…·ä½“æ“ä½œã€‚æ¯ä¸ªä»»åŠ¡é€šå¸¸ä¼šè°ƒç”¨ä¸€ä¸ª Ansible æ¨¡å—æ¥æ‰§è¡Œç‰¹å®šçš„æ“ä½œã€‚æ˜¯ad-hoc æ›´é€‚åˆä¸´æ—¶æ‰§è¡Œå‘½ä»¤çš„æ‰§è¡Œåœºæ™¯ã€‚</p><h3 id="æ’ä»¶"><a href="#æ’ä»¶" class="headerlink" title="æ’ä»¶"></a>æ’ä»¶</h3><p>æ‰©å±• Ansible æ ¸å¿ƒåŠŸèƒ½çš„ä»£ç ç‰‡æ®µã€‚æ’ä»¶å¯ä»¥æ§åˆ¶æ‚¨å¦‚ä½•è¿æ¥åˆ°è¢«ç®¡ç†èŠ‚ç‚¹ï¼ˆè¿æ¥æ’ä»¶ï¼‰ã€æ“ä½œæ•°æ®ï¼ˆè¿‡æ»¤å™¨æ’ä»¶ï¼‰ï¼Œç”šè‡³æ§åˆ¶åœ¨æ§åˆ¶å°ä¸­æ˜¾ç¤ºçš„å†…å®¹ï¼ˆå›è°ƒæ’ä»¶ï¼‰ã€‚</p><h3 id="é›†åˆ"><a href="#é›†åˆ" class="headerlink" title="é›†åˆ"></a>é›†åˆ</h3><p>Ansible å†…å®¹çš„åˆ†å‘æ ¼å¼ï¼Œå¯ä»¥åŒ…å«å‰§æœ¬ã€è§’è‰²ã€æ¨¡å—å’Œæ’ä»¶ã€‚</p><h2 id="Ansibleä»»åŠ¡æ‰§è¡Œæ¨¡å¼"><a href="#Ansibleä»»åŠ¡æ‰§è¡Œæ¨¡å¼" class="headerlink" title="Ansibleä»»åŠ¡æ‰§è¡Œæ¨¡å¼"></a>Ansibleä»»åŠ¡æ‰§è¡Œæ¨¡å¼</h2><p>Ansible ç³»ç»Ÿç”±æ§åˆ¶ä¸»æœºå¯¹è¢«ç®¡èŠ‚ç‚¹çš„æ“ä½œæ–¹å¼å¯åˆ†ä¸ºä¸¤ç±»ï¼Œå³<code>ad-hoc</code>å’Œ<code>playbook</code>ï¼š</p><ul><li>ad-hocæ¨¡å¼(ç‚¹å¯¹ç‚¹æ¨¡å¼)<br>ã€€ã€€ä½¿ç”¨å•ä¸ªæ¨¡å—ï¼Œæ”¯æŒæ‰¹é‡æ‰§è¡Œå•æ¡å‘½ä»¤ã€‚ad-hoc å‘½ä»¤æ˜¯ä¸€ç§å¯ä»¥å¿«é€Ÿè¾“å…¥çš„å‘½ä»¤ï¼Œè€Œä¸”ä¸éœ€è¦ä¿å­˜èµ·æ¥çš„å‘½ä»¤ã€‚</li><li>playbookæ¨¡å¼(å‰§æœ¬æ¨¡å¼)<br>ã€€ã€€æ˜¯Ansibleä¸»è¦ç®¡ç†æ–¹å¼ï¼Œä¹Ÿæ˜¯AnsibleåŠŸèƒ½å¼ºå¤§çš„å…³é”®æ‰€åœ¨ã€‚<strong>playbooké€šè¿‡å¤šä¸ªtaské›†åˆå®Œæˆä¸€ç±»åŠŸèƒ½</strong>ã€‚å¯ä»¥ç®€å•åœ°æŠŠplaybookç†è§£ä¸ºé€šè¿‡ç»„åˆå¤šæ¡ad-hocæ“ä½œçš„é…ç½®æ–‡ä»¶ã€‚</li></ul><h2 id="Ansibleå®‰è£…ï¼ˆcentos-7ï¼‰"><a href="#Ansibleå®‰è£…ï¼ˆcentos-7ï¼‰" class="headerlink" title="Ansibleå®‰è£…ï¼ˆcentos 7ï¼‰"></a>Ansibleå®‰è£…ï¼ˆcentos 7ï¼‰</h2><p>ä¿®æ”¹ç³»ç»Ÿé•œåƒæºä¸ºé˜¿é‡Œäº‘é•œåƒæº</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">cd /etc/yum.repos.d</span><br><span class="line">mv CentOS-Base.repo CentOS-Base.repo.bak</span><br><span class="line">curl -o /etc/yum.repos.d/CentOS-Base.repo http://mirrors.aliyun.com/repo/Centos-7.repo</span><br></pre></td></tr></table></figure><h3 id="æ–¹å¼ä¸€ï¼šä½¿ç”¨yumå®‰è£…"><a href="#æ–¹å¼ä¸€ï¼šä½¿ç”¨yumå®‰è£…" class="headerlink" title="æ–¹å¼ä¸€ï¼šä½¿ç”¨yumå®‰è£…"></a>æ–¹å¼ä¸€ï¼šä½¿ç”¨yumå®‰è£…</h3><p>å®‰è£…<code>epel-release</code>åŒ…ä¸<code>Ansible</code></p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">yum install epel-release -y</span><br><span class="line">yum install ansible -y</span><br><span class="line"><span class="meta prompt_">#</span><span class="language-bash">æŸ¥çœ‹ç‰ˆæœ¬</span></span><br><span class="line"> ansible --version</span><br></pre></td></tr></table></figure><h3 id="æ–¹å¼äºŒï¼šä½¿ç”¨pipå®‰è£…"><a href="#æ–¹å¼äºŒï¼šä½¿ç”¨pipå®‰è£…" class="headerlink" title="æ–¹å¼äºŒï¼šä½¿ç”¨pipå®‰è£…"></a>æ–¹å¼äºŒï¼šä½¿ç”¨pipå®‰è£…</h3><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">yum install python3 python3-devel python3-pip -y</span><br><span class="line">python3 -m pip install ansible</span><br><span class="line"><span class="meta prompt_">#</span><span class="language-bash">æŸ¥çœ‹ç‰ˆæœ¬</span></span><br><span class="line"> ansible --version</span><br></pre></td></tr></table></figure><h2 id="Ansible-é…ç½®æ–‡ä»¶"><a href="#Ansible-é…ç½®æ–‡ä»¶" class="headerlink" title="Ansible é…ç½®æ–‡ä»¶"></a>Ansible é…ç½®æ–‡ä»¶</h2><p>é…ç½®æ–‡ä»¶è¯»å–çš„ä¼˜å…ˆçº§é¡ºåºå¦‚ä¸‹ï¼š</p><ol><li>æ£€æŸ¥ç¯å¢ƒå˜é‡<code>ANSIBLE_CONFIG</code>æŒ‡å‘çš„è·¯å¾„æ–‡ä»¶(export ANSIBLE_CONFIG=xxxx)ï¼›</li><li>æ£€æŸ¥å½“å‰é¡¹ç›®ç›®å½•ä¸‹çš„ansible.cfgé…ç½®æ–‡ä»¶ï¼›</li><li><code>~/.ansible.cfg</code>ï¼Œæ£€æŸ¥å½“å‰ç›®å½•ä¸‹çš„ansible.cfgé…ç½®æ–‡ä»¶ï¼›</li><li><code>/etc/ansible/ansible.cfg</code>æ£€æŸ¥etcç›®å½•çš„é…ç½®æ–‡ä»¶ã€‚</li></ol><h2 id="Ansibleå…å¯†ç™»å½•"><a href="#Ansibleå…å¯†ç™»å½•" class="headerlink" title="Ansibleå…å¯†ç™»å½•"></a>Ansibleå…å¯†ç™»å½•</h2><h3 id="rootç”¨æˆ·"><a href="#rootç”¨æˆ·" class="headerlink" title="rootç”¨æˆ·"></a>rootç”¨æˆ·</h3><p>æ§åˆ¶èŠ‚ç‚¹è®¾ç½®sshå…å¯†ç™»å½•ï¼Œå¹¶å°†å¯†é’¥ä¼ è‡³å—æ§èŠ‚ç‚¹ä¸Šã€‚</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">ssh-keygen -t dsa -f ~/.ssh/id_dsa -P &quot;&quot;</span><br><span class="line">ssh-copy-id -i ~/.ssh/id_dsa.pub root@å—æ§ä¸»æœºip</span><br></pre></td></tr></table></figure><h3 id="æ™®é€šç”¨æˆ·"><a href="#æ™®é€šç”¨æˆ·" class="headerlink" title="æ™®é€šç”¨æˆ·"></a>æ™®é€šç”¨æˆ·</h3><p>æ§åˆ¶èŠ‚ç‚¹å’Œè¢«æ§èŠ‚ç‚¹éƒ½è¦æœ‰æ™®é€šç”¨æˆ·ï¼Œæ­¤å¤„ä»¥<code>test</code>ç”¨æˆ·ä¸ºä¾‹ã€‚</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta prompt_">#</span><span class="language-bash">æ·»åŠ <span class="built_in">test</span>ç”¨æˆ·ï¼Œå¹¶è®¾ç½®å¯†ç </span></span><br><span class="line">useradd test</span><br><span class="line">passwd test</span><br></pre></td></tr></table></figure><p>åœ¨æ§åˆ¶èŠ‚ç‚¹è®¾ç½®sshå…å¯†ç™»å½•ï¼Œå¹¶å°†å¯†é’¥ä¼ è‡³å—æ§èŠ‚ç‚¹ã€‚</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">ssh-keygen -t dsa -f ~/.ssh/id_dsa -P &quot;&quot;</span><br><span class="line">ssh-copy-id -i ~/.ssh/id_dsa.pub test@å—æ§ä¸»æœºip</span><br></pre></td></tr></table></figure><p>ä¿®æ”¹æ‰€æœ‰ä¸»æœºçš„<code>test</code>ç”¨æˆ·çš„sudoæƒé™ã€‚</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">visudo</span><br><span class="line">test    ALL=(ALL)       NOPASSWD: ALL</span><br></pre></td></tr></table></figure><p>ä¿®æ”¹æ§åˆ¶èŠ‚ç‚¹çš„é…ç½®æ–‡ä»¶<code>/etc/ansible/ansible.cfg</code>ï¼Œè®¾ç½®æ™®é€šç”¨æˆ·æƒé™æå‡ã€‚</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">vi /etc/ansible/ansible.cfg</span><br><span class="line"><span class="meta prompt_">#</span><span class="language-bash">å°†ä»¥ä¸‹å†…å®¹æ³¨é‡Šå–æ¶ˆ</span></span><br><span class="line">[privilege_escalation]</span><br><span class="line">become=True   #å¯ç”¨æƒé™æå‡</span><br><span class="line">become_method=sudo  #é€šè¿‡ sudo æå‡åˆ° root ç”¨æˆ·çš„æƒé™</span><br><span class="line">become_user=root  #ä½œä¸º root ç”¨æˆ·æ‰§è¡Œä»»åŠ¡</span><br><span class="line">become_ask_pass=False  #ç¦ç”¨å¯†ç æç¤º</span><br></pre></td></tr></table></figure><h2 id="Ansible-Ad-Hocä¸å¸¸ç”¨æ¨¡å—"><a href="#Ansible-Ad-Hocä¸å¸¸ç”¨æ¨¡å—" class="headerlink" title="Ansible Ad-Hocä¸å¸¸ç”¨æ¨¡å—"></a>Ansible Ad-Hocä¸å¸¸ç”¨æ¨¡å—</h2><h3 id="Ad-Hoc"><a href="#Ad-Hoc" class="headerlink" title="Ad-Hoc"></a>Ad-Hoc</h3><p>ad-hocå³ä¸ºå‘½ä»¤è¡Œæ¨¡å¼ï¼Œæ‰§è¡Œå®Œå³ç»“æŸã€‚</p><p><strong>å‘½ä»¤è¯­æ³•ç»“æ„ï¼š</strong></p><p><code>ansible &#39;groups&#39; -m command -a &#39;df -h&#39;</code>,å…¶å«ä¹‰å¦‚ä¸‹å›¾ï¼š</p><img src="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="/yyg/e80721f/2.png" title="image-20250407162815663"><p><strong>æ‰§è¡Œè¿‡ç¨‹ï¼š</strong></p><ol><li>åŠ è½½é…ç½®æ–‡ä»¶ï¼Œé»˜è®¤<code>/etc/ansible/ansible.cfg</code>;</li><li>æŸ¥æ‰¾å¯¹åº”çš„ä¸»æœºé…ç½®æ–‡ä»¶ï¼Œæ‰¾åˆ°è¦æ‰§è¡Œçš„ä¸»æœºæˆ–è€…ç»„ï¼š</li><li>åŠ è½½å¯¹åº”çš„æ¨¡å—æ–‡ä»¶ï¼Œå¦‚<code>command</code>;</li><li>é€šè¿‡<code>ansible</code>å°†æ¨¡å—æˆ–å‘½ä»¤ç”Ÿæˆå¯¹åº”çš„ä¸´æ—¶<code>py</code>æ–‡ä»¶ï¼Œå¹¶å°†è¯¥æ–‡ä»¶ä¼ è¾“è‡³è¿œç¨‹æœåŠ¡å™¨å¯¹åº”æ‰§è¡Œç”¨æˆ·<code>$HOME/.ansible/tmp/ansible-tmp-number/XXX.PY</code>;</li><li>è¿œç¨‹ä¸»æœºæ‰§è¡Œè¯¥æ–‡ä»¶ï¼›</li><li>æ‰§è¡Œå¹¶è¿”å›ç»“æœï¼›</li><li>åˆ é™¤ä¸´æ—¶<code>py</code>æ–‡ä»¶ï¼Œ<code>sleep 0</code>é€€å‡ºï¼›</li></ol><p><strong>æ‰§è¡ŒçŠ¶æ€ï¼š</strong></p><p>ä½¿ç”¨ad-hocæ‰§è¡Œä¸€æ¬¡è¿œç¨‹å‘½ä»¤ï¼Œæ³¨æ„è§‚å¯Ÿè¿”å›ç»“æœçš„é¢œè‰²ï¼š</p><ul><li>ç»¿è‰²ï¼šä»£è¡¨å—æ§èŠ‚ç‚¹æ²¡æœ‰è¢«ä¿®æ”¹</li><li>é»„è‰²ï¼šä»£è¡¨å—æ§èŠ‚ç‚¹å‘ç°å˜æ›´</li><li>çº¢è‰²ï¼šä»£è¡¨å‡ºç°äº†æ•…éšœï¼Œæ³¨æ„æŸ¥çœ‹æç¤º</li></ul><h3 id="å¸¸ç”¨æ¨¡å—"><a href="#å¸¸ç”¨æ¨¡å—" class="headerlink" title="å¸¸ç”¨æ¨¡å—"></a>å¸¸ç”¨æ¨¡å—</h3><h4 id="commandæ¨¡å—"><a href="#commandæ¨¡å—" class="headerlink" title="commandæ¨¡å—"></a>commandæ¨¡å—</h4><p><strong>åŸºæœ¬æ ¼å¼å’Œå¸¸ç”¨å‚æ•°</strong></p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">ansible &#x27;ç»„/IP&#x27; -m command -a &#x27;[å‚æ•°] å‘½ä»¤&#x27;</span><br></pre></td></tr></table></figure><div class="table-container"><table><thead><tr><th style="text-align:left">å‚æ•°</th><th style="text-align:left">é€‰é¡¹</th><th style="text-align:left">å«ä¹‰</th></tr></thead><tbody><tr><td style="text-align:left">chdir</td><td style="text-align:left">chdir /opt</td><td style="text-align:left">æ‰§è¡Œansibleæ—¶ï¼Œåˆ‡æ¢åˆ°æŒ‡å®šç›®å½•</td></tr><tr><td style="text-align:left">creates</td><td style="text-align:left">creates /data/file</td><td style="text-align:left">å¦‚æœæ–‡ä»¶å­˜åœ¨ï¼Œåˆ™è·³è¿‡æ‰§è¡Œ</td></tr><tr><td style="text-align:left">removes</td><td style="text-align:left">removes /data/file</td><td style="text-align:left">å¦‚æœæ–‡ä»¶å­˜åœ¨ï¼Œåˆ™æ‰§è¡Œ</td></tr></tbody></table></div><blockquote><p>[root@121 ~]# ansible webservers -m command -a â€˜ls /rootâ€™</p><p>192.168.1.122 | CHANGED | rc=0 &gt;&gt;<br>anaconda-ks.cfg<br>test.txt<br>192.168.1.121 | CHANGED | rc=0 &gt;&gt;<br>anaconda-ks.cfg<br>test</p><p>[root@121 ~]# ansible webservers -m <strong>command</strong> -a â€˜<strong>creates</strong>=/root/test.txt hostnameâ€™<br>192.168.1.122 | SUCCESS | rc=0 &gt;&gt;<br>skipped, since /root/test.txt exists<br>192.168.1.121 | CHANGED | rc=0 &gt;&gt;<br>121<br>[root@121 ~]# ansible webservers -m <strong>command</strong> -a â€˜<strong>removes</strong>=/root/test.txt hostnameâ€™<br>192.168.1.122 | CHANGED | rc=0 &gt;&gt;<br>122<br>192.168.1.121 | SUCCESS | rc=0 &gt;&gt;<br>skipped, since /root/test.txt does not exist<br>[root@121 ~]#</p></blockquote><p><mark>shellæ¨¡å—æ”¯æŒç®¡é“ç¬¦ï¼Œcommandæ¨¡å—ä¸æ”¯æŒ</mark></p><h4 id="shellæ¨¡å—"><a href="#shellæ¨¡å—" class="headerlink" title="shellæ¨¡å—"></a>shellæ¨¡å—</h4><p><strong>åŸºæœ¬æ ¼å¼å’Œå¸¸ç”¨å‚æ•°</strong></p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">ansible &#x27;ç»„/IP/all&#x27; -m shell -a &#x27;[å‚æ•°] å‘½ä»¤&#x27;</span><br></pre></td></tr></table></figure><blockquote><p>ansible webservers -m shell -a â€˜ps aux | grep sshdâ€™</p></blockquote><h4 id="yum-apt-æ¨¡å—"><a href="#yum-apt-æ¨¡å—" class="headerlink" title="yum/apt æ¨¡å—"></a>yum/apt æ¨¡å—</h4><div class="table-container"><table><thead><tr><th>å¸¸ç”¨å‚æ•°</th><th>åŠŸèƒ½</th></tr></thead><tbody><tr><td>name</td><td>éœ€è¦å®‰è£…çš„æœåŠ¡å</td></tr><tr><td>state=present(ç¼ºçœå€¼)/absent</td><td>çŠ¶æ€ï¼Œabasentè¡¨ç¤ºå¸è½½æœåŠ¡</td></tr></tbody></table></div><blockquote><h1 id="å®‰è£…æœåŠ¡"><a href="#å®‰è£…æœåŠ¡" class="headerlink" title="å®‰è£…æœåŠ¡"></a>å®‰è£…æœåŠ¡</h1><p>ansible webservers -m yum -a â€˜name=httpdâ€™</p><h1 id="å¸è½½æœåŠ¡"><a href="#å¸è½½æœåŠ¡" class="headerlink" title="å¸è½½æœåŠ¡"></a>å¸è½½æœåŠ¡</h1><p>ansible webservers -m yum -a â€˜name=httpd state=absentâ€™</p></blockquote><h4 id="copyæ¨¡å—"><a href="#copyæ¨¡å—" class="headerlink" title="copyæ¨¡å—"></a>copyæ¨¡å—</h4><p><strong>åŸºæœ¬æ ¼å¼å’Œå¸¸ç”¨å‚æ•°</strong></p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">ansible &lt; &gt; -m copy -a &#x27;src=   dest=   [owner= ] [mode=]   &#x27;</span><br></pre></td></tr></table></figure><div class="table-container"><table><thead><tr><th>å¸¸ç”¨å‚æ•°</th><th>åŠŸèƒ½</th><th>æ³¨æ„äº‹é¡¹</th></tr></thead><tbody><tr><td>src</td><td>æŒ‡å®šæºæ–‡ä»¶çš„è·¯å¾„ï¼ˆæ”¯æŒç›®å½•æˆ–æ–‡ä»¶ï¼‰</td><td>è‹¥æºä¸ºç›®å½•ï¼Œç›®æ ‡ä¹Ÿéœ€ä¸ºç›®å½•</td></tr><tr><td>dest</td><td>æŒ‡å®šç›®æ ‡æ–‡ä»¶çš„ä½ç½®ï¼ˆå¿…é¡»ä¸ºç»å¯¹è·¯å¾„ï¼‰</td><td>1. è‹¥æºä¸ºç›®å½•ï¼Œç›®æ ‡éœ€ä¸ºç›®å½•2. ç›®æ ‡æ–‡ä»¶å·²å­˜åœ¨æ—¶ä¼šè¦†ç›–åŸå†…å®¹</td></tr><tr><td>mode</td><td>è®¾ç½®ç›®æ ‡æ–‡ä»¶çš„æƒé™</td><td></td></tr><tr><td>owner</td><td>è®¾ç½®ç›®æ ‡æ–‡ä»¶çš„å±ä¸»</td><td></td></tr><tr><td>group</td><td>è®¾ç½®ç›®æ ‡æ–‡ä»¶çš„å±ç»„</td><td></td></tr><tr><td>content</td><td>ç›´æ¥æŒ‡å®šç›®æ ‡æ–‡ä»¶çš„å†…å®¹</td><td>ä¸å¯ä¸ <code>src</code> å‚æ•°åŒæ—¶ä½¿ç”¨</td></tr></tbody></table></div><blockquote><p>ansible dbservers -m copy -a â€˜src=/etc/fstab dest=/opt/fstab.bak owner=root mode=640â€™<br>ansible dbservers -a â€˜ls -l /optâ€™<br>ansible dbservers -a â€˜cat /opt/fstab.bakâ€™</p></blockquote><h4 id="systemd-æ¨¡å—"><a href="#systemd-æ¨¡å—" class="headerlink" title="systemd æ¨¡å—"></a>systemd æ¨¡å—</h4><div class="table-container"><table><thead><tr><th>å¸¸ç”¨å‚æ•°</th><th>åŠŸèƒ½</th></tr></thead><tbody><tr><td>name</td><td>æŒ‡å®šéœ€è¦æ§åˆ¶çš„æœåŠ¡åç§°</td></tr><tr><td>state</td><td>æŒ‡å®šæœåŠ¡çŠ¶æ€ï¼Œå¯é€‰å€¼ï¼š<code>stopped</code>ã€<code>started</code>ã€<code>reloaded</code>ã€<code>restarted</code>ã€<code>status</code></td></tr><tr><td>enabled</td><td>è®¾ç½®æœåŠ¡æ˜¯å¦å¼€æœºå¯åŠ¨ï¼Œ<code>yes</code> ä¸ºå¯åŠ¨ï¼Œ<code>no</code> ä¸ºä¸å¯åŠ¨</td></tr><tr><td>daemon_reload</td><td>è®¾ä¸º <code>yes</code> æ—¶é‡å¯ systemd æœåŠ¡ï¼Œä½¿ unit æ–‡ä»¶ç”Ÿæ•ˆ</td></tr></tbody></table></div><blockquote><p>ansible webservers -m systemd -a â€˜name=firewalld state=started enabled=yesâ€™</p></blockquote><h4 id="fileæ¨¡å—"><a href="#fileæ¨¡å—" class="headerlink" title="fileæ¨¡å—"></a>fileæ¨¡å—</h4><p><strong>åŸºæœ¬æ ¼å¼å’Œå¸¸ç”¨å‚æ•°</strong></p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">ansible &lt; &gt; -m file -a &#x27;&#x27;</span><br></pre></td></tr></table></figure><div class="table-container"><table><thead><tr><th style="text-align:left">å¸¸ç”¨å‚æ•°</th><th>åŠŸèƒ½</th><th>å¤‡æ³¨</th></tr></thead><tbody><tr><td style="text-align:left">path</td><td>æŒ‡å®šè¿œç¨‹æœåŠ¡å™¨çš„è·¯å¾„</td><td>ä¹Ÿå¯å†™æˆ <code>dest</code> æˆ– <code>name</code></td></tr><tr><td style="text-align:left">state</td><td>å®šä¹‰æ“ä½œç±»å‹ï¼š- <code>directory</code>ï¼šåˆ›å»ºç›®å½•- <code>touch</code>ï¼šåˆ›å»ºæ–‡ä»¶- <code>link</code>ï¼šåˆ›å»ºè½¯é“¾æ¥- <code>hard</code>ï¼šåˆ›å»ºç¡¬é“¾æ¥- <code>absent</code>ï¼šåˆ é™¤ç›®å½•/æ–‡ä»¶/é“¾æ¥</td><td></td></tr><tr><td style="text-align:left">mode</td><td>è®¾ç½®æ–‡ä»¶/ç›®å½•æƒé™</td><td>é»˜è®¤å€¼ï¼š- æ–‡ä»¶ <code>644</code>- ç›®å½• <code>755</code></td></tr><tr><td style="text-align:left">owner</td><td>è®¾ç½®å±ä¸»</td><td>é»˜è®¤ <code>root</code></td></tr><tr><td style="text-align:left">group</td><td>è®¾ç½®å±ç»„</td><td>é»˜è®¤ <code>root</code></td></tr><tr><td style="text-align:left">recurse</td><td>é€’å½’ä¿®æ”¹</td><td>yesæˆ–no</td></tr><tr><td style="text-align:left">src</td><td>ç›®æ ‡ä¸»æœºä¸Šçš„æºæ–‡ä»¶ï¼ˆä¸ <code>copy</code> æ¨¡å—ä¸åŒï¼‰</td></tr></tbody></table></div><blockquote><h1 id="åˆ›å»º-dataç›®å½•ï¼Œæˆæƒtestå±ç»„"><a href="#åˆ›å»º-dataç›®å½•ï¼Œæˆæƒtestå±ç»„" class="headerlink" title="åˆ›å»º/dataç›®å½•ï¼Œæˆæƒtestå±ç»„"></a>åˆ›å»º/dataç›®å½•ï¼Œæˆæƒtestå±ç»„</h1><p>ansible webservers -m file -a â€˜owner=test group=test mode=644 path=/data state=directory recurse=yes â€˜</p></blockquote><h4 id="groupæ¨¡å—"><a href="#groupæ¨¡å—" class="headerlink" title="groupæ¨¡å—"></a>groupæ¨¡å—</h4><p><strong>åŸºæœ¬æ ¼å¼å’Œå¸¸ç”¨å‚æ•°</strong></p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">ansible &lt;ç»„/IP/all&gt; -m group -a &#x27; &#x27;</span><br></pre></td></tr></table></figure><div class="table-container"><table><thead><tr><th><strong>å‚æ•°</strong></th><th><strong>åŠŸèƒ½</strong></th><th><strong>å¯é€‰å€¼/è¯´æ˜</strong></th></tr></thead><tbody><tr><td>name</td><td>æŒ‡å®šç”¨æˆ·åï¼ˆå¿…é€‰å‚æ•°ï¼‰</td><td></td></tr><tr><td>state</td><td>æ§åˆ¶è´¦å·çš„åˆ›å»ºæˆ–åˆ é™¤</td><td><code>present</code>ï¼šåˆ›å»ºè´¦å·<code>absent</code>ï¼šåˆ é™¤è´¦å·</td></tr><tr><td>system</td><td>æŒ‡å®šæ˜¯å¦ä¸ºç³»ç»Ÿè´¦å·</td><td><code>yes</code>ï¼šç³»ç»Ÿè´¦å·<code>no</code>ï¼šæ™®é€šè´¦å·</td></tr><tr><td>gid</td><td>æŒ‡å®šç»„IDï¼ˆä¿®æ”¹ç”¨æˆ·æ‰€å±ç»„ï¼‰</td><td>æ•°å€¼æ ¼å¼ï¼ˆå¦‚ <code>1001</code>ï¼‰</td></tr></tbody></table></div><blockquote><p>ansible webservers -m group -a â€˜name=www gid=666 state=present â€˜</p></blockquote><h4 id="useræ¨¡å—"><a href="#useræ¨¡å—" class="headerlink" title="useræ¨¡å—"></a>useræ¨¡å—</h4><p><strong>åŸºæœ¬æ ¼å¼å’Œå¸¸ç”¨å‚æ•°</strong></p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">ansible &lt;ç»„/IP/all&gt; -m user -a &#x27; &#x27;</span><br></pre></td></tr></table></figure><div class="table-container"><table><thead><tr><th><strong>å‚æ•°</strong></th><th><strong>åŠŸèƒ½</strong></th><th><strong>å¯é€‰å€¼/è¯´æ˜</strong></th></tr></thead><tbody><tr><td><code>name</code></td><td>æŒ‡å®šç”¨æˆ·åï¼ˆå¿…é€‰ï¼‰</td><td></td></tr><tr><td><code>state</code></td><td>æ§åˆ¶è´¦å·çš„åˆ›å»ºæˆ–åˆ é™¤</td><td><code>present</code>ï¼šåˆ›å»º<code>absent</code>ï¼šåˆ é™¤</td></tr><tr><td><code>system</code></td><td>æŒ‡å®šæ˜¯å¦ä¸ºç³»ç»Ÿè´¦å·</td><td><code>yes</code>ï¼šç³»ç»Ÿè´¦å·ï¼ˆå¦‚ <code>mysql</code>ï¼‰<code>no</code>ï¼šæ™®é€šè´¦å·</td></tr><tr><td><code>uid</code></td><td>æŒ‡å®šç”¨æˆ·UID</td><td>æ•°å€¼ï¼ˆå¦‚ <code>1001</code>ï¼‰ï¼Œéœ€å”¯ä¸€</td></tr><tr><td><code>group</code></td><td>æŒ‡å®šç”¨æˆ·åŸºæœ¬ç»„</td><td>ç»„åæˆ–GIDï¼ˆéœ€æå‰å­˜åœ¨ï¼‰</td></tr><tr><td><code>groups</code></td><td>æŒ‡å®šç”¨æˆ·æ‰€å±é™„åŠ ç»„</td><td>ç»„ååˆ—è¡¨ï¼ˆå¦‚ <code>groups=wheel,admin</code>ï¼‰</td></tr><tr><td><code>shell</code></td><td>è®¾ç½®ç”¨æˆ·é»˜è®¤shell</td><td>è·¯å¾„ï¼ˆå¦‚ <code>/bin/bash</code>ï¼‰</td></tr><tr><td><code>create_home</code></td><td>æ˜¯å¦åˆ›å»ºå®¶ç›®å½•</td><td><code>yes</code>ï¼šè‡ªåŠ¨åˆ›å»º<code>no</code>ï¼šä¸åˆ›å»ºï¼ˆé»˜è®¤è¡Œä¸ºå¯èƒ½ä¾èµ–ç³»ç»Ÿï¼‰</td></tr><tr><td><code>password</code></td><td>è®¾ç½®ç”¨æˆ·å¯†ç </td><td><strong>å»ºè®®ä½¿ç”¨åŠ å¯†åçš„å­—ç¬¦ä¸²</strong>ï¼ˆå¦‚ <code>password=&quot;$6$åŠ å¯†å­—ç¬¦ä¸²&quot;</code>ï¼‰</td></tr><tr><td><code>remove</code></td><td>åˆ é™¤ç”¨æˆ·æ—¶æ˜¯å¦åŒæ—¶åˆ é™¤å®¶ç›®å½•ï¼ˆéœ€<code>state=absent</code>ï¼‰</td><td><code>yes</code>ï¼šåˆ é™¤å®¶ç›®å½•<code>no</code>ï¼šä¿ç•™</td></tr></tbody></table></div><p>1ã€ åˆ›å»ºwwwç”¨æˆ·ï¼ŒæŒ‡å®šuid666,åŸºæœ¬ç»„www</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">ansible webservers -m user -a &#x27;name=www uid=666 group=www shell=/sbin/nologin create home=no&#x27;</span><br></pre></td></tr></table></figure><p>2ã€ åˆ›å»ºdbç”¨æˆ·ï¼ŒåŸºæœ¬ç»„æ˜¯root,é™„åŠ ç»„ï¼Œadm,sys</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">ansible webservers -m user -a &#x27;name=db group=root groups=adm,sys append=yes shell=/bin/bash create_home=yes&#x27;</span><br></pre></td></tr></table></figure><p>3ã€ åˆ›å»ºä¸€ä¸ªdddç”¨æˆ·ï¼Œå¯†ç 123ï¼Œéœ€è¦æ­£å¸¸ç™»å½•ç³»ç»Ÿ</p><p>ï¼ˆ1ï¼‰å¯†ç åŠ å¯†</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">ansible localhost -m debug -a &quot;msg=&#123;&#123; &#x27;123&#x27; | password_hash(&#x27;sha512&#x27;, &#x27;salt123&#x27;) &#125;&#125;&quot;</span><br></pre></td></tr></table></figure><div class="table-container"><table><thead><tr><th>å‚æ•°</th><th>ä½œç”¨</th><th>æ³¨æ„äº‹é¡¹</th></tr></thead><tbody><tr><td><code>sha512</code></td><td>æŒ‡å®šå“ˆå¸Œç®—æ³•ï¼ˆæ¨èï¼‰</td><td>æ”¯æŒ <code>sha256</code>/<code>md5</code> ç­‰ï¼Œä½† <code>sha512</code> æ›´å®‰å…¨ 2</td></tr><tr><td><code>salt123</code></td><td>è‡ªå®šä¹‰ç›å€¼</td><td>ç›å€¼éœ€ä¸ºå­—æ¯/æ•°å­—ï¼Œå« <code>-</code> æˆ– <code>_</code> ä¼šå¯¼è‡´å“ˆå¸Œå¤±è´¥ï¼ˆè¿”å› <code>*0</code>ï¼‰ 5</td></tr><tr><td><code>password_hash</code> è¿‡æ»¤å™¨</td><td>å°†æ˜æ–‡å¯†ç è½¬ä¸ºåŠ å¯†å­—ç¬¦ä¸²</td><td>éœ€é€šè¿‡ <code>&#123;&#123; &#125;&#125;</code> è°ƒç”¨ä¸”ä¸å˜é‡ç”¨ `</td></tr></tbody></table></div><blockquote><p>localhost | SUCCESS =&gt; {<br>â€œmsgâ€: â€œ<strong>$6$salt123$c806NQq6Oqk29MjZdmHxTw7sK3BB1K498o7sZC47UiwQmjx5NJyi5ZhWWGngXf3UfyELHQ1wRJ//oW/Y94azv0</strong>â€œ<br>}</p></blockquote><p>ï¼ˆ2ï¼‰æ’°å†™åˆ›å»ºå‘½ä»¤ï¼Œå®Œæˆåˆ›å»º</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">ansible webservers -m user -a &quot;name=ddd password=ç¬¬ä¸€æ­¥è·å–çš„åŠ å¯†å¯†ç  shell=/bin/bash create_home=yes&quot;</span><br></pre></td></tr></table></figure><p>4ã€ åˆ›å»ºä¸€ä¸ªdevç”¨æˆ·ï¼Œå¹¶ä¸ºå…¶ç”Ÿæˆå¯¹åº”çš„ç§˜é’¥</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">ansible webservers -m user -a &#x27;name=dev generate_ssh_key=yes ssh_key_bits=2048 ssh_key_file=.ssh/id_rsa&#x27;</span><br></pre></td></tr></table></figure><h4 id="mount-æ¨¡å—"><a href="#mount-æ¨¡å—" class="headerlink" title="mount æ¨¡å—"></a>mount æ¨¡å—</h4><div class="table-container"><table><thead><tr><th>å¸¸ç”¨å‚æ•°</th><th>åŠŸèƒ½</th></tr></thead><tbody><tr><td>src</td><td>æŒ‡å®šè¦æŒ‚è½½çš„è®¾å¤‡æˆ–åˆ†åŒºè·¯å¾„ã€‚</td></tr><tr><td>path</td><td>æŒ‡å®šè¦æŒ‚è½½åˆ°çš„ç›®æ ‡è·¯å¾„ã€‚</td></tr><tr><td>fstype</td><td>æŒ‡å®šè¦æŒ‚è½½çš„æ–‡ä»¶ç³»ç»Ÿç±»å‹ã€‚</td></tr><tr><td>state</td><td>æŒ‡å®šæŒ‚è½½çŠ¶æ€ï¼Œå¯é€‰å€¼ä¸º <code>mounted</code>ã€ï¼ˆä¸´æ—¶æŒ‚è½½ï¼‰<code>present</code>ï¼ˆæ°¸ä¹…æŒ‚è½½ï¼‰ã€<code>unmounted</code> ï¼ˆä¸´æ—¶å¸è½½ï¼‰æˆ– <code>absent</code>ï¼ˆå¸è½½ï¼‰ã€‚</td></tr><tr><td>opts</td><td>æŒ‡å®šæŒ‚è½½é€‰é¡¹ï¼Œä¾‹å¦‚æŒ‚è½½é€‰é¡¹æˆ–å‚æ•°ã€‚</td></tr></tbody></table></div><blockquote><h1 id="å°†192-168-1-121ä¸Šçš„-nfsç›®å½•æŒ‚è½½åˆ°192-168-1-122çš„-nfsç›®å½•"><a href="#å°†192-168-1-121ä¸Šçš„-nfsç›®å½•æŒ‚è½½åˆ°192-168-1-122çš„-nfsç›®å½•" class="headerlink" title="å°†192.168.1.121ä¸Šçš„/nfsç›®å½•æŒ‚è½½åˆ°192.168.1.122çš„/nfsç›®å½•"></a>å°†192.168.1.121ä¸Šçš„/nfsç›®å½•æŒ‚è½½åˆ°192.168.1.122çš„/nfsç›®å½•</h1><p>ansible 192.168.1.122 -m mount -a â€˜src=192.168.1.121:/nfs path=/nfs fstype=nfs opts=defaults state=present â€˜</p></blockquote><h4 id="cronæ¨¡å—"><a href="#cronæ¨¡å—" class="headerlink" title="cronæ¨¡å—"></a>cronæ¨¡å—</h4><p><strong>åŸºæœ¬æ ¼å¼å’Œå¸¸ç”¨å‚æ•°</strong></p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">ansible &lt;ç»„/IP/all&gt; -m cron -a &#x27; &#x27;</span><br></pre></td></tr></table></figure><div class="table-container"><table><thead><tr><th>å¸¸ç”¨å‚æ•°</th><th>åŠŸèƒ½</th></tr></thead><tbody><tr><td>minute/hour/day/month/weekday</td><td>åˆ†/æ—¶/æ—¥/æœˆ/å‘¨</td></tr><tr><td>job</td><td>ä»»åŠ¡è®¡åˆ’è¦æ‰§è¡Œçš„å‘½ä»¤</td></tr><tr><td>name</td><td>ä»»åŠ¡è®¡åˆ’çš„åç§°</td></tr><tr><td>user</td><td>æŒ‡å®šè®¡åˆ’ä»»åŠ¡å±äºå“ªä¸ªç”¨æˆ·ï¼Œé»˜è®¤æ˜¯rootç”¨æˆ·</td></tr><tr><td>state</td><td>presentè¡¨ç¤ºæ·»åŠ ï¼ˆå¯ä»¥çœç•¥ï¼‰ï¼Œabsentè¡¨ç¤ºç§»é™¤ã€‚</td></tr></tbody></table></div><blockquote><h1 id="æ·»åŠ ä¸€ä¸ªæ¯å¤©19ç‚¹æ‰§è¡Œ-data-test-shè„šæœ¬çš„å®šæ—¶ä»»åŠ¡ï¼Œä»»åŠ¡åä¸ºscript-testã€‚"><a href="#æ·»åŠ ä¸€ä¸ªæ¯å¤©19ç‚¹æ‰§è¡Œ-data-test-shè„šæœ¬çš„å®šæ—¶ä»»åŠ¡ï¼Œä»»åŠ¡åä¸ºscript-testã€‚" class="headerlink" title="æ·»åŠ ä¸€ä¸ªæ¯å¤©19ç‚¹æ‰§è¡Œ/data/test.shè„šæœ¬çš„å®šæ—¶ä»»åŠ¡ï¼Œä»»åŠ¡åä¸ºscript-testã€‚"></a>æ·»åŠ ä¸€ä¸ªæ¯å¤©19ç‚¹æ‰§è¡Œ/data/test.shè„šæœ¬çš„å®šæ—¶ä»»åŠ¡ï¼Œä»»åŠ¡åä¸ºscript-testã€‚</h1><p>ansible webservers -m cron -a â€˜name=â€script-testâ€ hour=19 minute=00 job=â€/bin/bash /data/test.shâ€ â€˜</p><h1 id="æ³¨é‡Šè¯¥å®šæ—¶ä»»åŠ¡"><a href="#æ³¨é‡Šè¯¥å®šæ—¶ä»»åŠ¡" class="headerlink" title="æ³¨é‡Šè¯¥å®šæ—¶ä»»åŠ¡"></a>æ³¨é‡Šè¯¥å®šæ—¶ä»»åŠ¡</h1><p>ansible webservers -m cron -a â€˜name=â€script-testâ€ hour=19 minute=00 job=â€/bin/bash /data/test.shâ€ disabled=yes â€˜</p><h1 id="åˆ é™¤è¯¥å®šæ—¶ä»»åŠ¡"><a href="#åˆ é™¤è¯¥å®šæ—¶ä»»åŠ¡" class="headerlink" title="åˆ é™¤è¯¥å®šæ—¶ä»»åŠ¡"></a>åˆ é™¤è¯¥å®šæ—¶ä»»åŠ¡</h1><p>ansible webservers -m cron -a â€˜name=â€script-testâ€ hour=19 minute=00 job=â€/bin/bash /data/test.shâ€ state=absent â€˜</p></blockquote><h4 id="archive-æ¨¡å—"><a href="#archive-æ¨¡å—" class="headerlink" title="archive æ¨¡å—"></a>archive æ¨¡å—</h4><div class="table-container"><table><thead><tr><th>å¸¸ç”¨å‚æ•°</th><th>åŠŸèƒ½</th></tr></thead><tbody><tr><td>path</td><td>æŒ‡å®šè¦æ‰“åŒ…çš„æºç›®å½•æˆ–æ–‡ä»¶çš„è·¯å¾„ã€‚</td></tr><tr><td>dest</td><td>æŒ‡å®šæ‰“åŒ…æ–‡ä»¶çš„è¾“å‡ºè·¯å¾„ã€‚</td></tr><tr><td>format</td><td>æŒ‡å®šæ‰“åŒ…æ–‡ä»¶çš„æ ¼å¼ï¼Œå¯ä»¥æ˜¯ zipã€tarã€gz æˆ– bzip2ã€‚é»˜è®¤ä¸º tar æ ¼å¼ã€‚</td></tr><tr><td>remove</td><td>æŒ‡å®šæ˜¯å¦åœ¨æ‰“åŒ…æ–‡ä»¶ä¹‹åï¼Œåˆ é™¤æºç›®å½•æˆ–æ–‡ä»¶ã€‚å¯é€‰å€¼ä¸º yes æˆ– noã€‚é»˜è®¤ä¸º noï¼Œå³ä¸åˆ é™¤æºç›®å½•æˆ–æ–‡ä»¶ã€‚</td></tr></tbody></table></div><h4 id="unarchive-æ¨¡å—"><a href="#unarchive-æ¨¡å—" class="headerlink" title="unarchive æ¨¡å—"></a>unarchive æ¨¡å—</h4><div class="table-container"><table><thead><tr><th>å¸¸ç”¨å‚æ•°</th><th>åŠŸèƒ½</th></tr></thead><tbody><tr><td><strong>copy</strong></td><td>æŒ‡å®šæ˜¯å¦å°†æ‰“åŒ…æ–‡ä»¶å¤åˆ¶åˆ°è¿œç¨‹èŠ‚ç‚¹ä»¥è¿›è¡Œè§£å‹ç¼©ã€‚</td></tr><tr><td><strong>remote_src</strong></td><td>(å·²å¼ƒç”¨) æ”¹ç”¨ <code>copy</code> å‚æ•°ã€‚</td></tr><tr><td><strong>src</strong></td><td>æŒ‡å®šè¦è§£å‹ç¼©çš„æ‰“åŒ…æ–‡ä»¶è·¯å¾„ï¼Œå¯ä»¥æ˜¯æœ¬åœ°è·¯å¾„æˆ–è¿œç¨‹è·¯å¾„ã€‚</td></tr><tr><td><strong>dest</strong></td><td>æŒ‡å®šè¦å°†æ–‡ä»¶è§£å‹ç¼©åˆ°çš„ç›®æ ‡ç›®å½•ã€‚</td></tr><tr><td><strong>creates</strong></td><td>æŒ‡å®šä¸€ä¸ªæ–‡ä»¶è·¯å¾„ï¼Œå¦‚æœè¯¥æ–‡ä»¶å·²ç»å­˜åœ¨ï¼Œåˆ™ä¸è¿›è¡Œè§£å‹ç¼©æ“ä½œã€‚</td></tr><tr><td><strong>remote_tmp</strong></td><td>ç”¨äºæŒ‡å®šè¿œç¨‹èŠ‚ç‚¹ä¸Šçš„ä¸´æ—¶ç›®å½•ã€‚é»˜è®¤ä¸º <code>/tmp</code>ã€‚</td></tr></tbody></table></div><blockquote><p>1ã€ å°†æ§åˆ¶ç«¯çš„å‹ç¼©åŒ…ï¼Œè§£å‹åˆ°è¢«æ§ç«¯ï¼š</p><p>ansible webservers -m unarchive -a â€˜src=./test.tar.gz dest=/mntâ€™<br>2ã€ å°†è¢«æ§ç«¯çš„å‹ç¼©åŒ…è§£å‹åˆ°è¢«æ§ç«¯ï¼š</p><p>ansible webservers -m unarchive -a â€˜src=/tmp/config_vpn_new.zip dest=/mnt remote_src=yesâ€™</p></blockquote><h4 id="lineinfileæ¨¡å—"><a href="#lineinfileæ¨¡å—" class="headerlink" title="lineinfileæ¨¡å—"></a>lineinfileæ¨¡å—</h4><p>å«ä¹‰ï¼šæ›¿æ¢|è¿½åŠ |åˆ é™¤</p><div class="table-container"><table><thead><tr><th>å‚æ•°</th><th>é€‰é¡¹</th><th>å«ä¹‰</th></tr></thead><tbody><tr><td>path</td><td>æ— </td><td>æŒ‡å®šè¦æ“ä½œçš„ç›®æ ‡æ–‡ä»¶è·¯å¾„</td></tr><tr><td>regexp</td><td>æ— </td><td>ä½¿ç”¨æ­£åˆ™è¡¨è¾¾å¼åŒ¹é…æ–‡ä»¶ä¸­çš„è¡Œ</td></tr><tr><td>line</td><td>æ— </td><td>æŒ‡å®šè¦ä¿®æ”¹æˆ–æ’å…¥çš„æ–°æ–‡æœ¬å†…å®¹</td></tr><tr><td>insertafter</td><td>æ— </td><td>å°†æ–‡æœ¬æ’å…¥åˆ°ã€Œæ­£åˆ™åŒ¹é…è¡Œã€ä¹‹å</td></tr><tr><td>insertbefore</td><td>æ— </td><td>å°†æ–‡æœ¬æ’å…¥åˆ°ã€Œæ­£åˆ™åŒ¹é…è¡Œã€ä¹‹å‰</td></tr><tr><td>state</td><td>absent / present (é»˜è®¤)</td><td><code>absent</code>åˆ é™¤åŒ¹é…è¡Œï¼Œ<code>present</code>ç¡®ä¿æ–‡æœ¬å­˜åœ¨</td></tr><tr><td>backrefs</td><td>yes / no</td><td><code>yes</code>å¯ç”¨æ­£åˆ™åå‘å¼•ç”¨ï¼Œ<code>no</code>æœªåŒ¹é…æ—¶ä¸æ“ä½œæ–‡ä»¶</td></tr><tr><td>backup</td><td>æ— </td><td>ä¿®æ”¹å‰æ˜¯å¦åˆ›å»ºå¤‡ä»½æ–‡ä»¶ï¼ˆå¸ƒå°”å€¼ï¼‰</td></tr><tr><td>create</td><td>æ— </td><td>å½“ç›®æ ‡æ–‡ä»¶ä¸å­˜åœ¨æ—¶æ˜¯å¦åˆ›å»ºæ–°æ–‡ä»¶ï¼ˆå¸ƒå°”å€¼ï¼‰</td></tr></tbody></table></div><blockquote><p>1ã€æ›¿æ¢httpd.confæ–‡ä»¶ä¸­ï¼ŒListenä¸ºListen8080;</p><p>ansible webservers -m lineinfile -a â€˜path=/etc/httpd/conf/httpd.conf regexp=â€^Listenâ€ line=â€Listen 8080â€â€˜</p><p>2ã€ ç»™ä¸»æœºå¢åŠ ä¸€ä¸ªç½‘å…³ï¼š</p><p>ansible webservers -m lineinfile -a â€˜path=/etc/sysconfig/network-scripts/ifcfg-eth1 line=â€GATEWAY=172.16.1.200â€â€˜<br>3ã€ åˆ é™¤ä¸»æœºçš„ç½‘å…³ï¼š</p><p>ansible webservers -m lineinfile -a â€˜path=/etc/sysconfig/network-scripts/ifcfg-ethl regexp=â€^GATEWAYâ€ state=absentâ€™</p></blockquote><h2 id="Ansible-Playbook"><a href="#Ansible-Playbook" class="headerlink" title="Ansible Playbook"></a>Ansible Playbook</h2><p>playbookæ˜¯ä¸€ä¸ªç”±ymlè¯­æ³•ç¼–å†™çš„æ–‡æœ¬æ–‡ä»¶ï¼Œå®ƒç”±<code>play</code>å’Œ<code>task</code>ä¸¤éƒ¨åˆ†ç»„æˆã€‚<br><code>play</code>ï¼šä¸»è¦å®šä¹‰è¦æ“ä½œä¸»æœºæˆ–è€…ä¸»æœºç»„ã€‚</p><p><code>task</code>ï¼šä¸»è¦å®šä¹‰å¯¹ä¸»æœºæˆ–ä¸»æœºç»„å…·ä½“æ‰§è¡Œçš„ä»»åŠ¡ï¼Œå¯ä»¥æ˜¯ä¸€ä¸ªä»»åŠ¡ï¼Œä¹Ÿå¯ä»¥æ˜¯å¤šä¸ªä»»åŠ¡(æ¨¡å—)ã€‚</p><p>playbookæ˜¯ç”±ä¸€ä¸ªæˆ–å¤šä¸ªplayç»„æˆï¼Œä¸€ä¸ªplayå¯ä»¥åŒ…å«å¤šä¸ªtaskä»»åŠ¡ã€‚</p><p>å¯ä»¥ç†è§£ä¸ºï¼šä½¿ç”¨å¤šä¸ªä¸åŒçš„æ¨¡å—æ¥å…±åŒå®Œæˆä¸€ä»¶äº‹æƒ…ã€‚</p><h3 id="Playbookä¹¦å†™æ ¼å¼"><a href="#Playbookä¹¦å†™æ ¼å¼" class="headerlink" title="Playbookä¹¦å†™æ ¼å¼"></a>Playbookä¹¦å†™æ ¼å¼</h3><p>playbookæ˜¯ç”±ymlè¯­æ³•ä¹¦å†™ï¼Œç»“æ„æ¸…æ™°ï¼Œå¯è¯»æ€§å¼ºã€‚</p><div class="table-container"><table><thead><tr><th>è¯­æ³•</th><th>æè¿°</th></tr></thead><tbody><tr><td>ç¼©è¿›</td><td><strong>YAML</strong> ä½¿ç”¨å›ºå®šçš„ç¼©è¿›é£æ ¼è¡¨ç¤ºå±‚çº§ç»“æ„ï¼Œæ¯ä¸ªç¼©è¿›ç”±<mark>ä¸¤ä¸ªç©ºæ ¼</mark>ç»„æˆï¼Œä¸èƒ½ä½¿ç”¨ <strong>tabs</strong></td></tr><tr><td>å†’å·</td><td>ä»¥å†’å·ç»“å°¾çš„é™¤å¤–ï¼Œå…¶ä»–æ‰€æœ‰å†’å·åé¢å¿…é¡»æœ‰ç©ºæ ¼</td></tr><tr><td>çŸ­æ¨ªçº¿</td><td>è¡¨ç¤ºåˆ—è¡¨é¡¹ï¼Œä½¿ç”¨ä¸€ä¸ªçŸ­æ¨ªæ åŠ ä¸€ä¸ªç©ºæ ¼ã€‚å¤šä¸ªé¡¹ä½¿ç”¨åŒæ ·çš„ç¼©è¿›çº§åˆ«ä½œä¸ºåŒä¸€åˆ—è¡¨</td></tr></tbody></table></div><h3 id="Playbookåº”ç”¨å®ä¾‹ï¼š"><a href="#Playbookåº”ç”¨å®ä¾‹ï¼š" class="headerlink" title="Playbookåº”ç”¨å®ä¾‹ï¼š"></a>Playbookåº”ç”¨å®ä¾‹ï¼š</h3><h4 id="å®‰è£…nignx"><a href="#å®‰è£…nignx" class="headerlink" title="å®‰è£…nignx"></a>å®‰è£…nignx</h4><p>ï¼ˆ1ï¼‰æ’°å†™playbookæ–‡ä»¶</p><figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="string">vi</span> <span class="string">nginx.yml</span></span><br><span class="line"></span><br><span class="line"><span class="bullet">-</span> <span class="attr">hosts:</span> <span class="string">webservers</span></span><br><span class="line">  <span class="attr">tasks:</span></span><br><span class="line">    <span class="bullet">-</span> <span class="attr">name:</span> <span class="string">å®‰è£…nignx</span></span><br><span class="line">      <span class="attr">yum:</span></span><br><span class="line">        <span class="attr">name:</span> <span class="string">nginx</span></span><br><span class="line">        <span class="attr">state:</span> <span class="string">present</span></span><br><span class="line">    <span class="bullet">-</span> <span class="attr">name:</span> <span class="string">å¯åŠ¨nignx</span></span><br><span class="line">      <span class="attr">systemd:</span></span><br><span class="line">        <span class="attr">name:</span> <span class="string">nginx</span></span><br><span class="line">        <span class="attr">state:</span> <span class="string">started</span></span><br><span class="line">        <span class="attr">enabled:</span> <span class="literal">yes</span></span><br></pre></td></tr></table></figure><p>ï¼ˆ2ï¼‰æ£€æŸ¥æ–‡ä»¶æ˜¯å¦æœ‰è¯­æ³•é”™è¯¯</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">ansible-playbook --syntax nginx.yml</span><br><span class="line">æˆ–</span><br><span class="line">ansible-playbook --syntax-check nginx.yml</span><br></pre></td></tr></table></figure><blockquote><p>[root@121 data]# ansible-playbook â€”syntax nginx.yml</p><p>playbook: nginx.yml</p></blockquote><p>ï¼ˆ3ï¼‰è¿›è¡Œæ¨¡æ‹Ÿæ‰§è¡Œ</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">ansible-playbook -C nginx.yml</span><br></pre></td></tr></table></figure><blockquote><p>[root@121 data]# ansible-playbook -C nginx.yml</p><p>PLAY [webservers] <strong><strong><strong><strong><strong><strong><strong><strong><strong><strong><strong><strong><strong><strong><strong>**</strong></strong></strong></strong></strong></strong></strong></strong></strong></strong></strong></strong></strong></strong></strong></p><p>TASK [Gathering Facts] <strong><strong><strong><strong><strong><strong><strong><strong><strong><strong><strong><strong><strong><strong>*</strong></strong></strong></strong></strong></strong></strong></strong></strong></strong></strong></strong></strong></strong><br>ok: [192.168.1.122]<br>ok: [192.168.1.121]</p><p>TASK [å®‰è£…nignx] <strong><strong><strong><strong><strong><strong><strong><strong><strong><strong><strong><strong><strong><strong><strong><strong>*</strong></strong></strong></strong></strong></strong></strong></strong></strong></strong></strong></strong></strong></strong></strong></strong><br>changed: [192.168.1.122]<br>changed: [192.168.1.121]</p><p>TASK [å¯åŠ¨nignx] <strong><strong><strong><strong><strong><strong><strong><strong><strong><strong><strong><strong><strong><strong><strong><strong>*</strong></strong></strong></strong></strong></strong></strong></strong></strong></strong></strong></strong></strong></strong></strong></strong><br>changed: [192.168.1.121]<br>changed: [192.168.1.122]</p><p>PLAY RECAP <strong><strong><strong><strong><strong><strong><strong><strong><strong><strong><strong><strong><strong><strong><strong><strong><strong>*</strong></strong></strong></strong></strong></strong></strong></strong></strong></strong></strong></strong></strong></strong></strong></strong></strong><br>192.168.1.121 : ok=3 changed=2 unreachable=0 failed=0 skipped=0 rescued=0 ignored=0<br>192.168.1.122 : ok=3 changed=2 unreachable=0 failed=0 skipped=0 rescued=0 ignored=0</p></blockquote><p>ï¼ˆ4ï¼‰å®é™…æ‰§è¡Œ</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">ansible-playbook nginx.yml</span><br></pre></td></tr></table></figure><blockquote><p>[root@121 data]# ansible-playbook nginx.yml</p><p>PLAY [webservers] <strong><strong><strong><strong><strong><strong><strong><strong><strong><strong><strong><strong><strong><strong><strong>**</strong></strong></strong></strong></strong></strong></strong></strong></strong></strong></strong></strong></strong></strong></strong></p><p>TASK [Gathering Facts] <strong><strong><strong><strong><strong><strong><strong><strong><strong><strong><strong><strong><strong><strong>*</strong></strong></strong></strong></strong></strong></strong></strong></strong></strong></strong></strong></strong></strong><br>ok: [192.168.1.122]<br>ok: [192.168.1.121]</p><p>TASK [å®‰è£…nignx] <strong><strong><strong><strong><strong><strong><strong><strong><strong><strong><strong><strong><strong><strong><strong><em>*</em></strong></strong></strong></strong></strong></strong></strong></strong></strong></strong></strong></strong></strong></strong></strong> **<br>changed: [192.168.1.121]<br>changed: [192.168.1.122]</p><p>TASK [å¯åŠ¨nignx] <strong><strong><strong><strong><strong><strong><strong><strong><strong><strong><strong><strong><strong><strong><strong><strong>*</strong></strong></strong></strong></strong></strong></strong></strong></strong></strong></strong></strong></strong></strong></strong></strong><br>changed: [192.168.1.122]<br>changed: [192.168.1.121]</p><p>PLAY RECAP <strong><strong><strong><strong><strong><strong><strong><strong><strong><strong><strong><strong><strong><strong><strong><strong><strong>*</strong></strong></strong></strong></strong></strong></strong></strong></strong></strong></strong></strong></strong></strong></strong></strong></strong><br>192.168.1.121 : ok=3 changed=2 unreachable=0 failed=0 skipped=0 rescued=0 ignored=0<br>192.168.1.122 : ok=3 changed=2 unreachable=0 failed=0 skipped=0 rescued=0 ignored=0</p></blockquote><h4 id="å®‰è£…NFSæœåŠ¡"><a href="#å®‰è£…NFSæœåŠ¡" class="headerlink" title="å®‰è£…NFSæœåŠ¡"></a>å®‰è£…NFSæœåŠ¡</h4><p>ä»»åŠ¡é¡ºåºï¼š</p><ul><li>ä¸‹è½½nfsç¨‹åº</li><li>æŒ‚è½½nfsé…ç½®æ–‡ä»¶ï¼ˆè®¾ç½®è§¦å‘å™¨ï¼Œä¿®æ”¹é…ç½®æ–‡ä»¶åï¼Œä½¿é…ç½®é‡å¯ç”Ÿæ•ˆï¼‰</li><li>åˆå§‹åŒ–è®¾ç½®nfsï¼ˆè®¾ç½®ç”¨æˆ·ã€ç»„ã€æˆæƒï¼‰</li><li>å¯åŠ¨nfs</li></ul><blockquote><p>è®¾ç½®çš„è§¦å‘å™¨æ˜¯handlesï¼Œåœ¨ç¬¬äºŒæ­¥ä¸­æ·»åŠ notifyä¿¡æ¯ï¼Œå½“é…ç½®æ–‡ä»¶ä¿®æ”¹æ—¶ï¼Œhandlesè·å–notifyä¸­çš„ä¿¡æ¯ï¼Œé‡å¯nfsæœåŠ¡ï¼Œä½¿å¾—é…ç½®é‡æ–°ç”Ÿæ•ˆ</p></blockquote><p>æ–‡ä»¶å‡†å¤‡ï¼š</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta prompt_">#</span><span class="language-bash">åˆ›å»ºç›®å½•å­˜æ”¾è¯¥é¡¹ç›®</span></span><br><span class="line">mkdir nfs</span><br><span class="line"><span class="meta prompt_">#</span><span class="language-bash">åˆ›å»ºnfsé…ç½®æ–‡ä»¶ï¼Œå°†ä»¥ä¸‹å†…å®¹å†™å…¥</span></span><br><span class="line">vi exports.j2</span><br><span class="line"></span><br><span class="line">/ansible_test 192.168.1.0/24(rw,all_squash,anonuid=7777,anongid=7777)</span><br><span class="line"></span><br></pre></td></tr></table></figure><blockquote><p>å°†ansibleçš„é…ç½®æ–‡ä»¶<code>ansible.cfg</code>å’Œ<code>hosts</code>ï¼Œæå‰æ”¾ç½®åœ¨è¯¥é¡¹ç›®ç›®å½•ä¸‹</p></blockquote><p>åˆ›å»ºnfså‰§æœ¬</p><figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br></pre></td><td class="code"><pre><span class="line"><span class="string">vi</span> <span class="string">nfs.yml</span></span><br><span class="line"></span><br><span class="line"><span class="bullet">-</span> <span class="attr">hosts:</span> <span class="string">webservers</span></span><br><span class="line">  <span class="attr">tasks:</span></span><br><span class="line">    <span class="bullet">-</span> <span class="attr">name:</span> <span class="string">download</span> <span class="string">nfs</span></span><br><span class="line">      <span class="attr">yum:</span></span><br><span class="line">        <span class="attr">name:</span> <span class="string">nfs-utils</span></span><br><span class="line">        <span class="attr">state:</span> <span class="string">present</span></span><br><span class="line">    <span class="bullet">-</span> <span class="attr">name:</span> <span class="string">configure</span> <span class="string">nfs</span></span><br><span class="line">      <span class="attr">copy:</span></span><br><span class="line">        <span class="attr">src:</span> <span class="string">./exports.j2</span></span><br><span class="line">        <span class="attr">dest:</span> <span class="string">/etc/exports</span></span><br><span class="line">      <span class="attr">notify:</span> <span class="string">restart</span> <span class="string">nfs</span>  <span class="comment">#è§¦å‘ä¿¡æ¯</span></span><br><span class="line">    <span class="bullet">-</span> <span class="attr">name:</span> <span class="string">init</span> <span class="string">group</span></span><br><span class="line">      <span class="attr">group:</span></span><br><span class="line">        <span class="attr">name:</span> <span class="string">bbb</span></span><br><span class="line">        <span class="attr">gid:</span> <span class="number">7777</span></span><br><span class="line">    <span class="bullet">-</span> <span class="attr">name:</span> <span class="string">init</span> <span class="string">user</span></span><br><span class="line">      <span class="attr">user:</span></span><br><span class="line">        <span class="attr">name:</span> <span class="string">bbb</span></span><br><span class="line">        <span class="attr">uid:</span> <span class="number">7777</span></span><br><span class="line">        <span class="attr">group:</span> <span class="string">bbb</span></span><br><span class="line">        <span class="attr">shell:</span> <span class="string">/sbin/nologin</span></span><br><span class="line">        <span class="attr">create_home:</span> <span class="literal">no</span></span><br><span class="line">    <span class="bullet">-</span> <span class="attr">name:</span> <span class="string">init</span> <span class="string">directory</span></span><br><span class="line">      <span class="attr">file:</span></span><br><span class="line">        <span class="attr">path:</span> <span class="string">/ansible_test</span></span><br><span class="line">        <span class="attr">state:</span> <span class="string">directory</span></span><br><span class="line">        <span class="attr">owner:</span> <span class="string">bbb</span></span><br><span class="line">        <span class="attr">group:</span> <span class="string">bbb</span></span><br><span class="line">        <span class="attr">mode:</span> <span class="string">&quot;0755&quot;</span></span><br><span class="line">    <span class="bullet">-</span> <span class="attr">name:</span> <span class="string">start</span> <span class="string">nfs</span></span><br><span class="line">      <span class="attr">systemd:</span></span><br><span class="line">        <span class="attr">name:</span> <span class="string">nfs</span></span><br><span class="line">        <span class="attr">state:</span> <span class="string">started</span></span><br><span class="line">        <span class="attr">enabled:</span> <span class="literal">yes</span></span><br><span class="line">  <span class="attr">handlers:</span>  <span class="comment">#è§¦å‘å™¨</span></span><br><span class="line">    <span class="bullet">-</span> <span class="attr">name:</span> <span class="string">restart</span> <span class="string">nfs</span></span><br><span class="line">      <span class="attr">systemd:</span></span><br><span class="line">        <span class="attr">name:</span> <span class="string">nfs</span></span><br><span class="line">        <span class="attr">state:</span> <span class="string">restarted</span></span><br><span class="line"></span><br></pre></td></tr></table></figure><p>æ‰§è¡Œå¹¶éªŒè¯</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">ansible-playbook --syntax-check nfs.yml</span><br><span class="line">ansible-playbook -C nfs.yml</span><br><span class="line">ansible-playbook nfs.yml</span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_">#</span><span class="language-bash">æŸ¥çœ‹nfsæœåŠ¡</span></span><br><span class="line">showmount -e 192.168.1.121</span><br><span class="line">showmount -e 192.168.1.122</span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_">#</span><span class="language-bash">æŒ‚è½½æµ‹è¯•</span></span><br><span class="line">mount -t nfs 192.168.1.121:/ansible_test /data/test</span><br><span class="line">mount -t nfs 192.168.1.122:/ansible_test /data/test1</span><br></pre></td></tr></table></figure><blockquote><p>[root@121 ~]# df -h<br>æ–‡ä»¶ç³»ç»Ÿ å®¹é‡ å·²ç”¨ å¯ç”¨ å·²ç”¨% æŒ‚è½½ç‚¹<br>devtmpfs 898M 0 898M 0% /dev<br>tmpfs 910M 0 910M 0% /dev/shm<br>tmpfs 910M 9.7M 901M 2% /run<br>tmpfs 910M 0 910M 0% /sys/fs/cgroup<br>/dev/mapper/centos-root 17G 1.7G 16G 10% /<br>/dev/sda1 1014M 153M 862M 16% /boot<br>tmpfs 182M 0 182M 0% /run/user/0<br>192.168.1.121:/ansible_test 17G 1.7G 16G 10% /data/test<br>192.168.1.122:/ansible_test 17G 2.2G 15G 13% /data/test1</p></blockquote><h4 id="å®‰è£…rsyncæœåŠ¡"><a href="#å®‰è£…rsyncæœåŠ¡" class="headerlink" title="å®‰è£…rsyncæœåŠ¡"></a>å®‰è£…rsyncæœåŠ¡</h4><h5 id="rsyncæœåŠ¡ç«¯ï¼š"><a href="#rsyncæœåŠ¡ç«¯ï¼š" class="headerlink" title="rsyncæœåŠ¡ç«¯ï¼š"></a>rsyncæœåŠ¡ç«¯ï¼š</h5><p>ä»»åŠ¡é¡ºåºï¼š</p><ul><li>ä¸‹è½½rsyncç¨‹åº</li><li>æŒ‚è½½rsyncé…ç½®æ–‡ä»¶ï¼ˆè®¾ç½®è§¦å‘å™¨ï¼Œä¿®æ”¹é…ç½®æ–‡ä»¶åï¼Œä½¿é…ç½®é‡å¯ç”Ÿæ•ˆï¼‰</li><li>åˆå§‹åŒ–è®¾ç½®rsyncï¼ˆè®¾ç½®ç”¨æˆ·ã€ç»„ã€æˆæƒï¼‰</li><li>åˆ›å»ºè™šæ‹Ÿç”¨æˆ·å’Œå¯†ç </li><li>å¯åŠ¨rsync</li></ul><blockquote><p>è®¾ç½®çš„è§¦å‘å™¨æ˜¯handlesï¼Œå½“é…ç½®æ–‡ä»¶æˆ–è™šæ‹Ÿç”¨æˆ·å¯†ç ä¿®æ”¹æ—¶ï¼Œhandlesè·å–notifyä¸­çš„ä¿¡æ¯ï¼Œé‡å¯rsyncæœåŠ¡ï¼Œä½¿å¾—é…ç½®é‡æ–°ç”Ÿæ•ˆ</p></blockquote><p>æ–‡ä»¶å‡†å¤‡ï¼š</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta prompt_">#</span><span class="language-bash">åˆ›å»ºç›®å½•å­˜æ”¾è¯¥é¡¹ç›®</span></span><br><span class="line">mkdir rsync</span><br><span class="line"><span class="meta prompt_">#</span><span class="language-bash">å¤åˆ¶rsyncé…ç½®æ–‡ä»¶rsyncd.confå¹¶ä¿®æ”¹ï¼ˆå¯å…ˆæ‰‹åŠ¨ä¸‹è½½rsyncï¼Œæ‹·è´é…ç½®æ–‡ä»¶åå†å¸è½½ï¼Œä¹Ÿå¯ç›´æ¥ä½¿ç”¨ä»¥ä¸‹å†…å®¹ï¼‰</span></span><br><span class="line"></span><br><span class="line">uid = ansible_www</span><br><span class="line">gid = ansible_www</span><br><span class="line">port = 873</span><br><span class="line">fake super = yes</span><br><span class="line">use chroot = yes</span><br><span class="line">max connections = 4</span><br><span class="line">timeout = 900</span><br><span class="line">read only = false</span><br><span class="line">list = false</span><br><span class="line">auth users = rsync_backup</span><br><span class="line">secrets file = /etc/rsync.passwd</span><br><span class="line">log file = /var/log/rsyncd.log</span><br><span class="line">[backup]</span><br><span class="line">path = /backup</span><br></pre></td></tr></table></figure><blockquote><p>å°†ansibleçš„é…ç½®æ–‡ä»¶<code>ansible.cfg</code>å’Œ<code>hosts</code>ï¼Œæå‰æ”¾ç½®åœ¨è¯¥é¡¹ç›®ç›®å½•ä¸‹</p></blockquote><p>åˆ›å»ºrsyncå‰§æœ¬</p><figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br></pre></td><td class="code"><pre><span class="line"><span class="string">vi</span> <span class="string">rsync.yml</span></span><br><span class="line"></span><br><span class="line"><span class="bullet">-</span> <span class="attr">hosts:</span> <span class="string">webservers</span></span><br><span class="line">  <span class="attr">tasks:</span></span><br><span class="line">    <span class="bullet">-</span> <span class="attr">name:</span> <span class="string">download</span> <span class="string">rsync</span></span><br><span class="line">      <span class="attr">yum:</span></span><br><span class="line">        <span class="attr">name:</span> <span class="string">rsync</span></span><br><span class="line">        <span class="attr">state:</span> <span class="string">present</span></span><br><span class="line">    <span class="bullet">-</span> <span class="attr">name:</span> <span class="string">configure</span> <span class="string">rsync</span></span><br><span class="line">      <span class="attr">copy:</span></span><br><span class="line">        <span class="attr">src:</span> <span class="string">./rsyncd.conf</span></span><br><span class="line">        <span class="attr">dest:</span> <span class="string">/etc/rsyncd.conf</span></span><br><span class="line">        <span class="attr">owner:</span> <span class="string">root</span></span><br><span class="line">        <span class="attr">group:</span> <span class="string">root</span></span><br><span class="line">        <span class="attr">mode:</span> <span class="string">&quot;0644&quot;</span></span><br><span class="line">      <span class="attr">notify:</span> <span class="string">restart</span> <span class="string">rsync</span></span><br><span class="line">    <span class="bullet">-</span> <span class="attr">name:</span> <span class="string">init</span> <span class="string">group</span></span><br><span class="line">      <span class="attr">group:</span></span><br><span class="line">        <span class="attr">name:</span> <span class="string">ansible_www</span></span><br><span class="line">        <span class="attr">gid:</span> <span class="number">8888</span></span><br><span class="line">    <span class="bullet">-</span> <span class="attr">name:</span> <span class="string">init</span> <span class="string">user</span></span><br><span class="line">      <span class="attr">user:</span></span><br><span class="line">        <span class="attr">name:</span> <span class="string">ansible_www</span></span><br><span class="line">        <span class="attr">uid:</span> <span class="number">8888</span></span><br><span class="line">        <span class="attr">group:</span> <span class="string">ansible_www</span></span><br><span class="line">        <span class="attr">shell:</span> <span class="string">/sbin/nologin</span></span><br><span class="line">        <span class="attr">create_home:</span> <span class="literal">no</span></span><br><span class="line">    <span class="bullet">-</span> <span class="attr">name:</span> <span class="string">init</span> <span class="string">directory</span></span><br><span class="line">      <span class="attr">file:</span></span><br><span class="line">        <span class="attr">path:</span> <span class="string">/backup</span></span><br><span class="line">        <span class="attr">state:</span> <span class="string">directory</span></span><br><span class="line">        <span class="attr">owner:</span> <span class="string">ansible_www</span></span><br><span class="line">        <span class="attr">group:</span> <span class="string">ansible_www</span></span><br><span class="line">        <span class="attr">mode:</span> <span class="string">&quot;0755&quot;</span></span><br><span class="line">        <span class="attr">recurse:</span> <span class="literal">yes</span></span><br><span class="line">    <span class="bullet">-</span> <span class="attr">name:</span> <span class="string">init</span> <span class="string">rsync</span> <span class="string">user</span> <span class="string">passwd</span></span><br><span class="line">      <span class="attr">copy:</span></span><br><span class="line">        <span class="attr">content:</span> <span class="string">&quot;rsync_backup:123456&quot;</span></span><br><span class="line">        <span class="attr">dest:</span> <span class="string">/etc/rsync.passwd</span></span><br><span class="line">        <span class="attr">owner:</span> <span class="string">root</span></span><br><span class="line">        <span class="attr">group:</span> <span class="string">root</span></span><br><span class="line">        <span class="attr">mode:</span> <span class="number">0600</span></span><br><span class="line">      <span class="attr">notify:</span> <span class="string">restart</span> <span class="string">rsync</span></span><br><span class="line">    <span class="bullet">-</span> <span class="attr">name:</span> <span class="string">start</span> <span class="string">rsync</span></span><br><span class="line">      <span class="attr">systemd:</span></span><br><span class="line">        <span class="attr">name:</span> <span class="string">rsyncd</span></span><br><span class="line">        <span class="attr">state:</span> <span class="string">started</span></span><br><span class="line">        <span class="attr">enabled:</span> <span class="literal">yes</span></span><br><span class="line">  <span class="attr">handlers:</span></span><br><span class="line">    <span class="bullet">-</span> <span class="attr">name:</span> <span class="string">restart</span> <span class="string">rsync</span></span><br><span class="line">      <span class="attr">systemd:</span></span><br><span class="line">        <span class="attr">name:</span> <span class="string">rsyncd</span></span><br><span class="line">        <span class="attr">state:</span> <span class="string">restarted</span></span><br></pre></td></tr></table></figure><p>æ‰§è¡Œå¹¶éªŒè¯</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">ansible-playbook --syntax-check rsync.yml </span><br><span class="line">ansible-playbook -C rsync.yml </span><br><span class="line">ansible-playbook rsync.yml  </span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_">#</span><span class="language-bash">éªŒè¯</span></span><br><span class="line">rsync -avz host_group rsync_backup@192.168.1.122::backup</span><br></pre></td></tr></table></figure><h5 id="rsyncå®¢æˆ·ç«¯ï¼š"><a href="#rsyncå®¢æˆ·ç«¯ï¼š" class="headerlink" title="rsyncå®¢æˆ·ç«¯ï¼š"></a>rsyncå®¢æˆ·ç«¯ï¼š</h5><p>ä»»åŠ¡é¡ºåºï¼š</p><ul><li>å°†è„šæœ¬æ¨é€è‡³è¢«æ§ç«¯æŒ‡å®šè·¯å¾„ä¸‹</li><li>é…ç½®å®šæ—¶ä»»åŠ¡</li></ul><p>åˆ›å»ºrsync-clientå‰§æœ¬</p><figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line"><span class="string">vi</span> <span class="string">rsync-client.yml</span></span><br><span class="line"></span><br><span class="line"><span class="bullet">-</span> <span class="attr">hosts:</span> <span class="string">localhost</span></span><br><span class="line">  <span class="attr">tasks:</span></span><br><span class="line">    <span class="bullet">-</span> <span class="attr">name:</span> <span class="string">create</span> <span class="string">scripts</span> <span class="string">path</span></span><br><span class="line">      <span class="attr">file:</span></span><br><span class="line">        <span class="attr">path:</span> <span class="string">/scripts</span></span><br><span class="line">        <span class="attr">owner:</span> <span class="string">root</span></span><br><span class="line">        <span class="attr">group:</span> <span class="string">root</span></span><br><span class="line">        <span class="attr">state:</span> <span class="string">directory</span></span><br><span class="line">        <span class="attr">mode:</span> <span class="number">0755</span></span><br><span class="line">    <span class="bullet">-</span> <span class="attr">name:</span> <span class="string">push</span> <span class="string">scripts</span></span><br><span class="line">      <span class="attr">copy:</span></span><br><span class="line">        <span class="attr">src:</span> <span class="string">test.sh</span></span><br><span class="line">        <span class="attr">dest:</span> <span class="string">/scripts/test.sh</span></span><br><span class="line">        <span class="attr">owner:</span> <span class="string">root</span></span><br><span class="line">        <span class="attr">group:</span> <span class="string">root</span></span><br><span class="line">        <span class="attr">mode:</span> <span class="number">0755</span></span><br><span class="line">    <span class="bullet">-</span> <span class="attr">name:</span> <span class="string">contable</span> <span class="string">job</span></span><br><span class="line">      <span class="attr">cron:</span></span><br><span class="line">        <span class="attr">name:</span> <span class="string">&quot;push backup data&quot;</span></span><br><span class="line">        <span class="attr">minute:</span> <span class="string">&quot;*/1&quot;</span></span><br><span class="line">        <span class="attr">job:</span> <span class="string">&quot;/bin/bash /scripts/test.sh &amp;&gt;/dev/null&quot;</span></span><br><span class="line"></span><br></pre></td></tr></table></figure><p>åˆ›å»ºtest.shä»¥ä¾›æµ‹è¯•</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta prompt_">#</span><span class="language-bash">!/bin/bash</span></span><br><span class="line">RSYNC_PASSWORD=&quot;123456&quot;  rsync -avz /backup/ rsync_backup@192.168.1.122::backup</span><br></pre></td></tr></table></figure><p>æŸ¥çœ‹æ˜¯å¦æœ‰å®šæ—¶ä»»åŠ¡</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">crontab -l</span><br></pre></td></tr></table></figure><blockquote><h1 id="Ansible-push-backup-data"><a href="#Ansible-push-backup-data" class="headerlink" title="Ansible: push backup data"></a>Ansible: push backup data</h1><p><em>/1</em><em></em> * /bin/bash /scripts/test.sh &amp;&gt;/dev/null</p></blockquote><h4 id="ä½¿ç”¨Ansibleéƒ¨ç½²å¤šèŠ‚ç‚¹phpmyadmin"><a href="#ä½¿ç”¨Ansibleéƒ¨ç½²å¤šèŠ‚ç‚¹phpmyadmin" class="headerlink" title="ä½¿ç”¨Ansibleéƒ¨ç½²å¤šèŠ‚ç‚¹phpmyadmin"></a>ä½¿ç”¨Ansibleéƒ¨ç½²å¤šèŠ‚ç‚¹phpmyadmin</h4><h5 id="é¡¹ç›®éœ€æ±‚"><a href="#é¡¹ç›®éœ€æ±‚" class="headerlink" title="é¡¹ç›®éœ€æ±‚"></a>é¡¹ç›®éœ€æ±‚</h5><ul><li>ä½¿ç”¨LNMPéƒ¨ç½²phpmyadmin</li><li>nginxï¼ˆHaproxyï¼‰ä½œä¸ºè´Ÿè½½å‡è¡¡</li><li>Rediså®ç°ä¼šè¯ä¿æŒ</li></ul><h5 id="ä¸»æœºè§„åˆ’"><a href="#ä¸»æœºè§„åˆ’" class="headerlink" title="ä¸»æœºè§„åˆ’"></a>ä¸»æœºè§„åˆ’</h5><div class="table-container"><table><thead><tr><th>ä¸»æœºå</th><th>ip</th><th>ç”¨é€”</th></tr></thead><tbody><tr><td>121</td><td>192.168.1.121</td><td>Ansibleæ§åˆ¶èŠ‚ç‚¹ã€nignx+PHP</td></tr><tr><td>122</td><td>192.168.1.122</td><td>Ansibleå—æ§èŠ‚ç‚¹ã€nignx+PHP</td></tr><tr><td>123</td><td>192.168.1.123</td><td>Ansibleå—æ§èŠ‚ç‚¹ã€nignxï¼ˆHaproxyï¼‰</td></tr><tr><td>124</td><td>192.168.1.124</td><td>Ansibleå—æ§èŠ‚ç‚¹ã€nignxï¼ˆHaproxyï¼‰</td></tr><tr><td>125</td><td>192.168.1.125</td><td>Ansibleå—æ§èŠ‚ç‚¹ã€Redis</td></tr></tbody></table></div><h5 id="éƒ¨ç½²æ­¥éª¤"><a href="#éƒ¨ç½²æ­¥éª¤" class="headerlink" title="éƒ¨ç½²æ­¥éª¤"></a>éƒ¨ç½²æ­¥éª¤</h5><h6 id="ç¯å¢ƒå‡†å¤‡"><a href="#ç¯å¢ƒå‡†å¤‡" class="headerlink" title="ç¯å¢ƒå‡†å¤‡"></a>ç¯å¢ƒå‡†å¤‡</h6><blockquote><p>121èŠ‚ç‚¹ä¸Šè¦å‡†å¤‡å¥½Ansibleï¼Œå¹¶è®¾ç½®ä»¥ä¸Š5å°æœºå™¨å…å¯†ç™»å½•ï¼Œå…·ä½“å‚ç…§ä¸Šæ–¹çš„é…ç½®è¿‡ç¨‹ã€‚</p></blockquote><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta prompt_">#</span><span class="language-bash">åˆ›å»ºå­˜æ”¾é¡¹ç›®æ–‡ä»¶ç›®å½•</span></span><br><span class="line">mkdir /data/phpmyadmin</span><br><span class="line"><span class="meta prompt_">#</span><span class="language-bash">å°†ansibleçš„é…ç½®æ–‡ä»¶`ansible.cfg`å’Œ`hosts`ï¼Œå¤åˆ¶åˆ°è¯¥phpmyadminç›®å½•ä¸‹ï¼Œå¹¶ä¿®æ”¹é…ç½®</span></span><br><span class="line">cp /etc/ansible/ansible.cfg /data/phpmyadmin/ansible.cfg</span><br><span class="line"><span class="meta prompt_">#</span><span class="language-bash">ä¿®æ”¹é…ç½®æ–‡ä»¶ä¸­çš„è·¯å¾„ï¼Œå¹¶å–æ¶ˆæ³¨é‡Š</span></span><br><span class="line">inventory      = /data/phpmyadmin/host_group</span><br><span class="line"></span><br><span class="line">cp /etc/ansible/hosts /data/phpmyadmin/host_group</span><br><span class="line"><span class="meta prompt_">#</span><span class="language-bash">ä¿®æ”¹ä¸»æœºç»„</span></span><br><span class="line">[webservers]</span><br><span class="line">192.168.1.121</span><br><span class="line">192.168.1.122</span><br><span class="line"></span><br><span class="line">[dbservers]</span><br><span class="line">192.168.1.125</span><br><span class="line"></span><br><span class="line">[lbservers]</span><br><span class="line">192.168.1.123</span><br><span class="line">192.168.1.124</span><br></pre></td></tr></table></figure><p>ç¡®è®¤é…ç½®æ–‡ä»¶çš„è¯»å–è·¯å¾„æ˜¯å¦ä¸ºå½“å‰é¡¹ç›®ä¸‹çš„<code>/data/phpmyadmin/ansible.cfg</code></p><blockquote><p>[root@121 phpmyadmin]# ansible â€”version<br>ansible 2.9.27<br>config file = <strong>/data/phpmyadmin/ansible.cfg</strong><br>configured module search path = [uâ€™/root/.ansible/plugins/modulesâ€™, uâ€™/usr/share/ansible/plugins/modulesâ€™]<br>ansible python module location = /usr/lib/python2.7/site-packages/ansible<br>executable location = /usr/bin/ansible<br>python version = 2.7.5 (default, Jun 28 2022, 15:30:04) [GCC 4.8.5 20150623 (Red Hat 4.8.5-44)]</p></blockquote><p>éªŒè¯ä¸»æœºæ˜¯å¦éƒ½å¯pingé€š</p><blockquote><p>[root@121 phpmyadmin]# ansible all -m ping<br>192.168.1.122 | SUCCESS =&gt; {<br>â€œansible_factsâ€: {<br>â€œdiscovered_interpreter_pythonâ€: â€œ/usr/bin/pythonâ€<br>},<br>â€œchangedâ€: false,<br>â€œpingâ€: â€œpongâ€<br>}<br>192.168.1.124 | SUCCESS =&gt; {<br>â€œansible_factsâ€: {<br>â€œdiscovered_interpreter_pythonâ€: â€œ/usr/bin/pythonâ€<br>},<br>â€œchangedâ€: false,<br>â€œpingâ€: â€œpongâ€<br>}<br>192.168.1.123 | SUCCESS =&gt; {<br>â€œansible_factsâ€: {<br>â€œdiscovered_interpreter_pythonâ€: â€œ/usr/bin/pythonâ€<br>},<br>â€œchangedâ€: false,<br>â€œpingâ€: â€œpongâ€<br>}<br>192.168.1.125 | SUCCESS =&gt; {<br>â€œansible_factsâ€: {<br>â€œdiscovered_interpreter_pythonâ€: â€œ/usr/bin/pythonâ€<br>},<br>â€œchangedâ€: false,<br>â€œpingâ€: â€œpongâ€<br>}<br>192.168.1.121 | SUCCESS =&gt; {<br>â€œansible_factsâ€: {<br>â€œdiscovered_interpreter_pythonâ€: â€œ/usr/bin/pythonâ€<br>},<br>â€œchangedâ€: false,<br>â€œpingâ€: â€œpongâ€<br>}</p></blockquote><h6 id="å®‰è£…Redis"><a href="#å®‰è£…Redis" class="headerlink" title="å®‰è£…Redis"></a>å®‰è£…Redis</h6><p>ä»»åŠ¡é¡ºåºï¼š</p><ul><li>ä¸‹è½½redisç¨‹åº</li><li>æŒ‚è½½redisé…ç½®æ–‡ä»¶ï¼ˆè®¾ç½®è§¦å‘å™¨ï¼Œä¿®æ”¹é…ç½®æ–‡ä»¶åï¼Œä½¿é…ç½®é‡å¯ç”Ÿæ•ˆï¼‰</li><li>å¯åŠ¨redis</li></ul><blockquote><p>è®¾ç½®è§¦å‘å™¨handlesï¼Œé‡å¯redisæœåŠ¡</p></blockquote><p>ï¼ˆ1ï¼‰å°†redisçš„é…ç½®æ–‡ä»¶<code>redis.conf</code>ï¼Œæ‹·è´è‡³<code>/data/phpmyadmin/files</code>ç›®å½•ä¸‹</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">mkdir /data/phpmyadmin/files</span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">è‹¥æ— redis.confæ–‡ä»¶å¯å…ˆåœ¨æ§åˆ¶èŠ‚ç‚¹ä¸Šä½¿ç”¨å‘½ä»¤yum -y install redisä¸‹è½½åå†æ‹·è´</span></span><br><span class="line">cp /etc/redis.conf /data/phpmyadmin/files</span><br><span class="line"><span class="meta prompt_">#</span><span class="language-bash">ä¿®æ”¹é…ç½®æ–‡ä»¶,å°†è¦å®‰è£…redisçš„ä¸»æœºipåŠ å…¥</span></span><br><span class="line">bind 127.0.0.1 192.168.1.125</span><br></pre></td></tr></table></figure><p>ï¼ˆ2ï¼‰</p><figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><span class="line"><span class="string">vi</span> <span class="string">redis.yml</span></span><br><span class="line"></span><br><span class="line"><span class="bullet">-</span> <span class="attr">hosts:</span> <span class="string">dbservers</span></span><br><span class="line">  <span class="attr">tasks:</span></span><br><span class="line">    <span class="bullet">-</span> <span class="attr">name:</span> <span class="string">download</span> <span class="string">redis</span></span><br><span class="line">      <span class="attr">yum:</span></span><br><span class="line">        <span class="attr">name:</span> <span class="string">redis</span></span><br><span class="line">        <span class="attr">state:</span> <span class="string">present</span></span><br><span class="line">    <span class="bullet">-</span> <span class="attr">name:</span> <span class="string">configure</span> <span class="string">redis</span></span><br><span class="line">      <span class="attr">copy:</span></span><br><span class="line">        <span class="attr">src:</span> <span class="string">./files/redis.conf</span></span><br><span class="line">        <span class="attr">dest:</span> <span class="string">/etc/redis.conf</span></span><br><span class="line">        <span class="attr">owner:</span> <span class="string">redis</span></span><br><span class="line">        <span class="attr">group:</span> <span class="string">root</span></span><br><span class="line">        <span class="attr">mode:</span> <span class="number">0640</span></span><br><span class="line">      <span class="attr">notify:</span> <span class="string">restart</span> <span class="string">redis</span></span><br><span class="line">    <span class="bullet">-</span> <span class="attr">name:</span> <span class="string">start</span> <span class="string">redis</span></span><br><span class="line">      <span class="attr">systemd:</span></span><br><span class="line">        <span class="attr">name:</span> <span class="string">redis</span></span><br><span class="line">        <span class="attr">state:</span> <span class="string">started</span></span><br><span class="line">        <span class="attr">enabled:</span> <span class="literal">yes</span></span><br><span class="line">  <span class="attr">handlers:</span></span><br><span class="line">    <span class="bullet">-</span> <span class="attr">name:</span> <span class="string">restart</span> <span class="string">redis</span></span><br><span class="line">      <span class="attr">systemd:</span></span><br><span class="line">        <span class="attr">name:</span> <span class="string">redis</span></span><br><span class="line">        <span class="attr">state:</span> <span class="string">restarted</span></span><br><span class="line"></span><br></pre></td></tr></table></figure><p>ï¼ˆ3ï¼‰å®‰è£…å¹¶æµ‹è¯•</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">ansible-playbook --syntax-check redis.yml</span><br><span class="line">ansible-playbook -C redis.yml</span><br><span class="line">ansible-playbook redis.yml</span><br><span class="line"><span class="meta prompt_">#</span><span class="language-bash">æµ‹è¯•ï¼Œä¹‹å‰æ§åˆ¶èŠ‚ç‚¹121å®‰è£…äº†redisï¼Œå¯ç›´æ¥åœ¨121ä¸Šæµ‹è¯•</span></span><br><span class="line"><span class="meta prompt_">#</span><span class="language-bash">æ³¨æ„é˜²ç«å¢™ç«¯å£</span></span><br><span class="line">redis-cli -h 192.168.1.125</span><br></pre></td></tr></table></figure><blockquote><p>[root@121 phpmyadmin]# redis-cli -h 192.168.1.125<br>192.168.1.125:6379&gt;</p></blockquote><h6 id="å®‰è£…Mariadb"><a href="#å®‰è£…Mariadb" class="headerlink" title="å®‰è£…Mariadb"></a>å®‰è£…Mariadb</h6><p>åœ¨192.168.1.125ä¸Šå®‰è£…Mariadb</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">yum -y install mariadb-server</span><br><span class="line">systemctl start mariadb</span><br><span class="line">systemctl enable mariadb</span><br><span class="line"><span class="meta prompt_">#</span><span class="language-bash">è®¾ç½®rootç”¨æˆ·å¯†ç </span></span><br><span class="line">mysqladmin -uroot password &#x27;123456&#x27;</span><br><span class="line"><span class="meta prompt_">#</span><span class="language-bash">ç™»å½•åˆ›å»ºç”¨æˆ·</span></span><br><span class="line">mysql -uroot -p123456</span><br><span class="line"><span class="meta prompt_">#</span><span class="language-bash">åˆ›å»ºæ•°æ®åº“</span></span><br><span class="line">create database php_db;</span><br><span class="line"><span class="meta prompt_">#</span><span class="language-bash">åˆ›å»ºæ•°æ®åº“ç”¨æˆ·</span></span><br><span class="line">grant all on php_db.* to php_user@&#x27;%&#x27; identified by &#x27;123456&#x27;;</span><br></pre></td></tr></table></figure><h6 id="å®‰è£…nginxã€PHP"><a href="#å®‰è£…nginxã€PHP" class="headerlink" title="å®‰è£…nginxã€PHP"></a>å®‰è£…nginxã€PHP</h6><p>ä»»åŠ¡é¡ºåºï¼š</p><ul><li>ä¸‹è½½nginxã€PHPç¨‹åº</li><li>æŒ‚è½½nginxã€PHPé…ç½®æ–‡ä»¶ï¼ˆè®¾ç½®è§¦å‘å™¨ï¼Œä¿®æ”¹é…ç½®æ–‡ä»¶åï¼Œä½¿é…ç½®é‡å¯ç”Ÿæ•ˆï¼‰</li><li>åˆå§‹åŒ–è®¾ç½®nginxï¼ˆè®¾ç½®ç”¨æˆ·ã€ç»„ã€æˆæƒï¼‰</li><li>å¯åŠ¨nginxã€PHP</li></ul><blockquote><p>è®¾ç½®è§¦å‘å™¨handlesï¼Œé‡å¯nginxã€PHPæœåŠ¡</p></blockquote><p>ï¼ˆ1ï¼‰è®¾ç½®php7ä¸‹è½½æºï¼Œåœ¨121ï¼Œ122ä¸Šæ‰§è¡Œ</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">rpm -Uvh https://mirror.webtatic.com/yum/el7/epel-release.rpm</span><br><span class="line">rpm -Uvh https://mirror.webtatic.com/yum/el7/webtatic-release.rpm</span><br></pre></td></tr></table></figure><p>ï¼ˆ2ï¼‰å°†nginxã€phpçš„é…ç½®æ–‡ä»¶ï¼Œæ‹·è´è‡³<code>/data/phpmyadmin/files</code>ç›®å½•ä¸‹ï¼Œå¹¶ä¿®æ”¹é…ç½®</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta prompt_">#</span><span class="language-bash">nginxé…ç½®æ–‡ä»¶</span></span><br><span class="line">cp /etc/nginx/nginx.conf /data/phpmyadmin/files</span><br><span class="line"><span class="meta prompt_">#</span><span class="language-bash">phpé…ç½®æ–‡ä»¶</span></span><br><span class="line">cp /etc/php.ini /data/phpmyadmin/files</span><br><span class="line">cp /etc/php-fpm.d/www.conf /data/phpmyadmin/files</span><br></pre></td></tr></table></figure><p>ä¿®æ”¹nginxé…ç½®æ–‡ä»¶ï¼Œå°†ç”¨æˆ·ä¿®æ”¹ä¸º<code>www</code>ã€‚</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">vi nginx.conf</span><br><span class="line">user www;</span><br></pre></td></tr></table></figure><p>åœ¨<code>/data/phpmyadmin/files</code>ç›®å½•ä¸‹ï¼Œæ–°å¢<code>phpmyadmin</code>çš„nginxä»£ç†æ–‡ä»¶</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre></td><td class="code"><pre><span class="line">vi phpmyadmin.conf</span><br><span class="line"></span><br><span class="line">server &#123;</span><br><span class="line">    listen 80;</span><br><span class="line">    server_name ansible.phpmyadmin.local;</span><br><span class="line"></span><br><span class="line">    # ç¡®ä¿æ­¤è·¯å¾„ä¸phpMyAdminå®é™…è·¯å¾„å®Œå…¨ä¸€è‡´</span><br><span class="line">    root /code/phpmyadmin;</span><br><span class="line">    index index.php;</span><br><span class="line"></span><br><span class="line">    location / &#123;</span><br><span class="line">        try_files $uri $uri/ /index.php$is_args$args;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    location ~ \.php$ &#123;</span><br><span class="line">        # ç»å¯¹è·¯å¾„å¿…é¡»å®Œæ•´æ­£ç¡®</span><br><span class="line">        fastcgi_param SCRIPT_FILENAME $document_root$fastcgi_script_name;</span><br><span class="line">        fastcgi_pass 127.0.0.1:9000;</span><br><span class="line">        fastcgi_index index.php;</span><br><span class="line">        include fastcgi_params;</span><br><span class="line"></span><br><span class="line">        # æ·»åŠ å…³é”®å‚æ•°</span><br><span class="line">        fastcgi_split_path_info ^(.+\.php)(/.+)$;</span><br><span class="line">        fastcgi_intercept_errors on;</span><br><span class="line">        fastcgi_param PATH_INFO $fastcgi_path_info;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure><p>ä¿®æ”¹phpé…ç½®æ–‡ä»¶<code>php.ini</code>ï¼Œè®¾ç½®redisè¿æ¥ã€‚</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">vi php.ini</span><br><span class="line">[Session]</span><br><span class="line"></span><br><span class="line">session.save_handler = redis</span><br><span class="line">session.save_path = &quot;tcp://192.168.1.125:6379?weight=1&amp;timeout=2.5&quot;</span><br></pre></td></tr></table></figure><p>ä¿®æ”¹phpé…ç½®æ–‡ä»¶<code>www.conf</code>ï¼Œè®¾ç½®ç”¨æˆ·å’Œç»„ï¼Œå¹¶æ³¨é‡Šéƒ¨åˆ†è®¾ç½®ã€‚</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">vi www.conf</span><br><span class="line"></span><br><span class="line">[www]</span><br><span class="line">user = www</span><br><span class="line">group = www</span><br><span class="line"></span><br><span class="line">;php_value[session.save_handler] = files</span><br><span class="line">;php_value[session.save_path]    = /var/lib/php/session</span><br><span class="line"></span><br></pre></td></tr></table></figure><p>ï¼ˆ3ï¼‰ä¸‹è½½phpmyadmin</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta prompt_">#</span><span class="language-bash">phpmyadminç¨‹åºä¸‹è½½åˆ°/data/phpmyadmin/filesç›®å½•ä¸‹</span></span><br><span class="line">curl -O https://files.phpmyadmin.net/phpMyAdmin/5.2.2/phpMyAdmin-5.2.2-all-languages.zip</span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_">#</span><span class="language-bash">è§£å‹ç¨‹åº</span></span><br><span class="line">unzip phpMyAdmin-5.2.2-all-languages.zip</span><br><span class="line"><span class="meta prompt_">#</span><span class="language-bash">å¤åˆ¶å¹¶ä¿®æ”¹é…ç½®æ–‡ä»¶ï¼Œè¿æ¥mariadbæ•°æ®åº“</span></span><br><span class="line">cp phpMyAdmin-5.2.2-all-languages/config.sample.inc.php config.inc.php</span><br><span class="line"><span class="meta prompt_">#</span><span class="language-bash">ä¿®æ”¹localhostä¸º192.168.1.125</span></span><br><span class="line"><span class="meta prompt_">$</span><span class="language-bash">cfg[<span class="string">&#x27;Servers&#x27;</span>][<span class="variable">$i</span>][<span class="string">&#x27;host&#x27;</span>] = <span class="string">&#x27;192.168.1.125&#x27;</span>;</span></span><br></pre></td></tr></table></figure><p>ï¼ˆ4ï¼‰åˆ›å»ºnignx-phpå‰§æœ¬</p><figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br></pre></td><td class="code"><pre><span class="line"><span class="string">vi</span> <span class="string">nginx-php.yml</span></span><br><span class="line"></span><br><span class="line"><span class="bullet">-</span> <span class="attr">hosts:</span> <span class="string">webservers</span></span><br><span class="line">  <span class="attr">tasks:</span></span><br><span class="line">    <span class="bullet">-</span> <span class="attr">name:</span> <span class="string">download</span> <span class="string">nginx</span></span><br><span class="line">      <span class="attr">yum:</span></span><br><span class="line">        <span class="attr">name:</span> <span class="string">nginx</span></span><br><span class="line">        <span class="attr">state:</span> <span class="string">present</span></span><br><span class="line">    <span class="bullet">-</span> <span class="attr">name:</span> <span class="string">download</span> <span class="string">php</span></span><br><span class="line">      <span class="attr">yum:</span></span><br><span class="line">        <span class="attr">name:</span> <span class="string">&quot;<span class="template-variable">&#123;&#123; packages &#125;&#125;</span>&quot;</span></span><br><span class="line">      <span class="attr">vars:</span></span><br><span class="line">        <span class="attr">packages:</span></span><br><span class="line">        <span class="bullet">-</span> <span class="string">php72w</span></span><br><span class="line">        <span class="bullet">-</span> <span class="string">php72w-cli</span></span><br><span class="line">        <span class="bullet">-</span> <span class="string">php72w-common</span></span><br><span class="line">        <span class="bullet">-</span> <span class="string">php72w-devel</span></span><br><span class="line">        <span class="bullet">-</span> <span class="string">php72w-embedded</span></span><br><span class="line">        <span class="bullet">-</span> <span class="string">php72w-fpm</span></span><br><span class="line">        <span class="bullet">-</span> <span class="string">php72w-gd</span></span><br><span class="line">        <span class="bullet">-</span> <span class="string">php72w-mbstring</span></span><br><span class="line">        <span class="bullet">-</span> <span class="string">php72w-mysqlnd</span></span><br><span class="line">        <span class="bullet">-</span> <span class="string">php72w-opcache</span></span><br><span class="line">        <span class="bullet">-</span> <span class="string">php72w-pdo</span></span><br><span class="line">        <span class="bullet">-</span> <span class="string">php72w-xml</span></span><br><span class="line">        <span class="bullet">-</span> <span class="string">php72w-ldap</span></span><br><span class="line">        <span class="bullet">-</span> <span class="string">php72w-pecl-redis</span></span><br><span class="line"></span><br><span class="line">    <span class="bullet">-</span> <span class="attr">name:</span> <span class="string">configure</span> <span class="string">nginx</span></span><br><span class="line">      <span class="attr">copy:</span></span><br><span class="line">        <span class="attr">src:</span> <span class="string">./files/nginx.conf</span></span><br><span class="line">        <span class="attr">dest:</span> <span class="string">/etc/nginx/nginx.conf</span></span><br><span class="line">        <span class="attr">owner:</span> <span class="string">root</span></span><br><span class="line">        <span class="attr">group:</span> <span class="string">root</span></span><br><span class="line">        <span class="attr">mode:</span> <span class="number">0644</span></span><br><span class="line">      <span class="attr">notify:</span> <span class="string">restart</span> <span class="string">nginx</span></span><br><span class="line">    <span class="bullet">-</span> <span class="attr">name:</span> <span class="string">init</span> <span class="string">group</span> <span class="string">www</span></span><br><span class="line">      <span class="attr">group:</span></span><br><span class="line">        <span class="attr">name:</span> <span class="string">www</span></span><br><span class="line">        <span class="attr">gid:</span> <span class="number">666</span></span><br><span class="line">    <span class="bullet">-</span> <span class="attr">name:</span> <span class="string">init</span> <span class="string">user</span> <span class="string">www</span></span><br><span class="line">      <span class="attr">user:</span></span><br><span class="line">        <span class="attr">name:</span> <span class="string">www</span></span><br><span class="line">        <span class="attr">uid:</span> <span class="number">666</span></span><br><span class="line">        <span class="attr">group:</span> <span class="string">www</span></span><br><span class="line">        <span class="attr">shell:</span> <span class="string">/sbin/nologin</span></span><br><span class="line">        <span class="attr">create_home:</span> <span class="literal">no</span></span><br><span class="line">    <span class="bullet">-</span> <span class="attr">name:</span> <span class="string">start</span> <span class="string">nginx</span></span><br><span class="line">      <span class="attr">systemd:</span></span><br><span class="line">        <span class="attr">name:</span> <span class="string">nginx</span></span><br><span class="line">        <span class="attr">state:</span> <span class="string">started</span>        </span><br><span class="line">        <span class="attr">enabled:</span> <span class="literal">yes</span></span><br><span class="line"></span><br><span class="line">    <span class="bullet">-</span> <span class="attr">name:</span> <span class="string">configure</span> <span class="string">php.ini</span></span><br><span class="line">      <span class="attr">copy:</span></span><br><span class="line">        <span class="attr">src:</span> <span class="string">./files/php.ini</span></span><br><span class="line">        <span class="attr">dest:</span> <span class="string">/etc/php.ini</span></span><br><span class="line">        <span class="attr">owner:</span> <span class="string">root</span></span><br><span class="line">        <span class="attr">group:</span> <span class="string">root</span></span><br><span class="line">        <span class="attr">mode:</span> <span class="number">0644</span></span><br><span class="line">      <span class="attr">notify:</span> <span class="string">restart</span> <span class="string">php</span>    </span><br><span class="line">    <span class="bullet">-</span> <span class="attr">name:</span> <span class="string">configure</span> <span class="string">www.conf</span></span><br><span class="line">      <span class="attr">copy:</span></span><br><span class="line">        <span class="attr">src:</span> <span class="string">./files/www.conf</span></span><br><span class="line">        <span class="attr">dest:</span> <span class="string">/etc/php-fpm.d/www.conf</span></span><br><span class="line">        <span class="attr">owner:</span> <span class="string">root</span></span><br><span class="line">        <span class="attr">group:</span> <span class="string">root</span></span><br><span class="line">        <span class="attr">mode:</span> <span class="number">0644</span></span><br><span class="line">      <span class="attr">notify:</span> <span class="string">restart</span> <span class="string">php</span>        </span><br><span class="line">    <span class="bullet">-</span> <span class="attr">name:</span> <span class="string">start</span> <span class="string">php</span></span><br><span class="line">      <span class="attr">systemd:</span></span><br><span class="line">        <span class="attr">name:</span> <span class="string">php-fpm</span></span><br><span class="line">        <span class="attr">state:</span> <span class="string">started</span>        </span><br><span class="line">        <span class="attr">enabled:</span> <span class="literal">yes</span></span><br><span class="line">        </span><br><span class="line">    <span class="bullet">-</span> <span class="attr">name:</span> <span class="string">copy</span> <span class="string">nginx</span> <span class="string">conf</span> </span><br><span class="line">      <span class="attr">copy:</span></span><br><span class="line">        <span class="attr">src:</span> <span class="string">./files/phpmyadmin.conf</span></span><br><span class="line">        <span class="attr">dest:</span> <span class="string">/etc/nginx/conf.d/phpmyadmin.conf</span></span><br><span class="line">      <span class="attr">notify:</span> <span class="string">restart</span> <span class="string">nginx</span>      </span><br><span class="line">    <span class="bullet">-</span> <span class="attr">name:</span> <span class="string">create</span> <span class="string">code</span> <span class="string">directory</span></span><br><span class="line">      <span class="attr">file:</span></span><br><span class="line">        <span class="attr">path:</span> <span class="string">/code</span></span><br><span class="line">        <span class="attr">state:</span> <span class="string">directory</span></span><br><span class="line">        <span class="attr">owner:</span> <span class="string">www</span></span><br><span class="line">        <span class="attr">group:</span> <span class="string">www</span></span><br><span class="line">        <span class="attr">mode:</span> <span class="string">&quot;0755&quot;</span></span><br><span class="line">        <span class="attr">recurse:</span> <span class="literal">yes</span>    </span><br><span class="line">    <span class="bullet">-</span> <span class="attr">name:</span> <span class="string">unarchive</span> <span class="string">phpmyadmin</span>   <span class="comment">#è§£å‹phpmyadmin</span></span><br><span class="line">      <span class="attr">unarchive:</span> </span><br><span class="line">        <span class="attr">src:</span> <span class="string">./files/phpMyAdmin-5.2.2-all-languages.zip</span></span><br><span class="line">        <span class="attr">dest:</span> <span class="string">/code/</span></span><br><span class="line">        <span class="attr">owner:</span> <span class="string">www</span></span><br><span class="line">        <span class="attr">group:</span> <span class="string">www</span></span><br><span class="line">        <span class="attr">creates:</span> <span class="string">/code/phpMyAdmin-5.2.2-all-languages/config.inc.php</span>        </span><br><span class="line">    <span class="bullet">-</span> <span class="attr">name:</span> <span class="string">create</span> <span class="string">link</span>  <span class="comment">#åˆ›å»ºè½¯è¿æ¥</span></span><br><span class="line">      <span class="attr">file:</span> </span><br><span class="line">        <span class="attr">src:</span> <span class="string">/code/phpMyAdmin-5.2.2-all-languages/</span></span><br><span class="line">        <span class="attr">dest:</span> <span class="string">/code/phpmyadmin</span> </span><br><span class="line">        <span class="attr">state:</span> <span class="string">link</span></span><br><span class="line">    <span class="bullet">-</span> <span class="attr">name:</span> <span class="string">change</span> <span class="string">phpmyadmin</span> <span class="string">configure</span> </span><br><span class="line">      <span class="attr">copy:</span></span><br><span class="line">        <span class="attr">src:</span> <span class="string">./files/config.inc.php</span></span><br><span class="line">        <span class="attr">dest:</span> <span class="string">/code/phpMyAdmin-5.2.2-all-languages/config.inc.php</span>  </span><br><span class="line">          </span><br><span class="line">        </span><br><span class="line">  <span class="attr">handlers:</span> </span><br><span class="line">    <span class="bullet">-</span> <span class="attr">name:</span> <span class="string">restart</span> <span class="string">nginx</span></span><br><span class="line">      <span class="attr">systemd:</span></span><br><span class="line">        <span class="attr">name:</span> <span class="string">nginx</span></span><br><span class="line">        <span class="attr">state:</span> <span class="string">restarted</span></span><br><span class="line">    <span class="bullet">-</span> <span class="attr">name:</span> <span class="string">restart</span> <span class="string">php</span></span><br><span class="line">      <span class="attr">systemd:</span></span><br><span class="line">        <span class="attr">name:</span> <span class="string">php-fpm</span></span><br><span class="line">        <span class="attr">state:</span> <span class="string">restarted</span></span><br><span class="line"></span><br></pre></td></tr></table></figure><p>ï¼ˆ5ï¼‰å®‰è£…å¹¶æµ‹è¯•</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">ansible-playbook --syntax-check nginx-php.yml</span><br><span class="line">ansible-playbook -C nginx-php.yml</span><br><span class="line">ansible-playbook nginx-php.yml</span><br></pre></td></tr></table></figure><p>ï¼ˆ6ï¼‰åœ¨æœ¬æœºç”µè„‘<code>C:\Windows\System32\drivers\etc\hosts</code>é…ç½®hosts</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta prompt_">#</span><span class="language-bash">åˆ†åˆ«é…ç½®121ï¼Œ122çš„hostsè¿›è¡Œè®¿é—®æµ‹è¯•</span></span><br><span class="line">192.168.1.121 ansible.phpmyadmin.local</span><br><span class="line">192.168.1.122 ansible.phpmyadmin.local</span><br></pre></td></tr></table></figure><p>ï¼ˆ7ï¼‰æµè§ˆå™¨è®¿é—®<code>ansible.phpmyadmin.local</code>ï¼Œç”¨æˆ·å¯†ç æ˜¯å®‰è£…Mariadbæ•°æ®åº“æ—¶ï¼Œåˆ›å»ºçš„ç”¨æˆ·<code>php_user</code>åŠå…¶å¯†ç <code>123456</code>ã€‚</p><img src="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="/yyg/e80721f/3.png" title="image-20250411224722322"> <img src="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="/yyg/e80721f/4.png" title="image-20250411224810891"><h6 id="è´Ÿè½½å‡è¡¡æ–¹å¼ä¸€ï¼šnginx"><a href="#è´Ÿè½½å‡è¡¡æ–¹å¼ä¸€ï¼šnginx" class="headerlink" title="è´Ÿè½½å‡è¡¡æ–¹å¼ä¸€ï¼šnginx"></a>è´Ÿè½½å‡è¡¡æ–¹å¼ä¸€ï¼šnginx</h6><p>ï¼ˆ1ï¼‰å¤åˆ¶nginxçš„é…ç½®æ–‡ä»¶<code>nginx.conf</code>ï¼Œè‡³<code>/data/phpmyadmin/files</code>ç›®å½•ä¸‹å¹¶å‘½åä¸º<code>nginx.conf.lb</code></p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">cp /etc/nginx.conf /data/phpmyadmin/files/nginx.conf.lb</span><br></pre></td></tr></table></figure><p>ï¼ˆ2ï¼‰åœ¨<code>/data/phpmyadmin/files</code>ç›®å½•ä¸‹åˆ›å»ºé…ç½®æ–‡ä»¶<code>proxy.conf</code>ï¼Œç”¨ä½œè´Ÿè½½å‡è¡¡</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line">vi proxy.conf</span><br><span class="line"></span><br><span class="line">upstream ansible &#123;</span><br><span class="line">    server 192.168.1.121;</span><br><span class="line">    server 192.168.1.122;</span><br><span class="line">&#125;</span><br><span class="line">server &#123;</span><br><span class="line">    listen 80;</span><br><span class="line">    server_name ansible.phpmyadmin.local;</span><br><span class="line">    location / &#123;</span><br><span class="line">        proxy_pass http://ansible;</span><br><span class="line">        proxy_set_header Host $http_host;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure><p>ï¼ˆ3ï¼‰åˆ›å»ºlb-nginxå‰§æœ¬</p><figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre></td><td class="code"><pre><span class="line"><span class="string">vi</span> <span class="string">lb-nginx.yml</span></span><br><span class="line"></span><br><span class="line"><span class="bullet">-</span> <span class="attr">hosts:</span> <span class="string">lbservers</span></span><br><span class="line">  <span class="attr">tasks:</span></span><br><span class="line">    <span class="bullet">-</span> <span class="attr">name:</span> <span class="string">download</span> <span class="string">nginx</span></span><br><span class="line">      <span class="attr">yum:</span></span><br><span class="line">        <span class="attr">name:</span> <span class="string">nginx</span></span><br><span class="line">        <span class="attr">state:</span> <span class="string">present</span></span><br><span class="line">    <span class="bullet">-</span> <span class="attr">name:</span> <span class="string">configure</span> <span class="string">nginx</span></span><br><span class="line">      <span class="attr">copy:</span></span><br><span class="line">        <span class="attr">src:</span> <span class="string">./files/nginx.conf.lb</span></span><br><span class="line">        <span class="attr">dest:</span> <span class="string">/etc/nginx/nginx.conf</span></span><br><span class="line">      <span class="attr">notify:</span> <span class="string">restart</span> <span class="string">nginx</span></span><br><span class="line">    <span class="bullet">-</span> <span class="attr">name:</span> <span class="string">copy</span> <span class="string">nginx</span> <span class="string">conf</span></span><br><span class="line">      <span class="attr">copy:</span></span><br><span class="line">        <span class="attr">src:</span> <span class="string">./files/proxy.conf</span></span><br><span class="line">        <span class="attr">dest:</span> <span class="string">/etc/nginx/conf.d/proxy.conf</span></span><br><span class="line">      <span class="attr">notify:</span> <span class="string">restart</span> <span class="string">nginx</span></span><br><span class="line">    <span class="bullet">-</span> <span class="attr">name:</span> <span class="string">start</span> <span class="string">nginx</span></span><br><span class="line">      <span class="attr">systemd:</span></span><br><span class="line">        <span class="attr">name:</span> <span class="string">nginx</span></span><br><span class="line">        <span class="attr">state:</span> <span class="string">started</span></span><br><span class="line">        <span class="attr">enabled:</span> <span class="literal">yes</span></span><br><span class="line">  <span class="attr">handlers:</span></span><br><span class="line">    <span class="bullet">-</span> <span class="attr">name:</span> <span class="string">restart</span> <span class="string">nginx</span></span><br><span class="line">      <span class="attr">systemd:</span></span><br><span class="line">        <span class="attr">name:</span> <span class="string">nginx</span></span><br><span class="line">        <span class="attr">state:</span> <span class="string">restarted</span></span><br></pre></td></tr></table></figure><p>ï¼ˆ4ï¼‰å®‰è£…å¹¶æµ‹è¯•</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">ansible-playbook --syntax-check lb-nginx.yml</span><br><span class="line">ansible-playbook -C lb-nginx.yml</span><br><span class="line">ansible-playbook lb-nginx.yml</span><br></pre></td></tr></table></figure><p>ï¼ˆ5ï¼‰åœ¨æœ¬æœºç”µè„‘<code>C:\Windows\System32\drivers\etc\hosts</code>é…ç½®hosts</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">192.168.1.123 ansible.phpmyadmin.local</span><br><span class="line">192.168.1.124 ansible.phpmyadmin.local</span><br></pre></td></tr></table></figure><p>ï¼ˆ6ï¼‰æµè§ˆå™¨è®¿é—®<code>ansible.phpmyadmin.local</code>,å¹¶è§‚å¯Ÿ<code>æ•°æ®åº“æœåŠ¡å™¨</code>-<code>ç”¨æˆ·</code>ï¼Œåˆ·æ–°æŸ¥çœ‹ç”¨æˆ·æ˜¯å¦ä¸º121ä¸122åˆ‡æ¢æ˜¾ç¤ºã€‚</p><h6 id="è´Ÿè½½å‡è¡¡æ–¹å¼äºŒï¼šhaproxy"><a href="#è´Ÿè½½å‡è¡¡æ–¹å¼äºŒï¼šhaproxy" class="headerlink" title="è´Ÿè½½å‡è¡¡æ–¹å¼äºŒï¼šhaproxy"></a>è´Ÿè½½å‡è¡¡æ–¹å¼äºŒï¼šhaproxy</h6><p>ï¼ˆ1ï¼‰è®¾ç½®haproxyä¸‹è½½æº</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">rpm -Uvh https://repo.ius.io/ius-release-el7.rpm</span><br></pre></td></tr></table></figure><p>ï¼ˆ2ï¼‰å°†<code>/etc/haproxy/haproxy.cfg</code>ï¼Œè‡³<code>/data/phpmyadmin/files</code>ç›®å½•ä¸‹</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">cp /etc/haproxy/haproxy.cfg /data/phpmyadmin/files</span><br></pre></td></tr></table></figure><blockquote><p>å¯å…ˆåœ¨ä»»æ„ä¸€å°æœåŠ¡å™¨å®‰è£…haproxyï¼Œè·å–/etc/haproxy/haproxy.cfgæ–‡ä»¶</p></blockquote><p>ï¼ˆ3ï¼‰ä¿®æ”¹<code>haproxy.cfg</code>é…ç½®æ–‡ä»¶ï¼Œæ–°å¢ä»¥ä¸‹å†…å®¹ã€‚</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">frontend web</span><br><span class="line">                bind *:8080</span><br><span class="line">                mode http</span><br><span class="line">                acl ansible_domain hdr_reg(host) -i ansible.phpmyadmin.local</span><br><span class="line">                use_backend ansible_cluster if ansible_domain</span><br><span class="line">backend ansible_cluster</span><br><span class="line">                balance roundrobin</span><br><span class="line">                option httpchk HEAD / HTTP/1.1\r\nHost:\ ansible.phpmyadmin.local</span><br><span class="line">                server server1 192.168.1.121:80 check port 80 inter 3s rise 2 fall 3</span><br><span class="line">                server server2 192.168.1.122:80 check port 80 inter 3s rise 2 fall 3</span><br><span class="line"></span><br></pre></td></tr></table></figure><p>ï¼ˆ4ï¼‰åˆ›å»ºlb-haproxyå‰§æœ¬</p><figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><span class="line"><span class="string">vi</span> <span class="string">lb-haproxy.yml</span></span><br><span class="line"></span><br><span class="line"><span class="bullet">-</span> <span class="attr">hosts:</span> <span class="string">lbservers</span></span><br><span class="line">  <span class="attr">tasks:</span></span><br><span class="line">    <span class="bullet">-</span> <span class="attr">name:</span> <span class="string">download</span> <span class="string">haproxy</span></span><br><span class="line">      <span class="attr">yum:</span></span><br><span class="line">        <span class="attr">name:</span> <span class="string">haproxy22</span></span><br><span class="line">        <span class="attr">state:</span> <span class="string">present</span></span><br><span class="line">    <span class="bullet">-</span> <span class="attr">name:</span> <span class="string">configure</span> <span class="string">haproxy</span></span><br><span class="line">      <span class="attr">copy:</span></span><br><span class="line">        <span class="attr">src:</span> <span class="string">./files/haproxy.cfg</span></span><br><span class="line">        <span class="attr">dest:</span> <span class="string">/etc/haproxy/haproxy.cfg</span></span><br><span class="line">        <span class="attr">owner:</span> <span class="string">root</span></span><br><span class="line">        <span class="attr">group:</span> <span class="string">root</span></span><br><span class="line">        <span class="attr">mode:</span> <span class="number">0644</span></span><br><span class="line">      <span class="attr">notify:</span> <span class="string">restart</span> <span class="string">haproxy</span>  </span><br><span class="line">    <span class="bullet">-</span> <span class="attr">name:</span> <span class="string">start</span> <span class="string">haproxy</span></span><br><span class="line">      <span class="attr">systemd:</span></span><br><span class="line">        <span class="attr">name:</span> <span class="string">haproxy</span></span><br><span class="line">        <span class="attr">state:</span> <span class="string">started</span>        </span><br><span class="line">        <span class="attr">enabled:</span> <span class="literal">yes</span></span><br><span class="line">  <span class="attr">handlers:</span> </span><br><span class="line">    <span class="bullet">-</span> <span class="attr">name:</span> <span class="string">restart</span> <span class="string">haproxy</span></span><br><span class="line">      <span class="attr">systemd:</span></span><br><span class="line">        <span class="attr">name:</span> <span class="string">haproxy</span></span><br><span class="line">        <span class="attr">state:</span> <span class="string">restarted</span></span><br></pre></td></tr></table></figure><p>ï¼ˆ5ï¼‰å®‰è£…å¹¶æµ‹è¯•</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">ansible-playbook --syntax-check lb-haproxy.yml</span><br><span class="line">ansible-playbook -C lb-haproxy.yml</span><br><span class="line">ansible-playbook lb-haproxy.yml</span><br></pre></td></tr></table></figure><p>ï¼ˆ5ï¼‰åœ¨æœ¬æœºç”µè„‘<code>C:\Windows\System32\drivers\etc\hosts</code>é…ç½®hosts</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">192.168.1.123 ansible.phpmyadmin.local</span><br><span class="line">192.168.1.124 ansible.phpmyadmin.local</span><br></pre></td></tr></table></figure><p>ï¼ˆ6ï¼‰æµè§ˆå™¨è®¿é—®<code>ansible.phpmyadmin.local:8080</code>,å¹¶è§‚å¯Ÿ<code>æ•°æ®åº“æœåŠ¡å™¨</code>-<code>ç”¨æˆ·</code>ï¼Œåˆ·æ–°æŸ¥çœ‹ç”¨æˆ·æ˜¯å¦ä¸º121ä¸122åˆ‡æ¢æ˜¾ç¤ºã€‚</p><blockquote><p>æœ¬ç¯‡çŸ¥è¯†æ¥æºäºBç«™è§†é¢‘BV11JZcYwEDd</p></blockquote></article><div class="post-copyright"><div class="post-copyright__author"><span class="post-copyright-meta"><i class="fas fa-circle-user fa-fw"></i>æ–‡ç« ä½œè€…:</span> <span class="post-copyright-info"><a href="https://yyg.js.cool/">äº‘é‡é˜</a></span></div><div class="post-copyright__type"><span class="post-copyright-meta"><i class="fas fa-square-arrow-up-right fa-fw"></i>æ–‡ç« é“¾æ¥:</span> <span class="post-copyright-info"><a href="https://yyg.js.cool/yyg/e80721f/">https://yyg.js.cool/yyg/e80721f/</a></span></div><div class="post-copyright__notice"><span class="post-copyright-meta"><i class="fas fa-circle-exclamation fa-fw"></i>ç‰ˆæƒå£°æ˜:</span> <span class="post-copyright-info">æœ¬åšå®¢æ‰€æœ‰æ–‡ç« é™¤ç‰¹åˆ«å£°æ˜å¤–ï¼Œå‡é‡‡ç”¨ <a href="https://creativecommons.org/licenses/by-nc-sa/4.0/" target="_blank">CC BY-NC-SA 4.0</a> è®¸å¯åè®®ã€‚è½¬è½½è¯·æ³¨æ˜æ¥æº <a href="https://yyg.js.cool" target="_blank">äº‘é‡é˜</a>ï¼</span></div></div><div class="tag_share"><div class="post-meta__tag-list"><a class="post-meta__tags" href="/tags/%E7%9F%A5%E8%AF%86%E6%A2%B3%E7%90%86/">çŸ¥è¯†æ¢³ç†</a><a class="post-meta__tags" href="/tags/CI-CD/">CI/CD</a><a class="post-meta__tags" href="/tags/%E8%87%AA%E5%8A%A8%E5%8C%96%E8%BF%90%E7%BB%B4/">è‡ªåŠ¨åŒ–è¿ç»´</a><a class="post-meta__tags" href="/tags/Ansible/">Ansible</a><a class="post-meta__tags" href="/tags/Linux%E8%BF%90%E7%BB%B4/">Linuxè¿ç»´</a></div><div class="post-share"><div class="social-share" data-image="https://t.alcy.cc/fj" data-sites="facebook,x,wechat,weibo,qq"></div><link rel="stylesheet" href="https://s4.zstatic.net/ajax/libs/butterfly-extsrc/1.1.4/sharejs/dist/css/share.min.css" media="print" onload='this.media="all"'><script src="https://s4.zstatic.net/ajax/libs/butterfly-extsrc/1.1.4/sharejs/dist/js/social-share.min.js" defer></script></div></div><nav class="pagination-post" id="pagination"><a class="pagination-related" href="/yyg/80ffa402/" title="Hexo-Butterflyç¾åŒ–æ•™ç¨‹-[2]Butterflyä¸»é¢˜å®‰è£…"><img class="cover" src="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="/img/icon.png" onerror='onerror=null,src="/img/404.jpg"' alt="cover of previous post"><div class="info"><div class="info-1"><div class="info-item-1">ä¸Šä¸€ç¯‡</div><div class="info-item-2">Hexo-Butterflyç¾åŒ–æ•™ç¨‹-[2]Butterflyä¸»é¢˜å®‰è£…</div></div><div class="info-2"><div class="info-item-1">æ‹‰å–ä¸»é¢˜ä»£ç 1git clone -b master https://github.com/jerryc127/hexo-theme-butterfly.git themes/butterfly é…ç½®ä¸»é¢˜åº”ç”¨å°†blogæ ¹ç›®å½•ä¸‹çš„_co...</div></div></div></a><a class="pagination-related" href="/yyg/10ac2e4/" title="Ansibleæœ€æ–°ç‰ˆå®‰è£…"><img class="cover" src="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://random-img.pupper.cn/api" onerror='onerror=null,src="/img/404.jpg"' alt="cover of next post"><div class="info text-right"><div class="info-1"><div class="info-item-1">ä¸‹ä¸€ç¯‡</div><div class="info-item-2">Ansibleæœ€æ–°ç‰ˆå®‰è£…</div></div><div class="info-2"><div class="info-item-1">pipæ–¹å¼å®‰è£…åŸºç¡€ç¯å¢ƒå‡†å¤‡ï¼ˆ1ï¼‰å®‰è£…è½¯ä»¶ä¾èµ– 1yum install -y zlib zlib-dev zlib-devel sqlite-devel openssl-devel bzip2-devel libffi libff...</div></div></div></a></nav><div class="relatedPosts"><div class="headline"><i class="fas fa-thumbs-up fa-fw"></i><span>ç›¸å…³æ¨è</span></div><div class="relatedPosts-list"><a class="pagination-related" href="/yyg/f0979e05/" title="JenkinsçŸ¥è¯†æ¢³ç†"><img class="cover" src="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://api.jiangyuhui.top/aliyun/randomCover" alt="cover"><div class="info text-center"><div class="info-1"><div class="info-item-1"><i class="far fa-calendar-alt fa-fw"></i> 2025-05-17</div><div class="info-item-2">JenkinsçŸ¥è¯†æ¢³ç†</div></div><div class="info-2"><div class="info-item-1">ğŸ”œä»€ä¹ˆæ˜¯Jenkinsï¼ŸğŸ”š Jenkinsæ˜¯ä¸€æ¬¾åŸºäºJavaå¼€å‘çš„å¼€æº CI&amp;CD è½¯ä»¶ï¼Œç”¨äºè‡ªåŠ¨åŒ–å„ç§ä»»åŠ¡ï¼ŒåŒ…æ‹¬æ„å»ºã€æµ‹è¯•å’Œéƒ¨ç½²è½¯ä»¶ã€‚Jenkinsæä¾›å¤šç§å®‰...</div></div></div></a><a class="pagination-related" href="/yyg/10ac2e4/" title="Ansibleæœ€æ–°ç‰ˆå®‰è£…"><img class="cover" src="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://random-img.pupper.cn/api" alt="cover"><div class="info text-center"><div class="info-1"><div class="info-item-1"><i class="far fa-calendar-alt fa-fw"></i> 2025-04-12</div><div class="info-item-2">Ansibleæœ€æ–°ç‰ˆå®‰è£…</div></div><div class="info-2"><div class="info-item-1">pipæ–¹å¼å®‰è£…åŸºç¡€ç¯å¢ƒå‡†å¤‡ï¼ˆ1ï¼‰å®‰è£…è½¯ä»¶ä¾èµ– 1yum install -y zlib zlib-dev zlib-devel sqlite-devel openssl-devel bzip2-devel libffi libff...</div></div></div></a><a class="pagination-related no-desc" href="/yyg/5c56de6f/" title="dockerçŸ¥è¯†æ¢³ç†"><img class="cover" src="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://api.vvhan.com/api/wallpaper/views" alt="cover"><div class="info text-center"><div class="info-1"><div class="info-item-1"><i class="far fa-calendar-alt fa-fw"></i> 2024-03-24</div><div class="info-item-2">dockerçŸ¥è¯†æ¢³ç†</div></div></div></a><a class="pagination-related" href="/yyg/986299a9/" title="k8sçŸ¥è¯†æ¢³ç†--è¿›é˜¶"><img class="cover" src="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://api.vvhan.com/api/wallpaper/views" alt="cover"><div class="info text-center"><div class="info-1"><div class="info-item-1"><i class="far fa-calendar-alt fa-fw"></i> 2025-08-22</div><div class="info-item-2">k8sçŸ¥è¯†æ¢³ç†--è¿›é˜¶</div></div><div class="info-2"><div class="info-item-1">ç½‘ç»œKubernetes-ç½‘ç»œæ¨¡å‹åŸåˆ™ åœ¨ä¸ä½¿ç”¨ç½‘ç»œåœ°å€è½¬æ¢(NAT)çš„æƒ…å†µä¸‹ï¼Œé›†ç¾¤ä¸­çš„Podèƒ½å¤Ÿä¸ä»»æ„å…¶ä»–Podè¿›è¡Œé€šä¿¡ åœ¨ä¸ä½¿ç”¨ç½‘ç»œåœ°å€è½¬æ¢(NAT)çš„æƒ…å†µä¸‹ï¼Œåœ¨é›†ç¾¤èŠ‚ç‚¹ä¸Šè¿è¡Œçš„ç¨‹åºèƒ½ä¸åŒä¸€èŠ‚ç‚¹ä¸Šçš„ä»»ä½•Podè¿›è¡Œé€šä¿¡ æ¯ä¸ªPodéƒ½...</div></div></div></a><a class="pagination-related no-desc" href="/yyg/f5a7a3df/" title="KubernetesçŸ¥è¯†æ¢³ç†"><img class="cover" src="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://random-img.pupper.cn/api" alt="cover"><div class="info text-center"><div class="info-1"><div class="info-item-1"><i class="far fa-calendar-alt fa-fw"></i> 2024-03-24</div><div class="info-item-2">KubernetesçŸ¥è¯†æ¢³ç†</div></div></div></a><a class="pagination-related" href="/yyg/3b57c0c6/" title="dockerå®¹å™¨æ—¥å¿—é…ç½®ç®¡ç†"><img class="cover" src="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://imgapi.cn/api.php?fl=fengjing&gs=images" alt="cover"><div class="info text-center"><div class="info-1"><div class="info-item-1"><i class="far fa-calendar-alt fa-fw"></i> 2024-08-07</div><div class="info-item-2">dockerå®¹å™¨æ—¥å¿—é…ç½®ç®¡ç†</div></div><div class="info-2"><div class="info-item-1">è¿è¡Œçš„é¡¹ç›®å®¹å™¨çªç„¶å°±åœäº†ï¼ŒæŸ¥çœ‹å®¹å™¨æ—¥å¿—å‘ç°ç£ç›˜ç©ºé—´ä¸è¶³ï¼Œå¯¼è‡´å®¹å™¨æ²¡æ³•è¿è¡Œäº†ã€‚ Error response from daemon: Cannot restart container docker-p: mkdir /home/do...</div></div></div></a></div></div><hr class="custom-hr"><div id="post-comment"><div class="comment-head"><div class="comment-headline"><i class="fas fa-comments fa-fw"></i> <span>è¯„è®º</span></div><div class="comment-switch"><span class="first-comment">Giscus</span><span id="switch-btn"></span><span class="second-comment">Utterances</span></div></div><div class="comment-wrap"><div><div id="giscus-wrap"></div></div><div><div id="utterances-wrap"></div></div></div></div></div><div class="aside-content" id="aside-content"><div class="card-widget card-info text-center"><div class="avatar-img"><img src="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="/img/icon.png" onerror='this.onerror=null,this.src="/img/friend_404.gif"' alt="avatar"></div><div class="author-info-name">äº‘é‡é˜</div><div class="author-info-description">é—²äº‘é‡é¹¤ï¼Œå…«æ–¹é€é¥</div><div class="site-data"><a href="/archives/"><div class="headline">æ–‡ç« </div><div class="length-num">62</div></a><a href="/tags/"><div class="headline">æ ‡ç­¾</div><div class="length-num">109</div></a><a href="/categories/"><div class="headline">åˆ†ç±»</div><div class="length-num">37</div></a></div><div class="card-info-social-icons"><a class="social-icon" href="https://github.com/MarsperL" target="_blank" title="Github"><i class="fab fa-github" style="color:#24292e"></i></a><a class="social-icon" href="mailto:eXlnbGlAZm94bWFpbC5jb20=" target="_blank" title="Email"><i class="fas fa-envelope" style="color:#4a7dbe"></i></a><a class="social-icon" href="/rss2.xml" target="_blank"><i class="fas fa-rss"></i></a></div></div><div class="sticky_layout"><div class="card-widget" id="card-toc"><div class="item-headline"><i class="fas fa-stream"></i><span>ç›®å½•</span><span class="toc-percentage"></span></div><div class="toc-content"><ol class="toc"><li class="toc-item toc-level-2"><a class="toc-link" href="#%E6%9E%B6%E6%9E%84"><span class="toc-number">1.</span> <span class="toc-text">æ¶æ„</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#Ansible%E9%87%8D%E8%A6%81%E6%A6%82%E5%BF%B5"><span class="toc-number">2.</span> <span class="toc-text">Ansibleé‡è¦æ¦‚å¿µ</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E6%8E%A7%E5%88%B6%E8%8A%82%E7%82%B9"><span class="toc-number">2.1.</span> <span class="toc-text">æ§åˆ¶èŠ‚ç‚¹</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%8F%97%E6%8E%A7%E8%8A%82%E7%82%B9%EF%BC%88%E8%A2%AB%E7%AE%A1%E7%90%86%E8%8A%82%E7%82%B9%EF%BC%89"><span class="toc-number">2.2.</span> <span class="toc-text">å—æ§èŠ‚ç‚¹ï¼ˆè¢«ç®¡ç†èŠ‚ç‚¹ï¼‰</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%BA%93%E5%AD%98-Inventory"><span class="toc-number">2.3.</span> <span class="toc-text">åº“å­˜ (Inventory)</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%89%A7%E6%9C%AC%EF%BC%88Playbook%EF%BC%89"><span class="toc-number">2.4.</span> <span class="toc-text">å‰§æœ¬ï¼ˆPlaybookï¼‰</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E6%A8%A1%E5%9D%97-Modules"><span class="toc-number">2.5.</span> <span class="toc-text">æ¨¡å— (Modules)</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E8%A7%92%E8%89%B2-Roles"><span class="toc-number">2.6.</span> <span class="toc-text">è§’è‰² (Roles)</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E4%BB%BB%E5%8A%A1-Tasks"><span class="toc-number">2.7.</span> <span class="toc-text">ä»»åŠ¡ (Tasks)</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E6%8F%92%E4%BB%B6"><span class="toc-number">2.8.</span> <span class="toc-text">æ’ä»¶</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E9%9B%86%E5%90%88"><span class="toc-number">2.9.</span> <span class="toc-text">é›†åˆ</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#Ansible%E4%BB%BB%E5%8A%A1%E6%89%A7%E8%A1%8C%E6%A8%A1%E5%BC%8F"><span class="toc-number">3.</span> <span class="toc-text">Ansibleä»»åŠ¡æ‰§è¡Œæ¨¡å¼</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#Ansible%E5%AE%89%E8%A3%85%EF%BC%88centos-7%EF%BC%89"><span class="toc-number">4.</span> <span class="toc-text">Ansibleå®‰è£…ï¼ˆcentos 7ï¼‰</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E6%96%B9%E5%BC%8F%E4%B8%80%EF%BC%9A%E4%BD%BF%E7%94%A8yum%E5%AE%89%E8%A3%85"><span class="toc-number">4.1.</span> <span class="toc-text">æ–¹å¼ä¸€ï¼šä½¿ç”¨yumå®‰è£…</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E6%96%B9%E5%BC%8F%E4%BA%8C%EF%BC%9A%E4%BD%BF%E7%94%A8pip%E5%AE%89%E8%A3%85"><span class="toc-number">4.2.</span> <span class="toc-text">æ–¹å¼äºŒï¼šä½¿ç”¨pipå®‰è£…</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#Ansible-%E9%85%8D%E7%BD%AE%E6%96%87%E4%BB%B6"><span class="toc-number">5.</span> <span class="toc-text">Ansible é…ç½®æ–‡ä»¶</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#Ansible%E5%85%8D%E5%AF%86%E7%99%BB%E5%BD%95"><span class="toc-number">6.</span> <span class="toc-text">Ansibleå…å¯†ç™»å½•</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#root%E7%94%A8%E6%88%B7"><span class="toc-number">6.1.</span> <span class="toc-text">rootç”¨æˆ·</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E6%99%AE%E9%80%9A%E7%94%A8%E6%88%B7"><span class="toc-number">6.2.</span> <span class="toc-text">æ™®é€šç”¨æˆ·</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#Ansible-Ad-Hoc%E4%B8%8E%E5%B8%B8%E7%94%A8%E6%A8%A1%E5%9D%97"><span class="toc-number">7.</span> <span class="toc-text">Ansible Ad-Hocä¸å¸¸ç”¨æ¨¡å—</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#Ad-Hoc"><span class="toc-number">7.1.</span> <span class="toc-text">Ad-Hoc</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%B8%B8%E7%94%A8%E6%A8%A1%E5%9D%97"><span class="toc-number">7.2.</span> <span class="toc-text">å¸¸ç”¨æ¨¡å—</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#command%E6%A8%A1%E5%9D%97"><span class="toc-number">7.2.1.</span> <span class="toc-text">commandæ¨¡å—</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#shell%E6%A8%A1%E5%9D%97"><span class="toc-number">7.2.2.</span> <span class="toc-text">shellæ¨¡å—</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#yum-apt-%E6%A8%A1%E5%9D%97"><span class="toc-number">7.2.3.</span> <span class="toc-text">yum&#x2F;apt æ¨¡å—</span></a></li></ol></li></ol></li></ol><li class="toc-item toc-level-1"><a class="toc-link" href="#%E5%AE%89%E8%A3%85%E6%9C%8D%E5%8A%A1"><span class="toc-number"></span> <span class="toc-text">å®‰è£…æœåŠ¡</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#%E5%8D%B8%E8%BD%BD%E6%9C%8D%E5%8A%A1"><span class="toc-number"></span> <span class="toc-text">å¸è½½æœåŠ¡</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#copy%E6%A8%A1%E5%9D%97"><span class="toc-number">0.0.1.</span> <span class="toc-text">copyæ¨¡å—</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#systemd-%E6%A8%A1%E5%9D%97"><span class="toc-number">0.0.2.</span> <span class="toc-text">systemd æ¨¡å—</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#file%E6%A8%A1%E5%9D%97"><span class="toc-number">0.0.3.</span> <span class="toc-text">fileæ¨¡å—</span></a></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#%E5%88%9B%E5%BB%BA-data%E7%9B%AE%E5%BD%95%EF%BC%8C%E6%8E%88%E6%9D%83test%E5%B1%9E%E7%BB%84"><span class="toc-number"></span> <span class="toc-text">åˆ›å»º&#x2F;dataç›®å½•ï¼Œæˆæƒtestå±ç»„</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#group%E6%A8%A1%E5%9D%97"><span class="toc-number">0.0.1.</span> <span class="toc-text">groupæ¨¡å—</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#user%E6%A8%A1%E5%9D%97"><span class="toc-number">0.0.2.</span> <span class="toc-text">useræ¨¡å—</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#mount-%E6%A8%A1%E5%9D%97"><span class="toc-number">0.0.3.</span> <span class="toc-text">mount æ¨¡å—</span></a></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#%E5%B0%86192-168-1-121%E4%B8%8A%E7%9A%84-nfs%E7%9B%AE%E5%BD%95%E6%8C%82%E8%BD%BD%E5%88%B0192-168-1-122%E7%9A%84-nfs%E7%9B%AE%E5%BD%95"><span class="toc-number"></span> <span class="toc-text">å°†192.168.1.121ä¸Šçš„&#x2F;nfsç›®å½•æŒ‚è½½åˆ°192.168.1.122çš„&#x2F;nfsç›®å½•</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#cron%E6%A8%A1%E5%9D%97"><span class="toc-number">0.0.1.</span> <span class="toc-text">cronæ¨¡å—</span></a></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#%E6%B7%BB%E5%8A%A0%E4%B8%80%E4%B8%AA%E6%AF%8F%E5%A4%A919%E7%82%B9%E6%89%A7%E8%A1%8C-data-test-sh%E8%84%9A%E6%9C%AC%E7%9A%84%E5%AE%9A%E6%97%B6%E4%BB%BB%E5%8A%A1%EF%BC%8C%E4%BB%BB%E5%8A%A1%E5%90%8D%E4%B8%BAscript-test%E3%80%82"><span class="toc-number"></span> <span class="toc-text">æ·»åŠ ä¸€ä¸ªæ¯å¤©19ç‚¹æ‰§è¡Œ&#x2F;data&#x2F;test.shè„šæœ¬çš„å®šæ—¶ä»»åŠ¡ï¼Œä»»åŠ¡åä¸ºscript-testã€‚</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#%E6%B3%A8%E9%87%8A%E8%AF%A5%E5%AE%9A%E6%97%B6%E4%BB%BB%E5%8A%A1"><span class="toc-number"></span> <span class="toc-text">æ³¨é‡Šè¯¥å®šæ—¶ä»»åŠ¡</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#%E5%88%A0%E9%99%A4%E8%AF%A5%E5%AE%9A%E6%97%B6%E4%BB%BB%E5%8A%A1"><span class="toc-number"></span> <span class="toc-text">åˆ é™¤è¯¥å®šæ—¶ä»»åŠ¡</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#archive-%E6%A8%A1%E5%9D%97"><span class="toc-number">0.0.1.</span> <span class="toc-text">archive æ¨¡å—</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#unarchive-%E6%A8%A1%E5%9D%97"><span class="toc-number">0.0.2.</span> <span class="toc-text">unarchive æ¨¡å—</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#lineinfile%E6%A8%A1%E5%9D%97"><span class="toc-number">0.0.3.</span> <span class="toc-text">lineinfileæ¨¡å—</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#Ansible-Playbook"><span class="toc-number">1.</span> <span class="toc-text">Ansible Playbook</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#Playbook%E4%B9%A6%E5%86%99%E6%A0%BC%E5%BC%8F"><span class="toc-number">1.1.</span> <span class="toc-text">Playbookä¹¦å†™æ ¼å¼</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#Playbook%E5%BA%94%E7%94%A8%E5%AE%9E%E4%BE%8B%EF%BC%9A"><span class="toc-number">1.2.</span> <span class="toc-text">Playbookåº”ç”¨å®ä¾‹ï¼š</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#%E5%AE%89%E8%A3%85nignx"><span class="toc-number">1.2.1.</span> <span class="toc-text">å®‰è£…nignx</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E5%AE%89%E8%A3%85NFS%E6%9C%8D%E5%8A%A1"><span class="toc-number">1.2.2.</span> <span class="toc-text">å®‰è£…NFSæœåŠ¡</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E5%AE%89%E8%A3%85rsync%E6%9C%8D%E5%8A%A1"><span class="toc-number">1.2.3.</span> <span class="toc-text">å®‰è£…rsyncæœåŠ¡</span></a><ol class="toc-child"><li class="toc-item toc-level-5"><a class="toc-link" href="#rsync%E6%9C%8D%E5%8A%A1%E7%AB%AF%EF%BC%9A"><span class="toc-number">1.2.3.1.</span> <span class="toc-text">rsyncæœåŠ¡ç«¯ï¼š</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#rsync%E5%AE%A2%E6%88%B7%E7%AB%AF%EF%BC%9A"><span class="toc-number">1.2.3.2.</span> <span class="toc-text">rsyncå®¢æˆ·ç«¯ï¼š</span></a></li></ol></li></ol></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#Ansible-push-backup-data"><span class="toc-number"></span> <span class="toc-text">Ansible: push backup data</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#%E4%BD%BF%E7%94%A8Ansible%E9%83%A8%E7%BD%B2%E5%A4%9A%E8%8A%82%E7%82%B9phpmyadmin"><span class="toc-number">0.0.1.</span> <span class="toc-text">ä½¿ç”¨Ansibleéƒ¨ç½²å¤šèŠ‚ç‚¹phpmyadmin</span></a><ol class="toc-child"><li class="toc-item toc-level-5"><a class="toc-link" href="#%E9%A1%B9%E7%9B%AE%E9%9C%80%E6%B1%82"><span class="toc-number">0.0.1.1.</span> <span class="toc-text">é¡¹ç›®éœ€æ±‚</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#%E4%B8%BB%E6%9C%BA%E8%A7%84%E5%88%92"><span class="toc-number">0.0.1.2.</span> <span class="toc-text">ä¸»æœºè§„åˆ’</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#%E9%83%A8%E7%BD%B2%E6%AD%A5%E9%AA%A4"><span class="toc-number">0.0.1.3.</span> <span class="toc-text">éƒ¨ç½²æ­¥éª¤</span></a><ol class="toc-child"><li class="toc-item toc-level-6"><a class="toc-link" href="#%E7%8E%AF%E5%A2%83%E5%87%86%E5%A4%87"><span class="toc-number">0.0.1.3.1.</span> <span class="toc-text">ç¯å¢ƒå‡†å¤‡</span></a></li><li class="toc-item toc-level-6"><a class="toc-link" href="#%E5%AE%89%E8%A3%85Redis"><span class="toc-number">0.0.1.3.2.</span> <span class="toc-text">å®‰è£…Redis</span></a></li><li class="toc-item toc-level-6"><a class="toc-link" href="#%E5%AE%89%E8%A3%85Mariadb"><span class="toc-number">0.0.1.3.3.</span> <span class="toc-text">å®‰è£…Mariadb</span></a></li><li class="toc-item toc-level-6"><a class="toc-link" href="#%E5%AE%89%E8%A3%85nginx%E3%80%81PHP"><span class="toc-number">0.0.1.3.4.</span> <span class="toc-text">å®‰è£…nginxã€PHP</span></a></li><li class="toc-item toc-level-6"><a class="toc-link" href="#%E8%B4%9F%E8%BD%BD%E5%9D%87%E8%A1%A1%E6%96%B9%E5%BC%8F%E4%B8%80%EF%BC%9Anginx"><span class="toc-number">0.0.1.3.5.</span> <span class="toc-text">è´Ÿè½½å‡è¡¡æ–¹å¼ä¸€ï¼šnginx</span></a></li><li class="toc-item toc-level-6"><a class="toc-link" href="#%E8%B4%9F%E8%BD%BD%E5%9D%87%E8%A1%A1%E6%96%B9%E5%BC%8F%E4%BA%8C%EF%BC%9Ahaproxy"><span class="toc-number">0.0.1.3.6.</span> <span class="toc-text">è´Ÿè½½å‡è¡¡æ–¹å¼äºŒï¼šhaproxy</span></a></li></ol></li></ol></li></ol></li></div></div><div class="card-widget card-recent-post"><div class="item-headline"><i class="fas fa-history"></i><span>æœ€æ–°æ–‡ç« </span></div><div class="aside-list"><div class="aside-list-item"><a class="thumbnail" href="/yyg/2eca17c7/" title="Gitalkè‡ªåŠ¨åˆ›å»ºè¯„è®ºIssues"><img src="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://random-img.pupper.cn/api" onerror='this.onerror=null,this.src="/img/404.jpg"' alt="Gitalkè‡ªåŠ¨åˆ›å»ºè¯„è®ºIssues"></a><div class="content"><a class="title" href="/yyg/2eca17c7/" title="Gitalkè‡ªåŠ¨åˆ›å»ºè¯„è®ºIssues">Gitalkè‡ªåŠ¨åˆ›å»ºè¯„è®ºIssues</a><time datetime="2025-10-08T14:06:07.000Z" title="å‘è¡¨äº 2025-10-08 22:06:07">2025-10-08</time></div></div><div class="aside-list-item"><a class="thumbnail" href="/yyg/986299a9/" title="k8sçŸ¥è¯†æ¢³ç†--è¿›é˜¶"><img src="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://api.vvhan.com/api/wallpaper/views" onerror='this.onerror=null,this.src="/img/404.jpg"' alt="k8sçŸ¥è¯†æ¢³ç†--è¿›é˜¶"></a><div class="content"><a class="title" href="/yyg/986299a9/" title="k8sçŸ¥è¯†æ¢³ç†--è¿›é˜¶">k8sçŸ¥è¯†æ¢³ç†--è¿›é˜¶</a><time datetime="2025-08-22T10:17:22.000Z" title="å‘è¡¨äº 2025-08-22 18:17:22">2025-08-22</time></div></div><div class="aside-list-item"><a class="thumbnail" href="/yyg/4789a872/" title="ç§æœ‰åŒ–éƒ¨ç½²DeepSeek"><img src="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://t.alcy.cc/fj" onerror='this.onerror=null,this.src="/img/404.jpg"' alt="ç§æœ‰åŒ–éƒ¨ç½²DeepSeek"></a><div class="content"><a class="title" href="/yyg/4789a872/" title="ç§æœ‰åŒ–éƒ¨ç½²DeepSeek">ç§æœ‰åŒ–éƒ¨ç½²DeepSeek</a><time datetime="2025-08-16T09:12:50.000Z" title="å‘è¡¨äº 2025-08-16 17:12:50">2025-08-16</time></div></div><div class="aside-list-item"><a class="thumbnail" href="/yyg/37098f8c/" title="ä½¿ç”¨GitHub Actionså®ç°Hexoåšå®¢çš„è‡ªåŠ¨åŒ–å‘å¸ƒ"><img src="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://tu.ltyuanfang.cn/api/fengjing.php" onerror='this.onerror=null,this.src="/img/404.jpg"' alt="ä½¿ç”¨GitHub Actionså®ç°Hexoåšå®¢çš„è‡ªåŠ¨åŒ–å‘å¸ƒ"></a><div class="content"><a class="title" href="/yyg/37098f8c/" title="ä½¿ç”¨GitHub Actionså®ç°Hexoåšå®¢çš„è‡ªåŠ¨åŒ–å‘å¸ƒ">ä½¿ç”¨GitHub Actionså®ç°Hexoåšå®¢çš„è‡ªåŠ¨åŒ–å‘å¸ƒ</a><time datetime="2025-07-06T13:43:23.000Z" title="å‘è¡¨äº 2025-07-06 21:43:23">2025-07-06</time></div></div><div class="aside-list-item"><a class="thumbnail" href="/yyg/9e02bef8/" title="è§‚å½±æ„Ÿå—--é›„ç‹®å°‘å¹´2"><img src="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="/img/img01.png" onerror='this.onerror=null,this.src="/img/404.jpg"' alt="è§‚å½±æ„Ÿå—--é›„ç‹®å°‘å¹´2"></a><div class="content"><a class="title" href="/yyg/9e02bef8/" title="è§‚å½±æ„Ÿå—--é›„ç‹®å°‘å¹´2">è§‚å½±æ„Ÿå—--é›„ç‹®å°‘å¹´2</a><time datetime="2025-06-04T03:35:51.000Z" title="å‘è¡¨äº 2025-06-04 11:35:51">2025-06-04</time></div></div></div></div></div></div></main><footer id="footer"><div class="footer-other"><div class="footer-copyright"><span class="copyright">&copy;&nbsp;2024 - 2025 By äº‘é‡é˜</span></div><div class="footer_custom_text"><div id="runtime"></div>ä¸–ç•Œä¸Šåªæœ‰ä¸€ç§çœŸæ­£çš„è‹±é›„ä¸»ä¹‰ï¼Œé‚£å°±æ˜¯çœ‹æ¸…ç”Ÿæ´»çš„çœŸç›¸ä¹‹åï¼Œä¾ç„¶çƒ­çˆ±ç”Ÿæ´»</div></div></footer></div><div id="rightside"><div id="rightside-config-hide"><button id="readmode" type="button" title="é˜…è¯»æ¨¡å¼"><i class="fas fa-book-open"></i></button><button id="darkmode" type="button" title="æ—¥é—´å’Œå¤œé—´æ¨¡å¼åˆ‡æ¢"><i class="fas fa-adjust"></i></button><button id="hide-aside-btn" type="button" title="å•æ å’ŒåŒæ åˆ‡æ¢"><i class="fas fa-arrows-alt-h"></i></button><button id="refresh-cache" type="button" title="åˆ·æ–°ç¼“å­˜" onclick="refreshCache()"><i class="fas fa-refresh fa-spin"></i></button></div><div id="rightside-config-show"><button id="rightside-config" type="button" title="è®¾ç½®"><i class="fas fa-cog fa-spin"></i></button><button class="close" id="mobile-toc-button" type="button" title="ç›®å½•"><i class="fas fa-list-ul"></i></button><a id="to_comment" href="#post-comment" title="å‰å¾€è¯„è®º"><i class="fas fa-comments"></i></a><button id="go-up" type="button" title="å›åˆ°é¡¶éƒ¨"><span class="scroll-percent"></span><i class="fas fa-arrow-up"></i></button><button id="go-down" type="button" title="ç›´è¾¾åº•éƒ¨" onclick="btf.scrollToDest(document.body.scrollHeight,500)"><i class="fas fa-arrow-down"></i></button></div></div><div><script src="/js/utils.js?v=5.5.1"></script><script src="/js/main.js?v=5.5.1"></script><script src="https://s4.zstatic.net/ajax/libs/fancyapps-ui/5.0.36/fancybox/fancybox.umd.min.js"></script><script src="https://cdn.jsdelivr.net/npm/instant.page@5.2.0/instantpage.min.js" type="module"></script><script src="https://s4.zstatic.net/ajax/libs/vanilla-lazyload/19.1.3/lazyload.iife.min.js"></script><div class="js-pjax"><script>(()=>{const e=()=>{(()=>{const e=document.querySelectorAll("pre > code.mermaid");0!==e.length&&e.forEach(e=>{const t=document.createElement("pre");t.className="mermaid-src",t.hidden=!0,t.textContent=e.textContent;const n=document.createElement("div");n.className="mermaid-wrap",n.appendChild(t),e.parentNode.replaceWith(n)})})();const e=document.querySelectorAll("#article-container .mermaid-wrap");if(0===e.length)return;const t=()=>(e=>{window.loadMermaid=!0;const t="dark"===document.documentElement.getAttribute("data-theme")?"dark":"default";e.forEach((e,n)=>{const d=e.firstElementChild,a=`mermaid-${n}`,r=`%%{init:{ 'theme':'${t}'}}%%\n`+d.textContent,m=mermaid.render(a,r),o=e=>{d.insertAdjacentHTML("afterend",e)};"string"==typeof m?o(m):m.then(({svg:e})=>o(e))})})(e);btf.addGlobalFn("themeChange",t,"mermaid"),window.loadMermaid?t():btf.getScript("https://cdn.jsdelivr.net/npm/mermaid@11.12.0/dist/mermaid.min.js").then(t)};btf.addGlobalFn("encrypt",e,"mermaid"),window.pjax?e():document.addEventListener("DOMContentLoaded",e)})()</script><script>(()=>{const t="shuoshuo"===GLOBAL_CONFIG_SITE.pageType,e={"data-lang":"zh-CN","data-input-position":"top","data-loading":"lazy"},a=t=>"dark"===t?"noborder_dark":"noborder_light",s=(s=document,o)=>{const n=t?{"data-mapping":"specific","data-term":o}:{"data-mapping":e&&e["data-mapping"]||"pathname"},d=(t=>{const e=document.createElement("script");return Object.entries(t).forEach(([t,a])=>{e.setAttribute(t,a)}),e})({src:"https://giscus.app/client.js","data-repo":"MarsperL/MarsperL.github.io","data-repo-id":"R_kgDOHV6bsQ","data-category-id":"DIC_kwDOHV6bsc4Cd54m","data-theme":a(document.documentElement.getAttribute("data-theme")),"data-reactions-enabled":"1",crossorigin:"anonymous",async:!0,...e,...n});s.querySelector("#giscus-wrap").appendChild(d),t&&(window.shuoshuoComment.destroyGiscus=()=>{s.children.length&&(s.innerHTML="",s.classList.add("no-comment"))})};btf.addGlobalFn("themeChange",t=>{const e=document.querySelector("#giscus-wrap iframe");if(e){const s={giscus:{setConfig:{theme:a(t)}}};e.contentWindow.postMessage(s,"https://giscus.app")}},"giscus"),t?window.shuoshuoComment={loadComment:s}:s()})()</script><script>(()=>{const e="shuoshuo"===GLOBAL_CONFIG_SITE.pageType,t={label:"Utterances"},n=e=>"dark"===e?"dark-blue":"github-light",s=(s=document,r)=>{e&&(window.shuoshuoComment.destroyUtterances=()=>{s.children.length&&(s.innerHTML="",s.classList.add("no-comment"))});const o={src:"https://utteranc.es/client.js",repo:"MarsperL/yygyws",theme:n(document.documentElement.getAttribute("data-theme")),crossorigin:"anonymous",async:!0,...t,"issue-term":e?r:t&&t["issue-term"]||"title"},c=document.createElement("script");Object.entries(o).forEach(([e,t])=>c.setAttribute(e,t)),s.querySelector("#utterances-wrap").appendChild(c)};btf.addGlobalFn("themeChange",e=>{const t=document.querySelector("#utterances-wrap iframe");if(t){const s={type:"set-theme",theme:n(e)};t.contentWindow.postMessage(s,"https://utteranc.es")}},"utterances"),e?window.loadOtherComment=s:s()})()</script></div><script src="/js/parts.js"></script><script async src="/js/refresh.js"></script><script src="/js/background.js"></script><script async data-pjax src="//busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js"></script><div id="local-search"><div class="search-dialog"><nav class="search-nav"><span class="search-dialog-title">æœç´¢</span><i class="fas fa-spinner fa-pulse" id="loading-status" hidden></i><button class="search-close-button"><i class="fas fa-times"></i></button></nav><div class="text-center" id="loading-database"><i class="fas fa-spinner fa-pulse"></i> <span>æ•°æ®åŠ è½½ä¸­</span></div><div class="local-search-input"><input placeholder="æœç´¢æ–‡ç« " type="text"></div><hr><div id="local-search-results"></div><div class="ais-Pagination" id="local-search-pagination" style="display:none"><ul class="ais-Pagination-list"></ul></div><div id="local-search-stats"></div></div><div id="search-mask"></div><script src="/js/search/local-search.js?v=5.5.1"></script></div></div><script data-pjax>function butterfly_swiper_injector_config(){var a=document.getElementById("recent-posts");console.log("å·²æŒ‚è½½butterfly_swiper"),a.insertAdjacentHTML("afterbegin",'<div class="recent-post-item" style="height: auto;width: 100%"><div class="blog-slider swiper-container-fade swiper-container-horizontal" id="swiper_container"><div class="blog-slider__wrp swiper-wrapper" style="transition-duration: 0ms;"><div class="blog-slider__item swiper-slide" style="width: 750px; opacity: 1; transform: translate3d(0px, 0px, 0px); transition-duration: 0ms;"><a class="blog-slider__img" href="yyg/e102aa73/" alt=""><img width="48" height="48" src="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://imgapi.cn/api.php?fl=fengjing&amp;gs=images" alt="" onerror="this.src=https://unpkg.zhimg.com/akilar-candyassets/image/loading.gif; this.onerror = null;"/></a><div class="blog-slider__content"><span class="blog-slider__code">2024-07-15</span><a class="blog-slider__title" href="yyg/e102aa73/" alt="">Hexo-Butterflyç¾åŒ–æ•™ç¨‹-[1]åŸºç¡€ç¯å¢ƒ</a><div class="blog-slider__text">ç‚¹å‡»æŸ¥çœ‹ç½®é¡¶æ–‡ç« å•¦~~~</div><a class="blog-slider__button" href="yyg/e102aa73/" alt="">è¯¦æƒ…   </a></div></div><div class="blog-slider__item swiper-slide" style="width: 750px; opacity: 1; transform: translate3d(0px, 0px, 0px); transition-duration: 0ms;"><a class="blog-slider__img" href="yyg/80ffa402/" alt=""><img width="48" height="48" src="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="/img/icon.png" alt="" onerror="this.src=https://unpkg.zhimg.com/akilar-candyassets/image/loading.gif; this.onerror = null;"/></a><div class="blog-slider__content"><span class="blog-slider__code">2025-03-10</span><a class="blog-slider__title" href="yyg/80ffa402/" alt="">Hexo-Butterflyç¾åŒ–æ•™ç¨‹-[2]Butterflyä¸»é¢˜å®‰è£…</a><div class="blog-slider__text">ç‚¹å‡»æŸ¥çœ‹ç½®é¡¶æ–‡ç« å•¦~~~</div><a class="blog-slider__button" href="yyg/80ffa402/" alt="">è¯¦æƒ…   </a></div></div><div class="blog-slider__item swiper-slide" style="width: 750px; opacity: 1; transform: translate3d(0px, 0px, 0px); transition-duration: 0ms;"><a class="blog-slider__img" href="yyg/b2261cee/" alt=""><img width="48" height="48" src="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://picapi.pai.al/api/scenery.php" alt="" onerror="this.src=https://unpkg.zhimg.com/akilar-candyassets/image/loading.gif; this.onerror = null;"/></a><div class="blog-slider__content"><span class="blog-slider__code">2025-05-19</span><a class="blog-slider__title" href="yyg/b2261cee/" alt="">Hexo-Butterflyç¾åŒ–æ•™ç¨‹-[3]å»ºä¸»è¦é¡µé¢</a><div class="blog-slider__text">ç‚¹å‡»æŸ¥çœ‹ç½®é¡¶æ–‡ç« å•¦~~~</div><a class="blog-slider__button" href="yyg/b2261cee/" alt="">è¯¦æƒ…   </a></div></div><div class="blog-slider__item swiper-slide" style="width: 750px; opacity: 1; transform: translate3d(0px, 0px, 0px); transition-duration: 0ms;"><a class="blog-slider__img" href="yyg/8a5ee3aa/" alt=""><img width="48" height="48" src="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://api.vvhan.com/api/wallpaper/views" alt="" onerror="this.src=https://unpkg.zhimg.com/akilar-candyassets/image/loading.gif; this.onerror = null;"/></a><div class="blog-slider__content"><span class="blog-slider__code">2025-05-19</span><a class="blog-slider__title" href="yyg/8a5ee3aa/" alt="">Hexo-Butterflyç¾åŒ–æ•™ç¨‹-[4]ä¿®æ”¹é…ç½®æ–‡ä»¶</a><div class="blog-slider__text">ç‚¹å‡»æŸ¥çœ‹ç½®é¡¶æ–‡ç« å•¦~~~</div><a class="blog-slider__button" href="yyg/8a5ee3aa/" alt="">è¯¦æƒ…   </a></div></div><div class="blog-slider__item swiper-slide" style="width: 750px; opacity: 1; transform: translate3d(0px, 0px, 0px); transition-duration: 0ms;"><a class="blog-slider__img" href="yyg/23010111/" alt=""><img width="48" height="48" src="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://t.alcy.cc/fj" alt="" onerror="this.src=https://unpkg.zhimg.com/akilar-candyassets/image/loading.gif; this.onerror = null;"/></a><div class="blog-slider__content"><span class="blog-slider__code">2025-05-19</span><a class="blog-slider__title" href="yyg/23010111/" alt="">Hexo-Butterflyç¾åŒ–æ•™ç¨‹-[5]å®‰è£…å¸¸ç”¨æ’ä»¶</a><div class="blog-slider__text">ç‚¹å‡»æŸ¥çœ‹ç½®é¡¶æ–‡ç« å•¦~~~</div><a class="blog-slider__button" href="yyg/23010111/" alt="">è¯¦æƒ…   </a></div></div><div class="blog-slider__item swiper-slide" style="width: 750px; opacity: 1; transform: translate3d(0px, 0px, 0px); transition-duration: 0ms;"><a class="blog-slider__img" href="yyg/5986cad/" alt=""><img width="48" height="48" src="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="/img/icon.png" alt="" onerror="this.src=https://unpkg.zhimg.com/akilar-candyassets/image/loading.gif; this.onerror = null;"/></a><div class="blog-slider__content"><span class="blog-slider__code">2025-05-21</span><a class="blog-slider__title" href="yyg/5986cad/" alt="">Hexo-Butterflyç¾åŒ–æ•™ç¨‹-[6]å¼€å¯åšå®¢è¯„è®º</a><div class="blog-slider__text">ç‚¹å‡»æŸ¥çœ‹ç½®é¡¶æ–‡ç« å•¦~~~</div><a class="blog-slider__button" href="yyg/5986cad/" alt="">è¯¦æƒ…   </a></div></div><div class="blog-slider__item swiper-slide" style="width: 750px; opacity: 1; transform: translate3d(0px, 0px, 0px); transition-duration: 0ms;"><a class="blog-slider__img" href="yyg/5baeb6c6/" alt=""><img width="48" height="48" src="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://imgapi.cn/api.php?fl=fengjing&amp;gs=images" alt="" onerror="this.src=https://unpkg.zhimg.com/akilar-candyassets/image/loading.gif; this.onerror = null;"/></a><div class="blog-slider__content"><span class="blog-slider__code">2025-05-20</span><a class="blog-slider__title" href="yyg/5baeb6c6/" alt="">Hexo-Butterflyç¾åŒ–æ•™ç¨‹-[7]åŠŸèƒ½é­”æ”¹(æºç æ–¹å¼)</a><div class="blog-slider__text">ç‚¹å‡»æŸ¥çœ‹ç½®é¡¶æ–‡ç« å•¦~~~</div><a class="blog-slider__button" href="yyg/5baeb6c6/" alt="">è¯¦æƒ…   </a></div></div><div class="blog-slider__item swiper-slide" style="width: 750px; opacity: 1; transform: translate3d(0px, 0px, 0px); transition-duration: 0ms;"><a class="blog-slider__img" href="yyg/5f747cff/" alt=""><img width="48" height="48" src="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://api.jiangyuhui.top/aliyun/randomCover" alt="" onerror="this.src=https://unpkg.zhimg.com/akilar-candyassets/image/loading.gif; this.onerror = null;"/></a><div class="blog-slider__content"><span class="blog-slider__code">2025-05-23</span><a class="blog-slider__title" href="yyg/5f747cff/" alt="">Hexo-Butterflyç¾åŒ–æ•™ç¨‹-[8]éšé¼ æ ‡å˜å¹»çš„åŠ¨æ€ç²’å­çº¿æ¡èƒŒæ™¯</a><div class="blog-slider__text">ç‚¹å‡»æŸ¥çœ‹ç½®é¡¶æ–‡ç« å•¦~~~</div><a class="blog-slider__button" href="yyg/5f747cff/" alt="">è¯¦æƒ…   </a></div></div><div class="blog-slider__item swiper-slide" style="width: 750px; opacity: 1; transform: translate3d(0px, 0px, 0px); transition-duration: 0ms;"><a class="blog-slider__img" href="yyg/ca46b09/" alt=""><img width="48" height="48" src="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://t.alcy.cc/fj" alt="" onerror="this.src=https://unpkg.zhimg.com/akilar-candyassets/image/loading.gif; this.onerror = null;"/></a><div class="blog-slider__content"><span class="blog-slider__code">2024-08-07</span><a class="blog-slider__title" href="yyg/ca46b09/" alt="">Hexo-Butterflyç¾åŒ–æ•™ç¨‹-[9]ç¹æ²™</a><div class="blog-slider__text">ç‚¹å‡»æŸ¥çœ‹ç½®é¡¶æ–‡ç« å•¦~~~</div><a class="blog-slider__button" href="yyg/ca46b09/" alt="">è¯¦æƒ…   </a></div></div><div class="blog-slider__item swiper-slide" style="width: 750px; opacity: 1; transform: translate3d(0px, 0px, 0px); transition-duration: 0ms;"><a class="blog-slider__img" href="yyg/5ea27f40/" alt=""><img width="48" height="48" src="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://api.jiangyuhui.top/aliyun/randomCover" alt="" onerror="this.src=https://unpkg.zhimg.com/akilar-candyassets/image/loading.gif; this.onerror = null;"/></a><div class="blog-slider__content"><span class="blog-slider__code">2024-08-26</span><a class="blog-slider__title" href="yyg/5ea27f40/" alt="">åœ¨Githubä¸Šä½¿ç”¨OsmosFeedæ­å»ºåœ¨çº¿RSSé˜…è¯»å™¨ï¼ˆæ— éœ€æœåŠ¡å™¨ï¼‰</a><div class="blog-slider__text">ç‚¹å‡»æŸ¥çœ‹ç½®é¡¶æ–‡ç« å•¦~~~</div><a class="blog-slider__button" href="yyg/5ea27f40/" alt="">è¯¦æƒ…   </a></div></div><div class="blog-slider__item swiper-slide" style="width: 750px; opacity: 1; transform: translate3d(0px, 0px, 0px); transition-duration: 0ms;"><a class="blog-slider__img" href="yyg/37098f8c/" alt=""><img width="48" height="48" src="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://tu.ltyuanfang.cn/api/fengjing.php" alt="" onerror="this.src=https://unpkg.zhimg.com/akilar-candyassets/image/loading.gif; this.onerror = null;"/></a><div class="blog-slider__content"><span class="blog-slider__code">2025-07-06</span><a class="blog-slider__title" href="yyg/37098f8c/" alt="">ä½¿ç”¨GitHub Actionså®ç°Hexoåšå®¢çš„è‡ªåŠ¨åŒ–å‘å¸ƒ</a><div class="blog-slider__text">ç‚¹å‡»æŸ¥çœ‹ç½®é¡¶æ–‡ç« å•¦~~~</div><a class="blog-slider__button" href="yyg/37098f8c/" alt="">è¯¦æƒ…   </a></div></div></div><div class="blog-slider__pagination swiper-pagination-clickable swiper-pagination-bullets"></div></div></div>')}for(var elist="undefined".split(","),cpage=location.pathname,epage="all",flag=0,i=0;i<elist.length;i++)cpage.includes(elist[i])&&flag++;("all"===epage&&0==flag||epage===cpage)&&butterfly_swiper_injector_config()</script><script defer src="https://npm.elemecdn.com/hexo-butterfly-swiper/lib/swiper.min.js"></script><script defer data-pjax src="https://npm.elemecdn.com/hexo-butterfly-swiper/lib/swiper_init.js"></script><script async src="//at.alicdn.com/t/font_2032782_8d5kxvn09md.js"></script></body></html>